{
    "document_name": "23501-i40.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document defines the Stage 2 system architecture for the 5G System. The 5G System provides data connectivity and services.\nThis specification covers both roaming and non-roaming scenarios in all aspects, including interworking between 5GS and EPS, mobility within 5GS, QoS, policy control and charging, authentication and in general 5G System wide features e.g. SMS, Location Services, Emergency Services.\nITU-T Recommendation I.130 [11] describes a three-stage method for characterisation of telecommunication services, and ITU-T Recommendation Q.65 [12] defines Stage 2 of the method.\nTS 23.502 [3] contains the stage 2 procedures and flows for 5G System and it is a companion specification to this specification.\nTS 23.503 [45] contains the stage 2 Policy Control and Charging architecture for 5G System and it is a companion specification to this specification.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 22.261: \"Service requirements for next generation new services and markets; Stage 1\".\n[3]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[4]\t3GPP TS 23.203: \"Policies and Charging control architecture; Stage 2\".\n[5]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS); Stage 2\".\n[6]\t3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support on mobile radio interface: Stage 3\".\n[7]\tIETF RFC 7157: \"IPv6 Multihoming without Network Address Translation\".\n[8]\tIETF RFC 4191: \"Default Router Preferences and More-Specific Routes\".\n[9]\tIETF RFC 2131: \"Dynamic Host Configuration Protocol\".\n[10]\tIETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".\n[11]\tITU-T Recommendation I.130: \"Method for the characterization of telecommunication services supported by an ISDN and network capabilities of an ISDN\".\n[12]\tITU-T Recommendation Q.65: \"The unified functional methodology for the characterization of services and network capabilities\".\n[13]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS): Stage 3\".\n[14]\tVoid.\n[15]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[16]\t3GPP TS 22.173: \"IMS Multimedia Telephony Service and supplementary services; Stage 1\".\n[17]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station in idle mode\".\n[18]\t3GPP TS 23.167: \"3rd Generation Partnership Project; Technical Specification Group Services and Systems Aspects; IP Multimedia Subsystem (IMS) emergency sessions\".\n[19]\t3GPP TS 23.003: \"Numbering, Addressing and Identification\".\n[20]\tIETF RFC 7542: \"The Network Access Identifier\".\n[21]\t3GPP TS 23.002: \"Network Architecture\".\n[22]\t3GPP TS 23.335: \"User Data Convergence (UDC); Technical realization and information flows; Stage 2\".\n[23]\t3GPP TS 23.221: \"Architectural requirements\".\n[24]\t3GPP TS 22.153: \"Multimedia priority service\".\n[25]\t3GPP TS 22.011: \"Service Accessibility\".\n[26]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[27]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description\".\n[28]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol Specification\".\n[29]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[30]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[31]\t3GPP TS 37.340: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and NR; Multi-connectivity; Stage 2\".\n[32]\t3GPP TS 23.214: \"Architecture enhancements for control and user plane separation of EPC nodes; Stage 2\".\n[33]\t3GPP TS 22.101: \"3rd Generation Partnership Project; Technical Specification Group Services and Systems Aspects; Service aspects; Service principles\".\n[34]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".\n[35]\t3GPP TS 33.126: \"Lawful Interception Requirements\".\n[36]\t3GPP TS 23.682: \"Architecture enhancements to facilitate communications with packet data networks and applications\".\n[37]\t3GPP TS 22.280: \"Mission Critical Services Common Requirements (MCCoRe); Stage 1\".\n[38]\t3GPP TS 23.379: \"Functional architecture and information flows to support Mission Critical Push To Talk (MCPTT); Stage 2\".\n[39]\t3GPP TS 23.281: \"Functional architecture and information flows to support Mission Critical Video (MCVideo); Stage 2\".\n[40]\t3GPP TS 23.282: \"Functional architecture and information flows to support Mission Critical Data (MCData); Stage 2\".\n[41]\t3GPP TS 32.240: \"Charging management; Charging architecture and principles\".\n[42]\t3GPP TS 38.401: \"NG-RAN Architecture description\".\n[43]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[44]\tIETF RFC 4960: \"Stream Control Transmission Protocol\".\n[45]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System\".\n[46]\t3GPP TS 23.041: \"Public Warning System\".\n[47]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[48]\t3GPP TS 24.502: \"Access to the 5G System (5GS) via non-3GPP access networks; Stage 3\".\n[49]\t3GPP TS 29.500: \"5G System; Technical Realization of Service Based Architecture; Stage 3\".\n[50]\t3GPP TS 38.304: \"NR; User Equipment (UE) procedures in idle mode\".\n[51]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[52]\t3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode\".\n[53]\tVoid.\n[54]\tIETF RFC 4861: \"Neighbor Discovery for IP version 6 (IPv6)\".\n[55]\t3GPP TS 23.271: \"Functional stage 2 description of Location Services (LCS)\".\n[56]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[57]\tIETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".\n[58]\t3GPP TS 29.510: \"5G System: Network function repository services; Stage 3\".\n[59]\t3GPP TS 29.502: \"5G System: Session Management Services: Stage 3\".\n[60]\tIETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2) \".\n[61]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[62]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[63]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services; Stage 2\".\n[64]\t3GPP TS 23.222: \"Functional architecture and information flows to support Common API Framework for 3GPP Northbound APIs\".\n[65]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane Nodes; Stage 3\".\n[66]\t3GPP TS 32.421: \"Telecommunication management; Subscriber and equipment trace; Trace concepts and requirements\".\n[67]\t3GPP TS 32.290: \"5G system; Services, operations and procedures of charging using Service Based Interface (SBI)\".\n[68]\t3GPP TS 32.255: \"5G Data connectivity domain charging; Stage 2\".\n[69]\t3GPP TS 38.306: \"NR; User Equipment -UE) radio access capabilities\".\n[70]\t3GPP TS 36.306: \"Evolved Universal Terrestrial Radio Access -E-UTRA); User Equipment -UE) radio access capabilities\".\n[71]\t3GPP TS 29.518: \"5G System; Access and Mobility Management Services; Stage 3\".\n[72]\tVoid.\n[73]\tIETF RFC 2865: \"Remote Authentication Dial In User Service (RADIUS)\".\n[74]\tIETF RFC 3162: \"RADIUS and IPv6\".\n[75]\t3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol User Plane (GTPv1-U)\".\n[76]\t3GPP TS 26.238: \"Uplink streaming\".\n[77]\t3GPP TR 26.939: \"Guidelines on the Framework for Live Uplink Streaming (FLUS)\".\n[78]\tInternational Telecommunication Union (ITU), Standardization Bureau (TSB): \"Operational Bulletin No. 1156\"; http://handle.itu.int/11.1002/pub/810cad63-en (retrieved October 5, 2018).\n[79]\t3GPP TS 28.533: \"Management and orchestration; Architecture framework\".\n[80]\t3GPP TS 24.250: \"Protocol for Reliable Data Service; Stage 3\".\n[81]\tIETF RFC 8684: \"TCP Extensions for Multipath Operation with Multiple Addresses\".\n[82]\tIETF RFC 8803: \"0-RTT TCP Convert Protocol\".\n[83]\tIEEE Std 802.1CB-2017: \"IEEE Standard for Local and metropolitan area networks-Frame Replication and Elimination for Reliability\".\n[84]\t3GPP TS 23.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[85]\tWiFi Alliance Technical Committee, Hotspot 2.0 Technical Task Group: \"Hotspot 2.0 (Release 2) Technical Specification\".\n[86]\t3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support network data analytics services\".\n[87]\t3GPP TS 23.273: \"5G System (5GS) Location Services (LCS); Stage 2\".\n[88]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".\n[89]\tCableLabs DOCSIS MULPI: \"Data-Over-Cable Service Interface Specifications DOCSIS 3.1, MAC and Upper Layer Protocols Interface Specification\".\n[90]\tBBF TR-124 issue 5: \"Functional Requirements for Broadband Residential Gateway Devices\".\n[91]\tBBF TR-101 issue 2: \"Migration to Ethernet-Based Broadband Aggregation\".\n[92]\tBBF TR-178 issue 1: \"Multi-service Broadband Network Architecture and Nodal Requirements\".\n[93]\tBBF TR-456 issue 2: \"AGF Functional Requirements\".\n[94]\tBBF WT-457: \"FMIF Functional Requirements\".\nEditor's note:\tThe reference to BBF WT-457 will be revised when finalized by BBF.\n[95]\tVoid.\n[96]\tVoid.\n[97]\tIEEE Std 802.1AB-2016: \"IEEE Standard for Local and metropolitan area networks -- Station and Media Access Control Connectivity Discovery\".\n[98]\tIEEE Std 802.1Q-2022: \"IEEE Standard for Local and metropolitan area networks--Bridges and Bridged Networks\".\n[99]\t3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\".\n[100]\t3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[101]\t3GPP TS 29.274: \"Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[102]\t3GPP TS 23.632: \"User Data Interworking, Coexistence and Migration; stage 2\".\n[103]\t3GPP TS 29.563: \"5G System (5GS); HSS services for interworking with UDM; Stage 3\".\n[104]\tIEEE Std 802.1AS-2020: \"IEEE Standard for Local and metropolitan area networks--Timing and Synchronization for Time-Sensitive Applications\".\n[105]\t3GPP TS 22.104: \"Service requirements for cyber-physical control applications in vertical domains\".\n[106]\tIEEE Std 802.11-2012: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[107]\tIEEE Std 1588-2008: \"IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems\".\n[108]\t3GPP TS 28.552: \"Management and orchestration; 5G performance measurements\".\n[109]\t3GPP TS 24.193: \"Access Traffic Steering, Switching and Splitting; Stage 3\".\n[110]\t3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage 3\".\n[111]\t3GPP TS 22.186: \"Enhancement of 3GPP support for V2X scenarios; Stage 1\".\n[112]\t3GPP TR 38.824: \"Study on physical layer enhancements for NR ultra-reliable and low latency case (URLLC)\".\n[113]\tIEEE: \"Guidelines for Use of Extended Unique Identifier (EUI), Organizationally Unique Identifier (OUI), and Company ID (CID)\", https://standards.ieee.org/content/dam/ieee-standards/standards/web/documents/tutorials/eui.pdf.\n[114]\t3GPP TS 32.256: \"Charging Management; 5G connection and mobility domain charging; Stage 2\".\n[115]\t3GPP TS 33.210: \"Network Domain Security (NDS); IP network layer security\".\n[116]\t3GPP TS 38.415: \"PDU Session User Plane Protocol\".\n[117]\t3GPP TS 24.535: \"Device-side Time-Sensitive Networking (TSN) Translator (DS-TT) to network-side TSN Translator (NW-TT) protocol aspects; Stage 3\".\n[118]\t3GPP TS 32.274: \"Charging Management; Short Message Service (SMS) charging\".\n[119]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[120]\t3GPP TS 38.314: \"NR; Layer 2 measurements\".\n[121]\t3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support Vehicle-to-Everything (V2X) services\".\n[122]\t3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".\n[123]\t3GPP TS 32.254: \"Charging management; Exposure function Northbound Application Program Interfaces (APIs) charging\".\n[124]\t3GPP TS 33.535: \"Authentication and Key Management for Applications based on 3GPP credentials in the 5G System (5GS)\".\n[125]\t3GPP TS 38.410: \"NG-RAN; NG general aspects and principles\".\n[126]\tIEEE Std 1588: \"IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems\", Edition 2019.\n[127]\tST 2059-2:2015: \"SMPTE Standard - SMPTE Profile for Use of IEEE-1588 Precision Time Protocol in Professional Broadcast Applications\".\n[128]\t3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System (5GS)\".\n[129]\t3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast services\".\n[130]\t3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".\n[131]\tIEEE Std 802.3: \"Ethernet\".\n[132]\t3GPP TS 29.561: \"5G System; Interworking between 5G Network and external Data Networks; Stage 3\".\n[133]\t3GPP TS 29.513: \"Policy and Charging Control signalling flows and QoS parameter mapping; Stage 3\".\n[134]\t3GPP TS 23.558: \"Architecture for enabling Edge Applications (EA)\".\n[135]\t3GPP TS 26.501: \"5G Media Streaming (5GMS); General description and architecture\".\n[136]\t3GPP TS 23.256: \"Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2\".\n[137]\tGSMA NG.116: \"Generic Network Slice Template\".\n[138]\tIETF RFC 3948: \"UDP Encapsulation of IPsec ESP Packets\".\n[139]\t3GPP TS 24.539: \"5G System (5GS); Network to TSN translator (TT) protocol aspects; Stage 3\".\n[140]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\".\n[141]\t3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function\".\n[142]\t3GPP TS 23.540: \"Technical realization of Service Based Short Message Service; Stage 2\".\n[143]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol specification\".\n[144]\t3GPP TS 29.525: \"5G System; UE Policy Control Service; Stage 3\".\n[145]\t3GPP TS 29.505: \"5G System; Usage of the Unified Data Repository Services for Subscription Data; Stage 3\".\n[146]\tIEEE Std P802.1Qdj-d1.3: \"IEEE Draft Standard for Local and metropolitan area networks - Bridges and Bridged Networks - Amendment XX: Configuration Enhancements for Time-Sensitive Networking\".\n[147]\tVoid.\n[148]\t3GPP TS 28.557: \"Management and orchestration; Management of Non-Public Networks (NPN)\".\n[149]\t3GPP TS 28.541: \"Management and orchestration; 5G Network Resource Model (NRM)\".\n[150]\tIETF RFC 8655: \"Deterministic Networking Architecture\".\n[151]\tIETF RFC 8343: \"A YANG Data Model for Interface Management\".\n[152]\tIETF RFC 8344: \"A YANG Data Model for IP Management\".\n[153]\tIETF RFC 7224: \" IANA Interface Type YANG Module\".\n[154]\tIETF draft-ietf-detnet-yang: \"Deterministic Networking (DetNet) YANG Model\".\nEditor's note:\tThe reference to draft-ietf-detnet-yang will be revised to RFC when finalized by IETF.\n[155]\tIETF RFC 6241: \"Network Configuration Protocol (NETCONF)\".\n[156]\tIETF RFC 8040: \"RESTCONF Protocol\".\n[157]\tIETF RFC 8939: \"Deterministic Networking (DetNet) Data Plane: IP\".\n[158]\tIETF RFC 5279: \"A Uniform Resource Name (URN) Namespace for the 3rd Generation Partnership Project (3GPP)\".\n[159]\tIETF RFC 9330:\"Low Latency, Low Loss, Scalable Throughput (L4S) Internet Service: Architecture\".\n[160]\tIETF RFC 9331: \"Explicit Congestion Notification (ECN) Protocol for Very Low Queuing Delay (L4S)\".\n[161]\tIETF RFC 9332: \"Dual-Queue Coupled Active Queue Management (AQM) for Low Latency, Low Loss, and Scalable Throughput (L4S)\".\n[162]\tIETF RFC 6603: \"Prefix Exclude Option for DHCPv6-based Prefix Delegation\".\n[163]\tIETF RFC 8415: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[164]\tITU-T Recommendation G.810: \"Definitions and terminology for synchronization networks\".\n[165]\t3GPP TS 38.470: \"NG-RAN; F1 general aspects and principles\".\n[166]\tIETF RFC 9000: \"QUIC: A UDP-Based Multiplexed and Secure Transport\".\n[167]\tIETF RFC 9001: \"Using TLS to Secure QUIC\".\n[168]\tIETF RFC 9002: \"QUIC Loss Detection and Congestion Control\".\n[169]\tIETF RFC 9221: \"An Unreliable Datagram Extension to QUIC\".\n[170]\tIETF RFC 9298: \"Proxying UDP in HTTP\".\n[171]\tIETF RFC 9114: \"Hypertext Transfer Protocol Version 3 (HTTP/3)\".\n[172]\tIETF RFC 9297: \"HTTP Datagrams and the Capsule Protocol\".\n[173]\tIETF RFC 9220: \"Bootstrapping WebSockets with HTTP/3\".\n[174]\tdraft-ietf-quic-multipath: \"Multipath Extension for QUIC\".\nEditor's note:\tThe above document cannot be formally referenced until it is published as an RFC.\n[175]\t3GPP TS 28.530: \"Management and orchestration; Concepts, use cases and requirements\".\n[176]\t3GPP TS 28.531: \"Management and orchestration; Provisioning\".\n[177]\t3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals (SEAL); Functional architecture and information flows\".\n[178]\tIEEE Std 802.1CBdb-2021: \"Amendment 2: Extend Stream Identification Functions\".\n[179]\t3GPP TS 26.522: \"5G Real-time Media Transport Protocol Configurations\".\n[180]\t3GPP TS 23.586: \"Architectural Enhancements to support Ranging based services and Sidelink Positioning\".\n[181]\t3GPP TS 23.542: \"Application layer support for Personal IoT Network\".\n[182]\tIETF RFC 8415: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".\n[183]\t3GPP TS 29.571: \"5G System; Common Data Types for Service Based Interfaces; Stage 3\".\n[184]\t3GPP TS 23.289: \"Mission Critical services over 5G System; Stage 2\".\n[185]\tIETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".\n[186]\tIETF RFC 3711: \"The Secure Real-time Transport Protocol (SRTP)\".\n[187]\tIETF RFC 6184: \"RTP Payload Format for H.264 Video\".\n[188]\tIETF RFC 7798: \"RTP Payload Format for High Efficiency Video Coding (HEVC) \".\n[189]\tIETF RFC 8285: \"A General Mechanism for RTP Header Extensions\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n5G VN Group: A set of UEs using private communication for 5G LAN-type service.\n5G Access Network: An access network comprising a NG-RAN and/or non-3GPP AN connecting to a 5G Core Network.\n5G Access Stratum-based Time Distribution: A time synchronization distribution method that is used by an NG-RAN to provide the 5GS time to the UE(s) over the radio interface using procedures specified in TS 38.331 [28].\n5G Core Network: The core network specified in the present document. It connects to a 5G Access Network.\n5G LAN-Type Service: A service over the 5G system offering private communication using IP and/or non-IP type communications.\n5G LAN-Virtual Network: A virtual network over the 5G system capable of supporting 5G LAN-type service.\n5G NSWO: The 5G NSWO is the capability provided by 5G system and by UE to enable the connection to a WLAN access network using 5GS credentials without registration to 5GS.\n5G QoS Flow or QoS Flow: The finest granularity for QoS forwarding treatment in the 5G System. All traffic mapped to the same 5G QoS Flow receive the same forwarding treatment (e.g. scheduling policy, queue management policy, rate shaping policy, RLC configuration, etc.). Providing different QoS forwarding treatment requires separate 5G QoS Flow.\n5G QoS Identifier: A scalar that is used as a reference to a specific QoS forwarding behaviour (e.g. packet loss rate, packet delay budget) to be provided to a 5G QoS Flow. This may be implemented in the access network by the 5QI referencing node specific parameters that control the QoS forwarding treatment (e.g. scheduling weights, admission thresholds, queue management thresholds, link layer protocol configuration, etc.).\n5G System: 3GPP system consisting of 5G Access Network (AN), 5G Core Network and UE.\n5G-BRG: The 5G-BRG is a 5G-RG defined in BBF.\n5G-CRG: The 5G-CRG is a 5G-RG specified in DOCSIS MULPI [89].\n5G-RG: A 5G-RG is a RG capable of connecting to 5GC playing the role of a UE with regard to the 5G core. It supports secure element and exchanges N1 signalling with 5GC. The 5G-RG can be either a 5G-BRG or 5G-CRG.\nAccess Traffic Steering: The procedure that selects an access network for a new data flow and transfers the traffic of this data flow over the selected access network. Access traffic steering is applicable between one 3GPP access and one non-3GPP access.\nAccess Traffic Switching: The procedure that moves all traffic of an ongoing data flow from one access network to another access network in a way that maintains the continuity of the data flow. Access traffic switching is applicable between one 3GPP access and one non-3GPP access.\nAccess Traffic Splitting: The procedure that splits the traffic of a data flow across multiple access networks. When traffic splitting is applied to a data flow, some traffic of the data flow is transferred via one access and some other traffic of the same data flow is transferred via another access. Access traffic splitting is applicable between one 3GPP access and one non-3GPP access.\nAllowed NSSAI: Indicating the S-NSSAIs values the UE could use in the Serving PLMN in the current Registration Area.\nAllowed Area: Area where the UE is allowed to initiate communication as specified in clause 5.3.2.3.\nAlternative S-NSSAI: Indicating a compatible S-NSSAI for an S-NSSAI in the Allowed NSSAI that the AMF uses to replace an S-NSSAI when the S-NSSAI is not available or congested, as specified in clause 5.15.19.\nAMF Region: An AMF Region consists of one or multiple AMF Sets.\nAMF Set: An AMF Set consists of some AMFs that serve a given area and Network Slice(s). AMF Set is unique within an AMF Region and it comprises of AMFs that support the same Network Slice(s). Multiple AMF Sets may be defined per AMF Region. The AMF instances in the same AMF Set may be geographically distributed but have access to the same context data.\nApplication Identifier: An identifier that can be mapped to a specific application traffic detection rule.\nAUSF Group ID: This refers to one or more AUSF instances managing a specific set of SUPIs. An AUSF Group consists of one or multiple AUSF Sets.\nBinding Indication: Information included by a NF service producer to a NF service consumer in request responses or notifications to convey the scope within which selection/reselection of target NF/NF Services may be performed, or information included by the NF service consumer in requests or subscriptions to convey the scope within which selection/reselection of notification targets or the selection of other service(s) that the NF consumer produces for the same data context may be performed. See clause 6.3.1.0.\nBSF Group ID: This refers to one or more BSF instances managing a specific set of SUPIs or GPSIs. A BSF Group consists of one or multiple BSF Sets.\nConfigured NSSAI: NSSAI provisioned in the UE applicable to one or more PLMNs.\nCHF Group ID: This refers to one or more CHF instances managing a specific set of SUPIs.\nCredentials Holder: Entity which authenticates and authorizes access to an SNPN separate from the Credentials Holder.\nData Burst: A set of multiple PDUs generated and sent by the application in a short period of time.\nNOTE 1:\tA Data Burst can be composed of one or multiple PDU Sets.\nDefault UE credentials: Information configured in the UE to make the UE uniquely identifiable and verifiably secure to perform UE onboarding.\nDefault Credentials Server (DCS): An entity that can perform authentication based on the Default UE credentials or provide means for another entity to perform authentication based on the Default UE credentials.\nDelegated Discovery: This refers to delegating the discovery and associated selection of NF instances or NF service instances to an SCP.\nDirect Communication: This refers to the communication between NFs or NF services without using an SCP.\nDisaster Condition: See definition in TS 22.261 [2].\nDisaster Inbound Roamer: See definition in TS 22.261 [2].\nDisaster Roaming: See definition in TS 22.261 [2].\nDN Access Identifier (DNAI): Identifier of a user plane access to one or more DN(s) where applications are deployed.\nEmergency Registered: A UE is considered Emergency Registered over an Access Type in a PLMN when registered for emergency services only over this Access Type in this PLMN.\nEndpoint Address: An address in the format of an IP address or FQDN, which is used to determine the host/authority part of the target URI. This Target URI is used to access an NF service (i.e. to invoke service operations) of an NF service producer or for notifications to an NF service consumer.\nEn-gNB: as defined in TS 37.340 [31].\nExpected UE Behaviour: Set of parameters provisioned by an external party to 5G network functions on the foreseen or expected UE behaviour, see clause 5.20.\nFixed Network Residential Gateway: A Fixed Network RG (FN-RG) is a RG that it does not support N1 signalling and it is not 5GC capable.\nFixed Network Broadband Residential Gateway: A Fixed Network RG (FN-BRG) is a FN-RG specified in BBF TR-124 [90].\nFixed Network Cable Residential Gateway: A Fixed Network Cable RG (FN-CRG) is a FN-RG with cable modem specified in DOCSIS MULPI [89].\nForbidden Area: An area where the UE is not allowed to initiate communication as specified in clause 5.3.2.3.\nGBR QoS Flow: A QoS Flow using the GBR resource type or the Delay-critical GBR resource type and requiring guaranteed flow bit rate.\nGroup ID for Network Selection (GIN): An identifier used during SNPN selection to enhance the likelihood of selecting a preferred SNPN that supports a Default Credentials Server or a Credentials Holder.\n(g)PTP-based Time Distribution: a method to distribute timing among entities in a (g)PTP domain using PTP messages generated by a GM (in the case the GM is external to 5GS) or by 5GS (in the case the 5GS acts as a GM for a given (g)PTP domain). Possible dependencies between (g)PTP-based Time Distribution and 5G Access Stratum-based Time Distribution are described in clause 5.27.1. The synchronization process is described in clause 5.27.1 and follows the applicable profiles of IEEE Std 802.1AS [104] or IEEE Std 1588 [126].\nHome Network Public Key Identifier: An identifier used to indicate which public/private key pair is used for SUPI protection and de-concealment of the SUCI as specified in TS 23.003 [19].\nIAB-donor: This is a NG-RAN node that supports Integrated access and backhaul (IAB) feature and provides connection to the core network to IAB-nodes. It supports the CU function of the CU/DU architecture for IAB defined in TS 38.401 [42].\nIAB-node: A relay node that supports wireless in-band and out-of-band relaying of NR access traffic via NR Uu backhaul links. It supports the UE function and the DU function of the CU/DU architecture for IAB defined in TS 38.401 [42].\nIndirect Communication: This refers to the communication between NFs or NF services via an SCP.\nInitial Registration: UE registration in RM-DEREGISTERED state as specified in clause 5.3.2.\nIntermediate SMF (I-SMF): An SMF that is inserted to support a PDU session as the UE is located in an area which cannot be controlled by the original SMF because the UPF(s) belong to a different SMF Service Area.\nLocal Area Data Network: a DN that is accessible by the UE only in specific locations, that provides connectivity to a specific DNN, and whose availability is provided to the UE.\nLocal Break Out (LBO): Roaming scenario for a PDU Session where the PDU Session Anchor and its controlling SMF are located in the serving PLMN (VPLMN).\nLTE-M: a 3GPP RAT type Identifier used in the Core Network only, which is a sub-type of E-UTRA RAT type, and defined to identify in the Core Network the E-UTRA when used by a UE indicating Category M.\nMA PDU Session: A PDU Session that provides a PDU connectivity service, which can use one access network at a time, or simultaneously one 3GPP access network and one non-3GPP access network.\nMobile Base Station Relay: A mobile base station acts as a relay between a UE and the 5G network. Such mobile base station relay can for example be mounted on a moving vehicle and serve UEs that can be located inside or outside the vehicle (or entering/leaving the vehicle). See description of TS 22.261 [2]. A mobile Base Station Relay is supported in 5GS with the IAB-architecture with mobility as specified in clause 5.35A and that described in TS 38.401 [42].\nMaster RAN node: A Master node as defined in TS 37.340 [31].\nMobility Pattern: Network concept of determining within the AMF the UE mobility parameters as specified in clause 5.3.2.4.\nMobility Registration Update: UE re-registration when entering new TA outside the TAI List as specified in clause 5.3.2.\nMPS-subscribed UE: A UE having a USIM with MPS subscription.\nMulti-USIM UE: A UE with multiple USIMs, capable of maintaining a separate registration state with a PLMN for each USIM at least over 3GPP Access and supporting one or more of the features described in clause 5.38.\nNB-IoT UE Priority: Numerical value used by the NG-RAN to prioritise between different UEs accessing via NB-IoT.\nNGAP UE association: The logical per UE association between a 5G-AN node and an AMF.\nNGAP UE-TNLA-binding: The binding between a NGAP UE association and a specific TNL association for a given UE.\nNetwork Function: A 3GPP adopted or 3GPP defined processing function in a network, which has defined functional behaviour and 3GPP defined interfaces.\nNOTE 2:\tA network function can be implemented either as a network element on a dedicated hardware, as a software instance running on a dedicated hardware, or as a virtualised function instantiated on an appropriate platform, e.g. on a cloud infrastructure.\nNetwork Instance: Information identifying a domain. Used by the UPF for traffic detection and routing.\nNetwork Slice: A logical network that provides specific network capabilities and network characteristics.\nNetwork Slice Area of Service: The area where a UE can access and get service of a particular network slice as more than zero resources are allocated to the network slice in the NG-RAN cells.\nNetwork Slice instance: A set of Network Function instances and the required resources (e.g. compute, storage and networking resources) which form a deployed Network Slice.\nNon-GBR QoS Flow: A QoS Flow using the Non-GBR resource type and not requiring guaranteed flow bit rate.\nNSI ID: an identifier for identifying the Core Network part of a Network Slice instance when multiple Network Slice instances of the same Network Slice are deployed, and there is a need to differentiate between them in the 5GC.\nNF instance: an identifiable instance of the NF.\nNF service: a functionality exposed by a NF through a service-based interface and consumed by other authorized NFs.\nNF service instance: an identifiable instance of the NF service.\nNF service operation: An elementary unit a NF service is composed of.\nNF Service Set: A group of interchangeable NF service instances of the same service type within an NF instance. The NF service instances in the same NF Service Set have access to the same context data.\nNF Set: A group of interchangeable NF instances of the same type, supporting the same services and the same Network Slice(s). The NF instances in the same NF Set may be geographically distributed but have access to the same context data.\nNG-RAN: A radio access network that supports one or more of the following options with the common characteristics that it connects to 5GC:\n1)\tStandalone New Radio.\n2)\tNew Radio is the anchor with E-UTRA extensions.\n3)\tStandalone E-UTRA.\n4)\tE-UTRA is the anchor with New Radio extensions.\nNon-3GPP QoS Assistance Information: A set of QoS assistance information provided to the UE (e.g. PEGC) to enable the UE to perform QoS differentiation for the connected devices in the non-3GPP network behind the UE.\nNon-Allowed Area: Area where the UE is allowed to initiate Registration procedure but no other communication as specified in clause 5.3.2.3.\nNon-Public Network: See definition in TS 22.261 [2].\nNon-Seamless Non-3GPP offload: The offload of user plane traffic via non-3GPP access without traversing either N3IWF/TNGF or UPF.\nNon-Seamless WLAN offload: Non-Seamless Non-3GPP offload when the non-3GPP access network is WLAN.\nOnboarding Network: Either a PLMN enabling Remote Provisioning for a registered UE, or an Onboarding SNPN.\nOnboarding Standalone Non-Public Network: An SNPN providing Onboarding access and enabling Remote Provisioning for a UE registered for Onboarding as specified in clause 4.2.2.2.4 of TS 23.502 [3].\nPartially Allowed NSSAI: Indicating the S-NSSAIs values the UE could use in the Serving PLMN or SNPN in some of the TAs in the current Registration Area. Each S-NSSAI in the Partially Allowed NSSAI is associated with a list of TAs where the S-NSSAI is supported.\nPCF Group ID: This refers to one or more PCF instances managing a specific set of SUPIs. A PCF Group consists of one or multiple PCF Sets.\nPDU Connectivity Service: A service that provides exchange of PDUs between a UE and a Data Network.\nPDU Session: Association between the UE and a Data Network that provides a PDU connectivity service.\nPDU Session Type: The type of PDU Session which can be IPv4, IPv6, IPv4v6, Ethernet or Unstructured.\nPDU Set: One or more PDUs carrying the payload of one unit of information generated at the application level (e.g. frame(s) or video slice(s) etc. for eXtended Reality (XR) Services). All the PDUs of a PDU set are transmitted within the same QoS Flow.\nPending NSSAI: NSSAI provided by the Serving PLMN during a Registration procedure, indicating the S-NSSAI(s) for which the network slice-specific authentication and authorization procedure is pending.\nPeriodic Registration Update: UE re-registration at expiry of periodic registration timer as specified in clause 5.3.2.\nPersonal IoT Network (PIN): A network with group of element(s) (i.e. UE or non-3GPP device) that are able to communicate with each other directly, communicate with each other via intermediate element(s), communicate with each other via 5GS, or communicate with external DN via 5GS.\nPIN Element (PINE): A UE or non-3GPP device that is part of the group of elements in a PIN.\nPIN Element with Gateway Capability (PEGC): A PIN Element with the ability to provide DN connectivity via the 5G network for other PIN Elements and/or a PIN Element with the ability to provide relay functionality for communication between PIN Elements. Only a UE is able to act as a PEGC. A PIN includes at least one PEGC.\nNOTE 3:\tIn the context of PIN, the terms PEGC and UE with PEGC capability are synonymous, therefore when the term PEGC is used, it is also intended as UE.\nPIN Element with Management Capability (PEMC): A PIN Element with capability to manage the PIN and the management is supported by an AF if deployed. A PIN includes at least one PEMC.\nNOTE 4:\tA UE that is a PIN Element may both act as PEMC and PEGC.\nPIN management traffic: The traffic among PINE, PEGC, PEMC and AF for PIN related to the management of PIN.\nPIN-DN communication: The communication between PINE and DN via a PEGC and 5G network, as well as the communication between PEGC and DN via 5G network. The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic towards the internet or the PIN management traffic towards the PIN AF).\nPIN direct communication: The communication without traversing 5G network between two PIN Elements (e.g. between a PIN Element and a PEGC, between a PIN Element and a PEMC, between a PEMC and a PEGC and between two PEGCs). The communication traverses intermediate PIN Element(s) or not. The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic between 2 PINEs or the PIN management traffic between PINE and PEMC).\nPIN indirect communication: The communication with traversing 5G network between PIN Elements connected to different PEGCs of the same PIN, and between a PIN Element and a PEMC via PEGC. The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic between 2 PINEs or the PIN management traffic between PINE and PEMC).\nPLMN with Disaster Condition: A PLMN to which a Disaster Condition applies.\nPre-configured 5QI: Pre-defined QoS characteristics configured in the AN and 5GC and referenced via a non-standardized 5QI value.\nPrimary cell: as defined in TS 36.331 [51].\nPrimary RAT: RAT of the Master RAN node, when Dual Connectivity is used; otherwise RAT of the RAN node.\nPrivate communication: See definition in TS 22.261 [2].\nProvisioning Server: Entity that provisions network credentials and other data in the UE to enable SNPN access.\nPTP domain: As defined in IEEE Std 1588 [126].\nPublic network integrated NPN: A non-public network deployed with the support of a PLMN.\n(Radio) Access Network: See 5G Access Network.\nRAT type: Identifies the transmission technology used in the access network for both 3GPP accesses and non-3GPP Accesses, for example, NR, NB-IOT, Untrusted Non-3GPP, Trusted Non-3GPP, Trusted IEEE 802.11 Non-3GPP access, Wireline, Wireline-Cable, Wireline-BBF, etc.\nNR RedCap: a 3GPP RAT type Identifier used in the Core Network only, which is a sub-type of NR RAT type, and defined to identify in the Core Network the NR when used by a UE indicating NR RedCap.\nRequested NSSAI: NSSAI provided by the UE to the Serving PLMN during registration.\nResidential Gateway: The Residential Gateway (RG) is a device providing, for example voice, data, broadcast video, video on demand, to other devices in customer premises.\nRouting Binding Indication: Information included in a request or notification and that can be used by the SCP for discovery and associated selection to of a suitable target. See clauses 6.3.1.0 and 7.1.2\nRouting Indicator: Indicator that allows together with SUCI/SUPI Home Network Identifier to route network signalling to AUSF and UDM instances capable to serve the subscriber.\nRRC_IDLE, RRC_CONNECTED, RRC_INACTIVE: As defined in TS 38.331 [28] and TS 38.306 [69].\nSCP Domain: A configured group of one or more SCP(s) and zero or more NF instances(s). An SCP within the group can communicate with any NF instance or SCP within the same group directly, i.e. without passing through an intermediate SCP.\nSecondary RAN node: A Secondary node as defined in TS 37.340 [31].\nSecondary RAT: RAT of the secondary RAN node.\nSNPN-enabled UE: A UE configured to use stand-alone Non-Public Networks.\nSNPN access mode: A UE operating in SNPN access mode only selects stand-alone Non-Public Networks over Uu, Yt, NWu.\nNOTE 5:\tIf there are multiple instances of Uu/Yt/NWu, whether the UE is in SNPN access mode is determined for each instance independently. NWu can be either direct access via untrusted non-3GPP access or access via underlay network (see Annex D, clause D.3).\nService based interface: It represents how a set of services is provided/exposed by a given NF.\nService Continuity: The uninterrupted user experience of a service, including the cases where the IP address and/or anchoring point change.\nService Data Flow Filter: A set of packet flow header parameter values/ranges used to identify one or more of the (IP or Ethernet) packet flows constituting a Service Data Flow.\nService Data Flow Template: The set of Service Data Flow filters in a policy rule or an application identifier in a policy rule referring to an application detection filter, required for defining a Service Data Flow.\nSession Continuity: The continuity of a PDU Session. For PDU Session of IPv4 or IPv6 or IPv4v6 type \"session continuity\" implies that the IP address is preserved for the lifetime of the PDU Session.\nSMF Service Area: The collection of UPF Service Areas of all UPFs which can be controlled by one SMF.\nSNPN ID: PLMN ID and NID identifying an SNPN.\nStand-alone Non-Public Network: A non-public network not relying on network functions provided by a PLMN\nSubscribed S-NSSAI: S-NSSAI based on subscriber information, which a UE is subscribed to use in a PLMN\nSubscription Owner Standalone Non-Public Network: A Standalone Non-Public Network owning the subscription of a UE and providing subscription data to the UE via a Provisioning Server during the onboarding procedure.\nSurvival Time: The time that an application consuming a communication service may continue without an anticipated message.\nNOTE 6:\tTaken from clause 3.1 of TS 22.261 [2].\nTarget NSSAI: NSSAI provided by the Serving PLMN to the NG-RAN to cause the NG-RAN to attempt to steer the UE to a cell supporting the Network Slices identified by the S-NSSAIs in this NSSAI. See clause 5.3.4.3.3 for more details.\nTime Sensitive Communication (TSC): A communication service that supports deterministic communication (i.e. which ensures a maximum delay) and/or isochronous communication with high reliability and availability. It is about providing packet transport with QoS characteristics such as bounds on latency, loss, and reliability, where end systems and relay/transmit nodes may or may not be strictly synchronized.\nTSN working domain: Synchronization domain for a localized set of devices collaborating on a specific task or work function in a TSN network, corresponding to a gPTP domain defined in IEEE 802.1AS [104].\nUDM Group ID: This refers to one or more UDM instances managing a specific set of SUPIs. An UDM Group consists of one or multiple UDM Sets.\nUDR Group ID: This refers to one or more UDR instances managing a specific set of SUPIs. An UDR Group consists of one or multiple UDR Sets.\nUE-DS-TT Residence Time: The time taken within the UE and DS-TT to forward a packet, i.e. between the ingress of the UE and the DS-TT port in the DL direction, or between the DS-TT port and the egress of the UE in the UL direction. UE-DS-TT Residence Time is provided at the time of PDU Session Establishment by the UE to the network.\nNOTE 7:\tUE-DS-TT Residence Time is the same for uplink and downlink traffic and applies to all QoS Flows.\nUPF Service Area: An area consisting of one or more TA(s) within which PDU Session associated with the UPF can be served by (R)AN nodes via a N3 interface between the (R)AN and the UPF without need to add a new UPF in between or to remove/re-allocate the UPF.\nUplink Classifier: UPF functionality that aims at diverting Uplink traffic, based on filter rules provided by SMF, towards Data Network.\nWB-E-UTRA: In the RAN, WB-E-UTRA is the part of E-UTRA that excludes NB-IoT. In the Core Network, WB-E-UTRA also excludes LTE-M.\nWireline 5G Access Network: The Wireline 5G Access Network (W-5GAN) is a wireline AN that connects to a 5GC via N2 and N3 reference points. The W-5GAN can be either a W-5GBAN or W-5GCAN.\nWireline 5G Cable Access Network: The Wireline 5G Cable Access Network (W-5GCAN) is the Access Network defined in CableLabs.\nWireline BBF Access Network: The Wireline 5G BBF Access Network (W-5GBAN) is the Access Network defined in BBF.\nWireline Access Gateway Function (W-AGF): The Wireline Access Gateway Function (W-AGF) is a Network function in W-5GAN that provides connectivity to the 5G Core to 5G-RG and FN-RG.\nNOTE 8:\tIf one AUSF/PCF/UDR/UDM group consists of multiple AUSF/PCF/UDR/UDM Sets, AUSF/PCF/UDR/UDM instance from different Set may be selected to serve the same UE. The temporary data which is not shared across different Sets may be lost, e.g. the event subscriptions stored at one UDM instance are lost if another UDM instance from different Set is selected and no data shared across the UDM Sets.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\n5GC\t5G Core Network\n5G DDNMF\t5G Direct Discovery Name Management Function\n5G LAN\t5G Local Area Network\n5GS\t5G System\n5G-AN\t5G Access Network\n5G-AN PDB\t5G Access Network Packet Delay Budget\n5G-EIR\t5G-Equipment Identity Register\n5G-GUTI\t5G Globally Unique Temporary Identifier\n5G-BRG\t5G Broadband Residential Gateway\n5G-CRG\t5G Cable Residential Gateway\n5G GM\t5G Grand Master\n5G NSWO\t5G Non-Seamless WLAN offload\n5G-RG\t5G Residential Gateway\n5G-S-TMSI\t5G S-Temporary Mobile Subscription Identifier\n5G VN\t5G Virtual Network\n5QI\t5G QoS Identifier\nADRF\tAnalytics Data Repository Function\nAF\tApplication Function\nAI/ML\tArtificial Intelligence/Machine Learning\nAKMA\tAuthentication and Key Management for Applications\nAnLF\tAnalytics Logical Function\nAMF\tAccess and Mobility Management Function\nAoI\tArea of Interest\nAS\tAccess Stratum\nATSSS\tAccess Traffic Steering, Switching, Splitting\nATSSS-LL\tATSSS Low-Layer\nAUSF\tAuthentication Server Function\nBMCA\tBest Master Clock Algorithm\nBSF\tBinding Support Function\nCAG\tClosed Access Group\nCAPIF\tCommon API Framework for 3GPP northbound APIs\nCH\tCredentials Holder\nCHF\tCharging Function\nCN PDB\tCore Network Packet Delay Budget\nCP\tControl Plane\nCQRCI\tClock Quality Reporting Control Information\nDAPS\tDual Active Protocol Stacks\nDCCF\tData Collection Coordination Function\nDCS\tDefault Credentials Server\nDetNet\tDeterministic Networking\nDL\tDownlink\nDN\tData Network\nDNAI\tDN Access Identifier\nDNN\tData Network Name\nDRX\tDiscontinuous Reception\nDS-TT\tDevice-side TSN translator\nEAC\tEarly Admission Control\nePDG\tevolved Packet Data Gateway\nEBI\tEPS Bearer Identity\nEUI\tExtended Unique Identifier\nFAR\tForwarding Action Rule\nFL\tFederated Learning\nFN-BRG\tFixed Network Broadband RG\nFN-CRG\tFixed Network Cable RG\nFN-RG\tFixed Network RG\nFQDN\tFully Qualified Domain Name\nGBA\tGeneric Bootstrapping Architecture\nGEO\tGeostationary Orbit\nGFBR\tGuaranteed Flow Bit Rate\nGIN\tGroup ID for Network Selection\nGMLC\tGateway Mobile Location Centre\nGPSI\tGeneric Public Subscription Identifier\nGUAMI\tGlobally Unique AMF Identifier\nHMTC\tHigh-Performance Machine-Type Communications\nHR\tHome Routed (roaming)\nIAB\tIntegrated access and backhaul\nIMEI/TAC\tIMEI Type Allocation Code\nIPUPS\tInter PLMN UP Security\nI-SMF\tIntermediate SMF\nI-UPF\tIntermediate UPF\nLADN\tLocal Area Data Network\nLBO\tLocal Break Out (roaming)\nLEO\tLow Earth Orbit\nLMF\tLocation Management Function\nLoA\tLevel of Automation\nLPP\tLTE Positioning Protocol\nLRF\tLocation Retrieval Function\nL4S\tLow Latency, Low Loss and Scalable Throughput\nMBS\tMulticast/Broadcast Service\nMBSF\tMulticast/Broadcast Service Function\nMBSR\tMobile Base Station Relay\nMBSTF\tMulticast/Broadcast Service Transport Function\nMB-SMF\tMulticast/Broadcast Session Management Function\nMB-UPF\tMulticast/Broadcast User Plane Function\nMEO\tMedium Earth Orbit\nMFAF\tMessaging Framework Adaptor Function\nMCX\tMission Critical Service\nMDBV\tMaximum Data Burst Volume\nMFBR\tMaximum Flow Bit Rate\nMICO\tMobile Initiated Connection Only\nMINT\tMinimization of Service Interruption\nML\tMachine Learning\nMPQUIC\tMulti-Path QUIC\nMPS\tMultimedia Priority Service\nMPTCP\tMulti-Path TCP Protocol\nMTLF\tModel Training Logical Function\nN3IWF\tNon-3GPP InterWorking Function\nN3QAI\t\tNon-3GPP QoS Assistance Information\nN5CW\tNon-5G-Capable over WLAN\nNAI\tNetwork Access Identifier\nNEF\tNetwork Exposure Function\nNF\tNetwork Function\nNGAP\tNext Generation Application Protocol\nNID\tNetwork identifier\nNPN\tNon-Public Network\nNR\tNew Radio\nNRF\tNetwork Repository Function\nNS-AoS\tNetwork Slice Area of Service\nNSAC\tNetwork Slice Admission Control\nNSACF\tNetwork Slice Admission Control Function\nNSAG\tNetwork Slice AS Group\nNSI ID\tNetwork Slice Instance Identifier\nNSSAA\tNetwork Slice-Specific Authentication and Authorization\nNSSAAF\tNetwork Slice-specific and SNPN Authentication and Authorization Function\nNSSAI\tNetwork Slice Selection Assistance Information\nNSSF\tNetwork Slice Selection Function\nNSSP\tNetwork Slice Selection Policy\nNSSRG\tNetwork Slice Simultaneous Registration Group\nNSWO\tNon-Seamless WLAN offload\nNSWOF\tNon-Seamless WLAN offload Function\nNW-TT\tNetwork-side TSN translator\nNWDAF\tNetwork Data Analytics Function\nONN\tOnboarding Network\nON-SNPN\tOnboarding Standalone Non-Public Network\nPCF\tPolicy Control Function\nPDB\tPacket Delay Budget\nPDR\tPacket Detection Rule\nPDU\tProtocol Data Unit\nPDV\tPacket Delay Variation\nPEGC\tPIN Element with Gateway Capability\nPEI\tPermanent Equipment Identifier\nPEMC\tPIN Element with Management Capability\nPER\tPacket Error Rate\nPFD\tPacket Flow Description\nPIN\tPersonal IoT Network\nPINE\tPIN Element\nPLR\tPacket Loss Rate\nPNI-NPN\tPublic Network Integrated Non-Public Network\nPPD\tPaging Policy Differentiation\nPPF\tPaging Proceed Flag\nPPI\tPaging Policy Indicator\nPSA\tPDU Session Anchor\nPSDB\tPDU Set Delay Budget\nPSER\tPDU Set Error Rate\nPSIHI\tPDU Set Integrated Handling Information\nPTP\tPrecision Time Protocol\nPVS\tProvisioning Server\nQFI\tQoS Flow Identifier\nQoE\tQuality of Experience\nRACS\tRadio Capabilities Signalling optimisation\n(R)AN\t(Radio) Access Network\nRG\tResidential Gateway\nRIM\tRemote Interference Management\nRQA\tReflective QoS Attribute\nRQI\tReflective QoS Indication\nRSN\tRedundancy Sequence Number\nRTT\tRound Trip Time\nSA NR\tStandalone New Radio\nSBA\tService Based Architecture\nSBI\tService Based Interface\nSCP\tService Communication Proxy\nSD\tSlice Differentiator\nSEAF\tSecurity Anchor Functionality\nSEPP\tSecurity Edge Protection Proxy\nSF\tService Function\nSFC\tService Function Chain\nSMF\tSession Management Function\nSMSF\tShort Message Service Function\nSN\tSequence Number\nSNPN\tStand-alone Non-Public Network\nS-NSSAI\tSingle Network Slice Selection Assistance Information\nSO-SNPN\tSubscription Owner Standalone Non-Public Network\nSSC\tSession and Service Continuity\nSSCMSP\tSession and Service Continuity Mode Selection Policy\nSST\tSlice/Service Type\nSUCI\tSubscription Concealed Identifier\nSUPI\tSubscription Permanent Identifier\nSV\tSoftware Version\nTA\tTracking Area\nTAI\tTracking Area Identity\nTNAN\tTrusted Non-3GPP Access Network\nTNAP\tTrusted Non-3GPP Access Point\nTNGF\tTrusted Non-3GPP Gateway Function\nTNL\tTransport Network Layer\nTNLA\tTransport Network Layer Association\nTSC\tTime Sensitive Communication\nTSCAI\tTSC Assistance Information\nTSCTSF\tTime Sensitive Communication and Time Synchronization Function\nTSN\tTime Sensitive Networking\nTSN GM\tTSN Grand Master\nTSP\tTraffic Steering Policy\nTSS\tTiming Synchronization Status\nTT\tTSN Translator\nTWIF\tTrusted WLAN Interworking Function\nUAS NF\tUncrewed Aerial System Network Function\nUCMF\tUE radio Capability Management Function\nUDM\tUnified Data Management\nUDR\tUnified Data Repository\nUDSF\tUnstructured Data Storage Function\nUL\tUplink\nUL CL\tUplink Classifier\nUPF\tUser Plane Function\nURLLC\tUltra Reliable Low Latency Communication\nURRP-AMF\tUE Reachability Request Parameter for AMF\nURSP\tUE Route Selection Policy\nVID\tVLAN Identifier\nVLAN\tVirtual Local Area Network\nW-5GAN\tWireline 5G Access Network\nW-5GBAN\tWireline BBF Access Network\nW-5GCAN\tWireline 5G Cable Access Network\nW-AGF\tWireline Access Gateway Function\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tArchitecture model and concepts",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tGeneral concepts",
                    "description": "",
                    "summary": "",
                    "text_content": "The 5G System architecture is defined to support data connectivity and services enabling deployments to use techniques such as e.g. Network Function Virtualization and Software Defined Networking. The 5G System architecture shall leverage service-based interactions between Control Plane (CP) Network Functions where identified. Some key principles and concept are to:\n-\tSeparate the User Plane (UP) functions from the Control Plane (CP) functions, allowing independent scalability, evolution and flexible deployments e.g. centralized location or distributed (remote) location.\n-\tModularize the function design, e.g. to enable flexible and efficient network slicing.\n-\tWherever applicable, define procedures (i.e. the set of interactions between network functions) as services, so that their re-use is possible.\n-\tEnable each Network Function and its Network Function Services to interact with other NF and its Network Function Services directly or indirectly via a Service Communication Proxy if required. The architecture does not preclude the use of another intermediate function to help route Control Plane messages (e.g. like a DRA).\n-\tMinimize dependencies between the Access Network (AN) and the Core Network (CN). The architecture is defined with a converged core network with a common AN - CN interface which integrates different Access Types e.g. 3GPP access and non-3GPP access.\n-\tSupport a unified authentication framework.\n-\tSupport \"stateless\" NFs, where the \"compute\" resource is decoupled from the \"storage\" resource.\n-\tSupport capability exposure.\n-\tSupport concurrent access to local and centralized services. To support low latency services and local access to data networks, UP functions can be deployed close to the Access Network.\n-\tSupport roaming with both Home routed traffic as well as Local breakout traffic in the visited PLMN.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tArchitecture reference model",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral",
                            "text_content": "This specification describes the architecture for the 5G System. The 5G architecture is defined as service-based and the interaction between network functions is represented in two ways.\n-\tA service-based representation, where network functions (e.g. AMF) within the Control Plane enables other authorized network functions to access their services. This representation also includes point-to-point reference points where necessary.\n-\tA reference point representation, shows the interaction exist between the NF services in the network functions described by point-to-point reference point (e.g. N11) between any two network functions (e.g. AMF and SMF).\nService-based interfaces are listed in clause 4.2.6. Reference points are listed in clause 4.2.7.\nNetwork functions within the 5GC Control Plane shall only use service-based interfaces for their interactions.\nNOTE 1:\tThe interactions between NF services within one NF are not specified in this Release of the specification.\nNFs and NF services can communicate directly, referred to as Direct Communication, or indirectly via the SCP, referred to as Indirect Communication. For more information on communication options, see Annex E and clauses under 6.3.1 and 7.1.2.\nIn addition to the architecture descriptions in clause 4, the following areas are further described in other specifications:\n-\tNG-RAN architecture is described in TS 38.300 [27] and TS 38.401 [42].\n-\tSecurity architecture is described in TS 33.501 [29] and TS 33.535 [124].\n-\tCharging architecture is described in TS 32.240 [41].\n-\t5G Media streaming architecture is described in TS 26.501 [135].\nNOTE 3:\tThe NFs listed in clause 4.2.2 are described in the following clauses or in the specifications above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tNetwork Functions and entities",
                            "text_content": "The 5G System architecture consists of the following network functions (NF):\n-\tAuthentication Server Function (AUSF).\n-\tAccess and Mobility Management Function (AMF).\n-\tData Network (DN), e.g. operator services, Internet access or 3rd party services.\n-\tUnstructured Data Storage Function (UDSF).\n-\tNetwork Exposure Function (NEF).\n-\tNetwork Repository Function (NRF).\n-\tNetwork Slice Admission Control Function (NSACF).\n-\tNetwork Slice-specific and SNPN Authentication and Authorization Function (NSSAAF).\n-\tNetwork Slice Selection Function (NSSF).\n-\tPolicy Control Function (PCF).\n-\tSession Management Function (SMF).\n-\tUnified Data Management (UDM).\n-\tUnified Data Repository (UDR).\n-\tUser Plane Function (UPF).\n-\tUE radio Capability Management Function (UCMF).\n-\tApplication Function (AF).\n-\tUser Equipment (UE).\n-\t(Radio) Access Network ((R)AN).\n-\t5G-Equipment Identity Register (5G-EIR).\n-\tNetwork Data Analytics Function (NWDAF).\n-\tCHarging Function (CHF).\n-\tTime Sensitive Networking AF (TSN AF).\n-\tTime Sensitive Communication and Time Synchronization Function (TSCTSF).\n-\tData Collection Coordination Function (DCCF).\n-\tAnalytics Data Repository Function (ADRF).\n-\tMessaging Framework Adaptor Function (MFAF).\n-\tNon-Seamless WLAN Offload Function (NSWOF).\nNOTE:\tThe functionalities provided by DCCF and/or ADRF can also be hosted by an NWDAF.\n-\tEdge Application Server Discovery Function (EASDF).\nThe 5G System architecture also comprises the following network entities:\n-\tService Communication Proxy (SCP).\n-\tSecurity Edge Protection Proxy (SEPP).\nThe functional descriptions of these Network Functions and entities are specified in clause 6.\n-\tNon-3GPP InterWorking Function (N3IWF).\n-\tTrusted Non-3GPP Gateway Function (TNGF).\n-\tWireline Access Gateway Function (W-AGF).\n-\tTrusted WLAN Interworking Function (TWIF).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tNon-roaming reference architecture",
                            "text_content": "Figure 4.2.3-1 depicts the non-roaming reference architecture. Service-based interfaces are used within the Control Plane.\nThe figure depicts a non-roaming 5G system architecture, illustrating the various components and their interconnections. It includes non-reactive elements such as non-reactive elements, non-reactive elements, and non-reactive elements, as well as reactive elements like reactive elements, reactive elements, and reactive elements. The figure also shows the use of non-reactive elements, such as non-reactive elements, non-reactive elements, and non-reactive elements, to mitigate interference and ensure reliable communication.\nFigure 4.2.3-1: Non-Roaming 5G System Architecture\nNOTE:\tIf an SCP is deployed it can be used for indirect communication between NFs and NF services as described in Annex E. SCP does not expose services itself.\nFigure 4.2.3-2 depicts the 5G System architecture in the non-roaming case, using the reference point representation showing how various network functions interact with each other.\nThe figure depicts a non-roaming 5G system architecture, illustrating the various components and their interconnections. It includes non-reactive elements such as non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-reactive elements, non-\nFigure 4.2.3-2: Non-Roaming 5G System Architecture in reference point representation\nNOTE 1:\tN9, N14 are not shown in all other figures however they may also be applicable for other scenarios.\nNOTE 2:\tFor the sake of clarity of the point-to-point diagrams, the UDSF, NEF and NRF have not been depicted. However, all depicted Network Functions can interact with the UDSF, UDR, NEF and NRF as necessary.\nNOTE 3:\tThe UDM uses subscription data and authentication data and the PCF uses policy data that may be stored in UDR (refer to clause 4.2.5).\nNOTE 4:\tFor clarity, the UDR and its connections with other NFs, e.g. PCF, are not depicted in the point-to-point and service-based architecture diagrams. For more information on data storage architectures refer to clause 4.2.5.\nNOTE 5:\tFor clarity, the NWDAF(s), DCCF, MFAF and ADRF and their connections with other NFs, are not depicted in the point-to-point and service-based architecture diagrams. For more information on network data analytics architecture refer to TS 23.288 [86].\nNOTE 6:\tFor clarity, the 5G DDNMF and its connections with other NFs, e.g. UDM, PCF are not depicted in the point-to-point and service-based architecture diagrams. For more information on ProSe architecture refer to TS 23.304 [128].\nNOTE 7:\tFor clarity, the TSCTSF and its connections with other NFs, e.g. PCF, NEF, UDR are not depicted in the point-to-point and service-based architecture diagrams. For more information on TSC architecture refer to clause 4.4.8.\nNOTE 8:\tFor exposure of the QoS monitoring information as specified in clause 5.8.2.18, exposure of data collected for analytics as specified in clause 5.2.26.2 of TS 23.502 [3], and exposure of the TSC management information as specified in clause 5.8.5.14, direct interaction between UPF and NFs can be supported via the Nupf interface (see clause 4.2.16).\nNOTE 9:\tFor clarity, the EASDF and its connections with SMF is not depicted in the point-to-point and service-based architecture diagrams. For more information on edge computing architecture refer to TS 23.548 [130].\nFigure 4.2.3-3 depicts the non-roaming architecture for UEs concurrently accessing two (e.g. local and central) data networks using multiple PDU Sessions, using the reference point representation. This figure shows the architecture for multiple PDU Sessions where two SMFs are selected for the two different PDU Sessions. However, each SMF may also have the capability to control both a local and a central UPF within a PDU Session.\nThe figure depicts a 5G system architecture for multiple point-to-point (PDU) sessions, with reference point representation. It illustrates the use of non-orthogonal multiple access (NOMA) techniques to enhance network capacity and reliability. The figure includes key components such as base stations (BTS), user equipment (UE), and point-to-point (P2P) sessions, as well as reference points (RP) and point-to-multipoint (P2MP) sessions. The architecture is designed to support high-speed data transmission and ensure seamless connectivity for various applications.\nFigure 4.2.3-3: Applying Non-Roaming 5G System Architecture for multiple PDU Session in reference point representation\nFigure 4.2.3-4 depicts the non-roaming architecture in the case of concurrent access to two (e.g. local and central) data networks is provided within a single PDU Session, using the reference point representation.\nThe figure depicts a 5G system architecture for concurrent access to two data networks, with a reference point representation. It illustrates the use of N on-R oaming (NR) technology, which enables simultaneous access to two data networks. The figure also includes a single PDU Session option, allowing for concurrent access to two data networks.\nFigure 4.2.3-4: Applying Non-Roaming 5G System Architecture for concurrent access to two (e.g. local and central) data networks (single PDU Session option) in reference point representation\nFigure 4.2.3-5 depicts the non-roaming architecture for Network Exposure Function, using reference point representation.\nThe figure depicts a non-rotating architecture for Network Exposure Function in reference point representation, illustrating the various components and their interactions.\nFigure 4.2.3-5: Non-Roaming Architecture for Network Exposure Function in reference point representation\nNOTE 1:\tIn Figure 4.2.3-5, Trust domain for NEF is same as Trust domain for SCEF as defined in TS 23.682 [36].\nNOTE 2:\tIn Figure 4.2.3-5, 3GPP Interface represents southbound interfaces between NEF and 5GC Network Functions e.g. N29 interface between NEF and SMF, N30 interface between NEF and PCF, etc. All southbound interfaces from NEF are not shown for the sake of simplicity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tRoaming reference architectures",
                            "text_content": "Figure 4.2.4-1 depicts the 5G System roaming architecture with local breakout with service-based interfaces within the Control Plane.\nThe figure depicts a 5G roaming system architecture, illustrating the local breakout scenario in a service-based interface representation. It shows the various components involved in the roaming process, including the base station (gNB), user equipment (UE), and the network slicing (NS). The figure highlights the importance of network slicing in enabling efficient roaming and ensuring seamless communication between different network slices.\nFigure 4.2.4-1: Roaming 5G System architecture- local breakout scenario in service-based interface representation\nNOTE 1:\tIn the LBO architecture. the PCF in the VPLMN may interact with the AF in order to generate PCC Rules for services delivered via the VPLMN, the PCF in the VPLMN uses locally configured policies according to the roaming agreement with the HPLMN operator as input for PCC Rule generation, the PCF in VPLMN has no access to subscriber policy information from the HPLMN.\nNOTE 2:\tAn SCP can be used for indirect communication between NFs and NF services within the VPLMN, within the HPLMN, or in within both VPLMN and HPLMN. For simplicity, the SCP is not shown in the roaming architecture.\nNOTE 3:\tFor clarity, the NWDAF(s) with roaming exchange capability (RE-NWDAF) and their connections with other NFs, are not depicted in the service-based architecture diagram. For more information on network data analytics architecture refer to TS 23.288 [86].\nNOTE 4:\tDepending on the architecture deployed, the Primary or Centralized NSACF at the VPLMN can fetch the maximum number of registered UEs or the maximum number of LBO PDU sessions to be enforced from the HPLMN Primary or Centralized NSACF as described in clause 5.15.11.3.1.\n\nFigure 4.2.4-2: Void\nFigure 4.2.4-3 depicts the 5G System roaming architecture in the case of home routed scenario with service-based interfaces within the Control Plane.\nThe figure depicts a 5G roaming system architecture, specifically focusing on the home-roaming scenario. It illustrates the various components and their interactions, such as the home gateway, mobile network, and the service provider's network. The figure highlights the importance of network slicing and network slicing services, as well as the use of network slicing services to provide differentiated services to users.\nFigure 4.2.4-3: Roaming 5G System architecture - home routed scenario in service-based interface representation\nNOTE 4:\tAn SCP can be used for indirect communication between NFs and NF services within the VPLMN, within the HPLMN, or in within both VPLMN and HPLMN. For simplicity, the SCP is not shown in the roaming architecture.\nNOTE 5:\tUPFs in the home routed scenario can be used also to support the IPUPS functionality (see clause 5.8.2.14).\nNOTE 6:\tFor clarity, the NWDAF(s) with roaming exchange capability (RE-NWDAF) and their connections with other NFs, are not depicted in the service-based architecture diagram. For more information on network data analytics architecture refer to TS 23.288 [86].\nFigure 4.2.4-4 depicts 5G System roaming architecture in the case of local break out scenario using the reference point representation.\nThe figure depicts a 5G roaming system architecture, illustrating the local breakout scenario in reference point representation. It shows the various components involved, such as the base station (BS), mobile network (MN), and the user equipment (UE), as well as the various paths through which signals can be transmitted. The figure highlights the importance of beamforming techniques to mitigate interference and ensure reliable communication.\nFigure 4.2.4-4: Roaming 5G System architecture - local breakout scenario in reference point representation\nNOTE 7:\tThe NRF is not depicted in reference point architecture figures. Refer to Figure 4.2.4-7 for details on NRF and NF interfaces.\nNOTE 8:\tFor the sake of clarity, SEPPs are not depicted in the roaming reference point architecture figures.\nNOTE 9:\tFor clarity, the NWDAF(s) with roaming exchange capability (RE-NWDAF) and their connections with other NFs, are not depicted in the reference point architecture figure. For more information on network data analytics architecture refer to TS 23.288 [86].\nThe following figure 4.2.4-6 depicts the 5G System roaming architecture in the case of home routed scenario using the reference point representation.\nThe figure depicts a 5G roaming system architecture, specifically focusing on the home-roaming scenario. It illustrates the various components and their roles in the system, such as the base station (gNB), home gateway (HGW), and the home network (HAN). The figure highlights the importance of network slicing and network slicing policy in managing network resources and ensuring efficient use of network resources.\nFigure 4.2.4-6: Roaming 5G System architecture - Home routed scenario in reference point representation\nThe N38 references point can be between V-SMFs in the same VPLMN, or between V-SMFs in different VPLMNs (to enable inter-PLMN mobility).\nNOTE 10:\tFor clarity, the NWDAF(s) with roaming exchange capability (RE-NWDAF) and their connections with other NFs, are not depicted in the reference point architecture figure. For more information on network data analytics architecture refer to TS 23.288 [86].\nFor the roaming scenarios described above each PLMN implements proxy functionality to secure interconnection and hide topology on the inter-PLMN interfaces.\nThe figure depicts the NRF Roaming architecture in reference point representation, illustrating the various components and their interconnections. The figure includes a base station (BS), a mobile station (MS), a mobile network (MN), and a roaming network (RN). The BS and MS are connected by a network function virtualization (NFV) network, while the MN and RN are connected by a network virtualization (NV) network. The figure also includes a reference point (RP) and a reference point network (RPN). The RP is used to establish the reference point for the roaming network, while the RPN is used to establish the reference point for the roaming network. The figure provides a clear and concise representation of the NRF Roaming architecture, making it easy to understand and interpret.\nFigure 4.2.4-7: NRF Roaming architecture in reference point representation\nNOTE 11:\tFor the sake of clarity, SEPPs on both sides of PLMN borders are not depicted in figure 4.2.4-7.\nFigure 4.2.4-8: Void\nOperators can deploy UPFs supporting the Inter PLMN UP Security (IPUPS) functionality at the border of their network to protect their network from invalid inter PLMN N9 traffic in home routed roaming scenarios. The UPFs supporting the IPUPS functionality in VPLMN and HPLMN are controlled by the V-SMF and the H-SMF of that PDU Session respectively. A UPF supporting the IPUPS functionality terminates GTP-U N9 tunnels. The SMF can activate the IPUPS functionality together with other UP functionality in the same UPF, or insert a separate UPF for the IPUPS functionality in the UP path (which e.g. may be dedicated to be used for IPUPS functionality). Figure 4.2.4-9 depicts the home routed roaming architecture where a UPF is inserted in the UP path for the IPUPS functionality. Figure 4.2.4-3 depicts the home routed roaming architecture where the two UPFs perform the IPUPS functionality and other UP functionality for the PDU Session.\nNOTE 12:\tOperators are not prohibited from deploying the IPUPS functionality as a separate Network Function from the UPF, acting as a transparent proxy which can transparently read N4 and N9 interfaces. However, such deployment option is not specified and needs to take at least into account very long lasting PDU Sessions with infrequent traffic and Inter-PLMN handover.\nThe IPUPS functionality is specified in clause 5.8.2.14 and TS 33.501 [29].\nThe figure depicts a 5G roaming system architecture, specifically focusing on home-roaming scenarios. It illustrates the use of a service-based interface representation, where the UPF dedicated to IPUPS is used to facilitate roaming. The figure highlights the importance of network slicing and the use of dedicated paths for IPUPS, ensuring efficient and reliable roaming experiences for users.\nFigure 4.2.4-9: Roaming 5G System architecture - home routed roaming scenario in service-based interface representation employing UPF dedicated to IPUPS\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.5\tData Storage architectures",
                            "text_content": "As depicted in Figure 4.2.5-1, the 5G System architecture allows any NF to create/read/update/delete its unstructured data in a UDSF (e.g. UE contexts). If such an NF is using UDSF is part of an NF set, then any of the NF instance within this NF set may read/update/delete the unstructured data that was created by this NF. The UDSF belongs to the same PLMN where the network function is located. CP NFs/NF Sets may share a UDSF for storing their respective unstructured data or may each have their own UDSF (e.g. a UDSF may be located close to the respective NF).\nNOTE 1:\tStructured data in this specification refers to data for which the structure is defined in 3GPP specifications. Unstructured data refers to data for which the structure is not defined in 3GPP specifications.\nNOTE 2:\tIf a NF Set has its own UDSF, it is up to UDSF implementation and deployment that only the NF instance within the set can access the data created by another NF instance within the NF set. If a UDSF is shared between several NFs not part of the same set or is shared between several NF sets, it is up to UDSF implementation and deployment to make sure that only NFs that are authorized can access the data. For further information about Guidelines and Principles for Compute-Storage Separation see Annex C.\nThe figure depicts a data storage architecture for unstructured data from any NF, illustrating the various components and their interconnections.\nFigure 4.2.5-1: Data Storage Architecture for unstructured data from any NF\nNOTE 3:\t3GPP will specify (possibly by referencing) the N18/Nudsf interface.\nAs depicted in Figure 4.2.5-2, the 5G System architecture allows the UDM, PCF and NEF to store data in the UDR, including subscription data and policy data by UDM and PCF, structured data for exposure and application data (including Packet Flow Descriptions (PFDs) for application detection, AF request information for multiple UEs) by the NEF. UDR can be deployed in each PLMN and it can serve different functions as follows:\n-\tUDR accessed by the NEF belongs to the same PLMN where the NEF is located.\n-\tUDR accessed by the UDM belongs to the same PLMN where the UDM is located if UDM supports a split architecture.\n-\tUDR accessed by the PCF belongs to the same PLMN where the PCF is located.\nNOTE 4:\tThe UDR deployed in each PLMN can store application data for roaming subscribers.\nThe figure depicts a data storage architecture, specifically a 2.5-2-5-2 design, which is a common configuration for data storage systems. The architecture consists of two 2-bay servers, each with 2-bay storage, and two 5-bay servers, each with 2-bay storage. The servers are interconnected via a 2-bay switch, which provides redundancy and failover capabilities. The design is based on the principles of data storage architecture, with a focus on scalability, fault tolerance, and performance.\nFigure 4.2.5-2: Data Storage Architecture\nNOTE 5:\tThere can be multiple UDRs deployed in the network, each of which can accommodate different data sets or subsets, (e.g. subscription data, subscription policy data, data for exposure, application data) and/or serve different sets of NFs. Deployments where a UDR serves a single NF and stores its data, and, thus, can be integrated with this NF, can be possible.\nNOTE 6: The internal structure of the UDR in figure 4.2.5-2 is shown for information only.\nThe Nudr interface is defined for the network functions (i.e. NF Service Consumers), such as UDM, PCF and NEF, to access a particular set of the data stored and to read, update (including add, modify), delete, and subscribe to notification of relevant data changes in the UDR.\nEach NF Service Consumer accessing the UDR, via Nudr, shall be able to add, modify, update or delete only the data it is authorised to change. This authorisation shall be performed by the UDR on a per data set and NF service consumer basis and potentially on a per UE, subscription granularity.\nThe following data in the UDR sets exposed via Nudr to the respective NF service consumer and stored shall be standardized:\n-\tSubscription Data,\n-\tPolicy Data,\n-\tStructured Data for exposure,\n-\tApplication data: Packet Flow Descriptions (PFDs) for application detection and AF request information for multiple UEs, as defined in clause 5.6.7.\nThe service based Nudr interface defines the content and format/encoding of the 3GPP defined information elements exposed by the data sets.\nIn addition, it shall be possible to access operator specific data sets by the NF Service Consumers from the UDR as well as operator specific data for each data set.\nNOTE 7:\tThe content and format/encoding of operator specific data and operator specific data sets are not subject to standardization.\nNOTE 8:\tThe organization of the different data stored in the UDR is not to be standardized.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.5a\tRadio Capabilities Signalling optimisation",
                            "text_content": "Figure 4.2.5a-1 depicts the AMF to UCMF reference point and interface. Figure 4.2.5a-2 depicts the related interfaces in AMF and UCMF for the Radio Capabilities Signalling optimisation in the roaming architecture.\nThe figure depicts a radio capability signalling optimization architecture, illustrating the various components and their interconnections. It highlights the importance of radio frequency (RF) signal propagation in wireless communication systems, with emphasis on signal quality and interference management. The architecture includes base stations (BTS), radio frequency (RF) signal sources, and radio frequency (RF) signal receivers, all interconnected through radio frequency (RF) line terminals (RLTs). The figure also illustrates the use of radio frequency (RF) line terminals (RLTs) to improve signal quality and reduce interference.\nFigure 4.2.5a-1: Radio Capability Signalling optimisation architecture\nThe figure depicts a network architecture with a VPLMN (Virtual Private LAN Service) and a VPLMN NEF (Network Element Facility). The VPLMN NEF is responsible for provisioning radio capability IDs for Manufacturer Assigned UE radio capabilities in the VPLMN UCMF. RACS (Radio Access Control Service) is a feature that serves only the VPLMN, requiring no specific support in the roaming agreement with the UE HPLMN to operate.\nNOTE:\tThe AF in the VPLMN (i.e. the one having a relationship with the VPLMN NEF) is the one which provisions Manufacturer Assigned UE radio capability IDs in the VPLMN UCMF. RACS is a serving PLMN only feature (it requires no specific support in the roaming agreement with the UE HPLMN to operate).\n\nFigure 4.2.5a-2: Roaming architecture for Radio Capability Signalling optimisation\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.6\tService-based interfaces",
                            "text_content": "The 5G System Architecture contains the following service-based interfaces:\nNamf:\tService-based interface exhibited by AMF.\nNsmf:\tService-based interface exhibited by SMF.\nNnef:\tService-based interface exhibited by NEF.\nNpcf:\tService-based interface exhibited by PCF.\nNudm:\tService-based interface exhibited by UDM.\nNaf:\tService-based interface exhibited by AF.\nNnrf:\tService-based interface exhibited by NRF.\nNnsacf:\tService-based interface exhibited by NSACF.\nNnssaaf:\tService-based interface exhibited by NSSAAF.\nNnssf:\tService-based interface exhibited by NSSF.\nNausf:\tService-based interface exhibited by AUSF.\nNudr:\tService-based interface exhibited by UDR.\nNudsf:\tService-based interface exhibited by UDSF.\nN5g-eir:\tService-based interface exhibited by 5G-EIR.\nNnwdaf:\tService-based interface exhibited by NWDAF.\nNchf:\tService-based interface exhibited by CHF.\nNucmf:\tService-based interface exhibited by UCMF.\nNdccf:\tService based interface exhibited by DCCF.\nNmfaf:\tService based interface exhibited by MFAF.\nNadrf:\tService based interface exhibited by ADRF.\nNaanf:\tService-based interface exhibited by AANF.\nNOTE 1:\tThe Service-based interface exhibited by AANF is defined in TS 33.535 [124].\nN5g-ddnmf:\tService-based interface exhibited by 5G DDNMF.\nNmbsmf:\tService-based interface exhibited by MB-SMF.\nNmbsf:\tService-based interface exhibited by MBSF.\nNOTE 2:\tThe Service-based interfaces exhibited by MB-SMF and MBSF are defined in TS 23.247 [129].\nNtsctsf:\tService-based interface exhibited by TSCTSF.\nNbsp:\tService-based interface exhibited by an SBI capable Boostrapping Server Function in GBA.\nNOTE 2:\tThe Service-based interfaces exhibited by an SBI capable Boostrapping Server Function are defined in TS 33.220 [140] and TS 33.223 [141].\nNeasdf:\tService-based interface exhibited by EASDF.\nNOTE 3:\tThe Service-based interfaces exhibited by EADSF is defined in TS 23.548 [130].\nNupf:\tService-based interface exhibited by UPF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.7\tReference points",
                            "text_content": "The 5G System Architecture contains the following reference points:\nN1:\tReference point between the UE and the AMF.\nN2:\tReference point between the (R)AN and the AMF.\nN3:\tReference point between the (R)AN and the UPF.\nN4:\tReference point between the SMF and the UPF.\nN6:\tReference point between the UPF and a Data Network.\nN9:\tReference point between two UPFs.\nThe following reference points show the interactions that exist between the NF services in the NFs. These reference points are realized by corresponding NF service-based interfaces and by specifying the identified consumer and producer NF service as well as their interaction in order to realize a particular system procedure.\nN5:\tReference point between the PCF and an AF or TSN AF.\nN7:\tReference point between the SMF and the PCF.\nN8:\tReference point between the UDM and the AMF.\nN10:\tReference point between the UDM and the SMF.\nN11:\tReference point between the AMF and the SMF.\nN12:\tReference point between AMF and AUSF.\nN13:\tReference point between the UDM and Authentication Server function the AUSF.\nN14:\tReference point between two AMFs.\nN15:\tReference point between the PCF and the AMF in the case of non-roaming scenario, PCF in the visited network and AMF in the case of roaming scenario.\nN16:\tReference point between two SMFs, (in roaming case between SMF in the visited network and the SMF in the home network).\nN16a:\tReference point between SMF and I-SMF.\nN17:\tReference point between AMF and 5G-EIR.\nN18:\tReference point between any NF and UDSF.\nN19:\tReference point between two PSA UPFs for 5G LAN-type service.\nN22:\tReference point between AMF and NSSF.\nN23:\tReference point between PCF and NWDAF.\nN24:\tReference point between the PCF in the visited network and the PCF in the home network.\nN27:\tReference point between NRF in the visited network and the NRF in the home network.\nN28:\tReference point between PCF and CHF.\nN29:\tReference point between NEF and SMF.\nN30:\tReference point between PCF and NEF.\nNOTE 1:\tThe functionality of N28 and N29 and N30 reference points are defined in TS 23.503 [45].\nN31:\tReference point between the NSSF in the visited network and the NSSF in the home network.\nNOTE 2:\tIn some cases, a couple of NFs may need to be associated with each other to serve a UE.\nN32:\tReference point between a SEPP in one PLMN or SNPN and a SEPP in another PLMN or SNPN; or between a SEPP in a SNPN and a SEPP in a CH/DCS, where the CH/DCS contains a UDM/AUSF.\nNOTE 3:\tThe functionality of N32 reference point is defined in TS 33.501 [29].\nN33:\tReference point between NEF and AF.\nN34:\tReference point between NSSF and NWDAF.\nN35:\tReference point between UDM and UDR.\nN36:\tReference point between PCF and UDR.\nN37:\tReference point between NEF and UDR.\nN38:\tReference point between I-SMFs and between V-SMFs.\nN40:\tReference point between SMF and the CHF.\nN41:\tReference point between AMF and CHF in HPLMN.\nN42:\tReference point between AMF and CHF in VPLMN.\nNOTE 4:\tThe functionality of N40, N41 and N42 reference points are defined in TS 32.240 [41].\nN43:\tReference point between PCFs.\nNOTE 5:\tThe functionality of N43 reference point is defined in TS 23.503 [45].\nNOTE 6:\tThe reference points from N44 up to and including N49 are reserved for allocation and definition in TS 32.240 [41].\nN50:\tReference point between AMF and the CBCF.\nN51:\tReference point between AMF and NEF.\nN52:\tReference point between NEF and UDM.\nN55:\tReference point between AMF and the UCMF.\nN56:\tReference point between NEF and the UCMF.\nN57:\tReference point between AF and the UCMF.\nNOTE 7:\tThe Public Warning System functionality of N50 reference point is defined in TS 23.041 [46].\nN58:\tReference point between AMF and the NSSAAF.\nN59:\tReference point between UDM and the NSSAAF.\nN60:\tReference point between AUSF and NSWOF.\nNOTE 8:\tThe functionality of N60 reference point is defined in TS 33.501 [29].\nN80:\tReference point between AMF and NSACF.\nN81:\tReference point between SMF and NSACF.\nN82:\tReference point between NSACF and NEF.\nN83:\tReference point between AUSF and NSSAAF.\nN84:\tReference point between TSCTSF and PCF.\nN85:\tReference point between TSCTSF and NEF.\nN86:\tReference point between TSCTSF and AF.\nN87:\tReference point between TSCTSF and UDM.\nN88:\tReference point between SMF and EASDF.\nN89:\tReference point between TSCTSF and AMF.\nN96:\tReference point between TSCTSF and NRF.\nN97:\tReference point between two NSACFs in different PLMNs.\nN99:\tReference point between two NSACFs within the same PLMN.\nNOTE 9:\tThe reference points from N90 up to and including N95 are reserved for allocation and definition in TS 23.503 [45].\nNOTE 10:\tThe reference points from N100 up to and including N109 are reserved for allocation and definition in TS 32.240 [41].\nThe reference points to support SMS over NAS are listed in clause 4.4.2.2.\nThe reference points to support Location Services are listed in TS 23.273 [87].\nThe reference points to support SBA in IMS (N5, N70 and N71) are described in TS 23.228 [15].\nThe reference points to support AKMA (N61, N62 and N63) are described in TS 33.535 [124].\nThe reference points to support 5G ProSe are described in TS 23.304 [128].\nThe reference points to support 5G multicast-broadcast services are described in TS 23.247 [129].\nThe reference points to Support Uncrewed Aerial Systems (UAS) connectivity, identification and tracking are described in TS 23.256 [136].\nThe reference points to support SBA in GBA and GBA push (N65, N66, N67 and N68) are described in TS 33.220 [140] and TS 33.223 [141].\nThe reference points to support SMS delivery using SBA are described in TS 23.540 [142].\nThe reference points to support Ranging based services and Sidelink Positioning are described in TS 23.586 [180].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.8\tSupport of non-3GPP access",
                            "text_content": "In this Release of the specification, the following types of non-3GPP access networks are defined:\n-\tUntrusted non-3GPP access networks;\n-\tTrusted non-3GPP access networks; and\n-\tWireline access networks.\nThe architecture to support Untrusted and Trusted non-3GPP access networks is defined in clause 4.2.8.2. The architecture to support Wireline access networks is defined in clause 4.2.8.2.4 and in TS 23.316 [84].\nThe 5G Core Network supports connectivity of UEs via non-3GPP access networks, e.g. WLAN access networks.\nOnly the support of non-3GPP access networks deployed outside the NG-RAN is described in this clause.\nThe 5G Core Network supports both untrusted non-3GPP access networks and trusted non-3GPP access networks (TNANs).\nAn untrusted non-3GPP access network shall be connected to the 5G Core Network via a Non-3GPP InterWorking Function (N3IWF), whereas a trusted non-3GPP access network shall be connected to the 5G Core Network via a Trusted Non-3GPP Gateway Function (TNGF). Both the N3IWF and the TNGF interface with the 5G Core Network CP and UP functions via the N2 and N3 interfaces, respectively.\nA non-3GPP access network may advertise the PLMNs or SNPNs for which it supports trusted connectivity and the type of supported trusted connectivity (e.g. \"5G connectivity\"). Therefore, the UEs can discover the non-3GPP access networks that can provide trusted connectivity to one or more PLMNs or SNPNs. This is further specified in clause 6.3.12 (Trusted Non-3GPP Access Network selection).\nThe UE decides to use trusted or untrusted non-3GPP access for connecting to a 5G PLMN or SNPNs by using procedures not specified in this document. Examples of such procedures are defined in clause 6.3.12.1.\nWhen the UE decides to use untrusted non-3GPP access to connect to a 5G Core Network in a PLMN:\n-\tthe UE first selects and connects with a non-3GPP access network; and then\n-\tthe UE selects a PLMN/SNPN and an N3IWF in this PLMN/SNPN. The PLMN/SNPN/N3IWF selection and the non-3GPP access network selection are independent. The N3IWF selection is defined in clause 6.3.6.\nWhen the UE decides to use trusted non-3GPP access to connect to a 5G Core Network in a PLMN:\n-\tthe UE first selects a PLMN/SNPN; and then\n-\tthe UE selects a non-3GPP access network (a TNAN) that supports trusted connectivity to the selected PLMN/SNPN. In this case, the non-3GPP access network selection is affected by the PLMN/SNPN selection.\nA UE that accesses the 5G Core Network over a non-3GPP access shall, after UE registration, support NAS signalling with 5G Core Network control-plane functions using the N1 reference point.\nWhen a UE is connected via a NG-RAN and via a non-3GPP access, multiple N1 instances shall exist for the UE i.e. there shall be one N1 instance over NG-RAN and one N1 instance over non-3GPP access.\nA UE simultaneously connected to the same 5G Core Network of a PLMN/SNPN over a 3GPP access and a non-3GPP access shall be served by a single AMF in this 5G Core Network.\nWhen a UE is connected to a 3GPP access of a PLMN, if the UE selects a N3IWF and the N3IWF is located in a PLMN different from the PLMN of the 3GPP access, e.g. in a different VPLMN or in the HPLMN, the UE is served separately by the two PLMNs. The UE is registered with two separate AMFs. PDU Sessions over the 3GPP access are served by V-SMFs different from the V-SMF serving the PDU Sessions over the non-3GPP access. The same can be true when the UE uses trusted non-3GPP access, i.e. the UE may select one PLMN for 3GPP access and a different PLMN for trusted non-3GPP access.\nNOTE:\tThe registrations with different PLMNs over different Access Types doesn't apply to UE registered for Disaster Roaming service as described in the clause 5.40.\nThe PLMN selection for the 3GPP access does not depend on the PLMN that is used for non-3GPP access. In other words, if a UE is registered with a PLMN over a non-3GPP access, the UE performs PLMN selection for the 3GPP access independently of this PLMN.\nA UE shall establish an IPsec tunnel with the N3IWF or with the TNGF in order to register with the 5G Core Network over non-3GPP access. Further details about the UE registration to 5G Core Network over untrusted non-3GPP access and over trusted non-3GPP access are described in clause 4.12.2 and in clause 4.12.2a of TS 23.502 [3], respectively.\nIt shall be possible to maintain the UE NAS signalling connection with the AMF over the non-3GPP access after all the PDU Sessions for the UE over that access have been released or handed over to 3GPP access.\nN1 NAS signalling over non-3GPP accesses shall be protected with the same security mechanism applied for N1 over a 3GPP access.\nUser plane QoS differentiation between UE and N3IWF is supported as described in clause 5.7 and clause 4.12.5 of TS 23.502 [3]. QoS differentiation between UE and TNGF is supported as described in clause 5.7 and clause 4.12a.5 of TS 23.502 [3].\nWireline 5G Access Network (W-5GAN) shall be connected to the 5G Core Network via a Wireline Access Gateway Function (W-AGF). The W-AGF interfaces the 5G Core Network CP and UP functions via N2 and N3 interfaces, respectively.\nFor the scenario of 5G-RG connected via NG RAN the specification for UE defined in this TS, TS 23.502 [3] and TS 23.503 [45] are applicable as defined for UE connected to 5GC via NG RAN unless differently specified in this TS and in TS 23.316 [84].\nWhen a 5G-RG is connected via a NG-RAN and via a W-5GAN, multiple N1 instances shall exist for the 5G-RG i.e. there shall be one N1 instance over NG-RAN and one N1 instance over W-5GAN.\nA 5G-RG simultaneously connected to the same 5G Core Network of a PLMN over a 3GPP access and a W-5GAN access shall be served by a single AMF in this 5G Core Network.\n5G-RG shall maintain the NAS signalling connection with the AMF over the W-5GAN after all the PDU Sessions for the 5G-RG over that access have been released or handed over to 3GPP access.\nThe 5G-RG connected to 5GC via NG-RAN is specified in TS 23.316 [84].\nFor the scenario of FN-RG, which is not 5G capable, connected via W-5GAN to 5GC, the W-AGF provides the N1 interface to AMF on behalf of the FN-RG.\nAn UE connected to a 5G-RG or FN-RG can access to the 5GC via the N3IWF or via the TNGF where the combination of 5G-RG/FN-RG, W-AGF and UPF serving the 5G-RG or FN-RG is acting respectively as Untrusted Non-3GPP access network or as a Trusted Non-3GPP access network defined in clause 4.2.8.2; for example a UE is connecting to 5G-RG by means of WLAN radio access and connected to 5GC via N3IWF. The detailed description is specified in TS 23.316 [84].\nThe roaming architecture for 5G-BRG, FN-BRG, 5G-CRG and FN-CRG with the W-5GAN is not specified in this Release. The Home Routed roaming scenario is supported for 5G-RG connected via NG RAN, while Local Breakout scenario is not supported.\n5G Multi-Operator Core Network (5G MOCN) is supported for 5G-RG connected via NG RAN as defined in clause 5.18\nThe figure depicts a non-rotating architecture for a 5G core network with untrusted access, illustrating the use of non-orthogonal multiple access (NOMA) techniques to enhance network capacity and reliability.\nFigure 4.2.8.2.1-1: Non-roaming architecture for 5G Core Network with untrusted non-3GPP access\nThe figure depicts a non-roaming architecture for the 5G Core Network, highlighting the use of non-3GPP access for trusted non-roaming services. The architecture includes non-roaming core switches, optical line terminals (OLTs), and distributed nodes, with redundancy paths to ensure failover reliability. The layered design aligns with SDN principles.\nFigure 4.2.8.2.1-2: Non-roaming architecture for 5G Core Network with trusted non-3GPP access\nNOTE 1:\tThe reference architecture in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 only shows the architecture and the network functions directly connected to non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.\nNOTE 2:\tThe reference architecture in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 supports service based interfaces for AMF, SMF and other NFs not represented in the figure.\nNOTE 3:\tThe two N2 instances in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 terminate to a single AMF for a UE which is simultaneously connected to the same 5G Core Network over 3GPP access and non-3GPP access.\nNOTE 4\tThe two N3 instances in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 may terminate to different UPFs when different PDU Sessions are established over 3GPP access and non-3GPP access.\nThe figure depicts a 5G Core Network architecture with untrusted 3GPP access in the same VPLMN as 3GPP access, illustrating the use of LBO Roaming for enhanced network performance and security.\nFigure 4.2.8.2.2-1: LBO Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF in the same VPLMN as 3GPP access\nThe figure depicts the LBO Roaming architecture for 5G Core Network, showcasing the various components and their interconnections. It highlights the use of untrusted non-3GPP access in a different PLMN (Public Land Mobile Network) from 3GPP access. The architecture is designed to ensure reliable and efficient roaming for 5G Core Network services.\nFigure 4.2.8.2.2-2: LBO Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF in a different PLMN from 3GPP access\nThe figure depicts the LBO Roaming architecture for 5G Core Network, which utilizes the same VPLMN as 3GPP access. It illustrates the non-3GPP access using trusted non-3GPP access, ensuring reliable roaming for 5G Core Network.\nFigure 4.2.8.2.2-3: LBO Roaming architecture for 5G Core Network with trusted non-3GPP access using the same VPLMN as 3GPP access\nThe figure depicts the LBO Roaming architecture for 5G Core Network, which is a trusted non-3GPP access method using a different PLMN than 3GPP access. The architecture includes non-3GPP access points (N-APs) and a roaming service provider (RSP) that provides roaming services to 5G Core Network users. The figure illustrates the different access methods and the role of the RSP in providing roaming services.\nFigure 4.2.8.2.2-4: LBO Roaming architecture for 5G Core Network with trusted non-3GPP access using a different PLMN than 3GPP access\nNOTE 1:\tThe reference architecture in all above figures only shows the architecture and the network functions directly connected to support non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.\nNOTE 2:\tThe reference architecture in all above figures supports service based interfaces for AMF, SMF and other NFs not represented in the figures.\nNOTE 3:\tThe two N2 instances in Figure 4.2.8.2.2-1 and in Figure 4.2.8.2.2-3 terminate to a single AMF for a UE which is connected to the same 5G Core Network over 3GPP access and non-3GPP access simultaneously.\nNOTE 4:\tThe two N3 instances in Figure 4.2.8.2.2-1 and in Figure 4.2.8.2.2-3 may terminate to different UPFs when different PDU Sessions are established over 3GPP access and non-3GPP access.\nThe figure depicts a home-routed roaming architecture for 5G Core Network with untrusted access in the same VPLMN as 3GPP access, illustrating the use of VPLMNs for network virtualization and the integration of 3GPP access.\nFigure 4.2.8.2.3-1: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF in the same VPLMN as 3GPP access\nThe figure depicts a simplified architecture of a 5G core network with home-routed roaming, illustrating the different VPLMNs (Virtual Private LANs) and the use of untrusted non-3GPP access. The architecture includes a 5G core network, home-routed roaming, and a different VPLMN than 3GPP access.\nFigure 4.2.8.2.3-2: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF in a different VPLMN than 3GPP access\nThe figure depicts a simplified architecture of a 5G core network, highlighting the home-routed roaming architecture for untrusted non-3GPP access. It shows the network's core network, including 5G core network (N3IWF), home-routed roaming (HPLMN), and non-3GPP access (N3IWF). The figure illustrates the network's architecture, highlighting the use of home-routed roaming to provide a secure and reliable connection for users.\nFigure 4.2.8.2.3-3: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF in HPLMN\nThe figure depicts a simplified architecture of a 5G core network, highlighting the home-routed roaming architecture for 5G Core Network. It includes a trusted non-3GPP access VPLMN, which is used to ensure reliable and secure access to the network. The architecture is designed to be scalable and flexible, allowing for the addition of new access technologies as needed.\nFigure 4.2.8.2.3-4: Home-routed Roaming architecture for 5G Core Network with trusted non-3GPP access using the same VPLMN as 3GPP access\nNOTE 1:\tThe reference architecture in all above figures only shows the architecture and the network functions directly connected to support non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.\nNOTE 2:\tThe two N2 instances in Figure 4.2.8.2.3-1 and in Figure 4.2.8.2.3-4 terminate to a single AMF for a UE which is connected to the same 5G Core Network over 3GPP access and non-3GPP access simultaneously.\nThe description of the reference points specific for the non-3GPP access:\nN2, N3, N4, N6: these are defined in clause 4.2.\nY1\tReference point between the UE and the untrusted non-3GPP access (e.g. WLAN). This depends on the non-3GPP access technology and is outside the scope of 3GPP.\nY2\tReference point between the untrusted non-3GPP access and the N3IWF for the transport of NWu traffic.\nY4\tReference point between the 5G-RG and the W-AGF which transports the user plane traffic and the N1 NAS protocol. The definition of this interface is outside the scope of 3GPP.\nY5\tReference point between the FN-RG and the W-AGF. The definition of this interface is outside the scope of 3GPP.\nYt\tReference point between the UE and the TNAP. See e.g. Figure 4.2.8.2.1-2.\nYt'\tReference point between the N5CW devices and the TWAP. It is defined in clause 4.2.8.5.\nNWu\tReference point between the UE and N3IWF for establishing secure tunnel(s) between the UE and N3IWF so that control-plane and user-plane exchanged between the UE and the 5G Core Network is transferred securely over untrusted non-3GPP access.\nNWt\tReference point between the UE and the TNGF. A secure NWt connection is established over this reference point, as specified in clause 4.12a.2.2 of TS 23.502 [3]. NAS messages between the UE and the AMF are transferred via this NWt connection.\nTa\tA reference point between the TNAP and the TNGF, which is used to support an AAA interface. Ta requirements are documented in clause 4.2.8.3.2.\nTn\tA reference point between two TNGFs, which is used to facilitate UE mobility between different TNGFs (inter-TNGF mobility).\nTn and inter-TNGF mobility are not specified in this Release of the specification.\nTa shall be able to\n-\tCarry EAP-5G traffic and user location information before the NWt connection is established between the UE and the TNGF.\n-\tAllow the UE and the TNGF to exchange IP traffic.\nIn deployments where the TNAP does not allocate the local IP addresses to UE(s), Ta shall be able to:\n-\tAllow the UE to request and receive IP configuration from the TNAN (including a local IP address), e.g. with DHCP. This is to allow the UE to use an IP stack to establish a NWt connection between the UE and the TNGF.\nNOTE:\tThe \"local IP address\" is the IP address that allows the UE to contact the TNGF; the entity providing this local IP address is part of TNAN and out of 3GPP scope\nIn this Release of the specification, Ta is not specified.\nThe figure depicts a non-roaming architecture for a 5G Core Network for a 5G-RG with a Wireline 5G Access network and a Non-Line-of-Sight (NLOS) Radio Access Network (RAN). The architecture is designed to ensure reliability and failover capabilities, with redundant paths and layered design principles.\nFigure 4.2.8.4-1: Non- roaming architecture for 5G Core Network for 5G-RG with Wireline 5G Access network and NG RAN\nThe 5G-RG can be connected to 5GC via W-5GAN, NG RAN or via both accesses.\nNOTE 1:\tThe reference architecture in figure 4.2.8.4-1 only shows the architecture and the network functions directly connected to Wireline 5G Access Network, and other parts of the architecture are the same as defined in clause 4.2.\nNOTE 2:\tThe reference architecture in figure 4.2.8.4-1 supports service based interfaces for AMF, SMF and other NFs not represented in the figure.\nNOTE 3:\tThe two N2 instances in Figure 4.2.8.4-1 apply to a single AMF for a 5G-RG which is simultaneously connected to the same 5G Core Network over 3GPP access and Wireline 5G Access Network.\nNOTE 4\tThe two N3 instances in Figure 4.2.8. 4-1 may apply to different UPFs when different PDU Sessions are established over 3GPP access and Wireline 5G Access Network.\nThe figure depicts a non-roaming architecture for a 5G Core Network for FN-RG with a Wireline 5G Access network and a Non-Line-of-Sight (NLOS) RAN. The architecture includes core switches, optical line terminals (OLTs), and distributed nodes, with redundancy paths shown in dashed lines to ensure failover reliability. The layered design aligns with SDN principles.\nFigure 4.2.8.4-2: Non- roaming architecture for 5G Core Network for FN-RG with Wireline 5G Access network and NG RAN\nThe N1 for the FN-RG, which is not 5G capable, is terminated on W-AGF which acts on behalf of the FN-RG.\nThe FN-RG can only be connected to 5GC via W-5GAN.\nNOTE 5:\tThe reference architecture in figure 4.2.8.4-2 only shows the architecture and the network functions directly connected to Wireline 5G Access Network, and other parts of the architecture are the same as defined in clause 4.2.\nNOTE 6:\tThe reference architecture in figure 4.2.8.4-1 supports service based interfaces for AMF, SMF and other NFs not represented in the figure.\nThe devices that do not support 5GC NAS signalling over WLAN access are referred to as \"Non-5G-Capable over WLAN\" devices, or N5CW devices for short. A N5CW device is not capable to operate as a 5G UE that supports 5GC NAS signalling over a WLAN access network, however, it may be capable to operate as a 5G UE over NG-RAN.\nClause 4.2.8.5 specifies the 5GC architectural enhancements that enable N5CW devices to access 5GC via trusted WLAN access networks. A trusted WLAN access network is a particular type of a Trusted Non-3GPP Access Network (TNAN) that supports a WLAN access technology, e.g. IEEE 802.11. Not all trusted WLAN access networks support 5GC access from N5CW devices. To support 5GC access from N5CW devices, a trusted WLAN access network must support the special functionality specified below (e.g. it must support a TWIF function).\nWhen a N5CW device performs an EAP-based access authentication procedure to connect to a trusted WLAN access network, the N5CW device may simultaneously be registered to a 5GC of a PLMN or SNPN. The 5GC registration is performed by the TWIF function (see next clause) in the trusted WLAN access network, on behalf of the N5CW device. The type of EAP authentication procedure, which is used during the 5GC registration to authenticate the N5CW device, is specified in TS 33.501 [29]. In this Release of the specification, Trusted WLAN Access for N5CW Device only supports IP PDU Session type.\nThe architecture diagram in Figure 4.2.8.5.2-1 is based on the general 5GS architecture diagrams in clause 4.2 and shows the main network functions required to support 5GC access from N5CW devices. Other network functions are not shown for simplicity.\nThe figure depicts the non-roaming and LBO roaming architecture for supporting 5G access from N5CW devices. It illustrates the non-roaming architecture, which is designed to provide seamless roaming experience for users, while the LBO roaming architecture is intended for devices that are not in roaming mode. The figure includes key components such as non-roaming and roaming nodes, as well as the network slicing and network slicing controller (NSC). The architecture is designed to ensure efficient and reliable 5G access for N5CW devices.\nFigure 4.2.8.5.2-1: Non-roaming and LBO Roaming Architecture for supporting 5GC access from N5CW devices\nThe reference architecture in Figure 4.2.8.5.2-1 also supports N5CW device access to the subscribed SNPN or access to the SNPN with credentials owned by Credentials Holder. Other parts of the architecture are the same as defined in clause 5.30.2.9.\nTrusted WLAN Access Point (TWAP): It is a particular type of a Trusted Non-3GPP Access Point (TNAP) specified in clause 4.2.8.2, that supports a WLAN access technology, e.g. IEEE 802.11. This function is outside the scope of the 3GPP specifications.\nTrusted WLAN Interworking Function (TWIF): It provides interworking functionality that enables N5CW devices to access 5GC. The TWIF supports the following functions:\n-\tTerminates the N1, N2 and N3 interfaces.\n-\tImplements the AMF selection procedure.\n-\tImplements the NAS protocol stack and exchanges NAS messages with the AMF on behalf of the N5CW device.\n-\tOn the user plane, it relays protocol data units (PDUs) between the Yw interface and the N3 interface.\n-\tMay implement a local mobility anchor within the trusted WLAN access network.\nThe Yt' and Yw reference points are both outside the scope of the 3GPP specifications. The Yt' reference point transports WLAN messages (e.g. IEEE 802.11 messages), while the Yw reference point:\n-\tShall be able to transport authentication messages between the TNAP and the TWIF for enabling authentication of a N5CW device;\n-\tShall allow the N5CW device to request and receive IP configuration from the TWIF, including an IP address, e.g. with DHCP.\n-\tShall support the transport of user-plane traffic for the N5CW device.\nThe N1, N2 and N3 reference points are the same reference points defined in clause 4.2.7.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.9\tNetwork Analytics architecture",
                            "text_content": "The Network Analytics architecture is defined in TS 23.288 [86].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.10\tArchitecture Reference Model for ATSSS Support",
                            "text_content": "In order to support the ATSSS feature, the 5G System Architecture is extended as shown in Figure 4.2.10-1, Figure 4.2.10-2 and Figure 4.2.10-3. The additional functionality that is supported by the UE and the network functions shown in these figures is specified in clause 5.32 below. In summary:\n-\tThe UE supports one or more of the steering functionalities specified in clause 5.32.6, i.e. the MPTCP functionality, the MPQUIC functionality and the ATSSS-LL functionality. Each steering functionality in the UE enables traffic steering, switching and splitting across 3GPP access and non-3GPP access, in accordance with the ATSSS rules provided by the network. The ATSSS-LL functionality is mandatory in the UE for MA PDU Session of type Ethernet.\n-\tThe UPF may support the MPTCP Proxy functionality, which communicates with the MPTCP functionality in the UE by using the MPTCP protocol (IETF RFC 8684 [81]), as defined in clause 5.32.6.2.1.\n-\tThe UPF may support the MPQUIC Proxy functionality, which communicates with the MPQUIC functionality in the UE by using the QUIC protocol (RFC 9000 [166], RFC 9001 [167], RFC 9002 [168]) and its multipath extensions (draft-ietf-quic-multipath [174]), as defined in clause 5.32.6.2.2.\n-\tThe UPF may support ATSSS-LL functionality, which is similar to the ATSSS-LL functionality defined for the UE. There is no user plane protocol defined between the ATSSS-LL functionality in the UE and the ATSSS-LL functionality in the UPF.\nNOTE 1:\tATSSS-LL functionality is needed in the 5GC for MA PDU Session of type Ethernet.\n-\tIn addition, the UPF supports Performance Measurement Functionality (PMF), which may be used by the UE to obtain access performance measurements (see clause 5.32.5) over the user-plane of 3GPP access and/or over the user-plane of non-3GPP access.\n-\tThe AMF, SMF and PCF are extended with new functionality that is further discussed in clause 5.32.\nThe figure depicts a non-roaming and roaming scenario with local breakouts for ATSSS support. It illustrates the non-roaming architecture, which consists of a base station (BS), a mobile station (MS), and a local breakout (LB). The figure also shows the roaming architecture, which includes a base station (BS), a mobile station (MS), and a local breakout (LB). The local breakouts are designed to provide additional coverage and support for ATSSS services.\nFigure 4.2.10-1: Non-roaming and Roaming with Local Breakout architecture for ATSSS support\nNOTE 2:\tThe interactions between the UE and PCF that may be required for ATSSS control are specified in TS 23.503 [45].\nNOTE 3:\tThe UPF shown in Figure 4.2.10-1 can be connected via an N9 reference point, instead of the N3 reference point.\nFigure 4.2.10-2 shows the 5G System Architecture for ATSSS support in a roaming case with home-routed traffic and when the UE is registered to the same VPLMN over 3GPP and non-3GPP accesses. In this case, the MPTCP Proxy functionality, the MPQUIC Proxy functionality, the ATSSS-LL functionality and the PMF are located in the H-UPF.\nThe figure depicts a roaming scenario with a Home-routed architecture for ATSSS support, where the UE is registered to the same VPLMN. This architecture allows for seamless roaming between different VPLNs, enabling seamless communication between users.\nFigure 4.2.10-2: Roaming with Home-routed architecture for ATSSS support (UE registered to the same VPLMN)\nFigure 4.2.10-3 shows the 5G System Architecture for ATSSS support in a roaming case with home-routed traffic and when the UE is registered to a VPLMN over 3GPP access and to HPLMN over non-3GPP access (i.e. the UE is registered to different PLMNs). In this case, the MPTCP Proxy functionality, the MPQUIC functionality, the ATSSS-LL functionality and the PMF are located in the H-UPF.\nThe figure depicts a roaming architecture for ATSSS support, where the UE is registered to different PLMNs. This architecture allows for seamless roaming between different network operators, enabling seamless communication and data transfer.\nFigure 4.2.10-3: Roaming with Home-routed architecture for ATSSS support (UE registered to different PLMNs)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.11\tArchitecture for 5G multicast-broadcast services",
                            "text_content": "The architecture for 5G multicast-broadcast services is defined in TS 23.247 [129].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.12\tArchitecture for Proximity based Services (ProSe) in 5GS",
                            "text_content": "The architecture for Proximity based Services (ProSe) in the 5G System is defined in TS 23.304 [128].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.13\tArchitecture enhancements for Edge Computing",
                            "text_content": "The architecture enhancements for edge computing are outlined in clause 5.13 and further described in TS 23.548 [130].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.14\tArchitecture for Support of Uncrewed Aerial Systems connectivity, identification and tracking",
                            "text_content": "The architecture for Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking is defined in TS 23.256 [136].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.15\tArchitecture to support WLAN connection using 5G credentials without 5GS registration",
                            "text_content": "The reference architecture shown with reference point representation in Figure 4.2.15-1 and with Service Based Interface (SBI)-representation in Figure 4.2.15-2, enables a UE to connect to a WLAN access network using its 5GS credentials without registration to 5GS. This architecture is based on the Non-Seamless WLAN Offload Function (NSWOF), which interfaces to the WLAN access network using the SWa' reference point and interfaces to the AUSF using the Nausf SBI. The SWa' reference point corresponds to SWa reference point as defined in TS 23.402 [43] with the difference that SWa' the EAP procedure ensures that the permanent user ID is not visible over the access as defined in TS 33.501 [29] and that SWa' connects the Untrusted non-3GPP IP Access, possibly via 3GPP AAA Proxy, to the NSWOF and that the EAP user ID is a SUCI and not an IMSI.\nThe functionality of the NSWOF and the procedures applied for supporting a WLAN connection using 5GS credentials for Non-seamless WLAN offload are further defined in TS 33.501 [29] Annex S. The roaming architectures are shown with reference point representation in Figure 4.2.15-3 and with SBI representation in Figure 4.2.15-4. The architecture in Figure 4.2.15-1 and Figure 4.2.15-2 applies to UEs with PLMN or SNPN credentials.\nNOTE 1:\tFor a UE with SNPN credentials it is assumed that the realm part of UE identifier in SUCI format is defined in a way that enables routing of SWa requests from the WLAN AN to the NSWOF in the SNPN's 5GC.\nThe architectures in Figure 4.2.15-3a and Figure 4.2.15-4a apply to UEs with PLMN or SNPN credentials from a CH using UDM.\nThe architecture in Figure 4.2.15-3b applies to UEs with SNPN credentials from a CH using AAA Server. In this architecture the UE procedures for access selection for 5G NSWO defined in clause 6.3.12b apply. Except the UE, all NFs in Figure 4.2.15-3b are out of scope of 3GPP.\nThe architectures in Figure 4.2.15-3c and Figure 4.2.15-4b apply to UEs with SNPN credentials from a CH using AAA Server via 5GC (NSWOF/AUSF/UDM/NSSAAF). In this architecture the UE procedures for access selection for 5G NSWO defined in clause 6.3.12b apply.\nNOTE 2:\tHow to protect the user identity over the WLAN interface in architecture defined in Figure 4.2.15-3b and Figure 4.2.15-3c is defined in TS 33.501 [29].\nThe UE can also connect to a WLAN access network using 5GS credentials by performing the 5GS registration via Trusted non-3GPP access procedure defined in clause 4.12a.2.2 of TS 23.502 [3]. With this procedure, the UE connects to a WLAN access network using 5GS credentials and simultaneously registers in 5GS. However, the architecture defined in Figure 4.2.15-1, Figure 4.2.15-2, Figure 4.2.15-3 and in Figure 4.2.15-4, enables a UE to connect to a WLAN access network using 5GS credentials but without registration in 5GS.\nIf the WLAN is configured as Untrusted Non-3GPP access, in the case that the WLAN supports IEEE 802.1x, the UE may first use the 5G NSWO procedure to obtain a connection with and the local IP address from the WLAN, and any time after that, the UE may initiate the Untrusted Non-3GPP Access to obtain the access to 5GC.\nThe figure depicts a reference architecture for supporting authentication for Non-seamless WLAN offload in 5G, illustrating the various components and their interconnections.\nFigure 4.2.15-1: Reference architecture to support authentication for Non-seamless WLAN offload in 5GS\nThe figure depicts a reference architecture for 5G Service-based Authentication (SBA) offload, which is designed to support non-seamless WLAN offload in 5G networks. The architecture includes a reference network, a service-based reference network, and a reference service, with various components such as authentication servers, authentication gateways, and authentication services. The architecture is designed to provide a seamless and efficient offloading of WLAN traffic to the service-based network, ensuring high performance and reliability.\nFigure 4.2.15-2: Service based reference architecture to support authentication for Non-seamless WLAN offload in 5GS\nThe figure depicts a reference architecture for non-seamless WLAN offload in 5G, illustrating various roaming scenarios and their corresponding authentication mechanisms.\nFigure 4.2.15-3: Roaming reference architectures to support authentication for Non-seamless WLAN offload in 5GS\nThe figure depicts a reference architecture for supporting authentication for Non-seamless WLAN offload using credentials from the Credentials Holder using UDM. It includes reference architectures for the Authentication Server (AS), Credentials Holder (CH), and User Datagram Protocol (UDP) Offload Manager (UOM). The architecture is designed to ensure seamless offloading of WLAN traffic to the Credentials Holder, while maintaining the security and integrity of the credentials.\nFigure 4.2.15-3a: Reference architectures to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using UDM\nThe figure depicts a reference architecture for supporting authentication for Non-seamless WLAN offload using credentials from the Credentials Holder using an AAA Server. The architecture includes a Credentials Holder, an AAA Server, and a Credentials Provider, which are interconnected to provide authentication and authorization services for the WLAN offload.\nFigure 4.2.15-3b: Reference architecture to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using AAA Server\nThe figure depicts a reference architecture for supporting authentication for Non-seamless WLAN offload using credentials from the Credentials Holder using an AAA Server via 5GC. The architecture includes a 5GC (5G Core) server, a 5G Core client, and a Credentials Holder server. The 5GC server is responsible for managing the authentication process, while the 5GC client is used to authenticate the credentials. The Credentials Holder server is responsible for storing the credentials and providing them to the 5GC client. The architecture is designed to support seamless offloading of WLAN traffic to the 5GC server, ensuring high performance and reliability.\nFigure 4.2.15-3c: Reference architecture to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using AAA Server via 5GC\nNOTE 2:\tConfiguration 2) in Figure 4.2.15-3 and Figure 4.2.15-3a is a deployment variant of configuration 1)\nThe figure depicts a reference architecture for Service-based Roaming in 5G, illustrating the authentication process for Non-seamless WLAN offload. It includes various components such as the Service Provider (SP), Authentication Server (AS), and Authentication Gateway (AG), all working together to ensure seamless roaming for users.\nFigure 4.2.15-4: Service based Roaming reference architecture to support authentication for Non-seamless WLAN offload in 5GS\nThe SWd' reference point corresponds to the SWd reference point as defined in TS 23.402 [43] with the difference that SWd' connects the 3GPP AAA Proxy, possibly via intermediate 3GPP AAA Proxy, to the NSWOF and that the EAP user ID is a SUCI and not an IMSI.\nIn both roaming and non-roaming scenarios, the NSWOF acts towards the WLAN Access as a 3GPP AAA server, with the difference that the EAP user ID is a SUCI and not an IMSI.\nThe figure depicts a reference architecture for non-seamless WLAN offload, supporting authentication using credentials from the Credentials Holder. It includes a Service-based reference architecture, which allows for seamless authentication and offload of non-seamless WLAN traffic.\nFigure 4.2.15-4a: Service based reference architecture to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using UDM\nThe figure depicts a reference architecture for non-seamless WLAN offload, utilizing credentials from the Credentials Holder to authenticate the user's credentials using an AAA Server. This architecture supports authentication for non-seamless WLAN offload, utilizing credentials from the Credentials Holder to authenticate the user's credentials using an AAA Server.\nFigure 4.2.15-4b: Service based reference architecture to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using AAA Server via 5GC\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.16\tArchitecture to support User Plane Information Exposure via a service-based interface",
                            "text_content": "As depicted in Figure 4.2.16-1, the 5G System architecture allows user plane information exposure to some NFs via service-based interface in UPF.\nThe figure depicts a service-based architecture for User Plane Information Exposure (UPIE) in a 5G network. It illustrates the various components involved, including the service provider (SP), the user plane, and the network slicing. The architecture is designed to support the exposure of user plane information (UPI) through a service-based interface, ensuring efficient and secure communication between the SP and the user plane.\nFigure 4.2.16-1: Architecture to support User Plane Information Exposure via a service-based interface\nNOTE 1:\tIn this Release of the specification, only NWDAF/DCCF/MFAF, NEF/AF and TSNAF/TSCTSF are considered as the receiver of the UPF event notifications.\nNOTE 2:\tUPF information exposure is not restricted to SBI interface, i.e. reporting via PFCP over N4 to SMF is still applicable.\nNot all events can be subscribed to UPF directly. The details and constraints for the subscription to UPF event exposure service (i.e. direct vs. indirect) and the information exposed to certain NFs by UPF, as well as the information contained in the event notifications, are defined in clause 5.2.26.2 of TS 23.502 [3] and clause 5.8.2.17.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.17\tArchitecture for Ranging based services and Sidelink Positioning",
                            "text_content": "The architecture for Ranging based services and Sidelink Positioning is defined in TS 23.586 [180].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.3\tInterworking with EPC",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.3.1\tNon-roaming architecture",
                            "text_content": "Figure 4.3.1-1 represents the non-roaming architecture for interworking between 5GS and EPC/E-UTRAN.\nThe figure depicts a non-roaming architecture for interworking between 5G and EPC/E-UTRAN networks. It illustrates the various components and their interconnections, highlighting the importance of redundancy and failover mechanisms to ensure reliable communication.\nFigure 4.3.1-1: Non-roaming architecture for interworking between 5GS and EPC/E-UTRAN\nNOTE 1:\tN26 interface is an inter-CN interface between the MME and 5GS AMF in order to enable interworking between EPC and the NG core. Support of N26 interface in the network is optional for interworking. N26 supports subset of the functionalities (essential for interworking) that are supported over S10.\nNOTE 2:\tPGW-C + SMF and UPF + PGW-U are dedicated for interworking between 5GS and EPC, which are optional and are based on UE MM Core Network Capability and UE subscription. UEs that are not subject to 5GS and EPC interworking may be served by entities not dedicated for interworking, i.e. by either by PGW or SMF/UPF.\nNOTE 3:\tThere can be another UPF (not shown in the figure above) between the NG-RAN and the UPF + PGW-U, i.e. the UPF + PGW-U can support N9 towards an additional UPF, if needed.\nNOTE 4: Figures and procedures in this specification that depict an SGW make no assumption whether the SGW is deployed as a monolithic SGW or as an SGW split into its control-plane and user-plane functionality as described in TS 23.214 [32].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.2\tRoaming architecture",
                            "text_content": "Figure 4.3.2-1 represents the Roaming architecture with local breakout and Figure 4.3.2-2 represents the Roaming architecture with home-routed traffic for interworking between 5GS and EPC/E-UTRAN.\nThe figure depicts a local breakout roaming architecture for interworking between 5GS and EPC/E-UTRAN networks. It illustrates the various components and their interconnections, highlighting the importance of redundancy and failover mechanisms to ensure reliable communication.\nFigure 4.3.2-1: Local breakout roaming architecture for interworking between 5GS and EPC/E-UTRAN\nNOTE 1:\tThere can be another UPF (not shown in the figure above) between the NG-RAN and the UPF + PGW-U, i.e. the UPF + PGW-U can support N9 towards the additional UPF, if needed.\nNOTE 2:\tS9 interface from EPC is not required since no known deployment exists.\nThe figure depicts a home-routed roaming architecture for interworking between 5GS and EPC/E-UTRAN networks. It illustrates the various components and their interconnections, including the home gateway, mobile base station (MBB), and the home network. The figure highlights the importance of network slicing and the use of virtualized networks to optimize network performance and security.\nFigure 4.3.2-2: Home-routed roaming architecture for interworking between 5GS and EPC/E-UTRAN\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.3\tInterworking between 5GC via non-3GPP access and E-UTRAN connected to EPC",
                            "text_content": "Figure 4.3.3-1 represents the non-roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN.\nThe figure depicts a non-roaming architecture for interworking between 5G Core (5GC) and EPC/E-UTRAN networks. It illustrates the non-roaming concept, which allows for seamless communication between different network technologies. The architecture includes non-roaming access points (NRAPs) and non-roaming core switches (NRCS), ensuring efficient communication and reducing the need for roaming.\nFigure 4.3.3.1-1: Non-roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN\nNOTE 1:\tThere can be another UPF (not shown in the figure above) between the N3IWF/TNGF and the UPF + PGW-U, i.e. the UPF + PGW-U can support N9 towards an additional UPF, if needed.\nNOTE 2:\tN26 interface is not precluded, but it is not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.\nFigure 4.3.3.2-1 represents the Roaming architecture with local breakout and Figure 4.3.3.2-2 represents the Roaming architecture with home-routed traffic for interworking between 5GC via non-3GPP access and EPC/E-UTRAN.\nThe figure depicts a local breakout roaming architecture for interworking between 5G Core (5GC) and non-3GPP access and EPC/E-UTRAN networks. It illustrates the various components and their interconnections, including the local network, the core network, and the EPC/E-UTRAN network. The figure highlights the importance of network slicing and the use of virtualized networks to optimize network performance and resource utilization.\nFigure 4.3.3.2-1: Local breakout roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN\nNOTE 1:\tThere can be another UPF (not shown in the figure above) between the N3IWF/TNGF and the UPF + PGW-U, i.e. the UPF + PGW-U can support N9 towards the additional UPF, if needed.\nNOTE 2:\tS9 interface from EPC is not required since no known deployment exists.\nNOTE 3:\tN26 interface is not precluded, but it not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.\nThe figure depicts a home-routed roaming architecture for interworking between 5G Core (5GC) and EPC/E-UTRAN networks. It illustrates the various components and their interconnections, including non-3GPP access, EPC/E-UTRAN, and EPC/E-LTE networks. The architecture is designed to ensure seamless communication and interoperability between these networks, enabling seamless roaming and interworking between 5G Core and EPC/E-UTRAN networks.\nFigure 4.3.3.2-2: Home-routed roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN\nNOTE 4:\tN26 interface is not precluded, but it not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.4\tInterworking between ePDG connected to EPC and 5GS",
                            "text_content": "Figure 4.3.4.1-1 represents the non-roaming architecture for interworking between ePDG/EPC and 5GS.\nThe figure depicts a non-roaming architecture for interworking between ePDG/EPC and 5GS, illustrating the various components and their interconnections.\nFigure 4.3.4.1-1: Non-roaming architecture for interworking between ePDG/EPC and 5GS\nNOTE 1:\tThe details of the interfaces between the UE and the ePDG, and between EPC nodes (i.e. SWm, SWx, S2b and S6b), are documented in TS 23.402 [43].\nNOTE 2:\tInterworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).\nFigure 4.3.4.2-1 represents the Roaming architecture with local breakout and Figure 4.3.4.2-2 represents the Roaming architecture with home-routed traffic for interworking between ePDG/EPC and 5GS.\nThe figure depicts a local breakout roaming architecture for interworking between ePDG/EPC and 5GS, illustrating the various components and their interconnections.\nFigure 4.3.4.2-1: Local breakout roaming architecture for interworking between ePDG/EPC and 5GS\nNOTE 1:\tThe details of the interfaces between the UE and the ePDG, and between EPC nodes (i.e. SWm, SWd, SWx, S2b and S6b), are documented in TS 23.402 [43].\nNOTE 2:\tInterworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).\nThe figure depicts a home-routed roaming architecture for interworking between ePDG/EPC and 5GS networks. It illustrates the various components and their interconnections, including the home gateway, ePDG/EPC, and 5GS network. The figure highlights the importance of proper network design and interworking to ensure seamless communication and data exchange between different networks.\nFigure 4.3.4.2-2: Home-routed roaming architecture for interworking between ePDG/EPC and 5GS\nNOTE 1:\tThe details of the interfaces between the UE and the ePDG, and between EPC nodes (i.e. SWm, SWd, SWx, S2b and S6b), are documented in TS 23.402 [43].\nNOTE 2:\tInterworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.3.5\tService Exposure in Interworking Scenarios",
                            "text_content": "Figure 4.3.5.1-1 shows the non-roaming architecture for Service Exposure for EPC-5GC Interworking. If the UE is capable of mobility between EPS and 5GS, the network is expected to associate the UE with an SCEF+NEF node for Service Capability Exposure.\nThe figure depicts the non-roaming service exposure architecture for EPC-5GC interworking, illustrating the various components and their interconnections.\nFigure 4.3.5.1 1: Non-roaming Service Exposure Architecture for EPC-5GC Interworking\nNOTE 1:\tIn Figure 4.3.5.1-1, Trust domain for SCEF+NEF is same as Trust domain for SCEF as defined in TS 23.682 [36].\nNOTE 2:\tIn Figure 4.3.5.1-1, EPC Interface represents southbound interfaces between SCEF and EPC nodes e.g. the S6t interface between SCEF and HSS, the T6a interface between SCEF and MME, etc. All southbound interfaces from SCEF are defined in TS 23.682 [36] and are not shown for the sake of simplicity.\nNOTE 3:\tIn Figure 4.3.5.1-1, 5GC Interface represents southbound interfaces between NEF and 5GC Network Functions e.g. N29 interface between NEF and SMF, N30 interface between NEF and PCF, etc. All southbound interfaces from NEF are not shown for the sake of simplicity.\nNOTE 4:\tInteraction between the SCEF and NEF within the combined SCEF+NEF is required. For example, when the SCEF+NEF supports monitoring APIs, the SCEF and NEF need to share context and state information on a UE's configured monitoring events if the UE moves between from EPC and 5GC.\nNOTE 5:\tThe north-bound APIs which can be supported by an EPC or 5GC network are discovered by the SCEF+NEF node via the CAPIF function and/or via local configuration of the SCEF+NEF node. Different sets of APIs can be supported by the two network types.\nFigure 4.3.5.2-1 represents the roaming architecture for Service Exposure for EPC-5GC Interworking. This architecture is applicable to both the home routed roaming and local breakout roaming.\nThe figure depicts the Roaming Service Exposure Architecture for EPC-5GC Interworking, illustrating the various components and their interconnections. It highlights the importance of network slicing and network virtualization in enabling efficient and secure roaming services.\nFigure 4.3.5.2-1: Roaming Service Exposure Architecture for EPC-5GC Interworking\nNOTE:\tFigure 4.3.5.2-1 does not include all the interfaces, and network elements or network functions that may be connected to SCEF+NEF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.4\tSpecific services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tPublic Warning System",
                            "text_content": "The Public Warning System architecture for 5G System is specified in TS 23.041 [46].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tSMS over NAS",
                            "text_content": "This clause introduces legacy SMS over NAS architecture, in which the interfaces between SMSF/UDM and SMS-GMSC/SMS-IWMSC/IP-SM-GW/SMS Router are still based on legacy protocol (i.e. MAP or Diameter).\nThe SBI-based SMS architecture and interfaces are specified in TS 23.540 [142].\nFigure 4.4.2.1-1 shows the non-roaming architecture to support SMS over NAS using the Service-based interfaces within the Control Plane.\nThe figure depicts the non-roaming system architecture for SMS over NAS, illustrating the various components and their interconnections. The architecture includes non-repeater nodes (NRNs), non-repeater base stations (NRBs), and non-repeater access points (NRAs). The figure also shows the non-repeater network (NRN) and non-repeater access point (NRAP) network, highlighting the importance of these components in ensuring reliable SMS communication over NAS.\nFigure 4.4.2.1-1: Non-roaming System Architecture for SMS over NAS\nFigure 4.4.2.1-2 shows the non-roaming architecture to support SMS over NAS using the reference point representation.\nThe figure depicts the non-roaming system architecture for SMS over NAS, illustrating the reference point representation used in the system. The architecture includes non-roaming gateways, reference points, and network access points (NAPs). The figure highlights the use of reference points to ensure seamless communication between the SMS and NAS systems, and the non-roaming gateways to facilitate roaming between the two networks.\nFigure 4.4.2.1-2: Non-roaming System Architecture for SMS over NAS in reference point representation\nNOTE 1:\tSMS Function (SMSF) may be connected to the SMS-GMSC/IWMSC/SMS Router via one of the standardized interfaces as shown in TS 23.040 [5].\nNOTE 2:\tUDM may be connected to the SMS-GMSC/IWMSC/SMS Router via one of the standardized interfaces as shown in TS 23.040 [5].\nNOTE 3:\tEach UE is associated with only one SMS Function in the registered PLMN.\nNOTE 4:\tSMSF re-allocation while the UE is in RM-REGISTERED state in the serving PLMN is not supported in this Release of the specification. When serving AMF is re-allocated for a given UE, the source AMF includes SMSF identifier as part of UE context transfer to target AMF. If the target AMF, e.g. in the case of inter-PLMN mobility, detects that no SMSF has been selected in the serving PLMN, then the AMF performs SMSF selection as specified in clause 6.3.10.\nNOTE 5:\tTo support MT SMS domain selection by IP-SM-GW/SMS Router, IP-SM-GW/SMS Router may connect to SGs MSC, MME and SMSF via one of the standardized interfaces as shown in TS 23.040 [5].\nFigure 4.4.2.1-3 shows the roaming architecture to support SMS over NAS using the Service-based interfaces within the Control Plane.\nThe figure depicts a roaming architecture for SMS over NAS, illustrating the various components and their interactions. The diagram includes a base station (BS), a mobile station (MS), a network access server (NAS), and a network service provider (NSP). The figure highlights the use of roaming services to enable seamless communication between the BS and MS, ensuring reliable and efficient communication.\nFigure 4.4.2.1-3: Roaming architecture for SMS over NAS\nFigure 4.4.2.1-4 shows the roaming architecture to support SMS over NAS using the reference point representation.\nThe figure depicts a roaming architecture for SMS over NAS in reference point representation, illustrating the various components and their interconnections.\nFigure 4.4.2.1-4: Roaming architecture for SMS over NAS in reference point representation\nN1:\tReference point for SMS transfer between UE and AMF via NAS.\nFollowing reference points are realized by service based interfaces:\nN8:\tReference point for SMS Subscription data retrieval between AMF and UDM.\nN20:\tReference point for SMS transfer between AMF and SMS Function.\nN21:\tReference point for SMS Function address registration management and SMS Management Subscription data retrieval between SMS Function and UDM.\nNsmsf:\tService-based interface exhibited by SMSF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.3\tIMS support",
                            "text_content": "IMS support for 5GC is defined in TS 23.228 [15].\nThe 5G System architecture supports N5 interface between PCF and P-CSCF and supports Rx interface between PCF and P-CSCF, to enable IMS service. See TS 23.228 [15], TS 23.503 [45] and TS 23.203 [4].\nNOTE 1:\tRx support between PCF and P-CSCF is for backwards compatibility for early deployments using Diameter between IMS and 5GC functions.\nNOTE 2:\tWhen service based interfaces are used between the PCF and P-CSCF in the same PLMN, the P-CSCF performs the functions of a trusted AF in the 5GC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.4\tLocation services",
                            "text_content": "Location Service feature is optional and applicable to both regulatory services and commercial services in this Release of the specification. The non-roaming and roaming architecture to support Location Services are defined in clause 4.2 of TS 23.273 [87].\nThe reference points to support Location Services are defined in clause 4.4 of TS 23.273 [87].\nThe Service Based Interfaces to support Location Services are defined in clause 4.5 of TS 23.273 [87].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.5\tApplication Triggering Services",
                            "text_content": "See clause 5.2.6.1 of TS 23.502 [3].\nApplication trigger message contains information that allows the network to route the message to the appropriate UE and the UE to route the message to the appropriate application. The information destined to the application, excluding the information to route it, is referred to as the Trigger payload. The Trigger payload is implementation specific.\nNOTE:\tThe application in the UE may perform actions indicated by the Trigger payload when the Triggered payload is received at the UE. For example initiation of immediate or later communication with the application server based on the information contained in the Trigger payload, which includes the PDU Session Establishment procedure if the related PDU Session is not already established.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.6\t5G LAN-type Services",
                            "text_content": "The general User Plane architectures described in clause 4.2.3 and clause 4.2.4 apply to 5G LAN-type services, with the additional options described in this clause.\nFigure 4.4.6.1-1 depicts the non-roaming user plane architecture to support 5G LAN-type service using local switch.\nThe figure depicts a local-switch based user plane architecture in a non-roaming scenario, illustrating the various components and their interconnections. The diagram includes local switches, optical line terminals (OLTs), and distributed nodes, all interconnected to ensure failover reliability. The layered design aligns with SDN principles, emphasizing the importance of network virtualization and network function virtualization.\nFigure 4.4.6.1-1: Local-switch based user plane architecture in non-roaming scenario\nFigure 4.4.6.1-2 depicts the non-roaming user plane architecture to support 5G LAN-type service using N19 tunnel.\nThe figure depicts a user plane architecture in a non-roaming scenario, illustrating the N19-based user plane with its components and connections.\nFigure 4.4.6.1-2: N19-based user plane architecture in non-roaming scenario\nNOTE:\tAs described in clause 5.29.3, the PSA UPFs can be controlled by a dedicated SMF, a dedicated SMF Set or multiple SMF Sets.\nN19:\tReference point between two UPFs for direct routing of traffic between different PDU Sessions without using N6. It has a per 5G VN group granularity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.7\tMSISDN-less MO SMS Service",
                            "text_content": "MSISDN-less MO SMS via T4 is subscription based. The subscription provides the information whether a UE is allowed to originate MSISDN-less MO SMS.\nThe UE is pre-configured with the Service Centre address that points to SMS-SC that performs this MO SMS delivery via NEF delivery procedure. The recipient of this short message is set to the pre-configured address of the AF (i.e. Address of the destination SME). If UE has multiple GPSIs associated to the same IMSI, the GPSI that is associated with an SMS may be determined from the UE's IMSI and the Application Port ID value in the TP-User-Data field (see TS 23.040 [5]). The NEF may obtain the GPSI by querying the UDM with the IMSI and application port ID.\nUE is aware whether the MO SMS delivery status (success or fail) based on the SMS delivery report from SMS-SC. The network does not perform any storing and forwarding functionality for MO SMS.\nSee clause 5.2.6 of TS 23.502 [3] for a description of NEF Services and Service Operations.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.8\tArchitecture to enable Time Sensitive Communication, Time Synchronization and Deterministic Networking",
                            "text_content": "The 5G System can be extended to support the following:\na)\tIntegration of 5GS into a TSN data network (DN): Integration as a bridge in an IEEE 802.1 Time Sensitive Networking (TSN). The 5GS bridge supports the Time sensitive communication as defined in IEEE 802.1 Time Sensitive Networking (TSN) standards. The architecture is described in clause 4.4.8.2.\nThis Release supports of the specification, integration of the 5G System with IEEE 802.1 TSN networks that apply the fully centralized configuration model as defined in IEEE Std 802.1Q [98]. IEEE TSN is a set of standards to define mechanisms for the time-sensitive (i.e. deterministic) transmission of data over Ethernet networks.\nb)\tEnablers for AF requested support of Time Synchronization and/or some aspects of Time Sensitive Communication. The architecture is described in clause 4.4.8.3.\nc)\tSupport for TSN enabled transport network (TN): Enablers for interworking with TSN network deployed in the transport network. This option can be used simultaneously with either option a) or b). The architecture is described in clause 5.28a. The interworking is applicable when the transport network deploys the fully centralized configuration model as defined in IEEE Std 802.1Q [98]. In this scenario, a TSN TN is deployed to realize the N3 interface between (R)AN and UPF. From the perspective of the TSN TN, (R)AN and UPF act as End Stations of the TSN TN.\nd)\tIntegration as a router in a Deterministic Network as defined in IETF RFC 8655 [150]. The architecture is described in clause 4.4.8.4.\nThe 5G System is integrated with the external network as a TSN bridge. This \"logical\" TSN bridge (see Figure 4.4.8.2-1) includes TSN Translator functionality for interoperation between TSN Systems and 5G System both for user plane and control plane. 5GS TSN translator functionality consists of Device-side TSN translator (DS-TT) and Network-side TSN translator (NW-TT). The TSN AF is part of 5GC and provides the control plane translator functionality for the integration of the 5GS with a TSN network, e.g. the interactions with the CNC. 5G System specific procedures in 5GC and RAN, wireless communication links, etc. remain hidden from the TSN network. To achieve such transparency to the TSN network and the 5GS to appear as any other TSN Bridge, the 5GS provides TSN ingress and egress ports via DS-TT and NW-TT. DS-TT and NW-TT optionally support:\n-\thold and forward functionality for the purpose of de-jittering;\n-\tper-stream filtering and policing as defined in clause 8.6.5.2.1 of IEEE Std 802.1Q [98].\nDS-TT optionally supports link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to DS-TT. NW-TT supports link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to NW-TT. If a DS-TT does not support link layer connectivity discovery and reporting, then NW-TT performs link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to DS-TT on behalf of DS-TT.\nNOTE 1:\tIf NW-TT performs link layer connectivity discovery and reporting on behalf of DS-TT, it is assumed that LLDP frames are transmitted between NW-TT and UE on the QoS Flow with the default QoS rule as defined in the clause 5.7.1.1. Alternatively, SMF can establish a dedicated QoS Flow matching on the Ethertype defined for LLDP (IEEE Std 802.1AB [97]).\nThere are three TSN configuration models defined in IEEE Std 802.1Q [98]. Amongst the three models:\n-\tfully centralized model is supported in this Release of the specification;\n-\tfully distributed model is not supported in this Release of the specification;\n-\tcentralized network/distributed user model is not supported in this Release of the specification.\nNOTE 2:\tThis Release supports interworking with TSN using clause 8.6.8.4 of IEEE Std 802.1Q [98] scheduled traffic and clause 8.6.5.2.1 of IEEE Std 802.1Q [98] per-stream filtering and policy.\nThe figure depicts a system architecture view with 5G appearing as a TSN bridge, illustrating the multi-path signal propagation in a 5G network. Key components include the base station (gNB), user equipment (UE), and scatterers. The diagram highlights beamforming techniques to mitigate interference.\nFigure 4.4.8.2-1: System architecture view with 5GS appearing as TSN bridge\nNOTE 3:\tWhether DS-TT and UE are combined or are separate is up to implementation.\nNOTE 4:\tTSN AF does not need to support N33 in this release of the specification.\nThis clause describes the architecture to enable Time Sensitive Communication AF requested time sensitive communication and time synchronization services. The Time Sensitive Communication and Time Synchronization related features that are supported based on AF request are described in clauses 5.27.1 and 5.27.2, respectively. Figure 4.4.8.3-1 shows the architecture to support Time Sensitive Communication and Time Synchronization services.\nAs shown in Figure 4.4.8.3-1, to support Time Synchronization service based on IEEE Std 802.1AS [104] or IEEE Std 1588 [126] for Ethernet or IP type PDU Sessions, the DS-TT, NW-TT and Time Sensitive Communication and Time Synchronization Function (TSCTSF) are required in order to support the features in IEEE Std 802.1AS [104] or IEEE Std 1588 [126] as described in clause 5.27. The NEF exposes 5GS capability to support Time Synchronization service as described in clause 5.27.1.8. TSCTSF controls the DS-TT(s) and NW-TT for the (g)PTP based time synchronization service. In addition, TSCTSF supports TSC assistance container related functionalities.\nThe figure depicts a time-sensitive communication and time synchronization architecture, illustrating the various components and their interconnections. Key components include the time synchronization service, which ensures the synchronization of clocks and time signals, and the time-sensitive communication service, which enables the transmission of time-sensitive data. The architecture is designed to be scalable and fault-tolerant, with redundant paths and failover mechanisms to ensure reliable service delivery.\nFigure 4.4.8.3-1: Architecture to enable Time Sensitive Communication and Time Synchronization services\nNOTE 1:\tIf the AF is considered to be trusted by the operator, the AF could interact directly with TSCTSF, the connection between AF and TSCTSF is not depicted in the architecture diagram for brevity.\nUPF/NW-TT distributes the (g)PTP messages as described in clause 5.27.1.\nWhen the UPF supports one or more NW-TT(s), there is one-to-one association between an NW-TT and the network instance or between an NW-TT and network instance together with DNN/S-NSSAI in the UPF. When there are multiple network instances within a UPF, each network instance is considered logically separate. The network instance for the N6 interface (clause 5.6.12) may be indicated by the SMF to the UPF for a given PDU Session during PDU Session establishment procedure. UPF allocates resources based on the Network Instance and S-NSSAI and it is supported according to TS 29.244 [65]. DNN/S-NSSAI may be indicated by the SMF together with the network instance to the UPF for a given PDU Session during PDU Session establishment procedure.\nNOTE 2:\tThe same NW-TT is used for all PDU Sessions in the UPF for the given DNN/S-NSSAI; the NW-TT is unique per DNN/S-NSSAI. This ensures that the UPF selects an N4 session associated with the correct TSCTSF when the NW-TT initiates an UMIC or PMIC. At any given time, the NW-TT is associated with a single TSCTSF.\nThe 5G System is integrated with the Deterministic Network as defined in IETF RFC 8655 [150] as a logical DetNet transit router, see Figure 4.4.8.4-1. The TSCTSF performs mapping in the control plane between the 5GS internal functions and the DetNet controller. 5G System specific procedures in 5GC and RAN remain hidden from the DetNet controller.\nThe figure depicts a 5G architecture that supports IETF Deterministic Networking, illustrating the various components and their interconnections. Key elements include base stations (BTS), user equipment (UE), and scatterers. The diagram highlights the use of beamforming techniques to mitigate interference, and the presence of redundant paths ensures failover reliability. The layered design aligns with SDN principles, emphasizing the importance of network virtualization and control plane abstraction.\nFigure 4.4.8.4-1: 5GS Architecture to support IETF Deterministic Networking\nOn the device side, the UE is connected with a DetNet system, which may be a DetNet End System or a DetNet Node.\nThe architecture does not require the DS-TT functionality to be supported in the device nor require the user plane NW-TT functionality to be supported in the UPF, however, it can co-exist with such functions. For the reporting of information of the network side ports, NW-TT control plane function is used. The architecture can be combined with architecture in clause 4.4.8.3 to support time synchronization and TSC.\nDetNet may be used in combination with time synchronization mechanisms as defined in clause 5.27, but it does not require usage of these mechanisms.\n5GS acts as a DetNet router in the DetNet domain. Use cases where the 5GS acts as a sub-network (see clause 4.1.2 of IETF RFC 8655 [150]) are also possible but do not require any additional 3GPP standardization. A special case where the 5GS can act as a sub-network is when the 5GS acts as a TSN network, which is supported by the 3GPP specifications based on the architecture in clause 4.4.8.2.\nNOTE:\tFor DetNet interworking, it is assumed that there is a business agreement to support the use of the DetNet controller so that it can be regarded trusted for the operator. Depending on the needs of a given deployment, functions such as the authentication, authorization and potential throttling of signalling from the DetNet controller can be achieved by including such functionalities in the TSCTSF.\nThe routing of the downlink packets is achieved using the existing 3GPP functions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tHigh level features",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 5 specifies the high level functionality and features of the 5G System for both 3GPP and Non-3GPP access and for the interoperability with the EPC defined in TS 23.401 [26].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tNetwork Access Control",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.2.1\tGeneral",
                            "text_content": "Network access is the means for the user to connect to 5G CN. Network access control comprises the following functionality:\n-\tNetwork selection,\n-\tIdentification and authentication,\n-\tAuthorisation,\n-\tAccess control and barring,\n-\tPolicy control,\n-\tLawful Interception.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2\tNetwork selection",
                            "text_content": "In order to determine to which PLMN to attempt registration, the UE performs network selection. The network selection procedure comprises two main parts, PLMN selection and access network selection. The requirements for the PLMN selection are specified in TS 22.011 [25] and the procedures are in TS 23.122 [17]. The access network selection part for the 3GPP access networks is specified in TS 36.300 [30] for E-UTRAN and in TS 38.300 [27] for the NR.\nThe network selection for the Disaster Roaming is described in TS 23.122 [17] and TS 24.501 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.2a\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.3\tIdentification and authentication",
                            "text_content": "The network may authenticate the UE during any procedure establishing a NAS signalling connection with the UE. The security architecture is specified in TS 33.501 [29]. The network may optionally perform an PEI check with 5G-EIR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.4\tAuthorisation",
                            "text_content": "The authorisation for connectivity of the subscriber to the 5GC and the authorization for the services that the user is allowed to access based on subscription (e.g. Operator Determined Barring, Roaming restrictions, Access Type and RAT Type currently in use) is evaluated once the user is successfully identified and authenticated. This authorization is executed during UE Registration procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.5\tAccess control and barring",
                            "text_content": "When the UE needs to transmit an initial NAS message, the UE shall request to establish an RRC Connection first and the NAS shall provide the RRC establishment related information to the lower layer. The RAN handles the RRC Connection with priority during and after RRC Connection Establishment procedure, when UE indicates priority in Establishment related information\nUnder high network load conditions, the network may protect itself against overload by using the Unified Access Control functionality for 3GPP access specified in TS 22.261 [2], TS 24.501 [47] and TS 38.300 [27] to limit access attempts from UEs. Depending on network configuration, the network may determine whether certain access attempt should be allowed or blocked based on categorized criteria, as specified in TS 22.261 [2] and TS 24.501 [47]. The NG-RAN may broadcast barring control information associated with Access Categories and Access Identities as specified in TS 38.300 [27].\nThe NG-RAN node may initiate such Unified Access Control when:\n-\tAMFs request to restrict the load for UEs that access the network by sending OVERLOAD START message containing conditions defined in clause 5.19.5.2, or\n-\trequested by OAM, or\n-\ttriggered by NG-RAN itself.\nIf the NG-RAN node takes a decision to initiate UAC because of the reception of the N2 interface OVERLOAD START messages, the NG-RAN should only initiate such procedure if all the AMFs relevant to the request contained in the OVERLOAD START message and connected to this NG-RAN node request to restrict the load for UEs that access the network.\nIf the UE supports both N1 and S1 modes NAS and, as defined in TS 23.401 [26], the UE is configured for Extended Access Barring (EAB) but is not configured with a permission for overriding Extended Access Barring (EAB), when the UE wants to access the 5GS it shall perform Unified Access Control checks for Access Category 1 on receiving an indication from the upper layers as defined in TS 24.501 [47], TS 38.331 [28], TS 36.331 [51].\nIf the UE supports both N1 and S1 modes NAS and, as defined in TS 23.401 [26], the UE is configured with a permission for overriding Extended Access Barring (EAB), when the UE wants to access the 5GS it shall ignore Unified Access Control checks for Access Category 1 on receiving an indication from the upper layers, as defined in TS 24.501 [47].\nNOTE:\tUE signalling of Low Access Priority indication over N1 in 5GS is not supported in this release of the specification.\nOperator may provide one or more PLMN-specific Operator-defined access category definitions to the UE using NAS signalling, and the UE handles the Operator-defined access category definitions stored for the Registered PLMN, as specified in TS 24.501 [47].\nThe access control for the Disaster Roaming is described in TS 23.122 [17] and TS 24.501 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.6\tPolicy control",
                            "text_content": "Network access control including service authorization may be influenced by Policy control, as specified in clause 5.14.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.2.7\tLawful Interception",
                            "text_content": "For definition and functionality of Lawful Interception, please see TS 33.126 [35].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.3\tRegistration and Connection Management",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tGeneral",
                            "text_content": "The Registration Management is used to register or deregister a UE/user with the network, and establish the user context in the network. The Connection Management is used to establish and release the signalling connection between the UE and the AMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tRegistration Management",
                            "text_content": "A UE/user needs to register with the network to receive services that requires registration. Once registered and if applicable the UE updates its registration with the network (see TS 23.502 [3]):\n-\tperiodically, in order to remain reachable (Periodic Registration Update); or\n-\tupon mobility (Mobility Registration Update); or\n-\tto update its capabilities or re-negotiate protocol parameters (Mobility Registration Update).\nThe Initial Registration procedure involves execution of Network Access Control functions as defined in clause 5.2 (i.e. user authentication and access authorization based on subscription profiles in UDM). As result of the Registration procedure, the identifier of the serving AMF serving the UE in the access through which the UE has registered will be registered in UDM.\nThe registration management procedures are applicable over both 3GPP access and Non-3GPP access. The 3GPP and Non-3GPP RM states are independent of each other, see clause 5.3.2.4.\nTwo RM states are used in the UE and the AMF that reflect the registration status of the UE in the selected PLMN:\n-\tRM-DEREGISTERED.\n-\tRM-REGISTERED.\nIn the RM-DEREGISTERED state, the UE is not registered with the network. The UE context in AMF holds no valid location or routing information for the UE so the UE is not reachable by the AMF. However, some parts of UE context may still be stored in the UE and the AMF e.g. to avoid running an authentication procedure during every Registration procedure.\nIn the RM-DEREGISTERED state, the UE shall:\n-\tattempt to register with the selected PLMN using the Initial Registration procedure if it needs to receive service that requires registration (see clause 4.2.2.2 of TS 23.502 [3]).\n-\tremain in RM-DEREGISTERED state if receiving a Registration Reject upon Initial Registration (see clause 4.2.2.2 of TS 23.502 [3]).\n-\tenter RM-REGISTERED state upon receiving a Registration Accept (see clause 4.2.2.2 of TS 23.502 [3]).\nWhen the UE RM state in the AMF is RM-DEREGISTERED, the AMF shall:\n-\twhen applicable, accept the Initial Registration of a UE by sending a Registration Accept to this UE and enter RM-REGISTERED state for the UE (see clause 4.2.2.2 of TS 23.502 [3]); or\n-\twhen applicable, reject the Initial Registration of a UE by sending a Registration Reject to this UE (see clause 4.2.2.2 of TS 23.502 [3]).\nIn the RM-REGISTERED state, the UE is registered with the network. In the RM-REGISTERED state, the UE can receive services that require registration with the network.\nIn the RM-REGISTERED state, the UE shall:\n-\tperform Mobility Registration Update procedure if the current TAI of the serving cell (see TS 37.340 [31]) is not in the list of TAIs that the UE has received from the network in order to maintain the registration and enable the AMF to page the UE;\nNOTE:\tAdditional considerations for Mobility Registration Update in case of NR satellite access are provided in clause 5.4.11.6.\n-\tperform Periodic Registration Update procedure triggered by expiration of the periodic update timer to notify the network that the UE is still active.\n-\tperform a Mobility Registration Update procedure to update its capability information or to re-negotiate protocol parameters with the network;\n-\tperform Deregistration procedure (see clause 4.2.2.3.1 of TS 23.502 [3]), and enter RM-DEREGISTERED state, when the UE needs to be no longer registered with the PLMN. The UE may decide to deregister from the network at any time.\n-\tenter RM-DEREGISTERED state when receiving a Registration Reject message or a Deregistration message. The actions of the UE depend upon the cause value' in the Registration Reject or Deregistration message. See clause 4.2.2 of TS 23.502 [3].\nWhen the UE RM state in the AMF is RM-REGISTERED, the AMF shall:\n-\tperform Deregistration procedure (see clauses 4.2.2.3.2, 4.2.2.3.3 of TS 23.502 [3]), and enter RM-DEREGISTERED state for the UE, when the UE needs to be no longer registered with the PLMN. The network may decide to deregister the UE at any time;\n-\tperform Implicit Deregistration at any time after the Implicit Deregistration timer expires. The AMF shall enter RM-DEREGISTERED state for the UE after Implicit Deregistration;\n-\twhen applicable, accept or reject Registration Requests or Service Requests from the UE.\nThe figure depicts a RM state model in an UE, illustrating the state transitions and the corresponding actions taken by the UE to maintain a stable communication channel.\nFigure 5.3.2.2.4-1: RM state model in UE\nThe figure depicts a RM state model in AMF, which is a key component of the Advanced Metering Infrastructure (AMI) system. The model is used to predict the state of the metering infrastructure, including the number of active meters, the current state of the meters, and the potential for future state changes. The figure shows the RM state model with various states, such as active, inactive, and potential for future state changes. The model is used to optimize the metering infrastructure and ensure that it is functioning correctly and efficiently.\nFigure 5.3.2.2.4-2: RM state model in AMF\nRegistration Area management comprises the functions to allocate and reallocate a Registration area to a UE. Registration area is managed per access type i.e. 3GPP access or Non-3GPP access.\nWhen a UE registers with the network over the 3GPP access, the AMF allocates a set of tracking areas in TAI List to the UE. When the AMF allocates registration area, i.e. the set of tracking areas in TAI List, to the UE it may take into account various information (e.g. Mobility Pattern and Allowed/Non-Allowed Area (refer to clause 5.3.4.1)). An AMF which has the whole PLMN as serving area may alternatively allocate the whole PLMN (\"all PLMN\") as registration area to a UE in MICO mode (refer to clause 5.4.1.3). When AMF allocates registration area for UE registered for Disaster Roaming service as specified in clause 5.40.4, AMF shall only consider TAIs covering the area with the Disaster Condition.\nThe 5G System shall support allocating a Registration Area using a single TAI List which includes tracking areas of any NG-RAN nodes in the Registration Area for a UE.\nIn the case of SNPN, the TAI list allocated by AMF does not support Tracking Areas belonging to different SNPNs.\nTAI used for non-3GPP access shall be dedicated to non-3GPP access. TAI(s) dedicated to Non-3GPP access may be defined in a PLMN and apply within this PLMN. Each N3IWF, TNGF, TWIF and W-AGF is locally configured with one TAI value. Each N3IWF, TNGF, TWIF and W-AGF may be configured with a different TAI value or with the same TAI value as other N3IWFs, TNGFs, TWIFs and/or W-AGFs. The TAI is provided to the AMF during N2 interface setup and as part of the User Location Information in UE associated messages as described in TS 38.413 [34].\nWhen a UE registers with the network over a Non-3GPP access, the AMF allocates to the UE a registration area that only includes the TAI received from the serving N3IWF, TNGF, TWIF or W-AGF.\nNOTE 1:\tFor example, two W-AGFs can each correspond to a different TAI (one TAI per W-AGF) and thus support different sets of S-NSSAI(s).\nWhen generating the TAI list, the AMF shall include only TAIs that are applicable on the access type (i.e. 3GPP access or Non-3GPP access) where the TAI list is sent.\nNOTE 2:\tTo prevent extra signalling load resulting from Mobility Registration Update occurring at every RAT change, it is preferable to avoid generating a RAT-specific TAI list for a UE supporting more than one RAT.\nNOTE 3:\tFor a UE registered on N3GPP access the TAI(s) provided to the UE as part of the Registration Area is expected to enable the support of the slices that are intended to be provided for this UE over this specific Non-3GPP access. In addition, the Registration Area provided to the UE for non-3GPP access will never change until the UE deregisters from non-3GPP access (either explicit deregistration or implicit deregistration due to Deregistration timer expiring due to UE entering CM_IDLE state).\nFor all 3GPP Access RATs in NG-RAN and for Non-3GPP Access, the 5G System supports the TAI format as specified in TS 23.003 [19] consisting of MCC, MNC and a 3-byte TAC only.\nThe additional aspects for registration management when a UE is registered over one access type while the UE is already registered over the other access type is further described in clause 5.3.2.4.\nTo ensure a UE initiates a Mobility Registration procedure when performing inter-RAT mobility to or from NB-IoT, a Tracking Area shall not contain both NB-IoT and other RATs cells (e.g. WB-E-UTRA, NR), and the AMF shall not allocate a TAI list that contains both NB-IoT and other RATs Tracking Areas.\nFor 3GPP access the AMF determines the RAT type the UE is camping on based on the Global RAN Node IDs associated with the N2 interface and additionally the Tracking Area indicated by NG-RAN. When the UE is accessing NR using unlicensed bands, as defined in clause 5.4.8, an indication is provided in N2 interface as defined in TS 38.413 [34].\nThe AMF may also determine more precise RAT Type information based on further information received from NG-RAN:\n-\tThe AMF may determine the RAT Type to be LTE-M as defined in clause 5.31.20; or\n-\tThe AMF may determine the RAT Type to be NR using unlicensed bands, as defined in clause 5.4.8.\n-\tThe AMF may determine the RAT Type to be one of the RAT types for satellite access, as defined in clause 5.4.10.\n-\tThe AMF may determine the RAT Type to be NR RedCap as defined in clause 5.41.\nFor Non-3GPP accesses the AMF determines the RAT type the UE is camping based on the 5G-AN node associated with N2 interface as follows:\n-\tThe RAT type is Untrusted Non-3GPP if the 5G-AN node has a Global N3IWF Node ID;\n-\tThe RAT type is Trusted Non-3GPP if the 5G-AN node has a Global TNGF Node ID or a Global TWIF Node ID; and\n-\tThe RAT type is Wireline -BBF if the 5G-AN node has a Global W-AGF Node ID corresponding to a W-AGF supporting the Wireline BBF Access Network. The RAT type is Wireline-Cable if the 5G-AN node has a Global W-AGF Node ID corresponding to a W-AGF supporting the Wireline Cable Access Network. If not possible to distinguish between the two, the RAT type is Wireline.\nNOTE 4:\tHow to differentiate between W-AGF supporting either Wireline BBF Access Network or the Wireline (e.g. different Global W-AGF Node ID IE or the Global W-AGF Node ID including a field to distinguish between them) is left to Stage 3 definition.\nNOTE 5:\tIf an operator supports only one kind of Wireline Access Network (either Wireline BBF Access Network or a Wireline Cable Access Network) the AMF may be configured to use RAT type Wireline or the specific one.\nFor Non-3GPP access the AMF may also use the User Location Information provided at N2 connection setup to determine a more precise RAT Type, e.g. identifying IEEE 802.11 access, Wireline-Cable access, Wireline-BBF access.\nWhen the 5G-AN node has either a Global N3IWF Node ID, or a Global TNGF Node ID, or a Global TWIF Node ID, or a Global W-AGF Node ID, the Access Type is Non-3GPP Access.\nThis clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP and to the W-5GAN. In the case of W-5GAN the UE mentioned in this clause corresponds to the 5G-RG.\nFor a given serving PLMN there is one RM context for a UE for each access, e.g. when the UE is consecutively or simultaneously served by a 3GPP access and by a non-3GPP access (i.e. via an N3IWF, TNGF and W-AGF) of the same PLMN. UDM manages separate/independent UE Registration procedures for each access.\nWhen served by the same PLMN for 3GPP and non-3GPP accesses, an UE is served by the same AMF except in the temporary situation described in clause 5.17 i.e. after a mobility from EPS while the UE has PDU Sessions associated with non-3GPP access.\nThe 5G NSWO authentication as defined in Annex S of TS 33.501 [29] does not impact the RM state.\nAn AMF associates multiple access-specific RM contexts for an UE with:\n-\ta 5G-GUTI that is common to both 3GPP and Non-3GPP accesses. This 5G-GUTI is globally unique.\n-\ta Registration state per access type (3GPP / Non-3GPP)\n-\ta Registration Area per access type: one Registration Area for 3GPP access and another Registration Area for non 3GPP access. Registration Areas for the 3GPP access and the Non-3GPP access are independent.\n-\ttimers for 3GPP access:\n-\ta Periodic Registration timer; and\n-\ta Mobile Reachable timer and an Implicit Deregistration timer.\n-\ttimers for non-3GPP access:\n-\ta UE Non-3GPP Deregistration timer; and\n-\ta Network Non-3GPP Implicit Deregistration timer.\nThe AMF shall not provide a Periodic Registration Timer for the UE over a Non-3GPP access. Consequently, the UE need not perform Periodic Registration Update procedure over Non-3GPP access. Instead, during the Initial Registration procedure and Re-registration, the UE is provided by the network with a UE Non-3GPP Deregistration timer that starts when the UE enters non-3GPP CM-IDLE state.\nWhen the 3GPP access and the non-3GPP access for the same UE are served by the same PLMN, the AMF assigns the same 5G-GUTI for use over both accesses. Such a 5G-GUTI may be assigned or re-assigned over any of the 3GPP and Non-3GPP accesses. The 5G-GUTI is assigned upon a successful registration of the UE, and is valid over both 3GPP and Non-3GPP access to the same PLMN for the UE. Upon performing an initial access over the Non-3GPP access or over the 3GPP access while the UE is already registered with the 5G System over another access of the same PLMN, the UE provides the native 5G-GUTI for the other access. This enables the AN to select an AMF that maintains the UE context created at the previous Registration procedure via the GUAMI derived from the 5G-GUTI, and enables the AMF to correlate the UE request to the existing UE context via the 5G-GUTI.\nIf the UE is performing registration over one access and intends to perform registration over the other access in the same PLMN (e.g. the 3GPP access and the selected N3IWF, TNGF or W-AGF are located in the same PLMN), the UE shall not initiate the registration over the other access until the Registration procedure over first access is completed.\nNOTE:\tTo which access the UE performs registration first is up to UE implementation.\nWhen the UE is successfully registered to an access (3GPP access or Non-3GPP access respectively) and the UE registers via the other access:\n-\tif the second access is located in the same PLMN (e.g. the UE is registered via a 3GPP access and selects a N3IWF, TNGF or W-AGF located in the same PLMN), the UE shall use for the registration to the PLMN associated with the new access the 5G-GUTI that the UE has been provided with at the previous registration or UE configuration update procedure for the first access in the same PLMN. Upon successful completion of the registration to the second access, if the network included a 5G-GUTI in the Registration Accept, the UE shall use the 5G-GUTI received in the Registration Accept for both registrations. If no 5G-GUTI is included in the Registration Accept, then the UE uses the 5G-GUTI assigned for the existing registration also for the new registration.\n-\tif the second access is located in a PLMN different from the registered PLMN of the first access (i.e. not the registered PLMN), (e.g. the UE is registered to a 3GPP access and selects a N3IWF, TNGF or W-AGF located in a PLMN different from the PLMN of the 3GPP access, or the UE is registered over Non-3GPP and registers to a 3GPP access in a PLMN different from the PLMN of the N3IWF, TNGF or W-AGF), the UE shall use for the registration to the PLMN associated with the new access a 5G-GUTI only if it has got one previously received from a PLMN that is not the same as the PLMN the UE is already registered with. If the UE does not include a 5G-GUTI, the SUCI shall be used for the new registration. Upon successful completion of the registration to the second access, the UE has the two 5G-GUTIs (one per PLMN).\nA UE supporting registration over both 3GPP and Non-3GPP access to two PLMNs shall be able to handle two separate registrations, including two 5G-GUTIs, one per PLMN, and two associated equivalent PLMN lists.\nWhen a UE 5G-GUTI assigned during a Registration procedure over 3GPP (e.g. the UE registers first over a 3GPP access) is location-dependent, the same UE 5G-GUTI can be re-used over the Non-3GPP access when the selected N3IWF, TNGF or W-AGF function is in the same PLMN as the 3GPP access. When an UE 5G-GUTI is assigned during a Registration procedure performed over a Non 3GPP access (e.g. the UE registers first over a non-3GPP access), the UE 5G-GUTI may not be location-dependent, so that the UE 5G-GUTI may not be valid for NAS procedures over the 3GPP access and, in this case, a new AMF is allocated during the Registration procedure over the 3GPP access.\nWhen the UE is registered first via 3GPP access, if the UE registers to the same PLMN via Non-3GPP access, the UE shall send the GUAMI obtained via 3GPP access to the N3IWF, TNGF or W-AGF, which uses the received GUAMI to select the same AMF as the 3GPP access.\nThe Deregistration Request message indicates whether it applies to the 3GPP access the Non-3GPP access, or both.\nIf the UE is registered on both 3GPP and Non-3GPP accesses and it is in CM-IDLE over Non-3GPP access, then the UE or AMF may initiate a Deregistration procedure over the 3GPP access to deregister the UE only on the Non-3GPP access, in which case all the PDU Sessions which are associated with the Non-3GPP access shall be released.\nIf the UE is registered on both 3GPP and non-3GPP accesses and it is in CM-IDLE over 3GPP access and in CM-CONNECTED over non-3GPP access, then the UE may initiate a Deregistration procedure over the non-3GPP access to deregister the UE only on the 3GPP access, in which case all the PDU Sessions which are associated with the 3GPP access shall be released.\nRegistration Management over Non-3GPP access is further defined in clause 5.5.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tConnection Management",
                            "text_content": "Connection management comprises the functions of establishing and releasing a NAS signalling connection between a UE and the AMF over N1. This NAS signalling connection is used to enable NAS signalling exchange between the UE and the core network. It comprises both the AN signalling connection between the UE and the AN (RRC Connection over 3GPP access or UE-N3IWF connection over untrusted N3GPP access or UE-TNGF connection over trusted N3GPP access) and the N2 connection for this UE between the AN and the AMF.\nTwo CM states are used to reflect the NAS signalling Connection of the UE with the AMF:\n-\tCM-IDLE\n-\tCM-CONNECTED\nThe CM state for 3GPP access and Non-3GPP access are independent of each other, i.e. one can be in CM-IDLE state at the same time when the other is in CM-CONNECTED state.\nA UE in CM-IDLE state has no NAS signalling connection established with the AMF over N1. The UE performs cell selection/cell reselection according to TS 38.304 [50] and PLMN selection according to TS 23.122 [17].\nThere are no AN signalling connection, N2 connection and N3 connections for the UE in the CM-IDLE state.\nIf the UE is both in CM-IDLE state and in RM-REGISTERED state, the UE shall, unless otherwise specified in clause 5.3.4.1:\n-\tRespond to paging by performing a Service Request procedure (see clause 4.2.3.2 of TS 23.502 [3]), unless the UE is in MICO mode (see clause 5.4.1.3);\n-\tperform a Service Request procedure when the UE has uplink signalling or user data to be sent (see clause 4.2.3.2 of TS 23.502 [3]). Specific conditions apply for LADN, see clause 5.6.5.\nWhen the UE state in the AMF is RM-REGISTERED, UE information required for initiating communication with the UE shall be stored. The AMF shall be able to retrieve stored information required for initiating communication with the UE using the 5G-GUTI.\nNOTE:\tIn 5GS there is no need for paging using the SUPI/SUCI of the UE.\nThe UE provides 5G-S-TMSI as part of AN parameters during AN signalling connection establishment as specified in TS 38.331 [28] and TS 36.331 [51]. The UE shall enter CM-CONNECTED state whenever an AN signalling connection is established between the UE and the AN (entering RRC_CONNECTED state over 3GPP access, or at the establishment of the UE-N3IWF connectivity over untrusted non-3GPP access or the UE-TNGF connectivity over trusted non-3GPP access). The transmission of an Initial NAS message (Registration Request, Service Request or Deregistration Request) initiates the transition from CM-IDLE to CM-CONNECTED state.\nWhen the UE states in the AMF are CM-IDLE and RM-REGISTERED, the AMF shall:\n-\tperform a network triggered Service Request procedure when it has signalling or mobile-terminated data to be sent to this UE, by sending a Paging Request to this UE (see clause 4.2.3.3 of TS 23.502 [3]), if a UE is not prevented from responding e.g. due to MICO mode or Mobility Restrictions.\nThe AMF shall enter CM-CONNECTED state for the UE whenever an N2 connection is established for this UE between the AN and the AMF. The reception of initial N2 message (e.g. N2 INITIAL UE MESSAGE) initiates the transition of AMF from CM-IDLE to CM-CONNECTED state.\nThe UE and the AMF may optimize the power efficiency and signalling efficiency of the UE when in CM-IDLE state e.g. by activating MICO mode (see clause 5.4.1.3).\nA UE in CM-CONNECTED state has a NAS signalling connection with the AMF over N1. A NAS signalling connection uses an RRC Connection between the UE and the NG-RAN and an NGAP UE association between the AN and the AMF for 3GPP access. A UE can be in CM-CONNECTED state with an NGAP UE association that is not bound to any TNLA between the AN and the AMF. See clause 5.21.1.2 for details on the state of NGAP UE association for an UE in CM-CONNECTED state. Upon completion of a NAS signalling procedure, the AMF may decide to release the NAS signalling connection with the UE.\nIn the CM-CONNECTED state, the UE shall:\n-\tenter CM-IDLE state whenever the AN signalling connection is released (entering RRC_IDLE state over 3GPP access or when the release of the UE-N3IWF connectivity over untrusted non-3GPP access or the UE-TNGF connectivity over trusted non-3GPP access is detected by the UE), see TS 38.331 [28] for 3GPP access.\nWhen the UE CM state in the AMF is CM-CONNECTED, the AMF shall:\n-\tenter CM-IDLE state for the UE whenever the logical NGAP signalling connection and the N3 user plane connection for this UE are released upon completion of the AN Release procedure as specified in TS 23.502 [3].\nThe AMF may keep a UE CM state in the AMF in CM-CONNECTED state until the UE de-registers from the core network.\nA UE in CM-CONNECTED state can be in RRC_INACTIVE state, see TS 38.300 [27]. When the UE is in RRC_INACTIVE state the following applies:\n-\tUE reachability is managed by the RAN, with assistance information from core network;\n-\tUE paging is managed by the RAN.\n-\tUE monitors for paging with UE's CN (5G S-TMSI) and RAN identifier.\nThe figure depicts the C M state transition in an UE, illustrating the process of changing the channel mode from C to M. This is an essential component of the communication process, as it determines the type of data that can be transmitted. The figure shows the UE's antenna array, which is responsible for receiving and transmitting signals. The transition from C to M is a critical step in the transmission process, as it determines the type of data that can be transmitted.\nFigure 5.3.3.2.4-1: CM state transition in UE\nThe figure depicts the C M state transition in AMF, which is a key component in the control and monitoring of the communication system. The transition is depicted in a graphical format, with the C M state represented by a circle and the transition line connecting the two states. This figure is crucial for understanding the flow of information and ensuring the proper functioning of the communication system.\nFigure 5.3.3.2.4-2: CM state transition in AMF\nWhen a UE enters CM-IDLE state, the UP connection of the PDU Sessions that were active on this access are deactivated.\nNOTE:\tThe activation of UP connection of PDU Sessions is documented in clause 5.6.8.\nRRC_INACTIVE state applies to NG-RAN. UE support for RRC_INACTIVE state is defined in TS 38.306 [69] for NR and TS 36.306 [70] for E-UTRA connected to 5GC. RRC_INACTIVE is not supported by NB-IoT connected to 5GC.\nThe AMF shall provide assistance information to the NG-RAN, to assist the NG-RAN's decision whether the UE can be sent to RRC_INACTIVE state except due to some exceptional cases such as:\n-\tPLMN (or AMF set) does not support RRC_INACTIVE;\n-\tThe UE needs to be kept in CM-CONNECTED State (e.g. for tracking).\nThe \"RRC Inactive Assistance Information\" includes:\n-\tUE specific DRX values;\n-\tUE specific extended idle mode DRX values (cycle length and Paging Time Window length);\n-\tThe Registration Area provided to the UE;\n-\tPeriodic Registration Update timer;\n-\tIf the AMF has enabled MICO mode for the UE, an indication that the UE is in MICO mode;\n-\tInformation from the UE identifier, as defined in TS 38.304 [50] for NR and TS 36.304 [52] for E-UTRA connected to 5GC, that allows the RAN to calculate the UE's RAN paging occasions;\n-\tAn indication that Paging Cause Indication for Voice Service is supported;\n-\tAMF PEIPS Assistance Information (see clause 5.4.12.2) for paging a UE in CM-CONNECTED with RRC_INACTIVE state over NR as defined in TS 38.300 [27];\n-\tCN based MT communication handling support indication for RRC_INACATIVE state (see clause 5.31.7.2.1).\nThe RRC Inactive Assistance Information mentioned above is provided by the AMF during N2 activation with the (new) serving NG-RAN node (i.e. during Registration, Service Request, Handover) to assist the NG RAN's decision whether the UE can be sent to RRC_INACTIVE state. If the AMF allocates a new Registration Area to the UE, the AMF should update the NG-RAN with the new Registration Area by sending the RRC Inactive Assistance Information accordingly. The Paging Cause Indication for Voice Service is used to assist NG RAN to perform RAN based paging.\nRRC_INACTIVE state is part of RRC state machine, and it is up to the RAN to determine the conditions to enter RRC_INACTIVE state. If any of the parameters included in the RRC Inactive Assistance Information changes as the result of NAS procedure, the AMF shall update the RRC Inactive Assistance Information to the NG-RAN node.\nWhen the UE is in CM-CONNECTED state, if the AMF has provided RRC Inactive assistance information, the RAN node may decide to move a UE to CM-CONNECTED with RRC_INACTIVE state.\nThe state and \"endpoints\" (in the case of Dual Connectivity configuration) of the N2 and N3 reference points are not changed by the UE entering CM-CONNECTED with RRC_INACTIVE state. A UE in RRC_INACTIVE state is aware of the RAN Notification area and periodic RAN Notification Area Update timer.\nThe 5GC network is not aware of the UE transitions between CM-CONNECTED with RRC_CONNECTED and CM-CONNECTED with RRC_INACTIVE state, unless the 5GC network is notified via N2 notification procedure in clause 4.8.3 of TS 23.502 [3].\nAt transition into CM-CONNECTED with RRC_INACTIVE state, the NG-RAN configures the UE with a periodic RAN Notification Area Update timer taking into account the value of the Periodic Registration Update timer value indicated in the RRC Inactive Assistance Information, and uses a guard timer with a value longer than the RAN Notification Area Update timer value provided to the UE.\nIf the periodic RAN Notification Area Update guard timer expires in NG-RAN, the NG-RAN shall initiate AN Release procedure as specified in clause 4.2.6 of TS 23.502 [3].\nWhen the UE is in CM-CONNECTED with RRC_INACTIVE state, the UE performs PLMN selection procedures as defined in TS 23.122 [17] and TS 24.501 [47].\nWhen the UE is CM-CONNECTED with RRC_INACTIVE state, the UE may resume the RRC Connection due to:\n-\tUplink data pending;\n-\tMobile initiated NAS signalling procedure;\n-\tAs a response to RAN paging;\n-\tNotifying the network that it has left the RAN Notification Area;\n-\tUpon periodic RAN Notification Area Update timer expiration.\nIf the UE resumes the connection in a different NG-RAN node within the same PLMN or equivalent PLMN or within the same SNPN or equivalent SNPN, the UE AS context is retrieved from the old NG-RAN node and a procedure is triggered towards the CN (see clause 4.8.2 of TS 23.502 [3]).\nNOTE 1:\tWith Dual Connectivity configuration if the UE resumes the RRC connection in the Master RAN node, the Secondary RAN node configuration is defined in TS 38.300 [27].\nIf the RAN paging procedure applying DRX or eDRX value no longer than 10.24s, as defined in TS 38.300 [27], is not successful in establishing contact with the UE the procedure shall be handled by the network as follows:\n-\tIf NG-RAN has at least one pending NAS PDU for transmission, the RAN node shall initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) to move the UE CM state in the AMF to CM-IDLE state and indicate to the AMF the NAS non-delivery.\n-\tIf NG RAN has only pending user plane data for transmission, the NG-RAN node may keep the N2 connection active or initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) based on local configuration in NG-RAN.\nNOTE 2:\tThe user plane data which triggers the RAN paging can be lost, e.g. in the case of RAN paging failure.\nIf the RAN paging procedure applying eDRX value longer than 10.24s, as defined in TS 38.300 [27], has not requested the CN based mobile terminated (MT) communication handling as described in clause 5.31.7.2.1 and is not successful in establishing contact with the UE after paging the UE, the procedure shall be handled by network as follows:\n-\tIf NG-RAN has at least one pending NAS PDU for transmission, the RAN node shall initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) to move the UE CM state in the AMF to CM-IDLE state and indicate to the AMF the NAS non-delivery.\n-\tIf NG-RAN has only pending user plane data for transmission, the NG-RAN node may keep the N2 connection active and based on implementation send indication to the CN requesting the CN based mobile terminated (MT) communication handling as described in clause 5.31.7.2.1, or initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) based on local configuration in NG-RAN.\nNOTE 3:\tThe user plane data which triggers the RAN paging can be lost, e.g. in the case of RAN paging failure.\nIf a UE in CM-CONNECTED with RRC_INACTIVE state performs cell selection to GERAN/UTRAN/E-UTRAN, it shall follow idle mode procedures of the selected RAT as specified in clause 5.17.\nIn addition, a UE in CM-CONNECTED state with RRC_INACTIVE state shall enter CM-IDLE state and initiates the NAS signalling recovery (see TS 24.501 [47]) in the following cases:\n-\tIf RRC resume procedure fails,\nIf the UE receives Core Network paging,\n-\tIf the periodic RAN Notification Area Update timer expires and the UE cannot successfully resume the RRC Connection,\n-\tIn any other failure scenario that cannot be resolved in RRC_INACTIVE state and requires the UE to move to CM-IDLE state.\nWhen a UE is in CM-CONNECTED with RRC_INACTIVE state, and a trigger to change the UE's NG-RAN or E-UTRAN UE Radio Capability information happens, the UE shall move to CM-IDLE state and initiate the procedure for updating UE Radio Capability defined in clause 5.4.4.1. (For specific requirements for a UE operating in dual-registration mode see clause 5.17.2.1)\nWhen UE is in CM-CONNECTED with RRC_INACTIVE state, if RAN has received Location Reporting Control message from AMF with the Reporting Type indicating single stand-alone report or continuously reporting whenever the UE changes the cell, the RAN shall perform location reporting as specified in clause 4.10 of TS 23.502 [3].\nWhen the UE is CM-CONNECTED with RRC_INACTIVE state. If the AMF receives Nudm_UECM_DeregistrationNotification from UDM, the AMF shall initiate AN Release procedure as specified in clause 4.2.6 of TS 23.502 [3].\nWhen UE is in CM-CONNECTED with RRC_INACTIVE state, if RAN has received Location Reporting Control message from AMF with the Reporting Type of the Area Of Interest based reporting, the RAN shall send a Location Report message to AMF including UE presence in the Area Of Interest (i.e. IN, OUT, or UNKNOWN) and the UE's last known location with time stamp.\nWhen the UE is in CM-CONNECTED with RRC_INACTIVE state, if the old NG-RAN node that sends the UE into RRC_INACTIVE state receives the downlink N2 signalling, it initiates the RAN paging as defined in TS 38.300 [27]. If the UE resumes the RRC Connection towards a different NG-RAN node, the old NG-RAN node includes the \"UE Context Transfer\" indication into a response container to the NF (e.g. AMF or SMF) that generates such N2 downlink signalling. Then the NF shall reattempt the same procedure when the path switch from the old NG-RAN node to the new NG-RAN node is complete.\nNAS signalling connection management includes the functions of establishing and releasing a NAS signalling connection.\nNAS signalling connection establishment function is provided by the UE and the AMF to establish a NAS signalling connection for a UE in CM-IDLE state. The AMF shall provide the list of recommended cells/ TAs / NG-RAN node identifiers for paging, if the NG-RAN had provided that information in an earlier AN Release Procedure in the AN (see clause 4.2.6 of TS 23.502 [3]).\nWhen the UE in CM-IDLE state needs to transmit an NAS message, the UE shall initiate a Service Request, a Registration or a Deregistration procedure to establish a NAS signalling connection to the AMF as specified in clauses 4.2.2 and 4.2.3 of TS 23.502 [3]. If the NAS signalling connection is to be established via an NG-RAN node, but the AMF detects that this UE has already established a NAS signalling connection via old NG-RAN node, the AMF shall release the old established NAS signalling connection by triggering AN Release Procedure.\nBased on UE preferences, UE subscription, Mobility Pattern and network configuration, the AMF may keep the NAS signalling connection until the UE de-registers from the network.\nThe procedure of releasing a NAS signalling connection is initiated by the AN node (either 5G (R)AN node or N3IWF) or the AMF. The NG-RAN node may include the list of recommended cells/ TAs / NG-RAN node identifiers for paging, during the AN Release Procedure in the AN (see clause 4.2.6 of TS 23.502 [3]). The AMF stores this information, if provided by the NG-RAN.\nThe UE considers the NAS signalling connection is released if it detects the AN signalling connection is released. The AMF considers the NAS signalling connection is released if it detects the N2 context is released.\nThe AMF manages two CM states for an UE: a CM state for 3GPP access and a CM state for Non-3GPP access. An N2 interface can serve the UE for either 3GPP access or for Non 3GPP access. UE connected over both 3GPP and Non-3GPP has got two N2 interfaces, one for each access. A UE may be in any combination of the CM states between 3GPP and Non-3GPP access, e.g. a UE may be CM-IDLE for one access and CM-CONNECTED for the other access, CM-IDLE for both accesses or CM-CONNECTED for both accesses.\nWhen the UE CM state in the AMF is CM-IDLE for 3GPP access and CM-CONNECTED for Non-3GPP access, the AMF shall perform a network triggered Service Request procedure, when it has downlink data to be sent to this UE for 3GPP access, by sending either the Paging Request via 3GPP access or the NAS notification via Non-3GPP access to this UE (see clause 4.2.3.3 of TS 23.502 [3]).\nConnection Management over Non-3GPP access is further defined in clause 5.5.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.4\tUE Mobility",
                            "text_content": "Mobility Restrictions restrict mobility handling or service access of a UE. The Mobility Restriction functionality is provided by the UE (only for mobility restriction categories provided to the UE), the radio access network and the core network.\nUnless otherwise stated, Mobility Restrictions only apply to 3GPP access and wireline access, they do not apply to other non-3GPP accesses.\nThe UE and the network shall override Mobility restriction as specified in clause 5.16.4.3 when accessing the network for Emergency Services. For MPS and MCX, service area restriction does not apply, as specified in TS 24.501 [47].\nFor UE requesting Disaster Roaming service, the UE is only allowed to receive services in the area with Disaster Condition as specified in clause 5.40.4. The other areas within the PLMN shall be considered as forbidden area for the UE registered for Disaster Roaming service.\nService Area restrictions and handling of Forbidden Areas for CM-IDLE state and, for CM-CONNECTED state when in RRC_INACTIVE state are executed by the UE based on information received from the core network. Mobility Restrictions for CM-CONNECTED state when in RRC_CONNECTED state are executed by the radio access network and the core network.\nIn CM-CONNECTED state, the core network provides Mobility Restrictions to the radio access network within Mobility Restriction List.\nMobility Restrictions consists of RAT restriction, Forbidden Area, Service Area Restrictions, Core Network type restriction and Closed Access Group information as follows:\n-\tRAT restriction:\nDefines the 3GPP and non-3GPP Radio Access Technology(ies), a UE is not allowed to access in a PLMN. In a restricted RAT a UE based on subscription is not permitted access to the network for this PLMN. For 3GPP access and CM-CONNECTED state, when radio access network determines target RAT and target PLMN during Handover procedure, it should take per PLMN RAT restriction into consideration. The RAT restriction is enforced in the network, and not provided to the UE.\n-\tForbidden Area:\nIn a Forbidden Area, the UE, based on subscription, is not permitted to initiate any communication with the network for this PLMN. The UE behaviour in terms of cell selection, RAT selection and PLMN selection depends on the network response that informs the UE of Forbidden Area. A Forbidden Area applies either to 3GPP access or to non-3GPP access.\nFurther description on Forbidden Area when using wireline access is available in TS 23.316 [84].\nSupport for Forbidden Area with NR satellite access is described in clause 5.4.11.8.\nForbidden Areas should not be used for Untrusted or Trusted non-3GPP access.\nNOTE 1:\tIf a UE receives that the UE is accessing from a forbidden tracking area when registering over untrusted non-3GPP access or trusted non-3GPP access, the UE cannot determine the corresponding TAI and thus needs to consider that access to untrusted non-3GPP access and to trusted non-3GPP access in this PLMN is forbidden until the forbidden area list is removed as described in TS 24.501 [47].\nNOTE 2:\tThe UE reactions to specific network responses are described in TS 24.501 [47].\n-\tService Area Restriction:\nDefines areas in which the UE may or may not initiate communication with the network as follows:\n-\tAllowed Area:\nIn an Allowed Area, the UE is permitted to initiate communication with the network as allowed by the subscription.\n-\tNon-Allowed Area:\nIn a Non-Allowed Area a UE is service area restricted based on subscription. The UE and the network are not allowed to initiate Service Request, or any connection requests for user plane data, control plane data, exception data reporting, or SM signalling (except for PS Data Off status change reporting) to obtain user services that are not related to mobility.\nThe UE shall not use the entering of a Non-Allowed Area as a criterion for Cell Reselection, a trigger for PLMN Selection or Domain selection for UE originating sessions or calls. The RRC procedures while the UE is in CM-CONNECTED with RRC_INACTIVE state are unchanged compared to when the UE is in an Allowed Area. The RM procedures are unchanged compared to when the UE is in an Allowed Area. The UE in a Non-Allowed Area shall respond to core network paging or NAS Notification message from non-3GPP access with Service Request and RAN paging. The UE in a Non-Allowed Area may initiate MA PDU Session establishment or activation over a non-3GPP access other than wireline access, but the User Plane resources on the 3GPP access for the MA-PDU shall not be established or activated. The handling of Non-Allowed Area when using wireline access is described in TS 23.316 [84].\nNOTE 3:\tWhen the services are restricted in 5GS due to Service Area Restriction, then it is assumed that the services will be also restricted in all RATs/Systems at the same location(s) using appropriate mechanisms available in the other RATs/Systems.\nNOTE 4:\tDelivery of SOR transparent container, UE policy container, UE parameters update transparent container as defined in TS 24.501 [47], or removal of any stored Paging Restriction Information from network via Registration Request (see clause 5.38), is part of the mobility related service and is allowed in an area with service restriction.\nNOTE 5:\tFor a UE in CM-CONNECTED state then neither control plane data transmission nor, if user plane resources are already established, user plane data transmission are restricted by a non-allowed area.\n-\tCore Network type restriction:\nDefines whether UE is allowed to connect to 5GC only, EPC only, both 5GC and EPC for this PLMN. The Core Network type restriction when received applies in the PLMN either to both 3GPP and non-3GPP Access Types or to non-3GPP Access Type only.\nNOTE 6:\tThe Core Network type restriction can be used e.g. in network deployments where the E-UTRAN connects to both EPC and 5GC as described in clause 5.17. When the Core Network type restriction applies to non-3GPP Access Type, the UE is restricted from using any connectivity to an N3IWF.\n-\tClosed Access Group information:\nAs defined in clause 5.30.3.\nFor a given UE, the core network determines the Mobility Restrictions based on UE subscription information, UE location and/or local policy (e.g. if the HPLMN has not deployed 5GC, HPLMN ID of the UE and the operator's policy are used in the VPLMN for determining the Core Network type restriction). The Mobility Restriction may change due to e.g. UE's subscription, location change and local policy. Optionally the Service Area Restrictions or the Non-Allowed Area may in addition be fine-tuned by the PCF e.g. based on UE location, PEI and network policies. Service Area Restrictions may be updated during a Registration procedure or UE Configuration Update procedure.\nNOTE 7:\tThe subscription management ensures that for MPS service subscriber the Mobility Restrictions is not included.\nIf the network sends Service Area Restrictions to the UE, the network sends only either an Allowed Area, or a Non-Allowed Area, but not both at the same time, to the UE. If the UE has received an Allowed Area from the network, any TA not part of the Allowed Area is considered by the UE as non-allowed. If the UE has received a Non-Allowed Area from the network, any TA not part of the Non-Allowed Area is considered by the UE as allowed. If the UE has not received any Service Area Restrictions, any TA in the PLMN is considered as allowed.\nIf the UE has overlapping areas between Forbidden Areas, Service Area Restrictions, or any combination of them, the UE shall proceed in the following precedence order:\n-\tThe evaluation of Forbidden Areas shall take precedence over the evaluation of Service Area Restrictions.\nThe UDM shall provide to the AMF the information defined in TS 23.008 [119] about the subscriber's NR or E-UTRA access restriction set by the operator determined e.g. by subscription scenario and roaming scenario:\n-\tFor NR:\n-\tNR not allowed as primary RAT.\n-\tNR not allowed as secondary RAT.\n-\tNR in unlicensed bands not allowed as primary RAT.\n-\tNR in unlicensed bands not allowed as secondary RAT.\n-\tNR(LEO) satellite access not allowed as primary RAT.\n-\tNR(MEO) satellite access not allowed as primary RAT.\n-\tNR(GEO) satellite access not allowed as primary RAT.\n-\tNR(OTHERSAT) satellite access not allowed as primary RAT.\n-\tNR RedCap not allowed as primary RAT.\n-\tFor E-UTRA:\n-\tE-UTRA not allowed as primary RAT.\n-\tE-UTRA not allowed as secondary RAT.\n-\tE-UTRA in unlicensed bands not allowed as secondary RAT.\n-\tNB-IoT not allowed as primary RAT.\n-\tLTE-M not allowed as primary RAT.\nIn order to enforce all primary RAT restrictions, the related RAT has to be deployed in different Tracking Area Codes and the subscriber shall not be allowed to access the network in TAs using the particular RAT.\nWith all secondary RAT restrictions, the subscriber shall not be allowed to use this RAT as secondary RAT.\nThis clause describes Service Area Restrictions for 3GPP access. For Service Area Restrictions when using wireline access, see TS 23.316 [84].\nA Service Area Restriction may contain one or more (e.g. up to 16) entire Tracking Areas each or the Service Area Restriction may be set as unlimited (i.e. contain all Tracking Areas of the PLMN). The UE's subscription data in the UDM includes a Service Area Restriction which may contain either Allowed or Non-Allowed Areas–specified by using explicit Tracking Area identities and/or other geographical information (e.g. longitude/latitude, zip code, etc). The geographical information used to specify Allowed or Non-Allowed Area is only managed in the network, and the network will map it to a list of TAs before sending Service Area Restriction information to the PCF, NG-RAN and UE.\nWhen the AMF assigns a limited allowed area to the UE, the AMF shall provide the UE with Service Area Restrictions which consist of either Allowed Areas or Non-Allowed Areas. The Allowed Areas included in the Service Area Restrictions can be pre-configured and/or dynamically assigned by the AMF.\nThe Allowed Area may alternatively be configured as unlimited i.e. it may contain all Tracking Areas of the PLMN. The Registration Area of a UE in the Non-Allowed Area should consist of a set of TAs which belongs to a Non-Allowed Area of the UE. The Registration Area of a UE in the Allowed Area should consist of a set of TAs which belongs to an Allowed Area of the UE. The AMF provides the Service Area Restriction in the form of TA(s), which may be a subset of full list stored in UE's subscription data or provided by the PCF, to the UE during the Registration procedure.\nNOTE:\tAs the finest granularity for Service Area Restrictions are at TA level, subscriptions with limited geographical extent, like subscriptions for Fixed Wireless Access, will be allocated one or a few TAs and will consequently be allowed to access services in a larger area than in e.g. a FWA system.\nThe limited allowed area may also be limited by the AMF by a maximum allowed number of Tracking Areas, even though this limitation is not sent to the UE. If maximum allowed number of Tracking Areas is used in combination with Allowed Area, the maximum allowed number of Tracking Areas indicates (to the AMF) the maximum number of TAs allowed in limited allowed area inside the Allowed Area. If maximum allowed number of Tracking Areas is used in combination with Non-Allowed Area, the maximum allowed number of Tracking Areas indicates (to the AMF) the maximum number of TAs allowed in limited allowed area outside of the Non-Allowed Area.\nThe UDM stores the Service Area Restrictions of a UE as part of the UE's subscription data. The PCF in the serving network may (e.g. due to varying conditions such as UE's location, application in use, time and date) further adjust Service Area Restrictions of a UE, either by expanding an Allowed Area or by reducing a Non-Allowed Area or by increasing the maximum allowed number of Tracking Areas. If NWDAF is deployed, the PCF may use analytics (i.e. statistics or predictions) on UE mobility from NWDAF (see TS 23.288 [86]) to adjust Service Area Restrictions. The UDM and the PCF may update the Service Area Restrictions of a UE at any time. For the UE in CM-CONNECTED state the AMF updates the UE and RAN immediately. For UE in CM-IDLE state the AMF may page the UE immediately or store the updated service area restriction and update the UE upon next signalling interaction with the UE, as defined in TS 24.501 [47].\nDuring registration, if the Service Area Restrictions of the UE is not present in the AMF, the AMF fetches from the UDM the Service Area Restrictions of the UE that may be further adjusted by the PCF. The serving AMF shall enforce the Service Area Restrictions of a UE. A limited allowed area given by a maximum allowed number of Tracking Areas, may be dynamically assigned by the AMF adding any not yet visited (by the UE) Tracking Areas to the limited allowed area until the maximum allowed number of Tracking Areas is reached (i.e. the AMF adds new TAs to the limited allowed area until the number of TAs is equal to the maximum allowed number of Tracking Areas). The AMF deletes the list of TAs that have been used up under the maximum allowed number of Tracking Areas quota at every Initial Registration.\nFor a UE in CM-CONNECTED state the AMF shall indicate the Service Area Restrictions of this UE to the RAN, using a Mobility Restriction List.\nThe UE shall store the received Service Area Restrictions and, if there is previously stored Service Area Restrictions, replace them with the newly received information. If the Service Area Restrictions include a limited allowed area, the Service Area Restrictions are applicable for the Tracking areas indicated in Service Area Restrictions. If the Service Area Restrictions included an unlimited allowed area, the received Service Area Restrictions are either applicable for the registered PLMN and its equivalent PLMN(s) that are available in the Registration Area, or the registered SNPN that is available in the Registration Area. The RAN uses the Service Area Restrictions for target cell selection in Xn and N2 based handover.\nUpon change of serving AMF due to mobility, the old AMF may provide the new AMF with the Service Area Restrictions of the UE that may be further adjusted by the PCF.\nThe network may perform paging for a UE to update Service Area Restrictions with Generic UE Configuration Update procedure (see clause 4.2.4 of TS 23.502 [3]).\nIn the case of roaming, the Service Area Restrictions are transferred from the UDM via the serving AMF to the serving PCF in the visited network. The serving PCF in the visited network may further adjust the Service Area Restrictions.\nSupport for Service Area Restrictions with NR satellite access is described in clause 5.4.11.8.\nThe Mobility Pattern is a concept that may be used by the AMF to characterise and optimise the UE mobility. The AMF determines and updates Mobility Pattern of the UE based on subscription of the UE, statistics of the UE mobility, network local policy, and the UE assisted information, or any combination of them. The statistics of the UE mobility can be historical or expected UE moving trajectory. If NWDAF is deployed, the statistics of the UE mobility can also be analytics (i.e. statistics or predictions) provided by the NWDAF (see TS 23.288 [86]).\nThe Mobility Pattern can be used by the AMF to optimize mobility support provided to the UE, for example, Registration area allocation.\nTo support radio resource management in NG-RAN the AMF provides the parameter 'Index to RAT/Frequency Selection Priority' (RFSP Index) to NG-RAN across N2. The RFSP Index is mapped by the RAN to locally defined configuration in order to apply specific RRM strategies, taking into account any available information in RAN. The RFSP Index is UE specific and applies to all the Radio Bearers. Examples of how this parameter may be used by the RAN:\n-\tto derive UE specific cell reselection priorities to control idle mode camping.\n-\tto decide on redirecting active mode UEs to different frequency layers or RATs (e.g. see clause 5.3.4.3.2).\nThe HPLMN may set the RFSP Index taking into account the Subscribed S-NSSAIs. The AMF receives the subscribed RFSP Index from the UDM (e.g. during the Registration procedure). For non-roaming subscribers, the AMF chooses the RFSP Index in use according to one of the following procedures, depending on operator's configuration:\n-\tthe RFSP Index in use is identical to the subscribed RFSP Index, or\n-\tthe AMF chooses the RFSP Index in use based on the subscribed RFSP Index, the locally configured operator's policies, the Allowed NSSAI and any Partially Allowed NSSAI, S-NSSAI(s) rejected partially in the RA, Rejected S-NSSAI(s) for the RA, Pending NSSAI and the UE related context information available at the AMF, including UE's usage setting, if received during Registration procedures (see clause TS 23.502 [3]).\nNOTE 1:\tOne example of how the AMF can use the \"UE's usage setting,\" is to select an RFSP value that enforces idle mode camping on E-UTRA for a UE acting in a \"Voice centric\" way, in the case voice over NR is not supported in the specific Registration Area and it contains NR cells.\nThe AMF may report to the PCF the subscribed RFSP Index received from the UDM for further evaluation as described in clause 6.1.2.1 of TS 23.503 [45]. When receiving the authorized RFSP Index from the PCF, the AMF shall apply the authorized RFSP Index instead of the subscribed RFSP Index for choosing the RFSP index in use (as described above).\nFor roaming subscribers, the AMF may choose the RFSP Index in use based on the visited network policy, but can take input from the HPLMN into account (e.g. an RFSP Index value pre-configured per HPLMN, or a single RFSP Index value to be used for all roamers independent of the HPLMN). If the AMF receives authorized RFSP Index value from the V-PCF, the AMF chooses the RFSP index in use based on the authorized RFSP Index value.\nNOTE 2:\tThe PCF can provide validity time together with the authorized RFSP Index indicating a change in priority from 5G access to E-UTRAN access as specified in clause 5.17.2.2.\nThe RFSP Index in use is also forwarded from source to target NG-RAN node when Xn or N2 is used for intra-NG-RAN handover.\nThe AMF stores the subscribed RFSP Index value received and the RFSP Index value in use. During the Registration procedure, the AMF may update the RFSP Index value in use (e.g. the AMF may need to update the RFSP Index value in use if the UE related context information in the AMF has changed). When the RFSP Index value in use is changed, the AMF immediately provides the updated RFSP Index value in use to NG-RAN node by modifying an existing UE context or by establishing a new UE context in RAN or by being configured to include the updated RFSP Index value in use in the NGAP DOWNLINK NAS TRANSPORT message if the user plane establishment is not needed. During inter-AMF mobility procedures, the source AMF forwards both RFSP Index values to the target AMF. The target AMF may replace the received RFSP Index value in use with a new RFSP Index value in use that is based on the operator's policies and the UE related context information available at the target AMF.\nIn order to enable UE idle mode mobility control and priority-based reselection mechanism considering availability of Network Slices at the network and the Network Slices allowed for a UE, an RFSP is derived as described in clause 5.3.4.3, considering also the Allowed NSSAI and any Partially Allowed NSSAI for the UE.\nA UE supporting NSAG (see clause 5.15.14) may be configured, for some of the S-NSSAIs in the configured NSSAI, with NSAGs it can use as described in TS 38.300 [27], TS 38.304 [50], TS 38.331 [28], TS 38.321 [143], TS 24.501 [47] and as described in clause 5.3.4.3.4.\nThe NG-RAN may prefer to use specific radio resources per data radio bearer(s), e.g. depending on the Network Slices associated to the data radio bearer used by the UE. The UE idle mode mobility control and priority-based reselection mechanism operates as described in clause 5.3.4.3.1, and when UP resources are activated e.g. for a specific S-NSSAI the NG-RAN can use local policies to decide on what specific radio resources to use for the associated data radio bearer(s). A UE may be served by a set of data radio bearers which may be served by cells in different bands, selected based on RRM policies.\nIf a Network Slice, S-NSSAI, is configured to be available only in TAs covering specific dedicated frequency band(s), then there may be a need to redirect the UE to the dedicated frequency band(s) when such S-NSSAI is requested. If the Requested NSSAI contains S-NSSAI(s) that are not available in the UE's current TA, see clause 5.15.8, the AMF itself or by interacting with the NSSF as described in clause 5.15.5.2.1 may determine a Target NSSAI to be used by the NG-RAN, in addition to the information the AMF receives, such as the Allowed NSSAI and the RFSP for the Allowed NSSAI, to attempt to redirect the UE to a cell and TA in another frequency band and TA that supports the S-NSSAIs in the Target NSSAI. The Target NSSAI includes at least one S-NSSAI from the Requested NSSAI not available in the current TA, but available in another TA in different frequency band possibly overlapping with the current TA, and optionally additional S-NSSAIs from the Requested NSSAI that are configured to be available within the same TAs as the S-NSSAIs not available in the current TA. If the serving PLMN supports the subscription-based restrictions to simultaneous registration of network slices (see clause 5.15.12), and if the UE has NSSRG as part of the subscription information received from the HPLMN, the Target NSSAI includes only S-NSSAIs sharing at least one NSSRG.\nThe Target NSSAI may be excluding some of the S-NSSAIs in the Allowed NSSAI and include some of the rejected S-NSSAIs due to lack of support in the TA where the UE is located based on network policies that are in line with customer and operator agreements.\nThe Target NSSAI shall only include S-NSSAIs that can be provided in an Allowed NSSAI, or in an Allowed NSSAI and Partially Allowed NSSAI, for the UE. The Target NSSAI includes at least one Rejected S-NSSAI and may include e.g.:\n-\tall or a subset of the Rejected S-NSSAIs for RA, all or a subset of the S-NSSAIs rejected partially in the RA, all or a subset of Partially Allowed NSSAI when none of the S-NSSAIs in the Requested S-NSSAI were available in the TA where the UE is;\n-\tall the S-NSSAIs of the Allowed NSSAI, all the S-NSSAIs of the Partially Allowed NSSAI and all or a subset of the Rejected S-NSSAIs for the RA and all or subset of S-NSSAIs rejected partially in the RA;\n-\ta subset of the S-NSSAIs in the Allowed NSSAI, a subset of the S-NSSAIs in the Partially Allowed NSSAI and all or a subset of the Rejected S-NSSAIs for the RA and all or subset of S-NSSAIs rejected partially in the RA, if the operator policy is to prefer this Target S-NSSAI to the Allowed NSSAI.\nThe AMF should retrieve an RFSP Index suitable for the Target NSSAI and includes the RFSP Index in the information sent to the NG-RAN. The AMF retrieves the RFSP Index from the PCF or, in case PCF is not deployed the AMF determines the RFSP Index according to local configuration. The RFSP index associated to the Target NSSAI is considered if the NG-RAN succeeds to redirect the UE to a new TA where the Target NSSAI, or some S-NSSAIs of the Target NSSAI are supported, otherwise the RFSP index of the Allowed NSSAI is considered.\nIf the Requested NSSAI contains S-NSSAI(s) which map to S-NSSAI(s) of the HPLMN subject to Network Slice-Specific Authentication and Authorization that are not available in the UE's current TA, the AMF shall proceed with the Network Slice-Specific Authentication and Authorization procedure as described in clause 4.2.9 of TS 23.502 [3]. If the AMF determines a new Allowed NSSAI and/or Partially Allowed NSSAI at the end of Network Slice-Specific Authentication and Authorization steps and some S-NSSAI is not available in the UE's current TA, a Target NSSAI and corresponding RFSP index may be determined and provided to NG-RAN during UE Configuration Update procedure as described in clause 4.2.4.2 of TS 23.502 [3].\nThe NG-RAN shall attempt to find cells of TAs that can support all the S-NSSAIs in the Target S-NSSAIs, and if no such cell of a TA is available the RAN can attempt to select cells of TAs that best match the Target S-NSSAI. The NG-RAN shall attempt to ensure continuity of the PDU Sessions with activated User Plane associated with the S-NSSAIs in the Allowed NSSAI and/or Partially Allowed NSSAI which are in the Target NSSAI. Also, the NG-RAN should attempt to ensure continuity of service for the S-NSSAIs of the Allowed NSSAI and/or Partially Allowed NSSAI also available in the Target NSSAI, before prioritizing cells that are not supporting one or more of the S-NSSAI of the Allowed NSSAI and/or Partially Allowed NSSAI also available in the Target NSSAI.\nThe NG-RAN attempts to determine target cell(s) supporting the Target NSSAI considering the UE Radio Capabilities (i.e. the AMF (if available in the UE context) shall provide the NG-RAN with the current UE Radio Capability Information or the RACS UE Radio Capability ID when a Target NSSAI is provided, if the NG-RAN had not yet received any of them, or, if the AMF cannot provide any of these, the UE Radio Capability Information may be retrieved by the NG-RAN from the UE).\nOnce the target cells are determined, the NG-RAN initiates RRC redirection procedure towards the target cells, or the NG-RAN initiates handover for the UE with active PDU Sessions associated with the S-NSSAIs which are in the Target NSSAI, if possible.\nAfter a successful redirection or handover of the UE to a new TA inside the current RA, the UE may request a PDU Session and activate UP resources for a PDU Session for S-NSSAIs of Partially Allowed NSSAI that are supported in the new TA, and the UE may request to register S-NSSAIs rejected partially in the RA that are not rejected in the new TA, as described in clause 5.15.17.\nAfter a successful redirection or handover of the UE to a new TA outside the current RA, the UE shall perform a Mobility Registration Update procedure and the S-NSSAIs that the new TA supports can be allowed if the UE requests them. In order to ensure that the UE is redirected to a TA outside the current RA when there are S-NSSAIs Rejected for the RA, thus triggering a Mobility Registration Update procedure enabling the UE to request the S-NSSAI(s) that were rejected for the RA, the AMF shall set the RA so that the RA does not include TAs supporting the S-NSSAIs rejected for the RA included in the Target NSSAI when the AMF provides a Target NSSAI to the RAN.\nWhen one or more S-NSSAI(s) are associated with NSAG(s), the UE may perform Network Slice based cell reselection and Random Access as described in TS 38.300 [27], TS 38.304 [50], TS 38.331 [28], TS 38.321 [143] and TS 24.501 [47].\nWhen providing NSAG Information to the UE, the AMF shall also provide the NSAG priority information for the NSAGs provided in the NSAG Information. The AMF determines the NSAG priority information based on configured local policy of the serving PLMN or SNPN.\nNOTE 1:\tHow the AMF assigns the NSAG priority information per UE is not specified but AMF can take into account information like e.g. UE MM capabilities, Subscribed S-NSSAIs and HPLMN.\nNOTE 2:\tThe AMF can assign same priority value for NSAGs provided in the NSAG Information.\nIf the UE has received NSAG Information from the AMF, the UE shall use the NSAG Information provided by the AMF for cell reselection and Random Access as described below. If the UE has not received any NSAG Information from the AMF, the UE shall not use Network Slice based cell reselection and Random Access at all.\nThe UE NAS provides to the UE AS the NSAG Information as received from the AMF and the S-NSSAIs in the Allowed NSSAI and any Partially Allowed NSSAI as input to cell reselection, except when the UE intends to register with a new (including any S-NSSAIs rejected partially in the RA) set of S-NSSAIs with a Requested NSSAI different from the current Allowed NSSAI and any Partially Allowed NSSAI, in which case the UE NAS provides to the UE AS layer the NSAG Information as received from the AMF and the S-NSSAIs in the Requested NSSAI, and this may trigger a cell reselection, before sending the Registration Request including the new Requested NSSAI.\nFor Network Slice based Random Access, different Random Access resources may be assigned to different NSAG(s). The UE determines Random Access configuration among NSAGs that are published in SIB for Random Access and that are associated to the S-NSSAIs triggering the access. If the signalling transaction triggering the access attempt is related to more than one network slice, and the S-NSSAIs of these network slices are associated with more than one NSAG for Random Access, the NSAG with the highest priority is selected.\nNOTE 3:\tHow the UE NAS provides the NSAGs priorities to UE AS is based internal UE interface, and not specified.\nWhen a S-NSSAI is replaced by an Alternative S-NSSAI for a UE supporting the Network Slice Replacement feature (see clause 5.15.19) then the AMF provides updated NSAG information also including the Alternative S-NSSAI to the UE when the Alternative S-NSSAI was not part of the UE Configured NSSAI and is Added to the UE configured NSSAI. The NSAG priority may take into account the Alternative S-NSSAI is a replacement of the replaced NSSAI if the Alternative S-NSSAI is not part of the UE subscription.\n5G System supports the functionality of tracking and reporting UE mobility events.\nThe AMF provides the UE mobility related event reporting to NF that has been authorized to subscribe to the UE mobility event reporting service. Any NF service consumer such as SMF, NEF, TSCTSF or NWDAF that wants to be reported on the UE location is able to subscribe to the UE mobility event notification service to the AMF with the following parameters:\n-\tEvent reporting type that specifies what to be reported on UE mobility (e.g. UE location, UE mobility on Area of Interest).\n-\tEvent filters indicating the:\n-\tArea Of Interest that specifies a location area within 3GPP system. The Area Of Interest is represented by a list of Tracking Areas, list of cells or list of (R)AN node identifiers. In the case of LADN, the event consumer (e.g. SMF) provides the \"LADN DNN\" or \"LADN DNN and S-NSSAI\" to refer the LADN service area as the Area Of Interest. In the case of PRA, the event consumer (e.g. SMF or PCF) may provide an identifier for Area Of Interest to refer predefined area as the Area Of Interest. In the case of Partial Network Slice Support and Support for Network Slices with Network Slice Area of Service not matching deployed Tracking Areas as described in clauses 5.15.17 and 5.15.18, the event consumer (e.g. SMF) provides the S-NSSAI to refer the slice restriction area (area restriction applies for the S-NSSAI) as the Area Of Interest.\n-\tThe Area Of Interest may include a \"RAN timing synchronization status change event\" indicator, indicating that the presence in Area of Interest can be determined based on the most recent N2 connection.\n-\tThe Area Of Interest may include an \"Adjust AoI based on RA\" indicator, indicating that the Area of Interest may be adjusted depending on UE's RA.\n-\tThe Area Of Interest may include the \"Notify the consumer considering UE identity\" indicator, containing a list of UE identities or Internal Group ID, and informing the AMF to notify the NF consumer about Area of Interest events only if an event is for the UE belonging to the provided list UEs. The indicator may be included when the request is targeted to Any UE.\n-\tThe Area Of Interest may include the \"Notify the consumer considering DNN/S-NSSAI\" indicator, containing one or more DNN(s)/S-NSSAI(s) and informing the AMF to notify the NF consumer about Area of Interest events only if an event is for the UE having a PDU sessions established for the specified DNN(s)/S-NSSAI(s).\n-\tS-NSSAI and optionally the NSI ID(s).\n-\tEvent Reporting Information: event reporting mode, number of reports, maximum duration of reporting, event reporting condition (e.g. when the target UE moved into a specified Area Of Interest, immediate reporting flag).\n-\tNotification Endpoint of NF service consumer to be notified.\n-\tThe target of event reporting that indicates a (list of) specific UE(s), a group of UE(s) or any UE (i.e. all UEs served by the AMF). Further details on the information provided by the NF service consumer are provided in clause 4.15 of TS 23.502 [3].\nIf an NF service consumer subscribes to the UE mobility event notification service provided by AMF for reporting of UE presence in Area Of Interest, the AMF tracks UE's location considering UE's CM state and using NG-RAN procedures (if RRC_INACTIVE state applies to NG-RAN) in order to determine the UE presence in the Area Of Interest, as described in clause 4.15.4.2 of TS 23.502 [3]. Upon detecting the change of the UE presence in the Area Of Interest, the AMF notifies the UE presence in the Area Of Interest and the new UE location to the subscribed NF service consumer.\nIf the Area Of Interest in the subscription to the UE mobility event notification includes \"RAN timing synchronization status change event\" indicator as described in Table 5.2.2.3.1-1 of TS 23.502 [3], and the registration request from the UE includes a UE 5GMM Core Network Capability with an indication for \"support for network reconnection due to RAN timing synchronization status change \" as described in clause 5.4.4.a, the AMF reports the UE presence in Area of Interest based on the most recent N2 connection as described in Annex D of TS 23.502 [3].\nIf the Area Of Interest in the subscription to the UE mobility event notification includes \"Adjust AoI based on RA\" indicator as described in Table 5.2.2.3.1-1 in TS 23.502 [3], the AMF reports the UE presence in Area of Interest based on the most recent N2 connection as described in Annex D in TS 23.502 [3].\nWhen the AMF is changed, the subscription of mobility event for a UE or group of UEs is transferred from the old AMF. Subscriptions targeted to Any UE shall not be moved to another AMF due to UE mobility. The new AMF may decide not to notify the SMF with the current status related to the subscription of mobility event if the new AMF determines that, based on MM Context of the UE, the event is reported by the old AMF.\nIn the network deployment where a UE may leave or enter the Area Of Interest without any notification to the 5GC in CM-CONNECTED state (i.e. in the case that RRC_INACTIVE state applies to the NG-RAN), the AMF may initiate the NG-RAN location reporting as described in clause 5.4.7 or N2 Notification as described in clause 4.8.3 of TS 23.502 [3] to track the UE presence in the Area Of Interest.\nThe AMF may provide UE mobility event reporting to PCF, using Policy Control Request Triggers defined in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.5\tTriggers for network analytics",
                            "text_content": "Triggers for the AMF to request for or subscribe to the analytics information from the NWDAF are internal logic in the AMF and may include for example:\n-\tUE access and mobility related event subscription by other NFs (e.g. SMF, NEF);\n-\tlocally detected events;\n-\tanalytics information received.\nThe trigger conditions may depend on operator and implementation policy in the AMF. When a trigger condition happens, the AMF may decide if any analytics information is needed and if so, request for or subscription to the analytics information from the NWDAF.\nThe AMF may, upon detection of certain local events, e.g. frequent mobility re-registration of one or more UEs, subscribe to mobility related abnormal behaviour analytics of the UE(s) as described in TS 23.288 [86] in order to trace UE mobility trend and take appropriate actions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\t3GPP access specific aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tUE reachability in CM-IDLE",
                            "text_content": "Reachability management is responsible for detecting whether the UE is reachable and providing UE location (i.e. access node) for the network to reach the UE. This is done by paging UE and UE location tracking. The UE location tracking includes both UE registration area tracking (i.e. UE registration area update) and UE reachability tracking ((i.e. UE periodic registration area update)). Such functionalities can be either located at 5GC (in the case of CM-IDLE state) or NG-RAN (in the case of CM-CONNECTED state).\nThe UE and the AMF negotiate UE reachability characteristics for CM-IDLE state during Registration procedures.\nThree UE reachability categories are negotiated between UE and AMF for CM-IDLE state:\n1.\tUE reachability allowing Mobile Terminated data while the UE is CM-IDLE state.\n-\tThe UE location is known by the network on a Tracking Area List granularity\n-\tPaging procedures apply to this category.\n-\tMobile originating and mobile terminated data apply in this category for both CM-CONNECTED and CM-IDLE state.\n2.\tMobile Initiated Connection Only (MICO) mode:\n-\tMobile originated data applies in this category for both CM-CONNECTED and CM-IDLE state.\n-\tMobile terminated data is only supported when the UE is in CM-CONNECTED state.\n3.\tUE unreachability due to Unavailability Period:\n-\tMobile originated data and Mobile terminated data are not transmitted in this category (handling of data by extending buffering may apply).\n-\tPaging procedure is not applicable to this category.\nWhenever a UE in RM-REGISTERED state enters CM-IDLE state, it starts a periodic registration timer according to the periodic registration timer value received from the AMF during a Registration procedure.\nThe AMF allocates a periodic registration timer value to the UE based on local policies, subscription information and information provided by the UE. After the expiry of the periodic registration timer, the UE shall perform a periodic registration. If the UE moves out of network coverage when its periodic registration timer expires, the UE shall perform a Registration procedure when it next returns to the coverage.\nThe AMF runs a Mobile Reachable timer for the UE. The timer is started with a value longer than the UE's periodic registration timer whenever the CM state for the UE in RM-REGISTERED state changes to CM-IDLE. If the AMF receives an elapsed time from RAN when RAN initiate UE context release indicating UE unreachable, the AMF should deduce a Mobile Reachable timer value based on the elapsed time received from RAN and the normal Mobile Reachable timer value. The AMF stops the Mobile Reachable timer, if the UE CM state in the AMF moves to CM-CONNECTED state. If the Mobile Reachable timer expires, the AMF determines that the UE is not reachable.\nHowever, the AMF does not know for how long the UE remains not reachable, thus the AMF shall not immediately de-register the UE. Instead, after the expiry of the Mobile Reachable timer, the AMF should clear the PPF and shall start an Implicit De-registration timer, with a relatively large value. The AMF shall stop the Implicit De-registration timer and set the PPF if the AMF moves the UE CM state in the AMF to CM-CONNECTED state.\nNOTE:\tIf the UE CM state in the AMF is CM-IDLE, then AMF considers the UE always unreachable if the UE is in MICO mode (refer to clause 5.4.1.3).\nIf the UE indicates an Unavailability Period Duration, then AMF shall consider the UE as unreachable and will not trigger the Paging procedure (e.g. clear the PPF) until the UE registers for normal service again (e.g. set the PPF). Once the event that makes the UE unavailable is completed or cancelled in the UE, the UE shall initiate the registration procedure in order to resume normal service.\nIf the PPF is not set, the AMF does not page the UE and shall reject any request for delivering DL signalling or data to this UE.\nIf the Implicit De-registration timer expires before the UE contacts the network, the AMF implicitly de-register the UE.\nAs part of deregistration for a particular access (3GPP or non-3GPP), the AMF shall request the UE's related SMF to release the PDU Sessions established on that access.\nThe AMF considers a UE in RM-REGISTERED state to be reachable by CN paging if the UE CM state in the AMF is CM-IDLE state unless the UE applies MICO mode or the UE has indicated Unavailability Period Duration..\nA UE may indicate preference for MICO mode during Initial Registration or Mobility Registration Update procedure. The AMF, based on local configuration, Expected UE Behaviour and/or Network Configuration parameters if available from the UDM, UE indicated preferences, UE subscription information and network policies, or any combination of them, determines whether MICO mode is allowed for the UE and indicates it to the UE during Registration procedure. If NWDAF is deployed, the AMF may also use analytics on UE mobility and/or UE communication generated by NWDAF (see TS 23.288 [86]) to decide MICO mode parameters. If the UE does not indicate preference for MICO mode during Registration procedure, the AMF shall not activate MICO mode for this UE.\nThe UE and the AMF re- negotiate the MICO mode at every subsequent Registration procedure. When the UE is in CM-CONNECTED, the AMF may deactivate MICO mode by triggering Mobility Registration Update procedure through UE Configuration Update procedure as described in clause 4.2.4 of TS 23.502 [3].\nThe AMF assigns a registration area to the UE during the Registration procedure. When the AMF indicates MICO mode to a UE, the registration area is not constrained by paging area size. If the AMF serving area is the whole PLMN, based on local policy, and subscription information, may decide to provide an \"all PLMN\" registration area to the UE. In that case, re-registration to the same PLMN due to mobility does not apply.\nIf Mobility Restrictions are applied to a UE in MICO mode, the AMF needs to allocate an Allowed Area/Non-Allowed Area to the UE as specified in clause 5.3.4.1.\nWhen the AMF indicates MICO mode to a UE, the AMF considers the UE always unreachable while the UE CM state in the AMF is CM-IDLE. The AMF rejects any request for downlink data delivery for UE in MICO mode and whose UE CM state in the AMF is CM-IDLE with an appropriate cause. For MT-SMS over NAS, the AMF notifies the SMSF that UE is not reachable, then the procedure of the unsuccessful Mobile terminating SMS delivery described in clause 4.13.3.9 of TS 23.502 [3] is performed. The AMF also defers location services, etc. The UE in MICO mode is only reachable for mobile terminated data or signalling when the UE is in CM-CONNECTED.\nA UE in MICO mode need not listen to paging while in CM-IDLE. A UE in MICO mode may stop any access stratum procedures in CM-IDLE, until the UE initiates transition from CM-IDLE to CM-CONNECTED due to one of the following triggers:\n-\tA change in the UE (e.g. change in configuration) requires an update of its registration with the network.\n-\tPeriodic registration timer expires.\n-\tMO data pending.\n-\tMO signalling pending (e.g. SM procedure initiated).\nIf a registration area that is not the \"all PLMN\" registration area is allocated to a UE in MICO mode, then the UE determines if it is within the registration area or not when it has MO data or MO signalling, and the UE performs Mobility Registration Update before the UE initiates the MO data or MO signalling if it is not within the registration area.\nA UE initiating emergency service shall not indicate MICO preference during Registration procedure. When the MICO mode is already activated in the UE, the UE and AMF shall locally disable MICO mode after PDU Session Establishment procedure for Emergency Services is completed successfully. The UE and the AMF shall not enable MICO mode until the AMF accepts the use of MICO mode in the next registration procedure. To enable an emergency call back, the UE should wait for a UE implementation-specific duration of time before requesting the use of MICO mode after the release of the emergency PDU session.\nIn order to enable power saving for MT reachability e.g. for Cellular IoT, enhancements to MICO mode are specified in clause 5.31.7:\n-\tMICO mode with Extended Connected Time.\n-\tMICO mode with Active Time.\n-\tMICO mode and Periodic Registration Timer Control.\nDuring Registration procedure, the UE supporting the Unavailability Period feature provides \"Unavailability Period Support\" indication as part of 5GMM Core Network Capability in Registration Request message for initial registration and for every mobility registration. The AMF indicates whether the corresponding feature is supported in the AMF by providing the \"Unavailability Period Support\" indication in Registration Accept message.\nIf the UE and network support Unavailability Period and an event is triggered in the UE that would make the UE unavailable or lose coverage (see clause 5.4.13.1) for a certain period of time, the UE uses Support of Unavailability Period to inform the AMF of the expected unavailability and whether it is due to NR satellite access discontinuous coverage. Use of Support of Unavailability Period for loss of coverage due to NR satellite access discontinuous coverage shall only be used if both UE and the AMF signalled \"Unavailability Period Support\", see clause 5.4.13.1.\nIf the use of Support of Unavailability Period procedure is not due to NR satellite access discontinuous coverage, the UE may store its MM and SM context in the USIM or Non-Volatile memory in the ME to be able to reuse it after its unavailability period. If the UE can store its contexts the UE may trigger Mobility Registration Update procedure otherwise the UE shall trigger UE-initiated Deregistration procedure.\nNOTE 1:\tHow and where the UE stores its contexts depends upon the UE implementation and the Unavailability Type. The UE can store some or all of its contexts in the ME or USIM using existing ME or USIM functionality.\nBefore the start of an event that makes the UE unavailable, the UE triggers either Mobility Registration Update or UE initiated Deregistration procedure:\na)\tIf the UE initiates Mobility Registration Update procedure:\n0)\tThe UE includes an Unavailability Type to describe the cause of unavailability (e.g. the unavailability caused by NR satellite access discontinuous coverage), the Start of the Unavailability Period if known and the Unavailability Period Duration (if known).\n1)\tIf the UE did not include a Start of Unavailability Period, the AMF considers implicitly the Start of Unavailability Period to be the time at which it has received the Registration Request message from the UE. If the UE included a Start of Unavailability Period, the Start of Unavailability Period indicates the time at which the UE determines it expects to be unavailable, i.e. time until which the UE determines it is available.\n2)\tThe AMF may determine, if not provided by the UE, or update the Unavailability Period Duration and/or the Start of Unavailability Period.\nIf the AMF knows an Unavailability Period Duration and/or the Start of Unavailability Period (e.g. based on the Unavailability Type and other information available to the AMF as described in clause 5.4.13.3), and the UE did not include an Unavailability Period Duration and/or the Start of Unavailability Period or the UE included an Unavailability Period Duration and/or the Start of Unavailability Period different to the Unavailability Period Duration and/or the Start of Unavailability Period known to the AMF, the AMF may use either the Unavailability Period Duration and/or the Start of Unavailability Period known to the AMF or the Unavailability Period Duration and/or the Start of Unavailability Period from the UE as the Unavailability Period Duration and/or the Start of Unavailability Period. The AMF should include the Unavailability Period Duration and/or the Start of Unavailability Period known to the AMF in the Registration Accept. How the UE treats the AMF provided Unavailability Period Duration and/or the Start of Unavailability Period is up to UE implementation e.g. to help to determine when to return to coverage after a discontinuous coverage period, whether to listen to paging in eDRX, not to initiate any NAS signalling (including Service Request for MO data) within the discontinuous coverage period in case of any UL signalling/data request or the UE may deactivate its Access Stratum functions for NR satellite access in order to optimise power consumption until coverage returns, etc.\n3)\tThe AMF indicates to the UE in the Registration Accept whether the UE is not required to perform a Registration procedure when the unavailability period has ended.\n4)\tThe AMF may take the Unavailability Period Duration (if available) and Start of Unavailability Period into account when determining Periodic Registration Update timer value. The AMF may provide a Periodic Registration Update time longer than or equal to the combination of the Unavailability Period Duration and Start of Unavailability Period to avoid interfering with the UE dealing with the event that causes the unavailability;\n5)\tThe AMF stores the information that the UE is unavailable at the Start of Unavailability Period in UE context, and considers the UE is unreachable (i.e. clear the PPF in AMF) from then until the UE enters CM-CONNECTED state;\n6)\tWhile the UE is unreachable, all high latency communication solutions (see clause 5.31.8) apply if supported in the network, e.g. extended data buffering, downlink data buffering status report, etc; and\n7)\tIf there is \"Loss of Connectivity\" event subscription for the UE by AF, the AMF at the start of Unavailability Period considers the remaining time in the Unavailability Period (if available) when constructing the \"Loss of Connectivity\" event report towards the NEF and the remaining time in the Unavailability Period is reported to the respective subscribed AF.\nb)\tIf the UE initiates UE-initiated Deregistration procedure:\n0)\tThe UE includes Unavailability Period Duration (if known).\n1)\tIf there is \"Loss of Connectivity\" event subscription for the UE by AF, the AMF considers the remaining time in the Unavailability Period when constructing the \"Loss of Connectivity\" event report towards the NEF and the Unavailability Period is reported to the respective subscribed AF;\nUnless the AMF indicated that the UE is not required to perform a Registration procedure when the unavailability period has ended, then once the event which makes the UE unavailable is completed in the UE, the UE triggers a Registration procedure. If the event which makes the UE unavailable is delayed to a future time or cancelled in the UE or unavailability period deviates from negotiated value, the UE triggers Registration procedure. The UE may also trigger a Registration procedure before the Unavailability Period has started for other reasons. Depending on the UE state, the Registration procedure can be Initial Registration procedure or Mobility Registration Update procedure.\nWhile the UE is in 5GS and if the UE determines that an upcoming loss of coverage no longer applies or determines a new Start of Unavailability Period or Unavailability Period Duration related to the upcoming loss of coverage, the UE sends a new Mobility Registration Update Request to the AMF to update the Start of Unavailability Period and/or Unavailability Period Duration.\nThe UE and the AMF re-negotiate unavailability at every Registration procedure, if it is required. If Start of Unavailability Period and/or Unavailability Period Duration is not included in a Registration procedure any pending unavailability configuration stored in the UE context at AMF is discarded.\nIf the UE moves to EPS, the UE performs Attach or Tracking Area update procedure depending on the interworking mechanisms defined in clause 5.17.2.\nFor discontinuous coverage in E-UTRAN satellite access in EPS, the \"Unavailability Period\" is also supported (see clause 4.13.8.2 of TS 23.401 [26]).\nNOTE 2:\tIn this release of specification there is no transfer of \"unavailability period\" between AMF and MME and vice versa.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tUE reachability in CM-CONNECTED",
                            "text_content": "For a UE in CM-CONNECTED state:\n-\tthe AMF knows the UE location on a serving (R)AN node granularity.\n-\tthe NG-RAN notifies the AMF when UE becomes unreachable from RAN point of view.\nUE RAN reachability management is used by RAN for UEs in RRC_INACTIVE state, see TS 38.300 [27]. The location of a UE in RRC_INACTIVE state is known by the RAN on a RAN Notification area granularity. A UE in RRC_INACTIVE state is paged in cells of the RAN Notification area that is assigned to the UEs. The RAN Notification area can be a subset of cells configured in UE's Registration Area or all cells configured in the UE's Registration Area. UE in RRC_INACTIVE state performs RAN Notification Area Update when entering a cell that is not part of the RAN Notification area that is assigned to the UE.\nAt transition into RRC_INACTIVE state RAN configures the UE with a periodic RAN Notification Area Update timer value and the timer is restarted in the UE with this initial timer value. After the expiry of the periodic RAN Notification Area Update timer in the UE, the UE in RRC_INACTIVE state performs periodic RAN Notification Area Update, as specified in TS 38.300 [27].\nTo aid the UE reachability management in the AMF, RAN uses a guard timer with a value longer than the RAN Notification Area Update timer value provided to the UE. Upon the expiry of the periodic RAN Notification Area Update guard timer in RAN, the RAN shall initiate the AN Release procedure as specified in TS 23.502 [3]. The RAN may provide the elapsed time since RAN's last contact with the UE to AMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tPaging strategy handling",
                            "text_content": "Based on operator configuration, the 5GS supports the AMF and NG-RAN to apply different paging strategies for different types of traffic.\nIn the case of UE in CM-IDLE state, the AMF performs paging and determines the paging strategy based on e.g. local configuration, what NF triggered the paging and information available in the request that triggered the paging. If NWDAF is deployed, the AMF may also use analytics (i.e. statistics or predictions) on the UE's mobility as provided by NWDAF (see TS 23.288 [86]).\nIn the case of UE in CM-CONNECTED with RRC_INACTIVE state, the NG-RAN performs paging and determines the paging strategy based on e.g. local configuration, and information received from AMF as described in clause 5.4.6.3 and SMF as described in clause 5.4.3.2.\nIn the case of Network Triggered Service Request from SMF, the SMF determines the 5QI and ARP based on the downlink packet (if the SMF performs buffering) or the Downlink Data Report received from UPF (if the UPF performs buffering). The SMF includes the 5QI and ARP corresponding to the QoS Flow of the received downlink PDU in the request sent to the AMF. If the UE is in CM IDLE, the AMF uses e.g. the 5QI and ARP to derive different paging strategies as described in clause 4.2.3.3 of TS 23.502 [3].\nNOTE:\tThe 5QI is used by AMF to determine suitable paging strategies.\nPaging policy differentiation is an optional feature that allows the AMF, based on operator configuration, to apply different paging strategies for different traffic or service types provided within the same PDU Session. In this Release of the specification this feature applies only to PDU Session of IP type.\nWhen the 5GS supports the Paging Policy Differentiation (PPD) feature, the DSCP value (TOS in IPv4 / TC in IPv6) is set by the application to indicate to the 5GS which Paging Policy should be applied for a certain IP packet. For example, as defined in TS 23.228 [15], the P-CSCF may support Paging Policy Differentiation by marking packet(s) to be sent towards the UE that relate to a specific IMS services (e.g. conversational voice as defined in IMS multimedia telephony service).\nNOTE 1:\tThis PPD feature may be used to determine the Paging Cause Indication for Voice Service, as described in clause 5.38.3.\nIt shall be possible for the operator to configure the SMF in such a way that the Paging Policy Differentiation feature only applies to certain HPLMNs, DNNs and 5QIs. In the case of HR roaming, this configuration is done in the SMF in the VPLMN.\nNOTE 2:\tSupport of Paging Policy Differentiation in the case of HR roaming requires inter operator agreements including on the DSCP value associated with this feature.\nIn the case of Network Triggered Service Request and UPF buffering downlink packets, the UPF shall include the DSCP in TOS (IPv4) / TC (IPv6) value from the IP header of the downlink packet and an indication of the corresponding QoS Flow in the Downlink Data Report sent to the SMF. When PPD applies, the SMF determines the Paging Policy Indicator (PPI) based on the DSCP received from the UPF.\nIn the case of Network Triggered Service Request and SMF buffering downlink packets, when PPD applies, the SMF determines the PPI based on the DSCP in TOS (IPv4) / TC (IPv6) value from the IP header of the received downlink packet and identifies the corresponding QoS Flow from the QFI of the received downlink packet.\nThe SMF includes the PPI, the ARP and the 5QI of the corresponding QoS Flow in the N11 message sent to the AMF. If the UE is in CM IDLE, the AMF uses this information to derive a paging strategy, and sends paging messages to NG-RAN over N2.\nNOTE 3:\tNetwork configuration needs to ensure that the information used as a trigger for Paging Policy Indication is not changed within the 5GS.\nNOTE 4:\tNetwork configuration needs to ensure that the specific DSCP in TOS (IPv4) / TC (IPv6) value, used as a trigger for Paging Policy Indication, is managed correctly in order to avoid the accidental use of certain paging policies.\nFor a UE in RRC_INACTIVE state the NG-RAN may enforce specific paging policies in the case of NG-RAN paging, based on 5QI, ARP and PPI associated with an incoming DL PDU. To enable this, the SMF instructs the UPF to detect the DSCP in the TOS (IPv4) / TC (IPv6) value in the IP header of the DL PDU (by using a DL PDR with the DSCP for this traffic) and to transfer the corresponding PPI in the CN tunnel header (by using a QER with the PPI value). The NG-RAN can then utilize the PPI received in the CN tunnel header of an incoming DL PDU in order to apply the corresponding paging policy for the case the UE needs to be paged when in RRC_INACTIVE state. In the case of Home-Routed roaming, the V-SMF is responsible of controlling UPF setting of the PPI. In the case of PDU Session with I-SMF, the I-SMF is responsible of controlling UPF setting of the PPI.\nPaging Priority is a feature that allows the AMF to include an indication in the Paging Message sent to NG-RAN that the UE be paged with priority. The decision by the AMF whether to include Paging Priority in the Paging Message is based on the ARP value in the message received from the SMF for an IP packet waiting to be delivered in the UPF. If the ARP value is associated with select priority services (e.g. MPS, MCS), the AMF includes Paging Priority in the Paging Message. When the NG-RAN receives a Paging Message with Paging Priority, it handles the page with priority.\nThe AMF while waiting for the UE to respond to a page sent without priority receives another message from the SMF with an ARP associated with select priority services (e.g. MPS, MCS), the AMF sends another Paging message to the (R)AN including the Paging Priority. For subsequent messages, the AMF may determine whether to send the Paging message with higher Paging Priority based on local policy.\nFor a UE in RRC_INACTIVE state, the NG-RAN determines Paging Priority based on the ARP associated with the QoS Flow as provisioned by the operator policy, and the Core Network Assisted RAN paging information from AMF as described in clause 5.4.6.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4\tUE Radio Capability handling",
                            "text_content": "This clause applies when no radio capability signalling optimisation is used between a UE and the network.\nThe UE Radio Capability information is defined in TS 38.300 [27] and contains information on RATs that the UE supports (e.g. power class, frequency bands, etc). Consequently, this information can be sufficiently large that it is undesirable to send it across the radio interface at every transition of UE CM state in the AMF from CM-IDLE to CM-CONNECTED. To avoid this radio overhead, the AMF shall store the UE Radio Capability information during CM-IDLE state for the UE and RM-REGISTERED state for the UE and the AMF shall if it is available, send its most up to date UE Radio Capability information to the RAN in the N2 REQUEST message, i.e. INITIAL CONTEXT SETUP REQUEST or UE RADIO CAPABILITY CHECK REQUEST.\nNOTE 1:\tDue to issues with the handling of dynamic UMTS security parameters, the UTRA UE Radio Capability information is excluded from the information that is uploaded and stored in the AMF (see TS 38.300 [27]).\nThe AMF deletes the UE radio capability when the UE RM state in the AMF transitions to RM-DEREGISTERED. When the AMF receives Registration Request with the Registration type set to Initial Registration or when it receives the first Registration Request after E-UTRA/EPC Attach with Registration type set to Mobility Registration Update, the AMF deletes the UE radio capability.\nThe UE Radio Capability is maintained in the core network, even during AMF reselection.\nNOTE 2:\tThe UE Radio Capability is not transferred to EPC during the inter-system mobility.\nIf the UE's NG-RAN or E-UTRAN UE Radio Capability information changes while in CM-IDLE state, the UE shall perform the Registration procedure with the Registration type set to Mobility Registration Update and it also includes \"UE Radio Capability Update\". (For specific requirements for a UE operating in dual-registration mode see clause 5.17.2.1). When the AMF receives Mobility Registration Update Request with \"UE Radio Capability Update\" requested by the UE, it shall delete any UE Radio Capability information that it has stored for the UE. If the UE's NG-RAN UE Radio Capability information changes when the UE is in CM-IDLE with Suspend, NAS shall trigger AS to establish a new RRC connection and not resume the existing one in order to perform the Registration procedure with the Registration type set to Mobility Registration Update including \"UE Radio Capability Update\". As a result of this, the access stratum in the UE will discard the AS information and establish a new RRC connection as defined in TS 36.331 [51].\nIf the trigger to change the UE's NG-RAN or E-UTRAN UE Radio Capability information happens when the UE is in CM-CONNECTED state, the UE shall first enter CM-IDLE state and then perform the Registration procedure with the Registration type set to Mobility Registration Update and it also includes \"UE Radio Capability Update\".\nThe RAN stores the UE Radio Capability information, received in the N2 message or obtained from the UE, for the duration of the UE staying in RRC_CONNECTED or RRC_INACTIVE state. Before any 5G SRVCC handover attempt from NG-RAN to UTRAN, the RAN retrieves the UE's UTRA UE Radio Capabilities from the UE. (For specific requirements for a UE operating in dual-registration mode see clause 5.17.2.1).\nIf the AMF sends N2 REQUEST (i.e. INITIAL CONTEXT SETUP REQUEST or UE RADIO CAPABILITY CHECK REQUEST) message to NG-RAN without UE Radio Capability information in that message and there is no UE Radio Capability information available in RAN, this triggers the RAN to request the UE Radio Capability from the UE and to upload it to the AMF in the N2 UE RADIO CAPABILITY INFO INDICATION message.\nIf a UE supports both NB-IoT and other RATs the UE handles the UE Radio capability information as follows:\n-\tWhen the UE is camping on NB-IoT the UE provides only NB-IoT UE radio capabilities to the network.\n-\tWhen the UE is not camping on NB-IoT, the UE provides UE radio capabilities for the RAT but not NB-IoT UE radio capabilities to the network.\nIn order to handle the distinct UE radio capabilities, the AMF stores a separate NB-IoT specific UE Radio Capability information when the UE provides the UE Radio Capability information while camping on NB-IoT.\nWhen the UE is camping on NB-IoT, the AMF sends, if available, the NB-IoT RAT specific UE Radio Capability information to the E-UTRAN.\nWhen the UE is not camping on NB-IoT, the AMF sends, if available, UE radio capabilities for the RAT but not NB-IoT radio capabilities.\nWith the increase of the size of UE radio capabilities driven e.g. by additional frequency bands and combinations thereof for E-UTRA and NR, an efficient approach to signal UE Radio Capability Information over the radio interface and other network interfaces is defined with RACS.\nIn this Release of the specification, RACS does not apply to NB-IOT.\nRACS works by assigning an identifier to represent a set of UE radio capabilities. This identifier is called UE Radio Capability ID. A UE Radio Capability ID can be either UE manufacturer-assigned or PLMN-assigned, as specified in clause 5.9.10. The UE Radio Capability ID is an alternative to the signalling of the UE Radio Capability information over the radio interface, within NG-RAN, from NG-RAN to E-UTRAN, from AMF to NG-RAN and between CN nodes supporting RACS.\nPLMN-assigned UE Radio Capability ID is assigned to the UE using the UE Configuration Update Command, or Registration Accept as defined in TS 23.502 [3]. The UCMF shall be configured with a Version ID for PLMN-assigned UE Radio Capability IDs, defined in clause 5.9.10.\nThe UCMF (UE radio Capability Management Function) stores all UE Radio Capability ID mappings in a PLMN and is responsible for assigning every PLMN-assigned UE Radio Capability ID in this PLMN, see clause 6.2.21. The UCMF stores the UE Radio Capability IDs alongside the UE Radio Capability information and the UE Radio Capability for Paging they map to. Each UE Radio Capability ID stored in the UCMF can be associated to one or both UE radio capabilities formats specified in TS 36.331 [51] and TS 38.331 [28]. The two UE radio capabilities formats shall be identifiable by the AMF and UCMF and the AMF shall store the TS 38.331 [28] format only.\nAn NG-RAN which supports RACS can be configured to operate with one of two modes of operation when providing the UE radio capabilities to the AMF when the NG-RAN executes a UE Radio Capability Enquiry procedure (see TS 38.331 [28]) to retrieve UE radio capabilities from the UE:\n-\tMode of operation A): The NG-RAN provides to the AMF both formats (i.e. the TS 38.331 [28] format and TS 36.331 [51] format). The NG-RAN derives one of the UE Radio Capability formats using local transcoding of the other format it receives from the UE and extracts the E-UTRAN UE Radio Capability for Paging and NR UE Radio Capability for Paging from the UE Radio capabilities.\n-\tMode of operation B): The NG-RAN provides to the AMF the TS 38.331 [28] format only.\nIn a PLMN supporting RACS only in 5GS, Mode of Operation B shall be configured.\nIf the PLMN supports RACS in both EPS and 5GS:\n-\tIf RAN nodes in the EPS and 5GS are configured in Mode of operation B, then the UCMF shall be capable to transcode between TS 36.331 [51] and TS 38.331 [28] formats and the UCMF shall be able to generate the RAT-specific UE Radio Capability for Paging information from the UE Radio Capability.\n-\tIf the NG-RAN is configured to operate according to Mode A, then also the E-UTRAN shall be configured to operate according to mode A and the UMCF is not required to transcode between TS 36.331 [51] and TS 38.331 [28] formats and the AMF shall provide the UE Radio Capability for Paging information.\nWhen the NG-RAN updates the AMF with new UE radio capabilities information, the AMF provides the information obtained from the NG-RAN to the UCMF even if the AMF already has a UE Radio Capability ID for that UE. The UCMF then returns a value of UE Radio Capability ID. If the value is different from the one stored in the AMF, the AMF updates the UE Radio Capability ID it stores and provides this new value to the NG-RAN (if applicable) and to the UE.\nIn order to be able to interpret the UE Radio Capability ID a Network Function or node may store a local copy of the mapping between the UE Radio Capability ID and its corresponding UE Radio Capability information i.e. a dictionary entry. When no mapping is available between a UE Radio Capability ID and the corresponding UE Radio Capability information in a Network Function or node, this Network Function or node shall be able to retrieve this mapping and store it.\n-\tAn AMF which supports RACS shall store such UE Radio Capability ID mapping at least for all the UEs that it serves that have a UE Radio Capability ID assigned.\n-\tThe NG-RAN performs local caching of the UE Radio Capability information for the UE Radio Capability IDs for the UEs it is serving, and potentially for other UE Radio Capability IDs according to suitable local policies.\n-\tWhen the NG-RAN needs to retrieve the mapping of a UE Radio Capability ID to the corresponding UE Radio Capability information, it queries the AMF using N2 signalling defined in TS 38.413 [34].\n-\tWhen the AMF needs to obtain a PLMN-assigned UE Radio Capability ID for a UE from the UCMF, it provides the UE Radio Capability information it has for the current radio configuration of the UE and the IMEI/TAC for the UE and the UCMF returns a UE Radio Capability ID. The AMF shall provide to the UCMF the UE Radio Capability information (and at least in Mode A, the UE Radio Capability for Paging) obtained from the NG-RAN in one or both the TS 36.331 [51] and TS 38.331 [28] formats depending on how the RAN is configured. The UCMF stores the association of this IMEI/TAC with this UE Radio Capability ID and the UE Radio Capability information and the UE Radio Capability for Paging in all the formats it receives. The UE Radio Capability information formats the AMF provides shall be identifiable at the UCMF.\n-\tWhen the AMF needs to obtain the UE Radio Capability information and the UE Radio Capability for Paging associated to a UE Radio Capability ID it provides the UE Radio Capability ID to the UCMF with an indication that it is requesting the TS 38.331 [28] format and the UCMF returns a mapping of the UE Radio Capability ID to the corresponding UE Radio Capability information in TS 38.331 [28] format to the AMF.\n-\tUEs, AMFs and RAN nodes which support RACS learn the current value of the Version ID when a new PLMN-assigned UE Radio Capability ID is received from the UCMF and the Version ID it contains is different from the ones in their PLMN Assigned UE Radio Capability ID cache. For a PLMN, PLMN-assigned UE Radio Capability IDs related to old values (i.e. not current value) of the Version ID can be removed from cache but, if so, prior to removing any cached PLMN-assigned UE radio Capability IDs with the current value of the Version ID. The AMF, RAN and UE may continue to use the stored PLMN assigned UE Radio Capability IDs with old values of the Version ID, until these are purged from cache. If an out of date PLMN assigned UE Radio Capability ID is removed form an AMF cache, the AMF shall proceed to assign a new PLMN assigned UE Radio Capability ID to all the UEs for which the UE context includes the removed PLMN-assigned UE Radio Capability ID using a UE Configuration Update procedure, or when these UEs perform a Registration. If the AMF attempts to resolve a PLMN assigned UE Radio capability ID with an old Version ID, the UCMF shall return an error code indicating that the Version ID in the UE radio capability ID is no longer current and proceed to assign a new UE Radio Capability ID to the UE.\nIf at any time the AMF has neither a valid UE Radio Capability ID nor any stored UE radio capabilities for the UE, the AMF may trigger the RAN to provide the UE Radio Capability information and subsequently request the UCMF to allocate a UE Radio Capability ID.\n-\tThe RAN, in order to support MOCN network sharing scenarios, shall be capable to cache PLMN assigned UE Radio Capability IDs per PLMN ID.\nA network may utilise the PLMN-assigned UE Radio Capability ID, without involving the UE, e.g. for use with legacy UEs.\nMutual detection of the support of the RACS feature happens between directly connected NG-RAN nodes and between NG-RAN and AMF using protocol means as defined in TS 38.413 [34] and TS 38.423 [99]. To allow for a mix of RACS-supporting and non-RACS-supporting RAN nodes over the Xn interfaces, the UE Radio Capability ID should be included in the Path Switch signalling during Xn based handover and Handover Request during N2 based handover between AMF and NG-RAN. In addition, RACS-supporting RAN nodes can be discovered across inter-CN node boundaries by using the mechanism defined in TS 38.413 [34] that allows the source NG-RAN node to retrieve information on the level of support for a certain feature at the target NG-RAN side by means of information provided within the Source to Target and Target to Source transparent handover containers during handover procedure. The support of RACS by peer AMFs or MMEs is based on configuration in a PLMN or across PLMNs.\nA UE that supports WB-E-UTRA and/or NR indicates its support for RACS to AMF using UE MM Core Network Capability as defined in clause 5.4.4a.\nA UE that supports RACS and stores an applicable UE Radio Capability ID for the current UE Radio Configuration in the PLMN, shall signal the UE Radio Capability ID in the Initial, and Mobility Registration procedure as defined in TS 23.502 [3] and based on triggers defined in TS 24.501 [47]. If both PLMN-assigned for the current PLMN and UE manufacturer-assigned UE Radio Capability IDs are stored in the UE and applicable in the PLMN, the UE shall signal the PLMN-assigned UE Radio Capability ID in the Registration Request message.\nWhen a PLMN decides to switch to request a particular type of UE to use UE manufacturer-assigned UE Radio Capability ID(s):\n-\tThe UCMF sends a Nucmf_UECapabilityManagement_Notify message to the AMF including either a list of UE Radio Capability IDs (if the UE was previously using any PLMN-assigned IDs) or the IMEI/TAC values corresponding to UE types that are requested to use UE manufacturer-assigned UE Radio Capability ID. These values are stored in a \"UE Manufacturer Assigned operation requested list\" in the AMF.\n-\tThe AMF uses the Registration Accept message or the UE Configuration Update command message to request the UE to delete all the PLMN-assigned UE Radio Capability ID(s) for this PLMN if the UE is, respectively, registering or is registered with PLMN-assigned ID or IMEI/TAC values matching one value in the \"UE Manufacturer Assigned operation requested list\".\nNOTE 1:\tIt is expected that in a given PLMN the UCMF and AMFs will be configured to either use a UE manufacturer-assigned operation requested list based on a list of PLMN-assigned UE Radio Capability IDs or a list of IMEI/TACs, but not both.\nNOTE 2:\tThe strategy for triggering of the deletion of PLMN-assigned UE Radio Capability ID(s) in the UE by the AMF is implementation-specific (e.g. can be used only towards UEs in CM-CONNECTED state).\n-\ta UE that receives indication to delete all the PLMN-assigned UE Radio Capability IDs in the Registration Accept message, or UE Configuration Update command message, shall delete any PLMN-assigned UE Radio Capability IDs for this PLMN. The UE proceeds to register with a UE manufacturer-assigned UE Radio Capability ID that is applicable to the current UE Radio configuration.\n-\tWhen the \"UE Manufacturer Assigned operation requested list\" contains PLMN-assigned UE Radio Capability IDs, the UCMF shall avoid re-assigning PLMN-assigned UE Radio Capability IDs that were added to the \"UE Manufacturer Assigned operation requested list\" in the AMFs to any UE.\n-\tThe AMF stores a PLMN-assigned ID in the \"UE Manufacturer Assigned operation requested list\" for a time duration that is implementation specific, but IMEI/TACs are stored until the UCMF require to remove certain TACs from the list (i.e. the list of IMEI/TACs which are requested to use UE manufacturer-assigned IDs in the AMF and UCMF is synchronised at all times).\n-\tThe UCMF can request at any time the AMF to remove PLMN-assigned ID(s) or IMEI/TAC(s) values from the UE manufacturer-assigned operation requested list.\nNOTE 3:\tThe AMF can decide to remove a UE Radio Capability ID from the \"UE Manufacturer Assigned operation requested list\" list e.g. because no UE with that UE Radio Capability ID has connected to the network for long time. If later a UE with such UE Radio Capability ID connects to the network, the AMF contacts the UCMF to resolve the UE Radio Capability ID, and at this point the UCMF can trigger again the deletion of the UE Radio Capability ID by including this in the \"UE Manufacturer Assigned operation requested list\" of the AMF.\nThe serving AMF stores the UE Radio Capability ID related to selected PLMN for a UE in the UE context and provides this UE Radio Capability ID to NG-RAN as part of the UE context information using N2 signalling. During inter PLMN mobility, the new AMF shall delete the UE Radio Capability ID received from the old AMF, unless the operator policy indicates that all UE Radio Capability IDs used in the old PLMN is also valid in the new PLMN.\nNOTE 4:\tIf AMF decides to allocate TAIs of multiple PLMN IDs as part of Registration Area to the UE then AMF provides the UE Radio Capability ID of the new selected PLMN to the NG-RAN during UE mobility, whether the UE Radio Capability ID is taken from stored UE context previously assigned by the same new selected PLMN or generated freshly each time a new PLMN is selected is up to AMF implementation.\nThe UE stores the PLMN-assigned UE Radio Capability ID in non-volatile memory when in RM-DEREGISTERED state and can use it again when it registers in the same PLMN.\nNOTE 5:\tIt is assumed that UE does not need to store the access stratum information (i.e. UE-E-UTRA-Capability and UE-NR-Capability specified in TS 36.331 [51] and TS 38.331 [28], respectively) that was indicated by the UE to the network when the PLMN-assigned UE Radio Capability ID was assigned by the network. However, it is assumed that the UE does store the related UE configuration (e.g. whether or not GERAN or UTRAN or MBMS is enabled/disabled).\nAt any given time at most one UE Radio Capability ID is used from the UE context in CN and RAN which is related to the selected PLMN.\nThe number of PLMN-assigned UE Radio Capability IDs that the UE stores in non-volatile memory is left up to UE implementation. However, to minimise the load (e.g. from radio signalling) on the Uu interface and to provide smoother inter-PLMN mobility (e.g. at land borders) the UE shall be able to store at least the latest 16 PLMN-assigned UE Radio Capability IDs (along with the PLMN that assigned them). This number is independent of the UE manufacturer-assigned UE Radio Capability ID(s) the UE may store.\nIt shall be possible for a UE to change, e.g. upon change in its usage settings, the set of UE radio capabilities in time and signal the associated UE Radio Capability ID, if available. The UE stores the mapping between the UE Radio Capability ID and the corresponding UE Radio Capability Information for every UE Radio Capability ID it stores.\nIf the UE's Radio Capability Information changes and regardless of whether the UE has an associated UE Radio Capability ID for the updated UE Radio Capability information, the UE shall perform the Registration procedure by sending a Registration Request message to the AMF with the Registration type set to Mobility Registration Update which includes \"UE Radio Capability Update\" and:\n-\tIf the UE has an associated UE Radio Capability ID for the updated UE Radio Capability information, the UE shall include it in the Registration Request message so that the AMF, upon receiving it, shall update the UE's context with this UE Radio Capability ID.\n-\tIf the UE does not have an associated UE Radio Capability ID for the updated UE Radio Capability information, the UE shall not include any UE Radio Capability ID in the Registration Request message so that the AMF, upon receiving this Registration Request without any UE Radio Capability ID, retrieves the UE radio capabilities from the UE as defined in clause 5.4.4.1.\nThe NG-RAN may apply RRC filtering of UE radio capabilities when it retrieves the UE Radio Capability Information from the UE as defined in TS 38.331 [28].\nNOTE 6:\tIn a RACS supporting PLMN, the filter of UE radio capabilities configured in NG-RAN is preferably as wide in scope as possible (e.g. PLMN-wide). In this case, it corresponds e.g. to the super-set of bands, band-combinations and RATs the PLMN deploys and not only to the specific NG-RAN node or region.\nNOTE 7:\tIf the filter, included in the UE Radio Capability information, of UE radio capabilities configured in two NG-RAN nodes is different, during handover between these two nodes, it is possible that the target NG-RAN node might need to enquire the UE for its UE Radio Capability Information again and trigger re-allocation of a PLMN-assigned UE Radio Capability ID leading to extra signalling. Additionally, a narrow filter might reduce the list of candidate target nodes.\nIf a UE supports both NB-IoT and other RATs that do support RACS (e.g. WB-E-UTRA and/or NR) then (since there is no support for RACS in NB-IoT) the UE handles the RACS procedures as follows:\n-\tNB-IoT specific UE Radio Capability Information is handled in UE, NG-RAN and AMF according to clause 5.4.4.1 and in EPS according to TS 23.401 [26].\n-\twhen the UE is not camping on NB-IoT, the RAN provides UE radio capabilities for other RATs but not NB-IoT UE radio capabilities, according to TS 38.300 [27] and TS 36.300 [30]. As a result the UE Radio Capability ID that is assigned by the network corresponds only to the UE radio capabilities of the non-NB-IoT RATs. The UE uses the UE Radio Capability IDs assigned only in Mobility Registration Update procedures performed over non-NB-IoT RATs.\nSupport for RACS in EPS is defined in TS 23.401 [26].\n\nIf the AMF requires more information on the UE radio capabilities support to be able to set the IMS voice over PS Session Supported Indication (see clause 5.16.3), then the AMF may send a UE Radio Capability Match Request message to the NG-RAN. This procedure is typically used during the Registration Procedure or when AMF has not received the Voice Support Match Indicator (as part of the 5GMM Context).\nNOTE:\tDuring the Registration Procedure, if the AMF does not already have the UEs radio capabilities, and if the RAT where the UE is requires the establishment of AN security context prior to retrieval of radio capabilities, the AMF needs to initiate \"Initial Context Setup\" procedure as defined in TS 38.413 [34] to provide the 5G-AN with security context, before sending a UE Radio Capability Match Request message.\nThe paging assistance information contains UE radio related information that assists the RAN for efficient paging. The Paging assistance information contains:\na)\tUE radio capability for paging information:\n-\tThe UE Radio Capability for Paging Information contains information derived by the NG-RAN node (e.g. band support information) from the UE Radio Capability information. The AMF stores this information without needing to understand its contents.\nAs the AMF only infrequently (e.g. at Initial Registration) prompts the NG-RAN to retrieve and upload the UE radio capabilities i.e. UE Radio Capability information to the AMF, and the AMF may be connected to more than one NG-RAN RAT, it is the responsibility of the NG-RAN to ensure that UE Radio Capability for Paging Information (which is derived by the NG-RAN node) contains information on all NG-RAN RATs that the UE supports in that PLMN. To assist the NG-RAN in this task, as specified in TS 38.413 [34], the AMF provides its stored UE Radio Capability for Paging Information in every NG-AP INITIAL CONTEXT SETUP REQUEST message sent to the NG-RAN.\n-\tThe UE Radio Capability for Paging Information is maintained in the core network, even during AMF reselection, and is stored in the UCMF alongside the UE Radio Capability information associated to a UE Radio Capability ID.\nb)\tInformation On Recommended Cells And RAN nodes For Paging:\n-\tInformation sent by the NG-RAN, and used by the AMF when paging the UE to help determining the NG RAN nodes to be paged as well as to provide the information on recommended cells to each of these RAN nodes, in order to optimize the probability of successful paging while minimizing the signalling load on the radio path.\n-\tThe RAN provides this information during N2 release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4a\tUE MM Core Network Capability handling",
                            "text_content": "The UE MM Core Network Capability is split into the S1 UE network capability (mostly for E-UTRAN access related core network parameters) and the UE 5GMM Core Network Capability (mostly to include other UE capabilities related to 5GCN or interworking with EPS) as defined in TS 24.501 [47] and contains non radio-related capabilities, e.g. the NAS security algorithms, etc. The S1 UE network capability is transferred between all CN nodes at AMF to AMF, AMF to MME, MME to MME, and MME to AMF changes. The UE 5GMM Core Network Capability is transferred only at AMF to AMF changes.\nIn order to ensure that the UE MM Core Network Capability information stored in the AMF is up to date (e.g. to handle the situation when the USIM is moved into a different device while out of coverage, and the old device did not send the Detach message; and the cases of inter-RAT Registration Area Update), the UE shall send the UE MM Core Network Capability information to the AMF during the Initial Registration and Mobility Registration Update procedure within the NAS message.\nThe AMF shall store always the latest UE MM Core Network Capability received from the UE. Any UE MM Core Network Capability that an AMF receives from an old AMF/MME is replaced when the UE provides the UE MM Core Network Capability with Registration signalling.\nIf the UE's UE MM Core Network Capability information changes (in either CM-CONNECTED or in CM-IDLE state), the UE shall perform a Mobility Registration Update procedure when it next returns to NG-RAN coverage. See clause 4.2.2 of TS 23.502 [3].\nThe UE shall indicate in the UE 5GMM Core Network Capability if the UE supports:\n-\tAttach in EPC with Request type \"Handover\" in PDN CONNECTIVITY Request message (clause 5.3.2.1 of TS 23.401 [26]).\n-\tEPC NAS.\n-\tSMS over NAS.\n-\tLCS.\n-\t5G SRVCC from NG-RAN to UTRAN, as specified in TS 23.216 [88].\n-\tRadio Capabilities Signalling optimisation (RACS).\n-\tNetwork Slice-Specific Authentication and Authorization.\n-\tNetwork Slice Replacement as described in clause 5.15.19.\n-\tParameters in Supported Network Behaviour for 5G CIoT as described in clause 5.31.2.\n-\tReceiving WUS Assistance Information (E-UTRA) see clause 5.4.9.\n-\tPaging Subgrouping Support Indication (NR) see clause 5.4.12.\n-\tCAG, see clause 5.30.3.3.\n-\tCAG with validity information (if UE supports CAG), see clause 5.30.3.3.\n-\tSubscription-based restrictions to simultaneous registration of network slices (see clause 5.15.12).\n-\tSupport of NSAG (see clause 5.15.14).\n-\tPartial Network Slice support in a RA (see clause 5.15.17).\n-\tMinimization of Service Interruption (MINT), as described in clause 5.40.\n-\tEquivalent SNPNs (see clause 5.30.2.11).\n-\tUnavailability Period Support, as described in clause 5.4.1.4.\n-\tSupport for network reconnection due to RAN timing synchronization status change, see clause 5.3.4.4.\n-\tUE Configuration of network-controlled Slice Usage Policy (see clause 5.15.15.2).\n-\tTemporarily available network slices (see clause 5.15.16).\n-\tSupport of S-NSSAI location availability information, as described in clause 5.15.18.2.\nIf a UE operating two or more USIMs, supports and intends to use one or more Multi-USIM features (see clause 5.38) in a PLMN for a USIM, it shall indicate in the UE 5GMM Core Network Capability for this USIM in this PLMN that it supports these one or more Multi-USIM features with the following indications:\n-\tConnection Release Supported.\n-\tPaging Cause Indication for Voice Service Supported.\n-\tReject Paging Request Supported.\n-\tPaging Restriction Supported.\nOtherwise, the UE with the capabilities of Multi-USIM features but does not intend to use them shall not indicate support of these one or more Multi-USIM features.\nA UE not operating two or more USIMs shall indicate the Multi-USIM features are not supported.\nNOTE:\tIt is not necessary for a UE operating two or more USIMs to use Multi-USIM features with all USIMs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4b\tUE 5GSM Core Network Capability handling",
                            "text_content": "The UE 5GSM Core Network Capability is included in PDU Session Establishment/Modification Request.\nThe UE shall indicate in the UE 5GSM Core Network Capability whether the UE supports:\n-\t\"Ethernet\" PDU Session Type supported in EPC as PDN Type \"Ethernet\";\n-\tReflective QoS;\n-\tMulti-homed IPv6 PDU Session (only if the Requested PDU Type was set to \"IPv6\" or \"IPv4v6\");\n-\tATSSS capability (as referred to clause 5.32.2);\n-\tTransfer of Port Management Information containers;\n-\tSupport for secondary DN authentication and authorization over EPC (as referred to clause 5.17.2.5).\nThe 5GSM Core Network Capability is transferred, if needed, from V-SMF to H-SMF during PDU Session Establishment/Modification procedure.\nAfter the first inter-system change from EPS to 5GS for a PDU session established in EPS, the 5GSM Core Network Capability is also included in the PDU Session Modification if the Reflective QoS and/or Multi-homed IPv6 PDU Session is present.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tDRX (Discontinuous Reception) framework",
                            "text_content": "The 5G System supports DRX architecture which allows Idle mode DRX cycle is negotiated between UE and the AMF. The Idle mode DRX cycle applies in CM-IDLE state and in CM-CONNECTED with RRC_INACTIVE state.\nIf the UE wants to use UE specific DRX parameters, the UE shall include its preferred values consistently in every Initial Registration and Mobility Registration procedure separately for NR/WB-EUTRA and NB-IoT. During Initial Registration and Mobility Registration procedures performed on NB-IoT cells, the normal 5GS procedures apply. For NB-IoT, the cell broadcasts an indication of support of UE specific DRX for NB-IoT in that cell, and the UE can request UE specific DRX for NB-IoT in the Registration procedure irrespective of whether the cell broadcasts that support indication.\nThe AMF shall determine Accepted DRX parameters based on the received UE specific DRX parameters and the AMF should accept the UE requested values, but subject to operator policy the AMF may change the UE requested values.\nThe AMF shall respond to the UE with the Accepted DRX parameters separately for NR/WB-EUTRA and NB-IoT.\nFor details of DRX parameters, see TS 38.331 [28] and TS 36.331 [51].\nThe UE shall apply the DRX cycle broadcast in the cell by the RAN unless it has received Accepted DRX parameters for the RAT from the AMF and for NB-IoT the cell supports UE specific DRX for NB-IoT, in which case the UE shall apply either the DRX cycle broadcast in the cell or the Accepted DRX parameters for the RAT, as defined in TS 38.304 [50] and TS 36.304 [52].\nThe Periodic Registration procedure does not change the UE's DRX settings.\nIn CM-CONNECTED with RRC_INACTIVE state, the UE applies either the DRX cycle negotiated with AMF, or the DRX cycle broadcast by RAN or the UE specific DRX cycle configured by RAN, as defined in TS 38.300 [27] and TS 38.304 [50].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.6\tCore Network assistance information for RAN optimization",
                            "text_content": "Core Network assistance information for RAN aids the RAN to optimize the UE state transition steering and the RAN paging strategy formulation in RRC_INACTIVE state. The Core Network assistance information includes the information set, Core Network assisted RAN parameters tuning, which assist RAN optimize the UE RRC state transition and CM state transition decision. It also includes the information set, Core Network assisted RAN paging information, which assist RAN to formulate an optimized paging strategy when RAN paging is triggered.\nCore Network assisted RAN parameters tuning aids the RAN to minimize the UE state transitions and achieve optimum network behaviour. How the RAN uses the CN assistance information is not defined in this specification.\nCore Network assisted RAN parameters tuning may be derived by the AMF per UE in the AMF based on collection of UE behaviour statistics, Expected UE Behaviour and/or other available information about the UE (such as subscribed DNN, SUPI ranges, or other information). If the AMF maintains Expected UE Behaviour parameters, Network Configuration parameters (as described in clause 4.15.6.3 or 4.15.6.3a, TS 23.502 [3]) or SMF derived CN assisted RAN parameters tuning, the AMF may use this information for selecting the CN assisted RAN parameter values. If the AMF is able to derive the Mobility Pattern of the UE (as described in clause 5.3.4.2), the AMF may take the Mobility Pattern information into account when selecting the CN assisted RAN parameter values.\nThe SMF uses the SMF-Associated parameters (e.g. Expected UE Behaviour parameters or Network Configuration parameters of the UE) to derive the SMF derived CN assisted RAN parameters tuning. The SMF sends the SMF derived CN assisted RAN parameters tuning to the AMF during the PDU Session establishment procedure and if the SMF-Associated parameters change the PDU Session modification procedure is applied. The AMF stores the SMF derived CN assisted RAN parameters tuning in the PDU Session level context. The AMF uses the SMF derived CN assisted RAN parameters tuning to determine a PDU Session level \"Expected UE activity behaviour\" parameters set, which may be associated with a PDU Session ID, as described below in this clause.\nThe Expected UE Behaviour parameters or the Network Configuration parameters can be provisioned by external party via the NEF to the AMF or SMF, as described in clause 5.20.\nThe CN assisted RAN parameters tuning provides the RAN with a way to understand the UE behaviour for these aspects:\n-\t\"Expected UE activity behaviour\", i.e. the expected pattern of the UE's changes between CM-CONNECTED and CM-IDLE states or the duration of CM-CONNECTED state. This may be derived e.g. from the statistical information, or Expected UE Behaviour or from subscription information. The AMF derives one or more sets of the \"Expected UE activity behaviour\" parameters for the UE as follows:\n-\tAMF may derive and provide to the RAN a UE level of \"Expected UE activity behaviour\" parameters set considering the Expected UE Behaviour parameters or Network Configuration parameters received from the UDM (see clauses 4.15.6.3 or 4.15.6.3a of TS 23.502 [3]) and the SMF derived CN assisted RAN parameters tuning associated with a PDU Session using Control Plane CIoT 5GS Optimisation. This set of \"Expected UE activity behaviour\" parameters is valid for the UE; and\n-\tAMF may provide to the RAN a PDU Session level \"Expected UE activity behaviour\" parameters set, e.g. considering the SMF derived CN assisted RAN parameters tuning, per established PDU Session. The PDU Session level \"Expected UE activity behaviour\" set of parameters is associated with and valid for a PDU Session ID. The RAN may consider the PDU Session level \"Expected UE activity behaviour\" parameters when the User Plane resources for the PDU Session are activated;\n-\t\"Expected HO behaviour\", i.e. the expected interval between inter-RAN handovers. This may be derived by the AMF e.g. from the Mobility Pattern information;\n-\t\"Expected UE mobility\", i.e. whether the UE is expected to be stationary or mobile. This may be derived e.g. from the statistical information or Expected UE Behaviour parameters or from subscription information;\n-\t\"Expected UE moving trajectory\" which may be derived e.g. from the statistical information or Expected UE Behaviour parameters or from subscription information; or\n-\t\"UE Differentiation Information\" including the Expected UE Behaviour parameters excluding the Expected UE moving trajectory (see clause 4.15.6.3 of TS 23.502 [3]) to support Uu operation optimisation for NB-IoT UE differentiation if the RAT type is NB-IoT.\nThe AMF decides when to send this information to the RAN as \"Expected UE activity behaviour\" carried in N2 request over the N2 interface (see TS 38.413 [34]).\nNOTE:\tThe calculation of the CN assistance information, i.e. the algorithms used and related criteria, and the decision when it is considered suitable and stable to send to the RAN are vendor specific.\nCore Network assisted RAN paging information aids the RAN to formulate a RAN paging policy and strategy in RRC_INACTIVE state, besides the PPI and QoS information associated to the QoS Flows as indicated in clause 5.4.3.\nCN assisted RAN paging information may be derived by the AMF per UE and/or per PDU Session based on collection of UE behaviour statistics, Expected UE Behaviour and/or other available information about the UE (such as subscribed DNN, SUPI ranges, Multimedia priority service), and/or information received from other network functions when downlink signalling is triggered.\nThe CN assisted RAN paging information consists of a service priority (values 1 to 256) which provides AN with a way to understand how important the downlink signalling is. The AMF derives this service priority based on available information as described above. The method to derive the service priority is implementation depended and can be controlled by operator.\nThe Core Network may provide the CN assisted RAN paging information to RAN in different occasions, e.g. during downlink N1 and N2 message delivery, etc.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.7\tNG-RAN location reporting",
                            "text_content": "NG-RAN supports the NG-RAN location reporting for the services that require accurate cell identification (e.g. emergency services, lawful intercept, charging) or for the UE mobility event notification service subscribed to the AMF by other NFs. The NG-RAN location reporting may be used by the AMF when the target UE is in CM-CONNECTED state. The NG-RAN location reporting may be used by the AMF to determine the geographically located TAI in the case of NR satellite access.\nThe AMF may request the NG-RAN location reporting with event reporting type (e.g. UE location or UE presence in Area of Interest), reporting mode and its related parameters (e.g. number of reporting).\nIf the AMF requests UE location, the NG-RAN reports the current UE location (or last known UE location with time stamp if the UE is in RRC_INACTIVE state) based on the requested reporting parameter (e.g. one-time reporting or continuous reporting).\nIf the AMF requests UE location, in the case of NR satellite access, the NG-RAN provides all broadcast TAIs to the AMF as part of the ULI. The NG-RAN also reports the TAI where the UE is geographically located if this TAI can be determined.\nIf the AMF requests UE presence in the Area Of Interest, the NG-RAN reports the UE location and the indication (i.e. IN, OUT or UNKNOWN) when the NG-RAN determines the change of UE presence in Area Of Interest.\nAfter N2 based Handover, if the NG-RAN location reporting information is required, the AMF shall re-request the NG-RAN location reporting to the target NG-RAN node. For Xn based Handover, the source NG-RAN shall transfer the requested NG-RAN location reporting information to target NG-RAN node.\nThe AMF requests the location information of the UE either through independent N2 procedure (i.e. NG-RAN location reporting as specified in clause 4.10 of TS 23.502 [3]), or by including the request in some specific N2 messages as specified in TS 38.413 [34].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.8\tSupport for identification and restriction of using unlicensed spectrum",
                            "text_content": "Support for NG-RAN using unlicensed spectrum is defined in TS 38.300 [27] and TS 36.300 [30].\nFor NG-RAN, in the case of NR in stand-alone mode, all cells are in unlicensed spectrum and the NR is used as primary RAT. NR or E-UTRA cells in unlicensed spectrum, can be used as secondary cells as specified in the Dual Connectivity architecture defined in clause 5.11 or in addition can be configured to support the Carrier Aggregation Architecture (CA) defined in TS 38.300 [27] and TS 36.300 [30].\nFor either case the serving PLMN can enforce Access Restriction for Unlicensed Spectrum (either signalled from the UDM, or, locally generated by VPLMN policy in the AMF) with the following:\n-\tTo restrict the use of NR in unlicensed spectrum as primary RAT, the AMF rejects the UE Registration procedure with appropriate cause code defined in TS 24.501 [47] if the UE performs initial access from NR using unlicensed spectrum. If the UE is accessing through some other allowed RAT, the AMF signals this access restriction to NG-RAN as part of Mobility Restriction List.\n-\tTo restrict the use of use of unlicensed spectrum with NR or E-UTRA as secondary RAT using Dual Connectivity or Carrier Aggregation Architecture (CA) defined in TS 38.300 [27] and TS 36.300 [30], the AMF signals this access restriction to NG-RAN as part of Mobility Restriction List.\nAn NG-RAN node supporting aggregation with unlicensed spectrum using either NR or E-UTRA checks whether the UE is allowed to use unlicensed spectrum based on received Mobility Restriction List. If the UE is not allowed to use Unlicensed Spectrum, the NG-RAN node shall restrict the using of unlicensed spectrum, either NR or E-UTRA as secondary RATs when using either Dual Connectivity or Carrier Aggregation (CA) as defined in TS 38.300 [27] and TS 36.300 [30].\nAt inter-RAT handover from E-UTRAN/EPS, the Access Restriction for Unlicensed Spectrum is either already in the AMF's UE context, or is obtained from the UDM during the subsequent Registration Area Update procedure (i.e. not from the source MME or source RAN). In both inter-RAT handover cases, any Access Restriction for use of Unlicensed Spectrum is then signalled to NG-RAN or enforced in AMF.\nNOTE:\tThis signalling of the Access Restriction during the Registration Area Update after the inter-RAT handover procedure means that there is a small risk that unlicensed spectrum resources are transiently allocated.\nWhen the UE is accessing 5GS using unlicensed spectrum as primary RAT:\n-\tThe NG-RAN node shall provide an indication to the AMF in N2 interface that NR access is using unlicensed spectrum as defined in TS 38.413 [34].\n-\tIn order to restrict access to NR in unlicensed spectrum, cells supporting NR in unlicensed spectrum have to be deployed in Tracking Area(s) different to cells supporting licensed spectrum.\n-\tWhen the AMF receives an indication from NG-RAN over N2 whether NR in unlicensed spectrum is being used as defined in TS 38.413 [34], the AMF provides to the SMF an indication that the RAT type is NR with usage of unlicensed spectrum during PDU Session Establishment or as part of the UP activation and Handover procedures.\n-\tThe PCF will also receive the indication whether the UE is using NR in unlicensed spectrum, when applicable, from the SMF during SM Policy Association Establishment or SM Policy Association Modification procedure.\n-\tThe NFs generating CDRs shall include the indication that the UE is using NR in unlicensed spectrum in their CDRs.\nWhen the UE is accessing NR or E-UTRA using unlicensed spectrum as secondary RAT, procedures for Usage Data Reporting for Secondary RAT as defined in clause 5.12.2 can apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.9\tWake Up Signal Assistance",
                            "text_content": "The RAN and UE may use a Wake Up Signal (WUS) to reduce the UE's idle mode power consumption. The RAN sends the WUS shortly before the UE's paging occasion. The WUS feature enables UEs to determine that in the paging occasions immediately following their WUS occasion they will not be paged if their WUS is not transmitted, or that they might be paged if their WUS is transmitted (see TS 36.304 [52]).\nTo avoid waking up UEs due to an AMF paging other UEs across multiple cells (e.g. due to frequent UE mobility and/or for low paging latency services such as VoLTE), the use of WUS by the ng-eNB and the UE is restricted to the last used cell, i.e. the cell in which the UE's RRC connection was last released. To support this:\na)\tng-eNBs should provide the Recommended Cells for Paging IE in the Information on Recommended Cells and RAN Nodes for Paging IE (see TS 38.413 [34]) to the AMF in the NGAP UE Context Release Complete, UE Context Suspend Request and UE Context Resume Request messages;\nb)\tif received during the last NGAP UE Context Release Complete or UE Context Suspend Request message, the AMF provides (without modification) the Recommended Cells for Paging as Assistance Data for Recommended Cells IE in the Assistance Data for Paging IE within the NGAP Paging message to the RAN (see also TS 38.413 [34]); and\nc)\tthe AMF shall delete (or mark as invalid) the Information On Recommended Cells And RAND nodes For Paging when a new NGAP association is established for the UE.\nIn the NGAP Paging message, the last used cell ID is sent in the Assistance Data for Recommended Cells IE in the Assistance Data for Paging IE (see TS 38.413 [34]). When receiving an NGAP Paging message for a WUS-capable UE that also includes the Assistance Data for Recommended Cells IE then a WUS-capable ng-eNB shall only broadcast the WUS on the cell that matches the last used cell ID.\nTo support the Wake Up Signal (WUS), the WUS Assistance Information is used by the ng-eNB to help determine the WUS group used when paging the UE (see TS 36.300 [30]).\nThe content of the WUS Assistance Information consists of the paging probability information. The paging probability information provides a metric on the probability of a UE receiving a paging message based on, e.g. statistical information.\nThe UE may in the Registration Request message provide its capability to support receiving WUS Assistance Information. If WUS Assistance Information is supported by the UE, then the UE in the Registration Request message may provide the additional UE paging probability information. The AMF may use the UE provided paging probability, local configuration and/or previous statistical information for the UE, when determining the WUS Assistance Information. If the UE supports WUS Assistance Information, the AMF may assign WUS Assistance Information to the UE, even when the UE has not provided the additional UE paging probability information.\nIf the AMF has determined WUS Assistance Information for the UE, the AMF provides it to the UE in every Registration Accept message. The AMF stores the WUS Assistance Information parameter in the MM context and provides it to the ng-eNB when paging the UE.\nUE and AMF shall not signal WUS Assistance Information in Registration Request, Registration Accept messages when the UE has an active emergency PDU session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.10\tSupport for identification and restriction of using NR satellite access",
                            "text_content": "Support for NR satellite access is specified in TS 38.300 [27].\nEditor's note:\tTS 38.300 [27] not yet updated by RAN groups.\nThe AMF determines the RAT Type for NR satellite access, i.e. NR(LEO), NR(MEO), NR(GEO) and NR(OTHERSAT). When the UE is accessing NR using satellite access, an indication is provided in N2 interface indicating the type of NR satellite access, as defined in TS 38.413 [34].\nEditor's note:\tFurther details on what type of satellite platforms OTHERSAT includes is FFS and to be aligned with RAN WG3.\nThe serving PLMN can enforce mobility restrictions for NR satellite access as specified in clause 5.3.4.1.\nIn order to enable efficient enforcement of Mobility Restrictions, cells of each NR satellite RAT Type (NR(LEO), NR(MEO), NR(GEO) or NR(OTHERSAT)) need to be deployed in TAs different from TAs for other NR satellite RAT Types as well as different from TAs supporting terrestrial access RAT Types.\nThe AMF may initiate deregistration of the UE when an N2 UE Context Release Request is received with cause value indicating that the UE is not in PLMN serving area, as specified in TS 38.413 [34].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.11\tSupport for integrating NR satellite access into 5GS",
                            "text_content": "This clause describes the specific aspects for NR satellite access.\nIn case of NR satellite access, the RAT Types values \"NR(LEO)\", \"NR(MEO)\", \"NR(GEO)\" and \"NR(OTHERSAT)\" are used in 5GC to distinguish the different NR satellite access types (see clause 5.4.10).\nWhen a UE is accessing to the network via satellite access, the AMF determines the RAT type as specified in clause 5.4.10.\n\nIn order to ensure that the regulatory requirements are met, the network may be configured to enforce that the selected PLMN is allowed to operate in the current UE location by verifying the UE location during Mobility Management and Session Management procedures. In this case, when the AMF receives a NGAP message containing User Location Information for a UE using NR satellite access, the AMF may decide to verify the UE location. If the AMF determines based on the Selected PLMN ID and ULI (including Cell ID) received from the gNB that it is not allowed to operate at the present UE location the AMF should reject any NAS request with a suitable cause value. If the UE is already registered to the network when the AMF determines that it is not allowed to operate at the present UE location, the AMF may initiate deregistration of the UE. The AMF should not reject the request or deregister the UE unless it has sufficiently accurate UE location information to determine that the UE is located in a geographical area where the PLMN is not allowed to operate.\nNOTE:\tThe area where the UE is allowed to operate can be determined based on the regulatory area where the PLMN is allowed to operate based on its licensing conditions.\nIf the AMF, based on the ULI, is not able to determine the UE's location with sufficient accuracy to make a final decision or if the received ULI is not sufficiently reliable, the AMF proceeds with the Mobility Management or Session Management procedure and may initiate UE location procedure after the Mobility Management or Session Management procedure is complete, as specified in clause 6.10.1 of TS 23.273 [87], to determine the UE location. The AMF shall be prepared to deregister the UE if the information received from LMF indicates that the UE is registered to a PLMN that is not allowed to operate in the UE location. In the case of a NAS procedure, the AMF should either reject any NAS request targeted towards a PLMN that is not allowed to operate in the known UE location and indicate a suitable cause value, or accept the NAS procedure and initiate deregistration procedure once the UE location is known. In the deregistration message to the UE, the AMF shall include a suitable cause value. For UE processing of the cause value indicating that the PLMN is not allowed to operate in the current UE location, see TS 23.122 [17] and TS 24.501 [47].\nIn the case of a handover procedure, if the (target) AMF determines that it is not allowed to operate at the current UE location, the AMF either rejects the handover, or accepts the handover and later deregisters the UE.\nNetwork selection principles specified in clause 5.2.2 apply also for NR satellite access.\nFor NR satellite access, a UE with location capability should use its awareness of its location to select a PLMN that is allowed to operate in the UE location as specified in TS 23.122 [17].\nIn order to ensure that the regulatory requirements are met, the network may be configured to enforce this UE choice by verifying the UE location, as described in clause 5.4.11.4.\nA moving radio cell for NR satellite access may indicate support for one or more TACs for each PLMN. A UE that is registered with a PLMN may access a radio cell and does not need to perform a Mobility Registration Update procedure as long as at least one supported TAC for the RPLMN or equivalent to the RPLMN is part of the UE Registration Area. A UE shall perform a Mobility Registration Update procedure when accessing a radio cell where none of the supported TACs for the RPLMN or equivalent to the RPLMN are part of the UE Registration Area.\nWhen indicating a last visited TAI in a Registration Update, a UE may indicate any TAI supported in a radio cell for the RPLMN or equivalent to the RPLMN for the last UE access prior to the Registration Update that is part of the UE Registration Area.\nIn the case of NR satellite access with moving cells, in order to ensure that each TA is Earth-stationary even if the radio cells are moving across the Earth's surface, the NG-RAN may change the TAC values that are broadcast in a cell's system information as the cell moves, as described in TS 38.300 [27] and TS 38.331 [28].\nNG-RAN may broadcast in a cell a single TAC per PLMN and change that TAC value as the cell moves. Alternatively, the NG-RAN may broadcast in a cell more than one TAC for a PLMN and add or remove TAC values as the cell moves. The NG-RAN provides either the single broadcast TAI or all broadcast TAIs corresponding to the Selected PLMN as described in TS 38.413 [34] to the AMF as part of the ULI, whenever the ULI is included in the NGAP message as described in TS 38.413 [34]. The NG-RAN indicates, if known, also the TAI where the UE is geographically located.\nNOTE:\tThe AMF may take the TAI where the UE is geographically located into account to generate a suitable Registration Area for the UE.\nForbidden Area functionality is supported as described in clause 5.3.4.1.1 with the modifications described below:\n-\tThe AMF and the UE receive the broadcast TAI (if a single TAI is broadcast) or all broadcast TAIs (if multiple TAIs are broadcast) from the NG-RAN as described clause 5.4.11.7. The AMF considers the UE to be in a Forbidden Area if the only received TAI is forbidden or if all received TAIs are forbidden based on subscription data. The UE considers it is in a Forbidden Area if the only received TAI is forbidden, or if all received TAIs are forbidden and is not within a Forbidden Area in the case that at least one broadcast TAI is not forbidden.\n-\tIf AMF receives multiple TAIs from the NG-RAN and determines that some, but not all of them are forbidden by subscription or by operator policy, the AMF shall send the forbidden TAI(s) to the UE as described in clauses 4.2.2.2 and 4.2.3 in TS 23.502 [3]. The UE stores the TAI(s) in the appropriate Forbidden Area list and removes the TAI(s) from Registration Area if present.\nService Area Restrictions functionality is supported as described in clause 5.3.4.1.2 with the modifications described below:\n-\tThe AMF receives the broadcast TAI (if a single TAI is broadcast) or all broadcast TAIs (if multiple TAIs are broadcast) from the NG-RAN as described clause 5.4.11.7. The AMF provides the UE with Service Area Restrictions which consist of either Allowed Areas or Non-Allowed Areas, as described in clause 5.3.4.1.2. The UE and AMF consider the UE to be in a Non-Allowed Area if none of the broadcast TAIs is Allowed. The UE and AMF consider the UE to be in an Allowed Area if at least one broadcast TAI is allowed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.12\tPaging Early Indication with Paging Subgrouping Assistance",
                            "text_content": "The RAN and UE may use a Paging Early Indication with Paging Subgrouping (PEIPS) to reduce the UE's power consumption in RRC_IDLE and RRC_INACTIVE over NR (see TS 38.304 [50]).\nThe paging subgrouping can be based on either the UE's temporary ID or a Paging Subgroup ID allocated by the AMF. Paging subgrouping based on the UE's temporary ID is implemented within the NG-RAN. For paging subgrouping based on UE's temporary ID, the UE's support is included in the UE Radio Capability for Paging, either derived by the NG-RAN from UE provided UE radio capability (see clause 5.4.4) or based on UE Radio Capability ID if UE radio capability signalling optimisation is used (see clause 5.4.4.1a).\nThe AMF, when determining its paging strategy (see clause 5.4.3), should take into consideration whether a gNB is using Paging subgrouping based on the UE's temporary ID.\nNOTE:\tPaging messages sent to that gNB can increase UE power consumption for other UEs that support Paging Subgrouping based on the UE's temporary ID.\nIf paging subgroups are being allocated by the AMF, then all AMFs connected to one gNB (including the AMFs in different PLMNs using 5G MOCN network sharing) shall use a consistent policy in allocating UEs to the paging subgroups. The AMF may configure up to 8 different Paging Subgroup IDs.\nNOTE:\tBecause the UE uses the AMF allocated paging subgroup across all cells in its TAI-list, and, different, overlapping TAI lists can be allocated to different UEs, then to avoid UE power consumption increasing, it is likely to be necessary that all AMFs with an overlapping coverage area use a consistent policy in allocating UEs to the paging subgroups.\nThe NG-RAN node and the UE determine per cell which paging subgrouping method to use as defined in TS 38.304 [50] and TS 38.331 [28].\nTo support the Paging Early Indication with Paging Subgrouping (PEIPS), Paging Subgrouping Support Indication and the PEIPS Assistance Information is used by the AMF and NG-RAN to help determine whether PEIPS applies to the UE and which paging subgroup used when paging the UE (see TS 38.300 [27]).\nIn the Registration Request message, the Paging Subgrouping Support Indication indicates whether the UE supports PEIPS with AMF PEIPS Assistance Information. If the UE includes Paging Subgrouping Support Indication, the UE may also include the paging probability information to assist the AMF. If the AMF supports PEIPS assistance and if the UE provided Paging Subgrouping Support Indication, the AMF stores the indication in the UE context in AMF. The AMF may use local configuration, the UE's paging probability information if provided, information provided by the RAN (e.g. any of the Information On Recommended Cells And RAN nodes For Paging), and/or previous statistical information for the UE to determine the AMF PEIPS Assistance Information. The AMF PEIPS Assistance Information includes the Paging Subgroup ID.\nNOTE 1:\tTo minimise MT voice call setup latency, the AMF could allocate Paging Subgroup IDs taking into account whether or not the UE is likely to receive IMS voice over PS session calls.\nNOTE 2:\tTo avoid MT traffic for more mobile UEs causing more stationary UEs to be woken up, the AMF could allocate Paging Subgroup IDs taking into account the UE's mobility pattern.\nIf the AMF has determined AMF PEIPS Assistance Information for the UE, the AMF stores it in the UE context in AMF and provides it to the UE in every Registration Accept message.\nIf the AMF has determined AMF PEIPS Assistance Information, the AMF shall provide it to NG RAN when paging the UE. In addition, in order to support PEIPS for UEs in RRC_INACTIVE mode, the AMF shall provide the AMF PEIPS Assistance Information to NG-RAN as part of the RRC Inactive Assistance Information.\nThe NG-RAN chooses on a per-cell basis whether to use PEIPS and which paging subgrouping mechanism to use. When using AMF allocated subgroups, both the UE and NG-RAN use the AMF PEIPS Assistance Information to determine the paging subgroup to apply as defined in TS 38.300 [27].\nThe AMF may use the UE Configuration Update procedure (as described in clause 4.2.4 of TS 23.502 [3]) and N2 UE Context Modification procedure (as described in clause 8.3.4 of TS 38.413 [34]) to update the AMF PEIPS Assistance Information in the UE and NG-RAN.\nWhen the UE has an active emergency PDU Session:\n-\tThe UE shall not signal Paging Subgrouping Support Indication in the Registration Request message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.13\tSupport of discontinuous network coverage for satellite access",
                            "text_content": "The present clause 5.4.13 provides optional enhancements to support discontinuous coverage:\n-\tMobility management and power saving optimization, see clause 5.4.13.1; and\n-\tCoverage availability information provisioning to the UE, see clause 5.4.13.2; and\n-\tCoverage availability information provisioning to the AMF, see clause 5.4.13.3; and\n-\tPaging, see clause 5.4.13.4; and\n-\tOverload control, see clause 5.4.13.5.\nNOTE:\tIn this Release, there is no specified support for discontinuous coverage over NR in RAN specifications.\nFor NR satellite access that provides discontinuous network coverage the Mobility Management and Power Saving Optimization functionality may be used.\nIf both the UE and the network support \"Unavailability Period Support\", and if the UE determines it will lose coverage and will become unavailable, and the UE decides to remain in no service during that time, then:\n-\tthe UE triggers the Mobility Registration Update procedure to inform the network of its unavailability, as described in clause 5.4.1.4.\n-\tThe UE may be able to determine, including considering current and expected future locations of the UE, a Start of Unavailability Period and/or Unavailability Period Duration for when it expects to be out of coverage and include them in the Mobility Registration Update procedure, as described in clause 5.4.1.4.\n-\tThe UE should trigger the Mobility Registration Update procedure early enough such that the procedure, under normal conditions, is able to complete before the start of the unreachability period.\nNOTE 1:\tA UE based on implementation can combine successive periods of no satellite coverage into a single continuous period that is notified to the network if the UE does not require network access during this period.\nNOTE 2:\tUE informing the network of coverage gaps would increase signalling and UE power consumption if coverage gaps are more frequent than UE's communication period.\nIn case the UE requests power saving features the AMF uses the procedures defined in other clauses to provide the UE with timers (e.g. Periodic Registration Update timer), extended DRX in CM-IDLE configuration (see clause 5.31.7.2), and MICO mode configuration (see clause 5.4.1.3), and to provide the NG-RAN with Extended Connected Time (see clause 5.31.7.3) and may also consider the Unavailability Period Duration and Start of Unavailability Period (if available). This is to keep UE in power saving mode and avoid the network attempting to page the UE if it is out of satellite network coverage.\nThe AMF should adjust the mobile reachable timer or Implicit Deregistration timer or both such that the AMF does not implicitly deregister the UE while the UE is unavailable, see clause 5.4.1. Features described for High latency communication in clause 5.31.8 may be used to handle mobile terminated (MT) communication with UEs being unreachable due to NR satellite access discontinuous coverage and the Unavailability Period Duration (if available) and Start of Unavailability Period (if available) may be used when determining the Estimated Maximum Wait Time.\nTracking Area or RAT specific configuration in the AMF may be used to set timer values based on typical coverage periods of a satellite system.\nNOTE 3:\tFor example, if a satellite system only provides coverage to a UE for 20 minutes when a satellite passes, and the maximum time before a satellite passes any point on the earth is 10 hours, the AMF could configure the periodic registration timer and Mobile Reachable timer to be just greater than 20 minutes and the Implicit Deregistration timer to be greater than 10 hours to avoid unintended implicit detach due to coverage gap. Such configuration does not require AMF to be aware of detailed coverage times for each UE or for different locations.\nThe UE may send Mobility Registration Update procedure to inform the network of its UE unavailability period (see clause 5.4.1.4) even if Mobility Management back-off timer is running.\nA UE may use satellite coverage availability information for satellite access to support discontinuous coverage operations. Satellite coverage availability information can be provided to a UE by an external server via a PDU Session or SMS. The protocol and format of satellite coverage availability information via PDU session or SMS is not defined in this release of the specification, but some examples on possible information that constitutes the satellite coverage availability information is defined in Annex Q.\nThe AMF may use satellite coverage availability information to support satellite access by UEs with discontinuous coverage operation. Satellite coverage availability information may be provisioned to the AMF by O&M.\nThe satellite coverage availability information provisioned to the AMF describes when and where satellite coverage is expected to be available in an area. The satellite coverage availability information is not UE specific and can be applied by the AMF for any UE in the affected area.\nIn the case of NR satellite access that provides discontinuous network coverage, AMF may utilize sub-area paging as described in clause 4.2.3.3 of TS 23.502 [3] (e.g. first page in the last known cell-id or TA and retransmission in all registered TAs). The AMF may utilize the location information as received at or before the AN release due to the discontinuous coverage for paging optimisation.\nThe AMF may e.g. receive UE location from NG-RAN during the Registration procedure e.g. triggered for Mobility Management and Power Saving Optimization for discontinuous network coverage as described in clause 5.4.13.1, or the AMF may request NG-RAN location reporting when the UE is in CM-CONNECTED state as described in clause 5.4.7.\nThe AMF and UE may only use the procedure defined in this clause if both the UE and AMF indicate support for \"Unavailability Period Support\", see clause 5.4.13.1. A UE indicating support for \"Unavailability Period Support\" shall support the procedures defined in this clause when leaving coverage and re-gaining coverage for an NR satellite access.\nIn order to avoid a large number of UEs causing excessive signalling load on the network when leaving coverage or re-gaining coverage after being out of coverage, the AMF may determine a Maximum Time Offset controlling when UEs are allowed to initiate NAS signalling with the network, as described in this clause.\nIn this case, the AMF determines this Maximum Time Offset based on network configuration, high priority access and priority service as specified in TS 23.122 [17] and TS 24.501 [47]. The AMF sends this Maximum Time Offset to individual UEs during the Registration procedure or UE Configuration Update procedure.\nIf the UE receives a Maximum Time Offset from the network in a Registration Accept or UE Configuration Update Command message, the UE shall replace any previously received Maximum Time Offset on the same RAT type and PLMN with this one.\nWhen the UE knows a later time at which coverage will be lost and when the UE does not send Mobility Registration Update to the AMF in advance (see clause 5.4.13.1), the UE determines a random value up to the minimum of the latest Maximum Time Offset for this PLMN and RAT type and the time until coverage will be lost. The UE shall send the Mobility Registration Update at the time when coverage will be lost less the random value to the AMF indicating the loss of coverage.\nUpon returning to coverage after being out of coverage due to discontinuous coverage, the UE sets the discontinuous coverage wait timer value to a random value up to and including the latest Maximum Time Offset for this PLMN and RAT type, and starts this timer. The UE shall not initiate any NAS signalling on that RAT Type and PLMN while the discontinuous coverage wait timer is running.\nThe UE shall stop the discontinuous coverage wait timer and initiate NAS signalling if the UE receives paging message, has pending emergency services or when UE enters a TAI outside the registration area.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.5\tNon-3GPP access specific aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.5.0\tGeneral",
                            "text_content": "This clause describe the specific aspects for untrusted non-3GPP access, trusted non-3GPP access and W-5GAN access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.1\tRegistration Management",
                            "text_content": "This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. In the case of W-5GAN the UE mentioned in this clause corresponds to 5G-RG or to the W-AGF in the case of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE mentioned in this clause corresponds to TWIF.\nThe UE shall enter RM-DEREGISTERED state and the AMF shall enter RM-DEREGISTERED state for the UE on non-3GPP access as follows:\n-\tat the UE and at the AMF, after performing an Explicit Deregistration procedure;\n-\tat the AMF, after the Network non-3GPP Implicit Deregistration timer has expired.\n-\tat the UE, after the UE non-3GPP Deregistration timer has expired.\nNOTE:\tThis is assumed to leave sufficient time to allow the UE to re-activate UP connections for the established PDU Sessions over 3GPP or non-3GPP access.\nWhenever a UE registered over non-3GPP access enters CM-IDLE state for the non-3GPP access, it starts the UE non-3GPP Deregistration timer according to the value received from the AMF during a Registration procedure.\nOver non-3GPP access, the AMF runs the Network non-3GPP Implicit Deregistration timer. The Network non-3GPP Implicit Deregistration timer is started with a value longer than the UE's non-3GPP Deregistration timer, whenever the CM state for the UE registered over non-3GPP access changes to CM-IDLE for the non-3GPP access.\nFor a UE that is registered over Non-3GPP access, a change of the point of attachment (e.g. change of WLAN AP) shall not lead the UE to perform a Registration procedure.\nA UE that is registered over non-3GPP access may trigger a Mobility Registration Update procedure via a new non-3GPP AN node (i.e. N3IWF or TNGF) to switch traffic from an old non-3GPP access to a new non-3GPP access.\nTraffic switching from an old non-3GPP access to and from a wireline access is not supported in this Release.\nTraffic switching from an old non-3GPP access to new non-3GPP access is supported only when PLMN of the new non-3GPP access is the same PLMN of the old non-3GPP access.\nA UE shall not provide 3GPP-specific parameters (e.g. indicate a preference for MICO mode) during registration over a non-3GPP access.\nDuring registration procedure the AMF may determine whether the serving N3IWF/TNGF is appropriate based on the slices supported by the N3IWFs/TNGFs as specified in clause 6.3.6 and clause 6.3.12 respectively.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.2\tConnection Management",
                            "text_content": "This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. The UE mentioned in this clause corresponds to the 5G-RG in the case of W-5GAN and to the W-AGF in the case of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE mentioned in this clause corresponds to TWIF.\nA UE that successfully establishes a Non-3GPP Access Connection to the 5GC over a Non-3GPP access transitions to CM-CONNECTED state for the Non-3GPP access.\nIn the case of Untrusted Non-3GPP access to 5GC, the Non-3GPP Access Connection corresponds to an NWu connection.\nIn the case of Trusted access to 5GC, the Non-3GPP Access Connection corresponds to an NWt connection.\nIn the case of N5CW devices access 5GC via trusted WLAN access networks, the Non-3GPP Access Connection corresponds to an Yt' connection.\nIn the case of Wireline access to 5GC, the Non-3GPP Access Connection corresponds to a Y4 connection and to Y5 connection.\nA UE does not establish multiple simultaneous Non-3GPP Access Connection to the 5GC.\nThe Non-3GPP Access Connection is released either as a result of an Explicit Deregistration procedure or an AN Release procedure.\nIn the case of Untrusted Non-3GPP access, Trusted Non-3GPP access and W-5GAN access to 5GC, the N3IWF, TNGF, TWIF and W-AGF may in addition explicitly release the NWu, NWt, Yt', Y4 and Y5 signalling connection due to NWu, NWt, Yt', Y4 and Y5 connection failure, respectively. In the case of NWu and NWt, the release may be determined by the \"dead peer detection\" mechanism in IKEv2 defined in RFC 7296 [60]. In the case of Y4 and Y5 the release may be detected for example by lost of synchronisation of physical link, lost of PPPoE session, etc. Further details on how NWu, NWt, Yt', Y4 and Y5 connection failure is detected is out of scope of 3GPP specifications.\nFor W-5GCAN, the W-AGF explicitly releases the N2 connection due to Y4 or Y5 connection failure, as determined by the \"dead peer detection\" mechanism in DOCSIS MULPI [89].\nThe release of the Non-3GPP Access Connection between the UE and the N3IWF, TNGF, TWIF or W-AGF shall be interpreted as follows:\n-\tBy the N3IWF, TNGF, TWIF and W-AGF as a criterion to release the N2 connection.\n-\tBy the UE as a criterion for the UE to transition to CM-IDLE. A UE registered over non-3GPP access remains in RM-REGISTERED state, unless the Non-3GPP Access Connection release occurs as part of a Deregistration procedure over non-3GPP access in which case the UE enters the RM-DEREGISTERED state. When the UE in RM-REGISTERED transitions to CM-IDLE, the UE non-3GPP Deregistration timer starts running in the UE. The UE non-3GPP Deregistration timer stops when the UE moves to CM-CONNECTED state or to the RM-DEREGISTERED state.\nNOTE 1:\tWhen moved to CM-IDLE state over one access, the UE can attempt to re-activate UP connections for the PDU Sessions over other access, per UE policies and depending on the availability of these accesses.\nNOTE 2:\tThe release of the NWu, NWt, Yt', Y4 or Y5 at the UE can occur as a result of explicit signalling from the N3IWF, TNGF, TWIF or W-AGF respectively, e.g. IKE INFORMATION EXCHANGE in the case of NWu or as a result of the UE detecting NWu, NWt, Yt', Y4 or Y5 connection failure, e.g. as determined by the \"dead peer detection\" mechanism in IKEv2 as defined in RFC 7296 [60] for NWu, NWt and Yt' or W-5GAN access specific mechanism for Y4 and Y5. Further details on how the UE detects NWu, NWt, Yt', Y4 or Y5 connection failure is out of scope of 3GPP specifications.\nIn the case of Non-3GPP access, when the AMF releases the N2 interface, the N3IWF, TNGF, TWIF and W-AGF shall release all the resources associated with the UE including the Non-3GPP Access Connection with the UE and its corresponding N3 resources. A release of the N2 connection by the AMF shall set the CM state for the UE in the AMF to CM-IDLE.\nNOTE 3:\tIt is assumed that a UE configured to receive services from a 5GC over non-3GPP access that is RM-DEREGISTERED or CM-IDLE over the non-3GPP access will attempt to establish Non-3GPP Access Connection and transition to CM-CONNECTED state whenever the UE successfully connects to a non-3GPP access unless prohibited by the network to make a N3GPP Access Connection (e.g. due to network congestion).\nAn UE cannot be paged on Non-3GPP access network.\nWhen a UE registered simultaneously over a 3GPP access and a non-3GPP access moves all the PDU Sessions to one of the accesses, whether the UE initiates a Deregistration procedure in the access that has no PDU Sessions is up to the UE implementation.\nRelease of PDU Sessions over the non-3GPP access does not imply the release of N2 connection.\nWhen the UE has PDU Sessions routed over the non-3GPP access and the UE state becomes CM-IDLE for the non-3GPP access, these PDU Sessions are not released to enable the UE to move the PDU Sessions over the 3GPP access based on UE policies. The core network maintains the PDU Sessions but deactivates the N3 user plane connection for such PDU Sessions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.3\tUE Reachability",
                            "text_content": "This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. The UE mentioned in this clause corresponds to 5G-RG, in the case of W-5GAN or to W-AGF in the case of support of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE mentioned in this clause corresponds to TWIF.\nAn UE cannot be paged over Non-3GPP access network.\nIf the UE states in the AMF are CM-IDLE and RM-REGISTERED for the non-3GPP access, there may be PDU Sessions that were last routed over the non-3GPP access and without user plane resources. If the AMF receives a message with a Non-3GPP Access Type indication from an SMF for a PDU Session corresponding to a UE that is CM-IDLE for non-3GPP access, and the UE is registered over 3GPP access in the same PLMN as the one registered over non-3GPP access, a Network Triggered Service Request may be performed over the 3GPP access independently of whether the UE is CM-IDLE or CM-CONNECTED over the 3GPP access. In this case, the AMF provides an indication that the procedure is related to non-3GPP access, as specified in clause 5.6.8.\nNOTE:\tThe UE behaviour upon such network triggered Service Request is specified in clause 5.6.8.\nThis clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. In the case of W-5GAN the UE mentioned in this clause corresponds to 5G-RG and to W-AGF in the case of support of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE mentioned in this clause corresponds to TWIF.\nFor a UE in CM-CONNECTED state:\n-\tthe AMF knows the UE location on a N3IWF, TNGF, TWIF and W-AGF node granularity.\n-\tthe N3IWF, TNGF, TWIF and W-AGF releases the N2 connection when UE becomes unreachable from N3IWF, TNGF, TWIF and W-AGF point of view, i.e. upon Non-3GPP Access Connection release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.6\tSession Management",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.6.1\tOverview",
                            "text_content": "The 5GC supports a PDU Connectivity Service i.e. a service that provides exchange of PDUs between a UE and a data network identified by a DNN. The PDU Connectivity Service is supported via PDU Sessions that are established upon request from the UE.\nThe Subscription Information for each S-NSSAI may contain a Subscribed DNN list and one default DNN. When the UE does not provide a DNN in a NAS Message containing PDU Session Establishment Request for a given S-NSSAI, the serving AMF determines the DNN for the requested PDU Session by selecting the default DNN for this S-NSSAI if a default DNN is present in the UE's Subscription Information; otherwise the serving AMF selects a locally configured DNN for this S-NSSAI.\nThe expectation is that the URSP in the UE is always up to date using the procedure defined in clause 4.16.12.2 of TS 23.502 [3] and therefore the UE requested DNN will be up to date.\nIn order to cover cases that UE operates using local configuration, but also other cases where operator policies can be used in order to replace an \"up to date\" UE requested DNN with another DNN used only internally in the network, during UE Registration procedure the PCF may indicate, to the AMF, the operator policies to be used at PDU Session Establishment for DNN replacement of a UE requested DNN. PCF may indicate a policy for DNN replacement of UE requested DNNs not supported by the network, and/or indicate a list of UE requested DNNs per S-NSSAI valid for the serving network, that are subject for replacement (details are described in TS 23.503 [45]).\nIf the DNN provided by the UE is not supported by the network and AMF cannot select an SMF by querying NRF, the AMF shall reject the NAS Message containing PDU Session Establishment Request from the UE with a cause indicating that the DNN is not supported unless the PCF provided the policy to perform a DNN replacement of unsupported DNNs.\nIf the DNN requested by the UE is indicated for replacement or the DNN provided by the UE is not supported by the network and the PCF provided the policy to perform DNN replacement of UE requested DNNs not supported by the network, the AMF shall interact with the PCF to perform a DNN replacement. During PDU Session Establishment procedure and as a result of DNN replacement, the PCF provides the selected DNN that is applicable for the S-NSSAI requested by the UE at the PDU Session Establishment. The AMF uses the selected DNN in the query towards the NRF for the SMF selection, as specified in clause 6.3.2, and provides both requested and selected DNN to the selected SMF. For PDU Session with Home-routed Roaming whether to perform DNN replacement is based on operator agreements.\nNOTE 1:\tThe selected DNN is determined based on operator preferences and can differ from subscribed DNNs. The matching of selected DNN to S-NSSAI is assumed to be based on network configuration.\nEach PDU Session supports a single PDU Session type i.e. supports the exchange of a single type of PDU requested by the UE at the establishment of the PDU Session. The following PDU Session types are defined: IPv4, IPv6, IPv4v6, Ethernet, Unstructured.\nPDU Sessions are established (upon UE request), modified (upon UE and 5GC request) and released (upon UE and 5GC request) using NAS SM signalling exchanged over N1 between the UE and the SMF. Upon request from an Application Server, the 5GC is able to trigger a specific application in the UE. When receiving that trigger message, the UE shall pass it to the identified application in the UE. The identified application in the UE may establish a PDU Session to a specific DNN, see clause 4.4.5.\nSMF may support PDU Sessions for LADN where the access to a DN is only available in a specific LADN service area. This is further defined in clause 5.6.5.\nSMF may support PDU Sessions for a 5G VN group which offers a virtual data network capable of supporting 5G LAN-type service over the 5G system. This is further defined in clause 5.8.2.13.\nThe SMF is responsible of checking whether the UE requests are compliant with the user subscription. For this purpose, it retrieves and requests to receive update notifications on SMF level subscription data from the UDM. Such data may indicate per DNN and per S-NSSAI of the HPLMN:\n-\tThe allowed PDU Session Types and the default PDU Session Type.\n-\tThe allowed SSC modes and the default SSC mode.\n-\tQoS Information (refer to clause 5.7): the subscribed Session-AMBR, Default 5QI and Default ARP.\n-\tThe IP Index information.\n-\tThe static IP address/prefix.\n-\tThe subscribed User Plane Security Policy.\n-\tthe Charging Characteristics to be associated with the PDU Session. Whether this information is provided by the UDM to a SMF in another PLMN (for PDU Sessions in LBO mode) is defined by operator policies in the UDM/UDR.\nNOTE 2:\tThe content of the Charging Characteristics as well as the usage of the Charging Characteristics by the SMF are defined in TS 32.255 [68].\nA PDU Session may support:\n(a)\ta single-access PDU Connectivity Service, in which case the PDU Session is associated with a single access type at a given time, i.e. either 3GPP access or non-3GPP access; or\n(b) a multi-access PDU Connectivity Service, in which case the PDU Session is simultaneously associated with both 3GPP access and non-3GPP access and simultaneously associated with two independent N3/N9 tunnels between the PSA and RAN/AN.\nA PDU Session supporting a single-access PDU Connectivity Service is also referred to as single-access PDU Session, while a PDU Session supporting a multi-access PDU Connectivity Service is referred to as Multi-Access PDU (MA PDU) Session and it is used to support the ATSSS feature (see clause 5.32 for details).\nA UE that is registered over multiple accesses chooses over which access to establish a PDU Session. As defined in TS 23.503 [45], the HPLMN may send policies to the UE to guide the UE selection of the access over which to establish a PDU Session.\nNOTE 3:\tIn this Release of the specification, at any given time, a PDU Session is routed over only a single access network, unless it is an MA PDU Session in which case it can be routed over one 3GPP access network and one Non 3GPP access network concurrently.\nA UE may request to move a single-access PDU Session between 3GPP and Non 3GPP accesses. The decision to move single-access PDU Sessions between 3GPP access and Non 3GPP access is made on a per PDU Session basis, i.e. the UE may, at a given time, have some PDU Sessions using 3GPP access while other PDU Sessions are using Non 3GPP access.\nIf the UE is attempting to move a single-access PDU session from 3GPP access to non-3GPP access and the PDU session is associated with control plane only indication, then the AMF shall reject the PDU Session Establishment request as related CIoT 5GS optimisation features are not supported over non-3GPP access as described in clause 5.4.5.2.5 of TS 24.501 [47]. If the UE is attempting to move a single-access PDU session from non-3GPP access to NB-N1 mode of 3GPP access, the PDU Session Establishment request would also be rejected by AMF when the UP resources for the UE exceed the maximum number of supported UP resources as described in clause 5.4.5.2.4 of TS 24.501 [47].\nIn a PDU Session Establishment Request message sent to the network, the UE shall provide a PDU Session ID. The PDU Session ID is unique per UE and is the identifier used to uniquely identify one of a UE's PDU Sessions. The PDU Session ID shall be stored in the UDM to support handover between 3GPP and non-3GPP access when different PLMNs are used for the two accesses. The UE also provides as described in TS 24.501 [47]:\n(a)\tPDU Session Type.\n(b)\tS-NSSAI of the HPLMN that matches the application (that is triggering the PDU Session Request) within the NSSP in the URSP rules or within the UE Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45].\nNOTE 4:\tIf the UE cannot determine any S-NSSAI after performing the association of the application to a PDU Session, then it does not indicate any S-NSSAI in the PDU Session Establishment procedure as defined in clause 5.15.5.3.\n(c)\tS-NSSAI of the Serving PLMN from the Allowed NSSAI, corresponding to the S-NSSAI of the HPLMN (b).\nNOTE 5:\tIn non-roaming scenario the mapping of the Allowed NSSAI to HPLMN S-NSSAIs is not provided to the UE (because the S-NSSAI of the Serving PLMN (c) has the same value of the S-NSSAI of the HPLMN (b)), therefore the UE provides in the PDU Session Request only the S-NSSAI of the Serving PLMN (c).\nNOTE 6:\tIn roaming scenarios the UE provides in the PDU Session Request both the S-NSSAI of the HPLMN (b) and the S-NSSAI of the VPLMN from the Allowed NSSAI (c) that maps to the S-NSSAI of the HPLMN.\n(d)\tDNN (Data Network Name).\n(e)\tSSC mode (Service and Session Continuity mode defined in clause 5.6.9.2).\nAdditionally, if the UE supports ATSSS and wants to activate a MA PDU Session, the UE shall provide Request Type as \"MA PDU Request\" and shall indicate the supported ATSSS capabilities (see clause 5.32 for details).\nTable 5.6.1-1: Attributes of a PDU Session\n\nSubscription Information may include a wildcard DNN per subscribed S-NSSAI: when a wildcard DNN is associated with a subscribed S-NSSAI, the subscription allows, for this S-NSSAI, the UE to establish a PDU Session using any DNN value.\nNOTE 7:\tThe SMF is made aware whether the DNN of a PDU Session being established corresponds to an explicitly subscribed DNN or corresponds to a wildcard DNN. Thus, the SMF can reject a PDU Session establishment if the DNN of the PDU Session is not part of explicitly subscribed DNN(s) and local policies in the SMF require UE to have a subscription to this DNN.\nA UE may establish multiple PDU Sessions, to the same data network or to different data networks, via 3GPP and via and Non-3GPP access networks at the same time.\nA UE may establish multiple PDU Sessions to the same Data Network and served by different UPF terminating N6.\nA UE with multiple established PDU Sessions may be served by different SMF.\nThe SMF shall be registered and deregistered on a per PDU Session granularity in the UDM.\nThe user plane paths of different PDU Sessions (to the same or to different DNN) belonging to the same UE may be completely disjoint between the AN and the UPF interfacing with the DN.\nWhen the SMF cannot control the UPF terminating the N3 interface used by a PDU Session and SSC mode 2/3 procedures are not applied to the PDU Session, an I-SMF is inserted between the SMF and the AMF and handling of PDU Session(s) is described in clause 5.34.\nNOTE 8:\tUser Plane resources for PDU Sessions of a UE, except for regulatory prioritized service like Emergency Services and MPS, can be deactivated by the SMF if the UE is only reachable for regulatory prioritized services.\nThe SMF serving a PDU session (i.e. Anchor) can be changed during lifetime of the PDU session either within the same SMF set or, if the Context Transfer Procedures as specified in clause 4.26 of TS 23.502 [3] are supported, between SMFs in different SMF sets.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.6.1-1: Attributes of a PDU Session",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.6.2\tInteraction between AMF and SMF",
                            "text_content": "The AMF and SMF are separate Network Functions.\nN1 related interaction with SMF is as follows:\n-\tThe single N1 termination point is located in AMF. The AMF forwards SM related NAS information to the SMF based on the PDU Session ID in the NAS message. Further SM NAS exchanges (e.g. SM NAS message responses) for N1 NAS signalling received by the AMF over an access (e.g. 3GPP access or non-3GPP access) are transported over the same access.\n-\tThe serving PLMN ensures that subsequent SM NAS exchanges (e.g. SM NAS message responses) for N1 NAS signalling received by the AMF over an access (e.g. 3GPP access or non-3GPP access) are transported over the same access.\n-\tSMF handles the Session management part of NAS signalling exchanged with the UE.\n-\tThe UE shall only initiate PDU Session Establishment in RM-REGISTERED state.\n-\tWhen a SMF has been selected to serve a specific PDU Session, AMF has to ensure that all NAS signalling related with this PDU Session is handled by the same SMF instance.\n-\tUpon successful PDU Session Establishment, the AMF and SMF stores the Access Type that the PDU Session is associated.\nN11 related interaction with SMF is as follows:\n-\tThe AMF reports the reachability of the UE based on a subscription from the SMF, including:\n-\tThe UE location information with respect to the area of interest indicated by the SMF.\n-\tThe SMF indicates to AMF when a PDU Session has been released.\n-\tUpon successful PDU Session Establishment, AMF stores the identification of serving SMF of UE and SMF stores the identification of serving AMF of UE including the AMF set. When trying to reach the AMF serving the UE, the SMF may need to apply the behaviour described for \"the other CP NFs\" in clause 5.21.\nN2 related interaction with SMF is as follows:\n-\tSome N2 signalling (such as handover related signalling) may require the action of both AMF and SMF. In such case, the AMF is responsible to ensure the coordination between AMF and SMF. The AMF may forward the SM N2 signalling towards the corresponding SMF based on the PDU Session ID in N2 signalling.\n-\tSMF shall provide PDU Session Type together with PDU Session ID to NG-RAN, in order to facilitate NG-RAN to apply suitable header compression mechanism to packet of different PDU type. Details refer to TS 38.413 [34].\nN3 related interaction with SMF is as follows:\n-\tSelective activation and deactivation of UP connection of existing PDU Session is defined in clause 5.6.8.\nN4 related interaction with SMF is as follows:\n-\tWhen it is made aware by the UPF that some DL data has arrived for a UE without downlink N3 tunnel information, the SMF interacts with the AMF to initiate Network Triggered Service Request procedure. In this case, if the SMF is aware that the UE is unreachable or if the UE is reachable only for regulatory prioritized service and the PDU Session is not for regulatory prioritized service, then the SMF shall not inform DL data notification to the AMF\nThe AMF is responsible of selecting the SMF per procedures described in clause 6.3.2. For this purpose, it gets subscription data from the UDM that are defined in that clause. Furthermore, it retrieves the subscribed UE-AMBR from the UDM, and optionally dynamic serving network UE-AMBR from PCF based on operator local policy, and sends to the (R)AN as defined in clause 5.7.2\nAMF-SMF interactions to support LADN or LADN per DNN and S-NSSAI are defined in clause 5.6.5 and in clause 5.6.5a.\nIn order to support charging and to fulfil regulatory requirement (in order to provide NPLI (Network Provided Location Information) as defined in TS 23.228 [15]) related with the set-up, modification and release of IMS Voice calls or with SMS transfer the following applies\n-\tAt the time of the PDU Session Establishment, the AMF provides the SMF with the PEI of the UE if the PEI is available at the AMF.\n-\tWhen it forwards UL NAS or N2 signalling to a peer NF (e.g. to SMF or to SMSF) or during the UP connection activation of a PDU Session, the AMF provides any User Location Information it has received from the 5G-AN as well as the Access Type (3GPP - Non 3GPP) of the AN over which it has received the UL NAS or N2 signalling. The AMF also provides the corresponding UE Time Zone. In addition, in order to fulfil regulatory requirement (i.e. providing Network Provided Location Information (NPLI), as defined in TS 23.228 [15]) when the access is non-3GPP, the AMF may also provide the last known 3GPP access User Location Information with its age, if the UE is still attached to the same AMF for 3GPP access (i.e. valid User Location Information).\nThe User Location Information, the access type and the UE Time Zone may be further provided by SMF to PCF. The PCF may get this information from the SMF in order to provide NPLI to applications (such as IMS) that have requested it.\nThe User Location Information may correspond to:\n-\tIn the case of 3GPP access: TAI, Cell-Id. The AMF includes only the Primary Cell-Id even if it had received also the Cell-Id of the Primary cell in the Secondary RAN node from NG-RAN.\n-\tIn the case of Untrusted non-3GPP access: TAI, the UE local IP address used to reach the N3IWF and optionally the UDP source port number if NAT is detected.\n-\tIn the case of Trusted non-3GPP access: TAI, TNAP/TWAP Identifier, the UE/N5CW device local IP address used to reach the TNGF/TWIF and optionally the UDP source port number if NAT is detected.\nWhen the UE uses WLAN based on IEEE 802.11 technology to reach the TNGF, the TNAP Identifier shall include the SSID of the access point to which the UE is attached. The TNAP Identifier shall include at least one of the following elements, unless otherwise determined by the TWAN operator's policies:\n-\tthe BSSID (see IEEE Std 802.11-2012 [106]);\n-\tcivic address information of the TNAP to which the UE is attached.\nThe TWAP Identifier shall include the SSID of the access point to which the NC5W is attached. The TWAP Identifier shall also include at least one of the following elements, unless otherwise determined by the TWAN operator's policies:\n-\tthe BSSID (see IEEE Std 802.11-2012 [106]);\n-\tcivic address information of the TWAP to which the UE is attached.\nNOTE 1:\tThe SSID can be the same for several TNAPs/TWAPs and SSID only cannot provide a location, but it might be sufficient for charging.\nNOTE 2:\tthe BSSID associated with a TNAP/TWAP is assumed to be static.\n-\tIn the case of W-5GAN access: The User Location Information for W-5GAN is defined in TS 23.316 [84].\nWhen the SMF receives a request to provide Access Network Information reporting while there is no action to carry out towards the 5G-AN or the UE (e.g. no QoS Flow to create / Update / modify), the SMF may request User Location Information from the AMF.\nThe interaction between AMF and SMF(s) for the case of a I-SMF insertion, relocation or removal for a PDU session is described in clause 5.34.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.3\tRoaming",
                            "text_content": "In the case of roaming the 5GC supports following possible deployments scenarios for a PDU Session:\n-\t\"Local Break Out\" (LBO) where the SMF and all UPF(s) involved by the PDU Session are under control of the VPLMN.\n-\t\"Home Routed\" (HR) where the PDU Session is supported by a SMF function under control of the HPLMN, by a SMF function under control of the VPLMN, by at least one UPF under control of the HPLMN and by at least one UPF under control of the VPLMN. In this case the SMF in HPLMN selects the UPF(s) in the HPLMN and the SMF in VPLMN selects the UPF(s) in the VPLMN. This is further described in clause 6.3. Home Routed with Session Breakout in VPLMN (HR-SBO) is described in clause 6.7 of TS 23.548 [130].\nNOTE 1:\tThe use of an UPF in the VPLMN e.g. enables VPLMN charging, VPLMN LI and minimizes the impact on the HPLMN of the UE mobility within the VPLMN (e.g. for scenarios where SSC mode 1 applies).\nDifferent simultaneous PDU Sessions of an UE may use different modes: Home Routed and LBO. The HPLMN can control via subscription data per DNN and per S-NSSAI whether a PDU Session is to be set-up in HR or in LBO mode.\nIn the case of PDU Sessions per Home Routed deployment:\n-\tNAS SM terminates in the SMF in VPLMN.\n-\tThe SMF in VPLMN forwards to the SMF in the HPLMN SM related information.\n-\tThe SMF in the HPLMN receives the SUPI of the UE from the SMF in the VPLMN during the PDU Session Establishment procedure.\n-\tThe SMF in HPLMN is responsible to check the UE request with regard to the user subscription and to possibly reject the UE request in the case of mismatch. The SMF in HPLMN obtains subscription data directly from the UDM.\n-\tThe SMF in HPLMN may send QoS requirements associated with a PDU Session to the SMF in VPLMN. This may happen during the PDU Session Establishment procedure and after the PDU Session is established. The interface between SMF in HPLMN and SMF in VPLMN is also able to carry (N9) User Plane forwarding information exchanged between SMF in HPLMN and SMF in VPLMN. The SMF in the VPLMN may check QoS requests from the SMF in HPLMN with respect to roaming agreements.\nIn home routed roaming case, the AMF selects an SMF in the VPLMN and a SMF in the HPLMN as described in clause 6.3.2 and in clause 4.3.2.2.3.3 of TS 23.502 [3], and provides the identifier of the selected SMF in the HPLMN to the selected SMF in the VPLMN.\nIn roaming with LBO, the AMF selects a SMF in the VPLMN as described in clause 6.3.2 and in clause 4.3.2.2.3.2 of TS 23.502 [3]. In this case, when handling a PDU Session Establishment Request message, the SMF in the VPLMN may reject the N11 message (related with the PDU Session Establishment Request message) with a proper N11 cause. This triggers the AMF to select both a new SMF in the VPLMN and a SMF in the HPLMN in order to handle the PDU Session using home routed roaming.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.4\tSingle PDU Session with multiple PDU Session Anchors",
                            "text_content": "In order to support selective traffic routing to the DN or to support SSC mode 3 as defined in clause 5.6.9.2.3, the SMF may control the data path of a PDU Session so that the PDU Session may simultaneously correspond to multiple N6 interfaces. The UPF that terminates each of these interfaces is said to support PDU Session Anchor functionality. Each PDU Session Anchor supporting a PDU Session provides a different access to the same DN. Further, the PDU Session Anchor assigned at PDU Session Establishment is associated with the SSC mode of the PDU Session and the additional PDU Session Anchor(s) assigned within the same PDU Session e.g. for selective traffic routing to the DN are independent of the SSC mode of the PDU Session. When a PCC rule including the Application Function influence on traffic routing Enforcement Control information defined in clause 6.3.1 of TS 23.503 [45] is provided to the SMF, the SMF can decide whether to apply traffic routing (by using UL Classifier functionality or IPv6 multi-homing) based on DNAI(s) included in the PCC rule.\nNOTE 1:\tApplication Function influence on traffic routing Enforcement Control information can be either determined by the PCF when requested by AF via NEF as described in clause 5.6.7.1 or statically pre-configured in the PCF.\nNOTE 2:\tSelective traffic routing to the DN supports, for example, deployments where some selected traffic is forwarded on an N6 interface to the DN that is \"close\" to the AN serving the UE.\nThis may correspond to\n-\tThe Usage of UL Classifier functionality for a PDU Session defined in clause 5.6.4.2.\n-\tThe Usage of an IPv6 multi-homing for a PDU Session defined in clause 5.6.4.3.\nSMF may also take decision to apply traffic routing (by using UL Classifier functionality or IPv6 multi-homing) in EAS Discovery with EASDF procedure described in TS 23.548 [130].\nIn the case of PDU Sessions of type IPv4 or IPv6 or IPv4v6 or Ethernet, the SMF may decide to insert in the data path of a PDU Session an \"UL CL\" (Uplink classifier). The UL CL is a functionality supported by an UPF that aims at diverting (locally) some traffic matching traffic filters provided by the SMF. The insertion and removal of an UL CL is decided by the SMF and controlled by the SMF using generic N4 and UPF capabilities. The SMF may decide to insert in the data path of a PDU Session a UPF supporting the UL CL functionality during or after the PDU Session Establishment, or to remove from the data path of a PDU Session a UPF supporting the UL CL functionality after the PDU Session Establishment. The SMF may include more than one UPF supporting the UL CL functionality in the data path of a PDU Session.\nThe UE is unaware of the traffic diversion by the UL CL, and does not involve in both the insertion and the removal of UL CL. In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, the UE associates the PDU Session with either a single IPv4 address or a single IPv6 Prefix or both of them allocated by the network.\nWhen an UL CL functionality has been inserted in the data path of a PDU Session, there are multiple PDU Session Anchors for this PDU Session. These PDU Session Anchors provide different access to the same DN. In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, only one IPv4 address and/or IPv6 prefix is provided to the UE. The SMF may be configured with local policies for some (DNN, S-NSSAI) combinations to release the PDU Session when there is a PSA associated with the IPv4 address allocated to the UE and this PSA has been removed.\nNOTE 0:\tThe use of only one IPv4 address and/or IPv6 prefix with multiple PDU Session Anchors assumes that when needed, appropriate mechanisms are in place to correctly forward packets on the N6 reference point. The mechanisms for packet forwarding on the N6 reference point between the PDU Session Anchor providing local access and the DN are outside the scope of this specification.\nThe UL CL provides forwarding of UL traffic towards different PDU Session Anchors and merge of DL traffic to the UE i.e. merging the traffic from the different PDU Session Anchors on the link towards the UE. This is based on traffic detection and traffic forwarding rules provided by the SMF.\nThe UL CL applies filtering rules (e.g. to examine the destination IP address/Prefix of UL IP packets sent by the UE) and determines how the packet should be routed. The UPF supporting an UL CL may also be controlled by the SMF to support traffic measurement for charging, traffic replication for LI and bit rate enforcement (Session-AMBR per PDU Session).\nNOTE 1:\tWhen N9 forwarding tunnel exists between source ULCL and target ULCL, the Session-AMBR per PDU Session can be enforced by the source UL CL UPF.\nNOTE 2:\tThe UPF supporting an UL CL may also support a PDU Session Anchor for connectivity to the local access to the data network (including e.g. support of tunnelling or NAT on N6). This is controlled by the SMF.\nAdditional UL CLs (and thus additional PDU Session Anchors) can be inserted in the data path of a PDU Session to create new data paths for the same PDU Session. The way to organize the data path of all UL CLs in a PDU Session is up to operator configuration and SMF logic and there is only one UPF supporting UL CL connecting to the (R)AN via N3 interface, except when session continuity upon UL CL relocation is used.\nThe insertion of an ULCL in the data path of a PDU Session is depicted in Figure 5.6.4.2-1.\nThe figure depicts the user plane architecture for the Uplink Classifier in a 5G network. It illustrates the various components and their interconnections, including the base station (gNB), user equipment (UE), and the uplink classifier. The figure highlights the importance of beamforming techniques to mitigate interference and ensure reliable communication.\nFigure 5.6.4.2-1: User plane Architecture for the Uplink Classifier\nNOTE 3:\tIt is possible for a given UPF to support both the UL CL and the PDU Session Anchor functionalities.\nDue to UE mobility the network may need to relocate the UPF acting as UL CL and establish a new PSA for local access to the DN. To support session continuity during UL CL relocation the network may establish a temporary N9 forwarding tunnel between the source UL CL and target UL CL. The AF may influence the creation of the N9 forwarding tunnel as described in clause 5.6.7.1.\nThe N9 forwarding tunnel is maintained until:\n-\tall active traffic flowing on it ceases to exist for:\n-\ta configurable period of time; or\n-\ta period of time indicated by the AF;\n-\tuntil the AF informs the SMF that it can release the source PSA providing local access to the DN.\nDuring the existence of the N9 forwarding tunnel the UPF acting as target UL CL is configured with packet filters that:\n-\tforce uplink traffic from existing data sessions between UE and the application in the source local part of the DN (as defined in TS 23.548 [130]) into the N9 forwarding tunnel towards the source UL CL.\n-\tforce any traffic related to the application in the target local part of the DN to go to the new local part of the DN via the target PSA.\nSMF may send a Late Notification to AF to inform it about the DNAI change as described in clause 4.3.6.3 of TS 23.502 [3]. This notification can be used by the AF e.g. to trigger mechanisms in the source local part of the DN to redirect the ongoing traffic sessions towards an application in the target local part of the DN. SMF can also send late notification to the target AF instance if associated with this target local part of the DN.\nThe procedure for session continuity upon UL CL relocation is described in clause 4.3.5.7 of TS 23.502 [3].\nWhen an I-SMF is inserted for a PDU Session, the details of UL CL insertion which is controlled by an I-SMF is described in clause 5.34.4.\nA PDU Session may be associated with multiple IPv6 prefixes. This is referred to as multi-homed PDU Session. The multi-homed PDU Session provides access to the Data Network via more than one PDU Session Anchor. The different user plane paths leading to the different PDU Session Anchors branch out at a \"common\" UPF referred to as a UPF supporting \"Branching Point\" functionality. The Branching Point provides forwarding of UL traffic towards the different PDU Session Anchors and merge of DL traffic to the UE i.e. merging the traffic from the different PDU Session Anchors on the link towards the UE.\nThe UPF supporting a Branching Point functionality may also be controlled by the SMF to support traffic measurement for charging, traffic replication for LI and bit rate enforcement (Session-AMBR per PDU Session). The insertion and removal of a UPF supporting Branching Point is decided by the SMF and controlled by the SMF using generic N4 and UPF capabilities. The SMF may decide to insert in the data path of a PDU Session a UPF supporting the Branching Point functionality during or after the PDU Session Establishment, or to remove from the data path of a PDU Session a UPF supporting the Branching Point functionality after the PDU Session Establishment.\nMulti homing of a PDU Session applies only for PDU Sessions of IPv6 type. When the UE requests a PDU Session of type \"IPv4v6\" or \"IPv6\" the UE also provides an indication to the network whether it supports a Multi-homed IPv6 PDU Session.\nThe use of multiple IPv6 prefixes in a PDU Session is characterised by the following:\n-\tThe UPF supporting a Branching Point functionality is configured by the SMF to spread UL traffic between the PDU Session Anchors based on the Source Prefix of the PDU (which may be selected by the UE based on routing information and preferences received from the network).\n-\tIETF RFC 4191 [8] is used to configure routing information and preferences into the UE to influence the selection of the source Prefix.\nNOTE 1:\tThis corresponds to Scenario 1 defined in IETF RFC 7157 [7] \"IPv6 Multi-homing without Network Address Translation\". This allows to make the Branching Point unaware of the routing tables in the Data Network and to keep the first hop router function in the PDU Session Anchors.\n-\tThe multi-homed PDU Session may be used to support make-before-break service continuity to support SSC mode 3. This is illustrated in Figure 5.6.4.3-1.\n-\tThe multi-homed PDU Session may also be used to support cases where UE needs to access both a local service (e.g. local server) and a central service (e.g. the internet), illustrated in Figure 5.6.4.3-2.\n-\tThe UE shall use the method specified in clause 4.3.5.3 of TS 23.502 [3] to determine if a multi-homed PDU Session is used to support the service continuity case shown in Figure 5.6.4.3-1, or if it is used to support the local access to DN case shown in Figure 5.6.4.3-2.\nThe figure depicts a multi-homed PDU Session, illustrating the service continuity case in a 5G network. It shows how a PDU (Primary Distribution Unit) can be connected to multiple service providers, ensuring that the network remains operational even if one of the connections fails. The figure highlights the importance of network redundancy and failover mechanisms in ensuring the continuity of service.\nFigure 5.6.4.3-1: Multi-homed PDU Session: service continuity case\nNOTE 2:\tIt is possible for a given UPF to support both the Branching Point and the PDU Session Anchor functionalities.\nThe figure depicts a multi-homed PDU session, where local access is provided to the same DN. This is achieved through the use of a single-mode optical fiber, which is used to transmit the data between the PDU and the local access point. The figure illustrates the various components involved in this session, such as the PDU, the local access point, and the optical fiber. The use of a single-mode optical fiber ensures that the data is transmitted at a high speed and is compatible with the existing network infrastructure.\nFigure 5.6.4.3-2: Multi-homed PDU Session: local access to same DN\nNOTE 3:\tIt is possible for a given UPF to support both the Branching Point and the PDU Session Anchor functionalities.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.5\tSupport for Local Area Data Network",
                            "text_content": "The access to a DN via a PDU Session for a LADN is only available in a specific LADN service area. A LADN service area is a set of Tracking Areas. LADN is a service provided by the serving PLMN or the serving SNPN. It includes:\n-\tLADN service applies only to 3GPP accesses and does not apply in Home Routed case.\n-\tThe usage of LADN DNN requires an explicit subscription to this DNN or subscription to a wildcard DNN.\n-\tWhether a DNN corresponds to a LADN service is an attribute of a DNN and is per PLMN or per SNPN.\nThe UE is configured to know whether a DNN is a LADN DNN on a per-PLMN or per SNPN basis, and an association between application and LADN DNN. The configured association is considered to be a UE local configuration defined in TS 23.503 [45]. Alternatively, the UE gets the information whether a DNN is a LADN DNN from LADN Information during (re-)registration procedure as described in this clause.\nNOTE 1:\tNo other procedure for configuring the UE to know whether a DNN is a LADN DNN is defined in this release of the specifications.\nNOTE 2:\tThe procedure for configuring the UE to know an association between application and LADN DNN is not defined in this release of the specifications.\nLADN service area and LADN DNN are configured in the AMF on a per DN basis, i.e. for different UEs accessing the same LADN, the configured LADN service area is the same regardless of other factors (e.g. UE's Registration Area or UE subscription).\nNOTE 3:\tIf a LADN is not available in any TA of an AMF's service area, the AMF is not required to be configured with any LADN related information for that DNN.\nLADN Information (i.e. LADN Service Area Information and LADN DNN) is provided by AMF to the UE during the Registration procedure or UE Configuration Update procedure. For each LADN DNN configured in the AMF, the corresponding LADN Service Area Information includes a set of Tracking Areas that belong to the Registration Area that the AMF assigns to the UE (i.e. the intersection of the LADN service area and the assigned Registration Area). The AMF shall not create Registration Area based on the availability of LADNs.\nNOTE 4:\tIt is thus possible that the LADN Service Area Information sent by the AMF to the UE contains only a sub-set of the full LADN service area as the LADN service area can contain TA(s) outside of the registration area of the UE or outside of the area served by the AMF.\nWhen the UE performs a successful (re-)registration procedure, the AMF may provide to the UE, based on local configuration (e.g. via OAM) about LADN, on UE location, and on UE subscription information received from the UDM about subscribed DNN(s), the LADN Information for the list of LADN available to the UE in that Registration Area in the Registration Accept message.\nThe UE may provide either the LADN DNN(s) to retrieve the LADN Information for the indicated LADN DNN(s) or an indication of Requesting LADN Information to retrieve the LADN Information for all LADN(s) available in the current Registration Area.\nThe list of LADN is determined as follows:\n-\tIf neither LADN DNN nor an indication of requesting LADN Information is provided in the Registration Request message, the list of LADN is the LADN DNN(s) in subscribed DNN list except for wildcard DNN.\n-\tIf the UE provides LADN DNN(s) in the Registration Request message, the list of LADN is LADN DNN(s) the UE requested if the UE subscribed DNN(s) includes the requested LADN DNN or if a wildcard DNN is included in the UE's subscription data.\nNOTE 5:\tIt is assumed that an application can use only one LADN DNN at a time.\n-\tIf the UE provides an indication of requesting LADN Information in the Registration Request message, the list of LADN is all the LADN DNN(s) configured in the AMF if the wildcard DNN is subscribed, or the LADN DNN(s) which is in subscribed DNN list and no wildcard DNN is subscribed.\nThe UE considers the retrieved LADN Information valid only for the registered PLMN and the E-PLMN(s) if the LADN Service Area Information includes Tracking Areas that belong to E-PLMN(s). Additionally, an LADN DNN discovered by the UE via the retrieved LADN Information is considered an LADN DNN also in the E-PLMNs of the Registered PLMN, i.e. the UE can request LADN Information for the discovered LADN DNN in the E-PLMNs.\nDuring the subsequent Registration procedure, if the network does not provide LADN Information for a DNN, the UE deletes any LADN Information for that DNN.\nWhen the LADN Information for the UE in the 5GC is changed, the AMF shall update LADN Information to the UE through UE Configuration Update/Registration procedure as described in clauses 4.2.4 / 4.2.2.2.2 of TS 23.502 [3].\nWhen receiving PDU Session Establishment with LADN DNN or Service Request for the established PDU Session corresponding to LADN, the AMF determines UE presence in LADN service area and forwards it to the SMF if the requested DNN is configured at the AMF as a LADN DNN.\nBased on the LADN Service Area Information in the UE, the UE determines whether it is in or out of a LADN service area. If the UE does not have the LADN Service Area Information for a LADN DNN, the UE shall consider it is out of the LADN service area.\nThe UE takes actions as follows:\na)\tWhen the UE is out of a LADN service area, the UE:\n-\tshall not request to activate UP connection of a PDU Session for this LADN DNN;\n-\tshall not attempt to send user data as payload of a NAS message (see clause 5.31.4.1) using a PDU Session for this LADN DNN;\n-\tshall not establish/modify a PDU Session for this LADN DNN (except for PS Data Off status change reporting for an established PDU Session);\n-\tneed not release any existing PDU Session for this LADN DNN unless UE receives explicit SM PDU Session Release Request message from the network.\nb)\tWhen the UE is in a LADN service area, the UE:\n-\tmay request a PDU Session Establishment/Modification for this LADN DNN;\n-\tmay request to activate UP connection of the existing PDU Session for this LADN DNN;\n-\tmay attempt to send user data as payload of a NAS message (see clause 5.31.4.1) using a PDU Session for this LADN DNN.\nNOTE 6:\tThe evaluation of Service Area Restrictions will be performed before the evaluation of LADN service area, if the UE has overlapping areas between Service Area Restrictions and LADN service area.\nThe SMF supporting a DNN is configured with information about whether this DNN is a LADN DNN or not.\nWhen receiving SM request corresponding an LADN from the AMF, the SMF determines whether the UE is inside LADN service area based on the indication (i.e. UE Presence in LADN service area) received from the AMF. If the SMF does not receive the indication, the SMF considers that the UE is outside of the LADN service area. The SMF shall reject the request if the UE is outside of the LADN service area.\nWhen the SMF receives a request for PDU Session Establishment with the LADN DNN, it shall subscribe to \"UE mobility event notification\" for reporting UE presence in Area of Interest by providing LADN DNN to the AMF as described in clauses 5.6.11 and 5.3.4.4.\nBased on the notification about the UE presence in LADN service area notified by AMF (i.e. IN, OUT, or UNKNOWN), the SMF takes actions as follows based on operator's policy:\na)\tWhen SMF is informed that the UE presence in a LADN service area is OUT, the SMF shall:\n-\trelease the PDU Session immediately; or\n-\tdeactivate the user plane connection for the PDU Session and it shall not attempt to send user data as payload of a NAS message (see clause 5.31.4.1) while maintaining the PDU Session and ensure the Data Notification is disabled and the SMF may release the PDU Session if the SMF is not informed that the UE moves into the LADN service area after a period.\nb)\tWhen SMF is informed that the UE presence a LADN service area is IN, the SMF shall:\n-\tensure that Data Notification is enabled.\n-\ttrigger the Network triggered Service Request procedure for a LADN PDU Session to active the UP connection or send user data as payload of a NAS message (see clause 5.31.4.1) when the SMF receives downlink data or Data Notification from UPF.\nc)\tWhen the SMF is informed that the UE presence in a LADN service area is UNKNOWN, the SMF may:\n-\tensure that Data Notification is enabled.\n-\ttrigger the Network triggered Service Request procedure for a LADN PDU Session to active the UP connection or send user data as payload of a NAS message (see clause 5.31.4.1) when the SMF receives downlink data or Data Notification from UPF.\nSMF may make use of UE mobility analytics provided by NWDAF, as described in clause 6.7.2 of TS 23.288 [86], to determine UE presence pattern in LADN service area and take a decision how to handle LADN PDN Session (e.g. release the PDU Session immediately, or deactivate the user plane connection for the PDU Session with maintaining the PDU Session).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.5a\tSupporting LADN per DNN and S-NSSAI",
                            "text_content": "The 5GS may support LADN per DNN and S-NSSAI, and the functions specified in clause 5.6.5 are used (with the extension to apply per DNN and S-NSSAI whenever applicable) with the following enhancements:\n-\tThe UE indicates the support of LADN per DNN and S-NSSAI in the UE MM Core Network Capability of the Registration Request message.\n-\tThe LADN service area can be provisioned for a group (e.g. 5G VN group) or an individual subscriber using UDM/NEF parameter provisioning service triggered by AF request as described in clause 4.15.6 of TS 23.502 [3].\n-\tLADN service area per DNN and S-NSSAI may be configured in the AMF. The LADN service area may also be provided to AMF as part of the subscription data from UDM.\n-\tThe LADN Service Area Information provided to the UE is determined by AMF, based on the Registration Area that the AMF assigns to the UE and either the local configured LADN service area or the LADN service area received from UDM. In case there is both a configured LADN service area and a LADN service area received from UDM, the AMF decides based on operator configuration which one takes precedence.\n-\tIf the UE indicates support of LADN per DNN and S-NSSAI, the AMF may provide the LADN Service Area Information per LADN DNN and S-NSSAI to the UE.\n-\tIf the UE does not indicate support of LADN per DNN and S-NSSAI and the AMF has a LADN service area for the DNN as well as a LADN service area for the DNN and S-NSSAI, the AMF may determine the LADN Service Area Information per LADN DNN sent to UE using the LADN service area for the DNN as described in clause 5.6.5.\n-\tIf the UE does not indicate support of LADN per DNN and S-NSSAI and the AMF has no LADN service area for the DNN but there is a LADN service area for the DNN and S-NSSAI, then the AMF may determine the LADN Service Area Information per LADN DNN sent to UE using this LADN service area for the DNN and S-NSSAI as the LADN service area for that DNN as described in clause 5.6.5 if the UE is not subscribed to the same DNN for multiple S-NSSAI(s) (i.e. the UE is subscribed to the DNN for a single S-NSSAI only).\nNOTE 1:\tIn order to serve the UEs that do not support LADN per DNN and S-NSSAIs, the operator can avoid using the same DNN for multiple S-NSSAIs if LADN service area is configured per DNN and S-NSSAI.\n-\tIf the UE does not indicate support of LADN per DNN and S-NSSAI and the AMF neither has a LADN service area for the DNN nor has a LADN service area for the DNN and S-NSSAI, the AMF shall not provide any LADN Information to the UE.\n-\tThe AMF enforces the LADN Service Area per LADN DNN and S-NSSAI in the same way as is described in clause 5.6.5 with the difference that the LADN service area is defined per DNN and S-NSSAI.\n-\tThe UE enforces the LADN Service Area per LADN DNN and S-NSSAI, if received from the AMF, in the same way as is described in clause 5.6.5 with the difference that the LADN service area is defined per DNN and S-NSSAI.\n-\tIf the AMF enforces the LADN Service Area per LADN DNN and S-NSSAI for the UE, the AMF indicates to the SMF during PDU Session Establishment that the PDU Session is subject to LADN per LADN DNN and S-NSSAI.\n-\tIf indicated by AMF at PDU Session Establishment that PDU Session is subject to LADN per LADN DNN and S-NSSAI, the SMF configures the DNN of PDU Session as LADN DNN. The SMF shall subscribe to \"UE mobility event notification\" for reporting UE presence in Area of Interest by providing LADN DNN and S-NSSAI to the AMF as described in clauses 5.6.11 and 5.3.4.4. The SMF handles the PDU session in the same way as described in clause 5.6.5.\nNOTE 2:\tIf the UE has overlapping areas between LADN service area configured per DNN & S-NSSAI, Partial network slice support area, or any combination of them, then the evaluation of Partial network slice support area take precedence over the evaluation of LADN service area configured per DNN and S-NSSAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.6\tSecondary authentication/authorization by a DN-AAA server during the establishment of a PDU Session",
                            "text_content": "At PDU Session Establishment to a DN:\n-\tThe DN-specific identity (TS 33.501 [29]) of a UE may be authenticated/authorized by the DN.\nNOTE 1: the DN-AAA server may belong to the 5GC or to the DN.\n-\tIf the UE provides authentication/authorization information corresponding to a DN-specific identity during the Establishment of the PDU Session, and the SMF determines that Secondary authentication/authorization of the PDU Session Establishment is required based on the SMF policy associated with the DN, the SMF passes the authentication/authorization information of the UE to the DN-AAA server via the UPF if the DN-AAA server is located in the DN. If the SMF determines that Secondary authentication/authorization of the PDU Session Establishment is required but the UE has not provided a DN-specific identity as part of the PDU Session Establishment request, the SMF requests the UE to indicate a DN-specific identity using EAP procedures as described in TS 33.501 [29]. If the Secondary authentication/authorization of the PDU Session Establishment fails, the SMF rejects the PDU Session Establishment.\nNOTE 2:\tIf the DN-AAA server is located in the 5GC and reachable directly, then the SMF may communicate with it directly without involving the UPF.\n-\tThe DN-AAA server may authenticate/authorize the PDU Session Establishment.\n-\tWhen DN-AAA server authorizes the PDU Session Establishment, it may send DN Authorization Data for the established PDU Session to the SMF. The DN authorization data for the established PDU Session may include one or more of the following:\n-\tA DN Authorization Profile Index which is a reference to authorization data for policy and charging control locally configured in the SMF or PCF.\n-\ta list of allowed MAC addresses for the PDU Session; this shall apply only for PDU Session of Ethernet PDU type and is further described in clause 5.6.10.2.\n-\ta list of allowed VLAN tags for the PDU Session; this shall apply only for PDU Session of Ethernet PDU type and is further described in clause 5.6.10.2.\n-\tDN authorized Session AMBR for the PDU Session. The DN Authorized Session AMBR for the PDU Session takes precedence over the subscribed Session-AMBR received from the UDM.\n-\tFramed Route information (see clause 5.6.14) for the PDU Session.\n-\tL2TP information, such as LNS IP address and/or LNS host name, as described in TS 29.561 [132].\nSMF policies may require DN authorization without Secondary authentication/authorization. In that case, when contacting the DN-AAA server for authorization, the SMF provides the GPSI of the UE if available.\nSuch Secondary authentication/authorization takes place for the purpose of PDU Session authorization in addition to:\n-\tThe 5GC access authentication handled by AMF and described in clause 5.2.\n-\tThe PDU Session authorization enforced by SMF with regards to subscription data retrieved from UDM.\nBased on local policies the SMF may initiate Secondary authentication/authorization at PDU Session Establishment. The SMF provides the GPSI, if available, in the signalling exchanged with the DN-AAA during Secondary authentication/authorization.\nAfter the successful Secondary authentication/authorization, a session is kept between the SMF and the DN-AAA.\nThe UE provides the authentication/authorization information required to support Secondary authentication/authorization by the DN over NAS SM.\nIf a UE is configured with DNNs, which are subject to secondary authentication/authorization, the UE stores an association between the DNN and corresponding credentials for the secondary authentication/authorization.\nNOTE 3:\tHow the UE is aware that a DNN is subject to secondary authentication/authorization (e.g. based on local configuration) is out of scope of this specification.\nThe UE may support remote provisioning of credentials for secondary authentication/authorization, as specified in clause 5.39.\nA UE that supports to be provisioned with the credentials used for secondary authentication/authorization over UP remote provisioning shall use connectivity over an S-NSSAI/DNN which can access the provisioning server to establish a PDU session for remote provisioning as defined in clause 5.39.\nNOTE 4:\tThe credentials for secondary authentication/authorization are not specified.\nSMF policies or subscription information (such as defined in Table 5.2.3.3.1 of TS 23.502 [3]) may trigger the need for SMF to request the Secondary authentication/authorization and/or UE IP address / Prefix from the DN-AAA server.\nWhen SMF adds a PDU Session Anchor (such as defined in clause 5.6.4) to a PDU Session Secondary authentication/authorization is not carried out, but SMF policies may require SMF to notify the DN when a new prefix or address has been added to or removed from a PDU Session or N6 traffic routing information has been changed for a PDU Session.\nWhen SMF gets notified from UPF with the addition or removal of MAC addresses to/from a PDU Session, the SMF policies may require SMF to notify the DN-AAA server.\nIndication of PDU Session Establishment rejection is transferred by SMF to the UE via NAS SM.\nIf the DN-AAA sends DN Authorization Data for the authorized PDU Session to the SMF and dynamic PCC is deployed, the SMF sends the PCF the DN authorized Session AMBR and/or DN Authorization Profile Index in the DN Authorization Data for the established PDU Session.\nIf the DN-AAA sends DN Authorization Profile Index in DN Authorization Data to the SMF and dynamic PCC is not deployed, the SMF uses the DN Authorization Profile Index to refer the locally configured information.\nNOTE 5:\tDN Authorization Profile Index is assumed to be pre-negotiated between the operator and the administrator of DN-AAA server.\nIf the DN-AAA does not send DN Authorization Data for the established PDU Session, the SMF may use locally configured information.\nAt any time, a DN-AAA server may revoke the authorization for a PDU Session or update DN Authorization Data for a PDU Session. According to the request from DN-AAA server, the SMF may release or update the PDU Session. See clause 5.6.14 when the update involves Framed Route information.\nAt any time, a DN-AAA server or SMF may trigger Secondary Re-authentication procedure for a PDU Session established with Secondary Authentication as specified in clause 11.1.3 of TS 33.501 [29].\nDuring Secondary Re-authentication/Re-authorization, if the SMF receives from DN-AAA the DN authorized Session AMBR and/or DN Authorization Profile Index, the SMF shall report the received value(s) to the PCF.\nThe procedure for secondary authentication/authorization by a DN-AAA server during the establishment of a PDU Session is described in clause 4.3.2.3 of TS 23.502 [3].\nThe support for L2TP on N6 is further specified in clause 5.8.2.16, and the procedure for establishment of L2TP tunnelling on N6 for a PDU Session is described in clause 4.3.2.4 of TS 23.502 [3].\nNOTE 6:\tThe L2TP Tunnel information sent to the SMF can, for example, be provisioned in the DN-AAA server per DNN/S-NSSAI or per SUPI or GPSI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.7\tApplication Function influence on traffic routing",
                            "text_content": "The content of this clause applies to non-roaming and to LBO deployments i.e. to cases where the involved entities (AF, PCF, SMF, UPF) belong to the Serving PLMN or AF belongs to a third party with which the Serving PLMN has an SLA agreement.\nAF influence on traffic routing may apply in the case of Home Routed deployments with Session Breakout (HR SBO) as defined in TS 23.548 [130]. In that case when an AF belonging to the V-PLMN (or with an offloading SLA with the V PLMN) desires to provide Traffic Influence policies it may invoke at the V-NEF the API defined in this clause and provide the information listed in Table 5.6.7-1 below but the corresponding Traffic Influence information is provided directly from V-NEF to V-SMF bypassing the PCF. This is further defined in TS 23.548 [130] clause 6.7.2. and the rest of the clause 5.6.7.1 does not address how information related with AF influence on traffic routing may be provided to the SMF in the case of HR SBO.\nPCF shall not apply AF requests to influence traffic routing to PDU Sessions established in Home Routed mode.\nThe AF may determine the common EAS/DNAI for the UE set in order to indicate a common EAS or common local part of DN, and provide the common EAS/DNAI to the 5GS.\nAn AF may send requests to influence SMF routing decisions for traffic of PDU Session. The AF requests may influence UPF (re)selection and (I-)SMF (re)selection and allow routing user traffic to a local access to a Data Network (identified by a DNAI).\nThe AF may issue requests on behalf of applications not owned by the PLMN serving the UE.\nIf the operator does not allow an AF to access the network directly, the AF shall use the NEF to interact with the 5GC, as described in clause 6.2.10.\nThe AF may be in charge of the (re)selection or relocation of the applications within the local part of the DN (as defined in TS 23.548 [130]). Such functionality is not defined. For this purpose, the AF may request to get notified about events related with PDU Sessions.\nIn the case of AF instance change, the AF may send request of AF relocation information.\nThe AF requests are sent to the PCF via N5 (in the case of requests targeting specific on-going PDU Sessions of individual UE(s), for an AF allowed to interact directly with the 5GC NFs) or via the NEF. The AF requests that target existing or future PDU Sessions of multiple UE(s) or of any UE are sent via the NEF and may target multiple PCF(s), as described in clause 6.3.7.2. The PCF(s) transform(s) the AF requests into policies that apply to PDU Sessions. When the AF has subscribed to UP path management event notifications from SMF(s) (including notifications on how to reach a GPSI over N6), such notifications are sent either directly to the AF or via an NEF (without involving the PCF). For AF interacting with PCF directly or via NEF, the AF requests may contain the information as described in the Table 5.6.7-1:\nTable 5.6.7-1: Information element contained in AF request\n\nFor each information element mentioned above in the AF request, the detailed description is as follows:\n1)\tInformation to identify the traffic. The traffic can be identified in the AF request by\n-\tEither a DNN and possibly slicing information (S-NSSAI) or an AF-Service-Identifier\n-\tWhen the AF provides an AF-Service-Identifier i.e. an identifier of the service on behalf of which the AF is issuing the request, the 5G Core maps this identifier into a target DNN and slicing information (S-NSSAI)\n-\tWhen the NEF processes the AF request the AF-Service-Identifier may be used to authorize the AF request.\n-\tAn application identifier or traffic filtering information (e.g. IP 5 Tuple). The application identifier refers to an application handling UP traffic and is used by the UPF to detect the traffic of the application.\nWhen the AF request is for influencing SMF routing decisions, the information is to identify the traffic to be routed.\nWhen the AF request is for subscription to notifications about UP path management events, the information is to identify the traffic that the events relate to. The AF request may include a PLMN ID of the PLMN that the DNN and S-NSSAI belong to, as described in clause 4.3.6.1 of TS 23.502 [3].\n2)\tInformation about the N6 traffic routing requirements for traffic identified as defined in 1). This includes:\n-\tInformation about the N6 traffic routing requirements that is provided per DNAI: for each DNAI, the N6 traffic routing requirements may contain a routing profile ID and/or N6 traffic routing information.\n-\tAn optional indication of traffic correlation, when the information in 4) identifies a group of UEs. This implies the targeted PDU Sessions should be correlated by a common DNAI in the user plane for the traffic identified in 1). If this indication is provided by the AF, the 5GC should select a common DNAI for the target PDU Sessions from the list of DNAI(s) specified in 3).\nNOTE 1:\tThe N6 traffic routing requirements are related to the mechanism enabling traffic steering in the local access to the DN. The routing profile ID refers to a pre-agreed policy between the AF and the 5GC. This policy may refer to different steering policy ID(s) sent to SMF and e.g. based on time of the day etc.\nNOTE 2:\tThe mechanisms enabling traffic steering in the local access to the DN are not defined.\n3)\tPotential locations of applications towards which the traffic routing should apply. The potential location of application is expressed as a list of DNAI(s). If the AF interacts with the PCF via the NEF, the NEF may map the AF-Service-Identifier information to a list of DNAI(s). The DNAI(s) may be used for UPF (re)selection and (I-)SMF (re)selection. When only one DNAI is included, and the Indication of traffic correlation is available, the DNAI is used as common DNAI for UEs identified by AF request. The AF request may include a PLMN ID of the PLMN that the list of DNAI(s) belongs to, as described in clause 4.3.6.1 of TS 23.502 [3].\n4)\tInformation on the set of target UE(s). This may correspond to:\n-\tIndividual UEs (i.e. one or a list of UEs) identified using GPSI, or an IP address/Prefix or a MAC address.\n-\tGroup(s) of UEs identified by External Group Identifier(s) as defined in TS 23.682 [36] when the AF interacts via the NEF, or Internal-Group Identifier (see clause 5.9.7) when the AF interacts directly with the PCF.\n-\tAny UE accessing the combination of DNN, S-NSSAI and DNAI(s).\n-\tExternal Group ID(s) or any UE can both be complemented with External Subscriber Category(s) for a more granular selection of UEs. NEF may map this to Internal Group ID(s) or a combination of Internal Group ID(s) and Subscriber Category(s), defined in TS 23.503 [45].\nNOTE 3:\tOnly NEF is aware of the External Subscriber Category. As a user can be associated with multiple Subscriber Category(s), some values of Subscriber Category(s) can correspond to an SLA between an application provider represented by an AF and the 5GC operator. In the NEF API, the combination of application identifier and External Subscriber Category can also be used to refer to this SLA.\nWhen the PDU Session type is IPv4 or IPv6 or IPv4v6, and the AF provides an IP address and/or an IP Prefix, or when the PDU Session type is Ethernet and the AF provides a MAC address, this allows the PCF to identify the PDU Session for which this request applies and the AF request applies only to that specific PDU Session of the UE. In this case, additional information such as the UE identity may also be provided to help the PCF to identify the correct PDU Session.\nOtherwise, the request targets multiple UE(s) and shall apply to any existing or future PDU Sessions that match the parameters in the AF request.\nWhen the AF request targets an individual or a list of UE(s) and GPSI is provided within the AF request, the GPSI is mapped to SUPI according to the subscription information received from UDM.\nWhen the AF request targets any UE or a group of UE, the AF request is likely to influence multiple PDU Sessions possibly served by multiple SMFs and PCFs.\nWhen the AF request targets a group of UE it provides one or several group identifiers in its request. The group identifiers provided by the AF are mapped to Internal-Group identifiers. Members of the group have Group Identifier(s) in their subscription. The Internal-Group Identifier(s) is(are) stored in UDM, retrieved by SMF from UDM and passed by SMF to PCF at PDU Session set-up. The PCF can then map the AF request with user subscription and determine whether an AF request targeting a Group of users applies to a PDU Session. When External Subscriber Category(s) is provided, the NEF maps External Subscriber Category(s) into Subscriber Category(s), the PCF can map the AF request with user subscription and then creates PCC rules for UEs that have the Subscriber Category(s) in their subscription.\nWhen the AF request is for influencing SMF routing decisions, the information is to identify UE(s) whose traffic is to be routed.\nWhen the AF request is for subscription to notifications about UP path management events, the information is to identify UE(s) whose traffic the events relate to.\nWhen the AF request is for traffic forwarding in a PDU Session serving for TSC, the MAC address used by the PDU Session is determined by the AF to identify UE whose traffic is to be routed according to the previously stored binding relationship of the 5GS Bridge and the port number of the traffic forwarding information received from TSN network.\n5)\tIndication of application relocation possibility. This indicates whether an application can be relocated once a location of the application is selected by the 5GC. If application relocation is not possible, the 5GC shall ensure that for the traffic related with an application, no DNAI change takes place once selected for this application.\n6)\tTemporal validity condition. This is provided in the form of time interval(s) or duration(s) during which the AF request is to be applied.\nWhen the AF request is for influencing SMF routing decisions, the temporal validity condition indicates when the traffic routing is to apply.\nWhen the AF request is for subscription to notifications about UP path management events, the temporal validity condition indicates when the notifications are to be generated.\n7)\tSpatial validity condition on the UE(s) location. This is provided in the form of validity area(s). If the AF interacts with the PCF via the NEF, it may provide geographical area (e.g. a civic address or shapes) and the NEF maps the information to areas of validity based on pre-configuration. The PCF in turn determines area(s) of interest based on validity area(s).\nWhen the AF request is for influencing SMF routing decisions, the spatial validity condition indicates that the request applies only to the traffic of UE(s) located in the specified location.\nWhen the AF request is for subscription to notifications about UP path management events, the spatial validity condition indicates that the subscription applies only to the traffic of UE(s) located in the specified location.\n8)\tInformation on AF subscription to corresponding SMF events.\nThe AF may request to be subscribed to change of UP path associated with traffic identified in the bullet 1) above. The AF request contains:\n-\tA type of subscription (subscription for Early and/or Late notifications).\nThe AF subscription can be for Early notifications and/or Late notifications. In the case of a subscription for Early notifications, the SMF sends the notifications before the (new) UP path is configured. In the case of a subscription for Late notifications, the SMF sends the notification after the (new) UP path has been configured.\n-\tNotification target address for receiving event notification.\n-\tOptionally, an indication of \"AF acknowledgment to be expected\".\nThe indication implies that the AF will provide a response to the notifications of UP path management events to the 5GC. The SMF may, according to this indication, determine to wait for a response from the AF before the SMF configures in the case of early notification, or activates in the case of late notification, the new UP path as described in clause 5.6.7.2.\n-\tOptionally, an immediate reporting flag.\nThe immediate reporting flag is included when AF subscribe for candidate DNAI(s) of UE for common EAS/DNAI selection. With this flag, SMF should immediately response AF with the candidate DNAI(s) using Notification of user plane management event as described in clause 4.3.6.3 in TS 23.502 [3].\nThe AF subscription can also request to receive information associating the GPSI of the UE with the IP address(es) of the UE and/or with actual N6 traffic routing to be used to reach the UE on the PDU Session; in this case the corresponding information is sent by the SMF regardless of whether a DNAI applies to the PDU Session.\n9)\tAn AF transaction identifier referring to the AF request. This allows the AF to update or remove the AF request and to identify corresponding UP path management event notifications. The AF transaction identifier is generated by the AF.\nWhen the AF interacts with the PCF via the NEF, the NEF maps the AF transaction identifier to an AF transaction internal identifier, which is generated by the NEF and used within the 5GC to identify the information associated to the AF request. The NEF maintains the mapping between the AF transaction identifier and the AF transaction internal identifier. The relation between the two identifiers is implementation specific.\nWhen the AF interacts with the PCF directly, the AF transaction identifier provided by the AF is used as AF transaction internal identifier within the 5GC.\n10)\tIndication of UE IP address preservation. This indicates UE IP address related to the traffic identified in bullet 1) should be preserved. If this indication is provided by the AF, the 5GC should preserve the UE IP address by preventing reselection of PSA UPF for the identified traffic once the PSA UPF is selected.\n11)\tInformation for EAS IP Replacement in 5GC. This indicates the Source EAS identifier and Target EAS identifier (i.e. IP addresses and port numbers of the source and target EAS) for a service subject to Edge Computing.\n12)\tUser Plane Latency Requirement. This includes AF requirements for User Plane latency. (see clause 6.3.6 of TS 23.548 [130]).\n13)\tInformation on AF change. The AF relocation information includes:\n-\tAF Identifier: the identifier of the target AF instance.\nNOTE 4:\tThe AF relocation information is applicable for interaction with NEF only and it is not stored in UDR or transferred to PCF, even for the case AF directly interacts with PCF.\n14)\tIndication for EAS relocation. This indicates the application(s) are to be relocated.\n15)\tIndication for Simultaneous Connectivity over source and target PSA at Edge Relocation (see clause 6.3.4 of TS 23.548 [130]). Indicates that source and target PSA should coexist for some time at PSA relocation, and may influence the establishment of a temporary N9 forwarding tunnel between the source UL CL and target UL CL. It may also provide guidance for the time interval after the described traffic ceases when the connectivity over the source PSA may be removed.\n16)\tTraffic Correlation ID. Identification of a set of UEs subjecting to the AF request and accessing the application identified by the Traffic Description. UEs associated with the same Traffic Correlation ID and accessing the application identified by the Traffic Description should connect to a common EAS or EAS(es) corresponding to a common DNAI.\nThe following attributes may be provided with the Traffic Correlation ID:\n-\tEAS Correlation indication. Indicates selecting a common EAS for a set of UEs identified by Traffic Correlation ID and accessing the application identified by the Traffic Description.\n-\tCommon EAS IP address. IP address of the common EAS to be accessed by the UEs in the set of UEs subject to AF request, for the application identified by the Traffic Description.\nNOTE 5:\tIn the case of common EAS selection, if Traffic Correlation ID is provided, either EAS Correlation indication or Common EAS will be included in AF request.\n-\tFQDN(s). FQDN(s) corresponding to the application to be accessed by a set of UEs. When FQDN(s) is included, it is used for influencing EAS discovery procedure as defined in TS 23.548 [130].\n-\tIndication of traffic correlation as described in 2).\nAn AF may send requests to influence SMF routing decisions, for event subscription or for both.\nThe AF may request to be subscribed to notifications about UP path management events, i.e. a UP path change occurs for the PDU Session. The corresponding notification about a UP path change sent by the SMF to the AF may indicate the DNAI and /or the N6 traffic routing information and/or common EAS that has changed as described in clause 4.3.6.3 of TS 23.502 [3]. It may include the AF transaction internal identifier, the type of notification (i.e. early notification or late notification), the Identity of the source and/or target DNAI, the IP address/prefix of the UE or the MAC address used by the UE, the GPSI and the N6 traffic routing information related to the 5GC UP. The AF may subscribe for notifications of candidate DNAI(s) for UE if AF selection of common EAS/DNAI for a set of UEs is used.\nNOTE 6:\tThe change from the UP path status where no DNAI applies to a status where a DNAI applies indicates the activation of this AF request; the change from the UP path status where a DNAI applies to a status where no DNAI applies indicates the de-activation of this AF request.\nIn the case of IP PDU Session Type, the IP address/prefix of the UE together with N6 traffic routing information indicates to the AF how to reach over the User Plane the UE identified by its GPSI. N6 traffic routing information indicates any tunnelling that may be used over N6. The nature of this information depends on the deployment.\nNOTE 7:\tN6 traffic routing information can e.g. correspond to the identifier of a VPN or to explicit tunnelling information such as a tunnelling protocol identifier together with a Tunnel identifier.\nNOTE 8:\tIn the case of Unstructured PDU Session type the nature of the N6 traffic routing information related to the 5GC UP is described in clause 5.6.10.3.\nIn the case of Ethernet PDU Session Type, the MAC address of the UE together with N6 traffic routing information indicates to the AF how to reach over the User Plane the UE identified by its GPSI. The UE MAC address (es) is reported by the UPF as described in clause 5.8.2.12. The N6 traffic routing information can be, e.g. a VLAN ID or the identifier of a VPN or a tunnel identifier at the UPF.\nWhen notifications about UP path management events are sent to the AF via the NEF, if required, the NEF maps the UE identify information, e.g. SUPI, to the GPSI and the AF transaction internal identifier to the AF transaction identifier before sending the notifications to the AF.\nThe PCF, based on information received from the AF, operator's policy, optionally service experience analytics per UP path received from NWDAF, etc. authorizes the request received from the AF and determines for each DNAI, a traffic steering policy ID (derived from the routing profile ID provided by the AF) and/or the N6 traffic routing information (as provided by the AF) to be sent to the SMF as part of the PCC rules. The traffic steering policy IDs are configured in the SMF or in the UPF. The traffic steering policy IDs are related to the mechanism enabling traffic steering to the DN.\nThe DNAIs are related to the information considered by the SMF for UPF selection and (I-)SMF (re)selection, e.g. for diverting (locally) some traffic matching traffic filters provided by the PCF.\nThe PCF acknowledges a request targeting an individual PDU Session to the AF or to the NEF.\nFor PDU Session that corresponds to the AF request, the PCF provides the SMF with a PCC rule that is generated based on the AF request, Local routing indication from the PDU Session policy control subscription information and taking into account UE location presence in area of interest (i.e. Presence Reporting Area). The PCC rule contains the information to identify the traffic, information about the DNAI(s) towards which the traffic routing should apply and optionally, an indication of traffic correlation and/or an indication of application relocation possibility and/or indication of UE IP address preservation. The PCC rule also contains per DNAI a traffic steering policy ID and/or N6 traffic routing information, if the N6 traffic routing information is explicitly provided in the AF request.\nIf Traffic Correlation ID is included in the AF request, with EAS Correlation Indication or Common EAS, and FQDN(s) parameters, the Traffic Correlation ID and the EAS Correlation Indication or Common EAS, and FQDN(s) will be included in the PCC rule sent to SMF. The SMF can use the Traffic Correlation ID to determine that the UE belongs to a set of UEs identified by Traffic Correlation ID and a common EAS should be selected for the set of UE for the traffic identified by Traffic Descriptor as described in clause 6.2.3.2.5 of TS 23.548 [130].\nIf Traffic Correlation ID is included in the AF request, NEF updates the AF influence data in the UDR with the NEF Notification Endpoint to indicate it as responsible of the set of UEs associated with the Traffic correlation ID and to be notified with 5GC determined information as described in clause 6.2.3.2.7 of TS 23.548 [130].\nThe PCF provides in the PCC rule with information including the NEF Notification Endpoint for the SMF to notify to the NEF with 5GC determined information related to the UE members of the set of UEs identified by traffic correlation ID.\nIf Traffic Correlation ID, and traffic correlation indication and FQDN(s) is included in the AF request, the Traffic Correlation ID and the traffic correlation indication will be included in the PCC rule sent to SMF. The SMF can use the Traffic Correlation ID to determine that the UE belongs to a set of UEs identified by Traffic Correlation ID and the UE needs to connect to EAS(s) corresponding to a common DNAI selected for the set of UE for the traffic identified by Traffic Descriptor, as described in clause 6.2.3.2.6 of TS 23.548 [130].\nThe PCF may also provide in the PCC rule information to subscribe the AF (or the NEF) to SMF events (UP path changes) corresponding to the AF request in which case it provides the information on AF subscription to corresponding SMF events received in the AF request. This is done by providing policies at PDU Session set-up or by initiating a PDU Session Modification procedure. When initiating a PDU Session set-up or PDU Session Modification procedure, the PCF considers the latest known UE location to determine the PCC rules provided to the SMF. The PCF evaluates the temporal validity condition of the AF request and informs the SMF to activate or deactivate the corresponding PCC rules according to the evaluation result. When policies specific to the PDU Session and policies general to multiple PDU Sessions exist, the PCF gives precedence to the PDU Session specific policies over the general policies. The PCF authorizes the AF request of User Plane Latency Requirements. If the PCF determines that the requirements can't be authorized, the PCF rejects the AF request.\nThe spatial validity condition is resolved at the PCF. In order to do that, the PCF subscribes to the SMF to receive notifications about change of UE location in an area of interest (i.e. Presence Reporting Area). The subscribed area of interest may be the same as spatial validity condition, or may be a subset of the spatial validity condition (e.g. a list of TAs) based on the latest known UE location. When the SMF detects that UE entered the area of interest subscribed by the PCF, the SMF notifies the PCF and the PCF provides to the SMF the PCC rules described above by triggering a PDU Session Modification. When the SMF becomes aware that the UE left the area subscribed by the PCF, the SMF notifies the PCF and the PCF provides updated PCC rules by triggering a PDU Session Modification. SMF notifications to the PCF about UE location in or out of the subscribed area of interest are triggered by UE location change notifications received from the AMF or by UE location information received during a Service Request or Handover procedure.\nWhen the PCC rules are activated, the SMF may, based on local policies, take the information in the PCC rules and, optionally, the Service Experience analytics and/or DN Performance analytics per UP path (including UPF and/or DNAI and/or AS instance) as defined in clause 6.4.3 and clause 6.14.3, respectively, of TS 23.288 [86] into account to:\n-\t(re)select UP paths (including DNAI(s)) for PDU Sessions. The SMF is responsible for handling the mapping between the UE location (TAI / Cell-Id) and DNAI(s) associated with UPF and applications and the selection of the UPF(s) that serve a PDU Session. This is described in clause 6.3.3. If the PDU Session is of IP type and if Indication of UE IP address preservation is included in the PCC rules, the SMF should preserve the UE IP address, by not reselecting the related PSA UPF once the PSA UPF is selected, for the traffic identified in the PCC rule. If the user plane latency requirement is included in the PCC rules, the SMF chooses the PSA UPF that satisfies the user plane latency requirement. If the PCC rules are related to a 5G VN group served by the SMF and if the PCC rule includes an indication of traffic correlation, the SMF should select a common DNAI for the PDU Sessions of the 5G VN group, see clause 5.29.\n-\tconfigure traffic steering at UPF, including activating mechanisms for traffic multi-homing or enforcement of an UL Classifier (UL CL). Such mechanisms are defined in clause 5.6.4. This may include that the SMF is providing the UPF with packet handling instructions (i.e. PDRs and FARs) for steering traffic to the local access to the DN. The packet handling instructions are generated by the SMF using the traffic steering policy ID and/or the N6 traffic routing information in the PCC rules corresponding to the applied DNAI. In the case of UP path reselection, the SMF may configure the source UPF to forward traffic to the UL CL/BP so that the traffic is steered towards the target UPF.\n-\tif Information on AF subscription to corresponding SMF events has been provided in the PCC rule, inform the AF of the (re)selection of the UP path (UP path change). If the information includes an indication of \"AF acknowledgment to be expected\", the SMF may decide to wait for a response from the AF before it activates the new UP path, as described in clause 5.6.7.2.\nWhen an I-SMF is inserted for a PDU Session, the I-SMF insertion, relocation or removal to a PDU session shall be transparent (i.e. not aware) to the PCF and to the AF. The processing of the AF influence on traffic routing is described in clause 5.34 and detailed procedure is described in clause 4.23.6 of TS 23.502 [3].\nIn order to avoid or minimize service interruption during PSA relocation for a PDU session of SSC mode 3, or a PDU session with UL CL or branch point, according to the indication of \"AF acknowledgment to be expected\" on AF subscription to corresponding SMF events (DNAI change) (that may be provided in PCC rules received from the PCF as defined in clause 5.6.7.1 except in HR-SBO case or that may be provided directly by V-NEF to V-SMF as defined in TS 23.548 [130] clause 6.7.2 in case of HR-SBO) or according to local configuration (e.g. DN-related policies) the SMF may wait for a response from the AF after sending a notification (an early notification or a late notification) to the AF. In the case of late notification, based on the indication of \"AF acknowledgment to be expected\" on AF subscription, the SMF may send the notification before activating the UP path towards a new DNAI (possibly through a new PSA).\nNOTE 1:\tBefore the UP path toward the new DNAI is activated, application traffic data (if any exists) is still routed toward the old DNAI.\nThe notification sent from the SMF to the AF indicates UP path management events (DNAI change) as described in clause 5.6.7.1. The AF can confirm the DNAI change indicated in the notification with the SMF by sending a positive response to the notification to the SMF or reject the DNAI change by sending a negative response.\nNOTE 2:\tThe AF can determine whether application relocation is needed according to the notification of DNAI change. If not, the AF can send a positive response to the SMF immediately; otherwise, the AF sends the positive response after application relocation is completed or a negative response if the AF determines that the application relocation cannot be completed on time (e.g. due to temporary congestion). The AF decision and behaviours on application relocation are not defined. However, the new DNAI may be associated with a new AF. In such cases, the SMF and the old AF cancel earlier subscribed UP path management event notifications, and the new AF subscribes to receive UP path management event notifications from the SMF.\nThe AF can include N6 traffic routing information related to the target DNAI in a positive response sent to the SMF. The SMF configures the N6 traffic routing information from the AF response to the PSA on the UP path.\nThe AF can include the EAS relocation Indication to indicate the application(s) to be relocated.\nIn the case of early notification, based on the indication of \"AF acknowledgment to be expected\" on AF subscription, the SMF does not configure the UP path towards the new DNAI until it receives a positive AF response as specified in clause 4.3.6.3 of TS 23.502 [3].\nIn the case of late notification, based on the indication of \"AF acknowledgment to be expected\" on AF subscription, the SMF does not activate the UP path towards the new DNAI until it receives a positive AF response as specified in clause 4.3.5 of TS 23.502 [3].\nNOTE 3:\tAfter the UP path toward the new DNAI is activated, data is routed toward the new DNAI.\nIf the SMF receives a negative response at any time, the SMF keeps using the original DNAI and may cancel related PSA relocation or addition. The SMF may perform DNAI reselection afterwards if needed.\nThe SMF can assume according to local policy a negative response if a response is expected and but not received from the AF within a certain time window.\nWhen Early/Late Notification happens, the SMF notifies AF about the target DNAI and may indicate capability of supporting EAS IP replacement in 5GC.When EAS relocation is performed, the AF sends an/a early/late notification response to the SMF after the EAS relocation is completed, which may include the Information for EAS IP Replacement in 5GC. The SMF may instruct the local PSA with the EAS IP address replacement using \"Outer Header Creation\" as defined in clause 5.8.5.6 and \"Outer Header Removal\" as defined in clause 5.8.5.3. If local PSA relocation is required, the SMF may request the target local PSA to buffer uplink traffic as described in clause 6.3.5 of TS 23.548 [130].\nAF relocation may be triggered by SMF e.g. in relationship with DNAI change due to UE mobility. In the case of AF relocation involving different DNAI(s), it is possible that the source EHE is unaware of other/target EHE specific deployment details. In such cases, when SMF selects a target DNAI (e.g. based on current UE location), the SMF may determine based on the EDI that the target DNAI is not supported by the source AF. The SMF determines the target AF ID based on the target DNAI and the EDI. Accordingly, as part of Early/Late Notification, the SMF provides the target AF ID to the source AF as described in clause 4.3.6.3 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.6.7-1: Information element contained in AF request",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.6.8\tSelective activation and deactivation of UP connection of existing PDU Session",
                            "text_content": "This clause applies to the case when a UE has established multiple PDU Sessions. The activation of a UP connection of an existing PDU Session causes the activation of its UE-CN User Plane connection (i.e. data radio bearer and N3 tunnel).\nFor the activation of a UP connection the service area restrictions as specified in clause 5.3.4.1.1 apply.\nFor the UE in the CM-IDLE state in 3GPP access, either UE or Network-Triggered Service Request procedure may support independent activation of UP connection of existing PDU Session. For the UE in the CM-IDLE state in non-3GPP access, UE-Triggered Service Request procedure allows the re-activation of UP connection of existing PDU Sessions, and may support independent activation of UP connection of existing PDU Session.\nA UE in the CM-CONNECTED state invokes a Service Request (see clause 4.2.3.2 of TS 23.502 [3]) procedure to request the independent activation of the UP connection of existing PDU Sessions.\nNetwork Triggered re-activation of UP connection of existing PDU Sessions is handled as follows:\n-\tIf the UE CM state in the AMF is already CM-CONNECTED on the access (3GPP, non-3GPP) associated to the PDU Session in the SMF, the network may re-activate the UP connection of a PDU Session using a Network Initiated Service Request procedure.\nOtherwise:\n-\tIf the UE is registered in both 3GPP and non-3GPP accesses and the UE CM state in the AMF is CM-IDLE in non-3GPP access, the UE can be paged or notified through the 3GPP access for a PDU Session associated in the SMF (i.e. last routed) to the non-3GPP access:\n-\tIf the UE CM state in the AMF is CM-IDLE in 3GPP access, the paging message may include the access type associated with the PDU Session in the SMF. The UE, upon reception of the paging message containing an access type, shall reply to the 5GC via the 3GPP access using the NAS Service Request message, which shall contain the list of PDU Sessions associated with the received access type and whose UP connections can be re-activated over 3GPP (i.e. the list does not contain the PDU Sessions whose UP connections cannot be re-activated on 3GPP based on UE policies and whether the S-NSSAIs of these PDU Sessions are within the Allowed NSSAI for 3GPP access). If the PDU Session for which the UE has been paged is in the list of the PDU Sessions provided in the NAS Service Request and the paging was triggered by pending DL data, the 5GC shall re-activate the PDU Session UP connection over 3GPP access. If the paging was triggered by pending DL signalling, the Service Request succeeds without re-activating the PDU session UP connection over the 3GPP access and the pending DL signalling is delivered to the UE over the 3GPP access;\n-\tIf the UE CM state in the AMF is CM-CONNECTED in 3GPP access, the notification message shall include the non-3GPP Access Type. The UE, upon reception of the notification message, shall reply to the 5GC via the 3GPP access using the NAS Service Request message, which shall contain the List of Allowed PDU Sessions that can be re-activated over 3GPP or an empty List of Allowed PDU Sessions if no PDU Sessions are allowed to be re-activated over 3GPP access.\nNOTE:\tA UE that is in a coverage of a non-3GPP access and has PDU Session(s) that are associated in the UE (i.e. last routed) to non-3GPP access, is assumed to attempt to connect to it without the need to be paged.\n-\tIf the UE is registered in both 3GPP and non-3GPP accesses served by the same AMF and the UE CM state in the AMF is CM-IDLE in 3GPP access and is in CM-CONNECTED in non 3GPP access, the UE can be notified through the non-3GPP for a PDU Session associated in the SMF (i.e. last routed) to the 3GPP access. The notification message shall include the 3GPP Access Type. Upon reception of the notification message, when 3GPP access is available, the UE shall reply to the 5GC via the 3GPP access using the NAS Service Request message.\nIn addition to the above, a PDU Session may be established as an always-on PDU Session as described in clause 5.6.13.\nThe deactivation of the UP connection of an existing PDU Session causes the corresponding data radio bearer and N3 tunnel to be deactivated. The UP connection of different PDU Sessions can be deactivated independently when a UE is in CM-CONNECTED state in 3GPP access or non-3GPP access. At the deactivation of the UP of a PDU Session using a N9 tunnel whose end-point is controlled by an I-SMF, the N9 tunnel is preserved. If a PDU Session is an always-on PDU Session, the SMF should not deactivate a UP connection of this PDU Session due to inactivity.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.9\tSession and Service Continuity",
                            "text_content": "The support for session and service continuity in 5G System architecture enables to address the various continuity requirements of different applications/services for the UE. The 5G System supports different session and service continuity (SSC) modes defined in this clause. The SSC mode associated with a PDU Session does not change during the lifetime of a PDU Session. The following three modes are specified with further details provided in the next clause:\n-\tWith SSC mode 1, the network preserves the connectivity service provided to the UE. For the case of PDU Session of IPv4 or IPv6 or IPv4v6 type, the IP address is preserved.\n-\tWith SSC mode 2, the network may release the connectivity service delivered to the UE and release the corresponding PDU Session(s). For the case of IPv4 or IPv6 or IPv4v6 type, the release of the PDU Session induces the release of IP address(es) that had been allocated to the UE.\n-\tWith SSC mode 3, changes to the user plane can be visible to the UE, while the network ensures that the UE suffers no loss of connectivity. A connection through new PDU Session Anchor point is established before the previous connection is terminated in order to allow for better service continuity. For the case of IPv4 or IPv6 or IPv4v6 type, the IP address is not preserved in this mode when the PDU Session Anchor changes.\nNOTE:\tIn this Release of the specification, the addition/removal procedure of additional PDU Session Anchor in a PDU Session for local access to a DN is independent from the SSC mode of the PDU Session.\nFor a PDU Session of SSC mode 1, the UPF acting as PDU Session Anchor at the establishment of the PDU Session is maintained regardless of the access technology (e.g. Access Type and cells) a UE is successively using to access the network.\nIn the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, IP continuity is supported regardless of UE mobility events.\nIn this Release of the specification, when IPv6 multihoming or UL CL applies to a PDU Session of in SSC mode 1, and the network allocates (based on local policies) additional PDU Session Anchors to such a PDU Session, these additional PDU Session Anchors may be released or allocated, and the UE does not expect that the additional IPv6 prefix is maintained during the lifetime of PDU Session.\nSSC mode 1 may apply to any PDU Session type and to any access type.\nA UE supporting PDU Connectivity shall support SSC mode 1.\nIf a PDU Session of SSC mode 2 has a single PDU Session Anchor, the network may trigger the release of the PDU Session and instruct the UE to establish a new PDU Session to the same data network immediately. The trigger condition depends on operator policy e.g. request from Application Function, based on load status, etc. At establishment of the new PDU Session, a new UPF acting as PDU Session Anchor can be selected.\nOtherwise, if a PDU Session of SSC mode 2 has multiple PDU Session Anchors (i.e. in the case of multi-homed PDU Sessions or in the case that UL CL applies to a PDU Session of SSC mode 2), the additional PDU Session Anchors may be released or allocated.\nSSC mode 2 may apply to any PDU Session type and to any access type.\nSSC mode 2 is optional to be supported in the UE.\nNOTE 1:\tFeatures depending on SSC mode 2 will not work with the lack of support for SSC mode 2 in the UE.\nNOTE 2:\tIn UL CL mode, the UE is not involved in PDU Session Anchor re-allocation, so that the existence of multiple PDU Session Anchors is not visible to the UE.\nFor PDU Session of SSC mode 3, the network allows the establishment of UE connectivity via a new PDU Session Anchor to the same data network before connectivity between the UE and the previous PDU Session Anchor is released. When trigger conditions apply, the network decides whether to select a PDU Session Anchor UPF suitable for the UE's new conditions (e.g. point of attachment to the network).\nIn this Release of specification, SSC mode 3 only applies to IP PDU Session type and to any access type.\nIn the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, during the procedure of change of PDU Session Anchor, the following applies:\na.\tFor a PDU Session of IPv6 type, the new IP prefix anchored on the new PDU Session Anchor may be allocated within the same PDU Session (relying on IPv6 multi-homing specified in clause 5.6.4.3), or\nb.\tThe new IP address and/or IP prefix may be allocated within a new PDU Session that the UE is triggered to establish.\nAfter the new IP address/prefix has been allocated, the old IP address/prefix is maintained during some time indicated to the UE via NAS signalling (as described in clause 4.3.5.2 of TS 23.502 [3]) or via Router Advertisement (as described in clause 4.3.5.3 of TS 23.502 [3]) and then released.\nIf a PDU Session of SSC mode 3 has multiple PDU Session Anchors (i.e. in the case of multi-homed PDU Sessions or in the case that UL CL applies to a PDU Session of SSC mode 3), the additional PDU Session Anchors may be released or allocated.\nSSC mode 3 is optional to be supported in the UE.\nNOTE:\tFeatures depending on SSC mode 3 will not work with the lack of support for SSC mode 3 in the UE.\nSSC mode selection is done by the SMF based on the allowed SSC modes -including the default SSC mode) in the user subscription as well as the PDU Session type and if present, the SSC mode requested by the UE.\nThe operator may provision a SSC mode selection policy (SSCMSP) to the UE as part of the URSP rule -see clause 6.6.2 of TS 23.503 [45]). The UE shall use the SSCMSP to determine the type of session and service continuity mode associated with an application or group of applications for the UE as described in clause 6.6.2.3 of TS 23.503 [45]. If the UE does not have SSCMSP, the UE can select a SSC mode based on UE Local Configuration as described in TS 23.503 [45], if applicable. If the UE cannot select a SSC mode, the UE requests the PDU Session without providing the SSC mode.\nNOTE 1:\tThe UE can use the SSC Mode Selection component of the URSP rule with match-all traffic descriptor if there is no SSC mode in the UE local configuration.\nThe SSC mode selection policy rules provided to the UE can be updated by the operator by updating the URSP rule.\nThe SMF receives from the UDM the list of allowed SSC modes and the default SSC mode per DNN per S-NSSAI as part of the subscription information.\nIf a UE provides an SSC mode when requesting a new PDU Session, the SMF selects the SSC mode by either accepting the requested SSC mode or rejecting the PDU Session Establishment Request message with the cause value and the SSC mode(s) allowed to be used back to UE based on the PDU Session type, subscription and/or local configuration. Based on that cause value and the SSC mode(s) allowed to be used, the UE may re-attempt to request the establishment of that PDU Session with the SSC mode allowed to be used or using another URSP rule.\nIf a UE does not provide an SSC mode when requesting a new PDU Session, then the SMF selects the default SSC mode for the data network listed in the subscription or applies local configuration to select the SSC mode.\nSSC mode 1 shall be assigned to the PDU Session when static IP address/prefix is allocated to the PDU Session based on the static IP address/prefix subscription for the DNN and S-NSSAI. The SMF shall inform the UE of the selected SSC mode for a PDU Session.\nThe UE shall not request and the network shall not assign SSC mode 3 for the PDU Session of Unstructured type or Ethernet type.\nNOTE 2:\tTo avoid issues for UEs not supporting all SSC modes, the operator can, in the subscription data and local configuration, include at least SSC mode 1 in the allowed SSC modes, and set default SSC mode to 1 (since all UEs supporting PDU sessions are mandated to support SSC mode 1). Still the 5GC can trigger PDU session release with a cause code indicating reactivation due to, e.g. restoration or user plane path optimization purposes, though this may cause interruption of the service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.10\tSpecific aspects of different PDU Session types",
                            "text_content": "The IP address allocation is defined in clause 5.8.1\nThe UE may acquire following configuration information from the SMF, during the lifetime of a PDU Session:\n-\tAddress(es) of P-CSCF(s);\n-\tAddress(es) of DNS server(s).\n-\tIf the UE indicates support of DNS with security as defined in TS 33.501 [29] to the network in PCO and the network wants to enforce the use of DNS with security, the configuration information sent by the SMF via PCO may also include the corresponding DNS server security information as specified in TS 24.501 [47] and TS 33.501 [29].\n-\tthe GPSI of the UE.\nThe UE may acquire from the SMF, at PDU Session Establishment, the MTU that the UE shall consider, see clause 5.6.10.4.\nThe UE may provide following information to the SMF during the lifetime of a PDU Session:\n-\tan indication of the support of P-CSCF re-selection based on procedures specified in TS 24.229 [62] (clauses B.2.2.1C and L.2.2.1C).\n-\tPS data off status of the UE.\nNOTE 2:\tAn operator can deploy NAT functionality in the network; the support of NAT is not specified in this release of the specification, though UPF can expose mapping between public and private IP addresses.\nFor a PDU Session set up with the Ethernet PDU Session type, the SMF and the UPF acting as PDU Session Anchor (PSA) can support specific behaviours related with the fact the PDU Session carries Ethernet frames.\nDepending on operator configuration related with the DNN, different configurations for how Ethernet traffic is handled on N6 may apply, for example:\n-\tConfigurations with a 1-1 relationship between a PDU Session and a N6 interface possibly corresponding to a dedicated tunnel established over N6. In this case the UPF acting as PSA transparently forwards Ethernet frames between the PDU Session and its corresponding N6 interface, and it does not need to be aware of MAC addresses used by the UE in order to route down-link traffic.\n-\tConfigurations, where more than one PDU Session to the same DNN (e.g. for more than one UE) corresponds to the same N6 interface. In this case the UPF acting as PSA needs to be aware of MAC addresses used by the UE in the PDU Session in order to map down-link Ethernet frames received over N6 to the appropriate PDU Session. Forwarding behaviour of the UPF acting as PSA is managed by SMF as specified in clause 5.8.2.5.\nNOTE 1:\tThe \"MAC addresses used by the UE\" correspond to any MAC address used by the UE or any device locally connected to the UE and using the PDU Session to communicate with the DN.\nBased on operator configuration, the SMF may request the UPF acting as the PDU Session Anchor to respond to ARP/IPv6 Neighbour Solicitation requests based on local cache information, i.e. the mapping between the UE MAC address to the UE IP address, and the DN where the PDU Session is connected to, or to redirect the ARP traffic from the UPF to the SMF. Responding to ARP/IPv6 ND based on local cache information applies to ARP/IPv6 ND received in both UL and DL directions.\nNOTE 2:\tResponding to ARP/ND from a local cache assumes the UE or the devices behind the UE acquire their IP address via in-band mechanisms that the SMF/UPF can detect and by this link the IP address to the MAC address.\nNOTE 3:\tThis mechanism is intended to avoid broadcasting or multicasting the ARP/IPv6 ND to every UE.\nEthernet Preamble and Start of Frame delimiter are not sent over 5GS:\n-\tFor UL traffic the UE strips the preamble and frame check sequence (FCS) from the Ethernet frame.\n-\tFor DL traffic the PDU Session Anchor strips the preamble and frame check sequence (FCS) from the Ethernet frame.\nNeither a MAC nor an IP address is allocated by the 5GC to the UE for a PDU Session.\nThe PSA shall store the MAC addresses received from the UE, and associate those with the appropriate PDU Session.\nThe SMF may receive a list of allowed VLAN tags from DN-AAA (for a maximum of 16 VLAN tags) or may be locally configured with allowed VLAN tags values. The SMF may also be configured with instructions on VLAN handling (e.g. the VLAN tag to be inserted or removed, S-TAG to be inserted or removed). Taking this into account, the SMF determines the VLAN handling for the PDU Session, and instructs the UPF to accept or discard the UE traffic based on the allowed VLAN tags, as well as to handle VLAN tags (addition/removal) via PDR (Outer header removal) and FAR (UPF applying Outer header creation of a Forwarding policy). For example:\n-\tThe UPF may insert (for uplink traffic) and remove (for downlink traffic) a S-TAG on N6 or N19 or internal interface (\"5G VN internal\") for the traffic from and to the UE.\n-\tThe UPF may insert (for uplink traffic) and remove (for downlink traffic) a VLAN tag on the N6 interface while there is no VLAN in the traffic to and from the UE.\n-\tThe UPF may discard any UE traffic that does not contain any allowed VLAN tag when the UPF handles the UE uplink or downlink traffic.\nNOTE 4:\tThis can be used for traffic steering to N6-LAN but also for N6-based traffic forwarding related with 5G-VN service described in clause 5.29.4\nApart from specific conditions related to the support of PDU sessions over W-5GAN defined in TS 23.316 [84], the UPF shall not remove VLAN tags sent by the UE and the UPF shall not insert VLAN tags for the traffic sent to the UE.\nPDU(s) containing a VLAN tag shall be switched only within the same VLAN by a PDU Session Anchor.\nThe UE may acquire from the SMF, at PDU Session Establishment, the MTU of the Ethernet frames' payload that the UE shall consider, see clause 5.6.10.4.\nNOTE 5:\tThe UE may operate in bridge mode with regard to a LAN it is connecting to the 5GS, thus different MAC addresses may be used as source address of different frames sent UL over a single PDU Session (and destination MAC address of different frames sent DL over the same PDU Session).\nNOTE 6:\tEntities on the LAN connected to the 5GS by the UE may have an IP address allocated by the DN but the IP layer is considered as an application layer which is not part of the Ethernet PDU Session.\nNOTE 7:\tIn this Release of the specification, only the UE connected to the 5GS is authenticated, not the devices behind such UE.\nNOTE 8:\t5GS does not support the scenario where a MAC address or if VLAN applies a (MAC address, VLAN) combination is used on more than one PDU Session for the same DNN and S-NSSAI.\nNOTE 9:\tThis Release of the specification does not guarantee that the Ethernet network remains loop-free. Deployments need to be verified on an individual basis that loops in the Ethernet network are avoided.\nNOTE 10:\tThis Release of the specification does not guarantee that the Ethernet network properly and quickly reacts to topology changes. Deployments need to be verified on an individual basis how they react to topology changes.\nDifferent Frames exchanged on a PDU Session of Ethernet type may be served with different QoS over the 5GS. Thus, the SMF may provide to the UPF Ethernet Packet Filter Set and forwarding rule(s) based on the Ethernet frame structure and UE MAC address(es). The UPF detects and forwards Ethernet frames based on the Ethernet Packet Filter Set and forwarding rule(s) received from the SMF. This is further defined in clauses 5.7 and 5.8.2.\nWhen a PDU Session of Ethernet PDU type is authorized by a DN as described in clause 5.6.6, the DN-AAA server may, as part of authorization data, provide the SMF with a list of allowed MAC addresses for this PDU Session; the list is limited to a maximum of 16 MAC addresses. When the list has been provided for a PDU Session, the SMF sets corresponding filtering rules in the UPF(s) acting as PDU Session Anchor for the PDU Session. The UPF discards any UL traffic that does not contain one of these MAC addresses as a source address if the list of allowed MAC addresses is provided.\nIn this Release of specification, the PDU Session of Ethernet PDU Session type is restricted to SSC mode 1 and SSC mode 2.\nFor a PDU Session established with the Ethernet PDU Session type, the SMF may, upon PCF request, need to ensure reporting to the PCF of all Ethernet MAC addresses used as UE address in a PDU Session. In this case, as defined in clause 5.8.2.12, the SMF controls the UPF to report the different MAC addresses used as source address of frames sent UL by the UE in the PDU Session.\nNOTE 11:\tThis relates to whether AF control on a per MAC address is allowed on the PDU Session as defined in clause 6.1.1.2 of TS 23.503 [45].\nThe PCF may activate or deactivate the reporting of the UE MAC address using the \"UE MAC address change\" Policy Control Request Trigger as defined in Table 6.1.3.5-1 of TS 23.503 [45].\nThe SMF may relocate the UPF acting as the PDU Session Anchor for an Ethernet PDU Session as defined in clause 4.3.5.8 of TS 23.502 [3]. The relocation may be triggered by a mobility event such as a handover, or may be triggered independent of UE mobility, e.g. due to load balancing reasons. In order to relocate the PSA UPF, the reporting of the UE MAC addresses needs to be activated by the SMF.\nDifferent Point-to-Point (PtP) tunnelling techniques may be used to deliver Unstructured PDU Session type data to the destination (e.g. application server) in the Data Network via N6.\nPoint-to-point tunnelling based on UDP/IP encapsulation as described below may be used. Other techniques may be supported. Regardless of addressing scheme used from the UPF to the DN, the UPF shall be able to map the address used between the UPF and the DN to the PDU Session.\nWhen Point-to-Point tunnelling based on UDP/IPv6 is used, the following considerations apply:\n-\tIPv6 prefix allocation for PDU Sessions are performed locally by the (H-)SMF without involving the UE.\n-\tThe UPF(s) acts as a transparent forwarding node for the payload between the UE and the destination in the DN.\n-\tFor uplink, the UPF forwards the received Unstructured PDU Session type data to the destination in the data network over the N6 PtP tunnel using UDP/IPv6 encapsulation.\n-\tFor downlink, the destination in the data network sends the Unstructured PDU Session type data using UDP/IPv6 encapsulation with the IPv6 address of the PDU Session and the 3GPP defined UDP port for Unstructured PDU Session type data. The UPF acting as PDU Session Anchor decapsulates the received data (i.e. removes the UDP/IPv6 headers) and forwards the data identified by the IPv6 prefix of the PDU Session for delivery to the UE.\n-\tThe (H-)SMF performs the IPv6 related operations but the IPv6 prefix is not provided to the UE, i.e. Router Advertisements and DHCPv6 are not performed. The SMF assigns an IPv6 Interface Identifier for the PDU Session. The allocated IPv6 prefix identifies the PDU Session of the UE.\n-\tFor AF influence on traffic routing (described in clause 5.6.7), when the N6 PtP tunnelling is used over the DNAI and the AF provides, by value, information about N6 traffic routing requirements in the AF request, the AF provides N6 PtP tunnelling requirements (IPv6 address and UDP port of the tunnel end in the DN) as the N6 traffic routing information associated to the DNAI; when the SMF notifies the AF of UP path management events, it includes the N6 PtP tunnel information related to the UP (the IPv6 address and the 3GPP defined UDP port of the tunnel end at the UPF) as N6 traffic routing information in the notification.\nIn this Release of the specification there is support for maximum one 5G QoS Flow per PDU Session of Type Unstructured.\nIn this Release of specification, the PDU Session of Unstructured PDU Session type is restricted to SSC mode 1 and SSC mode 2.\nThe UE may acquire from the SMF, at PDU Session Establishment, the MTU that the UE shall consider, see clause 5.6.10.4.\nIn order to avoid data packet fragmentation between the UE and the UPF acting as PSA, the link MTU size in the UE should be set to the value provided by the network as part of the IP configuration. The link MTU size for IPv4 is sent to the UE by including it in the PCO (see TS 24.501 [47]). The link MTU size for IPv6 is sent to the UE by including it in the IPv6 Router Advertisement message (see RFC 4861 [54]).\nNOTE 1:\tIdeally the network configuration ensures that for PDU Session type IPv4v6 the link MTU values provided to the UE via PCO and in the IPv6 Router Advertisement message are the same. In cases where this condition cannot be met, the MTU size selected by the UE is unspecified.\nWhen using a PDU Session type Unstructured, the maximum uplink packet size, and when using Ethernet, the Ethernet frames' payload, that the UE should use may be provided by the network as a part of the session management configuration by encoding it within the PCO (see TS 24.501 [47]).\nWhen using a PDU Session type Unstructured, to provide a consistent environment for application developers, the network shall use a maximum packet size of at least 128 octets (this applies to both uplink and downlink).\nWhen the MT and the TE are separated, the TE may either be pre-configured to use a specific default MTU size or the TE may use an MTU size provided by the network via the MT. Thus, it is not always possible to set the MTU value by means of information provided by the network.\nNOTE 2:\tIn network deployments that have MTU size of 1500 octets in the transport network, providing a link MTU value of 1358 octets (as shown in Figure J-1) to the UE as part of the IP configuration information from the network will prevent the IP layer fragmentation within the transport network between the UE and the UPF. For network deployments that uniformly support transport with larger MTU size than 1500 octets (for example with ethernet jumbo frames of MTU size up to 9216 octets), providing a link MTU value of MTU minus 142 octets to the UE as part of the IP configuration information from the network will prevent the IP layer fragmentation within the transport network between the UE and the UPF. Link MTU considerations are discussed further in Annex J.\nNOTE 3:\tAs the link MTU value is provided as a part of the session management configuration information, a link MTU value can be provided during each PDU Session establishment. In this release, dynamic adjustment of link MTU for scenarios where MTU is not uniform across transport are not addressed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.11\tUE presence in Area of Interest reporting usage by SMF",
                            "text_content": "When a PDU Session is established or modified, or when the user plane path has been changed (e.g. UPF re-allocation/addition/removal), SMF may determine an Area of Interest, e.g. based on UPF Service Area, subscription by PCF for reporting UE presence in Presence Reporting Area, etc.\nFor 3GPP access, the Area of Interest corresponds:\n-\teither to Presence Information that may correspond to:\n-\ta list of Tracking Areas; or\n-\ta list of Presence Reporting Area ID(s) and optionally the elements comprising TAs and/or NG-RAN nodes and/or cells identifiers corresponding to the PRA ID(s); or\n-\ta LADN DNN; or\n-\ta LADN DNN and a S-NSSAI; or\n-\ta S-NSSAI.\nFor Non-3GPP access, the Area of Interest corresponds to:\n-\tN3GPP TAI (see clause 5.3.2.3).\nFor UE location change into or out of an \"area of interest\", the SMF subscribes to \"UE mobility event notification\" service provided by AMF for reporting of UE presence in Area of Interest as described in clause 5.3.4.4. The AMF may send the UE location to the SMF along with the notification, e.g. for UPF selection. Upon reception of a notification from AMF, the SMF determines how to deal with the PDU Session, e.g. reallocate UPF.\nIn the case of LADN, the SMF provides the LADN DNN to the AMF to subscribe to \"UE mobility event notification\" for reporting UE presence in LADN service area. Upon reception of a notification from the AMF, the SMF determines how to deal with the PDU Session as described in clause 5.6.5.\nIn the case of Partial Network Slice Support and Support for Network Slices with Network Slice Area of Service not matching deployed Tracking Areas as described in clauses 5.15.17 and 5.15.18, the SMF provides the S-NSSAI to the AMF to \"UE mobility event notification\" for reporting UE presence in slice restriction area. Upon reception of a notification from the AMF, the SMF determines how to deal with the PDU Session as described in clauses 5.15.17 and 5.15.18.\nFor use cases related to policy control and charging decisions, the PCF may subscribe to event reporting from the SMF or the AMF, for UE presence in a Presence Reporting Area.\nA Presence Reporting Area can be:\n-\tA \"UE-dedicated Presence Reporting Area\", defined in the subscriber profile and composed of a short list of TAs and/or NG-RAN nodes and/or cells identifiers in a PLMN; or derived from the Area of Interest provided by the Application Function to the PCF (see clause 5.6.7) and composed of a short list of TAs and/or NG-RAN nodes and/or cells identifiers in a PLMN; or\n-\tA \"Core Network predefined Presence Reporting Area\", predefined in the AMF and composed of a short list of TAs and/or NG-RAN nodes and/or cells identifiers in a PLMN.\nIn the case of Change of UE Presence in Presence Reporting Area, for core network predefined Presence Reporting Area, the AMF determines the \"area of interest\" corresponding to the Presence Reporting Area Identifier(s), provided by the PCF or the SMF, as a list of TAIs and/or cell identifiers and/or NG-RAN node identifiers based on local configuration. For UE-dedicated Presence Reporting Areas, the subscription for UE location change notification for an \"area of interest\" shall contain the PRA Identifier(s) and the list(s) of TAs, or NG-RAN Node identifier and/or cell identifiers composing the Presence Reporting Area(s). For Core Network predefined Presence Reporting Areas, the subscription for UE location change notification for an \"area of interest\" shall contain the PRA identifier(s).\nNOTE 1:\tIf the Presence Reporting Area (PRA) and RAN Notification Area (RNA) are partially overlapping, the PCF will not get notified for the change of PRA when UE enters or leaves the PRA but remains in the RNA in CM-CONNECTED with RRC_INACTIVE state, because AMF is not informed.\nEach Core Network predefined Presence Reporting Area can be configured with a priority level in the AMF. In order to prevent overload, the AMF may set the reporting for one or more of the received Presence Reporting Area(s) to inactive under consideration of the priority configured for each of Core Network predefined Presence Reporting Area(s), while storing the reporting request for this Presence Reporting Area in the UE context.\nNOTE 2:\tChange of UE presence in Presence Reporting Area reporting does not apply to home routed roaming.\nThe AMF may be configured with a PRA identifier which refers to a Set of Core Network predefined Presence Reporting Areas. If the PCF subscribes to change of UE location for an area of interest for a Set of Presence reporting areas and provides a PRA identifier then the SMF may subscribe for event reporting for this Set of Presence Reporting Areas by only indicating this PRA Identifier in the area of interest. When the Presence Reporting Area(s) to be reported belong to a set of Core Network predefined Presence Reporting Areas in which the AMF is requested to report on change of UE presence, the AMF shall additionally add to the report the PRA Identifier of the Set of Core Network predefined Presence Reporting Areas.\nUpon change of AMF, the PRA identifier(s) and if provided, the list(s) of Presence Reporting Area elements are transferred for all PDU sessions as part of MM Context information to the target AMF during the mobility procedure. If one or more Presence Reporting Area(s) was set to inactive, the target AMF may decide to reactivate one or more of the inactive Presence Reporting Area(s). The target AMF indicates per PDU session to the corresponding SMF/PCF the PRA identifier(s) and whether the UE is inside or outside the Presence Reporting Area(s) as well as the inactive Presence Reporting Area(s), if any.\nNOTE 3:\tThe target AMF cannot set the Presence Reporting Area(s) received from the source serving node to inactive.\nThe subscription may be maintained during the life of PDU Session, regardless of the UP activation state of PDU Session (i.e. whether UP connection of the PDU Session is activated or not).\nSMF may determine a new area of interest, and send a new subscription to the AMF with the new area of interest.\nSMF un-subscribes to \"UE mobility event notification\" service when PDU Session is released.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.12\tUse of Network Instance",
                            "text_content": "The SMF may provide a Network Instance to the UPF in FAR and/or PDR via N4 Session Establishment or N4 Modification procedures.\nNOTE 1:\ta Network Instance can be defined e.g. to separate IP domains, e.g. when a UPF is connected to 5G-ANs in different IP domains, overlapping UE IP addresses assigned by multiple Data Networks, transport network isolation in the same PLMN, etc.\nNOTE 2:\tAs the SMF can provide over N2 the Network Instance it has selected for the N3 CN Tunnel Info, the 5G AN does not need to provide Network Instance to the 5GC.\nThe SMF determines the Network Instance based on local configuration.\nThe SMF may determine the Network Instance for N3 and N9 interfaces, taking into account e.g. UE location, registered PLMN ID of UE, S-NSSAI of the PDU Session.\nThe SMF may determine the Network Instance for N6 interface taking into account e.g. (DNN, S-NSSAI) of the PDU Session.\nThe SMF may determine the Network Instance for N19 interface taking into account e.g. the (DNN, S-NSSAI) identifying a 5G VN group.\nNOTE 3:\tAs an example, the UPF can use the Network Instance included in the FAR, together with other information such as Outer header creation (IP address part) and Destination interface in the FAR, to determine the interface in UPF (e.g. VPN or Layer 2 technology) for forwarding of the traffic.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.13\tAlways-on PDU session",
                            "text_content": "An always-on PDU Session is a PDU Session for which User Plane resources have to be activated during every transition from CM-IDLE mode to CM-CONNECTED state.\nBased on an indication from upper layers, a UE may request to establish a PDU Session as an always-on PDU Session. The SMF decides whether the PDU Session can be established as an always-on PDU Session. In Home Routed roaming case, based on local policies, the V-SMF shall be involved to determine whether the PDU Session can be established as an always-on PDU Session.\nIf the UE requests the 5GC to modify a PDU Session, which was established in EPS, to an always-on PDU Session after the first inter-system change from EPS to 5GS, the SMF decides whether the PDU Session can be established as an always-on PDU Session based on the procedure described above.\nThe UE shall request activation of User Plane resources for always-on PDU Sessions even if there are no pending uplink data for this PDU Session or when the Service Request is triggered for signalling only or when the Service Request is triggered for paging response only.\nIf the UE has one or more established PDU Sessions which are not accepted by the network as always-on PDU Sessions and the UE has no uplink user data pending to be sent for those PDU Sessions, the UE shall not request for activating User Plane resources for those PDU sessions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.14\tSupport of Framed Routing",
                            "text_content": "Framed Routing is only defined for PDU Sessions of the IP type (IPv4, IPv6, IPv4v6) and allows to support an IP network behind a UE, such that a range of IPv4 addresses or IPv6 prefixes is reachable over a single PDU Session, e.g. for enterprise connectivity. Framed Routes are IP routes behind the UE.\nA PDU Session may be associated with multiple Framed Routes. Each Framed Route refers to a range of IPv4 addresses (i.e. an IPv4 address and an IPv4 address mask) or a range of IPv6 Prefixes (i.e. an IPv6 Prefix and an IPv6 Prefix length). The set of one or more Framed Routes associated to a PDU Session is contained in the Framed Route information. The network does not send Framed Route information to the UE: devices in the network(s) behind the UE get their IP address by mechanisms out of the scope of 3GPP specifications. See RFC 2865 [73], RFC 3162 [74].\nFramed Route information is provided by the SMF to the UPF (acting as PSA) as part of Packet Detection Rule (PDR, see clause 5.8.5.3) related with the network side (N6) of the UPF.\nNOTE:\tSMF can take the UPF capabilities into account when selecting PSA UPF, to ensure that the SMF chooses PSA UPF(s) that support Framed Routing for PDU Sessions to DNN and/or slices deemed to support Framed Routing e.g. DNN and/or slices intended to support RG or if Framed Route information has been received as part of Session Management Subscription data.\nThe Framed Route information may be provided to the SMF by:\n-\tthe DN-AAA server as part of PDU Session Establishment authentication/authorization by a DN-AAA server (as defined in clause 5.6.6); or by\n-\tSession Management Subscription data associated with DNN and S-NSSAI sent by UDM (as defined in clause 5.2.3.3.1 of TS 23.502 [3]).\nIf the SMF receives Framed Route information both from DN-AAA and from UDM, the information received from DN-AAA takes precedence and supersedes the information received from UDM.\nThe IPv4 address / IPv6 Prefix allocated to the UE as part of the PDU Session establishment (e.g. delivered in NAS PDU Session Establishment Accept) may belong to one of the Framed Routes associated with the PDU Session or may be dynamically allocated outside of such Framed Routes.\nIf PCC applies to the PDU Session, at PDU Session establishment the SMF reports to the PCF the Framed Route information corresponding to the PDU Session (as described in clause 6.1.3.5 of TS 23.503 [45]). In this case, in order to support session binding, the PCF may further report to the BSF the Framed Route information corresponding to the PDU Session (as described in clause 6.1.2.2 of TS 23.503 [45]).\nIf the UDM or DN-AAA updates the Framed Route information during the lifetime of the PDU Session, the SMF releases the PDU Session and may include in the release request an indication for the UE to re-establish the PDU Session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.15\tTriggers for network analytics",
                            "text_content": "Triggers for the SMF to request for or subscribe to the analytics information from the NWDAF are internal logic may include for example:\n-\tUE PDU Session related event subscription by other NFs (e.g. AMF, NEF);\n-\tUE access and mobility event reports from the AMF;\n-\tlocally detected events;\n-\tanalytics information received.\nThe trigger conditions may depend on operator and implementation policy in the SMF. When a trigger condition happens, the SMF may decide if any analytics information is needed and if so, request for or subscription to the analytics information from the NWDAF.\nThe SMF may, upon detection of certain local events, e.g. number of PDU sessions establishment or released reaches a threshold in a specific area, request for or subscribe to network analytics related to \"Abnormal behaviour\" as described in TS 23.288 [86] to detect whether there are any exceptional UE behaviours in this area.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.16\tSupport for Service Function Chaining",
                            "text_content": "Service Function Chaining, also called N6-LAN Traffic Steering, refers to the steering of subscriber's traffic flows to appropriate operator or 3rd party Service Functions (e.g. NAT, antimalware, parental control, DDoS protection) in the N6-LAN.\nThe content of this clause applies to non-roaming and to Home Routed roaming scenario, i.e. to cases where the involved entities (AF, PCF, SMF, UPF) belong to the Home PLMN and the AF has an agreement with the Home PLMN.\nThe PCF controls Service Function Chaining by provisioning and modifying traffic steering control information for N6-LAN Traffic Steering as described in TS 23.503 [45], e.g. clause 6.1.3.14. The traffic steering control information for N6-LAN Traffic Steering consists of a traffic description and a reference to a traffic steering policy that is configured in the SMF/UPF.\nThe PCF derives the TSP ID(s) (that can be different for uplink and downlink directions) based on operator configuration and sends the TSP ID(s) to the SMF as part of the N6-LAN Traffic Steering Enforcement Control information in the PCC rule as described in clause 6.3.1 of TS 23.503 [45].\nWhen the PCC rule is activated or updated with N6-LAN Traffic Steering Enforcement Control information, the SMF sets the Forwarding Policy (uplink and/or downlink) within the FAR(s) based on the authorized TSP ID(s) in the PCC rule and under consideration of the direction. In case that Application Function influence on traffic routing Enforcement Control information and N6-LAN Traffic Steering Enforcement Control information are both provided for the uplink direction, the SMF shall derive N4 rules which instruct the UPF to pass the traffic through the relevant Service Function(s) deployed in the N6-LAN before steering the traffic to the local data network. The SMF provides instructions to UPF for N6-LAN traffic steering as further detailed in clause 5.8.5.6.\nThe UPF applies traffic steering mechanism based on Forwarding Policy, i.e. the UPF performs deployment specific actions as configured for the Forwarding Policy.\nNOTE 1:\tIt is assumed that all UPFs in the operator network serving as PSA for the DNN/S-NSSAI/DNAI subject to N6-LAN traffic steering need to be configured with the same traffic steering information for N6-LAN traffic steering.\nWhen performing deployment specific actions configured for the Forwarding Policy, the UPF may support traffic steering related functionality and user plane encapsulation protocols that are out of 3GPP scope (e.g. as defined by other standards organizations).\nNOTE 2:\tThe existing user plane mechanisms (e.g. VXLAN, NSH, GENEVE, GRE, VLAN, etc.) defined at IETF are reused as applicable by the PSA UPF to support N6-LAN traffic steering.\nThe mechanism used for forwarding the traffic between the Service Functions within the N6-LAN is out of 3GPP scope.\nAn AF may request the steering of user plane traffic to a pre-configured chain of Service Functions on N6-LAN.\nIn the non-roaming scenario, Application Function influence on Service Function Chaining and Application Function influence on traffic routing (as defined in clause 5.6.7) can be applicable to the same traffic simultaneously.\nIt is assumed that a service level agreement exists between the operator and a third party that includes a list of authorized predefined Service Function Chains (SFCs), each SFC being identified based on a Service Function Chaining identifier (SFC ID). The AF may request the selected traffic flows to be steered towards a specific SFC, either at PDU Session establishment or any time after PDU Session establishment.\nThe AF requests may be sent to the PCF via the NEF. When SFC ID is included in the AF request, the parameters listed in Table 5.6.16.2-1 may be included in the AF request.\nTable 5.6.16.2-1: Information element contained in AF request\n\nThe PCF checks whether the SFC ID received from the AF corresponds to an authorized predefined SFC according to the service level agreement with this AF. Based on the SFC ID received from the AF, the PCF derives the TSP ID(s) (that can be different for uplink and downlink directions) and sends the TSP ID(s) and optionally Metadata (as provided by the AF) to the SMF as part of the PCC rule(s) as described in clause 6.3.1 of TS 23.503 [45].\nThe SMF behaves in the same way it is described in clause 5.6.16.1. If the SMF has received Metadata in the N6-LAN Traffic Steering Enforcement Control information of the PCC rule, the SMF forwards the Metadata to the UPF via N4 in the corresponding FAR as described in clause 5.8.5.6.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.6.16.2-1: Information element contained in AF request",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "5.7\tQoS model",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.7.1\tGeneral Overview",
                            "text_content": "The 5G QoS model is based on QoS Flows. The 5G QoS model supports both QoS Flows that require guaranteed flow bit rate (GBR QoS Flows) and QoS Flows that do not require guaranteed flow bit rate (Non-GBR QoS Flows). The 5G QoS model also supports Reflective QoS (see clause 5.7.5).\nThe QoS Flow is the finest granularity of QoS differentiation in the PDU Session. A QoS Flow ID (QFI) is used to identify a QoS Flow in the 5G System. User Plane traffic with the same QFI within a PDU Session receives the same traffic forwarding treatment (e.g. scheduling, admission threshold). The QFI is carried in an encapsulation header on N3 (and N9) i.e. without any changes to the e2e packet header. QFI shall be used for all PDU Session Types. The QFI shall be unique within a PDU Session. The QFI may be dynamically assigned or may be equal to the 5QI (see clause 5.7.2.1).\nWithin the 5GS, a QoS Flow is controlled by the SMF and may be preconfigured, or established via the PDU Session Establishment procedure (see clause 4.3.2 of TS 23.502 [3]), or the PDU Session Modification procedure (see clause 4.3.3 of TS 23.502 [3].\nAny QoS Flow is characterised by:\n-\tA QoS profile provided by the SMF to the AN via the AMF over the N2 reference point or preconfigured in the AN;\n-\tOne or more QoS rule(s) and optionally QoS Flow level QoS parameters (as specified in TS 24.501 [47]) associated with these QoS rule(s) which can be provided by the SMF to the UE via the AMF over the N1 reference point and/or derived by the UE by applying Reflective QoS control; and\n-\tOne or more UL and DL PDR(s) provided by the SMF to the UPF.\nWithin the 5GS, a QoS Flow associated with the default QoS rule is required to be established for a PDU Session and remains established throughout the lifetime of the PDU Session. This QoS Flow should be a Non-GBR QoS Flow (further details are described in clause 5.7.2.7).\nA QoS Flow is associated with QoS requirements as specified by QoS parameters and QoS characteristics.\nNOTE:\tThe QoS Flow associated with the default QoS rule provides the UE with connectivity throughout the lifetime of the PDU Session. Possible interworking with EPS motivates the recommendation for this QoS Flow to be of type Non-GBR.\nA QoS Flow may be enabled with PDU Set based QoS handling as described in clause 5.37.5. For such QoS Flows, PDU Set QoS Parameters (see clause 5.7.7) are determined by the PCF and provided by SMF to the NG-RAN as part of the QoS profile.\nA QoS Flow may either be 'GBR' or 'Non-GBR' depending on its QoS profile. The QoS profile of a QoS Flow is sent to the (R)AN and it contains QoS parameters as described below (details of QoS parameters are described in clause 5.7.2):\n-\tFor each QoS Flow, the QoS profile shall include the QoS parameters:\n-\t5G QoS Identifier (5QI); and\n-\tAllocation and Retention Priority (ARP).\n-\tFor each QoS Flow, the QoS profile may also include the QoS parameters:\n-\tPDU Set QoS Parameters (described in clause 5.7.7).\n-\tFor each Non-GBR QoS Flow only, the QoS profile may also include the QoS parameter:\n-\tReflective QoS Attribute (RQA).\n-\tFor each GBR QoS Flow only, the QoS profile shall also include the QoS parameters:\n-\tGuaranteed Flow Bit Rate (GFBR) - UL and DL; and\n-\tMaximum Flow Bit Rate (MFBR) - UL and DL; and\n-\tIn the case of a GBR QoS Flow only, the QoS profile may also include one or more of the QoS parameters:\n-\tNotification control;\n-\tMaximum Packet Loss Rate - UL and DL.\nNOTE:\tIn this Release of the specification, the Maximum Packet Loss Rate (UL, DL) is only provided for a GBR QoS Flow belonging to voice media.\nEach QoS profile has one corresponding QoS Flow identifier (QFI) which is not included in the QoS profile itself.\nThe usage of a dynamically assigned 5QI for a QoS Flow requires in addition the signalling of the complete 5G QoS characteristics (described in clause 5.7.3) as part of the QoS profile.\nWhen a standardized or pre-configured 5QI is used for a QoS Flow, some of the 5G QoS characteristics may be signalled as part of the QoS profile (as described in clause 5.7.3).\nThe Alternative QoS Profile(s) can be optionally provided for a GBR QoS Flow with Notification control enabled. If the corresponding PCC rule contains the related information (as described in TS 23.503 [45]), the SMF shall provide, in addition to the QoS profile, a prioritized list of Alternative QoS Profile(s) to the NG-RAN. If the SMF provides a new prioritized list of Alternative QoS Profile(s) to the NG-RAN (if the corresponding PCC rule information changes), the NG-RAN shall replace any previously stored list with it.\nAn Alternative QoS Profile represents a combination of QoS parameters PDB, PER, Averaging Window and GFBR to which the application traffic is able to adapt. For delay-critical GBR QoS flows, an Alternative QoS Profile may also include an MDBV.\nNOTE 1:\tThere is no requirement that the GFBR monotonically decreases, nor that the PDB or PER monotonically increase as the Alternative QoS Profiles become less preferred.\nWhen the NG-RAN sends a notification to the SMF that the QoS profile is not fulfilled, the NG-RAN shall, if the currently fulfilled values match an Alternative QoS Profile, include also the reference to the Alternative QoS Profile to indicate the QoS that the NG-RAN currently fulfils (see clause 5.7.2.4). The NG-RAN shall enable the SMF to determine when an NG-RAN node supports the Alternative QoS feature but cannot fulfil even the least preferred Alternative QoS Profile.\nNOTE 2:\tTo reduce the risk that GBR QoS Flows are released in case of RAN resource limitations (and then experience difficulties in being re-established), Application Functions can set the least preferred Alternative Service Requirement to an undemanding level.\nThe following options are supported to control QoS Flows:\n1)\tFor Non-GBR QoS Flows, and when standardized 5QIs or pre-configured 5QIs are used and when the 5QI is within the range of the QFI (i.e. a value less than 64), the 5QI value may be used as the QFI of the QoS Flow.\n(a)\tA default ARP shall be pre-configured in the AN; or\n(b)\tThe ARP and the QFI shall be sent to RAN over N2 at PDU Session Establishment or at PDU Session Modification and when NG-RAN is used every time the User Plane of the PDU Session is activated; and\n2)\tFor all other cases (including GBR and Non-GBR QoS Flows), a dynamically assigned QFI shall be used. The 5QI value may be a standardized, pre-configured or dynamically assigned. The QoS profile and the QFI of a QoS Flow shall be provided to the (R)AN over N2 at PDU Session Establishment/Modification and when NG-RAN is used every time the User Plane of the PDU Session is activated.\nOnly options 1b and 2 may apply to 3GPP ANs. Options 1a, 1b and 2 may apply to Non-3GPP access.\nNOTE:\tPre-configured 5QI values cannot be used when the UE is roaming.\nThe UE performs the classification and marking of UL User plane traffic, i.e. the association of UL traffic to QoS Flows, based on QoS rules. These QoS rules may be explicitly provided to the UE (i.e. explicitly signalled QoS rules using the PDU Session Establishment/Modification procedure), pre-configured in the UE or implicitly derived by the UE by applying Reflective QoS (see clause 5.7.5). A QoS rule contains the QFI of the associated QoS Flow, a Packet Filter Set (see clause 5.7.6) and a precedence value (see clause 5.7.1.9). An explicitly signalled QoS rule contains a QoS rule identifier which is unique within the PDU Session and is generated by SMF.\nThere can be more than one QoS rule associated with the same QoS Flow (i.e. with the same QFI).\nWhen the UE informs the network about the number of supported Packet Filters for signalled QoS rules for the PDU Session (during the PDU Session Establishment procedure or using the PDU Session Modification procedure as described in clause 5.17.2.2.2 after the first inter-system change from EPS to 5GS for a PDU Session established in EPS and transferred from EPS with N26 interface), the SMF shall ensure that the sum of the Packet Filters used by all signalled QoS rules for a PDU Session does not exceed the number indicated by the UE.\nA default QoS rule is required to be sent to the UE for every PDU Session establishment and it is associated with a QoS Flow. For IP type PDU Session or Ethernet type PDU Session, the default QoS rule is the only QoS rule of a PDU Session which may contain a Packet Filter Set that allows all UL packets, and in this case, the highest precedence value shall be used for the QoS rule.\nNOTE 2:\tHow the UE evaluates UL packets against the Packet Filter Set in a QoS rule is described in clause 5.7.1.5.\nNOTE 3:\tThe QoS rule pre-configured in the UE is only used together with option 1a for control QoS Flows as described in clause 5.7.1.3. How to keep the consistency of QFI and Packet Filter Set between UE and network is out of scope in this release of the specification.\nFor Unstructured type PDU Session, the default QoS rule does not contain a Packet Filter Set, and in this case the default QoS rule defines the treatment of all packets in the PDU Session.\nAs long as the default QoS rule does not contain a Packet Filter Set or contains a Packet Filter Set that allows all UL packets, Reflective QoS should not be applied for the QoS Flow which the default QoS rule is associated with and the RQA should not be sent for this QoS Flow.\nThe SMF performs the binding of PCC rules to QoS Flows based on the QoS and service requirements (as defined in TS 23.503 [45]). The SMF assigns the QFI for a new QoS Flow and derives its QoS profile, corresponding UPF instructions and QoS Rule(s) from the PCC rule(s) bound to the QoS Flow and other information provided by the PCF.\nWhen applicable, the SMF provides the following information for the QoS Flow to the (R)AN:\n-\tQFI;\n-\tQoS profile as described in clause 5.7.1.2.\n-\toptionally, Alternative QoS Profile(s) as described in clause 5.7.1.2a;\nFor each PCC rule bound to a QoS Flow, the SMF provides the following information to the UPF enabling classification, bandwidth enforcement and marking of User Plane traffic (the details are described in clause 5.8):\n-\ta DL PDR containing the DL part of the SDF template;\n-\tan UL PDR containing the UL part of the SDF template;\nNOTE 1:\tIf a DL PDR for an bidirectional SDF is associated with a QoS Flow other than the one associated with the default QoS rule and the UE has not received any instruction to use this QoS Flow for the SDF in uplink direction (i.e. neither a corresponding QoS rule is sent to the UE nor the Reflective QoS Indication is set in the PCC rule), it means that the UL PDR for the same SDF has to be associated with the QoS Flow associated with the default QoS rule.\n-\tthe PDR precedence value (see clause 5.7.1.9) for both PDRs is set to the precedence value of the PCC rule;\n-\tQoS related information (e.g. MBR for an SDF, GFBR and MFBR for a GBR QoS Flow) as described in clause 5.8.2;\n-\tthe corresponding packet marking information (e.g. the QFI, the transport level packet marking value (e.g. the DSCP value of the outer IP header);\n-\toptionally, the Reflective QoS Indication is included in the QER associated with the DL PDR (as described in clause 5.7.5.3).\nFor each PCC rule bound to a QoS Flow, when applicable, the SMF generates an explicitly signalled QoS rule (see clause 5.7.1.4) according to the following principles and provides it to the UE together with an add operation:\n-\tA unique (for the PDU Session) QoS rule identifier is assigned;\n-\tThe QFI in the QoS rule is set to the QFI of the QoS Flow to which the PCC rule is bound;\n-\tThe Packet Filter Set of the QoS rule is generated from the UL SDF filters and optionally the DL SDF filters of the PCC rule (but only from those SDF filters that have an indication for being signalled to the UE, as defined in TS 23.503 [45]);\n-\tThe QoS rule precedence value is set to the precedence value of the PCC rule for which the QoS rule is generated;\n-\tfor a dynamically assigned QFI, the QoS Flow level QoS parameters (e.g. 5QI, GFBR, MFBR, Averaging Window, see TS 24.501 [47]) are signalled to UE in addition to the QoS rule(s) associated to the QoS Flow. The QoS Flow level QoS parameters of an existing QoS Flow may be updated based on the MBR and GBR information received in the PCC rule (MBR and GBR per SDF are however not provided to UE over N1 in the case of more than one SDF) or, if the PCF has not indicated differently, when Notification control or handover related signalling indicates that the QoS parameter the NG-RAN is currently fulfilling for the QoS Flow have changed (see clause 5.7.2.4).\nChanges in the binding of PCC rules to QoS Flows as well as changes in the PCC rules or other information provided by the PCF can require QoS Flow changes which the SMF has to provide to (R)AN, UPF and/or UE. In the case of changes in the explicitly signalled QoS rules associated to a QoS Flow, the SMF provides the explicitly signalled QoS rules and their operation (i.e. add/modify/delete) to the UE.\nNOTE 2:\tThe SMF cannot provide, update or remove pre-configured QoS rules or UE derived QoS rules.\nThe principle for classification and marking of User Plane traffic and mapping of QoS Flows to AN resources is illustrated in Figure 5.7.1.5-1.\nThe figure depicts a schematic representation of the classification and User Plane marking (UPM) process for QoS Flows and mapping them to AN (Access Network) resources. It illustrates the steps involved in determining the appropriate classification and UPM for each flow, ensuring that the network resources are allocated efficiently and effectively.\nFigure 5.7.1.5-1: The principle for classification and User Plane marking for QoS Flows and mapping to AN Resources\nIn DL, incoming data packets are classified by the UPF based on the Packet Filter Sets of the DL PDRs in the order of their precedence (without initiating additional N4 signalling). The UPF conveys the classification of the User Plane traffic belonging to a QoS Flow through an N3 (and N9) User Plane marking using a QFI. The AN binds QoS Flows to AN resources (i.e. Data Radio Bearers of in the case of 3GPP RAN). There is no strict 1:1 relation between QoS Flows and AN resources. It is up to the AN to establish the necessary AN resources that QoS Flows can be mapped to, and to release them. The AN shall indicate to the SMF when the AN resources onto which a QoS Flow is mapped are released.\nIf no matching DL PDR is found, the UPF shall discard the DL data packet.\nIn UL:\n-\tFor a PDU Session of Type IP or Ethernet, the UE evaluates UL packets against the UL Packet Filters in the Packet Filter Set in the QoS rules based on the precedence value of QoS rules in increasing order until a matching QoS rule (i.e. whose Packet Filter matches the UL packet) is found.\n-\tIf no matching QoS rule is found, the UE shall discard the UL data packet.\n-\tFor a PDU Session of Type Unstructured, the default QoS rule does not contain a Packet Filter Set and allows all UL packets.\nNOTE 3:\tOnly the default QoS rule exist for a PDU Session of Type Unstructured.\nThe UE uses the QFI in the corresponding matching QoS rule to bind the UL packet to a QoS Flow. The UE then binds QoS Flows to AN resources.\nThe following characteristics apply for processing of DL traffic:\n-\tUPF maps User Plane traffic to QoS Flows based on the PDRs.\n-\tUPF performs Session-AMBR enforcement as specified in clause 5.7.1.8 and performs counting of packets for charging.\n-\tUPF transmits the PDUs of the PDU Session in a single tunnel between 5GC and (R)AN, the UPF includes the QFI in the encapsulation header. In addition, UPF may include an indication for Reflective QoS activation in the encapsulation header.\n-\tUPF performs transport level packet marking in DL on a per QoS Flow basis. The UPF uses the transport level packet marking value provided by the SMF (as described in clause 5.8.2.7).\n-\t(R)AN maps PDUs from QoS Flows to access-specific resources based on the QFI and the associated 5G QoS profile, also taking into account the N3 tunnel associated with the DL packet.\nNOTE:\tPacket Filters are not used for the mapping of QoS Flows onto access-specific resources in (R)AN.\n-\tIf Reflective QoS applies, the UE creates a new derived QoS rule as defined in clause 5.7.5.2.\nFollowing characteristics apply for processing of UL traffic:\n-\tUE uses the stored QoS rules to determine mapping between UL User Plane traffic and QoS Flows. UE marks the UL PDU with the QFI of the QoS rule containing the matching Packet Filter and transmits the UL PDUs using the corresponding access specific resource for the QoS Flow based on the mapping provided by (R)AN. For NG-RAN, the UL behaviour is specified in clause 10.5.2 of TS 38.300 [27].\n-\t(R)AN transmits the PDUs over N3 tunnel towards UPF. When passing an UL packet from (R)AN to CN, the (R)AN includes the QFI value, in the encapsulation header of the UL PDU, and selects the N3 tunnel.\n-\t(R)AN performs transport level packet marking in the UL on a per QoS Flow basis with a transport level packet marking value that is determined based on the 5QI, the Priority Level (if explicitly signalled) and the ARP priority level of the associated QoS Flow.\n-\tUPF verifies whether QFIs in the UL PDUs are aligned with the QoS Rules provided to the UE or implicitly derived by the UE in the case of Reflective QoS).\n-\tUPF and UE perform Session-AMBR enforcement as specified in clause 5.7.1.8 and the UPF performs counting of packets for charging.\nUL and DL Session-AMBR (see clause 5.7.2.6) shall be enforced by the UPF, if the UPF receives the Session-AMBR values from the SMF as described in clause 5.8.2.7 and clause 5.8.5.4.\nFor UL Classifier PDU Sessions, UL and DL Session-AMBR (see clause 5.7.2.6) shall be enforced in the SMF selected UPF that supports the UL Classifier functionality. In addition, the DL Session-AMBR shall be enforced separately in every UPF that terminates the N6 interface (i.e. without requiring interaction between the UPFs) (see clause 5.6.4).\nFor multi-homed PDU Sessions, UL and DL Session-AMBR shall be enforced in the UPF that supports the Branching Point functionality. In addition, the DL Session-AMBR shall be enforced separately in every UPF that terminates the N6 interface (i.e. without requiring interaction between the UPFs) (see clause 5.6.4).\nNOTE:\tThe DL Session-AMBR is enforced in every UPF terminating the N6 interface to reduce unnecessary transport of traffic which may be discarded by the UPF performing the UL Classifier/Branching Point functionality due to the amount of the DL traffic for the PDU Session exceeding the DL Session-AMBR. Discarding DL packets in the UL Classifier/Branching Point could cause erroneous PDU counting for support of charging\nThe (R)AN shall enforce UE-AMBR (see clause 5.7.2.6) in UL and DL per UE for Non-GBR QoS Flows.\nThe UE shall perform UL rate limitation on PDU Session basis for Non-GBR traffic using Session-AMBR, if the UE receives a Session-AMBR.\nMBR per SDF is mandatory for GBR QoS Flows but optional for Non-GBR QoS Flows. The MBR is enforced in the UPF.\nThe MFBR is enforced in the UPF in the Downlink for GBR QoS Flows. The MFBR is enforced in the (R)AN in the Downlink and Uplink for GBR QoS Flows. For non-3GPP access, the UE should enforce MFBR in the Uplink for GBR QoS Flows.\nThe QoS control for Unstructured PDUs is performed at the PDU Session level and in this Release of the specification there is only support for maximum of one 5G QoS Flow per PDU Session of Type Unstructured.\nWhen a PDU Session is set up for transferring unstructured PDUs, SMF provides the QFI which will be applied to any packet of the PDU Session to the UPF and UE.\nThe QoS rule precedence value and the PDR precedence value determine the order in which a QoS rule or a PDR, respectively, shall be evaluated. The evaluation of the QoS rules or PDRs is performed in increasing order of their precedence value.\nIf a supporting NG-RAN receives for a UE a UE-Slice-MBR (see clause 5.7.2.6) for an S-NSSAI from the AMF, the NG-RAN shall apply this UE-Slice-MBR for all PDU Sessions of that UE corresponding to the S-NSSAI which have an active user plane if feasible. In particular, the NG-RAN shall enforce this UE-Slice-MBR as follows:\n1)\tWhenever a request for a GBR QoS Flow establishment or modification is received, the NG-RAN admission control shall ensure that the sum of the GFBR values of the admitted GBR QoS Flows is not exceeding the UE-Slice-MBR and, if the QoS Flow cannot be admitted, the NG-RAN shall reject the establishment/modification of the QoS Flow.\nNOTE:\tIf the UE-Slice-MBR would be exceeded by a new/modified GBR QoS Flow, the NG-RAN determines whether the new/modified GBR QoS Flow can pre-empt any existing GBR QoS Flow of the UE's PDU Session(s) corresponding to the same S-NSSAI based on their ARP values (as per clause 5.7.2.2), e.g. to support certain priority services (e.g. MPS). If this is not possible, the NG-RAN can reject the establishment/modification of the QoS Flow.\n2)\tThe NG-RAN shall ensure that the aggregated bitrate across all GBR and Non-GBR QoS Flows belonging to those PDU Sessions is not exceeding the UE-Slice-MBR, while always guaranteeing the GFBR of every GBR QoS Flow of those PDU Sessions as described in clause 5.7.2.5.\nIn the case of home-routed roaming, the V-SMF may apply VPLMN policies related with the SLA negotiated with the HPLMN or with QoS values supported by the VPLMN. Such policies may result in a situation that the V-SMF does not accept the PDU Session or does not accept some of the QoS Flows requested by the H-SMF.\nQoS constraints represent the QoS that the VPLMN can accept for the QoS Flow associated with the default QoS rule and the PDU Session based on SLA or based on QoS values supported by the VPLMN. The QoS constraints may contain 5QI, 5QI Priority Level and ARP for the QoS Flow associated with the default QoS rule and highest Session-AMBR accepted by the VPLMN.\nNOTE:\tFor this Release of the specification, QoS constraints apply only to the non-GBR default QoS Flow.\nAt PDU Session Establishment for home-routed roaming, to reduce the risk of PDU Session establishment failure due to QoS from the HPLMN not being compliant with SLA, the V-SMF may provide the VPLMN local policy in QoS constraints to the H-SMF as specified in clause 4.3.2.2.2 of TS 23.502 [3].\nFor intra-5GS mobility with V-SMF insertion or V-SMF change (e.g. inter-PLMN mobility), as specified in clause 4.23 of TS 23.502 [3], the new/target V-SMF may validate the currently applied QoS against the QoS constraints. The new/target V-SMF provides QoS constraints to the H-SMF during the mobility procedure. The new/target V-SMF may temporarily accept a higher QoS even if the currently applied QoS exceeds the QoS constraints. Alternatively, for the QoS parameters related with the QoS constraints, the V-SMF may locally downgrade these values before providing the corresponding QoS profiles to 5G AN. The V-SMF may decide to release the PDU Session if the HPLMN does not provide updated QoS compliant with the QoS constraints after the mobility procedure.\nFor IMS voice service (e.g. the IMS DNN defined by the GSMA), the V-SMF, based on local policy, may override the ARP received from HPLMN over N16 if the ARP indicates priority not in line with the local policy in VPLMN. The ARP override in the serving PLMN applies to both the QoS Flow associated with the default QoS rule and the QoS Flows for IMS voice, to apply the same allocation and retention priority for all users (i.e. roamers and non-roamers). For MPS (clause 5.16.5), the same allocation and retention priority is applied to all MPS service users (i.e. roamers and non-roamers), when roaming agreements are in place and where regulatory requirements apply.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.2\t5G QoS Parameters",
                            "text_content": "A 5QI is a scalar that is used as a reference to 5G QoS characteristics defined in clause 5.7.4, i.e. access node-specific parameters that control QoS forwarding treatment for the QoS Flow (e.g. scheduling weights, admission thresholds, queue management thresholds, link layer protocol configuration, etc.).\nStandardized 5QI values have one-to-one mapping to a standardized combination of 5G QoS characteristics as specified in Table 5.7.4-1.\nThe 5G QoS characteristics for pre-configured 5QI values are pre-configured in the AN.\nStandardized or pre-configured 5G QoS characteristics, are indicated through the 5QI value, and are not signalled on any interface, unless certain 5G QoS characteristics are modified as specified in clauses 5.7.3.3, 5.7.3.4, 5.7.3.6, and 5.7.3.7.\nThe 5G QoS characteristics for QoS Flows with dynamically assigned 5QI are signalled as part of the QoS profile.\nNOTE:\tOn N3, each PDU (i.e. in the tunnel used for the PDU Session) is associated with one 5QI via the QFI carried in the encapsulation header.\nThe QoS parameter ARP contains information about the priority level, the pre-emption capability and the pre-emption vulnerability. This allows deciding whether a QoS Flow establishment/modification/handover may be accepted or needs to be rejected in the case of resource limitations (typically used for admission control of GBR traffic). It may also be used to decide which existing QoS Flow to pre-empt during resource limitations, i.e. which QoS Flow to release to free up resources.\nThe ARP priority level defines the relative importance of a QoS Flow. The range of the ARP priority level is 1 to 15 with 1 as the highest priority.\nThe ARP priority levels 1-8 should only be assigned to QoS Flows for services that are authorized to receive prioritized treatment within an operator domain (i.e. that are authorized by the serving network). The ARP priority levels 9-15 may be assigned to QoS Flows for services that are authorized by the home network and thus applicable when a UE is roaming.\nNOTE:\tThis ensures that future releases may use ARP priority level 1-8 to indicate e.g. emergency and other priority services within an operator domain in a backward compatible manner. This does not prevent the use of ARP priority level 1-8 in roaming situation in the case that appropriate roaming agreements exist that ensure a compatible use of these priority levels.\nThe ARP pre-emption capability defines whether a QoS Flow may get resources that were already assigned to another QoS Flow with a lower priority. The ARP pre-emption vulnerability defines whether a QoS Flow may lose the resources assigned to it in order to admit a QoS Flow with higher priority. The ARP pre-emption capability and the ARP pre-emption vulnerability shall be either set to 'enabled' or 'disabled'.\nThe ARP pre-emption vulnerability of the QoS Flow which the default QoS rule is associated with should be set appropriately to minimize the risk of a release of this QoS Flow.\nThe details of how the SMF sets the ARP for a QoS Flow are further described in clause 5.7.2.7.\nThe Reflective QoS Attribute (RQA) is an optional parameter which indicates that certain traffic (not necessarily all) carried on this QoS Flow is subject to Reflective QoS. Only when the RQA is signalled for a QoS Flow, the (R)AN enables the transfer of the RQI for AN resource corresponding to this QoS Flow. The RQA may be signalled to NG-RAN via the N2 reference point at UE context establishment in NG-RAN and at QoS Flow establishment or modification.\nThe QoS Parameter Notification control indicates whether notifications are requested from the NG-RAN when the \"GFBR can no longer (or can again) be guaranteed\" for a QoS Flow during the lifetime of the QoS Flow. Notification control may be used for a GBR QoS Flow if the application traffic is able to adapt to the change in the QoS (e.g. if the AF is capable to trigger rate adaptation).\nThe SMF shall only enable Notification control when the QoS Notification Control parameter is set in the PCC rule (received from the PCF) that is bound to the QoS Flow. The Notification control parameter is signalled to the NG-RAN as part of the QoS profile.\nIf, for a given GBR QoS Flow, Notification control is enabled and the NG-RAN determines that the GFBR, the PDB or the PER of the QoS profile cannot be fulfilled, NG-RAN shall send a notification towards SMF that the \"GFBR can no longer be guaranteed\". Furthermore, the NG-RAN shall keep the QoS Flow (i.e. while the NG-RAN is not fulfilling the requested QoS profile for this QoS Flow), unless specific conditions at the NG-RAN require the release of the NG-RAN resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN internal congestion. The NG-RAN should try to fulfil the GFBR, the PDB and the PER of the QoS profile again.\nNOTE 1:\tNG-RAN can decide that the \"GFBR can no longer be guaranteed\" based on, e.g. measurements like queuing delay or system load.\nUpon receiving a notification from the NG-RAN that the \"GFBR can no longer be guaranteed\", the SMF may forward the notification to the PCF, see TS 23.503 [45].\nWhen the NG-RAN determines that the GFBR, the PDB and the PER of the QoS profile can be fulfilled again for a QoS Flow (for which a notification that the \"GFBR can no longer be guaranteed\" has been sent), the NG-RAN shall send a notification, informing the SMF that the \"GFBR can be guaranteed\" again and the SMF may forward the notification to the PCF, see TS 23.503 [45]. The NG-RAN shall send a subsequent notification that the \"GFBR can no longer be guaranteed\" whenever necessary.\nNOTE 2:\tIt is assumed that NG-RAN implementation will apply some hysteresis before determining that the \"GFBR can be guaranteed again\" and therefore a frequent signalling of \"GFBR can be guaranteed again\" followed by \"GFBR can no longer be guaranteed\" is not expected.\nNOTE 3:\tIf the QoS Flow is modified, the NG-RAN restarts the check whether the \"GFBR can no longer be guaranteed\" according to the updated QoS profile. If the Notification control parameter is not included in the updated QoS profile, the Notification control is disabled.\nDuring a handover, the Source NG-RAN does not inform the Target NG-RAN about whether the Source NG-RAN has sent a notification for a QoS Flow that the \"GFBR can no longer be guaranteed\". The Target NG-RAN performs admission control rejecting any QoS Flows for which resources cannot be permanently allocated. The accepted QoS Flows are included in the N2 Path Switch Request or N2 Handover Request Acknowledge message from the NG-RAN to the AMF. The SMF shall interpret the fact that a QoS Flow is listed as transferred QoS Flow in the Nsmf_PDUSession_UpdateSMContext Request received from the AMF as a notification that \"GFBR can be guaranteed again\" for this QoS Flow unless the SMF is also receiving a reference to an Alternative QoS Profile for this QoS Flow (which is described in clause 5.7.2.4.2). After the handover is successfully completed, the Target NG-RAN shall send a subsequent notification that the \"GFBR can no longer be guaranteed\" for such a QoS Flow whenever necessary. If the SMF has previously notified the PCF that the \"GFBR can no longer be guaranteed\" and the SMF does not receive an explicit notification that the \"GFBR can no longer be guaranteed\" for that QoS Flow from the Target NG-RAN within a configured time, the SMF shall notify the PCF that the \"GFBR can be guaranteed again\".\nIf, for a given GBR QoS Flow, Notification control is enabled and the NG-RAN has received a list of Alternative QoS Profile(s) for this QoS Flow and supports the Alternative QoS Profile handling, the following shall apply:\n1)\tIf the NG-RAN determines that the GFBR, the PDB or the PER of the QoS profile cannot be fulfilled, NG-RAN shall send a notification towards SMF that the \"GFBR can no longer be guaranteed\". Before sending a notification that the \"GFBR can no longer be guaranteed\" towards the SMF, the NG-RAN shall check whether the GFBR, the PDB and the PER that the NG-RAN currently fulfils match any of the Alternative QoS Profile(s) in the indicated priority order. If there is a match, the NG-RAN shall indicate the reference to the matching Alternative QoS Profile with the highest priority together with the notification to the SMF.\nIf there is no match, the NG-RAN shall send a notification that the \"GFBR can no longer be guaranteed\" towards the SMF indicating that the lowest Alternative QoS Profile cannot be fulfilled (unless specific conditions at the NG-RAN require the release of the NG-RAN resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN internal congestion).\n2)\tIf a notification that the \"GFBR can no longer be guaranteed\" has been sent to the SMF and the NG-RAN determines that the currently fulfilled GFBR, PDB or PER are different (better or worse) from the situation indicated in the last notification, the NG-RAN shall send a notification (i.e. \"GFBR can no longer be guaranteed\" or \"GFBR can be guaranteed again\") to the SMF and indicate the current situation (unless specific conditions at the NG-RAN require the release of the NG-RAN resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN internal congestion).\nNOTE 1:\tThe current situation is either that the QoS Profile can be fulfilled (which is implicitly indicated by the \"GFBR can be guaranteed again\" notification itself), that a different Alternative QoS Profile can be fulfilled, or that the lowest priority Alternative QoS Profile cannot be fulfilled.\n3)-\tThe NG-RAN should always try to fulfil the QoS profile and, if this is not possible, any Alternative QoS Profile that has higher priority.\nNOTE 2:\tIn order to avoid a too frequent signalling to the SMF, it is assumed that NG-RAN implementation can apply hysteresis (e.g. via a configurable time interval) before notifying the SMF that the currently fulfilled values match the QoS Profile or a different Alternative QoS Profile of higher priority. It is also assumed that the PCF has ensured that the QoS values within the different Alternative QoS Profile(s) are not too close to each other.\n4)\tUpon receiving a notification from the NG-RAN, the SMF may inform the PCF. If it does so, the SMF shall indicate the currently fulfilled situation to the PCF. See TS 23.503 [45].\n5)\tIf the PCF has not indicated differently, the SMF uses NAS signalling (that is sent transparently through the RAN) to inform the UE about changes in the QoS parameters (i.e. 5QI, GFBR, MFBR) that the NG-RAN is currently fulfilling for the QoS Flow after Notification control has occurred.\nDuring handover, the prioritized list of Alternative QoS Profile(s) (if available) is provided to the Target NG-RAN per QoS Flow in addition to the QoS profile. If the Target NG-RAN is not able to guarantee the GFBR, the PDB and the PER included in the QoS profile and if Alternative QoS Profiles are provided to the Target NG-RAN and the Target NG-RAN supports Alternative QoS Profiles, the Target NG-RAN checks whether the GFBR, the PDB and the PER values that it can fulfil match any of the Alternative QoS Profile(s) taking the priority order into account. If there is a match between one of the Alternative QoS Profiles and the GFBR, the PDB and the PER values that Target NG-RAN can fulfil, the Target NG-RAN shall accept the QoS Flow and indicate the reference to that Alternative QoS Profile to the Source NG-RAN.\nFor delay-critical GBR QoS flows, the Target NG-RAN also takes into consideration whether it is able to accept the MDBV if it is included in the Alternative QoS profile.\nIf there is no match to any Alternative QoS Profile, the Target NG-RAN rejects QoS Flows for which the Target NG-RAN is not able to guarantee the GFBR, the PDB, the PER and if available, an associated MDBV included in the QoS profile.\nAfter the handover is completed and a QoS Flow has been accepted by the Target NG-RAN based on an Alternative QoS Profile, the Target NG-RAN shall treat this QoS Flow in the same way as if it had sent a notification that the \"GFBR can no longer be guaranteed\" with a reference to that Alternative QoS Profile to the SMF (as described in clause 5.7.2.4.1b).\nIf a QoS Flow has been accepted by the Target NG-RAN based on an Alternative QoS Profile, the reference to the matching Alternative QoS Profile is provided from the Target NG-RAN to the AMF (which forwards the message to the SMF) during the Xn and N2 based handover procedures as described in TS 23.502 [3]. After the handover is completed successfully, the SMF shall send a notification to the PCF that the \"GFBR can no longer be guaranteed\" for a QoS Flow (see TS 23.503 [45] for details) if the SMF has received a reference to an Alternative QoS Profile and this reference indicates a change in the previously notified state of this QoS Flow. If the PCF has not indicated differently, the SMF shall also use NAS signalling (that is sent transparently through the RAN) to inform the UE about the QoS parameters (i.e. 5QI, GFBR, MFBR) corresponding to the new state of the QoS Flow.\nNOTE:\tA state change for the QoS Flow comprises a change from QoS profile fulfilled to Alternative QoS Profile fulfilled as well as the state change between fulfilled Alternative QoS Profiles.\nIf a QoS Flow has been accepted by the Target NG-RAN based on the QoS Profile, the SMF shall interpret the fact that a QoS Flow is listed as transferred QoS Flow in the message received from the AMF as a notification that \"GFBR can be guaranteed again\" for this QoS Flow. After the handover is successfully completed, the Target NG-RAN performs as described in clause 5.7.2.4.1b. If the SMF has previously notified the PCF that the \"GFBR can no longer be guaranteed\" and the SMF does not receive an explicit notification that the \"GFBR can no longer be guaranteed\" for that QoS Flow from the Target NG-RAN within a configured time, the SMF shall notify the PCF that the \"GFBR can be guaranteed again\".\nIf a QoS Flow has been accepted by the Target NG-RAN and SMF did not receive from the Target NG-RAN a reference to any Alternative QoS Profile and the SMF has previously informed the UE about QoS parameters corresponding to any of the Alternative QoS Profile(s), the SMF shall use NAS signalling to inform the UE about the QoS parameters corresponding to the QoS Profile.\nDuring QoS Flow establishment and modification, a prioritized list of Alternative QoS Profile(s) can be provided to the NG-RAN for the QoS Flow in addition to the QoS profile. If the NG-RAN is not able to guarantee the GFBR, the PDB and the PER included in the QoS profile and if Alternative QoS Profiles are provided to the NG-RAN and the NG-RAN supports Alternative QoS Profiles, the NG-RAN shall check whether the GFBR, the PDB and the PER values that it can fulfil match at least one of the Alternative QoS Profile(s) taking the priority order into account. If there is a match between one of the Alternative QoS Profiles and the GFBR, the PDB and if available, associated MDBV and the PER values that the NG-RAN can fulfil, the NG-RAN shall accept the QoS Flow and indicate the reference to that Alternative QoS Profile to the SMF. If there is no match to any Alternative QoS Profile, the NG-RAN shall reject the QoS Flow establishment or modification.\nAfter a successful QoS Flow establishment or modification during which the NG-RAN indicated that the currently fulfilled QoS matches one of the Alternative QoS Profiles, the NG-RAN shall treat this QoS Flow in the same way as if it had sent a notification that the \"GFBR can no longer be guaranteed\" with a reference to that Alternative QoS Profile to the SMF (as described in clause 5.7.2.4.1b).\nIf the SMF has received a reference to an Alternative QoS Profile during QoS Flow establishment and modification the SMF may inform the PCF about it (as described in TS 23.503 [45]).\nIf the PCF has not indicated differently, the SMF shall use NAS signalling (that is sent transparently through the RAN) to inform the UE about the QoS parameters (i.e. 5QI, GFBR, MFBR) corresponding to the referenced Alternative QoS Profile.\nFor GBR QoS Flows only, the following additional QoS parameters exist:\n-\tGuaranteed Flow Bit Rate (GFBR) - UL and DL;\n-\tMaximum Flow Bit Rate (MFBR) -- UL and DL.\nThe GFBR denotes the bit rate that is guaranteed to be provided by the network to the QoS Flow over the Averaging Time Window. The MFBR limits the bit rate to the highest bit rate that is expected by the QoS Flow (e.g. excess traffic may get discarded or delayed by a rate shaping or policing function at the UE, RAN, UPF). Bit rates above the GFBR value and up to the MFBR value, may be provided with relative priority determined by the Priority Level of the QoS Flows (see clause 5.7.3.3).\nGFBR and MFBR are signalled to the (R)AN in the QoS Profile and signalled to the UE as QoS Flow level QoS parameter (as specified in TS 24.501 [47]) for each individual QoS Flow.\nNOTE 1:\tThe GFBR is recommended as the lowest acceptable service bitrate where the service will survive.\nNOTE 2:\tFor each QoS Flow of Delay-critical GBR resource type, the SMF can ensure that the GFBR of the QoS Flow can be achieved with the MDBV of the QoS Flow using the QoS Flow binding functionality described in clause 6.1.3.2.4 of TS 23.503 [45].\nNOTE 3:\tThe network can set MFBR larger than GFBR for a particular QoS Flow based on operator policy and the knowledge of the end point capability, i.e. support of rate adaptation at application / service level.\nEach PDU Session of a UE is associated with the following aggregate rate limit QoS parameter:\n-\tper Session Aggregate Maximum Bit Rate (Session-AMBR).\nThe Session-AMBR is signalled to the appropriate UPF entity/ies to the UE and to the (R)AN (to enable the calculation of the UE-AMBR). The Session-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR QoS Flows for a specific PDU Session. The Session-AMBR is measured over an AMBR averaging window which is a standardized value. The Session-AMBR is not applicable to GBR QoS Flows.\nEach UE is associated with the following aggregate rate limit QoS parameter:\n-\tper UE Aggregate Maximum Bit Rate (UE-AMBR).\nThe UE-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR QoS Flows of a UE. Each (R)AN shall set its UE-AMBR to the sum of the Session-AMBR of all PDU Sessions with active user plane to this (R)AN up to the value of the UE-AMBR received from AMF. The UE-AMBR is a parameter provided to the (R)AN by the AMF based on the value of the subscribed UE-AMBR retrieved from UDM or the dynamic serving network UE-AMBR retrieved from PCF (e.g. for roaming subscriber). The AMF provides the UE-AMBR provided by PCF to (R)AN if available. The UE-AMBR is measured over an AMBR averaging window which is a standardized value. The UE-AMBR is not applicable to GBR QoS Flows.\nEach group of PDU Sessions of the UE for the same slice (S-NSSAI) may be associated with the following aggregate rate limit QoS parameter:\n-\tper UE per Slice-Maximum Bit Rate (UE-Slice-MBR).\nThe UE-Slice-MBR limits the aggregate bit rate that can be expected to be provided across all GBR and Non-GBR QoS Flows corresponding to PDU Sessions of the UE for the same slice (S-NSSAI) which have an active user plane. Each supporting NG-RAN shall set its UE-Slice-MBR to the sum of the Session-AMBR and MFBR for GBR QoS Flows of all PDU Sessions corresponding to the slice (S-NSSAI) with active user plane to this NG-RAN up to the value of the UE-Slice-MBR corresponding to the slice (S-NSSAI) received from AMF. The UE-Slice-MBR is measured over an AMBR averaging window which is a standardized value. The UE-Slice-MBR is an optional parameter provided to the NG-RAN by the AMF as described in clause 5.15.13.\nNOTE:\tThe AMBR averaging window is only applied to Session-AMBR, UE-AMBR and UE-Slice-MBR measurement and the AMBR averaging windows for Session-AMBR and UE-AMBR are standardised to the same value.\nFor each PDU Session Setup, the SMF retrieves the subscribed Session-AMBR values as well as the subscribed default values for the 5QI and the ARP and optionally, the 5QI Priority Level, from the UDM. The subscribed default 5QI value shall be a Non-GBR 5QI from the standardized value range.\nNOTE 1:\tThe 5QI Priority Level can be added to the subscription information to achieve an overwriting of the standardized or preconfigured 5QI Priority Level e.g. in scenarios where dynamic PCC is not deployed or the PCF is unavailable or unreachable.\nThe SMF may change the subscribed values for the default 5QI and the ARP and if received, the 5QI Priority Level, based on interaction with the PCF as described in TS 23.503 [45] or, if dynamic PCC is not deployed, based on local configuration, to set QoS parameters for the QoS Flow associated with the default QoS rule.\nFor QoS Flow(s) of the PDU Session other than the QoS Flow associated with the default QoS rule, the SMF shall set the ARP priority level, the ARP pre-emption capability and the ARP pre-emption vulnerability to the respective values in the PCC rule(s) bound to that QoS Flow (as described in TS 23.503 [45]). If dynamic PCC is not deployed, the SMF shall set the ARP priority level, the ARP pre-emption capability and the ARP pre-emption vulnerability based on local configuration.\nNOTE 2:\tThe local configuration in the SMF can e.g. make use of the subscribed value for the ARP priority level and apply locally configured values for the ARP pre-emption capability and ARP pre-emption vulnerability.\nIf dynamic PCC is not deployed, the SMF can have a DNN based configuration to enable the establishment of a GBR QoS Flow as the QoS Flow that is associated with the default QoS rule. This configuration contains a standardized GBR 5QI as well as GFBR and MFBR for UL and DL.\nNOTE 3:\tInterworking with EPS is not possible for a PDU Session with a GBR QoS Flow as the QoS Flow that is associated with the default QoS rule.\nThe SMF may change the subscribed Session-AMBR values (for UL and/or DL), based on interaction with the PCF as described in TS 23.503 [45] or, if dynamic PCC is not deployed, based on local configuration, to set the Session-AMBR values for the PDU Session.\nThe Maximum Packet Loss Rate (UL, DL) indicates the maximum rate for lost packets of the QoS Flow that can be tolerated in the uplink and downlink direction. This is provided to the QoS Flow if it is compliant to the GFBR\nNOTE:\tIn this Release of the specification, the Maximum Packet Loss Rate (UL, DL) can only be provided for a GBR QoS Flow belonging to voice media.\nQoS parameters that are applicable only for or wireline access networks (W-5GAN) are specified in TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.3\t5G QoS characteristics",
                            "text_content": "This clause specifies the 5G QoS characteristics associated with 5QI. The characteristics describe the packet forwarding treatment that a QoS Flow receives edge-to-edge between the UE and the UPF in terms of the following performance characteristics:\n1\tResource type (Non-GBR, GBR, Delay-critical GBR);\n2\tPriority Level;\n3\tPacket Delay Budget (including Core Network Packet Delay Budget);\n4\tPacket Error Rate;\n5\tAveraging window (for GBR and Delay-critical GBR resource type only);\n6\tMaximum Data Burst Volume (for Delay-critical GBR resource type only).\nThe 5G QoS characteristics should be understood as guidelines for setting node specific parameters for each QoS Flow e.g. for 3GPP radio access link layer protocol configurations.\nStandardized or pre-configured 5G QoS characteristics, are indicated through the 5QI value, and are not signalled on any interface, unless certain 5G QoS characteristics are modified as specified in clauses 5.7.3.3, 5.7.3.4, 5.7.3.6, and 5.7.3.7.\nNOTE:\tAs there are no default values specified, pre-configured 5G QoS characteristics have to include all of the characteristics listed above.\nSignalled 5G QoS characteristics are provided as part of the QoS profile and shall include all of the characteristics listed above.\nThe resource type determines if dedicated network resources related to a QoS Flow-level Guaranteed Flow Bit Rate (GFBR) value are permanently allocated (e.g. by an admission control function in a radio base station).\nGBR QoS Flows are therefore typically authorized \"on demand\" which requires dynamic policy and charging control. A GBR QoS Flow uses either the GBR resource type or the Delay-critical GBR resource type. The definition of PDB and PER are different for GBR and Delay-critical GBR resource types, and the MDBV parameter applies only to the Delay-critical GBR resource type.\nA Non-GBR QoS Flow may be pre-authorized through static policy and charging control. A Non-GBR QoS Flow uses only the Non-GBR resource type.\nThe Priority Level associated with 5G QoS characteristics indicates a priority in scheduling resources among QoS Flows. The lowest Priority Level value corresponds to the highest priority.\nThe Priority Level shall be used to differentiate between QoS Flows of the same UE, and it shall also be used to differentiate between QoS Flows from different UEs.\nIn the case of congestion, when all QoS requirements cannot be fulfilled for one or more QoS Flows, the Priority Level shall be used to select for which QoS Flows the QoS requirements are prioritised such that a QoS Flow with Priority Level value N is priorized over QoS Flows with higher Priority Level values (i.e. N+1, N+2, etc).In the case of no congestion, the Priority Level should be used to define the resource distribution between QoS Flows. In addition, the scheduler may prioritize QoS Flows based on other parameters (e.g. resource type, radio condition) in order to optimize application performance and network capacity.\nEvery standardized 5QI is associated with a default value for the Priority Level -specified in QoS characteristics Table 5.7.4.1). Priority Level may also be signalled together with a standardized 5QI to the -R)AN, and if it is received, it shall be used instead of the default value.\nPriority Level may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.\nThe Packet Delay Budget (PDB) defines an upper bound for the time that a packet may be delayed between the UE and the N6 termination point at the UPF. The PDB applies to the DL packet received by the UPF over the N6 interface, and to the UL packet sent by the UE. For a certain 5QI the value of the PDB is the same in UL and DL. In the case of 3GPP access, the PDB is used to support the configuration of scheduling and link layer functions (e.g. the setting of scheduling priority weights and HARQ target operating points). For GBR QoS Flows using the Delay-critical resource type, a packet delayed more than PDB is counted as lost if the data burst is not exceeding the MDBV within the period of PDB and the QoS Flow is not exceeding the GFBR. For GBR QoS Flows with GBR resource type not exceeding GFBR, 98 percent of the packets shall not experience a delay exceeding the 5QI's PDB.\nThe 5G Access Network Packet Delay Budget (5G-AN PDB) is determined by subtracting a static value for the Core Network Packet Delay Budget (CN PDB), which represents the delay between any N6 termination point at the UPF (for any UPF that may possibly be selected for the PDU Session) and the 5G-AN from a given PDB.\nNOTE 1:\tFor a standardized 5QI, the static value for the CN PDB is specified in the QoS characteristics Table 5.7.4-1.\nNOTE 2:\tFor a non-standardized 5QI, the static value for the CN PDB is homogeneously configured in the network.\nFor GBR QoS Flows using the Delay-critical resource type, in order to obtain a more accurate delay budget PDB available for the NG-RAN, a dynamic value for the CN PDB, which represents the delay between the UPF terminating N6 for the QoS Flow and the 5G-AN, can be used. If used for a QoS Flow, the NG-RAN shall apply the dynamic value for the CN PDB instead of the static value for the CN PDB (which is only related to the 5QI). Different dynamic value for CN PDB may be configured per uplink and downlink direction.\nNOTE 3:\tThe configuration of transport network on CN tunnel can be different per UL and DL, which can be different value for CN PDB per UL and DL.\nNOTE 4:\tIt is expected that the UPF deployment ensures that the dynamic value for the CN PDB is not larger than the static value for the CN PDB. This avoids that the functionality that is based on the 5G-AN PDB (e.g. MDBV, NG-RAN scheduler) has to handle an unexpected value.\nThe dynamic value for the CN PDB of a Delay-critical GBR 5QI may be configured in the network in two ways:\n-\tConfigured in each NG-RAN node, based on a variety of inputs such as different IP address(es) or TEID range of UPF terminating the N3 tunnel and based on different combinations of PSA UPF to NG-RAN under consideration of any potential I-UPF, etc;\n-\tConfigured in the SMF, based on different combinations of PSA UPF to NG-RAN under consideration of any potential I-UPF. The dynamic value for the CN PDB for a particular QoS Flow shall be signalled to NG-RAN (during PDU Session Establishment, PDU Session Modification, Xn/N2 handover and the Service Request procedures) when the QoS Flow is established or the dynamic value for the CN PDB of a QoS Flow changes, e.g. when an I-UPF is inserted by the SMF.\nIf the NG-RAN node is configured locally with a dynamic value for the CN PDB for a Delay-critical GBR 5QI, and receives a different value via N2 signalling for a QoS Flow with the same 5QI, local configuration in RAN node determines which value takes precedence.\nServices using a GBR QoS Flow and sending at a rate smaller than or equal to the GFBR can in general assume that congestion related packet drops will not occur.\nNOTE 5:\tExceptions (e.g. transient link outages) can always occur in a radio access system which may then lead to congestion related packet drops. Packets surviving congestion related packet dropping may still be subject to non-congestion related packet losses (see PER below).\nServices using Non-GBR QoS Flows should be prepared to experience congestion-related packet drops and delays. In uncongested scenarios, 98 percent of the packets should not experience a delay exceeding the 5QI's PDB.\nThe PDB for Non-GBR and GBR resource types denotes a \"soft upper bound\" in the sense that an \"expired\" packet, e.g. a link layer SDU that has exceeded the PDB, does not need to be discarded and is not added to the PER. However, for a Delay-critical GBR resource type, packets delayed more than the PDB are added to the PER and can be discarded or delivered depending on local decision.\nThe Packet Error Rate (PER) defines an upper bound for the rate of PDUs (e.g. IP packets) that have been processed by the sender of a link layer protocol (e.g. RLC in RAN of a 3GPP access) but that are not successfully delivered by the corresponding receiver to the upper layer (e.g. PDCP in RAN of a 3GPP access). Thus, the PER defines an upper bound for a rate of non-congestion related packet losses. The purpose of the PER is to allow for appropriate link layer protocol configurations (e.g. RLC and HARQ in RAN of a 3GPP access). For every 5QI the value of the PER is the same in UL and DL. For GBR QoS Flows with Delay-critical GBR resource type, a packet which is delayed more than PDB is counted as lost, and included in the PER unless the data burst is exceeding the MDBV within the period of PDB or the QoS Flow is exceeding the GFBR.\nEach GBR QoS Flow shall be associated with an Averaging window. The Averaging window represents the duration over which the GFBR and MFBR shall be calculated (e.g. in the (R)AN, UPF, UE).\nEvery standardized 5QI (of GBR and Delay-critical GBR resource type) is associated with a default value for the Averaging window (specified in QoS characteristics Table 5.7.4.1). The averaging window may also be signalled together with a standardized 5QI to the (R)AN and UPF, and if it is received, it shall be used instead of the default value.\nThe Averaging window may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.\nEach GBR QoS Flow with Delay-critical resource type shall be associated with a Maximum Data Burst Volume (MDBV).\nMDBV denotes the largest amount of data that the 5G-AN is required to serve within a period of 5G-AN PDB.\nEvery standardized 5QI (of Delay-critical GBR resource type) is associated with a default value for the MDBV (specified in QoS characteristics Table 5.7.4.1). The MDBV may also be signalled together with a standardized 5QI to the (R)AN, and if it is received, it shall be used instead of the default value.\nThe MDBV may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.4\tStandardized 5QI to QoS characteristics mapping",
                            "text_content": "Standardized 5QI values are specified for services that are assumed to be frequently used and thus benefit from optimized signalling by using standardized QoS characteristics. Dynamically assigned 5QI values (which require a signalling of QoS characteristics as part of the QoS profile) can be used for services for which standardized 5QI values are not defined. The one-to-one mapping of standardized 5QI values to 5G QoS characteristics is specified in table 5.7.4-1.\nTable 5.7.4-1: Standardized 5QI to QoS characteristics mapping\n\nNOTE:\tIt is preferred that a value less than 64 is allocated for any new standardised 5QI of Non-GBR resource type. This is to allow for option 1 to be used as described in clause 5.7.1.3 (as the QFI is limited to less than 64).\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.7.4-1: Standardized 5QI to QoS characteristics mapping",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.7.5\tReflective QoS",
                            "text_content": "Reflective QoS enables the UE to map UL User Plane traffic to QoS Flows without SMF provided QoS rules and it applies for IP PDU Session and Ethernet PDU Session. This is achieved by creating UE derived QoS rules in the UE based on the received DL traffic. It shall be possible to apply Reflective QoS and non-Reflective QoS concurrently within the same PDU Session.\nFor a UE supporting Reflective QoS functionality, the UE shall create a UE derived QoS rule for the uplink traffic based on the received DL traffic if Reflective QoS function is used by the 5GC for some traffic flows. The UE shall use the UE derived QoS rules to determine mapping of UL traffic to QoS Flows.\nIf the 3GPP UE supports Reflective QoS functionality, the UE should indicate support of Reflective QoS to the network (i.e. SMF) for every PDU Session. For PDU Sessions established in EPS and PDU Sessions transferred from EPS without N26 interface, the UE indicates Reflective QoS support using the PDU Session Establishment procedure. After the first inter-system change from EPS to 5GS for PDU Sessions established in EPS and transferred from EPS with N26 interface, the UE indicates Reflective QoS support using the PDU Session Modification procedure as described in clause 5.17.2.2.2. The UE as well as the network shall apply the information whether or not the UE indicated support of Reflective QoS throughout the lifetime of the PDU Session.\nNOTE:\tThe logic driving a supporting UE under exceptional circumstances to not indicate support of Reflective QoS for a PDU Session is implementation dependent.\nUnder exceptional circumstances, which are UE implementation dependent, the UE may decide to revoke previously indicated support for Reflective QoS using the PDU Session Modification procedure. In such a case, the UE shall delete all derived QoS rules for this PDU Session and the network shall stop any user plane enforcement actions related to Reflective QoS for this PDU Session. In addition, the network may provide signalled QoS rules for the SDFs for which Reflective QoS was used before. The UE shall not indicate support for Reflective QoS for this PDU Session for the remaining lifetime of the PDU Session.\nIf under the same exceptional circumstances mentioned above and while NAS level MM or SM congestion control timer is running, the UE needs to revoke a previously indicated support for Reflective QoS, the UE performs PDU Session Release procedure that is exempt from MM and SM congestion control as defined in clause 5.19.7.\nThe UE derived QoS rule contains following parameters:\n-\tOne UL Packet Filter (in the Packet Filter Set as defined in clause 5.7.6);\n-\tQFI;\n-\tPrecedence value (see clause 5.7.1.9).\nUpon receiving DL packet, one UL Packet Filter derived from the received DL packet as described in this clause is used to identify a UE derived QoS rule within a PDU Session.\nFor PDU Session of IP type, the UL Packet Filter is derived based on the received DL packet as follows:\n-\tWhen Protocol ID / Next Header is set to TCP or UDP, by using the source and destination IP addresses, source and destination port numbers, and the Protocol ID / Next Header field itself.\n-\tWhen Protocol ID / Next Header is set to UDP, if the received DL packet is UDP-encapsulated IPSec protected packet, by using the source and destination IP addresses, source and destination port numbers, the Security Parameter Index, and the Protocol ID / Next Header field itself. In this case, if an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL packet exists and the SPI of the uplink IPSec SA is known to the NAS layer, then the UL Packet Filter contains an SPI of the uplink IPSec SA.\n-\tWhen Protocol ID / Next Header is set to ESP, by using the source and destination IP addresses, the Security Parameter Index, and the Protocol ID / Next Header field itself. If the received DL packet is an IPSec protected packet, and an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL packet exists and the SPI of the uplink IPSec SA is known to the NAS layer, then the UL Packet Filter contains an SPI of the uplink IPSec SA.\nNOTE 1:\tIn this Release of the specification for PDU Sessions of IP type the use of Reflective QoS is restricted to service data flows for which Protocol ID / Next Header is set to TCP, UDP or ESP.\nNOTE 2:\tThe UE does not verify whether the downlink packets with RQI indication match the restrictions on Reflective QoS.\nNOTE 3:\tHow to determine the received DL packet is UDP-encapsulated IPSec protected packet is defined in RFC 3948 [138]. UDP encapsulation for ESP is used when a NAT is detected, and there can be different Security Parameter Indexes within the same IP-tuples.\nNOTE 4:\tDespite the indication of support for Reflective QoS, the UE might not be able to derive QoS Rules for ESP IPSec packets and UDP-encapsulated IPSec packets, if uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL packet exists and the SPI of the uplink IPSec SA is not known to the NAS layer.\nFor PDU Session of Ethernet type the UL Packet Filter is derived based on the received DL packet by using the source and destination MAC addresses, the Ethertype on received DL packet is used as Ethertype for UL packet. In the case of presence of IEEE Std 802.1Q [98], the VID and PCP in IEEE Std 802.1Q [98] header(s) of the received DL packet is also used as the VID and PCP field for the UL Packet Filter. When double IEEE Std 802.1Q [98] tagging is used, only the outer (S-TAG) is taken into account for the UL Packet Filter derivation.\nNOTE 5:\tIn this Release of the specification for PDU Sessions of Ethernet type the use of Reflective QoS is restricted to service data flows for which 802.1Q [98] tagging is used.\nThe QFI of the UE derived QoS rule is set to the value received in the DL packet.\nWhen Reflective QoS is activated the precedence value for all UE derived QoS rules is set to a standardised value.\nReflective QoS is controlled on per-packet basis by using the Reflective QoS Indication (RQI) in the encapsulation header on N3 (and N9) reference point together with the QFI and together with a Reflective QoS Timer (RQ Timer) value that is either signalled to the UE upon PDU Session Establishment (or upon PDU Session Modification as described in clause 5.17.2.2.2) or set to a default value. The RQ Timer value provided by the core network is at the granularity of PDU Session (the details are specified in TS 24.501 [47]).\nWhen the 5GC determines that Reflective QoS has to be used for a specific SDF belonging to a QoS Flow, the SMF shall provide the RQA (Reflective QoS Attribute) within the QoS Flow's QoS profile to the NG-RAN on N2 reference point unless it has been done so before. When the RQA has been provided to the NG-RAN for a QoS Flow and the 5GC determines that the QoS Flow carries no more SDF for which Reflective QoS has to be used, the SMF should signal the removal of the RQA (Reflective QoS Attribute) from the QoS Flow's QoS profile to the NG-RAN on N2 reference point.\nNOTE 1:\tThe SMF could have a timer to delay the sending of the removal of the RQA. This would avoid signalling to the RAN in the case of new SDFs subject to Reflective QoS are bound to this QoS Flow in the meantime.\nWhen the 5GC determines to use Reflective QoS for a specific SDF, the SMF shall ensure that the UPF applies the RQI marking (e.g. by setting the indication to use Reflective QoS in the QER associated with the DL PDR if not already set) for this SDF. The SMF shall also ensure that the uplink packets for this SDF can be received by the UPF from the QoS Flow to which the DL PDR of the SDF is associated with as specified in TS 29.244 [65], e.g. by generating a new UL PDR for this SDF for that QoS Flow and providing it to the UPF.\nWhen the UPF is instructed by the SMF to apply RQI marking, the UPF shall set the RQI in the encapsulation header on the N3 (or N9) reference point for every DL packet corresponding to this SDF.\nWhen an RQI is received by (R)AN in a DL packet on N3 reference point, the (R)AN shall indicate to the UE the QFI and the RQI of that DL packet.\nUpon reception of a DL packet with RQI:\n-\tif a UE derived QoS rule with a Packet Filter corresponding to the DL packet does not already exist,\n-\tthe UE shall create a new UE derived QoS rule with a Packet Filter corresponding to the DL packet (as described in clause 5.7.5.2); and\n-\tthe UE shall start, for this UE derived QoS rule, a timer set to the RQ Timer value.\n-\totherwise,\n-\tthe UE shall restart the timer associated to this UE derived QoS rule; and\n-\tif the QFI associated with the downlink packet is different from the QFI associated with the UE derived QoS rule, the UE shall update this UE derived QoS rule with the new QFI.\nNOTE 2:\tNon-3GPP ANs does not need N2 signalling to enable Reflective QoS. Non 3GPP accesses are expected to send transparently the QFI and RQI to the UE. If the UPF does not include the RQI, no UE derived QoS rule will be generated. If RQI is included to assist the UE to trigger an update of the UE derived QoS rule, the reception of PDU for a QFI restarts the RQ Timer.\nUpon timer expiry associated with a UE derived QoS rule the UE deletes the corresponding UE derived QoS rule.\nWhen the 5GC determines not to use Reflective QoS for a specific SDF any longer:\n-\tThe SMF shall ensure that the UPF stops applying RQI marking as specified in TS 29.244 [65] (e.g. by removing the indication to use Reflective QoS from the QER associated with the DL PDR) for this SDF.\n-\tWhen the UPF receives this instruction to stop applying RQI marking, the UPF shall no longer set the RQI in the encapsulation header on the N3 (or N9) reference point DL packets corresponding to this SDF.\n-\tThe SMF shall also ensure that, after an operator configurable time, the uplink packets for this SDF will not be accepted by the UPF over the QoS Flow on which Reflective QoS was applied for this SDF as specified in TS 29.244 [65], e.g. by removing the UL PDR for this SDF from that QoS Flow.\nNOTE 3:\tThe operator configurable time has to be at least as long as the RQ Timer value to ensure that no UL packet would be dropped until the UE derived QoS rule is deleted by the UE.\nWhen the 5GC determines to change the binding of the SDF while Reflective QoS is used for this SDF, the SMF shall ensure that the uplink packets for this SDF are accepted over the newly bound QoS Flow and, for an operator configurable time, over the previously bound QoS Flow.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.6\tPacket Filter Set",
                            "text_content": "The Packet Filter Set is used in the QoS rule and the PDR to identify one or more packet (IP or Ethernet) flow(s).\nNOTE 1:\tA QoS Flow is characterised by PDR(s) and QoS rule(s) as described in clause 5.7.1.1.\nNOTE 2:\tDL Packet Filter in a Packet Filter Set of a QoS rule may be needed by the UE e.g. for the purpose of IMS precondition.\nThe Packet Filter Set may contain one or more Packet Filter(s). Every Packet Filter is applicable for the DL direction, the UL direction or both directions.\nNOTE 3:\tThe Packet Filter in the Packet Filter Set of the default QoS rule that allows all UL traffic (also known as match-all Packet Filter) is described in TS 24.501 [47].\nThere are two types of Packet Filter Set, i.e. IP Packet Filter Set, and Ethernet Packet Filter Set, corresponding to those PDU Session Types.\nFor IP PDU Session Type, the Packet Filter Set shall support Packet Filters based on at least any combination of:\n-\tSource/destination IP address or IPv6 prefix.\n-\tSource / destination port number.\n-\tProtocol ID of the protocol above IP/Next header type.\n-\tType of Service (TOS) (IPv4) / Traffic class (IPv6) and Mask.\n-\tFlow Label (IPv6).\n-\tSecurity parameter index.\n-\tPacket Filter direction.\nNOTE 1:\tA value left unspecified in a Packet Filter matches any value of the corresponding information in a packet.\nNOTE 2:\tAn IP address or Prefix may be combined with a prefix mask.\nNOTE 3:\tPort numbers may be specified as port ranges.\nFor Ethernet PDU Session Type, the Packet Filter Set shall support Packet Filters based on at least any combination of:\n-\tSource/destination MAC address.\n-\tEthertype as defined in IEEE 802.3 [131].\n-\tCustomer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) VID fields as defined in IEEE Std 802.1Q [98].\n-\tCustomer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) PCP/DEI fields as defined in IEEE Std 802.1Q [98].\n-\tIP Packet Filter Set, in the case that Ethertype indicates IPv4/IPv6 payload.\n-\tPacket Filter direction.\nNOTE 1:\tThe MAC address may be specified as address ranges.\nNOTE 2:\tA value left unspecified in a Packet Filter matches any value of the corresponding information in a packet.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.7.7\tPDU Set QoS Parameters",
                            "text_content": "PDU Set QoS Parameters are used to support PDU Set based QoS handling in the NG-RAN. At least one PDU Set QoS Parameter shall be sent to the NG-RAN to enable PDU Set based QoS handling.\nThe following PDU Set QoS Parameters are specified:\n1.\tPDU Set Delay Budget (PSDB).\n2.\tPDU Set Error Rate (PSER).\n3.\tPDU Set Integrated Handling Information (PSIHI).\nFor a given QoS Flow, the values of PSDB, PSER and PSIHI can be different for UL and DL.\nThe QoS Profile may include the PDU Set QoS Parameters described in this clause (see clause 5.7.1.2) for UL and/or DL direction. The PCF determines the PDU Set QoS Parameters based on information provided by AF and/or local configuration. The PDU Set QoS parameters are sent to the SMF as part of PCC rule. The SMF sends them to NG-RAN as part of the QoS Profile.\nIf the NG-RAN receives PDU Set QoS Parameters, it enables the PDU Set based QoS handling and applies PDU Set QoS Parameters as described in TS 38.300 [27], TS 38.413 [34] and TS 38.331 [51].\nThe PDU Set Delay Budget (PSDB) defines an upper bound for the delay that a PDU Set may experience for the transfer between the UE and the N6 termination point at the UPF, i.e. the duration between the reception time of the first PDU (at the N6 termination point for DL or the UE for UL) and the time when all PDUs of a PDU Set have been successfully received (at the UE for DL or N6 termination point for UL). PSDB applies to the DL PDU Set received by the PSA UPF over the N6 interface, and to the UL PDU Set sent by the UE.\nNOTE:\tTo enable support for PSDB, it is required that a maximum inter arrival time between the first received PDU and the last received PDU of a PDU Set complies with SLA. This maximum inter arrival time does not exceed PSDB. NG-RAN behaviour when the SLA is not fulfilled is out of scope of this specification.\nA QoS Flow is associated with at most one PDU Set Delay Budget value per direction. PSDB is an optional parameter that may be provided by the PCF. The provided PSDB can be used by the NG-RAN to support the configuration of scheduling and link layer functions.\nWhen the PSDB is available, the PSDB supersedes the PDB for the given QoS Flow.\nThe AN PSDB is derived at NG-RAN by subtracting CN PDB (as described in clause 5.7.3.4) from the PSDB.\nThe PDU Set Error Rate (PSER) defines an upper bound for the rate of PDU Sets that have been processed by the sender of a link layer protocol (e.g. RLC in RAN of a 3GPP access) but that are not successfully delivered by the corresponding receiver to the upper layer (e.g. PDCP in RAN of a 3GPP access). Thus, the PSER defines an upper bound for a rate of non-congestion related PDU Set losses. The purpose of the PSER is to allow for appropriate link layer protocol configurations (e.g. RLC and HARQ in RAN of a 3GPP access).\nNOTE 1:\tIn this Release, a PDU Set is considered as successfully delivered only when all PDUs of a PDU Set are delivered successfully.\nNOTE 2:\tHow RAN enforces PSER is up to RAN implementation.\nA QoS Flow is associated with at most one PDU Set Error Rate value per direction. PSER is an optional parameter. If the PSER is available, the PSER supersedes the PER.\nThe PDU Set Integrated Handling Information (PSIHI) indicates whether all PDUs of the PDU Set are needed for the usage of the PDU Set by the application layer in the receiver side. PSIHI is an optional parameter. A QoS Flow is associated with at most one PSIHI value per direction.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.8\tUser Plane Management",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.8.1\tGeneral",
                            "text_content": "User Plane Function(s) handle the user plane path of PDU Sessions. 3GPP specifications support deployments with a single UPF or multiple UPFs for a given PDU Session. UPF selection is performed by SMF. The details of UPF selection is described in clause 6.3.3. The number of UPFs supported for a PDU Session is unrestricted.\nFor an IPv4 type PDU Session or an IPv6 type PDU Session without multi-homing or an IPv4v6 type PDU Session, when multiple PDU Session Anchors are used (due to UL CL being inserted), only one IPv4 address and/or IPv6 prefix is allocated for the PDU Session. For an IPv6 multi-homed PDU Session there are multiple IPv6 prefixes allocated for the PDU Session as described in clause 5.6.4.3.\nIf the SMF had requested the UPF to proxy ARP or IPv6 Neighbour Solicitation for an Ethernet DNN, the UPF should respond to the ARP or IPv6 Neighbour Solicitation Request, itself.\nDeployments with one single UPF used to serve a PDU Session do not apply to the Home Routed case and may not apply to the cases described in clause 5.6.4.\nDeployments where a UPF is controlled either by a single SMF or multiple SMFs (for different PDU Sessions) are supported.\nUPF traffic detection capabilities may be used by the SMF in order to control at least following features of the UPF:\n-\tTraffic detection (e.g. classifying traffic of IP type, Ethernet type, or unstructured type)\n-\tTraffic reporting (e.g. allowing SMF support for charging).\n-\tQoS enforcement (The corresponding requirements are defined in clause 5.7).\n-\tTraffic routing (e.g. as defined in clause 5.6.4. for UL CL or IPv6 multi-homing).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.2\tFunctional Description",
                            "text_content": "This clause contains detailed functional descriptions for some of the functions provided by the UPF. It is described how the SMF instructs it's corresponding UP function and which control parameters are used.\nThe UE IP address management includes allocation and release of the UE IP address as well as renewal of the allocated IP address, where applicable.\nThe UE shall perform the association of the application to a new PDU Session described in clause 6.1.2.2.1 of TS 23.503 [45], with the following considerations:\n-\tIf there is a matching URSP rule, except the URSP rule with the \"match all\" Traffic descriptor, or a matching UE Local Configuration containing a PDU Session Type of \"IPv4\", \"IPv6\" or \"IPv4v6\", then the UE shall set the requested PDU Session Type to the PDU Session Type contained in the matching URSP rule or in the matching UE Local Configuration, if this PDU Session Type is supported by the UE's IP stack capabilities Detailed operation is described in TS 24.526 [110].\n-\tOtherwise, if a URSP Rule with the \"match all\" Traffic descriptor exists, the UE shall set the requested PDU Session Type to the PDU Session Type contained in the \"match all\" URSP Rule, if this PDU Session Type is supported by the UE's IP stack capabilities. Detailed operation is described in TS 24.526 [110].\n-\tOtherwise, the UE shall set the requested PDU Session Type during the PDU Session Establishment procedure based on its IP stack capabilities as follows:\n-\tA UE which supports IPv6 and IPv4 shall set the requested PDU Session Type \"IPv4v6\".\n-\tA UE which supports only IPv4 shall request for PDU Session Type \"IPv4\".\n-\tA UE which supports only IPv6 shall request for PDU Session Type \"IPv6\".\n-\tWhen the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall request for PDU Session Type \"IPv4v6\".\nThe SMF selects PDU Session Type of the PDU Session as follows:\n-\tIf the SMF receives a request with PDU Session Type set to \"IPv4v6\", the SMF selects either PDU Session Type \"IPv4\" or \"IPv6\" or \"IPv4v6\" based on DNN configuration, subscription data and operator policies.\n-\tIf the SMF receives a request for PDU Session Type \"IPv4\" or \"IPv6\" and the requested IP version is supported by the DNN the SMF selects the requested PDU Session type.\nIn its answer to the UE, the SMF may indicate the PDU Session Types not allowed for the combination of (DNN, S-NNSAI). In this case, the UE shall not request another PDU Session to the same (DNN, S-NNSAI) for PDU Session Types indicated as not allowed by the network. In the case that the initial PDU Session was established with a PDU Session Type and the UE needs another single IP version PDU Session Type, the UE may initiate another PDU Session Establishment procedure to this (DNN, S-NNSAI) in order to activate a second PDU session with that PDU Session Type.\nAn SMF shall ensure that the IP address management procedure is based on the selected PDU Session Type. If IPv4 PDU Session Type is selected, an IPv4 address is allocated to the UE. Similarly, if IPv6 PDU Session type is selected, an IPv6 prefix is allocated. If IPv4v6 PDU Session Type is selected, both an IPv4 address and an IPv6 prefix are allocated. For Roaming case, the SMF in this clause refers to the SMF controlling the UPF(s) acting as PDU Session Anchor. i.e. H-SMF in home routed case and V-SMF in local breakout case. For home routed case, V-SMF forwards the PDU Session Type requested by UE to H-SMF without interpreting it. V-SMF sends back to UE the PDU Session Type selected by H-SMF. The SMF shall process the UE IP address management related messages, maintain the corresponding state information and provide the response messages to the UE.\nThe 5GC and UE support the following mechanisms:\na.\tDuring PDU Session Establishment procedure, the SMF sends the IP address to the UE via SM NAS signalling. The IPv4 address allocation and/or IPv4 parameter configuration via DHCPv4 (according to RFC 2131 [9]) can also be used once PDU Session is established.\nb.\t/64 IPv6 prefix allocation shall be supported via IPv6 Stateless Auto-configuration according to RFC 4862 [10], if IPv6 is supported. The details of Stateless IPv6 Address Autoconfiguration are described in clause 5.8.2.2.3. IPv6 parameter configuration via Stateless DHCPv6 (according to RFC 8415 [182]) may also be supported. IPv6 Prefix Delegation using DHCPv6 may be supported for allocating additional IPv6 prefixes for a PDU Session. The details of Prefix Delegation are described in clause 5.8.2.2.4.\nFor scenarios with RG connecting to 5GC, additional features for IPv6 address allocation and IPv6 prefix delegation are supported, as described in TS 23.316 [84].\nTo allocate the IP address via DHCPv4, the UE may indicate to the network within the Protocol Configuration Options that the UE requests to obtain the IPv4 address with DHCPv4, or obtain the IP address during the PDU Session Establishment procedure. This implies the following behaviour both for static and dynamic address allocation:\n-\tThe UE may indicate that it requests to obtain an IPv4 address as part of the PDU Session Establishment procedure. In such a case, the UE relies on the 5GC network to provide IPv4 address to the UE as part of the PDU Session Establishment procedure.\n-\tThe UE may indicate that it requests to obtain the IPv4 address after the PDU Session Establishment procedure by DHCPv4. That is, when the 5GC network supports DHCPv4 and allows that, it does not provide the IPv4 address for the UE as part of the PDU Session Establishment procedure. The network may respond to the UE by setting the allocated IPv4 Address to 0.0.0.0. After the PDU Session Establishment procedure is completed, the UE uses the connectivity with the 5GC and initiates the IPv4 address allocation on its own using DHCPv4. However, if the 5GC network provides IPv4 address to the UE as part of the PDU Session Establishment procedure, the UE should accept the IPv4 address indicated in the PDU Session Establishment procedure.\n-\tIf the UE sends no IP Address Allocation request, the SMF determines whether DHCPv4 is used between the UE and the SMF or not, based on per DNN configuration.\nIf dynamic policy provisioning is deployed, and the PCF was not informed of the IPv4 address at PDU Session Establishment procedure, the SMF shall inform the PCF about an allocated IPv4 address. If the IPv4 address is released, the SMF shall inform the PCF about the de-allocation of an IPv4 address.\nIn order to support DHCP based IP address configuration, the SMF shall act as the DHCP server towards the UE. The PDU Session Anchor UPF does not have any related DHCP functionality. The SMF instructs the PDU Session Anchor UPF serving the PDU Session to forward DHCP packets between the UE and the SMF over the user plane.\nWhen DHCP is used for external data network assigned addressing and parameter configuration, the SMF shall act as the DHCP client towards the external DHCP server. The UPF does not have any related DHCP functionality. In the case of DHCP server on the external data network, the SMF instructs a UPF with N6 connectivity to forward DHCP packets between the UE and the SMF and the external DHCP server over the user plane.\nThe 5GC may also support the allocation of a static IPv4 address and/or a static IPv6 prefix based on subscription information in the UDM or based on the configuration on a per-subscriber, per-DNN basis and per-S-NSSAI.\nIf the static IP address/prefix is stored in the UDM, during PDU Session Establishment procedure, the SMF retrieves this static IP address/prefix from the UDM. If the static IP address/prefix is not stored in the UDM subscription record, it may be configured on a per-subscriber, per-DNN and per-S-NSSAI basis in the DHCP/DN-AAA server and the SMF retrieves the IP address/prefix for the UE from the DHCP/DN-AAA server. This IP address/prefix is delivered to the UE in the same way as a dynamic IP address/prefix. It is transparent to the UE whether the PLMN or the external data network allocates the IP address and whether the IP address is static or dynamic.\nFor IPv4 or IPv6 or IPv4v6 PDU Session Type, during PDU Session Establishment procedure, the SMF may receive a Subscriber's IP Index from the UDM. If the UE IP address/prefix was not already allocated and provided to PCF when SMF initiates the SM policy association, the SMF may receive a Subscribers IP Index from the PCF. If the SMF received a Subscriber's IP index from both UDM and PCF, the SMF shall apply the Subscriber's IP Index received from the PCF. The SMF may use the Subscriber's IP Index to assist in selecting how the IP address is to be allocated when multiple allocation methods, or multiple instances of the same method are supported. In the case of Home Routed roaming, the H-SMF may receive the IP index from the H-PCF.\nNOTE:\tThe IP Index can e.g. be used to select between different IP pools, including between IP pools with overlapping private address range. To support deployments with overlapping private IPv4 address, the IP domain corresponding to IP index can also be provided from UDM to SMF as part of the subscription data and then provided to PCF.\nWhen Static IP addresses for a PDU session are not used, the actual allocation of the IP Address(es) for a PDU Session may use any of the following mechanisms:\n-\tThe SMF allocates the IP address from a pool that corresponds to the PDU Session Anchor (UPF) that has been selected\n-\tThe UE IP address is obtained from the UPF. In that case the SMF shall interact with the UPF via N4 procedures to obtain a suitable IP address. The SMF provides the UPF with the necessary information allowing the UPF to derive the proper IP address (e.g. the network instance).\n-\tIn the case that the UE IP address is obtained from the external data network, additionally, the SMF shall also send the allocation, renewal and release related request messages to the external data network, i.e. DHCP/DN-AAA server, and maintain the corresponding state information. The IP address allocation request sent to DHCP/DN-AAA server may include the IP address pool ID to identify which range of IP address is to be allocated. In this case the SMF is provisioned with separate IP address pool ID(s), and the mapping between IP address pool ID and UPF Id, DNN, S-NSSAI, IP version. The provision is done by OAM or during the N4 Association Setup procedure.\nA given IP address pool is controlled by a unique entity (either the SMF or the UPF or an external server). The IP address managed by the UPF can be partitioned into multiple IP address pool partition(s), i.e. associated with multiple IP address pool ID(s).\nWhen the SMF is configured to obtain UE IP addresses from the UPF, the SMF may select a UPF based upon support of this feature. The SMF determines whether the UPF supports this feature via NRF or via N4 capability negotiation during N4 Association Setup. If no appropriate UPF support the feature, the SMF may allocate UE IP addresses, if configured to do so.\nThe IP address/prefix is released by the SMF (e.g. upon release of the PDU Session), likewise the UPF considers that any IP address it has allocated within a N4 session are released when this N4 session is released.\nUPF may use NAT between the UE and the Data Network, and thus the 5GC allocated (private) UE IP address may not be visible on the N6 reference point.\nWhen the UE has an IPv6 multi-homed PDU Session the UE selects the source IPv6 prefix according to IPv6 multi-homed routing rules pre-configured in the UE or received from network. IPv6 multi-homed routing rules received from the network have a higher priority than IPv6 multi-homed routing rules pre-configured in the UE\nThe SMF can generate the IPv6 multi-homed routing rules for a UE based on local configuration or dynamic PCC rules received from the PCF as defined in TS 23.503 [45]. If dynamic PCC is deployed, the SMF generates the IPv6 multi-home routing rules for a source IPv6 prefix based on the SDF Templates of those PCC rules which contain the DNAI corresponding to the newly assigned IPv6 prefix. The SMF can send IPv6 multi-homed routing rules to the UE to influence the source IPv6 prefix selection in IPv6 Router Advertisement (RA) messages according to RFC 4191 [8] at any time during the lifetime of the IPv6 multi-homed PDU Session. Such messages are sent via the UPF.\nNOTE:\tFor multiple IPv4 PDU Session and multiple IPv6 PDU Session cases, routing rule based PDU Session selection is not specified in this Release of the specification.\nIf Stateless IPv6 Address Autoconfiguration is used for IPv6 address allocation to the UE, after PDU Session Establishment the UE may send a Router Solicitation message to the SMF to solicit a Router Advertisement message. The SMF sends a Router Advertisement message (solicited or unsolicited) to the UE. The Router Advertisement messages shall contain the IPv6 prefix.\nAfter the UE has received the Router Advertisement message, it constructs a full IPv6 address via IPv6 Stateless Address Autoconfiguration in accordance with RFC 4862 [10]. To ensure that the link-local address generated by the UE does not collide with the link-local address of the UPF and the SMF, the SMF shall provide an interface identifier (see RFC 4862 [10]) to the UE and the UE shall use this interface identifier to configure its link-local address. For Stateless Address Autoconfiguration however, the UE can choose any interface identifier to generate IPv6 addresses, other than link-local, without involving the network. However, the UE shall not use any identifiers defined in TS 23.003 [19] as the basis for generating the interface identifier. For privacy, the UE may change the interface identifier used to generate full IPv6 address, as defined in TS 23.221 [23] without involving the network. Any prefix that the SMF advertises to the UE is globally unique. The SMF shall also record the relationship between the UE's identity (SUPI) and the allocated IPv6 prefix. Because any prefix that the SMF advertises to the UE is globally unique, there is no need for the UE to perform Duplicate Address Detection for any IPv6 address configured from the allocated IPv6 prefix. Even if the UE does not need to use Neighbor Solicitation messages for Duplicate Address Detection, the UE may, for example, use them to perform Neighbor Unreachability Detection towards the SMF, as defined in RFC 4861 [54]. Therefore, the SMF shall respond with a Neighbor Advertisement upon receiving a Neighbor Solicitation message from the UE.\nIn IPv6 multi-homing PDU session, SMF shall not allocate an interface identifier when a new IPv6 prefix allocated corresponding to the new PDU Session Anchor.\nThe above IPv6 related messages (e.g. Router Solicitation, Router Advertisement, Neighbor Solicitation, Neighbor Advertisement) are transferred between the SMF and UE via the UPF(s). If the Control Plane CIoT 5GS Optimisation is enabled for a PDU session, the above IPv6 related messages are transferred between the SMF and UE via the AMF after PDU Session Establishment, see clauses 4.3.2.2.1 and 4.3.2.2.2 of TS 23.502 [3], using the Mobile Terminated Data Transport in Control Plane CIoT 5GS Optimisation procedures.\nOptionally, a single network prefix shorter than the default /64 prefix may be assigned to a PDU Session. In this case, the /64 default prefix used for IPv6 stateless autoconfiguration will be allocated from this network prefix; the remaining address space from the network prefix can be delegated to the PDU Session using prefix delegation after the PDU Session establishment and IPv6 prefix allocation via IPv6 stateless address autoconfiguration as defined in clause 5.8.2.2.3.\nDepending on configuration, the SMF may obtain the prefix from a locally provisioned pool, from the PSA UPF or from the external DN.\nThe address space provided is maintained as an IPv6 address space pool available to the PDU Session for DHCPv6 IPv6 prefix requests with the exclusion of the IPv6 prefix that is allocated to the PDU Session during PDU Session establishment as defined in clause 5.8.2.2.3. The total IPv6 address space available for the PDU Session (UE PDU Session prefix and UE PDU Session IPv6 address space pool) shall be possible to aggregate into one IPv6 prefix that will represent all IPv6 addresses that the UE may use.\nIf the UE had indicated that it supports prefix exclusion and the prefix to be delegated to the UE includes the /64 prefix that was allocated to the PDU Session, the SMF shall utilise the prefix exclusion feature as specified for DHCPv6 Prefix Delegation in IETF RFC 6603 [162].\nNOTE:\tSupport of the IPv6 prefix delegation in the SMF is assumed to be ensured by the operator e.g. by configuring specific DNN/S-NSSAI for PDU Sessions that are used by UEs that utilize IPv6 prefix delegation.\nThe UE uses DHCPv6 to request additional IPv6 prefixes (i.e. prefixes in addition to the default prefix) from the SMF after completing stateless IPv6 address autoconfiguration procedures. The UE acts as a \"Requesting Router\" as described in IETF RFC 8415 [163] and inserts one or more IA_PD option(s) into a DHCPv6 Solicit message sent from the UE to the SMF via the user plane and the UPF. The SMF acts as the DHCP server and fulfils the role of a \"Delegating Router\" according to IETF RFC 8415 [163]. The UE optionally includes the RAPID_COMMIT option in the DHCPv6 Solicit message to trigger two-message DHCPv6 procedure instead of the four-message DHCPv6 procedure. The UE shall include OPTION_PD_EXCLUDE option code in an OPTION_ORO option to indicate support for prefix exclusion. In response to the DHCPv6 Solicit message, the UE receives a DHCPv6 Reply message with one or more IA_PD prefix(es) for every IA_PD option that it sent in the DHCPv6 Solicit message. The SMF delegates a prefix excluding the default prefix with help of OPTION_PD_EXCLUDE. Prefix exclusion procedures shall follow IETF RFC 6603 [162].\nFor scenarios with RG connecting to 5GC, additional feature for IPv6 Prefix Delegation via DHCPv6 is defined in TS 23.316 [84].\nCN Tunnel Info is the Core Network address of a N3/N9 tunnel corresponding to the PDU Session. It comprises the TEID and the IP address which is used by the UPF on the N3/N9 tunnel for the PDU Session.\nThe CN Tunnel Info allocation and release is performed by the UPF. The SMF shall indicate to the UPF when the UPF is required to allocate/release CN Tunnel Info.\n\nThe UPF shall manage the CN Tunnel Info space. When a new CN Tunnel Info is needed, the SMF shall request over N4 the UPF to allocate CN Tunnel Info for the applicable N3/N9 reference point. In response, the UPF provides CN Tunnel Info to the SMF. In the case of PDU Session Release or a UPF is removed from the user plane path of an existing PDU Session, the SMF shall request UPF to release CN Tunnel Info for the PDU Session. If the corresponding N4 Session is released the UPF releases the associated CN Tunnel Info.\nThis clause describes the detection process at the UPF that identifies the packets belonging to a session, or a service data flow.\nThe SMF is responsible for instructing the UP function about how to detect user data traffic belonging to a Packet Detection Rule (PDR). The other parameters provided within a PDR describe how the UP function shall treat a packet that matches the detection information.\nThe SMF controls the traffic detection at the UP function by providing detection information for every PDR.\nFor IPv4 or IPv6 or IPv4v6 PDU Session type, detection information is a combination of:\n-\tCN tunnel info.\n-\tNetwork instance.\n-\tQFI.\n-\tIP Packet Filter Set as defined in clause 5.7.6.2.\n-\tApplication Identifier: The Application Identifier is an index to a set of application detection rules configured in UPF.\n-\tFQDN Filter for DNS Query message.\nFor Ethernet PDU Session type, detection information is a combination of:\n-\tCN tunnel info.\n-\tNetwork instance.\n-\tQFI.\n-\tEthernet Packet Filter Set as defined in clause 5.7.6.3.\nIn this Release of the specification for Unstructured PDU Session Type, the UPF does not perform-QoS Flow level traffic detection for QoS enforcement.\nTraffic detection information sent by the SMF to the UPF for a PDU Session may be associated with Network instance for detection and routing of traffic over N6. In the case of IP PDU Session Type, Network Instances can, e.g. be used by the UPF for traffic detection and routing in the case of different IP domains or overlapping IP addresses. In the case of Ethernet PDU Session Type, different Network Instances can e.g. be configured in the UPF with different ways to handle the association between N6 and the PDU Sessions.\nBased on SMF instructions, UPF may identify the PDU Sets, according to the Protocol Description in PDR, to derive the PDU Set Information for DL traffics and send it to RAN via DL GTP-U header of each PDU identified as belonging to a PDU Set. The PDU Set Information, is described in clause 5.37.5. The PDU Set identification can be done by UPF implementation or by detecting RTP/SRTP header or payload. The details of the RTP/SRTP headers, header extensions and/or payloads used to identify PDU Sets are defined in TS 26.522 [179].\nThe SMF controls user-plane packet forwarding for traffic detected by a PDR by providing a FAR with instructions to the UPF, including:\n-\tForwarding operation information;\n-\tForwarding target information.\nThe details of the forwarding target and operation will depend on the scenario and is described below. The following forwarding functionality is required by the UPF:\n-\tApply N3 /N9 tunnel related handling, i.e. encapsulation.\n-\tForward the traffic to/from the SMF, e.g. as described in Table 5.8.2.5.2-1.\n-\tForward the SM PDU DN Request Container from SMF to DN-AAA server\n-\tForward the traffic according to locally configured policy for traffic steering.\n-\tForward the traffic according to N4 rules of a 5G VN group for 5G VN group communication.\n-\tForward the traffic to/from the EASDF.\nData forwarding between the SMF and UPF is transmitted on the user plane tunnel established on N4 interface, defined in TS 29.244 [65].\nScenarios for data forwarding between the SMF and UPF are defined as below:\nTable 5.8.2.5.2-1: Scenarios for data forwarding between the SMF and UPF\n\nWhen configuring an UPF acting as PSA for an Ethernet PDU Session Type, the SMF may instruct the UPF to route the traffic based on detected MAC addresses as follows.\n-\tThe UPF learns the MAC address(es) connected via N6 based on the source MAC addresses of the DL traffic received on a N6 Network Instance.\n-\tThe UPF learns the MAC address(es) of UE(s) and devices connected behind, if any, based on the source MAC address contained within the UL traffic received on a PDU Session (N3/N9 interface).\n-\tThe UPF forwards DL unicast traffic (with a known destination address) on a PDU Session determined based on the source MAC address(es) used by the UE for the UL traffic.\n-\tThe UPF forwards UL unicast traffic (with a known destination address) on a port (PDU Session or N6 interface) determined based on the source MAC address(es) learned beforehand.\n-\tIn the case of multicast and broadcast traffic (if the destination MAC address is a broadcast or multicast address):\n-\tfor DL traffic received by UPF on a N6 Network Instance the UPF should forward the traffic to every DL PDU Session (corresponding to any N4 Session) associated with this Network Instance\n-\tfor uplink traffic received by UPF over a PDU session on a N3/N9 interface, the UPF should forward the traffic to the N6 interface and downlink to every PDU session (except toward the one of the incoming traffic) associated with the same N6 Network Instance\n-\tfor uplink and downlink unicast traffic received by UPF, if the destination MAC has not been learnt, the UPF should forward the traffic to every PDU session associated with the same N6 Network Instance and towards the N6 interface. In any case the traffic is not replicated on the PDU Session or the N6 interface of the incoming traffic.\nNOTE 1:\tThe UPF can consider a PDU Session or a N6 interface to be active or inactive in order to avoid forwarding loops. User data traffic is not sent on inactive PDU sessions or inactive N6 interface. This release of the specification does not further specify how the UPF determines whether a PDU Session or N6 interface is considered active or inactive.\nNOTE 2:\tThis release of the specification supports only a single N6 interface in a UPF associated with the N6 Network Instance.\n-\tif the traffic is received with a VLAN ID, the above criteria apply only towards the N6 interface or PDU session matching the same VLAN ID, unless the UPF is instructed to remove the VLAN ID in the incoming traffic.\nNOTE 3:\tThis release of the specification supports Independent VLAN Learning (IVL) and does not support Shared VLAN Learning (SVL), as described in IEEE Std 802.1Q [98].\n-\tif the destination MAC address of traffic refers to the same N6 interface or PDU session on which the traffic has been received, the frame shall be dropped.\nIn order to handle scenarios where a device behind a UE is moved from a source UE to a target UE, a MAC address is considered as no longer associated with a UPF interface (source UE's PDU session) when the MAC address has not been detected as Source MAC address in UL traffic for a pre-defined period of time or the MAC address has been detected under a different interface (target UE's PDU Session or N6).\nNOTE 4:\tThe UPF/NW-TT may also be provided with static filtering entries as described in clause 5.28.3. How the UPF uses the static filtering entry to achieve forwarding of Ethernet frames to one or more egress ports is up to UPF implementation. The externally observable behaviour of 5GS Bridge needs to comply with IEEE Std 802.1Q [98].\nFor ARP/IPv6 Neighbour Solicitation traffic, a SMF's request to respond to ARP/IPv6 Neighbour Solicitation based on local cache information or to redirect such traffic from the UPF to the SMF overrules the traffic forwarding rules described above.\nNOTE 5:\tLocal policies in UPF associated with the Network Instance can prevent local traffic switching in the UPF between PDU Sessions either for unicast traffic only or for any traffic. In the case where UPF policies prevent local traffic switching for any traffic (thus for broadcast/multicast traffic) some mechanism such as responding to ARP/ND based on local cache information or local multicast group handling is needed to ensure that upper layer protocol can run on the Ethernet PDU sessions.\nThe SMF may ask to get notified with the source MAC addresses used by the UE, e.g. if the PCF has subscribed to UE MAC address change notifications, as described in TS 23.503 [45].\nIn order to request the UPF to act as defined above, the SMF may, for each PDU Session corresponding to a Network Instance, set an Ethernet PDU Session Information in a DL PDR that identifies all (DL) Ethernet packets matching the PDU session. Alternatively, for unicast traffic the SMF may provide UPF with dedicated forwarding rules related with MAC addresses notified by the UPF.\nThe SMF shall support interfaces towards CHF and PCF. The SMF interacts with CHF and PCF based on information received from other control plane NFs and user plane related information received from the UPF.\nQoS Flow level, PDU Session level and subscriber related information remain at the SMF, and only usage information is requested from the UPF.\nTriggered by the PCC rules received from the PCF or preconfigured information available at SMF, as well as from the CHF for online charging method via quota management mechanisms, the SMF shall provide Usage Reporting Rules to the UPF for controlling how usage reporting is performed.\nThe SMF shall request the report of the relevant usage information for Usage Monitoring, based on Monitoring Keys and triggers which are specified in TS 23.503 [45]. Each Usage Reporting Rule requested for usage monitoring control is associated with the PDR(s) whose traffic is to be accounted under this rule. The SMF shall generate the Usage Reporting Rule for each Monitoring-key within the active PCC Rule(s), either preconfigured or received from the PCF and also shall keep the mapping between them. Multiple Usage Reporting Rules may be associated with the same PDR.\nThe SMF shall request the report of the relevant usage information for offline and online charging, based on Charging keys and additional triggers which are specified in TS 32.255 [68]. Each Usage Reporting Rule requested for offline or online charging is associated with the PDR(s) whose traffic is to be accounted under this rule. The SMF shall generate the Usage Reporting Rule for each Charging key and Sponsor Identity (if applicable) within the active PCC Rule(s), either preconfigured or received from the PCF, and also shall keep the mapping between them. Multiple Usage Reporting Rules may be associated with the same PDR.\nThe SMF function shall also provide reporting trigger events to the UPF for when to report usage information. The reporting trigger events (e.g. triggers, threshold information etc.) shall be supported for the PDU Session level reporting as well as on Rule level basis as determined by the SMF. The triggers may be provided as a volume, time or event to cater for the different charging/usage monitoring models supported by the TS 23.503 [45] for usage monitoring and by TS 32.255 [68] for converged offline and online charging. The SMF shall decide on the thresholds value(s) based on allowance received from PCF, CHF or based on local configuration. Other parameters for instructing the UPF to report usage information are defined in TS 29.244 [65].\nWhen the PCC Rule attribute Service Data flow handling while requesting credit (specified in TS 23.503 [45]) indicates \"non-blocking\", the SMF shall request the report of the relevant usage information for the Charging key and Sponsor Identity (if applicable) and provide a default threshold value to the UPF while waiting for the quota from the CHF.\nIn some cases, the same Usage Reporting Rule can be used for different purposes (for both usage monitoring and charging), e.g. in the case that the same set of PDR(s), measurement method, trigger event, threshold, etc. apply. Similarly a reported measurement can be used for different purposes by the SMF.\nThe UPF shall support reporting of usage information to the SMF. The UPF shall be capable to support reporting based on different triggers, including:\n-\tPeriodic reporting with period defined by the SMF.\n-\tUsage thresholds provided by the SMF.\n-\tReport on demand received from the SMF.\nThe SMF shall make sure that the multiple granularity levels required by the reporting keys in the Usage Reporting rules satisfy the following aggregation levels without requiring a knowledge of the granularity levels by the UPF:\n-\tPDU Session level reporting;\n-\tTraffic flow (for both charging and usage monitoring) level reporting as defined by the reporting keys in the Usage Reporting Rule (see the description above).\nBased on the mapping between Monitoring key and PCC rule stored at the SMF, the SMF shall combine the reported information with session and subscriber related information which is available at the SMF, for Usage Monitoring reporting over the corresponding Npcf interface (N7 reference point).\nBased on the mapping between Charging key and Sponsor Identity (if applicable) and PCC rule stored at the SMF, the SMF shall combine the reported information with session and subscriber related information which is available at the SMF, for offline and online charging reporting over the corresponding charging interfaces.\nThis functionality is specified in TS 32.255 [68].\nThe usage information shall be collected in the UPF and reported to the SMF as defined in 5.8.2.6, based on Monitoring Keys and triggers which are specified in TS 23.503 [45].\nARP is used for admission control (i.e. retention and pre-emption of the new QoS Flow). The value of ARP is not required to be provided to the UPF.\nFor every QoS Flow, the SMF shall determine the transport level packet marking value (e.g. the DSCP in the outer IP header) based on the 5QI, the Priority Level (if explicitly signalled) and optionally, the ARP priority level and provide the transport level packet marking value to the UPF.\nThe SMF shall provide the Session-AMBR values of the PDU Session to the UPF so that the UPF can enforce the Session-AMBR of the PDU Session across all Non-GBR QoS Flows of the PDU Session.\nSMF shall provide the GFBR and MFBR value for each GBR QoS Flow of the PDU Session to the UPF. SMF may also provide the Averaging window to the UPF, if Averaging window is not configured at the UPF or if it is different from the default value configured at the UPF.\nSMF may decide to activate ECN marking for L4S by PSA UPF for the QoS Flow (see clause 5.37). In this case, the SMF shall send an ECN marking for L4S indicator to UPF.\nA predefined PCC rule is configured in the SMF.\nThe traffic detection filters, e.g. IP Packet Filter, required in the UP function can be configured either in the SMF and provided to the UPF, as service data flow filter(s), or be configured in the UPF, as the application detection filter identified by an application identifier. For the latter case, the application identifier has to be configured in the SMF and the UPF.\nThe traffic steering policy information can be only configured in the UPF, together with traffic steering policy identifier(s), while the SMF has to be configured with the traffic steering policy identifier(s).\nPolicies for traffic handling in the UPF, which are referred by some identifiers corresponding to the parameters of a PCC rule, can be configured in the UPF. These traffic handling policies are configured as predefined QER(s), FAR(s) and URR(s).\nWhen a predefined PCC rule is activated/deactivated by the PCF, SMF shall decide what information has to be provided to the UPF to enforce the rule based on where the traffic detection filters (i.e. service data flow filter(s) or application detection filter), traffic steering policy information and the policies used for the traffic handling in the UPF are configured and where they are enforced:\n-\tIf the predefined PCC rule contains an application identifier for which corresponding application detection filters are configured in the UPF, the SMF shall provide a corresponding application identifier to the UPF;\n-\tIf the predefined PCC rule contains traffic steering policy identifier(s), the SMF shall provide a corresponding traffic steering policy identifier(s) to the UPF;\n-\tIf the predefined PCC rule contains service data flow filter(s), the SMF shall provide them to the UPF;\n-\tIf the predefined PCC rule contains some parameters for which corresponding policies for traffic handling in the UPF are configured in the UPF, the SMF shall activate those traffic handling policies via their rule ID(s).\nThe SMF shall maintain the mapping between a PCC rule received over Npcf and the flow level PDR rule(s) used on N4 interface.\nThe application detection filters required in the UPF can be configured either in the SMF and provided to the UPF as the service data flow filter, or be configured in the UP function identified by an application identifier.\nWhen receiving a dynamic PCC rule from the PCF which contains an application identifier and/or parameters for traffic handling in the UPF:\n-\tif the application detection filter is configured in the SMF, the SMF shall provide it in the service data flow filter to the UPF, as well as parameters for traffic handling in the UPF received from the dynamic PCC rule;\n-\totherwise, the application detection filters is configured in UPF, the SMF shall provide to UPF with the application identifier and the parameters for traffic handling in the UPF as required based on the dynamic PCC rule.\nThe SMF shall maintain the mapping between a PCC rule received over Npcf and the flow level PDR(s) used on N4 interface.\nThe uplink application's traffic redirection may be enforced either in the SMF (as specified in 5.8.2.5 Control of user plane forwarding) or directly in the UPF. The redirect destination may be provided in the dynamic PCC rule or be preconfigured, either in the SMF or in the UPF.\nWhen receiving redirect information (redirection enabled/disabled and redirect destination) within a dynamic PCC rule or being activated/deactivated by the PCF for the predefined redirection policies, SMF shall decide whether to provide and what information to be provided to the UPF based on where the redirection is enforced and where the redirect destination is acquired/preconfigured. When redirection is enforced in the UPF and the redirect destination is acquired from the dynamic PCC rule or is configured in the SMF, SMF shall provide the redirect destination to the UPF. When redirection is enforced in the SMF, SMF shall instruct the UPF to forward applicable user plane traffic to the SMF.\nThe NEF (PFDF) shall provide PFD(s) to the SMF on the request of SMF (pull mode) or on the request of PFD management from NEF (push mode), as described in TS 23.503 [45]. In addition, the NEF (PFDF) may subscribe to NWDAF to be notified or request to get PFD \"Determination analytics\" for known applications (as specified in TS 23.288 [86]) and may decide whether to create, update, or delete PFD(s) based on the NWDAF analytics as specified in TS 23.503 [45]. The SMF shall provide the PFD(s) to the UPF, which have active PDR(s) with the application identifier corresponding to the PFD(s).\nThe SMF supports the procedures in clause 4.4.3.5 of TS 23.502 [3], for management of PFDs. PFD(s) is cached in the SMF, and the SMF maintains a caching timer associated to the PFD(s). When the caching timer expires and there's no active PCC rule that refers to the corresponding application identifier, the SMF informs the UPF to remove the PFD(s) identified by the application identifier using the PFD management message.\nWhen a PDR is provided for an application identifier corresponding to the PFD(s) that are not already provided to the UPF, the SMF shall provide the PFD(s) to the UPF (if there are no PFD(s) cached, the SMF retrieves them from the NEF (PFDF) as specified in TS 23.503 [45]). When any update of the PFD(s) is received from NEF (PFDF) by SMF (using \"push\" or \"pull\" mode), and there are still active PDRs in UPF for the application identifier, the SMF shall provision the updated PFD set corresponding to the application identifier to the UPF using the PFD management message.\nNOTE 1:\tSMF can assure not to overload N4 signalling while managing PFD(s) to the UPF, e.g. forwarding the PFD(s) to the right UPF where the PFD(s) is enforced.\nWhen the UPF receives the updated PFD(s) from either the same or different SMF for the same application identifier, the latest received PFD(s) shall overwrite any existing PFD(s) stored in the UPF.\nNOTE 2:\tFor the case a single UPF is controlled by multiple SMFs, the conflict of PFD(s) corresponding to the same application identifier provided by different SMF can be avoided by operator enforcing a well-planned NEF (PFDF) and SMF/UPF deployment.\nWhen a PFD is removed/modified and this PFD was used to detect application traffic related to an application identifier in a PDR of an N4 session and the UPF has reported the application start to the SMF as defined in clause 4.4.2.2 of TS 23.502 [3] for the application instance corresponding to this PFD, the UPF shall report the application stop to the SMF for the corresponding application instance identifier if the removed/modified PFD in UPF results in that the stop of the application instance is not being able to be detected.\nIf the PFDs are managed by local O&M procedures, PFD retrieval is not used; otherwise, the PFDs retrieved from NEF (PFDF) override any PFDs pre-configured in the SMF. When all the PFDs retrieved from the NEF (PFDF) for an application identifier are removed, the pre-configured PFDs are used. The SMF shall provide either the PFDs retrieved from NEF (PFDF) or the pre-configured PFDs for an application identifier to the UPF.\nSending of \"end marker\" is a functionality which involve SMF and UPF in order to assist the reordering function in the Target RAN. As part of the functionality, constructing of end marker packets can either be done in the SMF or in the UPF, as described in clauses 5.8.2.9.1 and 5.8.2.9.2. Whether constructing of end marker packets is performed by SMF or UPF is determined by network configuration.\nIn the case of inter NG-RAN Handover procedure without UPF change, SMF shall indicate the UPF to switch the N3 path(s) by sending an N4 Session Modification Request message with the new AN Tunnel Info of NG RAN and in addition, provide an indication to the UPF to send the end marker packet(s) on the old N3 user plane path.\nOn receiving this indication, the UPF shall construct end marker packet(s) and send it for each N3 GTP-U tunnel towards the source NG RAN after sending the last PDU on the old path.\nIn the case of inter NG-RAN Handover procedure with change of the UPF terminating N3, the SMF shall request the UPF with N9 reference point to the UPF terminating N3 to switch the N9 user plane path(s) by sending an N4 Session Modification Request message (N4 session ID, new CN Tunnel Info of the UPF terminating N3) and in addition, provide an indication to this UPF to send the end marker packet(s) on the old path.\nOn receiving this indication, the UPF shall construct end marker packet(s) and send it for each N9 GTP-U tunnel towards the source UPF after sending the last PDU on the old path.\nOn receiving the end marker packet(s) on N9 GTP-U tunnel, source UPF shall forward the end marker packet(s) and send it for each N3 GTP-U tunnel towards the source NG RAN.\nUPF referred in this clause is the UPF terminates N3 reference point.\nIt is assumed that the PDU Session for the UE comprises of an UPF that acts as a PDU Session Anchor and an intermediate UPF terminating N3 reference point at the time of this Handover procedure.\nIn the case of inter NG-RAN Handover procedure without UPF change, SMF shall indicate the UPF to switch the N3 path(s) by sending an N4 Session Modification Request message (N4 session ID, new AN Tunnel Info of NG RAN). After sending the last PDU on the old path, UPF shall replace the old AN Tunnel Info with the new one and responds with an N4 Session Modification Response message to acknowledge the success of path switch.\nWhen the path switch is finished, SMF constructs the end marker packet(s) and sends it to the UPF. UPF then forwards the packet(s) to the source NG RAN.\nIn the case of inter NG-RAN Handover procedure with UPF change, SMF shall indicate the PSA UPF to switch the N9 user plane path(s) by sending an N4 Session Modification Request message (N4 session ID, new CN Tunnel Info of UPF). After sending the last PDU on the old N9 path, PSA UPF shall replace the old CN Tunnel Info with the new one and responds with an N4 Session Modification Response message to acknowledge the success of path switch.\nWhen the path switch is finished, SMF constructs the end marker packet(s) and sends it to PSA UPF. PSA UPF then forwards the packet(s) to the source UPF.\n5GC shall support per PDU Session tunnelling on N3 between (R)AN and UPF and N9 between UPFs. If there exist more than one UPF involved for the PDU Session, any tunnel(s) between UPFs (e.g. in the case of two UPFs, between the UPF that is an N3 terminating point and the UPF for PDU Session Anchor) remains established when a UE enters CM-IDLE state. In the case of downlink data buffering by UPF, when mobile terminated (MT) traffic arrives at the PDU Session Anchor UPF, it is forwarded to the UPF which buffer the data packet via N9 tunnel. See clause 5.8.3 for more details on UPF buffering. In the case of Home Routed roaming, the SMF in HPLMN is not aware of the UP activation state of a PDU Session.\nWhen the UP connection of the PDU Session is deactivated, the SMF may release the UPF of N3 terminating point. In that case the UPF (e.g. the Branching Point/UL CL or PDU Session Anchor) connecting to the released UPF of N3 terminating point will buffer the DL packets. Otherwise, when the UPF with the N3 connection is not released, this UPF will buffer the DL packets.\nWhen the UP connection of the PDU Session is activated due to a down-link data arrived and a new UPF is allocated to terminate the N3 connection, a data forwarding tunnel between the UPF that has buffered packets and the newly allocated UPF is established, so that the buffered data packets are transferred from the old UPF that has buffered packets to the newly allocated UPF via the data forwarding tunnel.\nFor a PDU Session whose the UP connection is deactivated and the SMF has subscribed the location change notification, when the SMF is notified of UE's new location from the AMF and detects that the UE has moved out of the service area of the existing intermediate UPF, the SMF may decide to maintain the intermediate UPF, remove the established tunnel between UPFs (in the case of removal of the intermediate UPF) or reallocate the tunnel between UPFs (in the case of reallocation of the intermediate UPF).\nThe parameters used by SMF to control the functionality of the UPF as well as to inform SMF about events occurring at the UPF are described in clause 5.8.5.\nFor Ethernet PDU Session type, the SMF may control the UPF to report the different MAC (Ethernet) addresses used as source address of frames sent UL by the UE in a PDU Session. These MAC addresses are called UE MAC addresses.\nThis control and the corresponding reporting takes place over N4.\nNOTE:\tThis is e.g. used to support reporting of all UE MAC addresses in a PDU Session to the PCF as described in clause 5.6.10.2.\nThe UPF reports the removal of a UE MAC address based on the detection of absence of traffic during an inactivity time. The inactivity time value is provided by the SMF to the UPF.\nThe SMF may configure the UPF(s) to apply different traffic forwarding methods to route traffic between PDU Sessions for a single 5G VN group. For example, depending on the destination address, some packet flows may be forwarded locally, while other packet flows are forwarded via N19 and other packet flows are forwarded to N6.\nIf a single SMF serves the DNN/S-NSSAI of the 5G VN group, the UPF local switching, N6-based forwarding and N19-based forwarding methods described in clause 5.29.4 are coordinated by the SMF. If an SMF set serves the DNN/S-NSSAI of the 5G VN group, implementation based mechanisms can be used between SMF(s) that are part of the SMF set for controlling the connectivity between the PSA UPFs of the UE members of the 5G VN group.\nWhen a 5G VN group communication is extended in a wide area, bigger than the service area of any SMF set serving the DNN/S-NSSAI of the 5G VN group, multiple SMF sets might control the PDU Sessions of the UE members of the 5G VN group. In this case, N6/N19 connectivity between PSA UPFs of the UE members of the 5G VN group controlled by different SMF sets, is achieved via OAM configuration. As a deployment option, a subset of the UPFs controlled by an SMF Set may be configured with the N6/N19 connectivity to enable 5G VN group communication across SMF Sets. N6 connectivity between PSA UPFs via a DN may also exist.\n5G VN group communication includes one to one communication and one to many communication. One to one communication supports forwarding of unicast traffic between two UEs within a 5G VN, or between a UE and a device on the DN. One to many communication supports forwarding of multicast traffic and broadcast traffic from one UE (or device on the DN) to many/all UEs within a 5G VN and devices on the DN.\nTraffic forwarding within the 5G VN group is realized by using a UPF internal interface (\"5G VN internal\") and a two-step detection and forwarding process. In the first step, the packets received from any 5G VN group member (via it's PDU Session, via N6 or via N19) are forwarded to the UPF internal interface (i.e. Destination Interface set to \"5G VN internal\"). In the second step, PDRs installed at the UPF internal interface (i.e. Source Interface set to \"5G VN internal\") detect the packet and forward it to the respective 5G VN group member (via it's PDU Session, via N6 or via N19). The details of the PDR and FAR configuration are described in the following clauses.\nFor UEs belonging to the same 5G VN group and having PDU Sessions that correspond to N4 Sessions in the same PSA UPF, the following applies for traffic that is sent from one of these UEs to another one of these UEs using local switching: The incoming traffic for one PDU Session will match the corresponding N4 Session's PDR(s) of the source PDU Session (based on GTP-U header information). The traffic is then sent back to classification in that UPF (via the internal interface) and will match another N4 Session corresponding to the destination PDU Session (based on destination address in the PDU). The PDU is then forwarded to the target UE.\nIf 5G VN group members' PDU Sessions are served by different PSA UPFs and N19-based forwarding is applied, the SMF creates a group-level N4 Session with each involved UPF to enable N19-based forwarding and N6-based forwarding. When the traffic is then sent back to classification in that UPF (via the internal interface) it may match group-level N4 Session corresponding to the 5G VN group (based on destination address in the PDU or a default PDR rule with match-all packet filter). The PDU is then forwarded to N6 or to the UPF indicated in the group-level N4 Session via corresponding N19 tunnel. This enables the PDU to be sent to the target group member in the other UPF or to the device in the DN.\nIn the case of N19-based forwarding is not applied for a 5G VN group, group level N4 session is not required.\nIf more than one 5G VN group has to be supported in the PLMN, the N4 rule attribute Network Instance is used in addition to the UPF internal interface and set to a value representing the 5G VN group. This keeps the traffic of different 5G VN groups separate from each other and thus enables isolation of the 5G VN group communication during the packet detection and forwarding process. The SMF shall provide the PDRs and FARs related to the UPF internal interface as follows whenever more than one 5G VN group has to be supported in the PLMN:\n-\tThe FAR with Destination Interface set to \"5G VN internal\" shall also contain the Network Instance set to the value representing the 5G VN group.\n-\tThe PDR with Source Interface set to \"5G VN internal\" shall also contain the Network Instance set to the value representing the 5G VN group.\nForwarding Ethernet unicast traffic towards the PDU Session corresponding to the Destination MAC address of an Ethernet frame may correspond:\n-\teither to the SMF explicitly configuring DL PDR(s) with the MAC addresses detected by the UPF on PDU Sessions and reported to the SMF; this is further described in clause 5.8.2.13.1;\n-\tor to the SMF relying on MAC address learning in UPF as defined in clause 5.8.2.5.3. To request this UPF behaviour the SMF sets the Ethernet PDU Session Information indication in the DL PDR of the \"5G VN internal\" interface related with a 5G VN group. This may apply in the case that all PDU Sessions related with this 5G VN group are served by the same PSA or by multiple PSAs not inter-connected via N19.\nFor Ethernet traffic on 5G-VN, in the former case above where SMF explicitly configures DL PDR with the MAC addresses detected on PDU Sessions supporting a 5G VN group, the SMF acts as a central controller which is responsible for setting up the forwarding rules in the UPFs so that it avoids forwarding loops. The SMF becomes aware of the MAC addresses in use within a 5G VN group by the UPF's reporting of the MAC addresses. The SMF is responsible to react to topology changes in the Ethernet network. Local switching without SMF involvement is not specified for a 5G-VN when different PDU Sessions related with this 5G VN group may be served by different PSA(s) connected over N19.\nNOTE:\tThe mechanisms described above implies signalling on N4 Sessions related with a VN group each time a new MAC address is detected as used (or no more used) within a PDU Session related with this 5G VN group. Hence the usage of the solution with SMF explicitly configuring DL PDR with the MAC addresses defined in this release can raise signalling scalability issues for large VN groups with lots of devices (MAC addresses) served by PDU sessions related with this VN group.\nTo enable unicast traffic forwarding in a UPF, the following applies:\n-\tThe SMF provides for each 5G VN group member's N4 Session (i.e. N4 Session corresponding to PDU Session) the following N4 rules that enable the processing of packets received from this UE.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"access side\", and CN Tunnel Information set to PDU Session tunnel header (i.e. N3 or N9 GTP-U F-TEID); and\n-\tin order to forward the traffic, a FAR containing Destination Interface set to \"5G VN internal\".\n-\tThe SMF provides for each 5G VN group member's N4 Session (i.e. N4 session corresponding to PDU Session) the following N4 rules that enable the processing of packets towards this UE.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", and Destination Address set to the IP/MAC address (es) of this 5G VN group member; and\n-\tin order to forward the traffic, a FAR containing Outer Header Creation indicating the N3/N9 tunnel information, and Destination Interface set \"access side\".\n-\tIf N19-based forwarding is applied, the SMF configures the group-level N4 Session for processing packets received from a N19 tunnel with the following N4 rules for each N19 tunnel.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"core side\", and CN Tunnel Information set to N19 tunnel header (i.e. N19 GTP-U F-TEID); and\n-\tin order to forward the traffic, a FAR containing Destination Interface set to \"5G VN internal\".\n-\tIf N19-based forwarding is applied, the SMF configures the group-level N4 Session for processing packets towards 5G VN group members anchored at other UPFs with the following N4 rules for each N19 tunnel.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", and Destination Address set to the IP/MAC address (es) of UEs anchored at the peer UPF of this N19 tunnel (e.g. based on the IP address range supported by the peer UPF); and\n-\tin order to forward the traffic to a 5G VN group member anchored at another UPF via the N19 tunnel, a FAR containing Outer Header Creation indicating the N19 tunnel information, Destination Interface set to \"core side\".\n-\tThe SMF configures the group-level N4 Session for processing packets received from a 5G VN group member connected via N6 with the following N4 rules.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"core side\", and Source Address set to the IP/MAC address (es) of this 5G VN group member; and\n-\tin order to forward the traffic, a FAR containing Destination Interface set to \"5G VN internal\".\n-\tThe SMF configures the group-level N4 Session for processing packets towards a 5G VN group member connected via N6 or packets towards a device residing in DN with the following N4 rules.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", and Destination Address set to the IP/MAC address (es) of this 5G VN group member; and\n-\tin order to forward the traffic to the 5G VN group member or device via N6, a FAR containing Destination Interface set to \"core side\".\n-\tThe SMF shall update N4 rules for group-level N4 Session to enable correct forwarding of packets towards UE who's PSA UPF has been reallocated and address is unchanged.\n-\tThe SMF may also configure the following N4 rules for the group-level N4 Session to process packets with an unknown destination address:\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", a match-all Packet Filter, and a Precedence set to the lowest precedence value; and\n-\tin order to process the traffic, a FAR containing Destination Interface set to \"core side\" to route the traffic via N6 by default, or in the case of local SMF configuration that N6-based forwarding is not applied a FAR instructing the UPF to drop the traffic.\nTo enable the service continuity when the PSA UPF serving the UE changed, the following applies:\n-\tKeep the UE address unchanged if N6-based forwarding is not used.\n-\tConfigure the UE's N4 Session with N4 rules (PDR, FAR) to detect and forward the traffic to this UE via its PDU Session tunnel(i.e. N3 tunnel) on the target PSA UPF.\n-\tIf N19-based forwarding is applied: To switch the traffic towards this UE from the source PSA UPF to the target PSA UPF for N19-based forwarding, the SMF deletes the N4 rule (PDR) that detects the traffic towards this UE in the group-level N4 Session at UPFs involved in the 5G VN group (except the source PSA UPF), then adds or updates the PDR that detects the traffic towards this UE with the FAR containing the N19 tunnel information of the target PSA UPF in the group-level N4 Session at UPFs involved in the 5G VN group (except the target PSA UPF).\n5.8.2.13.3.1\tUser plane traffic replication based on UPF internal functionality\nFor Ethernet PDU Sessions, the SMF may instruct the UPF to route traffic to be replicated as described in clause 5.8.2.5.\nFor IP PDU Session types, the SMF may instruct the UPF to manage IP multicast traffic as described in clauses 4.6.6 and 7.7.1 of TS 23.316 [84]. The UPF replicates the IP multicast traffic received from PDU Sessions or N6 interface and sends the packets over other PDU Sessions and other N6 interface subscribed to the IP Multicast groups.\nMechanisms described in clauses 4.6.6 and 7.7.1 of TS 23.316 [84] apply to support 5G VN group communication with following clarifications:\n-\tThese mechanisms are not limited to Wireline access and can apply on any access,\n-\tIP Multicast traffic allowed for a PDU Session is not meant for IPTV services reachable over N6,\n-\tIGMP /MLD signalling does not relate with STB or 5G-RG: Clauses 4.6.6 and 7.7.1 of TS 23.316 [84], apply to UE members of a 5G VN group instead of 5G-RG, and\n-\tClauses 7.7.1.1.2 and 7.7.1.1.4 of TS 23.316 [84] are not applicable to 5G VN groups: members of the 5G VN groups may receive any multicast traffic associated with the (DNN, S-NSSAI) of the 5G VN group.\n-\tUPF exchange of signalling such as PIM (Protocol-Independent Multicast) may apply as defined in TS 23.316, with following clarification:\n-\tPIM signalling is generally exchanged over N6 but may be sent towards the PDU Session supporting the source address of multicast traffic identified by IGMP / MLD signalling for Source Specific Multicast. In the case of IGMP / MLD signalling not related with Source Specific Multicast no PIM signalling is sent towards any PDU Session\n5.8.2.13.3.2\tUser plane traffic replication based on PDRs with replication instructions\nAlternatively, for IP or Ethernet type data communication, the SMF instructs the UPF via PDRs and FARs how to replicate user plane traffic.\nThe mechanism is supported in the following conditions:\n-\tWhen N19 is used, there is a full mesh of N19 tunnels between UPFs controlled by each SMF Set serving the 5G VN group;\n-\tThere is no support for forwarding a broadcast/multicast packet with source address not known to SMF/UPF.\n-\tEach UPF supports one N6 interface instance towards the data network, or only supports N19-based forwarding without N6;\n-\tMulticast group formation of selected members of a 5G VN for Ethernet type data communication is not described in this release of the specification.\nIn this case, when the UPF receives a broadcast packet of a 5G VN group from N19 or N6, it shall distribute it to all 5G VN group members connected to this UPF. When the UPF receives a broadcast packet from a UE (source UE) via PDU Session associated with a 5G VN group, it shall distribute it to:\n-\tAll 5G VN group members (except the source UE) connected to this UPF via local switch; and\n-\tAll 5G VN group members connected to other UPFs via N19-based forwarding or N6-based forwarding; and\n-\tThe devices on the DN via N6-based forwarding.\nTo enable broadcast traffic forwarding of a 5G VN group in a UPF, the following applies:\n-\tThe SMF provides group-level N4 Session and each 5G VN group member' N4 Session with the PDR that detect the broadcast packet sent via \"internal interface\". When UPF receives the broadcast packets sent via \"internal interface\", it matches the broadcast packet against all PDRs installed at the \"internal interface\". A successful matching with a PDR that detect the broadcast packet instructs the UPF to continue the lookup of the other PDRs. A matching PDR that detects the broadcast packet shall instruct the UPF to duplicate the broadcast packet and perform processing (using associated FAR, URR, QER) on the copy instead of the original packet if the broadcast packet does not satisfy the packet replication skip information, otherwise the PDR instructs the UPF to skip the processing of the broadcast packet.\n-\tThe broadcast packets received from N19 or N6 are forwarded to the UPF internal interface together with a N19 or N6 indication.\n-\tThe SMF provides for each 5G VN group member' N4 Session (i.e. N4 session corresponding to PDU Session) the following N4 rules that enable the processing of broadcast packets towards this UE.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", Destination Address set to the broadcast address, the Packet replication skip information set to the IP/MAC address (es) of this 5G VN group member, and the indication to carry on matching; and\n-\tin order to forward the traffic, a FAR containing Outer Header Creation indicating the PDU Session tunnel information, and Destination Interface set \"access side\".\n-\tThe SMF configures the group-level N4 Session for processing packets received from a N19 tunnel with the following N4 rules for each N19 tunnel.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"core side\", Destination Address set to the broadcast address, and CN Tunnel Information set to N19 tunnel header (i.e. N19 GTP-U TEID); and\n-\tin order to forward the traffic, a FAR containing Destination Interface set to \"5G VN internal\", Outer Header Creation with the N19 indication.\n-\tThe SMF provides for the group-level N4 Session the following N4 rules that enable the processing of broadcast packets towards the other UPFs.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\", Destination Address set to the broadcast address, the Packet replication skip information set to the N19 indication, and the indication to carry on matching; and\n-\tin order to forward the traffic to each involved UPF via the corresponding N19 tunnel, a FAR containing \"Duplication\" instruction, Outer Header Creation indicating the N19 tunnel information, Destination Interface set to \"core side\".\n-\tThe SMF configures the group-level N4 Session for processing packets received from N6 with the following N4 rules.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"core side\", and Destination Address set to the broadcast address; and\n-\tin order to forward the traffic, a FAR containing Destination Interface set to \"5G VN internal\", Outer Header Creation with the N6 indication.\n-\tThe SMF provides for the group-level N4 Session the following N4 rules that enable the processing of broadcast packets towards N6.\n-\tin order to detect the traffic, a PDR containing Source Interface set to \"5G VN internal\" and Destination Address set to the broadcast address and the Packet replication skip information set to the N6 indication; and\n-\tin order to forward the traffic to N6, a FAR containing Destination Interface set to \"core side\".\nIn this case, to enable multicast traffic forwarding of a 5G VN group in a UPF, broadcast traffic forwarding of a 5G VN applies to multicast traffic forwarding of a 5G VN with the following modifications:\n-\tThe SMF installs PDRs for the multicast address instead of the broadcast address.\n-\tThe PDRs and FARs are installed for PDU Sessions corresponding to the members of the multicast group.\n-\tIn addition, the SMF installs the PDR identifying IGMP/MLD signalling for each 5G VN group member' N4 Session and a URR with a Reporting Trigger set to \"IGMP reporting\" for IGMP or set to \"MLD reporting\" for MLD. Based on the IP Multicast address in \"IP multicast join\" or \"IP multicast leave\" reports received from UPF, the SMF manipulates (delete or add) the PDR identifying the multicast traffic for the reported IP Multicast address at the corresponding 5G VN group member' N4 Session, and if required at the group-level N4 Session at the UPF(s) of the 5G VN group.\nOperators can deploy UPF(s) supporting the Inter PLMN User Plane Security (IPUPS) functionality at the border of their network to protect their networks from invalid inter PLMN N9 traffic.\nThe IPUPS functionality forwards GTP-U packets (received via the N9 interface) only if they belong to an active PDU Session and are not malformed, as described in TS 33.501 [29].\nThe SMF can activate the IPUPS functionality together with other UP functionality in the same UPF, or insert a separate UPF in the UP path for the IPUPS functionality. In both cases the UPF with IPUPS functionality is controlled by the SMF via the N4 interface.\n\nIf requested by the SMF during N4 Session Establishment, the UPF (PSA) may setup L2TP towards an L2TP network server (LNS) in the DN and tunnel the PDU Session user plane traffic in this L2TP tunnel. In this case the UPF acts as a L2TP access concentrator (LAC).\nTo enable this, the SMF may provide L2TP information to the UPF, such as LNS IP address and/or LNS host name, as described in TS 29.244 [65]. This L2TP information may be configured on the SMF as part of the DNN configuration or received from the DN-AAA Server during secondary authentication/authorization, as described in clause 5.6.6. Alternatively, the L2TP tunnel parameters may be configured in the UPF Function. The L2TP tunnel parameters include necessary parameters for setting up L2TP tunnel towards the LNS (e.g. LNS address, tunnel password, etc.).\nIn addition, the SMF may provide PAP/CHAP authentication information to the UPF, for use in L2TP session establishment, in case it was received from the UE in the PDU Session Establishment Request.\nWhen L2TP is to be used for a PDU Session, the SMF may select a UPF based upon support of this feature. The SMF determines whether the UPF supports this feature via N4 capability negotiation during N4 Association Setup or via NRF discovery.\nIf SMF requests the UPF to allocate UE IP address, as described in clause 5.8.2.2.1, the UPF (LAC) may retrieve this IP address from the LNS. In addition, if the SMF requests the UPF to provide DNS address(es), the UPF (LAC) may request the LNS to provide DNS address(es) and report such DNS address(es) to the SMF.\nThe UPF may expose information by means of UPF Event Exposure service as described in TS 23.502 [3] clause 5.2.26.2, via a service-based interface directly. The NF consumers, which may receive UPF event notifications, are AF/NEF, TSNAF/TSCTSF and NWDAF/DCCF/MFAF.\nWhen the UPF supports the data exposure via the service based interface, it may register its NF profile to the NRF including the UPF Event Exposure services and the related Event ID(s).\nFor data collection from UPF (see clause 4.15.4.5 of TS 23.502 [3]), NF consumers do the subscription to the UPF directly or indirectly via SMF. A n NF consumer may subscribe to the UPF Event Exposure service directly only for data collected for \"any UE\" e.g. to collect user data usage information for NWDAF NF Load analytic (see clause 6.5 of TS 23.288 [86]) and if the subscription is not including any of the following parameters: AoI, traffic filtering, BSSID/SSID and Application ID.\nTo alleviate the load of UPF due to frequent event notification, the event subscription may include Reporting suggestion information. The Reporting suggestion information includes Report urgency and Reporting window information. Reporting urgency information represents whether this event report can be delay tolerant, i.e. the event report can be delayed. If the Reporting urgency information indicates \"delay tolerant\", the Reporting window is also provided, which defines the last valid reporting time, and UPF shall report the detected event before the last valid time. Per Reporting suggestion information UPF can concatenate several notification messages to the same notification endpoint in one notification message.\nThe UPF may also expose UE information by means of the Nupf_GetUEPrivateIPaddrAndIdentifiers service as described in TS 23.502 [3] clause 5.2.26.3. An UPF which is deployed with NAPT (Network Address Port Translation) functionality may support to provide the 5GC UE IP address to NEF based on NEF request containing public IP address and port number using the Nupf_GetUEPrivateIPaddrAndIdentifiers service as described in clause 4.15.10 of TS 23.502 [3] for AF specific UE ID retrieval.\nThe SMF may configure the UPF to perform QoS monitoring for a QoS Flow and to report the monitoring results with the help of the following parameters provided in the Session Reporting Rule (SRR) described in clause 5.8.5.11:\n-\tQoS monitoring parameter(s) indicating the subject of the QoS monitoring as defined in clause 5.45;\n-\tReporting period indicating the time interval in which a new measurement result and a potential report has to be available. Generally, if no measurement result is available to the UPF within the Reporting period, the UPF shall report a measurement failure; however, for some QoS monitoring parameters (e.g. congestion information, PDV and data rate), the measurement failure report is not applicable.\n-\tReporting frequency indicating the type of the reporting as \"periodic\" or \"event triggered\":\n-\tIf the Reporting frequency indicates \"periodic\", the UPF shall send a report each time the reporting period is over.\n-\tIf the Reporting frequency indicates \"event triggered\", a Reporting threshold for each parameter in the QoS monitoring parameter(s) and a Minimum waiting time are provided as well. The UPF shall send a report when the measurement result matches or exceeds the indicated Reporting threshold. Subsequent reports shall not be sent by the UPF during the Minimum waiting time. If measurement results are received during the Minimum waiting time, the UPF shall report the minimum and the maximum measurement result when the Minimum waiting time is over.\n-\t(Optional) Target of the reporting and Indication of direct event notification indicating that the UPF shall send the reports to a different NF than the SMF (e.g. to the NEF/AF or the NWDAF/DCCF/MFAF). The NF is identified by a Notification Target Address and a Notification Correlation ID. The SMF can also indicate that the UPF shall send the reports to both, the NF indicated by the Target of reporting and to the SMF. If so, the UPF shall send the reports to the SMF as well. If the Indication of direct event notification is not provided, the UPF shall send the reports to the SMF.\n-\t(Optional) Reporting suggestion information as defined in clause 5.8.2.17 applicable to Target of the reporting to reduce the UPF performance impacts.\n-\t(Optional) Indication of QoS Flow associated with the default QoS Rule (see clause 4.15.4.5.1 of TS 23.502 [3]). The UPF shall forward this indication, that the QoS monitoring report is for the QoS Flow associated with the default QoS Rule, in the Nupf_EventExposure_Notify service operation when sending reports.\nThe UPF shall send the QoS Monitoring Report as follows:\n-\twhen the UPF sends reports to the SMF, the UPF shall use QoS Monitoring Reports as described in clause 5.8.5.12; and/or\n-\tWhen the UPF sends reports to a different NF than the SMF (e.g. the NEF/AF or the NWDAF/DCCF/MFAF), the UPF shall use the Nupf_EventExposure_Notify service operation described in clause 5.2.26.2.2 of TS 23.502 [3].\n5GC supports buffering of UE's downlink packets for deactivated PDU Sessions.\nSupport for buffering in the UPF is mandatory and optional in the SMF.\nWhen the UP connection of a PDU Session is deactivated, buffering in UPF can be activated by the SMF. If the SMF supports buffering capability, the SMF can decide to activate buffering in SMF instead of buffering in UPF.\nWhen the SMF decided to activate buffering in UPF, the SMF shall inform the UPF to start buffering packets for this PDU Session.\nThe SMF provides instructions to the UPF for at least the following behaviour:\n-\tbuffer downlink packets with the following additional options:\n-\treporting the arrival of first downlink packet (for a QoS Flow or a service data flow), and/or\n-\treporting the first discarded downlink packet (for a service data flow), or\n-\tdrop downlink packets with the following additional options:\n-\treporting the first discarded downlink packet (for a service data flow).\n-\tbuffer uplink packets.\nWhen the SMF instructs the UPF for a service data flow to buffer downlink packets and to report the first discarded downlink packet, the SMF shall also instruct the UPF to report the arrival of the first downlink packet for this service data flow to enable the SMF check if this is also the first report for the QoS Flow (as described below).\nBuffering in the UPF may be configured based on timers or the amount of downlink data to be buffered. The SMF decides whether buffering timers or amount of downlink data are handled by the UPF or SMF.\nAfter starting buffering, when the first downlink packet (of a QoS Flow or a service data flow) arrives, UPF shall inform the SMF if it is setup to report. UPF sends a Downlink Data Report to the SMF via N4 unless specified otherwise and indicates the PDR by which the downlink packet was received. If the SMF receives a Downlink Data Report for a service data flow, the SMF shall also check if this is the first report for the QoS Flow corresponding to the PDR. If so, the SMF shall also proceed as described in clause 5.4.3.1.\nAfter starting buffering, when the first downlink packet (of a service data flow) in a configured period of time that has been buffered is discarded by the UPF because the configured buffering time or amount of downlink data to be buffered is exceeded, the UPF shall inform the SMF if it is setup to report. UPF sends a Downlink Data Report to the SMF via N4 and indicates the PDR by which the discarded downlink packet was received.\nA new report is sent if the SMF terminates and subsequently re-activates the buffering action at the UPF and the UPF again receives downlink packets.\nNOTE:\tFor the notification about the downlink data delivery status \"buffered\" or \"discarded\" related to packets from a particular AF as part of the Nsmf_EventExposure service, it is expected that a PDR with a traffic filter identifying that AF as source and a Forwarding Action rule with action \"buffer\" is installed.\nWhen the UP connection of the PDU Session is activated, the SMF updates the UPF of the change in buffering state. The buffered downlink packets, if any, are then forwarded to the (R)AN by the UPF.\nIf the UP connection of the PDU Session has been deactivated for a long time, the SMF may indicate the UPF to stop buffering for this PDU Session.\nThe SMF may indicate to the UPF to start or stop the buffering of uplink packets of an application associated to the PCC rule as described in clause 6.3.5 of TS 23.548 [130]. When the buffering of uplink packets is stopped the UPF shall forward all buffered uplink packets before it forwards any new uplink packets.\nWhen the SMF supports buffering capability and the SMF decided to activate buffering in SMF for the PDU Session, the SMF shall inform the UPF to start forwarding the downlink packets towards the SMF.\nWhen the UP connection of the PDU Session is activated, if there are buffered downlink packets available and their buffering duration has not expired, the SMF shall forward those packets to the UPF to relay them to the UE. These packets are then forwarded by the UPF to the (R)AN.\nThe SMF Pause of Charging functionality is supported with the purpose that the charging and usage monitoring data in the core network more accurately reflects the downlink traffic actually sent to the (R)AN. When the amount of downlink data incoming at the UPF for a PDU Session that is in deactivated state goes above a pre-configured threshold, the pause of charging functionality ensures that data that dropped in the core network is not included in charging and usage monitoring records.\nThe procedures for SMF Pause of Charging are described in TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.8.2.5.2-1: Scenarios for data forwarding between the SMF and UPF",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.8.3\tExplicit Buffer Management (moved)",
                            "text_content": "The Explicit Buffer Management is described in clause 5.8.2.19.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.4\tSMF Pause of Charging (moved)",
                            "text_content": "The SMF Pause of Charging is described in clause 5.8.2.20.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.8.5\tParameters for N4 session management",
                            "text_content": "These parameters are used by SMF to control the functionality of the UPF as well as to inform SMF about events occurring at the UPF.\nThe N4 session management procedures defined in clause 4.4.1 of TS 23.502 [3] will use the relevant parameters in the same way for all N4 reference points: the N4 Session Establishment procedure as well as the N4 Session Modification procedure provide the control parameters to the UPF, the N4 Session Release procedure removes all control parameters related to an N4 session, and the N4 Session Level Reporting procedure informs the SMF about events related to the PDU Session that are detected by the UPF.\nThe parameters over N4 reference point provided from SMF to UPF comprises an N4 Session ID and may also contain:\n-\tPacket Detection Rules (PDR) that contain information to classify traffic (PDU(s)) arriving at the UPF;\n-\tForwarding Action Rules (FAR) that contain information on whether forwarding, dropping or buffering is to be applied to a traffic identified by PDR(s);\n-\tMulti-Access Rules (MAR) that contain information on how to handle traffic steering, switching and splitting for a MA PDU Session;\n-\tUsage Reporting Rules (URR) contains information that defines how traffic identified by PDR(s) shall be accounted as well as how a certain measurement shall be reported;\n-\tQoS Enforcement Rules (QER), that contain information related to QoS enforcement of traffic identified by PDR(s);\n-\tSession Reporting Rules (SRR) that contain information to request the UP function to detect and report events for a PDU session that are not related to specific PDRs of the PDU session or that are not related to traffic usage measurement.\n-\tTrace Requirements;\n-\tPort Management Information Container in 5GS;\n-\tBridge/Router Information.\nThe N4 Session ID is assigned by the SMF and uniquely identifies an N4 session.\nIf the UPF indicated support of Trace, the SMF may activate a trace session during a N4 Session Establishment or a N4 Session Modification procedure. In that case it provides Trace Requirements to the UPF. The SMF may deactivate an on-going trace session using a N4 Session Modification procedure. There shall be at most one trace session activated per N4 Session at a time.\nFor the MA PDU Session, the SMF may add an additional access tunnel information during an N4 Session Modification procedure by updating MAR with addition of an FAR ID which refers to an FAR containing the additional access tunnel information for the MA PDU session for traffic steering in the UPF. For the MA PDU Session, the SMF may request Access Availability report per N4 Session, during N4 Session Establishment procedure or N4 Session Modification procedure.\nA N4 Session may be used to control both UPF and NW-TT behaviour in the UPF. A N4 session support and enable exchange of bridge/router configuration between the SMF and the UPF:\n-\tInformation that the SMF needs for bridge/router management (clause 5.8.5.9);\n-\tInformation that 5GS transparently relays between the TSN AF or TSCTSF and the NW-TT: transparent Port Management Information Container along with the associated NW-TT port number.\n-\tInformation that 5GS transparently relays between the TSN AF or TSCTSF and the NW-TT: transparent user plane node Management Information Container (clause 5.8.5.14).\nWhen a N4 Session related with bridge/router management is established, the UPF allocates a dedicated port number for the PDU Session. The UPF then provides to the SMF following configuration parameters for the N4 Session:\n-\tport number.\n-\tuser-plane node ID.\nTo support TSN, the user-plane node ID is Bridge ID. To support integration with IETF DetNet, the user-plane node ID can be Router ID. The User Plane Node ID may be pre-configured in the UPF based on deployment.\nAfter the N4 session has been established, the SMF and UPF may at any time exchange transparent user plane node and Port Management Information Container over a N4 session.\nN4 Session Context is identified by an N4 Session ID. An N4 Session Context is generated by SMF and UPF respectively to store the parameters related to an N4 session, including the N4 session ID and following information (see TS 29.244 [65] for an exhaustive list):\n1)\tgeneral session related parameters such as S-NSSAI, PDU Session Type, Trace Information, APN/DNN, ATSSS Control Information;\n2)\tthe PDRs, URRs, QERs, BAR(s), FARs, MARs used for this N4 session;\n3)\tparameters sent to support UPF statistics.\nThe UPF may use parameters listed above in bullets 1) (e.g. S-NSSAI) and 2) (e.g. Network Instance in PDR/FAR(s)) for determining internal UPF resources.\nThe following table describes the Packet Detection Rule (PDR) containing information required to classify a packet arriving at the UPF. Every PDR is used to detect packets in a certain transmission direction, e.g. UL direction or DL direction.\nTable 5.8.5.3-1: Attributes within Packet Detection Rule\n\nThe following table describes the QoS Enforcement Rule (QER) that defines how a packet shall be treated in terms of bit rate limitation and packet marking for QoS purposes. All Packet Detection Rules that refer to the same QER share the same QoS resources, e.g. MFBR.\nTable 5.8.5.4-1: Attributes within QoS Enforcement Rule\n\nThe following table describes the Usage Reporting Rule (URR) that defines how a packet shall be accounted as well as when and how to report the measurements.\nTable 5.8.5.5-1: Attributes within Usage Reporting Rule\n\nThe following table describes the Forwarding Action Rule (FAR) that defines how a packet shall be buffered, dropped or forwarded, including packet encapsulation/decapsulation and forwarding destination.\nTable 5.8.5.6-1: Attributes within Forwarding Action Rule\n\nThe UPF sends the Usage Report to inform the SMF about the measurement of an active URR or about the detection of application traffic of an active Packet Detection Rule. For each URR, the Usage Report may be generated repeatedly, i.e. as long as any one of the valid event triggers applies. A final Usage Report is sent for a URR when it is no longer active, i.e. either the URR is removed or all the references to this URR in any of the Packet Detection Rules belonging to the N4 session.\nThe following attributes can be included:\nTable 5.8.5.7-1: Attributes within Usage Report\n\nThe following table describes the Multi-Access Rule (MAR) that includes the association to the two FARs for both 3GPP access and non-3GPP access in the case of supporting ATSSS.\nTable 5.8.5.8-1: Attributes within Multi-Access Rule\n\nThe following table describes the User plane node Information (UI) that includes the information required to configure a 5GS logical bridge/router for TSC or Deterministic Networking PDU Sessions.\nTable 5.8.5.9-1: User plane node Information\n\n\nThe following table describes the Session Reporting Rule (SRR) that defines the detection and reporting events that the UPF shall report, that are not related to specific PDRs of the PDU Session, as follows:\n-\tPer QoS Flow per UE QoS Monitoring Report, as specified in clause 5.33.3.2.\n-\tChange of 3GPP or non-3GPP access availability, for an MA PDU session.\n-\tPer QoS Flow N6 Traffic Parameter Measurement Report.\nTable 5.8.5.11-1: Attributes within Session Reporting Rule\n\nThe UPF sends the session report to inform the SMF the detected events for a PDU Session that are related to an SRR. The UPF may support notification to the AF possibly via local NEF as described in clause 6.4 of TS 23.548 [130].\nTable 5.8.5.12-1: Attributes within Session Reporting\n\n\nThe following table describes the TSC Management Information Container (TSC MIC) that includes UMIC, PMIC and the associated NW-TT port number.\nThe SMF may include the notification target address for PMIC/UMIC UPF event provided by the PCF in the TSC Management Information sent to UPF if the UPF supports the related redirect reporting via Nupf. If the notification target address for PMIC/UMIC UPF event is provided by the SMF, the UPF may directly report TSC management information to the TSNAF or TSCTSF using Nupf_EventExposure_Notify service operation described in clause 7.2.29.\nTable 5.8.5.14-1: TSC Management Information Container\n\nThe UPF sends the Downlink Data Report to inform the SMF about the events related to receiving or discarding of downlink packets. The SMF controls this type of UPF report by providing instructions in the Buffer Action Rule of a FAR.\nFollowing attributes can be included:\nTable 5.8.5.15-1: Attributes within Downlink Data Report\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.8.5.3-1: Attributes within Packet Detection Rule",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.4-1: Attributes within QoS Enforcement Rule",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.5-1: Attributes within Usage Reporting Rule",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.6-1: Attributes within Forwarding Action Rule",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.7-1: Attributes within Usage Report",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.8-1: Attributes within Multi-Access Rule",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.9-1: User plane node Information",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.11-1: Attributes within Session Reporting Rule",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.12-1: Attributes within Session Reporting",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.14-1: TSC Management Information Container",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.8.5.15-1: Attributes within Downlink Data Report",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "5.9\tIdentifiers",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.9.1\tGeneral",
                            "text_content": "Each subscriber in the 5G System shall be allocated one 5G Subscription Permanent Identifier (SUPI) for use within the 3GPP system. The 5G System supports identification of subscriptions independently of identification of the user equipment. Each UE accessing the 5G System shall be assigned a Permanent Equipment Identifier (PEI).\nThe 5G System supports allocation of a temporary identifier (5G-GUTI) in order to support user confidentiality protection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.2\tSubscription Permanent Identifier",
                            "text_content": "A globally unique 5G Subscription Permanent Identifier (SUPI) shall be allocated to each subscriber in the 5G System and provisioned in the UDM/UDR. The SUPI is used only inside 3GPP system, and its privacy is specified in TS 33.501 [29].\nThe SUPI may contain:\n-\tan IMSI as defined in TS 23.003 [19], or\n-\ta network-specific identifier, used for private networks as defined in TS 22.261 [2].\n-\ta GLI and an operator identifier of the 5GC operator, used for supporting FN-BRGs, as further described in TS 23.316 [84].\n-\ta GCI and an operator identifier of the 5GC operator, used for supporting FN-CRGs and 5G-CRG, as further described in TS 23.316 [84].\nA SUPI containing a network-specific identifier shall take the form of a Network Access Identifier (NAI) using the NAI RFC 7542 [20] based user identification as defined in TS 23.003 [19].\nWhen UE needs to indicate its SUPI to the network (e.g. as part of the Registration procedure), the UE provides the SUPI in concealed form as defined in TS 23.003 [19].\nIn order to enable roaming scenarios, the SUPI shall contain the address of the home network (e.g. the MCC and MNC in the case of an IMSI based SUPI).\nFor interworking with the EPC, the SUPI allocated to the 3GPP UE shall always be based on an IMSI to enable the UE to present an IMSI to the EPC.\nThe usage of SUPI for W-5GAN is further specified in TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.2a\tSubscription Concealed Identifier",
                            "text_content": "The Subscription Concealed Identifier (SUCI) is a privacy preserving identifier containing the concealed SUPI. It is specified in TS 33.501 [29].\nThe usage of SUCI for W-5GAN access is further specified in TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.3\tPermanent Equipment Identifier",
                            "text_content": "A Permanent Equipment Identifier (PEI) is defined for the 3GPP UE accessing the 5G System.\nThe PEI can assume different formats for different UE types and use cases. The UE shall present the PEI to the network together with an indication of the PEI format being used.\nIf the UE supports at least one 3GPP access technology (i.e. NG-RAN, E-UTRAN, UTRAN or GERAN), the UE must be allocated a PEI in the IMEI or IMEISV format.\nIf a UE has registered with a network by using a network subscription and a PEI of the UE, then the UE shall keep the PEI to be used with the network subscription and shall not use that PEI with another network subscription while the UE is in registered state in the network.\nIn the scope of this release, the PEI may be one of the following:\n-\tfor UEs that support at least one 3GPP access technology, an IMEI or IMEISV, as defined in TS 23.003 [19];\n-\tPEI used in the case of W-5GAN access as further specified in TS 23.316 [84].\n-\tfor UEs not supporting any 3GPP access technologies, the IEEE Extended Unique Identifier EUI-64 [113] of the access technology the UE uses to connect to the 5GC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.4\t5G Globally Unique Temporary Identifier",
                            "text_content": "The AMF shall allocate a 5G Globally Unique Temporary Identifier (5G-GUTI) to the UE that is common to both 3GPP and non-3GPP access. It shall be possible to use the same 5G-GUTI for accessing 3GPP access and non-3GPP access security context within the AMF for the given UE. An AMF may re-assign a new 5G-GUTI to the UE at any time. The AMF provides a new 5G-GUTI to the UE under the conditions specified in clause 6.12.3 of TS 33.501 [29]. When the UE is in CM-IDLE, the AMF may delay providing the UE with a new 5G-GUTI until the next NAS transaction.\nThe 5G-GUTI shall be structured as:\n<5G-GUTI> := <GUAMI> <5G-TMSI>\nwhere GUAMI identifies one or more AMF(s).\nWhen the GUAMI identifies only one AMF, the 5G-TMSI identifies the UE uniquely within the AMF. However, when AMF assigns a 5G-GUTI to the UE with a GUAMI value used by more than one AMF, the AMF shall ensure that the 5G-TMSI value used within the assigned 5G-GUTI is not already in use by the other AMF(s) sharing that GUAMI value.\nThe Globally Unique AMF ID (GUAMI) shall be structured as:\n<GUAMI> := <MCC> <MNC> <AMF Region ID> <AMF Set ID> <AMF Pointer>\nwhere AMF Region ID identifies the region, AMF Set ID uniquely identifies the AMF Set within the AMF Region and AMF Pointer identifies one or more AMFs within the AMF Set.\nNOTE 1:\tThe AMF Region ID addresses the case that there are more AMFs in the network than the number of AMFs that can be supported by AMF Set ID and AMF Pointer by enabling operators to re-use the same AMF Set IDs and AMF Pointers in different regions.\nNOTE 2:\tIn the case of SNPNs, the PLMN IDs may be shared among SNPNs such that the constructed GUAMIs are not globally unique. However, PLMN ID and NID are provided together, separate from the GUAMI, to uniquely identify selected or supported SNPN in RRC and N2.\nNOTE 3: See TS 23.003 [19] for details on the structure of the fields of GUAMI.\nThe 5G-S-TMSI is the shortened form of the GUTI to enable more efficient radio signalling procedures (e.g. during Paging and Service Request) and is defined as:\n<5G-S-TMSI> := <AMF Set ID> <AMF Pointer> <5G-TMSI>\nAs specified in TS 38.304 [50] and TS 36.304 [52] for 3GPP access, the NG-RAN uses the 10 Least Significant Bits of the 5G-TMSI in the determination of the time at which different UEs are paged. Hence, the AMF shall ensure that the 10 Least Significant Bits of the 5G-TMSI are evenly distributed.\nAs specified in TS 38.331 [28] and TS 36.331 [51] for 3GPP access, the NG-RAN's RRC Connection Establishment's contention resolution process assumes that there is a low probability of the same 5G-TMSI being allocated by different AMFs to different UEs. The AMFs' process for allocating the 5G-TMSI should take this account.\nNOTE 4:\tTo achieve this, the AMF could, for example, use a random seed number for any process it uses when choosing the UE's 5G-TMSI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.5\tAMF Name",
                            "text_content": "An AMF is identified by an AMF Name. AMF Name is a globally unique FQDN, the structure of AMF Name FQDN is defined in TS 23.003 [19]. An AMF can be configured with one or more GUAMIs. At a given time, GUAMI with distinct AMF Pointer value is associated to one AMF name only.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.6\tData Network Name (DNN)",
                            "text_content": "A DNN is equivalent to an APN as defined in TS 23.003 [19]. Both identifiers have an equivalent meaning and carry the same information.\nThe DNN may be used e.g. to:\n-\tSelect a SMF and UPF(s) for a PDU Session.\n-\tSelect N6 interface(s) for a PDU Session.\n-\tDetermine policies to apply to this PDU Session.\nThe wildcard DNN is a value that can be used for the DNN field of Subscribed DNN list of Session Management Subscription data defined in clause 5.2.3.3 of TS 23.502 [3].\nThe wildcard DNN can be used with an S-NSSAI for operator to allow the subscriber to access any Data Network supported within the Network Slice associated with the S-NSSAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.7\tInternal-Group Identifier",
                            "text_content": "The subscription data for an UE in UDR may associate the subscriber with groups. A group is identified by an Internal-Group Identifier.\nNOTE 1:\tA UE can belong to a limited number of groups, the exact number is defined in stage 3 specifications.\nNOTE 2:\tIn this Release of the specification, the support of groups is only defined in non-roaming case.\nThe Internal-Group Identifier(s) corresponding to an UE are provided by the UDM to the SMF as part Session Management Subscription data and (when PCC applies to a PDU Session) by the SMF to the PCF. The SMF may use this information to apply local policies and to store this information in CDR. The PCF may use this information to enforce AF requests as described in clause 5.6.7.\nThe Internal-Group Identifier(s) corresponding to an UE are provided by the UDM to the AMF as part of Access and Mobility Subscription data. The AMF may use this information to apply local policies (such as Group specific NAS level congestion control defined in clause 5.19.7.5).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.8\tGeneric Public Subscription Identifier",
                            "text_content": "Generic Public Subscription Identifier (GPSI) is needed for addressing a 3GPP subscription in different data networks outside of the 3GPP system. The 3GPP system stores within the subscription data the association between the GPSI and the corresponding SUPI.\nGPSIs are public identifiers used both inside and outside of the 3GPP system.\nThe GPSI is either an MSISDN or an External Identifier, see TS 23.003 [19]. If MSISDN is included in the subscription data, it shall be possible that the same MSISDN value is supported in both 5GS and EPS.\nNOTE:\tThere is no implied 1-to-1 relationship between GPSI and SUPI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.9\tAMF UE NGAP ID",
                            "text_content": "An AMF UE NGAP ID is an identifier used to identify the UE in AMF on N2 reference point. AMF allocates the AMF UE NGAP ID and send it to the 5G-AN. For the following N2 signalling interaction sent from 5G-AN to AMF, AMF UE NGAP ID is used to identify the UE at the AMF. AMF UE NGAP ID is unique per AMF set. AMF UE NGAP ID may be updated without AMF change, or with AMF change as specified at clause 5.21.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.9.10\tUE Radio Capability ID",
                            "text_content": "The UE Radio Capability ID is a short pointer with format defined in TS 23.003 [19] that is used to uniquely identify a set of UE Radio Capabilities (excluding UTRAN and NB-IoT capabilities). The UE Radio Capability ID is assigned either by the serving PLMN or by the UE manufacturer, as follows:\n-\tUE manufacturer-assigned: The UE Radio Capability ID may be assigned by the UE manufacturer in which case it includes a UE manufacturer identification (i.e. a Vendor ID). In this case, the UE Radio Capability ID uniquely identifies a set of UE radio capabilities and the UE Radio Capability for Paging for a UE by this manufacturer in any PLMN.\n-\tPLMN-assigned: If a UE manufacturer-assigned UE Radio Capability ID is not used by the UE or the serving network, or it is not recognised by the serving PLMN UCMF, the UCMF may allocate UE Radio Capability IDs for the UE corresponding to each different set of UE radio capabilities the PLMN may receive from the UE at different times. In this case, the UE Radio Capability IDs the UE receives are applicable to the serving PLMN and uniquely identify the corresponding sets of UE radio capabilities and and the UE Radio Capability for Paging(s) in this PLMN. The PLMN assigned UE Radio Capability ID includes a Version ID in its format. The value of the Version ID is the one configured in the UCMF, at time the UE Radio Capability ID value is assigned. The Version ID value makes it possible to detect whether a UE Radio Capability ID is current or outdated.\nNOTE:\tFor the case the PLMN is configured to store PLMN assigned IDs in the UE manufacturer-assigned operation requested list defined in clause 5.4.4.1a, then the algorithm for assignment of PLMN-assigned UE Radio Capability ID shall assign different UE Radio Capability IDs for UEs with different TAC value.\nThe type of UE Radio Capability ID (UE manufacturer-assigned or PLMN-assigned) is distinguished when a UE Radio Capability ID is signalled.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.10\tSecurity aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.10.1\tGeneral",
                            "text_content": "The security features in the 5G System include:\n-\tAuthentication of the UE by the network and vice versa (mutual authentication between UE and network).\n-\tSecurity context generation and distribution.\n-\tUser Plane data confidentiality and integrity protection.\n-\tControl Plane signalling confidentiality and integrity protection.\n-\tUser identity confidentiality.\n-\tSupport of LI requirements as specified in TS 33.126 [35] subject to regional/national regulatory requirements, including protection of LI data (e.g. target list) that may be stored or transferred by an NF.\nDetailed security related network functions for 5G are described in TS 33.501 [29].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.2\tSecurity Model for non-3GPP access",
                            "text_content": "When a UE is connected via a NG-RAN and via a standalone non-3GPP accesses, the multiple N1 instances are secured using independent NAS security contexts, each created based on the security context in the corresponding SEAF (e.g. in the common AMF when the UE is served by the same AMF) derived from the UE authentication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.10.3\tPDU Session User Plane Security",
                            "text_content": "The User Plane Security Enforcement information provides the NG-RAN with User Plane security policies for a PDU session. It indicates:\n-\twhether UP integrity protection is:\n-\tRequired: for all the traffic on the PDU Session UP integrity protection shall apply.\n-\tPreferred: for all the traffic on the PDU Session UP integrity protection should apply.\n-\tNot Needed: UP integrity protection shall not apply on the PDU Session.\n-\twhether UP confidentiality protection is:\n-\tRequired: for all the traffic on the PDU Session UP confidentiality protection shall apply.\n-\tPreferred: for all the traffic on the PDU Session UP confidentiality protection should apply.\n-\tNot Needed: UP confidentiality shall not apply on the PDU Session.\nUser Plane Security Enforcement information applies only over 3GPP access. Once determined at the establishment of the PDU Session the User Plane Security Enforcement information applies for the life time of the PDU Session.\nNOTE 1:\tApplicability of UP integrity protection of UP Security Enforcement is defined in TS 33.501 [29] and TS 38.300 [27].\nThe SMF determines at PDU session establishment a User Plane Security Enforcement information for the user plane of a PDU session based on:\n-\tsubscribed User Plane Security Policy which is part of SM subscription information received from UDM; and\n-\tUser Plane Security Policy locally configured per (DNN, S-NSSAI) in the SMF that is used when the UDM does not provide User Plane Security Policy information.\n-\tThe maximum supported data rate per UE for integrity protection for the DRBs, provided by the UE in the Integrity protection maximum data rate IE during PDU Session Establishment. The UE supporting NR as primary RAT, i.e. NG-RAN access via Standalone NR, shall set the Integrity protection maximum data rate IE for Uplink and Downlink to full rate at PDU Session Establishment as defined in TS 24.501 [47]. A UE not supporting NR as primary RAT and supporting E-UTRA connected to 5GC, shall set the Integrity protection maximum data rate IE for Uplink and Downlink to NULL at PDU Session Establishment as defined in TS 24.501 [47].\nThe User Plane Security Enforcement information provides the MME with User Plane integrity protection policies for the PDU session (PDN Connection). The information indicates whether UP integrity protection is:\n-\tRequired: for all the traffic on the PDU Session (PDN Connection) UP integrity protection shall apply.\n-\tPreferred: for all the traffic on the PDU Session (PDN Connection) UP integrity protection should apply.\n-\tNot Needed: UP integrity protection shall not apply on the PDU Session (PDN Connection).\nIn turn, the MME provides per EPS bearer User Plane Security Enforcement information to the E-UTRAN. All the bearers within a PDN Connection share the same User Plane integrity protection policies.\nThe UE capability to support user plane integrity protection with EPS is indicated to AMF in the S1 UE network capability information. If the UE supports user plane integrity protection with EPS, and the AMF supports the associated functionality, the AMF indicates this to SMF at PDU Session Establishment using NG-RAN. If the UE and AMF support user plane integrity protection with EPS, for PDU Sessions with UP integrity protection of UP Security Enforcement Information set to Required, the SMF may perform the EPS bearer ID allocation procedure as described in TS 23.502 [3] clause 4.11.1.4. If the UE does not support user plane integrity protection with EPS or the AMF does not support the associated functionality, the SMF shall not trigger the EPS bearer ID allocation procedure in clause 4.11.1.4 of TS 23.502 [3].\nUnless the UE, the serving eNB and the MME support user plane integrity protection with EPS, the SMF+PGW-C shall reject a PDN Connection Establishment using EPS if the UP Security Enforcement Information has UP integrity protection set to Required.\nThe SMF+PGW-C shall (e.g. based on the received RAT Type) reject a PDN Connection Establishment using GERAN/UTRAN if the UP Security Enforcement Information has UP integrity protection set to Required.\nNOTE 2:\tThis assumes that the optional user plane integrity protection for GPRS specified in Release 13 has not been deployed.\nThe SMF may, based on local configuration, reject the PDU Session Establishment request depending on the value of the maximum supported data rate per UE for integrity protection.\nNOTE 3:\tReasons to reject a PDU Session Establishment request can e.g. be that the UP Integrity Protection is determined to be \"Required\" while the maximum supported data rate per UE for integrity protection is less than the expected required data rate for the DN.\nNOTE 4:\tThe operator can take care to reduce the risk of such rejections when configuring the subscribed User Plane Security Policy for a DNN. For example, the operator may apply integrity protection \"Required\" only in scenarios where it can be assumed that the UE maximum supported data rate per UE for integrity protection is likely to be adequate for the DN.\nThe User Plane Security Policy provide the same level of information than User Plane Security Enforcement information.\nUser Plane Security Policy from UDM takes precedence over locally configured User Plane Security Policy.\nThe User Plane Security Enforcement information may include the maximum supported data rate for integrity protection provided by the UE, is communicated from SMF to the NG-RAN for enforcement as part of PDU session related information. If the UP Integrity Protection is determined to be \"Required\" or \"Preferred\", the SMF also provides the maximum supported data rate per UE for integrity protection as received in the Integrity protection maximum data rate IE. This takes place at establishment of a PDU Session or at activation of the user plane of a PDU Session. The NG-RAN rejects the establishment of UP resources for the PDU Session when it cannot fulfil User Plane Security Enforcement information with a value of Required. The NG-RAN may also take the maximum supported data rate per UE for integrity protection into account in its decision on whether to accept or reject the establishment of UP resources. In this case the SMF releases the PDU Session. The NG-RAN notifies the SMF when it cannot fulfil a User Plane Security Enforcement with a value of Preferred.\nNOTE 5:\tFor example, the NG-RAN cannot fulfil requirements in User Plane Security Enforcement information with UP integrity protection set to \"Required\" when it cannot negotiate UP integrity protection with the UE.\nIt is responsibility of the NG-RAN to enforce that the maximum UP integrity protection data rate delivered to the UE in downlink is not exceeding the maximum supported data rate for integrity protection.\nIt is expected that generally the UP integrity protection data rate applied by the UE in uplink will not exceed the indicated maximum supported data rate, but the UE is not required to perform strict rate enforcement.\nUser Plane Security Enforcement information and the maximum supported data rate per UE for integrity protection is communicated from source to target NG-RAN node at handover. If the target RAN node cannot support requirements in User Plane Security Enforcement information, the target RAN node rejects the request to set up resources for the PDU Session. In this case the PDU Session is not handed over to the target RAN node and the PDU Session is released.\nIf the UE or the new eNB or the MME does not indicate support of user plane integrity protection with EPS, PDU Sessions with UP integrity protection of the User Plane Security Enforcement information set to Required are not transferred to EPS as follows:\n-\tIn the case of mobility without N26, the SMF+PGW-C shall reject a PDN connectivity request in EPS with handover indication if the UP integrity protection of the User Plane Security Enforcement is set to Required.\nNOTE 6:\tAs described in clause 5.17.2.3.3, the UE does not know before trying to move a given PDU Session to EPC, whether that PDU session can be transferred to EPC.\n-\tIn the case of idle mode and connected mode mobility with N26 to EPS, or mobility without N26, the SMF+PGW-C ensures that the PDU session is released.\nIf the UE, target eNB and the target MME indicate support of User Plane Integrity Protection with EPS, PDU Sessions with UP integrity protection of the User Plane Security Enforcement information set to Required are transferred from 5GS to EPS according to existing procedures.\nFor the bearers of PDN Connections with UP integrity protection set to Required, at (both idle mode and connected mode) mobility (including intra-TA mobility) to an eNB that does not support User Plane Integrity Protection with EPS, the MME shall inform the SMF+PGW-C and the SMF+PGW-C ensures that the PDU session is released.\nAt connected mode mobility from EPS to GERAN/UTRAN or to a part of the EPS that does not support User Plane Integrity Protection, the source E-UTRAN shall ensure that EPS bearers with UP integrity protection of the User Plane Security Enforcement information set to Required are not handed over.\nIn the case of idle mode mobility from an MME that supports User Plane Integrity Protection, to an MME that does not support User Plane Integrity Protection, the (home) SMF+PGW-C shall trigger (e.g. based on the lack of MME UPIP capability information) the release of the bearers of PDN Connections with UP integrity protection set to Required.\nAt any (e.g. idle mode) mobility from EPS to GERAN/UTRAN, the (home) SMF+PGW-C shall trigger (e.g. based on the received RAT Type) the release of the bearers of PDN Connections with UP integrity protection set to Required.\nPDU Sessions with UP confidentiality protection of the User Plane Security Enforcement information set to Required and UP integrity protection of the User Plane Security Enforcement information not set to Required, are allowed to be handed over to EPS regardless of how UP confidentiality protection applies in EPS.\nIn the case of dual connectivity, the Integrity Protection is set to \"Preferred\", the Master RAN node may notify the SMF when it cannot fulfil a User Plane Security Enforcement with a value of Preferred. The SMF handling of the PDU session with respect to the Integrity Protection status is up to SMF implementation decision.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.11\tSupport for Dual Connectivity, Multi-Connectivity",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.11.1\tSupport for Dual Connectivity",
                            "text_content": "Dual Connectivity involves two radio network nodes in providing radio resources to a given UE (with active radio bearers), while a single N2 termination point exists for the UE between an AMF and the RAN. The RAN architecture and related functions to support Dual Connectivity is further described in RAN specifications (e.g. TS 37.340 [31]).\nIn this Release of the specification, the Dual Connectivity function does not apply to the NR RedCap UE.\nThe RAN node at which the N2 terminates, performs all necessary N2 related functions such as mobility management, relaying of NAS signalling, etc. and manages the handling of user plane connection (e.g. transfer over N3). It is called the Master RAN Node. It may use resources of another RAN node, the Secondary RAN node, to exchange User Plane traffic of an UE. Master RAN node takes into account the RSN and/or PDU Session Pair ID to determine if dual connectivity shall be set up and ensure appropriate PDU session handling ensures fully redundant user plane path as described in clause 5.33.2.1.\nIf the UE has Mobility Restriction (either signalled from the UDM, or, locally generated by the Serving PLMN policy in the AMF) the AMF signals these restrictions to the Master RAN Node as Mobility Restriction List; This may prevent the Master RAN node from setting up a Dual Connectivity for an UE.\nNOTE 1:\tSubject to policies in the NG-RAN, configuration of Dual Connectivity for a Data Radio Bearer can also be based on the Network Slice that the PDU Session belongs to.\nDual Connectivity provides the possibility for the Master RAN node to request SMF:\n-\tFor some or all PDU Sessions of an UE: Direct all the DL User Plane traffic of the PDU Session to the either the Master RAN Node or to the Secondary RAN Node. In this case, there is a single N3 tunnel termination at the RAN for such PDU Session.\nNOTE 2:\tThe terminating RAN Node, can decide to keep traffic for specific QFI(s) in a PDU Session for a UE on a single RAT, or split them across the two RATs.\n-\tFor some other PDU Sessions of an UE: Direct the DL User Plane traffic of some QoS Flows of the PDU Session to the Secondary (respectively Master) RAN Node while the remaining QoS Flows of the PDU Session are directed to the Master (respectively Secondary) RAN Node. In this case there are, irrespective of the number of QoS Flows, two N3 tunnel terminations at the RAN for such PDU Session.\nThe Master RAN node may create and change this assignment for the user plane of a PDU Session at any time during the life time of the PDU Session;\nIn both cases, a single PDU Session Id is used to identify the PDU Session.\nAdditional functional characteristics are:\n-\tUser location information is based on the identity of the cell that is serving the UE in the Master RAN node. The cell identity of the Primary cell in the secondary RAN node may also be included. NG-RAN includes the user location information in NGAP messages where the contents of the user location information may change during the corresponding procedure.\n-\tPath update signalling related with Dual Connectivity and UPF re-allocation cannot occur at the same time.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.12\tCharging",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.12.1\tGeneral",
                            "text_content": "5GC supports interactions towards CHF for network resource usage, as defined in TS 32.240 [41]. The CHF and the Nchf service are defined in TS 32.290 [67].\nThe SMF supports the interactions towards the CHF, as defined in TS 32.255 [68]. The UPF supports functionality to collect and report usage data to SMF. The N4 reference point supports the SMF control of the UPF collection and reporting of usage data.\nThe AMF supports interactions towards the CHF, as defined in TS 32.256 [114].\nThe SMSF supports interactions towards the CHF, as defined in TS 32.274 [118].\nThe NEF supports interactions towards the CHF, as defined in TS 32.254 [123].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.12.2\tUsage Data Reporting for Secondary RAT",
                            "text_content": "When NG-RAN is deployed in dual connectivity configuration, the HPLMN or VPLMN operator may wish to record the data volume sent and received on the Secondary RAT.\nIn order to reduce the complexity of this procedure, the following principles are used in this release:\na)\tThe PLMN locally activates the Secondary RAT Usage Data Reporting by NG-RAN OAM. The activation is based on configuration in NG-RAN and NG-RAN determines whether the data volume report will contain data volumes consumed for the whole PDU Session or for selected QoS Flows or both as described in TS 38.413 [34].\nThe activation can happen separately for Data Volume Reporting of NR in licensed or unlicensed spectrum and E-UTRA in licensed or unlicensed spectrum. If the PLMN uses this feature, it should ensure that this functionality is supported by all NG-RAN nodes that support NR or E-UTRA as a Secondary RAT.\nb)\tDepending on its configuration the NG-RAN reports uplink and downlink data volumes to the 5GC for the Secondary RAT (including the using of unlicensed spectrum for NR or E-UTRA) for the PDU Session or for selected QoS Flows or both and per time interval.\nc)\tDuring Xn handover and N2 handover, the source NG-RAN node reports the data volume to the 5GC. The reported data volume excludes data forwarded to the target RAN node.\nd)\tAt the time of NG connection release, Secondary RAN Node change/release, deactivation of UP connection for a PDU Session, the NG-RAN node reports the data volumes to the 5GC.\ne)\tTo assist \"partial CDR\" generation, NG-RAN OAM can instruct the NG-RAN to also make periodic reports (as described in clause 5.12.3) if no event has triggered a report before the period expires.\nNOTE 2:\tThe timing of these periodic NG-RAN reports is not expected to align with the timing of partial CDR generation. Hence the frequency of NG-RAN reports might be greater than that of partial CDR generation.\nNOTE 3:\tRAN needs to be able to partition the measurements in a report to indicate usage that occurred before and after an absolute time. An example of the absolute time is that RAN is configured to partition data usage reports that occurred before and after midnight.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.12.3\tSecondary RAT Periodic Usage Data Reporting Procedure",
                            "text_content": "Periodic reporting of the Secondary RAT usage data is an optional function. When NG-RAN, as defined in bullet e) of clause 5.12.12, is configured with a \"time interval for Secondary RAT usage data reporting\", the NG-RAN shall send a RAN Usage Data Report message for periodic reporting purposes to the SMF only when the timer expires for a UE for which Secondary RAT usage data reporting is ongoing. The timer runs from the last usage reporting for the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.13\tSupport for Edge Computing",
                    "description": "",
                    "summary": "",
                    "text_content": "Edge computing enables operator and 3rd party services to be hosted close to the UE's access point of attachment, so as to achieve an efficient service delivery through the reduced end-to-end latency and load on the transport network. Edge Computing support by 5GC is specified in this specification and in TS 23.548 [130].\nNOTE: Edge Computing typically applies to non-roaming and LBO roaming scenarios. For HR roaming scenarios, Edge Computing applies only for \"Home Routed with Session Breakout in VPLMN (HR-SBO)\" which is described in clause 6.7 of TS 23.548 [130].\nThe 5G Core Network selects a UPF close to the UE and forwards traffic to enable the local access to the DN via a N6 interface according to the provided traffic steering rules to the UPF. This may be based on the UE's subscription data, UE location, the information from Application Function (AF) as defined in clause 5.6.7, the EAS information reported from EASDF (as defined in TS 23.548 [130]), policy or other related traffic rules.\nDue to user or Application Function mobility, the service or session continuity may be required based on the requirements of the service or the 5G network.\nThe 5G Core Network may expose network information and capabilities to an Edge Computing Application Function.\nNOTE:\tDepending on the operator deployment, certain Application Functions can be allowed to interact directly with the Control Plane Network Functions with which they need to interact, while the other Application Functions need to use the external exposure framework via the NEF (see clause 6.2.10 for details).\nEdge computing can be supported by one or a combination of the following enablers:\n-\tUser plane (re)selection: the 5G Core Network (re)selects UPF to route the user traffic to the local part of the DN as described in clause 6.3.3;\n-\tLocal Routing and Traffic Steering: the 5G Core Network selects the traffic to be routed to the applications in the local part of the DN;\n-\tthis includes the use of a single PDU Session with multiple PDU Session Anchor(s) (UL CL / IP v6 multi-homing) as described in clause 5.6.4 and the use of a PDU Session with Distributed Anchor Point using SSC mode 2/3.\n-\tSession and service continuity to enable UE and application mobility as described in clause 5.6.9;\n-\tAn Application Function may influence UPF (re)selection and traffic routing via PCF or NEF as described in clause 5.6.7;\n-\tNetwork capability exposure: 5G Core Network and Application Function to provide information to each other via NEF as described in clause 5.20 or directly as described in clause 4.15 of TS 23.502 [3] or from the UPF as described in clause 6.4 of TS 23.548 [130];\n-\tQoS and Charging: PCF provides rules for QoS Control and Charging for the traffic routed to the local part of the DN;\n-\tSupport of Local Area Data Network: 5G Core Network provides support to connect to the LADN in a certain area where the applications are deployed as described in clause 5.6.5.\n-\tDiscovery and re-discovery of Edge Applications Servers as described in TS 23.548 [130].\n-\tSupport of Edge Relocation as described in TS 23.548 [130] and the case of involving AF change as described in clauses 4.3.6.2, 4.3.6.3 and 4.3.6.4 of TS 23.502 [3]. Support of 5GC triggered Edge relocation within the same hosting PLMN's EHEs.\n-\tSupport of (I-)SMF (re)selection based on DNAI as described in clauses 4.3.5.1, 4.3.5.2 and 4.23.5.1 of TS 23.502 [3].\n-\tSupport of finer sets of UEs.\n-\tSupport of common EAS discovery and common DNAI determination for set of UEs as described in clause 6.2 of TS 23.548 [130].\n-\tSupport of mapping information between EAS IP/IP range and DNAI as described in clause 6.8 of TS 23.548 [130].\n-\tSupport of AF request for DNAI as described in clause 6.8 of TS 23.548 [130].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.14\tPolicy Control",
                    "description": "",
                    "summary": "",
                    "text_content": "The policy and charging control framework for the 5G System is defined in TS 23.503 [45].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.15\tNetwork slicing",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.15.1\tGeneral",
                            "text_content": "A Network Slice instance is defined within a PLMN or within an SNPN and shall include:\n-\tthe Core Network Control Plane and User Plane Network Functions, as described in clause 4.2,\nand, in the serving PLMN, at least one of the following:\n-\tthe NG-RAN described in TS 38.300 [27];\n-\tthe N3IWF or TNGF functions to the non-3GPP Access Network described in clause 4.2.8.2 or the TWIF functions to the trusted WLAN in the case of support of N5CW devices described in clause 4.2.8.5;\n-\tthe W-AGF function to the Wireline Access Network described in clause 4.2.8.4.\nThe 5G System deployed in a PLMN shall always support the procedures, information and configurations specified to support Network Slice instance selection in the present document, TS 23.502 [3] and TS 23.503 [45].\nNOTE 1:\tManagement of network slices are described in TS 28.530 [175], the procedures for provisioning of networks and network slices are described in TS 28.531 [176] and TS 28.541 [149] describes the resource model for managing the resources.\nNetwork slicing support for roaming is described in clause 5.15.6.\nNetwork slices may differ for supported features and network functions optimisations, in which case such Network Slices may have e.g. different S-NSSAIs with different Slice/Service Types (see clause 5.15.2.1). The operator can deploy multiple Network Slices delivering exactly the same features but for different groups of UEs, e.g. as they deliver a different committed service and/or because they are dedicated to a customer, in which case such Network Slices may have e.g. different S-NSSAIs with the same Slice/Service Type but different Slice Differentiators (see clause 5.15.2.1).\nThe network may serve a single UE with one or more Network Slice instances simultaneously via a 5G-AN regardless of the access type(s) over which the UE is registered (i.e. 3GPP Access and/or N3GPP Access). The AMF instance serving the UE logically belongs to each of the Network Slice instances serving the UE, i.e. this AMF instance is common to the Network Slice instances serving a UE.\nNOTE 2:\tNumber of simultaneous connection of Network Slice instances per UE is limited by the number of S-NSSAIs in the Requested/Allowed NSSAI as described in clause 5.15.2.1.\nNOTE 3:\tIn this Release of the specification it is assumed that in any (home or visited) PLMN it is always possible to select an AMF that can serve any combination of S-NSSAIs that will be provided as an Allowed NSSAI.\nThe selection of the set of Network Slice instances for a UE is triggered by the first contacted AMF in a Registration procedure normally by interacting with the NSSF, and can lead to a change of AMF. This is further described in clause 5.15.5.\nA PDU Session belongs to one and only one specific Network Slice instance per PLMN. Different Network Slice instances do not share a PDU Session, though different Network Slice instances may have slice-specific PDU Sessions using the same DNN.\nDuring the Handover procedure the source AMF selects a target AMF by interacting with the NRF as specified in clause 6.3.5.\nNetwork Slice-Specific Authentication and Authorization (NSSAA) enables Network Slice specific authentication as described in clause 5.15.10.\nNetwork Slice Admission Control (NSAC) controls the number of registered UEs per network slice, the number of UEs with at least one PDU Session/PDN Connection per network slice in the case of EPC interworking and the number of PDU Sessions per network slice as described in clause 5.15.11.\nSupport of subscription-based restrictions to simultaneous registration of network slices uses Network Slice Simultaneous Registration Group (NSSRG) information to enable control of which Network Slices that can be registered simultaneously by a UE as described in clause 5.15.12.\nSupport of data rate limitation per Network Slice for a UE enables enforcement of Maximum Bit Rate per Network Slice for a UE as described in clause 5.15.13.\nThe selection of N3IWF/TNGF supporting a set of slice(s) is described in clause 6.3.6 and clause 6.3.12 respectively.\nThe support of Network Slice usage control is described in clause 5.15.15.\nSupport of Optimized handling of temporarily available network slices is described in clause 5.15.16. It also covers aspects related to graceful release of network slices connectivity during slice decommissioning.\nThe Partial Network Slice support in a Registration Area is described in clause 5.15.17.\nSupport for Network Slices with Network Slice Area of Service not matching deployed Tracking Areas is described in clause 5.15.18.\nSupport of Network Slice Replacement is described in clause 5.15.19.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.2\tIdentification and selection of a Network Slice: the S-NSSAI and the NSSAI",
                            "text_content": "An S-NSSAI identifies a Network Slice.\nAn S-NSSAI is comprised of:\n-\tA Slice/Service type (SST), which refers to the expected Network Slice behaviour in terms of features and services;\n-\tA Slice Differentiator (SD), which is optional information that complements the Slice/Service type(s) to differentiate amongst multiple Network Slices of the same Slice/Service type.\nAn S-NSSAI can have standard values (i.e. such S-NSSAI is only comprised of an SST with a standardised SST value, see clause 5.15.2.2, and no SD) or non-standard values (i.e. such S-NSSAI is comprised of either both an SST and an SD or only an SST without a standardised SST value and no SD). An S-NSSAI with a non-standard value identifies a single Network Slice within the PLMN with which it is associated. An S-NSSAI with a non-standard value shall not be used by the UE in access stratum procedures in any PLMN other than the one to which the S-NSSAI is associated.\nThe S-NSSAIs in the NSSP of the URSP rules (see clause 6.6.2 of TS 23.503 [45]) and in the Subscribed S-NSSAIs (see clause 5.15.3) contain only HPLMN S-NSSAI values.\nThe S-NSSAIs in the Configured NSSAI, the Allowed NSSAI (see clause 5.15.4.1), the Requested NSSAI (see clause 5.15.5.2.1), the Rejected S-NSSAIs contain only values from the Serving PLMN. The Serving PLMN can be the HPLMN or a VPLMN.\nThe S-NSSAI(s) in the PDU Session Establishment contain one Serving PLMN S-NSSAI value and in addition may contain a corresponding HPLMN S-NSSAI value to which this first value is mapped (see clause 5.15.5.3). Further information for slice replacement is described in clause 5.15.19.\nThe optional mapping of Serving PLMN S-NSSAIs to HPLMN S-NSSAIs contains Serving PLMN S-NSSAI values and corresponding mapped HPLMN S-NSSAI values.\nThe NSSAI is a collection of S-NSSAIs. An NSSAI may be a Configured NSSAI, a Requested NSSAI, Allowed NSSAI or a Partially Allowed NSSAI. There can be at most eight S-NSSAIs in Allowed NSSAI and Requested NSSAI sent in signalling messages between the UE and the Network. There can be at most seven S-NSSAIs in the Partially Allowed NSSAI and at most seven S-NSSAIs rejected partially in the RA, and the sum of S-NSSAIs in the Allowed NSSAI, and the Partially Allowed NSSAI shall be at most eight. The Requested NSSAI signalled by the UE to the network allows the network to select the Serving AMF, Network Slice(s) and Network Slice instance(s) for this UE, as specified in clause 5.15.5.\nNOTE 1:\tThere can be at most a maximum of seven S-NSSAIs in the Partially Allowed NSSAI since there will always be an Allowed NSSAI allocated.\nBased on the operator's operational or deployment needs, a Network Slice instance can be associated with one or more S-NSSAIs, and an S-NSSAI can be associated with one or more Network Slice instances. Multiple Network Slice instances associated with the same S-NSSAI may be deployed in the same or in different Tracking Areas. When multiple Network Slice instances associated with the same S-NSSAI are deployed in the same Tracking Areas, the AMF instance serving the UE may logically belong to (i.e. be common to) more than one Network Slice instance associated with this S-NSSAI.\nIn a PLMN, when an S-NSSAI is associated with more than one Network Slice instance, one of these Network Slice instances, as a result of the Network Slice instance selection procedure defined in clause 5.15.5, serves a UE that is allowed to use this S-NSSAI. For any S-NSSAI, the network may at any one time serve the UE with only one Network Slice instance associated with this S-NSSAI until cases occur where e.g. this Network Slice instance is no longer valid in a given Registration Area, or a change in UE's Allowed NSSAI occurs, etc. In such cases, procedures mentioned in clause 5.15.5.2.2 or clause 5.15.5.2.3 apply.\nBased on the Requested NSSAI (if any) and the Subscription Information, the 5GC is responsible for selection of a Network Slice instance(s) to serve a UE including the 5GC Control Plane and User Plane Network Functions corresponding to this Network Slice instance(s). The Subscription Information may contain restrictions to the simultaneous registration of network slices. This is provided to the serving AMF as part of the UE subscription, in the form of Network Slice Simultaneous Registration Group (NSSRG) information (see clause 5.15.12).\nThe (R)AN may use Requested NSSAI in access stratum signalling to handle the UE Control Plane connection before the 5GC informs the (R)AN of the Allowed NSSAI. The Requested NSSAI is used by the RAN for AMF selection, as described in clause 6.3.5. The UE shall not include the Requested NSSAI in the RRC Resume when the UE asks to resume the RRC connection and is CM-CONNECTED with RRC_INACTIVE state.\nWhen a UE is successfully registered over an Access Type, the CN informs the (R)AN by providing the Allowed NSSAI for the corresponding Access Type.\nNOTE 2:\tThe details of how the RAN uses NSSAI information are described in TS 38.300 [27].\nStandardized SST values provide a way for establishing global interoperability for slicing so that PLMNs can support the roaming use case more efficiently for the most commonly used Slice/Service Types.\nThe SSTs which are standardised are in the following Table 5.15.2.2-1.\nTable 5.15.2.2-1: Standardised SST values\n\nNOTE 1:\tThe support of all standardised SST values is not required in a PLMN. Services indicated in this table for each SST value can also be supported by means of other SSTs.\nNOTE 2:\tA mapping of GSMA defined Network Slice Types (NEST) to standard SST values is defined in GSMA NG.116 [137].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.15.2.2-1: Standardised SST values",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.15.3\tSubscription aspects",
                            "text_content": "The Subscription Information shall contain one or more S-NSSAIs i.e. Subscribed S-NSSAIs. The subscription information shall include at least one default S-NSSAI. The UDM sends at the most 16 Subscribed S-NSSAIs to AMF, i.e. the number that can fit in a Configured NSSAI. The subscription information the UDM sends to the AMF shall include at least one default S-NSSAI.\nIf an S-NSSAI is marked as default, then the network is expected to serve the UE with a related applicable Network Slice instance when the UE does not send any permitted S-NSSAI to the network in a Registration Request message as part of the Requested NSSAI.\nThe Subscription Information for each S-NSSAI may contain:\n-\ta Subscribed DNN list and one default DNN; and\n-\tthe indication whether the S-NSSAI is marked as default Subscribed S-NSSAI; and\n-\tthe indication whether the S-NSSAI is subject to Network Slice-Specific Authentication and Authorization; and\n-\tNetwork Slice Simultaneous Usage Group (NSSRG) information (see clause 5.15.12).\nThe network verifies the Requested NSSAI the UE provides in the Registration Request against the Subscription Information. For the S-NSSAIs subject to Network Slice-Specific Authentication and Authorization the clause 5.15.10 applies.\nNOTE 1:\tIt is recommended that at least one of the Subscribed S-NSSAIs marked as default S-NSSAI is not subject to Network Slice-specific Authentication and Authorization, in order to ensure access to services even when Network Slice-specific Authentication and Authorization fails.\nNOTE 2:\tIt is recommended to minimize the number of Subscribed S-NSSAIs in subscriptions for NB-IoT or NR RedCap capable UEs to minimize overhead for signalling a large number of S-NSSAIs in Requested NSSAI in RRC and NAS via NB-IoT or NR RedCap.\nIn roaming case, the UDM shall provide to the VPLMN only the S-NSSAIs from the Subscribed S-NSSAIs the HPLMN allows for the UE in the VPLMN. If the UE is subject to restrictions of simultaneous registration of network slices (i.e. if the Subscription Information for the S-NSSAIs contains NSSRG information), the UDM provides to the VPLMN a subscribed S-NSSAIs and, if applicable, NSSRG information, as described in clause 5.15.12.\nNOTE 3:\tNetwork slice instances supporting an S-NSSAI subject to Network Slice-Specific Authentication and Authorization need to be deployed with AMFs supporting Network Slice-Specific Authentication and Authorization, otherwise S-NSSAIs requiring Network Slice-Specific Authentication and Authorization would be incorrectly allowed without execution of Network Slice-Specific Authentication and Authorization.\nNOTE 4:\tNetwork slice instances supporting an S-NSSAI subject to Network Slice Admission Control (NSAC) for number of registered UE per network slice need to be deployed with AMFs supporting NSAC, otherwise S-NSSAIs requiring NSAC would be incorrectly allowed without execution of NSAC.\nWhen the UDM updates the Subscribed S-NSSAI(s) to the serving AMF, based on configuration in this AMF, the AMF itself or the NSSF determines the mapping of the Configured NSSAI for the Serving PLMN and/or Allowed NSSAI to the Subscribed S-NSSAI(s). The serving AMF then updates the UE with the above information as described in clause 5.15.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.4\tUE NSSAI configuration and NSSAI storage aspects",
                            "text_content": "The Network Slice configuration information contains one or more Configured NSSAI(s). A Configured NSSAI may either be configured by a Serving PLMN and apply to the Serving PLMN, or may be a Default Configured NSSAI configured by the HPLMN and that applies to any PLMNs for which no specific Configured NSSAI has been provided to the UE. There is at most one Configured NSSAI per PLMN.\nNOTE 1:\tThe value(s) used in the Default Configured NSSAI are expected to be commonly decided by all roaming partners, e.g. by the use of values standardized by 3GPP or other bodies.\nThe Default Configured NSSAI, if it is configured in the UE, is used by the UE in a Serving PLMN only if the UE has no Configured NSSAI for the Serving PLMN.\nThe Configured NSSAI of a PLMN may include S-NSSAIs that have standard values or PLMN-specific values.\nThe Configured NSSAI for the Serving PLMN includes the S-NSSAI values which can be used in the Serving PLMN and may be associated with mapping of each S-NSSAI of the Configured NSSAI to one or more corresponding HPLMN S-NSSAI values. In the non-roaming case, the network shall not provide any mapped S-NSSAI to the UE with the Configured NSSAI. In the roaming case, the AMF shall provide to the UE the mapping of each S-NSSAI of the Configured NSSAI for the Serving PLMN to the corresponding S-NSSAI values of the HPLMN when providing NSSAI information, as described in TS 24.501 [47].\nA UE subscription may contain Network Slice Simultaneous Registration Group (NSSRG) information. If so, the UE configuration is performed as described in clause 5.15.12.2.\nThe UE may be pre-configured with the Default Configured NSSAI. The UE may be provisioned/updated with the Default Configured NSSAI, determined by the UDM in the HPLMN, using the UE Parameters Update via UDM Control Plane procedure defined in clause 4.20 of TS 23.502 [3]. Each S-NSSAI in the Default Configured NSSAI may have a corresponding S-NSSAI as part of the Subscribed S-NSSAI(s). Consequently, if the Subscribed S-NSSAI(s) which are also present in the Default Configured NSSAI are updated the UDM should update the Default Configured NSSAI in the UE.\nIn the HPLMN, the S-NSSAIs in the Configured NSSAI provided as described in clause 5.15.4.2, at the time when they are provided to the UE, shall match the Subscribed S-NSSAIs for the UE.\nWhen the Subscribed S-NSSAI(s) are updated (i.e. some existing S-NSSAIs are removed and/or some new S-NSSAIs are added) and one or more are applicable to the Serving PLMN the UE is registered in, as described in clause 5.15.3, or when the associated mapping is updated the AMF shall update the UE with the Configured NSSAI for the Serving PLMN and/or Allowed NSSAI and Partially Allowed NSSAI and/or the associated mapping to HPLMN S-NSSAIs (see clause 5.15.4.2). When there is the need to update the Allowed NSSAI or Partially Allowed NSSAI, the AMF shall provide the UE with the new Allowed NSSAI or Partially Allowed NSSAI and the associated mapping to HPLMN S-NSSAIs, unless the AMF cannot determine the new Allowed NSSAI (e.g. all S-NSSAIs in the old Allowed NSSAI have been removed from the Subscribed S-NSSAIs), in which case the AMF shall not send any Allowed NSSAI to the UE but indicate to the UE to perform a Registration procedure. If the UE is in a CM-IDLE state, the AMF may trigger Network Triggered Service Request or wait until the UE is in a CM-CONNECTED state as described in clause 4.2.4.2, TS 23.502 [3].\nWhen providing a Requested NSSAI to the network upon registration, the UE in a given PLMN only includes and uses S-NSSAIs applying to this PLMN. The mapping of S-NSSAIs of the Requested NSSAI to HPLMN S-NSSAIs may also be provided (see clause 5.15.4.1.2 for when this is needed). The S-NSSAIs in the Requested NSSAI are part of the Configured and/or Allowed NSSAIs applicable for this PLMN, when they are available. If the UE has received NSSRG information together with the Configured NSSAI, it only includes in the Requested NSSAI S-NSSAIs that all share a common NSSRG. If the UE has stored Pending NSSAI and the UE is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG. If no Configured NSSAI and Allowed NSSAI for the PLMN are available, the S-NSSAIs in the Requested NSSAI correspond to the Default Configured NSSAI, if configured in the UE. Upon successful completion of a UE's Registration procedure over an Access Type, the UE obtains from the AMF an Allowed NSSAI or Partially Allowed NSSAI for this Access Type, which includes one or more S-NSSAIs and, if needed (see clause 5.15.4.1.2 for when this is needed), their mapping to the HPLMN S-NSSAIs. These S-NSSAIs are valid for the current Registration Area and Access Type provided by the AMF the UE has registered with and can be used simultaneously by the UE (up to the maximum number of simultaneous Network Slice instances or PDU Sessions).\nThe UE might also obtain from the AMF, one or more rejected S-NSSAIs with cause and validity of rejection. An S-NSSAI may be rejected:\n-\tfor the entire PLMN;\n-\tfor the current Registration Area; or\n-\tpartially in the current Registration Area. Such S-NSSAI rejected partially in the current Registration area is associated with a list of TAs where the S-NSSAI is not supported.\nThe AMF may also reject the use of an S-NSSAI due to congestion as described in clause 5.19.7.4.\nWhile the UE remains RM-REGISTERED in the PLMN and regardless of the Access Type, the UE shall not re-attempt to register to an S-NSSAI rejected for the entire PLMN until this rejected S-NSSAI is deleted as specified below.\nWhile the UE remains RM-REGISTERED in the PLMN, the UE shall not re-attempt to register to an S-NSSAI rejected in the current Registration Area until it moves out of the current Registration Area.\nWhile the UE remains RM-REGISTERED in the PLMN, the UE shall not re-attempt to register to an S-NSSAI rejected partially in the RA until the UE moves into a TA which is not part of the list of TAs associated with the S-NSSAI.\nNOTE 2:\tThe details and more cases of S-NSSAI rejection are described in TS 24.501 [47].\nThe S-NSSAIs that the UE provides in the Requested NSSAI which are neither in the Allowed NSSAI nor in the Partially Allowed NSSAI, nor provided as a rejected S-NSSAI, shall, by the UE, not be regarded as rejected, i.e. the UE may request to register these S-NSSAIs again next time the UE sends a Requested NSSAI.\nThe UE stores (S-)NSSAIs as follows:\n-\tWhen provisioned with a Configured NSSAI for a PLMN and/or a mapping of Configured NSSAI to HPLMN S-NSSAIs and possibly NSSRG information for each S-NSSAI in the Configured NSSAI (if applicable and supported by the UE), or when requested to remove the configuration due to network slicing subscription change, the UE shall:\n-\treplace any stored (old) Configured NSSAI for this PLMN with the new Configured NSSAI for this PLMN (if applicable); and\n-\tdelete any stored associated mapping of this old Configured NSSAI for this PLMN to HPLMN S-NSSAIs and, if present and applicable, store the mapping of Configured NSSAI to HPLMN S-NSSAIs; and\n-\tdelete any stored associated NSSRG information for each S-NSSAI of the Configured NSSAI and, if present, store the associated NSSRG information for each S-NSSAI of the Configured NSSAI; and\n-\tdelete any stored rejected S-NSSAI for this PLMN;\n-\tkeep the received Configured NSSAI for a PLMN (if applicable) and associated mapping to HPLMN S-NSSAIs (if applicable) and associated NSSRG information for each S-NSSAI of the Configured NSSAI (if applicable and supported by the UE) stored in the UE, even when registering in another PLMN, until a new Configured NSSAI for this PLMN and/or associated mapping are provisioned in the UE, or until the network slicing subscription changes, as described in clause 5.15.4.2. The number of Configured NSSAIs and associated mapping to be kept stored in the UE for PLMNs other than the HPLMN is up to UE implementation. A UE shall at least be capable of storing a Configured NSSAI for the serving PLMN including any necessary mapping of the Configured NSSAI for the Serving PLMN to HPLMN S-NSSAIs and the Default Configured NSSAI.\n-\tThe Allowed NSSAI received in a Registration Accept message or a UE Configuration Update Command applies to a PLMN when at least a TAI of this PLMN is included in the RA/TAI list included in this Registration Accept message or UE Configuration Update Command. If the UE Configuration Update Command contains an Allowed NSSAI but not a TAI List, then the last received RA/TAI list applies for the decision on which PLMN(s) the Allowed NSSAI is applicable. If received, the Allowed NSSAI for a PLMN and Access Type and any associated mapping of this Allowed NSSAI to HPLMN S-NSSAIs shall be stored in the UE. The UE should store this Allowed NSSAI and any associated mapping of this Allowed NSSAI to HPLMN S-NSSAIs also when the UE is turned off, or until the network slicing subscription changes, as described in clause 5.15.4.2:\nNOTE 3:\tWhether the UE stores the Allowed NSSAI and any associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs also when the UE is turned off is left to UE implementation.\n-\tWhen a new Allowed NSSAI for a PLMN and any associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are received over an Access Type, the UE shall:\n-\treplace any stored (old) Allowed NSSAI and any associated mapping for these PLMN and Access Type with this new Allowed NSSAI; and\n-\tdelete any stored associated mapping of this old Allowed NSSAI for this PLMN to HPLMN S-NSSAIs and, if present, store the associated mapping of this new Allowed NSSAI to HPLMN S-NSSAIs;\n-\tIf received, a Partially Allowed NSSAI received in a Registration Accept message or a UE Configuration Update Command message applies to the current Registration Area. The UE stores the Partially Allowed NSSAI in the same way as described for the Allowed NSSAI (see also clause 5.15.17).\n-\tIf received, an S-NSSAI rejected for the entire PLMN shall be stored in the UE while RM-REGISTERED in this PLMN regardless of the Access Type or until it is deleted.\n-\tIf received, an S-NSSAI rejected for the current Registration Area shall be stored in the UE while RM-REGISTERED until the UE moves out of the current Registration Area or until the S-NSSAI is deleted.\n-\tIf received, an S-NSSAI rejected partially in the RA shall be stored in the UE while RM-REGISTERED until the UE moves out of the current Registration Area or until the S-NSSAI is deleted (see also clause 5.15.17).\nNOTE 4:\tThe storage aspects of rejected S-NSSAIs are described in TS 24.501 [47].\n-\tIf received, the Pending NSSAI shall be stored in the UE as described in TS 24.501 [47].\n-\tIf received, the S-NSSAI validity time information shall be stored in the UE in the UE as described in TS 24.501 [47].\n-\tIf received, the S-NSSAI location availability information shall be stored in the UE as described in TS 24.501 [47].\n-\tIf received, the mapping of old S-NSSAI to the Alternative S-NSSAI shall be stored in the UE as described in TS 24.501 [47].\nUE configuration to guide UE selection of a N3IWF/TNGF that supports the S-NSSAIs needed by the UE is defined in clause 6.3.6 and clause 6.3.12 respectively.\nFor the roaming case, one or more S-NSSAIs in an Allowed NSSAI provided to the UE can have values which are not part of the UE's current Network Slice configuration information for the Serving PLMN. In this case, the network provides the Allowed NSSAI together with the mapping of each S-NSSAI of the Allowed NSSAI to the corresponding S-NSSAI of the HPLMN. This mapping information allows the UE to associate Applications to S-NSSAIs of the HPLMN as per NSSP of the URSP rules or as per the UE Local Configuration, as defined in clause 6.1.2.2.1 of TS 23.503 [45] and to the corresponding S-NSSAI from the Allowed NSSAI.\nIn the non-roaming case, the network shall not provide any mapped S-NSSAI to the UE with the Allowed NSSAI.\nIn roaming case, the UE shall provide in the Requested NSSAI the mapping of S-NSSAIs of the Serving PLMN values to the corresponding S-NSSAI values of the HPLMN, for each S-NSSAI in the Requested NSSAI for which a mapping is available. These values are found in the mapping previously received from the Serving PLMN of the S-NSSAIs of the Configured NSSAI for the Serving PLMN or of the S-NSSAIs of the Allowed NSSAI for the Serving PLMN and Access Type to the corresponding S-NSSAIs values used in the HPLMN.\nIf the AMF provides Partially Allowed NSSAI to the UE, in roaming case the AMF may provide the mapping information of each S-NSSAI of the Partially Allowed NSSAI to the corresponding HPLMN S-NSSAI as described in clause 5.15.17.\nAt any time, the AMF may provide the UE with a new Configured NSSAI for the Serving PLMN, associated with mapping of the Configured NSSAI to HPLMN S-NSSAIs as specified in clause 5.15.4.1. The Configured NSSAI for the Serving PLMN and the mapping information is either determined in the AMF (if based on configuration, the AMF is allowed to determine the Network Slice configuration for the whole PLMN) or by the NSSF. The AMF provides an updated Configured NSSAI as specified in clause 4.2.4 of TS 23.502 [3], UE Configuration Update procedure.\nIf an S-NSSAI is to be stopped to be used, e.g. due to the network slice is to be deleted as described in TS 28.541 [149], the AMFs may reject UE requests for the S-NSSAI based on the OAM state before the network slice becomes unavailable. The AMF may based on operator policies (e.g. when there is no timing information related to the termination or the AMF or UE does not support the timing information as described in in clause 5.15.16), release PDU Sessions associated with the S-NSSAI, and remove the S-NSSAI from e.g. the Allowed NSSAI and the Configured NSSAI before the Network Slice becomes unavailable. The AMF may use the timing information as described in clause 5.15.16 if it supports this feature and set validity time of the S-NSSAI accordingly.\nThe AMF shall provide the UE with NSSRG information alongside the Configured NSSAI if NSSRG information is included in the subscription information received from the UDM and if the UE has indicated support for the feature as part of the registration request, see clause 5.15.12.\nThe AMF may provide the UE with the mapping of old S-NSSAI to the Alternative S-NSSAI if the UE has indicated support for the feature as part of the registration request, see clause 5.15.19.\nIf the HPLMN performs the configuration update of a UE registered in the HPLMN (e.g. due to a change in the Subscribed S-NSSAI(s) or due to a change of NSSRG information), this results in updates to the Configured NSSAI for the HPLMN and, if applicable, NSSRG information for each S-NSSAI of the Configured NSSAI. Updates to the Allowed NSSAI and/or, if present, to the associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are also possible if the configuration update affects S-NSSAI(s) in the current Allowed NSSAI.\nIf the VPLMN performs the configuration update of a UE registered in the VPLMN (e.g. due to a change in the Subscribed S-NSSAI(s), the associated mapping is updated, or due to a change of NSSRG information), this results in updates to the Configured NSSAI for the Serving PLMN and/or to the associated mapping of the Configured NSSAI for the Serving PLMN to HPLMN S-NSSAIs and, if applicable, NSSRG information for each S-NSSAI of the Configured NSSAI. Updates to the Allowed NSSAI and/or to the associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are also possible if the configuration update affects S-NSSAI(s) in the current Allowed NSSAI.\nA UE for which the Configured NSSAI for the Serving PLMN has been updated as described in clause 5.15.4.1 and has been requested to perform a Registration procedure, shall initiate a Registration procedure to receive a new valid Allowed NSSAI (see clause 5.15.5.2.2).\nWhen the subscribed S-NSSAIs change, a UDR flag is set in the HPLMN to make sure the current PLMN (or, if the UE was not reachable, the next serving PLMN) is informed by the UDM that the subscription data for network slicing has changed. The AMF, when it receives the indication from the UDM subscription has changed, indicates the UE that subscription has changed and uses any updated subscription information from the UDM to update the UE. Once the AMF updates the UE and obtains an acknowledgment from the UE, the AMF informs the UDM that the configuration update was successful and the UDM clears the flag in the UDR. If the UE is in a CM-IDLE state, the AMF may trigger Network Triggered Service Request or wait until the UE is in a CM-CONNECTED state as described in clause 4.2.4.2, TS 23.502 [3].\nIf the UE receives indication from the AMF that Network Slicing subscription has changed, the UE locally deletes the network slicing information it has for all PLMNs, except the Default Configured NSSAI (if present). It also updates the current PLMN network slicing configuration information with any received values from the AMF.\nThe update of URSP rules (which include the NSSP), if necessary at any time, is described in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.5\tDetailed Operation Overview",
                            "text_content": "The establishment of User Plane connectivity to a Data Network via a Network Slice instance(s) comprises two steps:\n-\tperforming a RM procedure to select an AMF that supports the required Network Slices.\n-\testablishing one or more PDU Session to the required Data network via the Network Slice instance(s).\nWhen a UE registers over an Access Type with a PLMN, if the UE has either or both of:\n-\ta Configured NSSAI for this PLMN;\n-\tan Allowed NSSAI for this PLMN and Access Type;\nthe UE shall provide to the network, in AS layer under the conditions described in clause 5.15.9 and in NAS layer, a Requested NSSAI containing the S-NSSAI(s) corresponding to the Network Slice(s) to which the UE wishes to register, unless they are stored in the UE in the Pending NSSAI.\nThe Requested NSSAI shall be one of:\n-\tthe Default Configured NSSAI, i.e. if the UE has no Configured NSSAI nor an Allowed NSSAI for the serving PLMN;\n-\tthe Configured-NSSAI, or a subset thereof as described below, e.g. if the UE has no Allowed NSSAI for the Access Type for the serving PLMN;\n-\tthe Allowed-NSSAI for the Access Type over which the Requested NSSAI is sent, or a subset thereof; or\n-\tthe Allowed-NSSAI for the Access Type over which the Requested NSSAI is sent, or a subset thereof, plus one or more S-NSSAIs from the Configured-NSSAI not yet in the Allowed NSSAI for the Access Type as described below.\nNOTE 1:\tIf the UE wishes to register only a subset of the S-NSSAIs from the Configured NSSAI or the Allowed NSSAI, to be able to register with some Network Slices e.g. to establish PDU Sessions for some application(s), and the UE uses the URSP rules (which includes the NSSP) or the UE Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45], then the UE uses applicable the URSP rules or the UE Local Configuration to ensure that the S-NSSAIs included in the Requested NSSAI are not in conflict with the URSP rules or with the UE Local Configuration.\nThe subset of S-NSSAIs in the Configured-NSSAI provided in the Requested NSSAI consists of one or more S-NSSAI(s) in the Configured NSSAI applicable to this PLMN, if one is present, and for which no corresponding S-NSSAI is already present in the Allowed NSSAI for the access type for this PLMN. The UE shall not include in the Requested NSSAI any S-NSSAI that is currently rejected by the network (i.e. rejected in the current registration area or rejected in the PLMN). For the registration to a PLMN for which neither a Configured NSSAI applicable to this PLMN or an Allowed NSSAI are present, the S-NSSAIs provided in the Requested NSSAI correspond to the S-NSSAI(s) in the Default Configured NSSAI unless the UE has HPLMN S-NSSAI for established PDU Session(s) in which case the HPLMN S-NSSAI(s) shall be provided in the mapping of Requested NSSAI in the NAS Registration Request message, with no corresponding VPLMN S-NSSAI in the Requested NSSAI. If the UE has been provided with NSSRG information together with the Configured NSSAI, the UE only includes in the Requested NSSAI S-NSSAIs that share a common NSSRG, see clause 5.15.12.2. If the UE has stored Pending NSSAI and the UE is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG.\nWhen a UE registers over an Access Type with a PLMN, the UE shall also indicate in the Registration Request message when the Requested NSSAI is based on the Default Configured NSSAI.\nThe UE shall include the Requested NSSAI in the RRC Connection Establishment and in the establishment of the connection to the N3IWF/TNGF (as applicable) and in the NAS Registration procedure messages subject to conditions set out in clause 5.15.9. However, the UE shall not indicate any NSSAI in RRC Connection Establishment or Initial NAS message unless it has either a Configured NSSAI for the corresponding PLMN, an Allowed NSSAI for the corresponding PLMN and Access Type, or the Default Configured NSSAI. If the UE has HPLMN S-NSSAI(s) for established PDU Session(s), the HPLMN S-NSSAI(s) shall be provided in the mapping of Requested NSSAI in the NAS Registration Request message, independent of whether the UE has the corresponding VPLMN S-NSSAI. The (R)AN shall route the NAS signalling between this UE and an AMF selected using the Requested NSSAI obtained during RRC Connection Establishment or connection to N3IWF/TNGF respectively. If the (R)AN is unable to select an AMF based on the Requested NSSAI, it routes the NAS signalling to an AMF from a set of default AMFs. In the NAS signalling, if the UE is roaming, the UE provides the mapping of each S-NSSAI of the Requested NSSAI to a corresponding HPLMN S-NSSAI.\nWhen a UE registers with a PLMN, if for this PLMN the UE has not included a Requested NSSAI nor a GUAMI while establishing the connection to the (R)AN, the (R)AN shall route all NAS signalling from/to this UE to/from a default AMF. When receiving from the UE a Requested NSSAI and a 5G-S-TMSI or a GUAMI in RRC Connection Establishment or in the establishment of connection to N3IWF/TNGF, if the 5G-AN can reach an AMF corresponding to the 5G-S-TMSI or GUAMI, then 5G-AN forwards the request to this AMF. Otherwise, the 5G-AN selects a suitable AMF based on the Requested NSSAI provided by the UE and forwards the request to the selected AMF. If the 5G-AN is not able to select an AMF based on the Requested NSSAI, then the request is sent to a default AMF.\nWhen the AMF selected by the AN during Registration Procedure receives the UE Registration request, or after an AMF selection by MME (i.e. during EPS to 5GS handover) the AMF receives S-NSSAI(s) from SMF+PGW-C in 5GC:\n-\tAs part of the Registration procedure described in clause 4.2.2.2.2 of TS 23.502 [3], or as part of the EPS to 5GS handover using N26 interface procedure described in clause 4.11.1.2.2 of TS 23.502 [3], the AMF may query the UDM to retrieve UE subscription information including the Subscribed S-NSSAIs.\n-\tThe AMF verifies whether the S-NSSAI(s) in the Requested NSSAI or the S-NSSAI(s) received from SMF+PGW-C are permitted based on the Subscribed S-NSSAIs (to identify the Subscribed S-NSSAIs the AMF may use the mapping to HPLMN S-NSSAIs provided by the UE, in the NAS message, for each S-NSSAI of the Requested NSSAI).\n-\tWhen the UE context in the AMF does not yet include an Allowed NSSAI for the corresponding Access Type, the AMF queries the NSSF (see (B) below for subsequent handling), except in the case when, based on configuration in this AMF, the AMF is allowed to determine whether it can serve the UE (see (A) below for subsequent handling). The IP address or FQDN of the NSSF is locally configured in the AMF.\nNOTE 2:\tThe configuration in the AMF depends on operator's policy.\n-\tWhen the UE context in the AMF already includes an Allowed NSSAI for the corresponding Access Type, based on the configuration for this AMF, the AMF may be allowed to determine whether it can serve the UE (see (A) below for subsequent handling).\n-\tAMF or NSSF may have previously subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF, optionally for an Area of Interest composed of one or several TAIs. If AMF subscribes to analytics, AMF may determine that it cannot serve the UE based on received analytics (see (A) below). If AMF subscribes to notifications on changes on the Network Slice or Network Slice instance availability information from NSSF optionally indicating a list of supported TAIs, it may determine that it cannot serve the UE after the restriction notification is received (see (A) below). If AMF does not subscribe to notifications on changes on the availability information from NSSF, NSSF may take the analytics information into account when AMF queries NSSF (see (B) below).\nNOTE 3:\tThe configuration in the AMF depends on the operator's policy.\n(A) Depending on fulfilling the configuration as described above, the AMF may be allowed to determine whether it can serve the UE, and the following is performed:\n-\tFor the mobility from EPS to 5GS, the AMF first derives the serving PLMN value(s) of S-NSSAI(s) based on the HPLMN S-NSSAI(s) in the mapping of Requested NSSAI (in CM-IDLE state) or the HPLMN S-NSSAI(s) received from SMF+PGW-C (in CM-CONNECTED state). After that the AMF regards the derived value(s) as the Requested NSSAI.\n-\tFor the inter PLMN within 5GC mobility, the new AMF derives the serving PLMN value(s) of S-NSSAI(s) based on the HPLMN S-NSSAI(s) in the mapping of Requested NSSAI. After that the AMF regards the derived value(s) as the Requested NSSAI.\n-\tAMF checks whether it can serve all the S-NSSAI(s) from the Requested NSSAI present in the Subscribed S-NSSAIs (potentially using configuration for mapping S-NSSAI values between HPLMN and Serving PLMN), or all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs in the case that no Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, i.e. do not match any of the Subscribed S-NSSAIs or not available at the current UE's Tracking Area (see clause 5.15.3). If the AMF is configured with a local policy to include in the Allowed NSSAI subscribed S-NSSAIs that are not in the Requested NSSAI and some of the Subscribed S-NSSAIs are not supported by the AMF, the AMF queries the NSSF (see (B) below).\n-\tIf AMF has subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF, or if AMF had received a Network Slice restriction from NSSF that applies to the list of TAIs supported by the AMF, it may use that information to determine whether the AMF can serve the UE on the S-NSSAI(s) in the Requested NSSAI.\n-\tIf the AMF can serve the S-NSSAIs in the Requested NSSAI and any additional S-NSSAI added due to local policy as described below, the AMF remains the serving AMF for the UE. The Allowed NSSAI is then determined by taking into account the list of S-NSSAI(s) in the Requested NSSAI permitted based on the Subscribed S-NSSAIs and/or the list of S-NSSAI(s) for the Serving PLMN which are mapped to the HPLMN S-NSSAI(s) provided in the mapping of Requested NSSAI permitted based on the Subscribed S-NSSAIs, or, if neither Requested NSSAI nor the mapping of Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs and taking also into account the availability of the Network Slice instances as described in clause 5.15.8 that are able to serve the S-NSSAI(s) in the Allowed NSSAI in the current UE's Tracking Areas in addition to any Network Slice instance restriction for the S-NSSAI(s) in the Allowed NSSAI provided by the NSSF. The AMF based on local policy may determine to include in the Allowed NSSAI additional Subscribed S-NSSAIs e.g. Subscribed S-NSSAIs not marked as default and/or Subscribed S-NSSAIs that were not provided in the Requested NSSAI (See NOTE 4). If the AMF has received NSSRG Information for the Subscribed S-NSSAIs as part of the UE subscription information, it shall only include in the Allowed NSSAI S-NSSAIs that all share a common NSSRG (see clause 5.15.12). If at least one S-NSSAI in the Requested NSSAI is not available in the current UE's Tracking Area, then either the AMF may determine a Target NSSAI or step (B) is executed. The AMF also determines the mapping if the S-NSSAI(s) included in the Allowed NSSAI needs to be mapped to Subscribed S-NSSAI(s) values. If no Requested NSSAI is provided, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, or the Requested NSSAI includes an S-NSSAI that is not valid in the Serving PLMN, or the UE indicated that the Requested NSSAI is based on the Default Configured NSSAI, the AMF, based on the Subscribed S-NSSAI(s) and operator's configuration, may also determine the Configured NSSAI for the Serving PLMN and, if applicable, the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs, so these can be configured in the UE. Then Step (C) is executed.\nNOTE 4:\tThe ability for the AMF to construct the Allowed NSSAI with values not contained in Requested NSSAI but permitted by subscribed NSSAI can be used to allow the UE to use newly-added S-NSSAI(s) in the case of Network Slicing Subscription Change (see clause 4.2.2.2.2 of TS 23.502 [3]).\n-\tElse, the AMF queries the NSSF (see (B) below).\n(B) When required as described above, the AMF needs to query the NSSF, and the following is performed:\n-\tThe AMF queries the NSSF, with Requested NSSAI, Default Configured NSSAI Indication, mapping of Requested NSSAI to HPLMN S-NSSAIs, the Subscribed S-NSSAIs (with an indication if marked as default S-NSSAI), NSSRG Information (if provided by the UDM, see clause 5.15.12), any Allowed NSSAI it might have for the other Access Type (including its mapping to HPLMN S-NSSAIs), PLMN ID of the SUPI and UE's current Tracking Area. If the AMF has pending NSSAI for the UE then the AMF includes pending NSSAI in the Requested NSSAI.\nNOTE 5:\tThe Default Configured NSSAI Indication is provided when received from the UE or when the AMF indicates to the NSSF to return Configured NSSAI in case of the Network Slicing Subscription Change Indication is received from UDM.\n-\tBased on this information, local configuration, and other locally available information including RAN capabilities in the current Tracking Area for the UE or load level information for a Network Slice instance provided by the NWDAF, the NSSF does the following:\n-\tIt verifies which S-NSSAI(s) in the Requested NSSAI are permitted based on comparing the Subscribed S-NSSAIs with the S-NSSAIs in the mapping of Requested NSSAI to HPLMN S-NSSAIs. It considers the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs in the case that no Requested NSSAI was provided or no S-NSSAI from the Requested NSSAI are permitted i.e. are not present in the Subscribed S-NSSAIs or not available e.g. at the current UE's Tracking Area. If NSSRG information is provided, the NSSF only selects S-NSSAIs that share a common NSSRG (see clause 5.15.12).\n-\tIf AMF has not subscribed to notifications on changes on the Network Slice or Network Slice instance availability information from NSSF and NSSF has subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF, NSSF may use the analytics information for the determination of the (Network Slice instance(s) and the) list of S-NSSAI(s) in the Allowed NSSAI(s) to serve the UE.\n-\tIt selects the Network Slice instance(s) to serve the UE. When multiple Network Slice instances in the UE's Tracking Area are able to serve a given S-NSSAI, based on operator's configuration, the NSSF may select one of them to serve the UE, or the NSSF may defer the selection of the Network Slice instance until a NF/service within the Network Slice instance needs to be selected.\n-\tIt determines the target AMF Set to be used to serve the UE, or, based on configuration, the list of candidate AMF(s), possibly after querying the NRF.\nNOTE 6:\tIf the target AMF(s) returned from the NSSF is the list of candidate AMF(s), the Registration Request message can only be redirected via the direct signalling between the initial AMF and the selected target AMF as described in clause 5.15.5.2.3. The NSSF does not provide the target AMF(s), when it provides a Target NSSAI in order to redirect or handover the UE to a cell of another TA as described in clause 5.3.4.3.3.\n-\tIt determines the Allowed NSSAI(s) for the applicable Access Type, by taking into account the list of S-NSSAI(s) in the Requested NSSAI permitted based on the Subscribed S-NSSAIs and/or the list of S-NSSAI(s) for the Serving PLMN which are mapped to the HPLMN S-NSSAIs provided in the mapping of Requested NSSAI permitted based on the Subscribed S-NSSAIs, or, if neither Requested NSSAI nor the mapping of Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs, and taking also into account the availability of the Network Slice instances as described in clause 5.15.8 that are able to serve the S-NSSAI(s) in the Allowed NSSAI in the current UE's Tracking Areas and taking also into account local policy in the NSSF that may determine to include in the Allowed NSSAI additional Subscribed S-NSSAIs e.g. Subscribed S-NSSAIs not marked as default and/or Subscribed S-NSSAIs that were not provided in the Requested NSSAI (see NOTE 7). If NSSRG information applies, the NSSF only selects S-NSSAIs that share a common NSSRG (see clause 5.15.12).\nNOTE 7:\tThe ability for the NSSF to construct the Allowed NSSAI with values not contained in Requested NSSAI but permitted by Subscribed NSSAIs can be used to allow the UE to use newly-added S-NSSAI(s) in the case of Network Slicing Subscription Change (see clause 4.2.2.2.2 of TS 23.502 [3]).\n-\tIt also determines the mapping of each S-NSSAI of the Allowed NSSAI(s) to the Subscribed S-NSSAIs if necessary.\n-\tBased on operator configuration, the NSSF may determine the NRF(s) to be used to select NFs/services within the selected Network Slice instance(s).\n-\tAdditional processing to determine the Allowed NSSAI(s) in roaming scenarios and the mapping to the Subscribed S-NSSAIs, as described in clause 5.15.6.\n-\tIf no Requested NSSAI is provided or the Requested NSSAI includes an S-NSSAI that is not valid in the Serving PLMN, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, the NSSF based on the Subscribed S-NSSAI(s) and operator configuration may also determine the Configured NSSAI for the Serving PLMN and, if applicable, the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs, so these can be configured in the UE. The NSSF shall return a Configured NSSAI when receiving Default Configured NSSAI Indication from the AMF.\n-\tIf at least one S-NSSAI in the Requested NSSAI is not available in the current UE's Tracking Area, the NSSF may provide a Target NSSAI for the purpose of allowing the NG-RAN to redirect the UE to a cell of a TA in another frequency band supporting network slices not available in the current TA as described in clause 5.3.4.3.3.\n-\tThe NSSF returns to the current AMF the Allowed NSSAI for the applicable Access Type, the mapping of each S-NSSAI of the Allowed NSSAI to the Subscribed S-NSSAIs if determined and the target AMF Set, or, based on configuration, the list of candidate AMF(s). The NSSF may return the NRF(s) to be used to select NFs/services within the selected Network Slice instance(s), and the NRF to be used to determine the list of candidate AMF(s) from the AMF Set. The NSSF may return NSI ID(s) to be associated to the Network Slice instance(s) corresponding to certain S-NSSAIs. NSSF may return the rejected S-NSSAI(s) as described in clause 5.15.4.1. The NSSF may return the Configured NSSAI for the Serving PLMN and the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs. The NSSF may return Target NSSAI as described in clause 5.3.4.3.3.\n-\tDepending on the available information and based on configuration, the AMF may query the appropriate NRF (e.g. locally pre-configured or provided by the NSSF) with the target AMF Set. The NRF returns a list of candidate AMFs.\n-\tIf AMF Re-allocation is necessary, the current AMF reroutes the Registration Request or forwards the UE context to a target serving AMF as described in clause 5.15.5.2.3.\n-\tStep (C) is executed.\n(C) The serving AMF shall determine a Registration Area such that all S-NSSAIs of the Allowed NSSAI for this Registration Area are available in all Tracking Areas of the Registration Area (and also considering other aspects as described in clause 5.3.2.3 and clause 5.3.4.3.3) and then return to the UE this Allowed NSSAI and the mapping of the Allowed NSSAI to the Subscribed S-NSSAIs if provided. The AMF may return the rejected S-NSSAI(s) as described in clause 5.15.4.1.\nNOTE 8:\tThe S-NSSAIs in the Allowed NSSAI for Non-3GPP access are available homogeneously \"in the PLMN\" for the N3IWF case since a N3IWF providing access to a 5GC can be reached from any IP location. For other types of Non-3GPP access the S-NSSAIs in the Allowed NSSAI for Non-3GPP access can be not available homogeneously, for example different W-AGFs/TNGF(s) can be deployed in different locations and support different TAIs that support different network slices.\nWhen either no Requested NSSAI was included, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, or a Requested NSSAI is not considered valid in the PLMN and as such at least one S-NSSAI in the Requested NSSAI was rejected as not usable by the UE in the PLMN, or the UE indicated that the Requested NSSAI is based on the Default Configured NSSAI, the AMF may update the UE slice configuration information for the PLMN as described in clause 5.15.4.2.\nIf the Requested NSSAI does not include S-NSSAIs which map to S-NSSAIs of the HPLMN subject to Network Slice-Specific Authentication and Authorization and the AMF determines that no S-NSSAI can be provided in the Allowed NSSAI for the UE in the current UE's Tracking Area and if no default S-NSSAI(s) could be added as described in step (A), the AMF shall reject the UE Registration and shall include in the rejection message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.\nIf the Requested NSSAI includes S-NSSAIs which map to S-NSSAIs of the HPLMN subject to Network Slice-Specific Authentication and Authorization, the AMF shall include in the Registration Accept message an Allowed NSSAI containing only those S-NSSAIs that are not to be subject to Network Slice-Specific Authentication and Authorization and, based on the UE Context in AMF, those S-NSSAIs for which Network Slice-Specific Authentication and Authorization for at least one of the corresponding HPLMN S-NSSAIs succeeded previously regardless the Access Type, if any.\nThe AMF shall also provide the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.\nIf the AMF determined the Target NSSAI or received a Target NSSAI from the NSSF, the AMF should provide the Target NSSAI to the PCF for retrieving a corresponding RFSP as described in clause 5.3.4.3.1 or, if the PCF is not deployed, the AMF should determine a corresponding RFSP based on local configuration. Then the AMF provides the Target NSSAI and the corresponding RFSP to the NG-RAN as described in clause 5.3.4.3.3. The S-NSSAIs which map to S-NSSAIs of the HPLMN subject to an ongoing Network Slice-Specific Authentication and Authorization shall be included in the Pending NSSAI and removed from Allowed NSSAI. The Pending NSSAI may contain a mapping of the S-NSSAI(s) for the Serving PLMN to the HPLMN S-NSSAIs, if applicable. The UE shall not include in the Requested NSSAI any of the S-NSSAIs from the Pending NSSAI the UE stores, regardless of the Access Type.\nIf:\n-\tall the S-NSSAI(s) in the Requested NSSAI are still to be subject to Network Slice-Specific Authentication and Authorization; or\n-\tno Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI matches any of the Subscribed S-NSSAIs, and all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs are to be subject to Network Slice-Specific Authentication and Authorization;\nthe AMF shall provide a \"NSSAA to be performed\" indicator and no Allowed NSSAI to the UE in the Registration Accept message. Upon receiving the Registration Accept message, the UE is registered in the PLMN but shall wait for the completion of the Network Slice-Specific Authentication and Authorization without attempting to use any service provided by the PLMN on any access, except e.g. emergency services (see TS 24.501 [47]), until the UE receives an allowed NSSAI.\nThen, the AMF shall initiate the Network Slice-Specific Authentication and Authorization procedure as described in clause 5.15.10 for each S-NSSAI that requires it, except, based on Network policies, for those S-NSSAIs for which Network Slice-Specific Authentication and Authorization have been already initiated on another Access Type for the same S-NSSAI(s). At the end of the Network Slice-Specific Authentication and Authorization steps, the AMF by means of the UE Configuration Update procedure shall provide a new Allowed NSSAI to the UE which also contains the S-NSSAIs subject to Network Slice-Specific Authentication and Authorization for which the authentication and authorization is successful. The AMF may perform AMF selection when NSSAA completes for the S-NSSAIs subject to NSSAA. If an AMF change is required, this shall be triggered by the AMF using the UE Configuration Update procedure indicating a UE re-registration is required. The S-NSSAIs which were not successfully authenticated and authorized are not included in the Allowed NSSAI and are included in the list of Rejected S-NSSAIs with a rejection cause value indicating Network Slice-Specific Authentication and Authorization failure.\nOnce completed the Network Slice-Specific (re-)Authentication and (re-)Authorization procedure, if the AMF determines that no S-NSSAI can be provided in the Allowed NSSAI for the UE, which is already authenticated and authorized successfully by a PLMN, and if no default S-NSSAI(s) could be added as described in step (A), the AMF shall execute the Network-initiated Deregistration procedure described in clause 4.2.2.3.3 of TS 23.502 [3] and shall include in the explicit De-Registration Request message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.\nIf an S-NSSAI is rejected with a rejection cause value indicating Network Slice-Specific Authentication and Authorization failure or revocation, the UE can re-attempt to request the S-NSSAI based on policy, local in the UE.\nThe set of Network Slices for a UE can be changed at any time while the UE is registered with a network, and may be initiated by the network, or by the UE, under certain conditions as described below.\nThe network, based on local policies, subscription changes and/or UE mobility and/or UE Dispersion data classification, operational reasons (e.g. a Network Slice instance is no longer available or load level information or service experience for a Network Slice or network slice instance provided by the NWDAF), may change the set of Network Slice(s) to which the UE is registered and provide the UE with a new Registration Area and/or Allowed NSSAI and the mapping of this Allowed NSSAI to HPLMN S-NSSAIs, for each Access Type over which the UE is registered. In addition, the network may provide the Configured NSSAI for the Serving PLMN, the associated mapping information, and the rejected S-NSSAIs. The network may perform such a change over each Access Type during a Registration procedure or trigger a notification towards the UE of the change of the Network Slices using a UE Configuration Update procedure as specified in clause 4.2.4 of TS 23.502 [3]. The new Allowed NSSAI(s) and the mapping to HPLMN S-NSSAIs are determined as described in clause 5.15.5.2.1 (an AMF Re-allocation may be needed). The AMF provides the UE with:\n-\tan indication that the acknowledgement from UE is required;\n-\tConfigured NSSAI for the Serving PLMN (if required), rejected S-NSSAI(s) (if required) and TAI list, and\n-\tthe new Allowed NSSAI with the associated mapping of Allowed NSSAI for each Access Type (as applicable) unless the AMF cannot determine the new Allowed NSSAI (e.g. all S-NSSAIs in the old Allowed NSSAI have been removed from the Subscribed S-NSSAIs).\nFurthermore:\n-\tIf the changes to the Allowed NSSAI require the UE to perform immediately a Registration procedure because they affect the existing connectivity to AMF (e.g. the new S-NSSAIs require a separate AMF that cannot be determined by the current serving AMF, or the AMF cannot determine the Allowed NSSAI) or due to AMF local policies also when the changes does not affect the existing connectivity to AMF:\n-\tThe serving AMF indicates to the UE the need for the UE to perform a Registration procedure without including the GUAMI or 5G-S-TMSI in the access stratum signalling after entering CM-IDLE state. The AMF shall release the NAS signalling connection to the UE to allow to enter CM-IDLE after receiving the acknowledgement from UE.\n-\tWhen the UE receives indications to perform a Registration procedure without including the GUAMI or 5G-S-TMSI in the access stratum signalling after entering CM-IDLE state, then:\n-\tThe UE deletes any stored (old) Allowed NSSAI and associated mapping as well as any (old) rejected S-NSSAI.\n-\tThe UE shall initiate a Registration procedure with the registration type Mobility Registration Update after the UE enters CM-IDLE state as specified in as described in step 4 of clause 4.2.4.2 of TS 23.502 [3]. The UE shall include a Requested NSSAI (as described in clause 5.15.5.2.1) with the associated mapping of Requested NSSAI in the Registration Request message. Also, the UE shall include, subject to the conditions set out in clause 5.15.9, a Requested NSSAI in access stratum signalling but no GUAMI.\n-\tIf the AMF determines that the S-NSSAI in the Allowed NSSAI is replaced with Alternative S-NSSAI, the AMF provides the mapping of old S-NSSAI to the Alternative S-NSSAI to the UE (as described in clause 5.15.19).\nIf there is an established PDU Session associated with emergency services, then the serving AMF indicates to the UE the need for the UE to perform a Registration procedure but does not release the NAS signalling connection to the UE. The UE performs the Registration procedure only after the release of the PDU Session used for the emergency services.\nIn addition to sending the new Allowed NSSAI to the UE, when a Network Slice used for a one or multiple PDU Sessions is no longer available for a UE, the following applies:\n-\tIf the Network Slice becomes no longer available under the same AMF and the Network Slice Replacement is not used (e.g. due to UE subscription change), the AMF indicates to the SMF(s) which PDU Session ID(s) corresponding to the relevant S-NSSAI shall be released. SMF releases the PDU Session according to clause 4.3.4.2 of TS 23.502 [3]. If the Network Slice Replacement is used, the AMF performs Network Slice Replacement as described in clause 5.15.19.\n-\tIf the Network Slice becomes no longer available upon a change of AMF (e.g. due to Registration Area change), the new AMF indicates to the old AMF that the PDU Session(s) corresponding to the relevant S-NSSAI shall be released. The old AMF informs the corresponding SMF(s) to release the indicated PDU Session(s). The SMF(s) release the PDU Session(s) as described in clause 4.3.4 of TS 23.502 [3]. Then the new AMF modifies the PDU Session Status correspondingly. The PDU Session(s) context is locally released in the UE after receiving the PDU Session Status in the Registration Accept message.\nThe UE uses either the URSP rules (which includes the NSSP) or the UE Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45] to determine whether ongoing traffic can be routed over existing PDU Sessions belonging to other Network Slices or establish new PDU Session(s) associated with same/other Network Slice.\nIn order to change the set of S-NSSAIs the UE is registered to over an Access Type, the UE shall initiate a Registration procedure over this Access Type as specified in clause 5.15.5.2.1.\nIf, for an established PDU Session:\n-\tnone of the values of the S-NSSAIs of the HPLMN in the mapping of the Requested NSSAI to S-NSSAIs of the HPLMN included in the Registration Request matches the S-NSSAI of the HPLMN associated with the PDU Session; or\n-\tnone of the values of the S-NSSAIs in the Requested NSSAI matches the value of the S-NSSAI of HPLMN associated with the PDU Session and the mapping of the Requested NSSAI to S-NSSAIs of the HPLMN is not included in the Registration Request,\nthe network shall release this PDU Session as follows.\n-\tthe AMF informs the corresponding SMF(s) to release the indicated PDU Session(s). The SMF(s) release the PDU Session(s) as described in clause 4.3.4 of TS 23.502 [3]. Then the AMF modifies the PDU Session Status correspondingly. The PDU Session(s) context is locally released in the UE after receiving the PDU Session Status from the AMF.\nA change of the set of S-NSSAIs (whether UE or Network initiated) to which the UE is registered may, subject to operator policy, lead to AMF change, as described in clause 5.15.5.2.1.\nIf the AMF supports the Network Slice Replacement feature and is configured to use the NSSF to trigger the Network Slice Replacement, the AMF subscribes with the NSSF for notifications when any of the S-NSSAIs served by the AMF (e.g. the S-NSSAI in the Serving PLMN and the HPLMN S-NSSAI in roaming case) has to be replaced as described in clause 5.15.19.\nIf the AMF supports the Network Slice Instance Replacement and configured to use Network Slice Instance Replacement, the AMF subscribes with the NSSF for notifications when a Network Slice instances served by the AMF is congested or no longer available as described in clause 5.15.20.\nThe AMF may perform Network Slice Replacement for the PDU Session as described in clause 5.15.19.\nDuring a Registration procedure in a PLMN, if the network decides that the UE should be served by a different AMF based on Network Slice(s) aspects, then the AMF that first received the Registration Request shall redirect the Registration request to target AMF via the 5G-AN or via direct signalling between the initial AMF and the target AMF. If the target AMF(s) are returned from the NSSF and identified by a list of candidate AMF(s), the redirection message shall only be sent via the direct signalling between the initial AMF and the target AMF. If the redirection message is sent by the AMF via the 5G-AN, the message shall include information for selection of a new AMF to serve the UE.\nWhen during a Registration procedure the UE requests a new S-NSSAI which is not supported in the UE's current Tracking Area, the serving AMF itself or by interacting with the NSSF as described in clause 5.15.5.2.1 may determine a Target NSSAI. The AMF provides the Target NSSAI to the NG-RAN and the NG-RAN may apply redirection or handover of the UE to a cell in another TA supporting the Target NSSAI as described in clause 5.3.4.3.3.\nDuring a EPS to 5GS handover using N26 interface procedure, if the network decides that the UE should be served by a different AMF based on Network Slice(s) aspects, then the AMF, which received the Forward Relocation Request from MME, shall forward the UE context to target AMF via direct signalling between the initial AMF and the target AMF as described in clause 4.11.1.2.2 of TS 23.502 [3].\nFor a UE that is already registered, the system shall support a redirection initiated by the network of a UE from its serving AMF to a target AMF due to Network Slice(s) considerations (e.g. the operator has changed the mapping between the Network Slice instances and their respective serving AMF(s)). Operator policy determines whether redirection between AMFs is allowed.\nThe PDU Session Establishment in a Network Slice instance to a DN allows data transmission in a Network Slice instance. A PDU Session is associated to an S-NSSAI and a DNN. A UE that is registered in a PLMN over an Access Type and has obtained a corresponding Allowed NSSAI, shall indicate in the PDU Session Establishment procedure the S-NSSAI according to the NSSP in the URSP rules or according to the UE Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45], and, if available, the DNN the PDU Session is related to. The UE includes the appropriate S-NSSAI from this Allowed NSSAI and, if mapping of the Allowed NSSAI to HPLMN S-NSSAIs was provided, an S-NSSAI with the corresponding value from this mapping.\nIf the UE cannot determine any S-NSSAI after performing the association of the application to a PDU Session according to clause 6.1.2.2.1 of TS 23.503 [45], the UE shall not indicate any S-NSSAI in the PDU Session Establishment procedure.\nThe network (HPLMN) may provision the UE with Network Slice selection policy (NSSP) as part of the URSP rules, see clause 6.6.2 of TS 23.503 [45]. When the Subscription Information contains more than one S-NSSAI and the network wants to control/modify the UE usage of those S-NSSAIs, then the network provisions/updates the UE with NSSP as part of the URSP rules. When the Subscription Information contains only one S-NSSAI, the network needs not provision the UE with NSSP as part of the URSP rules. The NSSP rules associate an application with one or more HPLMN S-NSSAIs. A default rule which matches all applications to a HPLMN S-NSSAI may also be included.\nThe UE shall store and use the URSP rules, including the NSSP, as described in TS 23.503 [45]. When a UE application associated with a specific S-NSSAI requests data transmission:\n-\tif the UE has one or more PDU Sessions established corresponding to the specific S-NSSAI, the UE routes the user data of this application in one of these PDU Sessions, unless other conditions in the UE prohibit the use of these PDU Sessions. If the application provides a DNN, then the UE considers also this DNN to determine which PDU Session to use. This is further described in clause 6.6.2 of TS 23.503 [45].\n-\tIf the UE does not have a PDU Session established with this specific S-NSSAI, the UE requests a new PDU Session corresponding to this S-NSSAI and with the DNN that may be provided by the application. In order for the RAN to select a proper resource for supporting network slicing in the RAN, RAN needs to be aware of the Network Slices used by the UE. This is further described in clause 6.6.2 of TS 23.503 [45].\nIf the AMF is not able to determine the appropriate NRF to query for the S-NSSAI provided by the UE, the AMF may query the NSSF with this specific S-NSSAI, location information, PLMN ID of the SUPI. The NSSF determines and returns the appropriate NRF to be used to select NFs/services within the selected Network Slice instance. The NSSF may also return an NSI ID to be used to select NFs within the selected Network Slice instance to use for this S-NSSAI.\nThe AMF or NSSF may select an S-NSSAI (if the UE does not provide an S-NSSAI for the PDU session establishment) and a Network Slice instance, based on load level and/or Observe Service Experience and/or Dispersion analytics from NWDAF, as described in TS 23.288 [86].\nThe IP address or FQDN of the NSSF is locally configured in the AMF.\nSMF discovery and selection within the selected Network Slice instance is initiated by the AMF when a SM message to establish a PDU Session is received from the UE. The appropriate NRF is used to assist the discovery and selection tasks of the required network functions for the selected Network Slice instance.\nThe AMF queries the appropriate NRF to select an SMF in a Network Slice instance based on S-NSSAI, DNN, NSI-ID (if available) and other information e.g. UE subscription and local operator policies, when the UE triggers PDU Session Establishment. The AMF may select the SMF among the set of the SMF instance(s) returned by the NRF or locally configured in the AMF, based on network data analytics (NF load, etc.) from the NWDAF as described in TS 23.288 [86]. The selected SMF establishes a PDU Session based on S-NSSAI and DNN.\nWhen the AMF belongs to multiple Network Slice instances, based on configuration, the AMF may use an NRF at the appropriate level for the SMF selection.\nFor further details on the SMF selection, refer to clause 4.3.2.2.3 of TS 23.502 [3].\nWhen a PDU Session for a given S-NSSAI is established using a specific Network Slice instance, the CN provides to the (R)AN the S-NSSAI corresponding to this Network Slice instance to enable the RAN to perform access specific functions.\nThe UE shall not perform PDU Session handover from one Access Type to another if the S-NSSAI of the PDU Session is not included in the Allowed NSSAI of the target Access Type.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.6\tNetwork Slicing Support for Roaming",
                            "text_content": "For roaming scenarios:\n-\tIf the UE only uses standard S-NSSAI values, then the same S-NSSAI values can be used in VPLMN as in the HPLMN.\n-\tIf the VPLMN and HPLMN have an SLA to support non-standard S-NSSAI values in the VPLMN, the NSSF of the VPLMN maps the Subscribed S-NSSAIs values to the respective S-NSSAI values to be used in the VPLMN. The S-NSSAI values to be used in the VPLMN are determined by the NSSF of the VPLMN based on the SLA. The NSSF of the VPLMN need not inform the HPLMN of which values are used in the VPLMN.\nDepending on operator's policy and the configuration in the AMF, the AMF may decide the S-NSSAI values to be used in the VPLMN and the mapping to the Subscribed S-NSSAIs.\nFor the home routed case, the AMF or NSSF may select an S-NSSAI (if the UE does not provide an S-NSSAI for the PDU session establishment) and a Network Slice instance, based on load level and/or Observe Service Experience and/or Dispersion analytics of the VPLMN and/or that of the HPLMN from NWDAF as described in TS 23.288 [86].\n-\tThe UE constructs Requested NSSAI and provides the mapping of S-NSSAIs of the Requested NSSAI to HPLMN S-NSSAIs if the mapping is stored in the UE, as described in clause 5.15.5.2.1.\n-\tThe NSSF in the VPLMN determines the Allowed NSSAI without interacting with the HPLMN.\n-\tthe HPLMN may provide NSSRG Information as part of the Subscription information as described in clause 5.15.12.\n-\tThe Allowed NSSAI in the Registration Accept includes S-NSSAI values used in the VPLMN. The mapping information described above is also provided to the UE with the Allowed NSSAI as described in clause 5.15.4.\n-\tIf the S-NSSAI values are subject to NSAC, depending on operator's policy, a roaming agreement or an SLA between VPLMN and HPLMN, the AMF or SMF in VPLMN triggers a request for NSAC for these S-NSSAI values as described in clause 5.15.11.3.\n-\tIn PDU Session Establishment procedure, the UE includes both:\n(a)\tthe S-NSSAI that matches the application (that is triggering the PDU Session Request) within the NSSP in the URSP rules or within the UE Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45]; the value of this S NSSAI is used in the HPLMN; and\n(b)\tan S-NSSAI belonging to the Allowed NSSAI that maps to (a) using the mapping of the Allowed NSSAI to HPLMN S-NSSAIs; the value of this S-NSSAI is used in the VPLMN.\nFor the home routed case, the AMF may select the V-SMF and the H-SMF based on network data analytics (NF load, etc.) of the VPLMN and that of the HPLMN from the NWDAF as described in TS 23.288 [86]. The V-SMF sends the PDU Session Establishment Request message to the H-SMF along with the S-NSSAI with the value used in the HPLMN (a). If the S-NSSAI values are subject to NSAC, the V-SMF or H-SMF triggers a request for NSAC for these S-NSSAI values as described in clause 5.15.11.3.\n-\tWhen a PDU Session is established, the CN provides to the AN the S-NSSAI with the value from the VPLMN corresponding to this PDU Session, as described in clause 5.15.5.3.\n-\tThe Network Slice instance specific network functions in the VPLMN are selected by the VPLMN by using the S-NSSAI with the value used in the VPLMN and querying an NRF that has either been pre-configured, or provided by the NSSF in the VPLMN. The Network Slice specific functions of the HPLMN (if applicable) are selected by the VPLMN by using the related S-NSSAI with the value used in the HPLMN via the support from an appropriate NRF in the HPLMN, identified as specified in clause 4.17.5 of TS 23.502 [3] and, for SMF in clause 4.3.2.2.3.3 of TS 23.502 [3].\n-\tIf the serving AMF supports the Network Slice Replacement feature and is configured to use the NSSF for Network Slice Replacement triggering, the AMF subscribes with the NSSF of the VPLMN for notifications when an HPLMN S-NSSAI needs to be replaced with an Alternative S-NSSAI, in addition to notifications for the Serving PLMN S-NSSAIs. The NSSF of the VPLMN shall subscribe with the NSSF of the HPLMN for notifications when an HPLMN S-NSSAI needs to be replaced with an Alternative S-NSSAI.\n-\tIf the serving AMF support the Network Slice Instance Replacement and configured to use Network Slice Instance Replacement, the AMF subscribes with the NSSF of the VPLMN for notifications when a Network Slice instance is congested or no longer available as described in clause 5.15.19. The NSSF of the VPLMN shall subscribe with the NSSF of the HPLMN for notifications when the Network Slice instance is congested or no longer available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.7\tNetwork slicing and Interworking with EPS",
                            "text_content": "A 5GS supports Network Slicing and might need to interwork with the EPS in its PLMN or in other PLMNs as specified in clause 5.17.2. The EPC may support the Dedicated Core Networks (DCN). In some deployments, the MME selection may be assisted by a DCN-ID provided by the UE to the RAN (see TS 23.401 [26]).\nMobility between 5GC to EPC does not guarantee all active PDU Session(s) can be transferred to the EPC.\nDuring PDN connection establishment in the EPC, the UE allocates the PDU Session ID and sends it to the SMF+PGW-C via PCO. As described in clause 4.11.0a.5 of TS 23.502 [3], an S-NSSAI associated with the PDN connection is determined based on the S-NSSAI(s) supported by the SMF+PGW-C, the Subscribed S-NSSAI from UDM, whether interworking with EPS is supported for the DNN and S-NSSAI in the Session Management Subscription data and the operator policy by the SMF+PGW-C, e.g. based on a combination of SMF+PGW-C address and APN, and is sent to the UE in PCO together with a PLMN ID that the S-NSSAI relates to. In Home Routed roaming case, the UE receives a HPLMN S-NSSAI value from the SMF+PGW-C. If the SMF+PGW-C supports more than one S-NSSAI and the APN is valid for more than one S-NSSAI, the SMF+PGW-C should only select an S-NSSAI that is mapped to the subscribed S-NSSAI of the UE and this subscribed S-NSSAI is not subject to Network Slice-Specific Authentication and Authorization. The UE stores this S-NSSAI and the PLMN ID associated with the PDN connection. The UE derives Requested NSSAI by taking into account of the received PLMN ID. The Requested NSSAI is included in the NAS Registration Request message and, subject to the conditions in clause 5.15.9, the RRC message carrying this Registration Request when the UE registers in 5GC if the UE is non-roaming or the UE has Configured NSSAI for the VPLMN in roaming case. If the UE has no Configured NSSAI of the VPLMN, the UE includes the HPLMN S-NSSAIs in the NAS Registration Request message as described in clause 5.15.5.2.1.\nWhen UE moves from EPS to 5GS, AMF reallocation may happen as described in clause 5.15.7.2 and clause 5.15.7.3.\nNOTE:\tIt is assumed that if a MME is configured with a N26 interface towards an AMF, the MME has N26 interfaces with all AMFs serving the same area than the initial AMF and that can serve UE subject to EPS to 5GS mobility.\nIn addition to the interworking principles documented in clause 5.17.2 the following applies for interworking with N26:\n-\tWhen UE moves from 5GS to EPS, the UE context information sent by AMF to MME includes the UE Usage type, which is retrieved from UDM by AMF as part of subscription data.\n-\tWhen UE moves from EPS to 5GS, then the UE includes the S-NSSAIs (with values for the Serving PLMN of the target 5GS, if available) associated with the established PDN connections in the Requested NSSAI in RRC Connection Establishment (subject to the conditions set out in clause 5.15.9) and NAS. The UE also provides to the AMF in the Registration Request message the mapping information as described in clause 5.15.6. The UE derives the S-NSSAIs values for the Serving PLMN by using the latest available information from EPS (if received in PCO) and from 5GS (e.g. based on URSP, Configured NSSAI, Allowed NSSAI). In the home-routed roaming case, the AMF selects default V-SMFs. The SMF+PGW-C sends PDU Session IDs and related S-NSSAIs to AMF. The AMF derives S-NSSAI values for the Serving PLMN as described in clause 5.15.5.2.1 and determines whether the AMF is the appropriate AMF to serve the UE. If not, the AMF reallocation may need be triggered. For each PDU Session the AMF determines whether the V-SMF need be reselected based on the associated S-NSSAI value for the Serving PLMN. If the V-SMF need be reallocated, i.e. change from the default V-SMF to another V-SMF, the AMF trigger the V-SMF reallocation as described in clause 4.23.3 of TS 23.502 [3].\nIn addition to the interworking principles documented in clause 5.17.2 the following applies for interworking without N26:\n-\tWhen the UE initiates the Registration procedure, and subject to the conditions set out in clause 5.15.9, the UE includes the S-NSSAI (with values for the Serving PLMN of the target 5GS) associated with the established PDN connections in the Requested NSSAI in the RRC Connection Establishment.\n-\tThe UE includes the S-NSSAIs (with values for the Serving PLMN of the target 5GS, if available) and the HPLMN S-NSSAI received in the PCO for the PDN connections as mapping information when moving PDN connections to 5GC using PDU Session Establishment Request message. The UE derives the S-NSSAIs values for the Serving PLMN by using, the latest available information from EPS (if received in PCO) and from 5GS (e.g. based on URSP, Configured NSSAI, Allowed NSSAI).\nIn addition to the interworking principles documented in clause 5.17.2 the following applies for interworking with N26:\n-\tWhen a UE is CM-CONNECTED in 5GC and a handover to EPS occur, the AMF selects the target MME based on the source AMF Region ID, AMF Set ID and target location information. The AMF forwards the UE context to the selected MME over the N26 Interface. In the UE context, the AMF also includes the UE Usage type, if it is received as part of subscription data. The Handover procedure is executed as documented in TS 23.502 [3]. When the Handover procedure completes successfully the UE performs a Tracking Area Update. This completes the UE registration in the target EPS. As part of this the UE obtains a DCN-ID if the target EPS uses it.\n-\tWhen a UE is ECM-CONNECTED in EPC, and performs a handover to 5GS, the MME selects the target AMF based on target location information, e.g. TAI and any other available local information (including the UE Usage Type if one is available for the UE in the subscription data) and forwards the UE context to the selected AMF over the N26 interface. In the home-routed roaming case, the AMF selects default V-SMFs. The Handover procedure is executed as documented in TS 23.502 [3]. The SMF+PGW-C sends PDU Session IDs and related S-NSSAIs to AMF. Based on the received S-NSSAIs values the target AMF derives the S-NSSAI values for the Serving PLMN, the target AMF reselects a final target AMF if necessary as described in clause 5.15.5.2.1, the AMF reallocation procedure is triggered. For each PDU Session based on the associated derived S-NSSAI values if the V-SMF need be reallocated, the final target AMF triggers the V-SMF reallocation as described in clause 4.23.2 of TS 23.502 [3]. When the Handover procedure completes successfully the UE performs a Registration procedure. This completes the UE registration in the target 5GS and as part of this the UE obtains an Allowed NSSAI.\nAs described in clause 5.15.15, if Network Slice usage control is required for a PDN Connection, the SMF+PGW-C configures PDU Session inactivity timer to the UPF+PGW-U. When the SMF+PGW-C receives inactivity report of the PDN Connection from the UPF+PGW-U, the SMF+PGW-C releases the PDN Connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.8\tConfiguration of Network Slice availability in a PLMN",
                            "text_content": "A Network Slice may be supported in the whole PLMN or in one or more Tracking Areas of the PLMN. Network Slices may also be available with an NS-AoS not matching deployed Tracking Areas as defined in clause 5.15.18.\nThe availability of a Network Slice refers to the support of the S-NSSAI in the involved NFs. In addition, policies in the NSSF may further restrict from using certain Network Slices in a particular TA, e.g. depending on the HPLMN of the UE. The UE can receive, for a Network Slice where the NS-AoS does not match the whole set of cells in one or more TAs, S-NSSAI location availability information as described in clause 5.15.18.\nThe support of a Network Slice in a TA is established end-to-end using a combination of OAM and signalling among network functions. It is derived by using the S-NSSAIs supported per TA in 5G-AN, the S-NSSAIs supported in the AMF and operator policies per TA in the NSSF.\nThe AMF learns the S-NSSAIs supported per TA by the 5G-AN when the 5G-AN nodes establish or update the N2 connection with the AMF (see TS 38.413 [34]) and TS 38.300 [27]). One or all AMF per AMF Set provides and updates the NSSF with the S-NSSAIs support per TA. The 5G-AN learns the S-NSSAIs per PLMN ID the AMFs it connects to support when the 5G-AN nodes establishes the N2 connection with the AMF or when the AMF updates the N2 connection with the 5G-AN (see TS 38.413 [34] and TS 38.300 [27]).\nThe NSSF may be configured with operator policies specifying under what conditions the S-NSSAIs can be restricted per TA and per HPLMN of the UE.\nThe per TA restricted S-NSSAIs may be provided to the AMFs of the AMF Sets at setup of the network and whenever changed.\nThe AMF may be configured for the S-NSSAIs it supports with operator policies specifying any restriction per TA and per HPLMN of the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.9\tOperator-controlled inclusion of NSSAI in Access Stratum Connection Establishment",
                            "text_content": "The Serving PLMN can control per Access Type which (if any) NSSAI the UE includes in the Access Stratum when establishing a connection caused by Service Request, Periodic Registration Update or Registration procedure used to update the UE capabilities. In addition, the Home and Visited PLMNs can also instruct the UE to never include NSSAI in the Access Stratum, regardless of the procedure that causes a RRC Connection to be established, i.e. to always enable privacy for the NSSAI).\nDuring the Registration procedure, the AMF may provide to the UE in the Registration Accept message, an Access Stratum Connection Establishment NSSAI Inclusion Mode parameter, indicating whether and when the UE shall include NSSAI information in the Access Stratum Connection Establishment (e.g. an RRC connection Establishment defined in TS 38.331 [28]) according to one of these modes:\na)\tThe UE shall include an NSSAI set to the Allowed NSSAI, if available, in the Access Stratum Connection Establishment caused by a Service Request, Periodic Registration Update or Registration procedure used to update the UE capabilities;\nb)\tThe UE shall include a NSSAI with the following content:\n-\tfor the case of Access Stratum Connection Establishment caused by a Service Request: an NSSAI including the S-NSSAI(s) of the Network Slice(s) that trigger the Access Stratum Connection Establishment; i.e. all the S-NSSAIs of the PDU sessions that have the User Plane reactivated by the Service Request, or the S-NSSAIs of the Network Slices a Control Plane interaction triggering the Service Request is related to, e.g. for SM it would be the S-NSSAI of the PDU Session the SM message is about;\n-\tfor the case of Access Stratum Connection Establishment caused by a Periodic Registration Update or Registration procedure used to update the UE capabilities, an NSSAI set to the Allowed NSSAI;\nc)\tThe UE shall not include any NSSAI in the Access Stratum Connection Establishment caused by Service Request, Periodic Registration Update or Registration procedure used to update the UE capabilities; or\nd)\tThe UE shall not provide NSSAI in the Access stratum.\nFor the case of Access Stratum Connection Establishment caused by Mobility Registration Update or Initial Registration in modes a), b) or c) the UE shall include the Requested NSSAI provided by the NAS layer and defined in clause 5.15.5.2.1.\nFor all UEs that are allowed to use modes a), b) or c), the Access Stratum Connection Establishment NSSAI Inclusion Mode should be the same over the same Registration Areas.The UE shall store and comply to the required behaviour for a PLMN per Access Type as part of the network slicing configuration. The Serving PLMN AMF shall not instruct the UE to operate in any other mode than mode d) in 3GPP Access Type unless the HPLMN provides an indication that it is allowed to do so (i.e. if a PLMN allows behaviours a,b,c, then its UDM sends to the serving AMF an explicit indication that the NSSAI can be included in RRC as part of the subscription data).\nThe UE default mode of operation is the following:\n-\tFor 3GPP access the UE shall by default operate in mode d) unless it has been provided with an indication to operate in mode a), b) or c).\n-\tFor untrusted non-3GPP access the UE shall operate by default in mode b) unless it has been provided with an indication to operate in mode a), c) or d).\n-\tFor trusted non-3GPP access the UE shall operate by default in mode d) unless it has been provided with an indication to operate in mode a), b) or c).\n-\tFor W-5GAN access the 5G-RG shall operate by default in mode b) unless it has been provided with an indication to operate in mode a), c) or d).\nAn operator may pre-configure the UE to operate by default according to mode c) in the HPLMN (i.e. the UE by default includes NSSAI in the access stratum when it performs an Initial Registration and Mobility Registration Update with the HPLMN until the HPLMN changes the mode as described above).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.10\tNetwork Slice-Specific Authentication and Authorization",
                            "text_content": "A serving PLMN or SNPN shall perform Network Slice-Specific Authentication and Authorization for the S-NSSAIs of the HPLMN or SNPN which are subject to it based on subscription information. The UE shall indicate in the Registration Request message in the UE 5GMM Core Network Capability whether it supports NSSAA feature. If the UE does not support NSSAA feature and if the UE requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, the AMF shall not trigger this procedure for the UE and they are rejected for the PLMN or SNPN. If the UE supports NSSAA feature and if the UE requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, they are included in the list of Pending NSSAI for the PLMN or SNPN, as described in clause 5.15.5.2.1.\nIf a UE is configured with S-NSSAIs, which are subject to Network Slice-Specific Authentication and Authorization, the UE stores an association between the S-NSSAI and corresponding credentials for the Network Slice-Specific Authentication and Authorization.\nNOTE 1:\tHow the UE is aware that an S-NSSAI is subject to Network Slice-Specific Authentication and Authorization (e.g. based on local configuration) is out of scope of this specification.\nThe UE may support remote provisioning of credentials for NSSAA, specified in clause 5.39.\nA UE that supports to be provisioned with the credentials used for NSSAA over UP remote provisioning shall use connectivity over an S-NSSAI/DNN which can access the provisioning server to establish a PDU session for remote provisioning as defined in clause 5.39.\nNOTE 2:\tThe credentials for Network Slice-Specific Authentication and Authorization are not specified.\nTo perform the Network Slice-Specific Authentication and Authorization for an S-NSSAI, the AMF invokes an EAP- based Network Slice-Specific authorization procedure documented in clause 4.2.9 of TS 23.502 [3] (see also TS 33.501 [29]) for the S-NSSAI. When an NSSAA procedure is started and is ongoing for an S-NSSAI, the AMF stores the NSSAA status of the S-NSSAI as pending and when the NSSAA is completed the S-NSSAI becomes either part of the Allowed NSSAI or a Rejected S-NSSAI. The NSSAA status of each S-NSSAI, if any is stored, is transferred when the AMF changes.\nThis procedure can be invoked for a supporting UE by an AMF at any time, e.g. when:\na.\tThe UE registers with the AMF and one of the S-NSSAIs of the HPLMN or SNPN which maps to an S-NSSAI in the Requested NSSAI is requiring Network Slice-Specific Authentication and Authorization (see clause 5.15.5.2.1 for details), and the S-NSSAI in the Requested NSSAI can be added to the Allowed NSSAI by the AMF once the Network Slice-Specific Authentication and Authorization for the HPLMN or SNPN S-NSSAI succeeds; or\nb.\tThe Network Slice-Specific AAA Server triggers a UE re-authentication and re-authorization for an S-NSSAI; or\nc.\tThe AMF, based on operator policy or a subscription change, decides to initiate the Network Slice-Specific Authentication and Authorization procedure for a certain S-NSSAI which was previously authorized.\nIn the case of re-authentication and re-authorization (b. and c. above) the following applies:\n-\tIf S-NSSAIs that are requiring Network Slice-Specific Authentication and Authorization map to S-NSSAIs that are included in the Allowed NSSAI for each Access Type, AMF selects an Access Type to be used to perform the Network Slice Specific Authentication and Authorization procedure based on network policies.\n-\tIf the Network Slice-Specific Authentication and Authorization for some S-NSSAIs mapped to some S-NSSAIs in the Allowed NSSAI is unsuccessful, the AMF shall update the Allowed NSSAI for each Access Type to the UE via UE Configuration Update procedure.\n-\tIf the Network Slice-Specific Authentication and Authorization fails for all S-NSSAIs mapped to all S-NSSAIs in the Allowed NSSAI, the AMF determines a new Allowed NSSAI including default S-NSSAI(s). If no default S-NSSAI(s) could be added, the AMF shall execute the Network-initiated Deregistration procedure described in clause 4.2.2.3.3 of TS 23.502 [3] and shall include in the explicit De-Registration Request message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.\nAfter a successful or unsuccessful UE Network Slice-Specific Authentication and Authorization, the UE context in the AMF shall retain the authentication and authorization status for the UE for the related specific S-NSSAI of the HPLMN or SNPN while the UE remains RM-REGISTERED in the PLMN or SNPN, so that the AMF is not required to execute a Network Slice-Specific Authentication and Authorization for a UE at every Periodic Registration Update or Mobility Registration procedure with the PLMN or SNPN.\nA Network Slice-Specific AAA server may revoke the authorization or challenge the authentication and authorization of a UE at any time. When authorization is revoked for an S-NSSAI that maps to an S-NSSAI in the current Allowed NSSAI for an Access Type, the AMF shall provide a new Allowed NSSAI to the UE and trigger the release of all PDU sessions associated with the S-NSSAI, for this Access Type.\nThe AMF provides the GPSI of the UE related to the S-NSSAI to the AAA Server to allow the AAA server to initiate the Network Slice-Specific Authentication and Authorization, or the Authorization revocation procedure, where the current AMF serving the UE needs to be identified by the system, so the UE authorization status can be challenged or revoked.\nThe Network Slice-Specific Authentication and Authorization requires that the UE Primary Authentication and Authorization of the SUPI has successfully completed. If the SUPI authorization is revoked, then also the Network Slice-Specific authorization is revoked.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.11\tNetwork Slice Admission Control",
                            "text_content": "The Network Slice Admission Control Function (NSACF) monitors and controls the number of registered UEs per network slice and/or the number of PDU Sessions per network slice for the network slices that are subject to Network Slice Admission Control (NSAC). The NSACF is configured with the maximum number of UEs and/or the maximum number of PDU Sessions allowed to be served per S-NSSAI subject to NSAC. The NSACF is also configured with information indicating applicable access type(s) for the S-NSSAI (i.e. 3GPP Access Type, Non-3GPP Access Type, or both).\nThe NSACF also provides event-based Network Slice status notifications and reports to the consumer NFs (e.g. AF).\nA NSACF can be configured with the NSAC Service Area(s) it serves. The NSAC Service Area Identifier is a unique identifier in a PLMN or SNPN. The consumer NFs which use the NSAC services are configured with a single and network slice independent value of the NSAC Service Area Identifier so they can discover the correct NSACF (see clause 6.3.22).\nThe NSACF may be responsible for one or more S-NSSAIs. For one S-NSSAI there may be one or multiple NSACFs deployed in a network (a PLMN or a SNPN) as follows:\n-\tIf a PLMN or SNPN is configured with a single NSAC service area, there is a single NSACF configured with the maximum number of UEs per network slice and/or the maximum number of PDU Sessions per network slice, which are valid in the network. In this case there is no need to provision any NSAC Service Area Identifier value in the PLMN or SNPN.\n-\tIf a PLMN or SNPN is configured with multiple NSAC service areas, an NSACF may be deployed on a NSAC service area basis, which can be one NSACF instance or one NSACF Set. There are three NSAC architecture options:\n-\tOption 1: non-Hierarchical NSAC architecture. In this architecture, independent NSACFs are deployed in every NSAC service area. There is no interaction between the NSACFs deployed in different NSAC service areas. Each NSACF is configured with the maximum number of UEs per network slice and/or the maximum number of PDU Sessions which are valid in the NSAC service area (see clauses 5.15.11.1.1 and 5.15.11.2.1 for more details).\n-\tOption 2: Centralized NSAC architecture. In this architecture, a single centralized NSACF is deployed in the network to handle admissions in all NSAC service areas. The centralized NSACF is configured with the total number of UEs per network slice and the maximum number of PDU Sessions for the entire PLMN. NSAC Requests from AMF or SMF to the single centralized NSCAF in this case includes the NSAC service area of the NF consumer if multiple NSAC service areas are deployed in PLMN.\nNOTE 1:\tIt is possible to configure in the centralized architecture the maximum number of registered UEs and/or the maximum number of PDU sessions per NSAC service area if required by the operator. In this case, NSAC can be performed on a per NSAC service area.\n-\tOption 3: Hierarchical NSAC architecture is deployed in the network. There are two roles of NSACF and interaction between them may be required (see clauses 5.15.11.1.2 and 5.15.11.2.2 for more details):\n-\tPrimary NSACF, controls and distributes of the maximum number of UEs and/or the maximum number of PDU Sessions for other NSACF(s) deployed in different NSAC service Area. The Primary NSACF handles overall NSAC for an S-NSSAI at the global level (i.e. it is ultimately responsible for the NSAC for an S-NSSAI).\n‐\tNSACF is responsible for one or multiple NSAC service Area. And one NSAC service area is only associated with one NSACF instance or one NSACF Set.\nNOTE 2:\tWhen multiple NSACFs are deployed, how the maximum number of UEs per network slice and the maximum number of PDU Sessions per network slice is distributed (by OAM for Option 1 and by the primary NSACF for Option 3) among multiple NSACFs, i.e. the algorithm of the maximum number distribution, is implementation specific.\nNOTE 3:\tWhen multiple NSACFs are deployed based on option 1, the UE moves to new NSAC service area with a different NSACF, and if the number of UE or PDU Sessions in the target NSACF has reached the maximum number, whether the session continuity can be guaranteed is left to implementation.\nNOTE 4:\tWhen multiple NSACFs are deployed based on Hierarchical NSAC architecture, it is possible that the role of Primary NSACF and the role of NSACF are co-located at the same NSACF instance.\nSubject to operator policy and national/regional regulations, the AMF may exempt UEs and the SMF may exempt PDU sessions from NSAC when the UE and/or PDU Session is used for Emergency service or for Critical and Priority services (e.g. MCX, MPS).\nWhen the AMF receives a Registration Request for an Emergency Registration, or with a Registration Request with an Establishment Cause indicating a priority service (e.g. MCX, MPS) or when the AMF determines that there is a priority subscription (e.g. MPS, MCX) in the UDM, the AMF may accept the registration request without applying NSAC, i.e. the AMF triggers the NSAC procedure, but the response from the NSACF is ignored at the AMF.\nWhen the SMF receives a PDU Session Establishment Request for an emergency PDU Session or a PDU Session Establishment Request with a priority header, the SMF may accept the PDU Session Establishment Request without applying NSAC, i.e. the SMF triggers the NSAC procedure, but the response from the NSACF is ignored at the SMF.\nAlternatively, when NSAC is exempted for the UE and/or PDU Session, the AMF and the SMF skip the corresponding NSAC procedure, i.e. this UE (respectively PDU Session) is not counted towards the maximum number of UEs (respectively PDU Sessions).\nThe support of NSAC for the S-NSSAI used for onboarding as described in clause 5.30.2.10 is optional and subject to Onboarding Network operator policies. However, NSAC for S-NSSAI used for onboarding is not applicable to UEs that registered in ON-SNPN with Registration Type \"SNPN Onboarding\".\nIn the case of NSAC for maximum number of PDU Sessions, when the NSACF rejects the request from the SMF to increase the number of PDU Sessions, the SMF may provide to the UE a back-off timer associated with reject cause set to 'Maximum number of PDU Sessions per S-NSSAI reached' for an Access Type as described in clause 4.2.11.4 of TS 23.502 [3]. If the UE receives from the SMF a back-off timer associated with the reject cause set to 'Maximum number of PDU Sessions per S-NSSAI reached' for an Access Type, the UE shall not request the establishment of a PDU Session for this S-NSSAI on the indicated Access Type until the back-off timer expires.\nThe NSACF keeps track of the current number of UEs registered for a network slice so that it can ensure it does not exceed the maximum number of UEs allowed to register with the network slice. The NSACF also maintains a list of UE IDs registered with a network slice that is subject to NSAC. When an event related to a UE causes the current number of UEs registered with a network slice to increase, the NSACF first checks whether the UE Identity is already in the list of UEs registered with that network slice. If not, the NSACF checks whether the maximum number of UEs per network slice for that network slice has already been reached and if it has, the NSACF applies admission control policies.\nThe AMF triggers a request to NSACF for NSAC for maximum number of UEs when the UE's registration status for a network slice subject to NSAC is changing, i.e. during the UE Registration procedure in clause 4.2.2.2.2 of TS 23.502 [3], UE Deregistration procedure in clause 4.2.2.3 of TS 23.502 [3], Network Slice-Specific Authentication and Authorisation procedure in clause 4.2.9.2 of TS 23.502 [3], AAA Server triggered Network Slice-Specific Re-authentication and Re-authorization procedure in clause 4.2.9.3 of TS 23.502 [3], AAA Server triggered Slice-Specific Authorization Revocation in clause 4.2.9.4 of TS 23.502 [3] and UE Configuration Update procedure in clause 4.2.4.2 of TS 23.502 [3].\nNOTE 1:\tEarly Admission Control (EAC) mode is applicable for Number of UEs per network slice admission control. The use of EAC in relation to the number of registered UEs is described in clauses 4.2.11.2 and 4.2.11.3 of TS 23.502 [3].\nSince the UE may register or deregister for an S-NSSAI via 3GPP access and/or non-3GPP access as described in clause 5.15.5.2.1. The Allowed NSSAI for the access type may change while the UE is registering to a network. The AMF provides the Access Type to the NSACF when triggering a request to increase or decrease the current number of UEs registered with a S-NSSAI. The NSACF may take the Access Type into account for increasing and decreasing the number of UEs per network slice by storing the UE ID with the associated one or more Access Type(s), i.e. the NSACF is able to add or remove a registration for the UE ID for each Access Type and trigger the increase or decrease of the current number of UEs registered with a S-NSSAI based on a policy that takes the access type into account. If the Access Type provided by the AMF is not configured for NSAC in the NSACF, the NSACF always accepts the request from the AMF without increasing or decreasing the number of UEs. If the Access Type provided by the AMF is configured for NSAC in the NSACF and the maximum number is reached, the NSACF sends a reject response to the AMF including the access type.\nNOTE 2:\tFor example, if the NSACF is configured to apply NSAC for 3GPP Access Type only, the NSACF counts registration via 3GPP access type only. If the NSACF is configured to apply NSAC for both Access Types, and the UE newly registers via 3GPP access while the UE is already registered via non-3GPP access (or vice versa), the NSACF updates the UE ID entry with both 3GPP Access Type and non-3GPP Access Type and the NSACF may count the UE once or twice based on its policy.\nIn the Hierarchical NSAC architecture, the NSACFs deployed in the NSAC service areas interacts with the Primary NSACF when needed, and as explained below.\nThe main differences between the non-Hierarchical architecture and the Hierarchical architecture is that the AMFs and the NSACFs deployed in the Hierarchical architecture support the following:\n-\tWhen the AMF triggers an NSAC request to the NSACF, the AMF includes the UE already Registered indication if the AMF can determine that the UE has been registered with the S-NSSAI in one NSAC service area before. If the AMF does not include the UE already Registered indication, the registration request to the indicated S-NSSAI is determined as initial registration, i.e. the UE has not been registered in any service area before. The AMF determines the UE already Registered indication based on the received Allowed NSSAI information from the source AMF (in case of inter AMF handover) or from SMF+PGW-C (in case of mobility from EPS to 5GS).\n-\tThere are two types of UE admission control: quota-based control or threshold-based control. A PLMN is configured to deploy only one type of UE admission control. Based on the type of UE admission control configured for the PLMN, the NSACF handles the NSAC request as described below:\n-\tFor NSACFs supporting quota-based control, if the NSACF receives a request to increase the number of UEs and the number of UEs registered for a network slice has reached the local maximum number of UEs provisioned in the NSACF, or upon receiving a request to decrease the number of UEs and no UE entry is present in the NSACF, the NSACF interacts with the Primary NSACF for the handling of the NSAC request for the UE. The Primary NSACF may return in the response an updated local maximum number of registered UEs value to the NSACF based on the status of registered UEs for the Network Slice and which enables the NSACF to handle locally the request. Alternatively, and if the request to increase the number of UEs includes the UE already Registered indication, the Primary NSACF may admit the UE request and store the UE entry which allows for service continuity. The Primary NSACF may also reject the request. If the NSACF receives a request to increase the number of UEs and the local maximum number of UEs is not reached, the NSACF handles the request locally and sends a response to the AMF without interaction with the Primary NSACF.\n-\tFor NSACF supporting threshold-based control, the NSACF is initially configured with a UE admission threshold and a local maximum number of Registered UEs to be admitted. Threshold-based control refers to an admission threshold, defined in percentage, against provisioned local maximum number in NSACF (e.g. an admission threshold of 80% refers to the case when 80% of the provisioned local maximum number should be used). If upon a receiving a request to increase the number of UEs without a UE already Registered indication and if UE admission threshold is at or above the threshold level configured at the NSACF, the NSACF immediately rejects the NSAC request. If the received request includes the UE already Registered indication and if UE admission is at or above the threshold level configured at the NSACF, the NSACF accepts the request to enable UE admission and allow for service continuity as long as the local maximum number of Registered UEs have not been reached. If the local maximum number of registered UEs value have been reached, the NSACF interacts with the Primary NSACF for the handling of the NSAC request for the UE. The NSACF does not include the UE already Registered indication in this case. The Primary NSACF may return an updated UE admission threshold value to the NSACF in the response which enables the NSACF to handle the request locally. Alternatively, the Primary NSACF may handle and store the UE entry. The Primary NSACF may also reject the request.\n-\tFor both options, the Primary NSACF supports the following capabilities depending on the NSACF configuration:\n-\tReturning a new updated local maximum number of Registered UEs for the NSACF to admit if the NSACF is configured to support the quota-based UE admission control; or\n-\tReturning a new updated UE admission threshold for the NSACF to apply if the NSACF is configured to support the threshold-based UE admission control;\n-\tThe Primary NSACF handles, stores entries only related to UEs which the NSAC request includes the UE already Registered indication, that are already admitted in an existing NSAC service area but cannot be admitted in the new NSAC service area due to no remaining local maximum number of registered UEs, as long as the overall PLMN number of registered UEs at the Primary NSACF is not exhausted. The Primary NSACF informs the NSACF in its response;\n-\tBased on the response from the Primary NSACF, the NSACF determines whether to accept or reject the NSAC request for UE registration. In addition, the NSACF may also update the local maximum number of Registered UEs or admission threshold respectively if the related updated value is received;\n-\tAt any time, the Primary NSACF can update the NSACFs local maximum number of Registered UEs or admission threshold through the Nnsacf_NSAC_LocalNumberUpdate operation as described in clause 4.2.11.6 of TS 23.502 [3]. The updated values provided from the Primary NSACF to the NSACFs may directly apply to current NSAC pending request in NSACF and are used for all future requests.\n-\tThe Primary NSACF subscribes with all NSACFs to obtain the number of currently registered UEs at all NSACFs. Based on the obtained information, the Primary NSACF can update the NSACF with local maximum number of registered UEs.\nThe main differences between the NSACFs deployed in a non-Hierarchical architecture and NSACFs deployed in a Centralized NSAC architecture is as follows:\n-\tIf multiple NSAC service areas are deployed in PLMN, the AMF provides the NSAC Service Area Identifier information to the centralized NSACF. The centralized NSACF also stores the NSAC Service Area Identifier of the AMF the UE is registered with.\nThe NSACF keeps track of the current number of PDU Sessions per network slice so that it can ensure it does not exceed the maximum number of PDU session allowed to be served by the network slice. When an event related to a UE causes the current number of PDU sessions established within the network slice is to increase, the NSACF checks whether the maximum number of PDU sessions per network slice for that network slice has already been reached and if it has, the NSACF applies admission control policies.\nThe anchor SMF triggers a request to NSACF for maximum number of PDU sessions per network slice control during PDU session establishment/release procedures in clauses 4.3.2 and 4.3.4 of TS 23.502 [3].\nThe SMF provides the Access Type to the NSACF when triggering a request to increase or decrease the number of PDU Sessions. The NSACF takes Access Type into account for increasing and decreasing the current number of PDU Sessions depending on the applicability of the Access Type for the NSAC for maximum number of PDU Sessions for the S-NSSAI.\nNOTE 1:\tFor MA PDU Session, the SMF provides the Access Type to NSACF when the user plane connection is about to be established or released in the corresponding access network. With this, the SMF provides one or two Access Types for the MA PDU Session in the same request message to the NSACF. The NSACF can reject a single or both Access Types depending on the applicability of the Access Type for the NSAC.\nNOTE 2:\tI-SMF does not interact with NSCAF.\nThe main differences between the NSACFs deployed in a non-Hierarchical architecture and NSACFs deployed in a Hierarchical architecture is as follows:\n-\tThe NSCAF is enhanced to support PDU session admission quota-based control.\n-\tWhen the local maximum number of PDU sessions is reached, the NSACF interacts with the Primary NSACF to handle the request. The Primary NSACF either return an increased local maximum number to the NSACF, or reject the local maximum number value update request if all the global maximum number are consumed based on the status of established PDU sessions to the network slice.\nNOTE:\tFor Hierarchical NSAC architecture global maximum number used within this specification is synonymous with the maximum number of allowed registered UEs or established PDU Sessions for an S-NSSAI subject to Network Slice Admission Control (NSAC) for the entire PLMN and outbound roamers.\n-\tBased on the response from Primary NSACF, the NSACF updates the local maximum number if updated value is received from the Primary NSACF. The NSACF updates local maximum number value (if received) and determines whether to accept or reject the NSAC request for PDU session establishment based on the local maximum number value.\n-\tThe update of local maximum number value by the Primary NSACF can also happen at any time through the Nnsacf_NSAC_LocalNumberUpdate service operation as described in clause 4.2.11.6 TS 23.502 [3]. The updated values provided from the Primary NSACF to NSACFs may directly apply to current NSAC pending request in NSACF and are used for all future requests.\n-\tThe Primary NSACF subscribes with all NSACFs to obtain the number of currently established PDU sessions at all NSACFs. Based on the obtained information, the Primary NSACF can update the NSACF with local maximum number of established PDU sessions.\nThe main differences between the NSACFs deployed in a non-Hierarchical NSAC architecture and NSACFs deployed in a Centralized NSAC architecture is as follows\n-\tIf multiple NSAC service areas are deployed in a PLMN, the SMF provides the NSAC Service Area Identifier to the centralized NSACF. The centralized NSACF also stores the NSAC Service Area Identifier of the SMF the PDU session is established on.\nIn the case of roaming, depending on operator's policy, a roaming agreement or an SLA between the VPLMN and the HPLMN, NSAC of roaming UEs is performed by one of the following modes of NSAC admission:\n-\tVPLMN NSAC Admission; or\n-\tVPLMN with HPLMN assistance NSAC Admission; or\n-\tHPLMN NSAC Admission.\nThe VPLMN (AMF and SMF) identifies the mode to apply from the AMF subscription data at UE registration, and from the SMF subscription data at PDU session establishment.\nFor all the above modes, for NSAC of roaming UEs for maximum number of UEs per network slice and/or maximum number of PDU Sessions per network slice managed by the VPLMN, each S-NSSAI of the HPLMN that is subject to NSAC is mapped to a corresponding S-NSSAI of the VPLMN subject to NSAC.\nFor both VPLMN NSAC Admission and VPLMN with HPLMN assistance NSAC Admission modes, each configured S-NSSAI that is subject to NSAC and that is mapped from the HPLMN S-NSSAI, the SMF performs NSAC for home routed PDU sessions according to the principles described in clause 5.15.11.2.\nFor NSAC of roaming UEs for maximum number of UEs per network slice and/or maximum number of PDU Sessions per network slice managed by the VPLMN, the following principles shall be used:\n-\tFor NSAC for the maximum number of UEs for S-NSSAI of the HPLMN, a NSACF in the VPLMN can be configured with the maximum number of allowed roaming UEs per mapped S-NSSAI of the HPLMN for a S-NSSAI of the HPLMN that is subject to NSAC. In such a case, the AMFs trigger a request to a NSACF of the VPLMN.\n-\tFor NSAC for the maximum number of PDU Sessions for S-NSSAI of the HPLMN, a NSACF in the VPLMN can be configured with the maximum number of allowed PDU Sessions in LBO mode per mapped S-NSSAI of the HPLMN for a S-NSSAI of the HPLMN that is subject to NSAC. In such a case, the anchor SMF in the VPLMN triggers a request to a NSACF of the VPLMN.\n-\tFor NSAC for the maximum number of UEs for S-NSSAI of the VPLMN, AMFs trigger a request to a NSACF of the VPLMN to perform NSAC based on the S-NSSAI of the VPLMN subject to NSAC. The NSACF of the HPLMN is not involved.\n-\tFor NSAC for the maximum number of PDU Sessions for S-NSSAI of the VPLMN in the LBO roaming case, the SMF triggers a request to a NSACF of the VPLMN to perform NSAC based on the S-NSSAI of the VPLMN subject to NSAC. The NSACF of the HPLMN is not involved.\n‐\tThe AMF or SMF (in LBO roaming case) in the VPLMN provides both the S-NSSAI in the VPLMN and the corresponding mapped S-NSSAI in the HPLMN to the NSACF in the VPLMN. The NSACF in the VPLMN performs NSAC for both S-NSSAI of the VPLMN and the corresponding mapped S-NSSAI of the HPLMN based on the SLA between the VPLMN and the HPLMN.\nIn addition to configuring the VPLMN NFs with the maximum number of allowed roaming UEs per mapped S-NSSAI of the HPLMN subject to NSAC, and the maximum number of allowed PDU Sessions in LBO mode per mapped S-NSSAI of the HPLMN subject to NSAC, the VPLMN can optionally fetch this information from the HPLMN primary NSACF in a hierarchal architecture or centralized NSACF in a centralized architecture. If the NSACF in VPLMN does not have quota configured but can receive quota from the HPLMN, the NSACF in VPLMN may interact with the HPLMN for retrieving the quota before processing any incoming request. The VPLMN is either configured or discovers the NSACF in the HPLMN for quota retrieval. However, in this case, the VPLMN rejects any additional requests exceeding the received information.\nIn this admission mode HPLMN delegates NSAC for S-NSSAIs subject to NSAC to the VPLMN, both for number of registered UEs and the number of LBO PDU sessions.\nEvery NSACF performing admission in the VPLMN for each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, fetches from the VPLMN primary NSACF in a hierarchal architecture the maximum number of registered UEs to be admitted and/or the maximum number of LBO PDU sessions to be allowed. The VPLMN primary or central NSACF, in turn, acquires the information from the HPLMN central or primary NSACF depending on the deployed architecture. The VPLMN is either configured or discovers the NSACF in the HPLMN for quota retrieval.\nIf re-distribution of quota is required in the VPLMN in a hierarchal architecture, amongst multiple NSACFs than this is handled by the primary NSACF in VPLMN with no involvement from the HPLMN. The VPLMN NSACF discovers the HPLMN primary or central NSACF or be configured with the needed information.\nFor any request(s) received in any NSACF in the VPLMN exceeding the received maximum number information, the NSACF interacts with the VPLMN primary NSACF which in turn interacts with HPLMN primary or central NSACF to receive an updated roaming quota for the corresponding mapped S-NSSAI, which is used to determine whether admission request is accepted or rejected, unless forbidden by the SLA. If an admission request is accepted, the UE entry is stored in the NSACF performing admission in the VPLMN. This applies to the number of registered UEs as well as the number of LBO PDU sessions. The primary NSACF in VPLMN may re-distribute the received updated roaming quota to the NSACFs in VPLMN to perform NSAC for Roaming UEs according to the principles described in clauses 5.15.11.1 and 5.15.11.2.\nIn this admission mode the AMF or SMF in VPLMN interacts with HPLMN for admission, both for number of registered UEs or the number of LBO PDU sessions respectively.\nFor each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, AMF performs NSAC admission for the number of registered UEs with the HPLMN central or primary NSACF for all inbound roamers from that HPLMN when they register in this VPLMN. The AMF discovers the HPLMN primary or central NSACF or be configured with the needed information.\nFor each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, every SMF in this VPLMN performs NSAC admission for the number of LBO PDU sessions with the HPLMN central or primary NSACF for all inbound roamers from that HPLMN when they initiate an LBO PDU session. The SMFs discover the HPLMN primary or central NSACF or be configured with the needed information. For each S-NSSAI of the HPLMN that is subject to NSAC, the SMF performs NSAC according to the principles described in clause 5.15.11.2 for home routed PDU sessions.\nIn the HPLMN NSAC admission mode, the primary NSACF or central NSACF in HPLMN determines whether the NSAC admission request for a roaming UE is accepted or rejected.\nA consumer NF (e.g. AF, Primary NSACF) can subscribe with the NSACF for Network Slice status notifications and reports. Upon such subscription, the corresponding NSACF in different NSAC architecture as defined in clause 5.15.11.0 can provide event based notifications and reports to the consumer NF (e.g. to AF via NEF) related to the current number of UEs registered for a network slice or the current number of UEs with at least one PDU Session/PDN Connection in the case of EPC interworking or the current number of PDU Sessions established on a network slice.\nNOTE:\tThe Primary NSACF subscribes Network Slice status from all the NSACF(s) it contacts with for the update of the maximum number of UE or PDU session configured at the NSACF.\nThis clause describes the NSAC for maximum number of registered UEs and for maximum number of PDU Sessions for network slice subjected to EPS interworking. The NSAC for maximum number of UE with at least one PDU Session/PDN Connection is described in clause 5.15.11.5a. A network slice subject to both NSAC and EPS counting shall be configured with only one of the options:\n-\tMaximum number of registered UEs and/or maximum number of PDU Session; or\n-\tMaximum number of UEs with at least one PDU Session/PDN Connection and/or maximum number of PDU Session.\nIf EPS counting is required for a network slice, the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice is performed at the time of PDN connection establishment in case of EPC interworking. To support the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice in EPC, the SMF+PGW-C is configured with the information indicating which network slice is subject to NSAC. During PDN connection establishment in EPC, the SMF+PGW-C selects an S-NSSAI associated with the PDN connection as described in clause 5.15.7.1. If the selected S-NSSAI by the SMF+PGW-C is subject to the NSAC, the SMF+PGW-C triggers interaction with NSACF to check the availability of the network slice by invoking separate NSAC procedures for number of UE and number of PDU Session (as described in clause 4.11.5.9 of TS 23.502 [3]), before the SMF+PGW-C provides the selected S-NSSAI to the UE. If the network slice is available, the SMF+PGW-C continues to proceed with the PDN connection establishment procedure.\nThe NSACF performs the following for checking network slice availability prior to returning a response to the SMF+PGW-C:\n-\tFor NSAC for number of UEs, if the UE identity is already included in the list of UE IDs registered with a network slice, or the UE identity is not included in the list of UE IDs registered with a network slice and the current number of UE registration did not reach the maximum number, the NSACF responds to the SMF+PGW-C with the information that the network slice is available. The NSACF includes the UE identity in the list of UE IDs if not already on the list and increases the current number of UE registration. Otherwise, the NSACF returns a response indicating that the maximum number with the network slice has been reached.\nIf hierarchical NSAC architecture is deployed, when the local maximum number or local threshold is reached the NSACF may interact with the Primary NSACF before it returns the response back to the SMF+PGW-C. For more details on handling at the NSACF and Primary NSACF see clause 5.15.11.1.2.\n-\tFor NSAC for number of PDU Sessions, if the current number of PDU sessions is below the maximum number, the NSACF responds to the SMF+PGW-C with the information that the network slice is available. The NSACF increases the current number of PDU sessions. Otherwise, the NSACF returns the response indicating that the maximum number with the network slice has been reached.\nIf hierarchical NSAC architecture is deployed, when the local maximum number is reached the NSACF may interact with the Primary NSACF before it returns the response back to the SMF+PGW-C. For more details on handling at the NSACF and Primary NSACF see clause 5.15.11.2.2.\nIf the maximum number of UEs and/or the maximum number of PDU sessions has already been reached, unless operator policy implements a different action, the SMF+PGW-C rejects the PDN connection.\nNOTE 1:\tAs an implementation option, if the APN is mapped to more than one S-NSSAI and the first selected S-NSSAI is not available (e.g. either current number of UE registration reached maximum or current number of PDU sessions reached maximum), then based on the operator policy the PGW-C+SMF can try another mapped S-NSSAI for the PDN connection establishment procedure.\nIf the establishment of a new PDN Connections is with a different SMF+PGW-C from the SMF+PGW-C used for already existing PDN connection associated with the same S-NSSAI, each SMF+PGW-C will send a request for update (e.g. increase or decrease) to the NSACF. The NSACF may maintain a registration entry per SMF+PGW-C for the same UE ID.\nThe SMF+PGW-C provides the Access Type to the NSACF when triggering a request to increase or decrease the number of UEs and/or the number of PDU Sessions for an S-NSSAI.\nNOTE 2:\tThe SMF+PGW-C determines the Access Type based on the RAT type parameter in the PMIP or GTP message received from the ePDG; or alternatively it can internally determine the Access Type based on the source node (e.g. SGW) sending the request for the PDN Connection establishment.\nWhen the UE with ongoing PDN connection(s) moves from EPC to 5GC, the SMF+PGW-C triggers a request to decrease the number of the UE registration in NSACF and the AMF triggers a request to increase the number of the UE registration in NSACF when the UE is registered in the new AMF. If there are more than one PDN connections associated with the S-NSSAI, the NSACF may receive multiple requests for the same S-NSSAI from different SMF+PGW-Cs. When the UE with ongoing PDU session(s) moves from 5GC to EPC, the SMF+PGW-C triggers a request to increase the number of the UE registration in NSACF and the old AMF triggers a request to decrease the number of the UE registration in NSACF when the UE is deregistered in old AMF. If there are more than one PDU sessions associated with the S-NSSAI, the NSACF may receive multiple requests for the same S-NSSAI from different SMF+PGW-Cs. The NSACF maintains a list of UE IDs based on the requests from SMF+PGW-C(s) and AMF, and adjusts the current number of registrations accordingly.\nWhen EPS counting is performed for a network slice, and the UE with ongoing PDN connection(s) moves from EPC to 5GC, session continuity is guaranteed from NSAC standpoint, as the admission was granted at the time of PDN connection establishment, i.e. the number of PDU session is not counted again in 5GC. Similarly, when the UE with ongoing PDU session(s) moves from 5GC to EPC, session continuity is guaranteed from NSAC standpoint as the admission of the PDN Connection(s) to the network slice was already granted at the time of PDU Session establishment in 5GC.\nIf the PDN connection associated with S-NSSAI is released in EPC, the SMF+PGW-C triggers a request (i.e. decrease) to NSACF for maximum number of UEs and/or maximum number of PDU sessions per network slice control. The NSACF decreases the current number of registrations and removes the UE identity from the list of UE IDs if the PDN connection(s) associated with the S-NSSAI are all released in EPC.\nNOTE 3:\tNSAC in EPC is not performed for the attachment without PDN connectivity.\nIf EPS counting is not required for a network slice, the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice is performed when the UE moves from EPC to 5GC, i.e. when the UE performs mobility Registration procedure from EPC to 5GC (NSAC for maximum number of UEs per network slice) and/or when the PDN connections are handed over from EPC to 5GC (NSAC for maximum number of PDU Sessions per network slice). The SMF+PGW-C is configured with the information indicating the network slice is subject to NSAC only in 5GS. The PDN connection interworking procedure is performed as described in clause 5.15.7.1. Mobility from EPC to 5GC does not guarantee all active PDU Session(s) can be transferred to the 5GC in certain circumstances when either the current number of UE registration or the current number of PDU sessions would exceed the maximum number when the UE moves from EPC to 5GC. When the UE with ongoing PDU session(s) moves from 5GC to EPC, the SMF+PGW-C triggers a request to decrease the number of PDU Session to NSACF. If there are more than one PDU sessions associated with the S-NSSAI, the NSACF may receive multiple requests for the same S-NSSAI from different SMF+PGW-Cs and NSACF removes the PDU Session ID(s) while decreasing the number of PDU Session(s).\nNOTE 4:\tGiven that session continuity is not guaranteed when EPS counting is not required, it is recommended for services which require the session continuity to support EPS counting.\nNOTE 5:\tWhen multiple NSACFs are deployed and if the number of UE in target NSACF has reached the maximum number, whether session continuity can be guaranteed is left to implementation.\nNOTE 6:\tWhen a centralized architecture is deployed, UE admission is guaranteed at inter-system and inter-AMF mobility if the same NSACF is selected. This is the case for non-roaming scenarios and for roaming scenarios with HPLMN NSAC Admission Mode described in clause 5.15.11.3.\nWhen EPS counting is required for a network slice and NSACF is configured with maximum number of UEs with at least one PDU Session/PDN Connection, the NSACF keeps track of the current number of UEs with at least one PDU session/PDN connection established on a network slice to ensure it does not exceed the maximum configured number.\nTo support the NSAC for maximum number of UEs with at least one PDU Session/PDN Connection, the SMF+PGW-C may be configured with one of the following options:\n-\tOption 1: Triggering an Nnsacf_NSAC_NumOfUEsUpdate_Request to NSACF for NSAC for maximum number of UEs when the UE establishes first PDU Session/PDN connection associated with the network slice in the SMF+PGW-C, or when the last PDU Session/PDN connection associated with the network slice is released. The NSACF performs admission control as described in clause 5.15.11.5 and the number of registered UE is replaced with number of UE with at least one PDU session/PDN connection. Also, if the maximum number of UEs with at least one PDU Session/PDN connection has already been reached and SMF+PGW-C receives the rejection from NSACF, unless operator policy implements a different action, the SMF+PGW-C rejects the PDU Session/PDN connection indicating the cause being the number of UEs in the network slice has been exceeded. The AMF is not configured for this S-NSSAI to be subject to NSAC; or\n-\tOption 2: Triggering an Nnsacf_NSAC_NumOfPDUsUpdate_Request as described in clause 5.15.11.5 to NSACF and the NSACF performs admission control for the number of UEs with at least one PDU Session/PDN connection as follows:\n-\tThe NSACF supports handling both for the number of UEs with at least one PDU Session/PDN Connection and number of PDU session for the S-NSSAI that is subject to EPC interworking and NSAC. In this case the AMF is not configured for this S-NSSAI to be subject to NSAC. As an optimization option, the SMF+PGW-C can be configured not to trigger the Nnsacf_NSAC_NumOfUEsUpdate_Request to NSACF.\n-\tWhen the NSACF receives request to increase the current number of PDU Session/PDN Connection established for the network slice, the NSACF checks whether this is the first PDU Session/PDN Connection associated with the network slice. If this is the first PDU Session/PDN Connection associated with the network slice the NSACF checks whether the maximum number of UEs with at least one PDU Session/PDN Connection has been reached. If the maximum number has not been reached then the NSACF increases the number of UE with at least one PDU session/PDN connection and add an entry for UE ID. If the maximum number of UEs has already been reached, unless operator policy implements a different action, the SMF+PGW-C rejects the PDU Session/PDN connection indicating the cause being the number of UEs in the network slice has been exceeded.\n-\tWhen the NSACF receives request to decrease the current number of PDU Session/PDN Connection established for the network slice, the NSACF locates the UE entry, checks whether this is the last PDU Session/PDN Connection associated with the network slice for the UE. If it is the last PDU Session/PDN Connection the NSACF decreases the number of UE with at least one PDU session/PDN connection and remove the associated UE entry.\nNOTE 1:\tA PLMN can deploy one of the above two options for a slice when EPS counting is required for a network slice and NSACF is configured with maximum number of UEs with at least one PDU Session/PDN Connection.\nNSACF is configured with the information of whether the NSAC for number of UEs with at least one PDU session/PDN connection is based on Option1 or Option 2.\nIn both options, the SMF+PGW-C provides the Access Type to the NSACF when triggering a request to increase or decrease or update the number of UEs with at least one PDU Session/PDN Connection and/or the number of PDU Sessions for an S-NSSAI.\nIn the case of roaming, same mechanisms in clause 5.15.11.3 are used and number of registered UE is replaced with number of UE with at least one PDU Session/PDN Connection. For home routed PDU Session/PDN Connection only HPLMN admission mode can be used in this case.\nIf hierarchical NSAC architecture is deployed, when the local maximum number or local threshold is reached the NSAC may interact with the Primary NSACF before it returns the response back to the SMF+PGW-C. For more details on handling at the NSACF and Primary NSACF see clause 5.15.11.1.2.\nNOTE 2:\tWhen NSAC for number of UEs with at least one PDU session or one PDN connection is used, the session continuity is guaranteed at inter-system mobility as the admission is granted during the establishment of the PDU Session/PDN Connection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.12\tSupport of subscription-based restrictions to simultaneous registration of network slices",
                            "text_content": "The subscription information for a UE may include for each S-NSSAI Network Slice Simultaneous Registration Group (NSSRG) information constraining which S-NSSAIs can be simultaneously provided to the UE in the Allowed NSSAI.\nWhen S-NSSAIs have associated NSSRG information, then the S-NSSAIs in the Allowed NSSAI shall share at least one NSSRG.\nThe NSSRG information, defining the association of S-NSSAIs to NSSRG, is provided as an additional and separate information.\nIf the optional NSSRG information is not present for the S-NSSAIs of a subscription, and other restrictions do not apply e.g. availability at a specific location, then it is assumed that all the S-NSSAIs in the subscription information can be simultaneously provided to the UE in the Allowed NSSAI. However, if NSSRG information is present in the subscription information, at least one NSSRG shall be associated with each of the S-NSSAIs in the subscription information. At any time, if the AMF has received subscription information for a UE that includes NSSRG information, the Allowed NSSAI for the UE can only include S-NSSAIs which share a common NSSRG.\nNOTE 1:\tThe AMF enforces NSSRG only for the access(es) the UE registered to the AMF. When the UE is registered to different PLMNs over 3GPP access and non-3GPP access, the AMF in one access cannot enforce a common NSSRG over both accesses.\nThe default S-NSSAIs, if more than one is present, are associated with the same NSSRGs, i.e. the UE is always allowed to be registered with all the default S-NSSAIs simultaneously. The HPLMN only sends S-NSSAIs sharing all the NSSRGs of the Default S-NSSAIs to a non-supporting VPLMN as part of the subscription information, i.e. in addition to the default S-NSSAI(s), the HPLMN may send any other subscribed S-NSSAI which shares at least all the NSSRG defined for the default S-NSSAI(s), and the HPLMN sends no NSSRG information to the VPLMN. A subscription information that includes NSSRG information shall include at least one default S-NSSAI.\nA supporting AMF/NSSF, when it receives a Requested NSSAI, evaluates the S-NSSAIs of the HPLMN (in the mapping information of the Requested NSSAI, when a mapping information is applicable) based on any received NSSRG information for these S-NSSAIs, to determines whether they can be provided together in the Allowed NSSAI.\nNOTE 2:\tAn HPLMN enabling support of subscription-based restrictions to simultaneous registration of network slices for a Subscriber, can set the subscribed S-NSSAI(s) already in the subscription information before the NSSRG information was added to the subscription information, to have the same NSSRGs defined for the default S-NSSAI(s) if it has to continue to support the same service behaviour for these S-NSSAIs.\nA UE may support the subscription-based restrictions to simultaneous registration of network slices feature. In this case, the UE indicates its support in the Registration Request message in the Initial Registration and the Mobility Registration Update as part of the UE 5GMM Core Network Capability.\nWhen the serving AMF provides the Configured NSSAI to the UE, and the UE has indicated it supports the subscription-based restrictions to simultaneous registration of network slices feature, the AMF also provides the UE with the NSSRG information related to the S-NSSAIs of the HPLMN which are in the mapping information of the Configured NSSAI. A UE which receives the NSSRG values in the network slicing configuration information shall only include in the Requested NSSAI S-NSSAIs that share a common NSSRG as per the received information. If the UE has stored Pending NSSAI and the UE is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG. If the HPLMN changes NSSRG information in the subscription information for a UE, the UDM updates the supporting AMF serving the UE with the new NSSRG information and the AMF, possibly after interaction with the NSSF (see clause 5.2.16.2.1 of TS 23.502 [3]), updates the UE as necessary with network slicing configuration by means of the UE Configuration Update procedure (this may include changes in the Configured NSSAI (and related mapping information) and changes in the Allowed NSSAI as applicable). The UE acknowledges this UE Configuration Update according to clause 4.2.4.2 of TS 23.502 [3].\nAt any time, a UE supporting subscription-based restrictions to simultaneous registration of network slices feature and that has received NSSRG information together with the Configured NSSAI shall only request S-NSSAIs, across all Access Type(s) regardless of whether the same PLMN or different PLMNs are used, that share one or more common NSSRG.\nNOTE:\tIn Requested NSSAI across all Access Type(s), the UE needs to include S-NSSAIs that share at least one common NSSRG.\nAn AMF which supports the subscription-based restrictions to simultaneous registration of network slice feature configures a non-supporting UE with a Configured NSSAI including only the S-NSSAIs sharing all the NSSRG values of the default S-NSSAI(s), except if it has been instructed otherwise by the UDM. In addition to the default S-NSSAI(s), the AMF sends to the UE in the Configured NSSAI any other subscribed S-NSSAI whose NSSRG match at least those defined for the default S-NSSAI(s).\nThe UDM in a supporting HPLMN may optionally keep a record of the PEIs or Type Allocation Codes values regarding UE ability to handle network slices that cannot be provided simultaneously in Allowed NSSAI.\nThe UDM may, based on configuration or the optional PEI records, indicate the AMF to provide the non-supporting UEs with the full set of subscribed S-NSSAIs even if they do not share a common NSSRG. The UDM instructs the supporting AMFs of a PLMN to do so by indicating that the UE can be given a Configured NSSAI with all the S-NSSAIs in the subscription information. If this indication is received from the UDM by the AMF, this is included in the UE context.\nBased on its policy (including configuration or optionally checking the specific PEI or Type Allocation Code used by the UE, and subject to roaming agreement) the UDM may also provide the serving AMF in a non-supporting VPLMN with all the S-NSSAI in the subscription information. In this case the AMF provides the UE with a Configured NSSAI including all the S-NSSAIs in the subscription information the AMF receives.\nThe AMF provides no NSSRG information to a non-supporting UE.\nWhen an AMF which supports the subscription-based restrictions to simultaneous registration of network slice feature, receives from a UE a Requested NSSAI including S-NSSAIs that are supported in the Tracking Area but do not share a common NSSRG, or the AMF has pending NSSAI stored for the UE, and the S-NSSAI(s) of the requested NSSAI and the pending NSSAI do not share a common NSSRG, the AMF assumes the UE configuration is not up-to-date, and provides the following:\n-\ta supporting UE with an updated configuration including the up-to-date NSSRG information for the S-NSSAIs in the Configured NSSAI as described above.\n-\ta non-supporting UE with an updated Configured NSSAI including only the S-NSSAIs sharing all the NSSRG values of the default S-NSSAI(s), only for the case where the UE context does not include an indication to provide all the subscribed S-NSSAIs in the subscription information in the Configured NSSAI for the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.13\tSupport of data rate limitation per Network Slice for a UE",
                            "text_content": "A UE subscription information may include an optional Slice Maximum Bit Rate for the UE (Subscribed UE-Slice-MBR) for an S-NSSAI, which applies for 3GPP access type only. The Subscribed UE-Slice-MBR includes a UL and a DL value. If a Subscribed UE-Slice-MBR is associated to an S-NSSAI in the subscription information, it is provided by the AMF to the NG-RAN when the AMF provides the Allowed NSSAI for the UE to the NG-RAN as UE-Slice-MBR QoS parameter. The UE-Slice-MBR QoS parameter is defined in clause 5.7.2.6. If the Subscribed UE-Slice-MBR for a UE changes, the AMF updates UE-Slice-MBR in the NG-RAN accordingly.\nIn roaming case, the UE-Slice-MBR is provided for the S-NSSAI of the VPLMN which maps to the S-NSSAI of the HPLMN and the AMF may first interact with the PCF for authorization of the Subscribed UE-Slice-MBR. If the AMF interacts with the PCF, the PCF may provide the Authorized UE-Slice-MBR that is used as UE-Slice-MBR by the AMF as described in clause 6.1.2.1 of TS 23.503 [45].\nFor a roaming UE, the S-NSSAI of the VPLMN maps to only one S-NSSAI of the HPLMN for which an UE-Slice-MBR is applied.\nThe enforcement of the UE-Slice-MBR value, if present in the UE context in the NG-RAN for an S-NSSAI, is described in clause 5.7.1.10.\nNOTE:\tThe PCF for the PDU Session may in addition be configured to monitor the data rate per Network Slice for a UE and to strengthen or relax the traffic restrictions for individual PDU Sessions or PCC rules accordingly, as described in TS 23.503 [45] clause 6.2.1.9.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.14\tNetwork Slice AS Groups support",
                            "text_content": "The NG-RAN may support Network Slice AS Groups (NSAGs) which are used as specified in TS 38.300 [27], TS 38.331 [28], TS 38.321 [143] and TS 38.304 [50]. A Network Slice AS Group is an identifier of a group of network slices which are associated with it. A Network Slice AS Group association with a group of network slices may be valid in one or more Tracking Areas. An S-NSSAI can be associated with at most one NSAG values for Random Access and at most one NSAG value for Cell Reselection within a Tracking Area. An S-NSSAI can be associated with different NSAG values in different Tracking Areas.\nThe NG-RAN provides (and updates) the AMF with the values of the NSAG(s) an S-NSSAI is associated with in a TA using the NG Set Up and RAN Configuration Update procedures (see TS 38.413 [34]). The AMF in turn provides this information to the NSSF. In deployments where the total number of groups does not exceed the number of groups associated with the NSAG size limit defined in TS 38.331 [28]), all the NSAGs configured in the NG-RAN may be unique per PLMN or SNPN. If the UE has indicated that the UE supports NSAG in the 5GMM Core Network Capability (see clause 5.4.4a), the AMF may, with or without NSSF assistance, configure the UE with NSAG Information for one or more S-NSSAIs in the Configured NSSAI, by including this NSAG Information in the Registration Accept message or the UE Configuration Command message. The UE uses the NSAG Information as defined in clause 5.3.4.3.1. The AMF shall indicate in the NSAG Information in which TA a specific NSAG association to S-NSSAI(s) is valid if the AMF provides in the UE configuration a NSAG value which is used in different TAs with a different association with NSSAIs. The configuration the AMF provides includes at least the NSAGs for the UE for the TAs of the Registration Area. If the AMF does not include the list of TAIs in association with an NSAG in the NSAG Information, the NSAG is valid in the Registered PLMN and equivalent PLMNs, or SNPN.\nNOTE:\tIf the NSAGs for the PLMN and equivalent PLMNs have different associations to S-NSSAIs, then the AMF includes the list of TAIs in the NSAG information.\nThe UE shall store and consider the received NSAG Information, valid for the Registered PLMN and equivalent PLMNs, or SNPN until:\n-\tthe UE receives new NSAG information in a Registration Accept message or UE Configuration Command message in this PLMN or SNPN; or\n-\tthe UE receives a Configured NSSAI without any NSAG information in this PLMN or SNPN.\nThe UE shall store the currently valid NSAG information received in the Registered PLMN or SNPN when registered in this PLMN or SNPN and:\n-\tThe UE should be able to store the NSAG information for at least the Registered-PLMN and equivalent PLMNs, or the Registered-SNPN and equivalent SNPNs.\n-\tThe Registered-PLMN can provide NSAG information to the UE for the PLMN and the equivalent PLMNs, and the Registered-SNPN can provide NSAG information to the UE for the SNPN.\n-\tThere can be at most 32 NSAGs configured in the UE at a time for a PLMN or SNPN.\n-\tAt most 4 NSAGs can have an optional TAI associated with it.\nThe NSAG information is not required to be stored after power off or after the UE becomes Deregistered as it is not used for cell selection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.15\tSupport of Network Slice usage control",
                            "text_content": "Network Slice usage control is achieved as follows:\n1)\tConfiguring network-controlled Slice Usage Policy to supporting UEs (see clause 5.15.15.2).\n2)\tConfiguring PDU Sessions inactivity timers, and Network Slice deregistration inactivity timers (see clause 5.15.15.3).\nNOTE:\tRoaming is not supported in this Release of the specification.\nThe UE during the Registration procedure may indicate in UE MM Core Network Capability that it supports UE configuration of network-controlled Slice Usage Policy. If so, the AMF determines Slice Usage Policy for one (or more) Network Slice(s) for the UE and configures the UE with this information together with Configured NSSAI to control the usage of this (or these) Network Slice(s). The AMF may be locally configured with network Slice Usage Policy, or receive the policy from the AM-PCF, or per the information received from UDM for AF managed timer values (see clause 5.15.15.3 for more details).\nThe network-controlled Slice Usage Policy is provided to the UE in the Registration Accept or the UE Configuration Update Command and may include:\n-\tAn indication, for one or more of S-NSSAI(s) of the HPLMN in the Configured NSSAI, whether the UE only registers with the Network Slice with the network when applications in the UE require data transmission in the Network Slice (i.e. the UE can only register the Network Slice only on demand and consider the Network Slice as on demand S-NSSAI).\nNOTE:\tAll Other Network Slices in the Configured NSSAI are handled by the UE using UE specific policies (e.g. they may be registered irrespective of applications need).\n-\tFor all on demand S-NSSAI(s) of the HPLMN in the Configured NSSAI, a deregistration inactivity timer that causes the UE to deregister the Network Slice after the last PDU Session associated with the S-NSSAI is released. This deregistration inactivity timer is started at the UE and AMF per access type when the last PDU Session associated with the S-NSSAI is released, or the Network Slice is included in the Allowed NSSAI and no PDU session is established. The deregistration inactivity timer is stopped and reset when the first PDU session is established or the S-NSSAI is removed from the Allowed NSSAI. The AMF and UE may locally remove the S-NSSAI from the Allowed NSSAI when the timer expires. The AMF may also send a UE Configuration Update Command to remove the slice from the Allowed NSSAI.\nIf the UE and network state became misaligned, the UE may, for example, request connectivity in a Network Slice which is no longer allowed. In this case, the AMF shall provide the updated Allowed NSSAI in a UE Configuration Update Command after rejecting the PDU Session establishment. The UE may then re-register with the Network Slice if needed.\nThe UE stores the received Slice Usage Policy with the Configured NSSAI for the serving PLMN and this is kept stored for as long as a Configured NSSAI remains stored for the PLMN. When the Configured NSSAI is updated, the AMF may also provide a new Slice Usage Policy to the UE.\nThe AMF receives deregistration inactivity timer values as described in clause 5.15.15.3. If the slice deregistration inactivity timer value is updated, the AMF provides the updated value to the UE, if the UE supports UE configuration of network-controlled Slice Usage Policy, during the registration procedure (i.e. subsequent registration if there is no ongoing registration). The AMF and the UE, if the update been provided to the UE successfully, use the updated slice deregistration inactivity timer value next time the slice deregistration inactivity timer starts.\nThe 5GC performs Network Slice usage monitoring to be able to enforce the release of inactive PDU Sessions, and deregistering of UEs from Network Slices with no PDU Sessions on them according to its own policies. In order to support usage monitoring for a Network Slice:\n-\tthe AMF runs a slice deregistration inactivity timer per S-NSSAI and access type to deregister the Network Slice which is started when the Network Slice is not used by any PDU Session over the corresponding access type. The slice deregistration inactivity timer is stopped and reset when at least a PDU Session associated with the Network Slice is successfully established or the Network Slice is removed form the Allowed NSSAI. When the slice deregistration inactivity timer for a Network Slice over an access type expires, the AMF removes the Network Slice from the Allowed NSSAI over the access type by sending the UE Configuration Update Command to impacted UE(s).\n-\tthe SMFs provide to UPFs that handle the PDU sessions in the Network Slice a PDU Session inactivity timer. The PDU Session inactivity timer is started after no data packet is transmitted or received and runs until the next data packet is transmitted or received which restarts the timer again. If the PDU Session inactivity timer expires before any packet is received or transmitted, the UPF reports this PDU Session inactivity event to the SMF to cause the SMF to release the PDU Session. While releasing the PDU session the SMF may indicate the release cause because of slice inactivity. When the AMF receives the notification of PDU Session release and it includes the release cause of slice inactivity and if the Network Slice of the released PDU Session is not used by other PDU Sessions (i.e. the last PDU Session using the Network Slice is released) over the corresponding access type, the AMF may trigger the UE Configuration Update procedure to remove the Network Slice from the Allowed NSSAI over that corresponding access type or start slice deregistration inactivity timer for the Network Slice.\nIf the PDU Session inactivity timer value is updated, the SMF provides the updated PDU Session inactivity timer value to the UPF. The UPF uses the updated PDU Session inactivity timer value immediately or next time the PDU Session inactivity timer starts.\nNOTE:\tFor MA PDU Session, the PDU Session inactivity timer is independent of Access Type.\nIf an S-NSSAI is dedicated for a single AF, and if authorized by operator policy to provide deregistration inactivity/PDU Session inactivity timer values for the S-NSSAI, the AF uses external parameter provisioning procedure to provide deregistration inactivity and PDU session inactivity timer values as described in clause 4.15.6.3g of TS 23.502 [3]. In this case, the AF provided timer values are stored in the UDM and provided to the AMF/SMF as part of subscription data for the corresponding S-NSSAI. If no AF is authorized to provide deregistration inactivity/PDU Session inactivity timer values for the S-NSSAI, i.e. no timer value received from UDM, the slice deregistration inactivity timer value and PDU Session inactivity timer value are either pre-configured in the AMF/SMF or received by the AMF/SMF during the AM Policy Association / SM Policy Association procedure respectively.\nTo enable a serving network to direct UEs to a preferred Network Slice, the AMF may request the UE to transfer a PDU Session from one S-NSSAI to another S-NSSAI as described in clause 5.15.19.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.16\tOptimized handling of temporarily available network slices",
                            "text_content": "A network slice may be available for all UEs or a limited number of UEs only for a limited time that is known at the network in advance e.g. by OAM or subscription. The limited time duration may be due to, for example, the fact that network slice is only temporarily or periodically active in the deployment (e.g. for a limited time to serve an event or a UE may be only authorized to access the network slice for a limited time known in advance), or the network slice is being decommissioned at a known future time. This feature is enabled by S-NSSAI validity time that the network and the UE can handle to reduce the signalling load associated to the transitions in RM and SM states for the network slice.\nThe UE may indicate its support for temporarily available network slices in the UE MM Core Network Capability (see clause 5.4.4a) in the Registration Request. The AMF, based on OAM configuration or information received from the UDM or NSSF, may indicate to a supporting UE the validity time for one or more S-NSSAIs in the Configured NSSAI in the Registration Accept message or via the UE Configuration Update procedure. In roaming case, the AMF my include the validity time for an S-NSSAI in the Configured NSSAI either because of limited availability of the VPLMN S-NSSAI or the mapped S-NSSAI of the HPLMN.\nNOTE 1:\tWhen the validity time changes or a validity time is determined for a S-NSSAI in the configured NSSAI, the PLMN provides the new validity time for the S-NSSAIs in the Configured NSSAI to a supporting UE.\nIf a supporting UE is configured with validity time for an S-NSSAI:\na)\tIf the validity time indicates the S-NSSAI is available, the UE may request the S-NSSAI in a Requested NSSAI in a Registration request and, if the S-NSSAI is included in the Allowed NSSAI or in the Partially Allowed NSSAI, the UE may establish PDU sessions associated with the S-NSSAI.\nb)\tIf the validity time indicates the S-NSSAI is not available\n-\tThe UE shall not include the S-NSSAI in the Requested NSSAI for any Access Types regardless of the validity time information was received;\n-\tIf the S-NSSAI is already part of the Allowed NSSAI or Partially Allowed NSSAI, the UE shall remove the S-NSSAI from the locally stored Allowed NSSAI or Partially Allowed NSSAI and the UE shall also locally release any PDU sessions associated with the S-NSSAI.\n-\tIf the validity time indicates the S-NSSAI will not be available again, the UE shall remove the S-NSSAI from the locally stored Configured NSSAI.\nNOTE 2:\tSubject to implementation decisions outside 3GPP scope, the UE may also use the validity time information to e.g. attempt to use another PDU sessions to continue supporting the connectivity with another connectivity option if possible according to the URSP rules, or, if not possible, e.g. provide implementation-dependent information on the availability of connectivity for specific applications affected by an impending connectivity loss, so the UE can let the end user prepare for the loss of connectivity.\nFor a supporting UE, if validity time applies to an S-NSSAI, an AMF supporting temporarily available network slices shall:\n-\tIf the S-NSSAI is provided in a Requested NSSAI in a Registration Request by the UE and the validity time indicates the S-NSSAI is not available, but it is going to become available again (i.e. the UE is detected as not having up to date validity time), then the AMF sends the Configured NSSAI to the UE including the validity time for the S-NSSAI in the Registration Accept message. If the validity time indicates the S-NSSAI is not available and will not become available again, then the AMF sends the Configured NSSAI to the UE, excluding the S-NSSAI from the Configured NSSAI.\n-\tIf the S-NSSAI is in the Allowed NSSAI or the Partially Allowed NSSAI for the UE and the validity time indicates that the S-NSSAI is not available, then locally remove (i.e. without sending any signalling to the UE) the S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI. If there is any PDU session established for the S-NSSAI, the AMF requests the SMF to release the PDU session:\n-\tIf the UE is in CM-CONNECTED state, the AMF releases the PDU session for the S-NSSAI by sending to the SMF, as per step 1f in clause 4.3.4.2 of TS 23.502 [3], a Nsmf_PDUSession_UpdateSMContext Request with a release indication to request the release of the PDU Session and then the AMF forwards the N2 SM request to release the AN resources associated with the PDU session\n-\tIf the UE is in CM-IDLE state, the AMF locally releases the PDU session without paging the UE and causes the SMF to locally release the SM context for the UE by a Nsmf_PDUSession_ReleaseSMContext, as in step 1c in clause 4.3.4.2 of TS 23.502 [3]. The PDU Session status is synchronized at next time when the UE connects to the network.\nFor a non-supporting UE, if validity time applies to an S-NSSAI, an AMF supporting temporarily available network slices shall:\n-\tIf the validity time indicates the S-NSSAI is available, allow or partially allow the network slice when requested, establish PDU sessions when requested.\n-\tIf the S-NSSAI is provided in a Requested NSSAI in a Registration Request by the UE and the validity time indicates the S-NSSAI is not available, reject the S-NSSAI and remove the S-NSSAI from the Configured NSSAI by providing an updated Configured NSSAI in the Registration Accept message.\n-\tIf the S-NSSAI is in the UE in the Allowed NSSAI or Partially Allowed NSSAI and the validity time indicates the S-NSSAI is not available, remove the S-NSSAI from the Configured NSSAI and the Allowed NSSAI or Partially Allowed NSSAI by a UE Configuration Update procedure. If there is any PDU session established for the S-NSSAI, the AMF requests the SMF to release the PDU session in the network:\n-\tIf the UE is in CM-CONNECTED state, the AMF releases the PDU session for the S-NSSAI by sending to the SMF, as in step 1f in clause 4.3.4.2 of TS 23.502 [3], a Nsmf_PDUSession_UpdateSMContext Request with a release indication to request the release of the PDU Session and then the AMF forwards the N2 SM request to release the AN resources associated with the PDU session\n-\tIf the UE is in CM-IDLE, the AMF locally releases the PDU session without paging the UE and causes the SMF to locally release the SM context for the UE by a Nsmf_PDUSession_ReleaseSMContext, as in step 1c in clause 4.3.4.2 of TS 23.502 [3]. The PDU Session status is synchronized at next time when the UE connects to the network\nNOTE 3:\tIf the network slice becomes unavailable, and a large number of UEs are impacted, the AMF can send the updates to the non-supporting UEs in a manner that avoids surge in signalling (e.g. next time the UE becomes connected).\n-\tIf the AMF detects from the validity time of a S-NSSAI that it is available again, then update the Configured NSSAI to include the S-NSSAI via a UE Configuration Update procedure.\nNOTE 4:\tThe AMF, for the case of UE not performing any actions despite the validity timing information provided by the network, can terminate PDU Session(s) associated with S-NSSAI subject to be terminated according to the validity time by explicitly releasing the PDU Sessions associated with the S-NSSAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.17\tPartial Network Slice support in a Registration Area",
                            "text_content": "A Network Slice may be supported in one or more TAs in a PLMN/SNPN. The Partial Network Slice support in a Registration Area for a UE includes configuring the UE with a Partially Allowed NSSAI and/or S-NSSAI(s) rejected partially in the RA.\nWhen creating a Registration Area for UEs registering over the 3GPP access and supporting the Partial Network Slice support in a Registration Area, the AMF may consider the trade-off between signalling for paging in TAs where the S-NSSAI is not supported versus the signalling for Mobility Registration Updates to register with the S-NSSAI in the TA(s) where the S-NSSAI is supported, so that the AMF may create a Registration Area including the TA(s) where a requested S-NSSAI is not supported. For supporting UEs, whether the AMF uses the Partially Allowed NSSAI or rejects the S-NSSAIs partially in the RA, or whether the AMF rejects the S-NSSAI for the current RA, is a per S-NSSAI decision which is based on AMF local policy. If supported and allowed by local policy, the Partially Allowed NSSAI and S-NSSAIs rejected partially in the RA may be applied simultaneously for one UE for different S-NSSAIs.\nFor such S-NSSAI:\n-\tIf requested by the UE from a TA where the S-NSSAI is not supported (including the case when the S-NSSAI is provided as a rejected S-NSSAI for the TA from the NSSF):\n-\tthe S-NSSAI is included either in the Partially Allowed NSSAI or the AMF rejects the S-NSSAI partially in the RA; or\n-\tif the S-NSSAI is subject to NSAC for maximum number of UEs, then the AMF should send this S-NSSAI as rejected partially in the RA, in the Registration Accept message.\n-\tIf the S-NSSAI is subject to NSSAA and successful NSSAA status for the S-NSSAI is not present in the AMF, then the AMF either sends this S-NSSAI as rejected partially in the RA in the Registration Accept message, or the AMF starts executing NSSAA and includes the S-NSSAI in the Pending NSSAI in the Registration Accept message. If the S-NSSAI is subject to NSSAA and successful NSSAA status for the S-NSSAI is present, then the AMF may include the S-NSSAI either in the Partially Allowed NSSAI or the AMF rejects the S-NSSAI partially in the RA.\nNOTE 1:\tIn roaming case the NSSAA requirement is based on the mapped S-NSSAI of the HPLMN.\n-\tif the slice deregistration inactivity timer is configured for the S-NSSAI (see clause 5.15.15.3), then AMF should send this S-NSSAI as rejected partially in the RA.\n-\tIf requested by the UE from a TA where the S-NSSAI is supported (including the case when the S-NSSAI is provided in the Allowed NSSAI from the NSSF):\n-\tthe S-NSSAI is included in the Partially Allowed NSSAI; or\n-\tif the S-NSSAI is subjected to NSAC for maximum number of UEs, then the AMF should restrict the RA so that the S-NSSAI is supported in all the TAs of the RA and includes the S-NSSAI in the Allowed NSSAI.\n-\tIf the S-NSSAI is subject to NSSAA, then the AMF starts executing NSSAA and sends this S-NSSAI in the Pending NSSAI in the Registration Accept message, unless successful NSSAA status is present in the AMF for this S-NSSAI (in which case it can be sent in the Partially Allowed NSSAI).\nNOTE 2:\tIn roaming case the NSSAA requirement is based on the mapped S-NSSAI of the HPLMN.\n-\tif the S-NSSAI is included in neither the Partially Allowed NSSAI nor the Allowed NSSAI, the AMF may reject the S-NSSAI as described in clause 5.15.4.1.1.\nWhile the S-NSSAIs of the Allowed NSSAI are supported in all the TAs of the Registration Area, the S-NSSAIs of the Partially Allowed NSSAI are supported only in the TAs corresponding to the list of TAs (which are subset of the list of TAIs forming the Registration Area) associated with the S-NSSAI.\nIf the UE supports Partial Network Slice support in a Registration Area, the AMF may create a Registration Area for the UE considering the support of the S-NSSAIs of the Requested NSSAI in the current TA and in the neighbouring TAs and provides to the UE in the Registration Accept message or in the UE Configuration Update Command message the Partially Allowed NSSAI or the S-NSSAIs rejected partially in the RA as follows:\n-\tIf one or more of the requested S-NSSAI(s) are supported in a subset of the TAs of the (potential) Registration Area, the AMF may include such S-NSSAI(s) in the Partially Allowed NSSAI and corresponding mapping information of the S-NSSAI(s) of the Partially Allowed NSSAI to the HPLMN S-NSSAI(s). For each S-NSSAI of the Partially Allowed NSSAI the AMF provides a list of TAs where the S-NSSAI is supported. The UE is considered registered with the S-NSSAI in the whole Registration area. The AMF also provides the Partially Allowed NSSAI (without indication of the TA list where the partially allowed S-NSSAIs are supported) to the NG-RAN together with the UE's context.\n-\tAlternatively, the AMF may reject the S-NSSAI(s) with reject cause indicating \"partially in the RA\". For each S-NSSAI of the S-NSSAIs rejected partially in the RA the AMF provides a list of TAs where the S-NSSAI is not supported.\nNOTE 3:\tIf the UE requests an S-NSSAI in a cell of a TA where the NS-AoS of the S-NSSAI does not match deployed Tracking Areas (see clause 5.15.18), the AMF includes the S-NSSAI in the Allowed NSSAI or Partially Allowed NSSAI.\nWhen the UE stores Partially Allowed NSSAI the following applies:\n-\tthe UE is considered registered with an S-NSSAI of the Partially Allowed NSSAI in the whole Registration area. The UE does not trigger registration when moving between the TAs of support and non-support for the S-NSSAI within the RA.\n-\tThe UE is allowed to initiate PDU Session establishment for the S-NSSAI only when the UE is in a TA where the S-NSSAI is supported.\n-\tIf the AMF determines a PDU Session is associated with S-NSSAI present in the Partially Allowed NSSAI, the AMF indicates to the SMF that the PDU Session is subject to area restrictions for the S-NSSAI. As a result, the SMF subscribes to \"UE mobility event notification\" for reporting UE presence in Area of Interest by providing S-NSSAI to the AMF as described in clauses 5.6.11 and 5.3.4.4.\n-\tWhen the UE has already established a PDU Session with an S-NSSAI part of the Partially Allowed NSSAI, the UE is allowed to activate the User Plane resources of the PDU Session only when the UE is in a TA part of the list of TAs associated with the S-NSSAI.\n-\tWhen the User Plane resources are activated for a PDU Session of an S-NSSAI part of the Partially Allowed NSSAI and the UE moves to a TA which is not part of the list of TAs associated with the S-NSSAI, the User Plane resources for the PDU Session shall be deactivated, but the PDU Session context in UE and SMF is not released. The User Plane resources for the PDU Session shall not be activated as long as the UE is located in a TA which is not part of the list of TAs associated with the S-NSSAI of the Partially Allowed NSSAI. The UE shall not send user data as payload of a NAS message (see clause 5.31.4.1) in uplink directions. When the SMF is notified by the AMF that the UE location is outside of the Area of Interest, the SMF shall not send user data as payload of NAS message (see clause 5.31.4.1) in downlink directions and disable data notification. When the SMF is notified by the AMF that the UE location is UNKNOWN as defined in Annex D, clauses D.1 and D.2 of TS 23.502 [3], then based on operator policy SMF may enable downlink data notification and trigger the Network triggered Service Request procedure to active the UP connection or send user data as payload of a NAS message (see clause 5.31.4.1) when the SMF receives downlink data or Data Notification from UPF.\nEditor's note:\tWhether and based on what criteria to trigger the reporting and the applicability to the CP CIOT optimization use cases are FFS.\nFor an already established PDU Session associated with an S-NSSAI included in the Partially Allowed NSSAI, even when the UE is in a TA where the S-NSSAI is not supported, the UE and the SMF may initiate a PDU Session release procedure or PDU Session modification procedure (i.e. for PS data off status change reporting).\nWhen the UE stores a S-NSSAI rejected partially in the RA with the associated list of TAs, the UE is allowed to initiate a Mobility Registration Update procedure to request registration with the S-NSSAI only when the UE is in a TA which is not part of the list of TAs associated with this S-NSSAI.\nFor a UE in CM-CONNECTED state, when a PDU Session is established on an S-NSSAI included in the Partially Allowed NSSAI, the User Plane resources are activated and the UE moves to a TA where the S-NSSAI is not supported, the NG-RAN releases the User Plane resources of the PDU sessions associated with the S-NSSAIs, as described in step 1d of clause 4.3.4.2 of TS 23.502 [3] and the SMF deactivates the PDU session as described in step 3a of clause 4.3.4.2 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.18\tSupport for Network Slices with Network Slice Area of Service not matching deployed Tracking Areas",
                            "text_content": "The network support for a Network Slice is defined on a per Tracking Area granularity. It may be beneficial to deploy some Network Slices such that the Network Slice have a limited geographical availability that is not matching existing Tracking Area boundaries.\nThe operator can in this case decide to change the topology of the Tracking Areas so they match the boundaries of the Network Slice, or the operator may configure resources for the Network Slices in the cells of TAs where the Network Slices are to be available, and in areas of the TAs where the network slice is defined to be not available the cells are configured with zero resources.\nThe AMF receives from the OAM the information on availability of a network slice when the granularity is smaller than TA, i.e. if the NS-AoS includes TAs where the network slice is not available in some cells of the TA.\nIn order to optimize the end-to-end behaviour, the AMF can, based on NS-AoS information received from OAM, configure supporting UEs with S-NSSAI location availability information, and the network may need to monitor the S-NSSAI usage and enforce the NS-AoS e.g. if the UE does not support the S-NSSAI location availability information.\nS-NSSAI location availability information defines additional restrictions to the usage of an S-NSSAI in TAs where the Network Slice availability does not match the TA boundaries. The AMF is configured per S-NSSAI whether to send the S-NSSAI location availability information to supporting UEs.\nThe S-NSSAI location availability information sent to the UE includes, for each applicable S-NSSAI of the Configured NSSAI, Location information indicating the cells of TAs in the RA where the related S-NSSAI is available if the S-NSSAI is not available in all the cells of the TA.\nIf the UE has indicated that the UE supports S-NSSAI location availability information in the 5GMM Core Network Capability (see clause 5.4.4a), the AMF may, based on OAM configuration, configure the UE with S-NSSAI location availability information for one or more S-NSSAIs when the AMF allocates an RA where the Network Slice availability does not match whole TAs, by including the S-NSSAI location availability information in the Registration Accept message or the UE Configuration Command message. A UE that receives S-NSSAI location availability information applies the information as follows.\n1.\tIf the S-NSSAI is rejected in the RA or rejected partially in the RA or rejected with a cause code that allows attempting to register the S-NSSAI again, the UE can request the S-NSSAI only if the S-NSSAI location availability information indicates that the S-NSSAI is available at the cell where the UE is camping.\n2.\tIf the S-NSSAI is in the Partially Allowed NSSAI or in the Allowed NSSAI and the UE is in a cell within the RA but outside the NS-AoS of the S-NSSAI, the following applies:\na.\tThe UE shall not activate User Plane resources for any already established PDU Session with that S-NSSAI.\nb.\tThe UE shall not send user data as payload of a NAS message (see clause 5.31.4.1) in uplink direction.\nc.\tFor an already established PDU Session, the UE and the SMF may initiate signalling for PDU Session release procedure or PDU Session modification procedure (i.e. for PS data off status change reporting).\n3.\tIf the S-NSSAI is in the Partially Allowed NSSAI or in the Allowed NSSAI, and the UE in CM-CONNECTED state moves from a cell inside the NS-AoS to a cell outside the NS-AoS and the User Plane resources are active for a PDU Session on that S-NSSAI, the NG-RAN deactivates the User Plane resources as described in the AN initiated modification of a PDU Session in clause 4.3.3.2 of TS 23.502 [3].\nNOTE 1:\tBy Radio Resource Management and existing mechanisms in NG-RAN, handover can be used to keep the UE in the NS-AoS or steer the UE to enter the NS-AoS as long as radio conditions allow it.\nNOTE 2:\tSince the S-NSSAI location availability information is not a used as a trigger for the UE to perform MRU due to mobility, i.e. the UE performs MRU due to mobility upon changing to a new TA outside the UE's Registration Area, the S-NSSAI remains registered and is included in the Allowed NSSAI when the UE exits the NS-AoS. If the S-NSSAI is subject for NSAC, the S-NSSAI is counted towards NSAC as described in clause 5.15.11 also when the UE is outside the NS-AoS.\nOAM may configure RRM policies for S-NSSAIs on a per cell basis as defined in TS 28.541 [149], i.e. cells outside the Network Slice Area of Service while in a TA supporting the S-NSSAI are allocated with no RRM resources for the S-NSSAI.\nThe network may enforce the NS-AoS for an S-NSSAI as follows:\n1.\tThe network may monitor the validity of the S-NSSAI for UE in CM-CONNECTED state, i.e. the AMF subscribes to the AoI using the Location information of the S-NSSAI location availability information as described in TS 38.413 [34].\n2.\tIf the non-supporting UE makes a PDU Session establishment request with an S-NSSAI that is not valid as per the S-NSSAI location availability information, the AMF may reject the NAS Transport message with a back-off timer using S-NSSAI based congestion control as described in clause 5.19.7.4.\n3.\tIf the AMF determines that the UE in CM-CONNECTED has moved outside the NS-AoS, the AMF performs the following logic:\na)\tIf the non-supporting UE has other S-NSSAI(s) in the Allowed NSSAI, then the AMF may update the UE with a UE Configuration Update by removing the S-NSSAI from the Allowed NSSAI (which causes the UE to locally release the PDU Sessions) and optionally removing the S-NSSAI from the Configured NSSAI and then, the AMF requests the SMF to locally release in the network any PDU Sessions with that S-NSSAI as per step 1f in clause 4.2.3.4 in TS 23.502 [3]. Alternatively, the AMF requests the SMF to release PDU Sessions with that S-NSSAI.\nb)\tIf the non-supporting UE does not have any other S-NSSAI in the Allowed NSSAI, then the AMF may update the UE with a UE Configuration Update by removing the S-NSSAI from the Allowed NSSAI (which causes the UE to locally release the PDU Sessions) and optionally removing the S-NSSAI from the Configured NSSAI, and adding a default S-NSSAI to the Allowed NSSAI and then, the AMF requests the SMF to locally release in the network any PDU Sessions with the removed S-NSSAI as per step 1f in clause 4.2.3.4 in TS 23.502 [3]. Alternatively, the AMF requests the SMF to release PDU Sessions with that S-NSSAI.\nNOTE:\tWhether the AMF removes the S-NSSAI from Allowed NSSAI and Configured NSSAI or only releases the associated PDU Sessions when the AMF enforces the NS-AoS is up to AMF configuration.\nc)\tFor a non-supporting UE that does not have any other S-NSSAI in the Allowed NSSAI nor in the Configured NSSAI, then the AMF indicates to the SMF to release the PDU Session.\n4.\tIf the AMF determines that the S-NSSAI becomes valid e.g. the UE has moved into the NS-AoS, the AMF may update the UE with a UCU e.g. including the S-NSSAI in the Configured NSSAI.\n5.\tWhen the AMF determines that the S-NSSAI of a PDU Session is restricted to an NS-AoS in the PDU session, the AMF indicates to the SMF that the PDU Session is subject to area restriction for the S-NSSAI. As a result, the SMF subscribes to \"UE mobility event notification\" for reporting UE presence in Area of Interest by providing S-NSSAI to the AMF as described in clauses 5.6.11 and 5.3.4.4. When SMF is notified that the UE location is outside of Area of Interest, SMF shall not send user data as payload of NAS message (see clause 5.31.4.1) in downlink directions and disable data notification.\n6.\tWhen the SMF is notified by the AMF that the UE location is UNKNOWN as defined in Annex D, clauses D.1 and D.2 of TS 23.502 [3], then based on operator policy SMF may enable downlink data notification and trigger the Network triggered Service Request procedure to active the UP connection or send user data as payload of a NAS message (see clause 5.31.4.1) when the SMF receives downlink data or Data Notification from UPF.\nEditor's note:\tWhether and based on what criteria to trigger the reporting and the applicability to the CP CIOT optimization use cases are FFS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.19\tSupport of Network Slice Replacement",
                            "text_content": "The Network Slice Replacement feature is used to temporarily replace an S-NSSAI with an Alternative S-NSSAI when an S-NSSAI becomes unavailable or congested. The Network Slice Replacement may be triggered in the following cases:\n-\tIf the NSSF detects that an S-NSSAI becomes unavailable or congested (e.g. based on OAM or NWDAF analytics output), it sends network slice availability notification for the S-NSSAI to the AMF. The notification may include an Alternative S-NSSAI which can be used by the AMF to replace the S-NSSAI. The NSSF notifies the AMF when the S-NSSAI is available again.\n-\tIf the PCF detects that an S-NSSAI becomes unavailable or congested for a UE (e.g. based on OAM or NWDAF analytics output), it sends access and mobility related policy notification to the AMF. The notification may include an Alternative S-NSSAI which can be used by the AMF to replace the S-NSSAI. The PCF notifies the AMF when the S-NSSAI is available again for the UE.\n-\tThe OAM sends notification to AMF when an S-NSSAI becomes unavailable or congested (and also when this S-NSSAI becomes available again) and provides the Alternative S-NSSAI to AMF.\nThe network slice associated with the Alternative S-NSSAI is assumed in this specification to have NS-AoS to be covering at least the NS-AoS of the replaced network slice.\nNOTE 1:\tIt is recommended to use a network slice associated with the Alternative S-NSSAI that is able to support requirements for the services that the replaced network slice supports.\nNOTE 2:\tThere are no means for the PLMN to prevent the UE from obtaining service in the Alternative network slice in cells outside the NS-AoS of the replaced network slice but within the NS-AoS of the Alternative network slice if the Alternative network slice NS-AoS exceeds the NS-AoS of the replaced network slice.\nBased on the notification above from NSSF or PCF or OAM, the AMF may determine that an S-NSSAI is to be replaced with Alternative S-NSSAI. For roaming case, the AMF subscribes the network slice availability notification of the HPLMN S-NSSAI from the NSSF in VPLMN and the NSSF in VPLMN subscribes the notification from NSSF in the HPLMN as described in clause 5.15.6.\nNOTE 3:\tIt is recommended that, the operator configures to use only one option, i.e. OAM, PCF or NSSF, for determining an Alternative S-NSSAI and triggering the Network Slice Replacement for S-NSSAI.\nThe AMF uses the Alternative S-NSSAI received in the notification from the NSSF, or from OAM or from the PCF If the NSSF or PCF or OAM do not provide an Alternative S-NSSAI in the notification, the AMF uses an Alternative S-NSSAI based on local configuration. The Alternative S-NSSAI shall be supported in the UE Registration Area. If AMF cannot determine the Alternative S-NSSAI for the S-NSSAI, e.g. OAM or NSSF doesn't provide Alternative S-NSSAI and there is no Alternative S-NSSAI in the AMF local configuration, the AMF may further interact with the PCF to determine the Alternative S-NSSAI. The event trigger in AMF for interacting with PCF is described in clause 6.1.2.5 of TS 23.503 [45].\nIf the Alternative S-NSSAI is subject to NSSAA, the Alternative S-NSSAI shall only be used for UEs for which the Alternative S-NSSAI is included in the Subscribed S-NSSAIs. In this case, the AMF performs the NSSAA procedure for the Alternative S-NSSAI as described in clause 5.15.10 before the AMF triggers Network Slice Replacement as specified below.\nThe UE indicates the support of Network Slice Replacement feature during the UE Registration procedure. For supporting UE in CM-CONNECTED state and if there is a PDU Sessions in the UE context associated with the S-NSSAI that needs to be replaced, the AMF additionally provides the Alternative S-NSSAI for this S-NSSAI in the Allowed NSSAI and in the Configured NSSAI, if not included yet, and the mapping between S-NSSAI(s) to Alternative S-NSSAI(s) to the UE in UE Configuration Update message as follows:\n-\tfor non-roaming UEs, the AMF provides the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE.\nNOTE 4:\tIn the non-roaming case, the Alternative S-NSSAI does not have to be a Subscribed S-NSSAIs, as the replaced S-NSSAI is always a subscribed S-NSSAI.\n-\tfor roaming UEs when the VPLMN S-NSSAI has to be replaced by a VPLMN Alternative S-NSSAI, the AMF provides the mapping of the VPLMN S-NSSAI to the Alternative VPLMN S-NSSAI to the UE.\n-\tfor roaming UEs when the HPLMN S-NSSAI has to be replaced by an Alternative HPLMN S-NSSAI, the AMF provides the mapping of the HPLMN S-NSSAI to the Alternative HPLMN S-NSSAI to the UE.\nNOTE 5:\tIn the roaming cases, the Alternative HPLMN S-NSSAI does not have to be one of the Subscribed S-NSSAIs as the replaced HPLMN S-NSSAI is always part of the Subscribed S-NSSAIs.\nFor the supporting UE when the UE has a NAS signalling connection, i.e. it is CM-CONNECTED or it has become CM-CONNECTED, e.g. through a Service Request procedure or through a UE registration procedure, if the AMF determines that the S-NSSAI is to be replaced and there is a PDU Session associated with the S-NSSAI in the UE context (see also NOTE 3), the AMF sends the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE in the UE Configuration Update message or in the Registration Accept message.\nNOTE 6:\tIt is left to AMF local policy whether to send the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE when there is no PDU session associated with the S-NSSAI or wait and send the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE when the UE establishes a PDU Session associated with the S-NSSAI.\nDuring a new PDU Session establishment procedure for a S-NSSAI,\n-\tif the UE has received together with the Allowed NSSAI a mapping of the S-NSSAI to an Alternative S-NSSAI, the UE shall provide both the Alternative S-NSSAI and the S-NSSAI in the PDU Session Establishment message. When the AMF receives the Alternative S-NSSAI and the S-NSSAI in the PDU Session Establishment message, the AMF includes both the Alternative S-NSSAI and the S-NSSAI to the SMF in Nsmf_PDUSession_CreateSMContext service operation.\n-\tif the UE has not yet received with the Allowed NSSAI a mapping of the S-NSSAI to the Alternative S-NSSAI, the UE provides only the S-NSSAI in the PDU Session Establishment message. If the AMF determines that the requested S-NSSAI is to be replaced with the Alternative S-NSSAI and if the UE supports Network Slice Replacement, the AMF performs UE Configuration Update procedure to reconfigure the UE with the Alternative S-NSSAI. The AMF continues the PDU Session establishment procedure with the Alternative S-NSSAI and provides both the Alternative S-NSSAI and the S-NSSAI to the SMF in Nsmf_PDUSession_CreateSMContext service operation.\nThe SMF proceeds with the PDU Session establishment using the Alternative S-NSSAI. The SMF sends the Alternative S-NSSAI to NG-RAN in N2 SM information and to UE in PDU Session Establishment Accept message.\nFor existing PDU Session associated with an S-NSSAI that is replaced with the Alternative S-NSSAI, after the AMF sends mapping of the S-NSSAI to the Alternative S-NSSAI to the supporting UE in UE Configuration Update message, the AMF sends updates to the SMF of the PDU Session, e.g. triggering Nsmf_PDUSession_UpdateSMContext service operation, that the PDU Session is to be transferred to Alternative S-NSSAI and includes the Alternative S-NSSAI as follows (see details in clause 4.3.3 of TS 23.502 [3]):\n-\tIf the SMF determines that the PDU Session is to be retained (e.g. if the anchor UPF can be reused with the alternative S-NSSAI and SSC mode 1), the SMF sends the Alternative S-NSSAI to the UPF in the N4 message, to the NG-RAN in N2 message and to the supporting UE in PDU Session Modification Command message. The S-NSSAI provided to the (R)AN and to the UPF is the Alternative S-NSSAI.\n-\tIf the SMF determines that the PDU Session is to be re-established, the SMF sends the Alternative S-NSSAI to the supporting UE either in PDU Session Modification Command if the PDU Session is of SSC mode 3, or in PDU Session Release if the PDU Session is of SSC mode 2 or SSC mode 1, to trigger the re-establishment of the PDU Session. The UE includes both, the S-NSSAI and the Alternative S-NSSAI in the PDU Session Establishment message.\nWhen the AMF is notified that the S-NSSAI is available again (e.g. the congestion of the S-NSSAI has been mitigated), if the AMF has configured the supporting UE with the Alternative S-NSSAI, and the AMF determines for the UE to use the replaced S-NSSAI again, the AMF reconfigures the supporting UE (e.g. by using UE Configuration Update procedure or in the next registration procedure) to use the replaced S-NSSAI again by removing the mapping of the replaced S-NSSAI to Alternative S-NSSAI.\nIf there is an existing PDU Session associated with the Alternative S-NSSAI, the AMF updates the SMF(s) of the PDU Session(s), by Nsmf_PDUSession_UpdateSMContext service operation, causing the PDU Session to be transferred to the S-NSSAI. The event trigger in SMF for interacting with PCF is described in clause 6.1.3.5 of TS 23.503 [45].\nDuring a handover procedure, if an S-NSSAI has to be replaced with an Alternative S-NSSAI, the handover procedure (including any PDU session associated with the S-NSSAI to be replaced) shall continue unaffected by the Network Slice Replacement. Any Network Slice Replacement for the S-NSSAI shall not take place during the handover.\nDuring NSSAA re-authentication procedure for an S-NSSAI, if the S-NSSAI has to be replaced with Alternative S-NSSAI, the AMF shall continue with the NSSAA procedure unaffected by the Network Slice Replacement and the AMF executes the Network Slice Replacement after the NSSAA procedure is completed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.15.20\tSupport of Network Slice Instance Replacement",
                            "text_content": "The Network Slice Instance Replacement is used when a PDU Session for a given S-NSSAI is established using a selected Network Slice instance and the S-NSSAI corresponding to this Network Slice instance is associated with multiple Network Slice instances. In this case, the network may change the Network Slice instance for the S-NSSAI if the selected Network Slice instance is no longer available (e.g. due to overload). The AMF may subscribe with the NSSF for notifications when any of the Network Slice instances served by the AMF is congested or no longer available. In case of roaming, the NSSF of VPLMN subscribes with the NSSF of the HPLMN for notifications. When the NSSF notifies the AMF that a Network Slice instance is congested or no longer available, for some of PDU Sessions associated with the Network Slice instance that is no longer available, the AMF may delete old NSI ID corresponding to the Network Slice instance that is no longer available and the SMF of the PDU Session(s) selected by using such old NSI ID is informed by the AMF to release the PDU Session(s). Subsequently, the SMF triggers the impacted UE(s) to establish new PDU session(s) associated with the same S-NSSAI as described in clause 5.6.9.2 for PDU Session(s) of SSC Mode 2 and SSC Mode 3. The AMF selects a new Network Slice instance for the given S-NSSAI during PDU Session Establishment.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.16\tSupport for specific services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.16.1\tPublic Warning System",
                            "text_content": "The functional description for supporting Public Warning System for 5G System can be found in TS 23.041 [46].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.16.2\tSMS over NAS",
                            "text_content": "This clause includes feature description for supporting SMS over NAS in 5G System. Support for SMS incurs the following functionality:\n-\tSupport for SMS over NAS transport between UE and AMF. This applies to both 3GPP and Non 3GPP accesses.\n-\tSupport for AMF determining the SMSF for a given UE.\n-\tSupport for subscription checking and actual transmission of MO/MT-SMS transfer by the SMSF.\n-\tSupport for MO/MT-SMS transmission for both roaming and non-roaming scenarios.\n-\tSupport for selecting proper domains for MT SMS message delivery including initial delivery and re-attempting in other domains.\n5G System supports SMS over NAS via both 3GPP access and non-3GPP access.\nDuring Registration procedure, a UE that wants to use SMS provides an \"SMS supported\" indication over NAS signalling indicating the UE's capability for SMS over NAS transport. \"SMS supported\" indication indicates whether UE can support SMS delivery over NAS. If the core network supports SMS functionality, the AMF includes \"SMS allowed\" indication to the UE, and whether SMS delivery over NAS is accepted by the network.\nSMS is transported via NAS transport message, which can carry SMS messages as payload.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.16.3\tIMS support",
                            "text_content": "IP-Connectivity Access Network specific concepts when using 5GS to access IMS can be found in TS 23.228 [15].\n5GS supports IMS with the following functionality:\n-\tIndication toward the UE if IMS voice over PS session is supported.\n-\tCapability to transport the P-CSCF address(es) to UE.\n-\tPaging Policy Differentiation for IMS as defined in TS 23.228 [15].\n-\tIMS emergency service as defined in TS 23.167 [18].\n-\tDomain selection for UE originating sessions.\n-\tTerminating domain selection for IMS voice.\n-\tSupport of P-CSCF restoration procedure (clause 5.16.3.9).\n-\tNRF based P-CSCF discovery (clause 5.16.3.11).\nNOTE:\tThe NRF based P-CSCF discovery has no impact on the UE, i.e. the UE does not need to know how P-CSCF IP address(es) is discovered in the network.\n-\tNRF based HSS discovery (clause 5.16.3.12).\nThe serving PLMN AMF shall send an indication toward the UE during the Registration procedure over 3GPP access to indicate if an IMS voice over PS session is supported or not supported in 3GPP access and non-3GPP access. A UE with \"IMS voice over PS\" voice capability over 3GPP access should take this indication into account when performing voice domain selection, as described in clause 5.16.3.5.\nThe serving PLMN AMF may only indicate IMS voice over PS session supported over 3GPP access in one of the following cases:\n-\tIf the network and the UE are able to support IMS voice over PS session in the current Registration Area with a 5G QoS Flow that supports voice as specified in clause 5.7.\n-\tIf the network or the UE are not able to support IMS voice over PS session over NR connected to 5GC, but is able for one of the following:\n-\tIf the network and the UE are able to support IMS voice over PS session over E-UTRA connected to 5GC, and the NG-RAN supports a handover or redirection to E-UTRA connected to 5GC for this UE at QoS Flow establishment for IMS voice;\n-\tIf the UE supports handover to EPS, the EPS supports IMS voice, and the NG-RAN supports a handover to EPS for this UE at QoS Flow establishment for IMS voice; or\n-\tIf the UE supports redirection to EPS, the EPS supports IMS voice, and the NG-RAN supports redirection to EPS for this UE at QoS Flow establishment for IMS voice.\n-\tIf the network is not able to provide a successful IMS voice over PS session over E-UTRA connected to 5GC, but is able for one of the following:\n-\tIf the UE supports handover to EPS, the EPS supports IMS voice, and the NG-RAN supports a handover to EPS for this UE at QoS Flow establishment for IMS voice; or\n-\tIf the UE supports redirection to EPS, the EPS supports IMS voice, and the NG-RAN supports redirection to EPS for this UE at QoS Flow establishment for IMS voice.\nThe serving PLMN provides this indication based e.g. on local policy, UE capabilities, HPLMN, whether IP address preservation is possible, whether NG-RAN to UTRAN SRVCC is supported and how extended NG-RAN coverage is, and the Voice Support Match Indicator from the NG-RAN (see clause 4.2.8a of TS 23.502 [3]).\nNOTE 1:\tThe terms \"UE supports handover to EPS\" or \"UE supports redirection to EPS\" used above also consider the case that the UE has signalled that S1 mode is enabled. In case the UE has signalled that S1 mode is disabled for a network that only supports IMS voice via EPS Fallback, the AMF will not indicate that IMS voice over PS session is supported over 3GPP access. A voice centric UE ensures its voice service as described in clauses 5.16.3.5 and 5.16.3.6.\nThe AMF in serving PLMN shall indicate that IMS voice over PS is supported only if the serving PLMN has a roaming agreement that covers support of IMS voice with the HPLMN. This indication is per Registration Area.\nNOTE 2:\tIf the network supports EPS fallback for voice the 5GC can be configured not to perform the Voice Support Match Indicator procedure in order to set the IMS voice over PS session Supported Indication.\nThe serving SNPN provides the IMS voice over PS indication based e.g. on local policy, UE capabilities, whether IP address preservation is possible, and how extended NR coverage is. This indication is per Registration Area.\nNOTE 3:\tSince over 3GPP access, in SNPN access mode there is only support for NR and the \"voice centric\" UE cannot reselect to another RAT in the same registered SNPN if the first Registration Area that the UE tries to register from cannot support IMS voice, it is recommended that support for IMS voice is provided homogeneously in the whole SNPN if at all.\nThe serving PLMN AMF shall send an indication toward the UE during the Registration procedure over non-3GPP access to indicate whether an IMS voice over PS session is supported or not supported via non-3GPP access. A UE with \"IMS voice over PS\" voice capability over non-3GPP access should take this indication (received in the Registration procedure performed over either 3GPP access or Non-3GPP access) into account when performing the selection between N3IWF/TNGF and ePDG described in clause 6.3.6.\nThe serving PLMN AMF may only indicate IMS voice over PS session supported over non-3GPP access if the network is able to provide a successful IMS voice over PS session over N3IWF/TNGF connected to 5GC with a 5G QoS Flow that supports voice as specified in clause 5.7.\n5GC shall support the usage of \"Homogeneous Support of IMS Voice over PS Sessions\" indication between AMF and UDM.\nWhen the AMF initiates Nudm_UECM_Registration operation to the UDM, it shall:\n-\tif \"IMS Voice over PS Sessions\" is supported homogeneously in all TAs in the serving AMF for the UE, include the \"Homogeneous Support of IMS Voice over PS Sessions\" indication set to \"Supported\";\n-\tif none of the TAs of the serving AMF supports \"IMS Voice over PS Sessions\" for the UE, include the \"Homogeneous Support of IMS Voice over PS Sessions\" indication set to \"Not supported\";\n-\tif \"IMS Voice over PS Sessions\" support is either non-homogeneous or unknown, not include the \"Homogeneous Support of IMS Voice over PS Sessions\" indication.\nThe AMF shall be able to provide the \"Homogeneous Support of IMS Voice over PS Sessions\" indication as described above to the UDM using Nudm_UECM_Update operation as specified in clause 4.2.2.2.2 of TS 23.502 [3].\nThe UDM shall take this indication into account when doing Terminating Access Domain Selection (T-ADS) procedure for IMS voice.\nNOTE:\tA TA supports \"IMS Voice over PS Sessions\" if the serving AMF indicates IMS voice over PS Session Supported Indication over 3GPP access to the UE, as described in clause 5.16.3.2. In order to support routing of incoming IMS voice calls to the correct domain, the network-based T-ADS (see TS 23.292 [63] and TS 23.221 [23]) requires that the \"Homogeneous Support of IMS Voice over PS Sessions\" indication is set to \"Supported\" for all registered TAs of the UE or \"Not supported\" for all registered TAs of the UE.\nAt PDU Session Establishment procedure related to IMS, SMF shall support the capability to send the P-CSCF address(es) to UE. The SMF is located in VPLMN if LBO is used. This is sent by visited SMF if LBO is used. For Home routed, this information is sent by the SMF in HPLMN. P-CSCF address(es) shall be sent transparently through AMF, and in the case of Home Routed also through the SMF in VPLMN. The P-CSCF IP address(es) may be locally configured in the SMF, or discovered using NRF as described in clause 5.16.3.11.\nNOTE 1:\tOther options to provide P-CSCF to the UE as defined in TS 23.228 [15] is not excluded.\nNOTE 2:\tPDU Session for IMS is identified by \"APN\" or \"DNN\".\nIn the case of SNPN access the SMF is always located in the serving SNPN (no support for Home Routed traffic); therefore, the serving SMF sends the P-CSCF address(es) to the UE.\nFor UE originating calls, the 5GC capable UE performs access domain selection. The UE shall be able to take following factors into account for access domain selection decision:\n-\tThe state of the UE in the IMS. The state information shall include: Registered, Unregistered.\n-\tThe \"IMS voice over PS session supported indication\" as defined in clause 5.16.3.2.\n-\tWhether the UE is expected to behave in a \"voice centric\" or \"data centric\" way for 5GS.\n-\tUE capability of supporting IMS PS voice.\n-\tUE capability for operating in dual-registration mode with selective PDU Session transfer as defined in clause 5.17.2.3.3.\n-\tWhether 3GPP PS Data Off is active or not and whether IMS voice is included in 3GPP PS Data Off Exempt Services or not as defined in clause 5.24.\nNOTE 1:\tIn this release of the specification, the exact logic of which PDU sessions are kept in which system for Dual Registration UE with selective transfer of certain PDU Sessions as defined in clause 5.17.2.3.3, is left up to UE implementation. The voice centric UE will keep the PDU Session used for IMS services to a system that supports voice over IMS. The voice centric UE can re-register with the IMS (if needed) when the IMS PDU session is transferred between 5GS and EPS.\nTo allow for appropriate domain selection for originating voice calls, the UE shall attempt Initial Registration in 5GC. If the UE fails to use IMS for voice, e.g. due to \"IMS voice over PS session supported indication\" indicates voice is not supported in 5G System, the UE behaves as described below for \"voice centric\" for 5GS or \"data centric\" for 5GS:\n-\tA UE set to \"voice centric\" for 5GS shall always try to ensure that Voice service is possible. A voice centric 5GC capable and EPC capable UE unable to obtain voice service in 5GS shall not select a cell connected only to 5GC. By disabling capabilities to access 5GS, the UE re-selects to E-UTRAN connected to EPC first (if available). When the UE selects E-UTRAN connected to EPC, the UE performs Voice Domain Selection procedures as defined in TS 23.221 [23].\n-\tA UE set to \"data centric\" for 5GS does not need to perform any reselection if voice services cannot be obtained.\nNOTE 2:\tThe related radio capabilities in order for the voice centric UE to not reselect to NR or E-UTRA cell connected to 5GC (i.e. avoid ping pong) will be defined by RAN WGs.\nWhen requested by IMS, the UDM/HSS shall be able to query the serving AMF for T-ADS related information. T-ADS is a functionality located in the IMS and is performed as specified in TS 23.221 [23].\nThe AMF shall respond to the query with the following information unless the UE is detached:\n-\twhether or not IMS voice over PS Session is supported in the registration area (s) where the UE is currently registered;\n-\twhether or not IMS voice over PS Session Supported Indication over non-3GPP access is supported in the WLAN where the UE is currently registered;\n-\tthe time of the last radio contact with the UE; and\n-\tthe current Access Type and RAT type.\nIf the UE is configured to support IMS voice, the UE shall include the information element \"UE's usage setting\" in Registration Request messages. The UE's usage setting indicates whether the UE behaves in a \"voice centric\" or \"data centric\" way (as defined in clause 5.16.3.5).\nA UE supporting IMS voice over 3GPP access connected to 5GC and that is EPS capable shall also support IMS voice over E-UTRA connected to EPC.\nNOTE:\tDepending on operator's configuration, the UE's usage setting can be used by the network to choose the RFSP Index in use (see clause 5.3.4.3). As an example, this enables the enforcement of selective idle mode camping over E-UTRA for voice centric UEs.\nTo allow for appropriate domain selection for SMS delivery, it should be possible to provision UEs with the following HPLMN operator preferences on how an IMS enabled UE is supposed to handle SMS services:\n-\tSMS is not to be invoked over IP networks: the UE does not attempt to deliver SMS over IP networks. The UE attempts to deliver SMS over NAS signalling.\n-\tSMS is preferred to be invoked over IP networks: the UE attempts to deliver SMS over IP networks. If delivery of SMS over IP networks is not available, the UE attempts to deliver SMS over NAS signalling.\nIt should be possible to provision UEs with the HPLMN SMS over NAS operator preferences on access selection for delivering SMS over NAS signalling.\nBased on the SMS over NAS preference:\n-\tSMS is preferred to be invoked over 3GPP access for NAS transport: the UE attempts to deliver MO SMS over NAS via 3GPP access if the UE is both registered in 3GPP access and non-3GPP access.\n-\tSMS is preferred to be invoked over non-3GPP access for NAS transport: the UE attempts to deliver MO SMS over NAS via non-3GPP access if the UE is both registered in 3GPP access and non-3GPP access. If delivery of SMS over NAS via non-3GPP access is not available, the UE attempts to deliver SMS over NAS via 3GPP access.\nFor the support of P-CSCF restoration the SMF behaves as described in TS 23.380 [61].\nIn order to support various deployment scenarios for obtaining IMS voice service, the UE and NG-RAN may support the mechanism to direct or redirect the UE from NG-RAN either towards E-UTRA connected to 5GC (RAT fallback) or towards EPS (E-UTRAN connected to EPC System fallback).\nFollowing principles apply for IMS Voice Service:\n-\tThe serving AMF indicates toward the UE during the Registration procedure that IMS voice over PS session is supported.\n-\tIf a request for establishing the QoS Flow for IMS voice reaches the NG-RAN, the NG-RAN responds indicating rejection of the establishment request and the NG-RAN may trigger one of the following procedures depending on UE capabilities, N26 availability, network configuration and radio conditions:\n-\tRedirection to EPS;\n-\tHandover procedure to EPS;\n-\tRedirection to E-UTRA connected to 5GC; or\n-\tHandover to E-UTRA connected to 5GC.\n-\tIf needed, Network Provided Location Information is provided as described in clauses 4.13.6.1 and 4.13.6.2 of TS 23.502 [3].\n-\tThe ongoing IMS voice session is not impacted by a change of the IMS voice over PS session indicator from supported to unsupported (e.g. the UE receives during RAT Fallback or EPS Fallback the IMS voice over PS session indicator indicating that IMS voice over PS sessions are not supported).\nNOTE:\tAny change in IMS voice over PS session indicator applies to new IMS sessions initiated only after the ongoing IMS voice session is terminated.\nDuring any release of RRC connection including after EPS/RAT fallback is performed, the eNB or NG-RAN node may provide to the UE dedicated idle mode priorities for NR as defined in TS 36.331 [51] taking into account RFSP, PLMNs contained in Handover Restriction List and local operator policy. If the UE remains ECM/CM-CONNECTED after the voice call has ended, the eNB or NG-RAN node may trigger handover to NR connected to 5GC, if configured to do so, taking into account local operator policy and Handover Restriction List.\nP-CSCF selection functionality may be used by the SMF to select the P-CSCF for an IMS PDU Session of the UE.\nThe SMF can utilize the Network Repository Function to discover the P-CSCF instance(s). The NRF provides the IP address or the FQDN of P-CSCF instance(s) to the SMF. The P-CSCF selection function in the SMF selects the P-CSCF instance(s) based on the available P-CSCF instances obtained from NRF or based on the configured P-CSCF information in the SMF. If the SMF receives FQDN(s) from the NRF or is configured with FQDN(s) the SMF shall resolve these to IP addresses for sending to the UE in the PDU session response.\nThe following factors may be considered during the P-CSCF discovery and selection:\n-\tS-NSSAI of the PDU Session.\n-\tUE location information.\n-\tLocal operator policies.\n-\tAvailability of candidate P-CSCFs.\n-\tUE IP address.\n-\tAccess Type.\n-\tProximity to location of selected UPF.\n-\tSelected Data Network Name (DNN).\nHSS discovery and selection functionality is used by the I-CSCF/S-CSCF/IMS-AS to select an HSS that manages the user's IMS subscriptions and has the ability to serve the IMS services for the UE, see clause AA.3.3 of TS 23.228 [15] and clause 6.3.1 for details.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.16.4\tEmergency Services",
                            "text_content": "Emergency Services are provided to support IMS emergency sessions. \"Emergency Services\" refers to functionalities provided by the serving network when the network is configured to support Emergency Services. Emergency Services are provided to normally registered UEs and to Emergency Registered UEs, that can be either normally registered or in limited service state. Depending on local regulation, receiving Emergency Services in limited service state does not require a valid subscription. Depending on local regulation and on operator's policy, the network may allow or reject a registration request for Emergency Services (i.e. Emergency Registration) from UEs that have been identified to be in limited service state. Four different behaviours of Emergency Services as defined in clause 4.3.12.1 of TS 23.401 [26] are supported.\nEmergency Services shall not be provided to a UE over 3GPP access and non-3GPP access concurrently. Transfer from one Access Type to the other takes place as follows:\n-\ta UE may be Emergency or normally Registered and have an emergency PDU session over non-3GPP access or may be attached with an emergency session to ePDG over untrusted WLAN (as defined in TS 23.402 [43]) when 3GPP access becomes available. In which case the UE may have to register over 3GPP access and check first the support for Emergency Services over the 3GPP RAT it has selected (e.g. based on Emergency Services Support indication, Emergency Services Fallback, AS broadcast indicator). If there is native support for Emergency Services in the selected 3GPP RAT the UE will attempt to transfer the emergency PDU session from non-3GPP access to 3GPP access (see clause 4.9.2 or clause 4.9.3 of TS 23.502 [3]). If there is no native support for Emergency Services in the selected RAT, but Emergency Services Fallback to another RAT in 5GS or to another System where Emergency Services is supported (based on the conditions defined in clause 5.16.4.11), the UE may trigger first Emergency Services Fallback (see clause 4.13.4.2 of TS 23.502 [3]) and then attempt to transfer the emergency PDU session from non-3GPP access to 3GPP access (see clause 4.9.2 of TS 23.502 [3]). During the session transfer the UE may be registered to receive emergency services over both 3GPP access and non-3GPP access concurrently.\nNOTE 1:\tThe conditions upon which the UE determines that 3GPP access becomes available are implementation dependent.\nA UE may only attempt to use Emergency Services over non-3GPP access if it is unable to use Emergency Services over 3GPP access as specified in TS 23.167 [18].\nThe UE is only allowed to have one PDU session for Emergency services at a time. A PDU Session cannot be changed between a PDU Session for Non-Emergency services and a PDU Session for Emergency services. PDU session for emergency services can be transferred from one Access Type to another as specified in clause 5.16.4.9.\nTo provide Emergency Services, the AMF is configured with Emergency Configuration Data that are applied to Emergency Services that are established by an AMF based on request from the UE. The AMF Emergency Configuration Data contains the S-NSSAI and Emergency DNN which is used to derive an SMF. In addition, the AMF Emergency Configuration Data contains UE-AMBR and may also contain the statically configured SMF for the Emergency DNN. The SMF may also store Emergency Configuration Data that contains statically configured UPF information for the Emergency DNN.\nNOTE 2:\tThe Network slices associated with emergency services are assumed to be configured consistently in the AMF (i.e. emergency configuration data) and NG-RAN nodes within the corresponding Registration Area where emergency services are to be supported.\nWhen the UE is camped normally in the cell, i.e. not in limited service state, during Registration procedure described in clause 4.2.2.2 of TS 23.502 [3], the serving AMF includes an indication for Emergency Services Support within the Registration Accept to the UE. For 3GPP access, the Emergency Services Support indication is valid within the current Registration Area per RAT (i.e. this is to cover cases when the same registration area supports multiple RATs and they have different capability).\nThe Emergency Services Support is configured in the AMF according to local regulations and network capabilities. AMF includes Emergency Services Support indicator in the Registration Accept message to indicate that the UE can setup emergency PDU Session to obtain emergency services. The AMF may include additional local emergency numbers associated with the serving network for the UE, further defined in TS 24.501 [47].\nDuring Registration procedures over 3GPP access in a PLMN, the 5GC includes the Emergency Services Support indicator, valid for the current Registration Area and indicating per RAT that Emergency Services are supported if any of the following conditions is true within the current Registration Area:\n-\tthe Network is able to support Emergency Services natively over 5GS;\n-\tE-UTRA connected to 5GC supports IMS Emergency Services (e.g. voice), and the NG-RAN is able to trigger handover or redirection from NR to E-UTRA connected to 5GC at QoS Flow establishment for IMS Emergency Services (e.g. voice);\n-\tNG-RAN is able to trigger handover to EPS at QoS Flow establishment for IMS Emergency Services (e.g. voice);\n-\tNG-RAN is able to trigger redirection to EPS at QoS Flow establishment for IMS Emergency Services (e.g. voice); or\n-\tNG-RAN is able to trigger 5G SRVCC handover to UTRAN for IMS Emergency Services (i.e. voice).\nDuring Registration procedures over non-3GPP access, the 5GC indicates that Emergency Services are supported if the Network is able to support Emergency Services natively over 5GS.\nIn the case of SNPN, during Registration procedures over 3GPP access, the 5GC includes the Emergency Services Support indicator, valid for the current Registration Area indicating that Emergency Services are supported if the following condition is true within the current Registration Area:\n-\tthe Network is able to support Emergency Services natively over 5GS.\nThe 5GC includes an indication per RAT whether it supports Emergency Services Fallback (as defined in clause 5.16.4.11) to another RAT in 5GS or to another System where Emergency Services are supported natively. The Emergency Services Fallback support indicator is valid within the current Registration Area per RAT.\nIf a certain RAT is restricted for Emergency Services, AMF signals that the corresponding RAT is restricted for Emergency Services Support to the Master RAN Node. This helps assist the Master RAN node determine whether to set up Dual Connectivity for Emergency Services.\nUEs that are in limited service state, as specified in TS 23.122 [17], or that camp normally on a cell but failed to register successfully to the network under conditions specified in TS 24.501 [47], initiate the Registration procedure by indicating that the registration is to receive Emergency Services, referred to as Emergency Registration, and a Follow-on request is included in the Registration Request to initiate PDU Session Establishment procedure with a Request Type indicating \"Emergency Request\". UEs that had registered for normal services and do not have emergency PDU Session established and that are subject to Mobility Restriction in the present area or RAT (e.g. because of restricted tracking area) shall initiate the UE Requested PDU Session Establishment procedure to receive Emergency Services, i.e. with a Request Type indicating \"Emergency Request\". Based on local regulation, the network supporting Emergency Services for UEs in limited service state provides Emergency Services to these UE, regardless whether the UE can be authenticated, has roaming or Mobility Restrictions or a valid subscription.\nFor Emergency Services over 3GPP access via PLMN, other than eCall over IMS, the UEs in limited service state that do not operate in SNPN access mode determine that the cell supports Emergency Services over NG-RAN from a broadcast indicator in AS. The cell connected to EPC and 5GC broadcasts separate broadcast indicator for EPC and 5GC to indicate support of emergency services by the EPC and 5GC. If the UE supports SNPN access mode, is in limited service state, is not operating in SNPN access mode, needs to make an emergency call and cannot find an acceptable cell in any PLMN, the UE may activate SNPN access mode and attempt to camp on an acceptable cell of any available SNPN supporting emergency calls (irrespective of SNPN ID or GIN) as defined in TS 23.122 [17]. For Emergency Services over untrusted non-3GPP access, other than eCall over IMS, the UE in limited service state selects any N3IWF as specified in clause 6.3.6. Emergency calls for eCall Over IMS may only be performed if the UE has a USIM.\nFor Emergency Services over NR via SNPN, other than eCall over IMS, the UEs in limited service state that operate in SNPN access mode determine that the cell supports Emergency Services over NR from a broadcast indicator in AS and indication that the SNPN supports Emergency Services. If the UE operates in SNPN access mode and is in limited service state, the UE shall attempt to camp on an acceptable cell of any available SNPN supporting emergency calls (irrespective of SNPN ID or GIN). If the UE cannot find acceptable cell on any available SNPN, the UE shall deactivate SNPN access mode and camp on any available PLMN cell supporting emergency calls (irrespective of PLMN ID) as defined in TS 23.122 [17].\nFor NR satellite access, if a UE in limited service state is aware of its location, the UE selects a PLMN that is allowed to operate in the UE location as specified in TS 23.122 [17]. The network may be configured to verify the location of a UE that is registering for emergency services as specified in clause 5.4.11.4.\nThere is no support for eCall over IMS for SNPNs in this Release.\nA serving network shall provide an Access Stratum broadcast indication from NG-RAN (NR or E-UTRA connected to 5GC) to UEs indicating whether eCall Over IMS is supported:\n-\tWhen an E-UTRA cell is connected to EPC and 5GC, the cell broadcasts separate Access stratum broadcast indication for 5GC and EPC to indicate support of eCall over IMS by 5GC and EPC.\n-\tA UE that is not in limited service state determines that the NG-RAN cell supports eCall Over IMS via 5GC using the broadcast indicator for eCall over IMS. Emergency calls for eCall over IMS are not supported over non-3GPP access.\nNOTE 3:\tThe Access Stratum broadcast indicator is determined according to operator policies and minimally indicates that the PLMN, or all of the PLMNs in the case of network sharing, and at least one emergency centre or PSAP to which an eCall Over IMS can be routed, support eCall Over IMS.\n-\tA UE in limited service state determines that the cell supports eCall Over IMS using both the broadcast indicator for support of Emergency Services over NG-RAN and the broadcast indicator of NG-RAN for eCall over IMS. Emergency calls for eCall Over IMS are not supported over Non-3GPP access and NR via SNPN.\nNOTE 4:\tThe broadcast indicator for eCall Over IMS does not indicate whether UEs in limited service state are supported. So, the broadcast indicator for support of Emergency Services over NG-RAN that indicates limited service state support needs to be applied in addition.\nFor a UE that is Emergency Registered, if it is unauthenticated the security context is not set up on UE.\nIn order to receive Emergency Services, UEs that camp on a suitable cell in RM-DEREGISTERED state (i.e. without any conditions that result in limited service state), or that decide to access 5GC via non-3GPP access (and not in limited service state over non-3GPP access), initiate the Initial Registration procedure for normal service instead of Emergency Registration. Upon successful registration, such UEs shall initiate the UE Requested PDU Session Establishment procedure with a Request Type indicating \"Emergency Request\" to receive Emergency Services if the AMF indicated support for Emergency Services in 5GC (for the RAT the UE is currently camped on when UE is camping on 3GPP access). The UEs that camp normally on a cell or that are connected via Non-3GPP access are informed that the PLMN supports Emergency Services over 5G-AN from the Emergency Services Support indicator in the Registration procedure. This applies to both 3GPP and non-3GPP Access Types. There is no support for Emergency Services for SNPN that is accessed via NWu from a PLMN.\nNOTE 5:\tThe Emergency Services Support indicator in the Registration procedures does not indicate support for eCall Over IMS.\nFor a UE that is Emergency Registered, normal PLMN or SNPN selection principles apply after the end of the IMS emergency session.\nNOTE 6:\tFor Emergency Services, there is no support for inter PLMN mobility thus there is a risk of service disruption due to failed inter PLMN mobility attempts when there is no session continuity (e.g. change of anchor SMF/UPF due to mobility) for the PDU Session and/or based on operator policies.\nNOTE 7\tBased on operator policies, Inter PLMN mobility with session continuity can be supported for Emergency Services if the anchor SMF/UPF for PDU Session supporting Emergency Services does not change.\nThe UE shall set the RRC establishment cause to emergency as defined in TS 38.331 [28] when it requests an RRC Connection in relation to an emergency session.\nIn the case of Limited Service state, UE shall not include any Network Slice related parameters when communicating with the network.\nWhen a PLMN or SNPN supports IMS and Emergency Services:\n-\tall AMFs in that PLMN or SNPN shall have the capability to support Emergency Services.\n-\tat least one SMF shall have this capability.\nFor other emergency scenarios (e.g. UE autonomous selection for initiating Emergency Services), refer to TS 23.167 [18] for domain selection principles.\nFor emergency service support in Public network integrated NPNs, refer to clause 5.30.3.5.\nFor emergency support via 5G ProSe UE-to-Network Relaying, refer to TS 23.304 [128].\nAccording to clause 4.2, the non-roaming architectures (Figure 4.2.3-1 and Figure 4.2.3-2) and roaming architecture with the visited operator's application function (Figure 4.2.4-1 and Figure 4.2.4-4) apply for Emergency Services. The other non-roaming and roaming architectures with services provided by the home network do not apply for Emergency Services.\nWhen Emergency Services are supported and local regulation requires IMS Emergency Sessions to be provided regardless of Mobility Restrictions or Access Restrictions, the Mobility Restrictions or Access Restrictions (see clause 5.3.4.1) should not be applied to UEs receiving Emergency Services. Additionally, due to Mobility Restrictions or Access Restrictions (e.g. CAG restrictions) for normally registered UEs, that have established both non-emergency PDU Sessions and emergency PDU Session, the AMF indicates to the SMF to perform a local release of all non-emergency PDU Sessions via PDU Session Release procedure as specified in clause 4.3.4 of TS 23.502 [3]. The UE locally releases non-emergency PDU Sessions. The AMF and the UE behave as if the UE is emergency registered as described in TS 24.501 [47].\nWhen the (R)AN resources for Emergency Services are established, the ARP value for Emergency Services indicates the usage for Emergency Services to the 5G-AN.\nDuring handover, the source NG-RAN and source AMF ignore any UE related restrictions during handover evaluation when there is an active PDU Session associated with emergency service.\nDuring Mobility Registration Update procedures, including a Mobility Registration Update as part of a handover, the target AMF ignores any Mobility Restrictions or access restrictions for UE with emergency services where required by local regulation. Any non-emergency services are not allowed, by the target network when not allowed by the subscription for the target location. To allow the UE in limited service state (either Emergency Registered or registered for normal service) over a given Access Type to get access to normal services over this Access Type after the Emergency Session has ended and when it has moved to a new area that is not stored by the UE as a forbidden area, after allowing a period of time for subsequent Emergency Services, the UE may explicitly deregister and register for normal services over this Access Type without waiting for the emergency PDU Session Release by the SMF.\nThis functionality applies to all mobility procedures.\nOver 3GPP access, an Emergency Registered UE when its Periodic Registration Update timer expires shall not initiate a Periodic Registration Update procedure but shall enter the RM-DEREGISTERED state. For such UEs, the AMF runs a mobile reachable timer with a similar value to the UE's Periodic Registration Update timer. After expiry of this timer the AMF may change the UE RM state for 3GPP Access in the AMF to RM-DEREGISTERED. The AMF assigns the Periodic Registration Update timer value to Emergency Registered UEs. This timer keeps the Emergency Registered UE registered for Emergency Services after change to CM-IDLE state to allow for a subsequent Emergency Service without a need for a new Emergency Registration.\nOver non-3GPP access, an Emergency Registered UE is only reachable in CM-CONNECTED state: since the UE may only use Emergency Services over Non-3GPP access when it is not possible over 3GPP access, 3GPP access is assumed to be unavailable for paging the UE.\nWhen a SMF is selected for Emergency Services, the SMF selection function described in clause 6.3.2 for normal services is applied to the Emergency DNN or the AMF selects the SMF directly from the AMF Emergency Configuration Data. If the SMF selection function described in clause 6.3.2 is used it shall always derive a SMF in the Serving PLMN or SNPN, which guarantees that the IP address is also allocated by the Serving PLMN or SNPN. When a UPF is selected for Emergency Services, the UPF selection function described in clause 6.3.3 for normal services is applied to the Emergency DNN or the SMF selects the UPF directly from the SMF Emergency Configuration Data. The information in the AMF Emergency Configuration Data and the SMF Emergency Configuration Data is specified in clause 5.16.4.1.\nLocal regulation may require supporting emergency calls from an unauthorised UE. In such a case, the SMF may not have subscription data. Additionally, the local network may want to provide Emergency Services support differently than what is allowed by a UE subscription. Therefore, the initial QoS parameters used for establishing Emergency Services are configured in the V-SMF (local network) in the SMF Emergency Configuration Data.\nThis functionality is used by the UE Requested PDU Session Establishment procedure when establishing Emergency Services.\nDynamic PCC is used for UEs establishing emergency service and shall be used to manage IMS emergency sessions when an operator allows IMS emergency sessions. When establishing Emergency Services with a SMF, the PCF provides the SMF with the QoS parameters, including an ARP value reserved for the Emergency Services to prioritize the QoS Flows when performing admission control, as defined in TS 23.503 [45].\nThe PCF rejects an IMS session established via the emergency PDU Session if the AF (i.e. P-CSCF) does not provide an emergency indication to the PCF.\nEmergency service is provided by the serving PLMN or SNPN. The UE and serving PLMN or SNPN must have compatible IP address versions in order for the UE to obtain a local emergency PDU Session.\nThe QoS Flows of a PDU Session associated with the emergency DNN shall be dedicated for IMS emergency sessions and shall not allow any other type of traffic. The emergency contexts shall not be changed to non-emergency contexts and vice versa. The UPF shall block any traffic that is not from or to addresses of network functions (e.g. P-CSCF) providing Emergency Services.\nIf there is already an emergency PDU Session over a given Access Type (3GPP access or non-3GPP access), the UE shall not request another emergency PDU Session over any Access Type except for handing over the existing emergency PDU Session to the other Access Type.\nIf the SMF receives a new emergency PDU session establishment request and an emergency PDU Session exists for the same UE over any Access Type, the SMF shall remove the existing SM context locally and clear the associated resources in the network and proceed with the new request.\n\nNOTE:\tIf the UE releases emergency PDU session locally and requests for establishment of a new one before the SMF has released the emergency PDU session due to PDU session inactivity as specified in clause 4.3.4.2 of TS 23.502 [3], the above duplicate emergency PDU session handling in the network removes the old emergency PDU session as part of establishing a new one. This releases all emergency call back resources related with the old emergency PDU Session.\nThe ARP reserved for emergency service shall only be assigned to QoS Flows associated with an emergency PDU Session. If the UE is Emergency Registered over a given access, it shall not request a PDU Session to any other DNN over this access.\nFor an Emergency Registered UE over a given Access Type:\n-\tthe UE shall not initiate the UE Requested PDU Session Establishment procedure for normal service over this Access Type; and\n-\tthe network shall reject any PDU Session Establishment request for normal service from the UE on this Access Type;\n-\tthe UE may attempt to receive normal service over another Access Type if not otherwise prevented by the present document.\nFor service requirements for eCall only mode, refer to TS 22.101 [33].\nA UE configured for eCall Only Mode shall remain in RM-DEREGISTERED state, shall camp on a network cell when available but shall refrain from any Registration Management, Connection Management or other signalling with the network. The UE may instigate Registration Management and Connection Management procedures in order to establish, maintain and release an eCall Over IMS session or a session to any non-emergency MSISDN(s) or URI(s) configured in the USIM for test and/or terminal reconfiguration services. Following the release of either session and after the UE has left RRC_CONNECTED state, the UE starts a timer whose value depends on the type of session (i.e. whether eCall or a session to a non-emergency MSISDN or URI for test/reconfiguration). While the timer is running, the UE shall perform normal RM/CM procedures and is permitted to respond to paging to accept and establish an incoming session (e.g. from an emergency centre, PSAP or HPLMN operator). When the timer expires, once the UE is not in RRC_CONNECTED state, the UE shall perform a UE-initiated Deregistration procedure if still registered and enter RM-DEREGISTERED state.\nNOTE 1:\tAn HPLMN operator can change the eCall Only Mode configuration state of a UE in the USIM. An HPLMN operator can also instead add, modify or remove a non-emergency MSISDN or URI in the USIM for test and/or terminal reconfiguration services. This can occur following a UE call to a non-emergency MSISDN or URI configured for reconfiguration. When the eCall Only Mode configuration is removed, the UE operates as a normal UE that can support eCall over IMS.\nNOTE 2:\tA test call and a reconfiguration call can be seen as normal (non-emergency) call by a serving PLMN and normal charging rules can apply depending on operator policy.\nNOTE 3:\tAn MSISDN configured in the USIM for test and/or terminal reconfiguration services for eCall Over IMS can differ from an MSISDN configured in the USIM for test services for eCall over the CS domain.\nIn order to support various deployment scenarios for obtaining Emergency Services, the UE and 5GC may support the mechanism to direct or redirect the UE either towards E-UTRA connected to 5GC (RAT fallback) when only NR does not support Emergency Services or towards EPS (E-UTRAN connected to EPC System fallback) when the 5GC does not support Emergency Services. Emergency Services fallback may be used when the 5GS does not indicate support for Emergency Services (see clause 5.16.4.1) and indicates support for Emergency Services fallback.\nFollowing principles apply for Emergency Services Fallback:\n-\tIf the AMF indicates support for Emergency Services fallback in the Registration Accept message, then in order to initiate Emergency Service, normally registered UE supporting Emergency Services fallback shall initiate a Service Request with Service Type set to Emergency Services fallback as defined in clause 4.13.4.1 of TS 23.502 [3].\n-\tAMF uses the Service Type Indication within the Service Request to redirect the UE towards the appropriate RAT/System. The 5GS may, for Emergency Services, trigger one of the following procedures:\n-\tHandover or redirection to EPS.\n-\tHandover or redirection to E-UTRA connected to 5GC.\n-\tAfter receiving the Service Request for Emergency Fallback, the AMF triggers N2 procedure resulting in either CONNECTED state mobility (Handover procedure) or IDLE state mobility (redirection) to either E-UTRA/5GC or to E-UTRAN/EPC depending on factors such as N26 availability, network configuration and radio conditions. In the N2 procedure, the AMF based on support for Emergency Services in 5GC or EPC may indicate the target CN for the RAN node to know whether inter-RAT fallback or inter-system fallback is to be performed. The target CN indicated in the N2 procedure is also conveyed to the UE in order to be able to perform the appropriate NAS procedures (S1 or N1 Mode).\n-\tWhen the AS re-keying procedure and the Emergency Fallback procedure collides, the AMF gives up the AS re-keying procedure and only initiates the Emergency Fallback procedure.\nNOTE 1:\tEmergency Services Fallback to EPS can be followed by an onward movement to GERAN or UTRAN via CSFB procedures if the PLMN does not support IMS emergency services.\nNOTE 2:\tIf the UE has signalled that S1 mode is disabled for a network that only supports IMS voice via EPS Fallback, the AMF will not indicate that Emergency Services Fallback is supported over 3GPP access.\nEmergency Services fallback is supported only in case of PLMN. Emergency Services Fallback is not supported for SNPN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.16.5\tMultimedia Priority Services",
                            "text_content": "TS 22.153 [24] specifies the service requirements for Multimedia Priority Service (MPS). MPS allows Service Users (as per TS 22.153 [24]) priority access to system resources in situations such as during congestion, creating the ability to deliver or complete sessions of a high priority nature. Service Users are government-authorized personnel, emergency management officials and/or other authorized users. MPS supports priority sessions on an \"end-to-end\" priority basis.\nMPS is based on the ability to invoke, modify, maintain and release sessions with priority, and deliver the priority media packets under network congestion conditions. MPS is supported in a roaming environment when roaming agreements are in place and where regulatory requirements apply.\nNOTE 1:\tIf a session terminates on a server in the Internet (e.g. web-based service), then the remote end and the Internet transport are out of scope for this specification.\nMPS is supported for Service Users using UEs connecting via 3GPP access. MPS is also supported for Service Users using UEs that support connecting via Trusted or Untrusted non-3GPP access via WLAN for MPS. N3IWF selection is according to clause 6.3.6 for PLMN access.\nA Service User may use an MPS-subscribed UE or any other UE to obtain MPS. An MPS-subscribed UE obtains priority access to the Radio Access Network by using the Unified Access Control mechanism according to TS 22.261 [2]. This mechanism provides preferential access to UEs based on its assigned Access Identity. If an MPS-subscribed UE belongs to the special Access Identity as defined in TS 22.261 [2], the UE has preferential access to the network compared to ordinary UEs in periods of congestion.\nMPS subscription allows users to receive priority services, if the network supports MPS. The same MPS subscription applies to access via 3GPP access and non-3GPP access via WLAN. MPS subscription entitles a USIM with special Access Identity. MPS subscription includes indication for support of priority PDU connectivity service including MPS for Data Transport Service and IMS priority service support for the end user. Priority Level regarding QoS Flows and IMS are also part of the MPS subscription information. The usage of Priority Level is defined in TS 22.153 [24], TS 23.503 [45] and TS 23.228 [15].\nNOTE 2:\tThe same MPS subscription in the UDM and/or on the USIM is used for priority treatment of 3GPP procedures when the access is WLAN.\nNOTE 3:\tThe term \"Priority PDU connectivity services\" is used to refer to 5G System functionality that corresponds to the functionality as provided by LTE/EPC Priority EPS bearer services in clause 4.3.18.3 of TS 23.401 [26].\nMPS includes signalling priority and media priority. All MPS-subscribed UEs get priority for QoS Flows (e.g. used for IMS signalling) when established to the DN that is configured to have priority for a given Service User by setting MPS-appropriate values in the QoS profile in the UDM.\nService Users are treated as On Demand MPS subscribers or not, based on regional/national regulatory requirements. On Demand service is based on Service User invocation/revocation explicitly and applied to the media QoS Flows being established. When not On Demand MPS service does not require invocation, and provides priority treatment for all QoS Flows only to the DN that is configured to have priority for a given Service User after attachment to the 5G network.\nMPS for Data Transport Service is an on-demand service that may be invoked/revoked by an authorized Service User using a UE with a subscription for MPS (i.e. according to its MPS profile), or using a UE that does not have a subscription for MPS (using methods not in scope of this specification).\nMPS for Data Transport Service requires explicit invocation. The Service User invokes the service by communicating with an AF. The authorization of an MPS for Data Transport Service request is done by the AF or the PCF according to clause 6.1.3.11 of TS 23.503 [45]. Upon successful authorization, the PCF performs the necessary actions to achieve appropriate ARP and 5QI settings for the QoS Flows (see clause 6.1.3.11 of TS 23.503 [45]).\nMPS for Data Transport Service enables the prioritization of all traffic on the QoS Flow associated with the default QoS rule and other QoS Flows upon AF request. The QoS modification to the QoS Flow associated with the default QoS rule and other QoS Flows is done based on operator policy and regulatory rules by means of local PCF configuration.\nNOTE 4:\tAccording to regional/national regulatory requirements and operator policy, On-Demand MPS (including MPS for Data Transport Service) Service Users can be assigned the highest priority.\nNOTE 5:\tIf no configuration is provided, MPS for Data Transport Service applies only to the QoS Flow associated with the default QoS rule.\nNOTE 6:\tMPS for DTS controls the priority of traffic on QoS Flows independent of the application(s) being used. Other mechanisms (e.g. Priority PDU connectivity service) can be used to control the priority of traffic on other QoS Flows under the control of specific data application(s), based on operator policy.\nNOTE 7:\tMPS for Data Transport Service can be applied to any DNN other than the well-known DNN for IMS.\nFor MPS for Data Transport Service, the AF may also create an SDF for priority signalling between the UE and the AF (see clause 6.1.3.11 of TS 23.503 [45]).\nPriority treatment is applicable to IMS based multimedia services and Priority PDU connectivity service including MPS for Data Transport Service.\nPriority treatment for MPS includes priority message handling, including priority treatment during authentication, security, and Mobility Management procedures.\nPriority treatment for MPS session requires appropriate ARP and 5QI (plus 5G QoS characteristics) setting for QoS Flows according to the operator's policy.\nNOTE 8:\tUse of QoS Flows for MPS with QoS characteristics signalled as part of QoS profile enables the flexible assignment of 5G QoS characteristics (e.g. Priority Level) for MPS.\nWhen an MPS session is requested by a Service User, the following principles apply in the network:\n-\tQoS Flows employed in an MPS session shall be assigned ARP value settings appropriate for the priority of the Service User.\n-\tSetting ARP pre-emption capability and vulnerability for MPS QoS Flows, subject to operator policies and depending on national/regional regulatory requirements.\n-\tPre-emption of non-Service Users over Service Users during network congestion situation, subject to operator policy and national/regional regulations.\nThe terminating network identifies the priority of the MPS session and applies priority treatment, including paging with priority, to ensure that the MPS session can be established with priority to the terminating user (either a Service User or normal user).\nMPS priority mechanisms can be classified as subscription-related, invocation-related, and those applied to existing QoS Flows. Subscription related mechanisms, as described in clause 5.22.2, are further divided into two groups: those which are always applied and those which are conditionally applied. Invocation-related mechanisms, as described in clause 5.22.3, are further divided into three groups: those that apply for mobile originated SIP call/sessions, those that apply for mobile terminated SIP call/sessions, and those that apply for the Priority PDU connectivity services including MPS for Data Transport Service. Methods applied to existing QoS Flows focus on handover and congestion control and are described in clause 5.22.4.\nNOTE 9:\tThe network can hide its topology from the AF supporting MPS for Data Transport Service. At the same time, the UE needs to provide its locally known IP address to the AF supporting MPS for Data Transport Service to support interactions with the applicable PCF. Thus, there can be no NAT of the UE IP address between the UPF and the AF supporting MPS for Data Transport Service.\nFor WLAN access, the UE may notify the TNAN/N3IWF of its MPS subscription before the NAS Registration Request. Based on operator policy, the TNAN/N3IWF may use this indication to provide this UE with priority treatment in the case of congestion/overload before receipt of the NAS Registration Request with an MPS priority establishment cause.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.16.6\tMission Critical Services",
                            "text_content": "According to TS 22.280 [37], a Mission Critical Service (MCX Service) is a communication service reflecting enabling capabilities Mission Critical Applications and provided to end users from Mission Critical Organizations and mission critical applications for other businesses and organizations (e.g. utilities, railways). An MCX Service is either Mission Critical Push To Talk (MCPTT) as defined in TS 23.379 [38], Mission Critical Video (MCVideo) as defined in TS 23.281 [39], or Mission Critical Data (MCData) as defined in TS 23.282 [40] and represents a shared underlying set of requirements between two or more MCX Service types. MCX Services are not restricted only to the ones defined in this clause and such services can also have priority treatment, if defined via operator's policy and/or local regulation.\nMCX Services are based on the ability to invoke, modify, maintain and release sessions with priority, and deliver the priority media packets under network congestion conditions. As specified in clause 6.8 of TS 22.261 [2], MCX Users require 5GS functionality that allows for real-time, dynamic, secure and limited interaction with the QoS and policy framework for modification of the QoS and policy framework by authorized users. The limited interaction is based on operator policy, and provides specific limitations on what aspects of the QoS and policy framework an authorized MCX User can modify. MCX Services are supported in a roaming environment when roaming agreements are in place and where regulatory requirements apply.\nAn MCX-subscribed UE obtains priority access to the Radio Access Network by using the Unified Access Control mechanism according to TS 22.261 [2]. This mechanism provides preferential access to UEs based on its assigned Access Identity. If an MCX-subscribed UE belongs to the special Access Identity as defined in TS 22.261 [2], the UE has preferential access to the network compared to ordinary UEs in periods of congestion. MCX subscription allows users to receive priority services, if the network supports MCX. MCX subscription entitles a USIM with special Access Identity.\nNOTE 1:\tFor Mission Critical Services that require low latency and zero packet loss even for the first downlink packet(s), periodic keep-alive packets during interruptions of media transmission (e.g. Floor Idle as specified in TS 23.379 [38], referenced by TS 23.289 [184]), which is sent over user plane of PDU session, can be used so that the UE is kept in RRC_CONNECTED state without being paged when unicast transmission is used. It is up to the implementation, the periodicity of the keep-alive packets configured in the AF can consider NG-RAN's configuration.\nNOTE 2:\tFor support of Mission Critical Services that require low latency and zero packet loss when using MBS, see TS 23.247 [121].\nMCX Services leverage the foundation of the 5G QoS Model as defined in clause 5.7, and 5G Policy Control as defined in clause 5.14. It requires that the necessary subscriptions are in place for both the 5G QoS Profile and the necessary Policies. In addition, MCX Services leverage priority mechanism as defined in clause 5.22.\nThe terminating network identifies the priority of the MCX Service session and applies priority treatment, including paging with priority, to ensure that the MCX Service session can be established with priority to the terminating user (either an MCX User or normal user).\nPriority treatment for MCX Service includes priority message handling, including priority treatment during authentication, security, and Mobility Management procedures.\nPriority treatment for MCX Service sessions require appropriate ARP and 5QI (plus 5G QoS characteristics) setting for QoS Flows according to the operator's policy.\nNOTE 3:\tUse of QoS Flows for MCX Service sessions with non-standardized 5QI values enables the flexible assignment of 5G QoS characteristics (e.g. Priority Level).\nWhen a MCX Service session is requested by an MCX User, the following principles apply in the network:\n-\tQoS Flows employed in a MCX Service session shall be assigned ARP value settings appropriate for the priority of the MCX User.\n-\tSetting ARP pre-emption capability and vulnerability of QoS Flows related to a MCX Service session, subject to operator policies and depending on national/regional regulatory requirements.\n-\tPre-emption of non-MCX Users over MCX Users during network congestion situations, subject to operator policy and national/regional regulations.\nPriority treatment is applicable to IMS based multimedia services and priority PDU connectivity services.\nRelative PDU priority decisions for MCX Service sessions are based on real-time data of the state of the network and/or based on modification of the QoS and policy framework by authorized users as described in clause 6.8 of TS 22.261 [2].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.17\tInterworking and Migration",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.17.1\tSupport for Migration from EPC to 5GC",
                            "text_content": "Clause 5.17.1 describes the UE and network behaviour for the migration from EPC to 5GC.\nDeployments based on different 3GPP architecture options (i.e. EPC based or 5GC based) and UEs with different capabilities (EPC NAS and 5GC NAS) may coexist at the same time within one PLMN.\nIt is assumed that a UE that is capable of supporting 5GC NAS procedures may also be capable of supporting EPC NAS (i.e. the NAS procedures defined in TS 24.301 [13]) to operate in legacy networks e.g. in the case of roaming.\nThe UE will use EPC NAS or 5GC NAS procedures depending on the core network by which it is served.\nIn order to support smooth migration, it is assumed that the EPC and the 5GC have access to a common subscriber database, that is HSS in the case of EPC and the UDM in the case of 5GC, acting as the master data base for a given user as defined in TS 23.002 [21]. The PCF has access to the UDR that acts as a common subscriber database for a given user identified by a SUPI using the Nudr services defined in TS 23.502 [3].\nThe figure depicts a detailed architecture for migration scenarios in the EPC (Evolved Packet Core) and 5G CN (Core Network) networks. It illustrates the various components and their interconnections, including the EPC, 5G CN, and the network's core switches, optical line terminals (OLTs), and distributed nodes. The layered design of the architecture aligns with SDN principles, ensuring failover reliability and redundancy.\nFigure 5.17.1.1-1: Architecture for migration scenario for EPC and 5G CN\nA UE that supports only EPC based Dual Connectivity with secondary RAT NR:\n-\talways performs initial access through E-UTRA (LTE-Uu) but never through NR;\n-\tperforms EPC NAS procedures over E-UTRA (i.e. Mobility Management, Session Management etc) as defined in TS 24.301 [13].\nA UE that supports camping on 5G Systems with 5GC NAS:\n-\tperforms initial access either through E-UTRAN that connects to 5GC or NR towards 5GC;\n-\tperforms initial access through E-UTRAN towards EPC, if supported and needed;\n-\tperforms EPC NAS or 5GC NAS procedures over E-UTRAN or NR respectively (i.e. Mobility Management, Session Management etc) depending on whether the UE requests 5GC access or EPC access, if the UE also supports EPC NAS.\nWhen camping on an E-UTRA cell connected to both EPC and 5GC, a UE supporting EPC NAS and 5GC NAS shall select a core network type (EPC or 5GC) and initiate the corresponding NAS procedure as specified in TS 23.122 [17].\nIn order to support different UEs with different capabilities in the same network, i.e. both UEs that are capable of only EPC NAS (possibly including EPC based Dual Connectivity with NR as secondary RAT) and UEs that support 5GC NAS procedures in the same network:\n-\teNB that supports access to 5GC shall broadcast that it can connect to 5GC. Based on that, the UE AS layer indicates \"E-UTRA connected to 5GC\" capability to the UE NAS layer. In addition the eNB broadcasts the supported CIoT 5GS Optimisations that the UE uses for selecting a core network type.\n-\tIt is also expected that the UE AS layer is made aware by the UE NAS layer whether a NAS signalling connection is to be initiated to the 5GC. Based on that, UE AS layer indicates to the RAN whether it is requesting 5GC access (i.e. \"5GC requested\" indication). The RAN uses this indication to determine whether a UE is requesting 5GC access or an EPC access. RAN routes NAS signalling to the applicable AMF or MME accordingly.\nNOTE:\tThe UE that supports EPC based Dual Connectivity with secondary RAT only does not provide this \"5GC requested\" indication at Access Stratum when it performs initial access and therefore eNB uses the \"default\" CN selection mechanism to direct this UE to an MME\nThe 5GC network may steer the UE from 5GC based on:\n-\tCore Network type restriction (e.g. due to lack of roaming agreements) described in clause 5.3.4.1.1;\n-\tAvailability of EPC connectivity;\n-\tUE indication of EPC Preferred Network Behaviour; and\n-\tSupported Network Behaviour.\nThe UE that wants to use one or more of these functionalities not supported by 5G System, when in CM-IDLE may disable all the related radio capabilities that allow the UE to access 5G System. The triggers to disable and re-enable the 5GS capabilities to access 5G System in this case are left up to UE implementation.\nIn order to support the interworking with EPC, the SMF+PGW-C provides information over N4 to the UPF+PGW-U related to the handling of traffic over S5-U. Functionality defined in TS 23.503 [45] for traffic steering control on SGi-LAN/N6 can be activated in UPF+PGW-U under consideration of whether the UE is connected to EPC or 5GC.\nWhen the UE is connected to EPC and establishes/releases PDN connections, the following differences apply to N4 compared to when the UE is connected to 5GC:\n-\tThe CN Tunnel Info is allocated for each EPS Bearer.\n-\tIn addition to the Service Data Flow related information, the SMF+PGW-C shall be able to provide the GBR and MBR values for each GBR bearer of the PDN connection to the UPF+PGW-U.\nIf the UE does not have preconfigured rules for associating an application to a PDN connection (i.e. the UE does not have rules in UE local configuration and is not provisioned with ANDSF rules), the UE should use a matching URSP rule as defined in TS 23.503 [45], if available, to derive the parameters, e.g. APN, for the PDN connection establishment and associating an application to the PDN connection.\nNOTE:\tThe mapping between the parameters in the URSP rules and the parameters used for PDN connection establishment is defined in TS 24.526 [110].\nDuring mobility from EPS to 5GS, the handling of QoS constraints in V-SMF is specified in clauses 4.11.1.2.2 and 4.11.1.3.3 of TS 23.502 [3] and follows the same principle as described in clause 5.7.1.11.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.2\tInterworking with EPC",
                            "text_content": "Interworking with EPC in this clause refers to mobility procedures between 5GC and EPC/E-UTRAN, except for clause 5.17.2.4. Network slicing aspects for EPS Interworking are specified in clause 5.15.7\nIn order to interwork with EPC, the UE that supports both 5GC and EPC NAS can operate in single-registration mode or dual-registration mode:\n-\tIn single-registration mode, UE has only one active MM state (either RM state in 5GC or EMM state in EPC) and it is either in 5GC NAS mode or in EPC NAS mode (when connected to 5GC or EPC, respectively). UE maintains a single coordinated registration for 5GC and EPC. Accordingly, the UE maps the EPS-GUTI to 5G GUTI during mobility between EPC and 5GC and vice versa following the mapping rules in Annex B. To enable re-use of a previously established 5G security context when returning to 5GC, the UE also keeps the native 5G-GUTI and the native 5G security context when moving from 5GC to EPC.\n-\tIn dual-registration mode, UE handles independent registrations for 5GC and EPC using separate RRC connections. In this mode, UE maintains 5G-GUTI and EPS-GUTI independently. In this mode, UE provides native 5G-GUTI, if previously allocated by 5GC, for registrations towards 5GC and it provides native EPS-GUTI, if previously allocated by EPC, for Attach/TAU towards EPC. In this mode, the UE may be registered to 5GC only, EPC only, or to both 5GC and EPC.\nDual-registration mode is intended for interworking between EPS/E-UTRAN and 5GS/NR. A dual-registered UE should not send its E-UTRA connected to 5GC and E-UTRAN radio capabilities to NR access when connected to 5GS/NR to avoid being handed over to 5GC-connected E-UTRA or to E-UTRAN.\nNOTE 1:\tThis is to prevent the dual registered UE from being connected to the same E-UTRA cell either connected to EPC or 5GC simultaneously using separate RRC connections via single RAN node as a result of handover. If a dual- registered UE implementation chooses to send its E-UTRA capability when connected to 5GS/NR, the UE and the network behaviour when UE enters a 5GC-connected E-UTRA is not further specified. If however the UE is registered with 5GS/NR only, the UE can send its E-UTRA capability in order to allow inter-RAT handover to E-UTRA/5GC and Dual Connectivity with multiple RATs.\nIf a dual-registered UE had not sent its E-UTRA connected to 5GC and E-UTRAN radio capabilities to 5GS and the UE needs to initiate emergency services, it shall locally re-enable its E-UTRA connected to 5GC and E-UTRAN radio capabilities in order to perform domain selection for emergency services as defined in TS 23.167 [18].\nNOTE 2:\tHowever even in this case, the UE is still not expected to connect to E-UTRAN/EPC and E-UTRA/5GC simultaneously using separate RRC connection via single RAN node as a result of the domain selection for emergency services.\nThe support of single registration mode is mandatory for UEs that support both 5GC and EPC NAS.\nDuring E-UTRAN Initial Attach, UE supporting both 5GC and EPC NAS shall indicate its support of 5G NAS in UE Network Capability described in clause 4.11.1.5.2 of TS 23.502 [3].\nDuring registration to 5GC, UE supporting both 5GC and EPC NAS shall indicate its support of EPC NAS.\nNOTE 3:\tThis indication may be used to give the priority towards selection of SMF+PGW-C for UEs that support both EPC and 5GC NAS.\nIf the UE supports 5GC NAS, at PDN connection establishment in EPC, the UE may allocate a PDU Session ID and sends it via PCO, regardless of N1 mode status (i.e. enabled or disabled) in the UE.\nNOTE 4:\tUE providing a PDU Session ID at PDN connection establishment even when N1 mode is disabled allows for IP address preservation during EPC to 5GC mobility once the UE re-enables N1 mode.\nNOTE 5:\tFor the case the MME has selected a standalone PGW for a PDN connection, if the UE re-enables N1 mode and reports the change in UE Network Capability, the MME can initiate PDN disconnection with reactivation required as described in clause 4.11.0a.8 of TS 23.502 [3] to allow selection of SMF+PGW-C thus session continuity at EPC to 5GC mobility.\nIf the EPC supports \"Ethernet\" PDU Session Type, and the 5GSM Capabilities indicate that the UE supports Ethernet PDN type in EPC, then PDU Session type \"Ethernet\" is transferred to EPC as \"Ethernet\". Otherwise, PDU Session types \"Ethernet\" and \"Unstructured\" are transferred to EPC as \"non-IP\" PDN type (when supported by UE and network). If the UE or EPC does not support Ethernet PDN type in EPC, the UE sets the PDN type to non-IP when it moves from 5GS to EPS and after the transfer to EPS, and the UE and the SMF shall maintain information about the PDU Session type used in 5GS, i.e. information indicating that the PDN Connection with \"non-IP\" PDN type corresponds to PDU Session type Ethernet or Unstructured respectively. This is done to ensure that the appropriate PDU Session type will be used if the UE transfers to 5GS.\nPDN type \"non-IP\" is transferred to 5GS as \"Unstructured\" PDU Session type if it is successfully transferred.\nIt is assumed that if a UE supports Ethernet PDU Session type and/or Unstructured PDU Session type in 5GS it will also support non-IP PDN type in EPS. If this is not the case, the UE shall locally delete any EBI(s) corresponding to the Ethernet/Unstructured PDU Session(s) to avoid that the Ethernet/Unstructured PDU Session(s) are transferred to EPS.\nMTU size consideration for PDU Sessions and PDN Connections towards a SMF+PGW-C follows the requirements in clause 5.6.10.4.\nNetworks that support interworking with EPC, may support interworking procedures that use the N26 interface or interworking procedures that do not use the N26 interface. Interworking procedures with N26 support provides IP address continuity on inter-system mobility to UEs that support 5GC NAS and EPC NAS and that operate in single registration mode. Networks that support interworking procedures without N26 shall support procedures to provide IP address continuity on inter-system mobility to UEs operating in both single-registration mode and dual-registration mode. In such networks, AMF shall provide the indication that interworking without N26 is supported to UEs during initial Registration in 5GC or MME may optionally provide the indication that interworking without N26 is supported in the Attach procedure in EPC as defined in TS 23.401 [26].\nIf the network does not support interworking with EPC, network shall not indicate support for \"interworking without N26\" to the UE.\nWhen the HSS+UDM is required to provide the subscription data to the MME, for each APN, only one SMF+PGW-C FQDN and associated APN is provided to the MME according to TS 23.401 [26].\nFor interworking without N26 interface:\n-\tif the PDU session supports interworking, the SMF+PGW-C stores the SMF+PGW-C FQDN to SMF context in HSS+UDM when the SMF is registered to HSS+UDM.\n-\tFor an APN, the HSS+UDM selects one of the stored SMF+PGW-C FQDN based on operator's policy.\nFor interworking with N26 interface:\n-\tFor a DNN, AMF determines PDU session(s) associated with 3GPP access in only one SMF+PGW-C supporting EPS interworking via EBI allocation procedure as described in clause 4.11.1.4.1 of TS 23.502 [3].\n-\tIf the network supports EPS interworking of non-3GPP access connected to 5GC, the AMF serving 3GPP access notifies the UDM to store the association between DNN and SMF+PGW-C FQDN which supports EPS interworking as Intersystem continuity context, to avoid MME receiving inconsistent SMF+PGW-C FQDN from AMF and HSS+UDM.\n-\tThe AMF updates Intersystem continuity context if the SMF+PGW-C and DNN association is changed due to the AMF selecting another SMF+PGW-C for EPS interworking for the same DNN.\n-\tIf the SMF+PGW-C FQDN and associated DNN exists in Intersystem continuity context, the HSS+UDM provides MME with SMF+PGW-C FQDN and associated APN.\nIt does not assume that the HSS+UDM is aware of whether N26 is deployed in the serving network. The HSS+UDM check the Intersystem continuity context first. If no SMF+PGW-C FQDN associated with an DNN exists in Intersystem continuity context, the HSS+UDM selects one of the SMF+PGW-C FQDN for the APN from SMF context based on operator's policy.\nIn entire clause 5.17.2 the terms \"initial attach\", \"handover attach\" and \"TAU\" for the UE procedures in EPC can alternatively be combined EPS/IMSI Attach and combined TA/LA depending on the UE configuration defined in TS 23.221 [23].\nIf a UE in MICO mode moves to E-UTRAN connected to EPC and any of the triggers defined in clause 5.4.1.3 occur, then the UE shall locally disable MICO mode and perform the TAU or Attach procedure as defined in clause 5.17.2. The UE can renegotiate MICO when it returns to 5GS during (re-)registration procedure.\nIP address preservation for IP PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to GERAN/UTRAN to a UE that had initially registered in 5GS and moved to EPC/E-UTRAN.\nNOTE 6:\tThe SMF+PGW-C might not include the GERAN/UTRAN PDP Context anchor functionality. Also, 5GC does not provide GERAN/UTRAN PDP Context parameters to the UE when QoS Flows of PDU Session are setup or modified in 5GS. Hence, the UE might not be able to activate the PDP contexts when it transitions to GERAN/UTRAN.\nIP address preservation for IP PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to 5GS for a 5GS NAS capable UE that had initially established a PDP context via GERAN/UTRAN and moved to EPC/E-UTRAN. IP address preservation for IP PDU session mobility between EPC/E-UTRAN and 5GS may be re-ensured as specified in clause 5.17.2.4 when UE moves from GERAN/UTRAN into EPC/E-UTRAN.\nNOTE 7:\tThe PGW acting as a GGSN might not support SMF+PGW-C functionality. GPRS does not support 5GS parameters transfer between UE and SMF+PGW-C (e.g. providing of PDU session ID and 5GS QoS information).\nWhen a PDU session is moved from 5GS to EPS, the SMF+PGW-C keeps the registration and subscription in HSS+UDM until the corresponding PDN connection is released.\nThe SMF+PGW-C receives notification of subscription update regarding the 5G parameters (e.g. DNNs, S-NSSAIs) which are associated with the established PDN connection(s) connecting via EPS. If the subscription regarding DNN, QoS profile or PDN connection type associated with the PDN connection is updated, then the MME receives the subscription update and triggers corresponding actions according to TS 23.401 [26]. If the SMF+PGW-C receives subscription updates (e.g. change of 5GS Subscribed NSSAI) from the UDM the SMF+PGW-C triggers corresponding actions for the PDN connection. This may include (depending on the modified parameter) to:\n-\tupdate the UPF (e.g. for a change of Framed Route information); or\n-\trelease the PDN connection with an appropriate cause (e.g. for change of EPS/5GS interworking support, for subscription removal of S-NSSAI associated with the PDN connection);\n-\tdo nothing about changes to DNN and/or PDU Session type that are handled by the MME.\nIf header compression is used for Control Plane CIoT EPS/5GS Optimisations and when the UE moves from EPS to 5GS or from 5GS to EPS, the UE may initiate the PDU Session Modification Procedure or UE requested bearer resource modification procedure to renegotiate the header compression configuration and to establish the compression context between the UE and MME/SMF, see TS 23.401 [26] and TS 24.501 [47].\nIf the UE is moving from 5GS to EPS and the RAT type is also moving from a \"broadband\" RAT (e.g. NR or WB-E-UTRA) to NB-IoT in EMM-IDLE state, the UE should set the mapped EPS bearer context for which the EPS bearer is a dedicated EPS bearer to state BEARER CONTEXT INACTIVE as for NB-IoT UEs in EPS only support the default bearers. In addition, UE shall locally deactivate the related bearers according to the maximum number of supported UP resources and send the latest bearer context status in the TAU Request.\nIf APN Rate Control is used when the UE moves from EPC to 5GC then the P-GW/SCEF and UE store the current APN Rate Control Status for an APN. If while connected to 5GC the last PDU Session to a DNN that is the same as the APN identified in the APN Rate Control Status is released then the APN Rate Control Status may be stored in the AMF in addition to the Small Data Rate Control Status and the UE discards the APN Rate Control Status. The APN Rate Control Status is stored in the AMF so it can be provided to the MME during mobility to EPC and subsequently applied at establishment of a new first PDN Connection to the same APN, if valid. The APN Rate Control Status is provided to the UPF+PGW-U if a first new PDU Session is established towards the DNN that is the same as the APN identified in the APN Rate Control Status if the UE moves back to EPC, taking into account its validity period.\nThe UE may be provided with initial APN Rate Control parameters by the SMF when a first new PDU Session is established for a DNN and S-NSSAI that supports interworking with EPS and the DNN matches an APN. The SMF provides the APN Rate Control Status for the APN that matches the DNN, if available at the SMF, otherwise the configured APN Rate Control parameters for the APN that matches the DNN are provided as the initially applied parameters. If the initially applied parameters differ from the configured APN Rate Control parameters and the first APN Rate Control validity period expires, the UE is updated with the configured APN Rate Control parameters once the UE has moved to EPC.\nNOTE 8:\tIf the APN Rate Control Status is provided to a UPF+PGW-U it is not used for Small Data Rate Control while the UE is connected to 5GC, it is only used as the APN Rate Control Status if the UE moves to EPC.\nNOTE 9:\tEncoding of APN and DNN specified in TS 23.003 [19] allows the comparison of EPS APN and 5GS DNN.\nIf a Service Gap timer is running in the AMF when the UE moves from 5GC to EPC, the AMF stops the running Service Gap timer. If the UE returns to 5GC from EPC the AMF provides the Service Gap Time to the UE as described in clause 5.31.16.\nIf a Service Gap timer is running in the MME when the UE moves from EPC to 5GC, the MME stops the running Service Gap timer. If the UE returns to E-UTRAN connected to EPC from 5GC the MME provides the Service Gap Time to the UE as described in TS 23.401 [26].\nIf a Service Gap timer is running in the UE when the UE moves to from 5GC to EPC and if Service Gap Time is received from the MME, the UE stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE and applied for EPC. If a Service Gap timer is running in the UE when the UE moves to 5GC and if Service Gap Time is received from the AMF, the UE stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE and applied in 5GS.\nFor UE currently served by EPC, a SMF+PGW-C may support L2TP tunnelling on N6, as described in clause 5.8.2.16.\nNOTE 1:\tAdditional network slicing and Interworking with EPS with N26 aspects are specified in clause 5.15.7.\nInterworking procedures using the N26 interface, enables the exchange of MM and SM states between the source and target network. The N26 interface may be either intra-PLMN or inter-PLMN (e.g. to enable inter-PLMN mobility). When interworking procedures with N26 is used, the UE operates in single-registration mode. For the 3GPP access, the network keeps only one valid MM state for the UE, either in the AMF or MME. For the 3GPP access, either the AMF or the MME is registered in the HSS+UDM.\nThe support for N26 interface between AMF in 5GC and MME in EPC is required to enable seamless session continuity (e.g. for voice services) for inter-system change.\nThe UE's subscription may include restriction for Core Network Type (EPC) and RAT restriction for E-UTRA. If so, the UDM provides these restrictions to the AMF. The AMF includes RAT and Core Network type restrictions in the Handover Restriction List to the NR. The AMF and NR use these restrictions to determine if mobility of the UE to EPS or E-UTRA connected to EPS should be permitted. When the UE moves from 5GS to EPS, the SMF determines which PDU Sessions can be relocated to the target EPS, e.g. based on capability of the deployed EPS, operator policies for which PDU Session, seamless session continuity should be supported etc. The SMF can release the PDU Sessions that cannot be transferred as part of the handover or Idle mode mobility. However, whether the PDU Session is successfully moved to the target network is determined by target EPS.\nSimilarly, the UE's subscription may include restriction for Core Network Type (5GC) and RAT restriction for NR. If so, the HSS provides these restrictions to the MME. The MME includes RAT and Core Network type restrictions in the Handover Restriction List to the E-UTRAN. The MME and E-UTRAN use these restrictions to determine if mobility of the UE to 5GS or NR connected to 5GS should be permitted. If the SMF+PGW-C receives the PDU session ID from UE via PCO and know 5GC is not restricted for the PDN connection by user subscription, the SMF+PGW-C sends the mapped QoS parameters to UE. When the UE moves from EPS to 5GS, for the case when the MME has selected SMF+PGW-C even for PDN connections that cannot be relocated to the target 5GS, the SMF+PGW-C determines which PDN Connections can be relocated to the target 5GS, e.g. based on capability of the deployed 5GS, subscription and operator policies for which PDN Connection, seamless session continuity should be supported etc. The SMF+PGW-C and NG-RAN can reject the PDN Connections that cannot be transferred as part of the handover or Idle mode mobility.\nFor the case when the MME has selected standalone P-GW for a PDN connection for which session continuity is not supported and the AMF cannot retrieve the address of the corresponding SMF during EPS to 5GS mobility, the AMF does not move the PDN connection to 5GS.\nNOTE 2:\tWhen applying the AMF planned removal procedure or the procedure to handle AMF failures (see clause 5.21.2) implementations are expected to update the DNS configuration to enable MMEs to discover alternative AMFs if the MME tries to retrieve a UE context from an AMF that has been taken out of service or has failed. This addresses the scenario of UEs performing 5GS to EPS Idle mode mobility and presenting a mapped GUTI pointing to an AMF that has been taken out of service or has failed.\nIn the case of mobility from 5GS to EPS, if the MME lacks certain capability, e.g. MME not supporting 15 EPS bearers, the 5GC shall not transfer the UE EPS bearers and/or EPS PDN connections that are not supported by the EPC network. If the MME does not support 15 EPS bearers, the AMF determines which EBIs cannot be transferred to EPS, and retrieves the EPS bearer contexts from the SMF+PGW-C for the EBIs that can be transferred to EPS.\nNOTE 3:\tHow the AMF determines which EBIs can be transferred to EPS is according to local configuration, e.g. according to DNN, S-NSSAI, ARP associated with an EBI.\nIn the case of mobility from 5GS to EPS, if the mobility is a result of the PCF modifying the RFSP Index value for the UE to indicate that EPC/E-UTRAN access is prioritized over the 5GS access, the AMF may be sent with a RFSP in Use Validity Time by the PCF as specified in TS 23.503 [45]. If the AMF receives RFSP in Use Validity Time and selects the RFSP Index in use identical to the authorized RFSP Index as specified in clause 5.3.4.3, then the AMF provides the MME with the RFSP Index in use and the RFSP in Use Validity Time, which indicates the time by which the RFSP Index in use will be used in the MME as specified in clause 4.11.1.5.8 of TS 23.502 [3].\nNOTE 4:\tThe RFSP in Use Validity Time is to allow the UE to stay in EPS for a period of time to avoid the potential ping-pong issue (i.e. 5GS keeps sending the UE to EPS based on authorized RFSP Index from PCF, and the EPS keeps sending the UE back to 5GS immediately based on the subscribed RFSP Index.\nNOTE 5:\tThe RFSP in Use Validity Time applies only to EPS but not to 5GS, therefore in the case of mobility from EPS to 5GS, the RFSP in Use Validity Time if received from MME is ignored by the AMF.\nWhen the UE supports single-registration mode and network supports interworking procedure with the N26 interface:\n-\tFor idle mode mobility from 5GS to EPS, the UE performs either TAU or Attach procedure with EPS GUTI mapped from 5G-GUTI sent as old Native GUTI, as described in clause 4.11.1.3.2.1 of TS 23.502 [3] and indicates that it is moving from 5GC. The UE includes in the RRC message a GUMMEI mapped from the 5G-GUTI and indicates it as a native GUMMEI and should in addition indicate it as \"Mapped from 5G-GUTI\". The MME retrieves the UE's MM and SM context from 5GC. For connected mode mobility from 5GS to EPS, either inter-system handover or RRC Connection Release with Redirection to E-UTRAN is performed. At inter-system handover, the AMF selects target MME based on 2 octet TAC format used in the Target ID as specified in TS 38.413 [34]. During the TAU or Attach procedure the HSS+UDM cancels any AMF registration associated with the 3GPP access (but not AMF registration associated with the non-3GPP access): an AMF that was serving the UE over both 3GPP and non-3GPP accesses does not consider the UE as deregistered over non 3GPP access.\n-\tFor the first TAU after 5GC initial Registration, the UE and MME for the handling of UE Radio Capabilities follow the procedures as defined in clause 5.11.2 of TS 23.401 [26] for first TAU after GERAN/UTRAN Attach.\nNOTE 1:\tMMEs supporting interworking with N26 interface are not required to process the indication from the UE that it is moving from 5GC and will assume that the UE is moving from another MME.\n-\tFor idle mode mobility from EPC to 5GC, the UE performs mobility Registration procedure with the 5G GUTI mapped from EPS GUTI and indicates that it is moving from EPC. The UE derives GUAMI from the native 5G-GUTI and includes GUAMI in the RRC message to enable RAN to route to the corresponding AMF (if available). If the UE holds no native 5G-GUTI, then the UE provides in the RRC message a GUAMI mapped from the EPS GUTI and indicates it as \"Mapped from EPS\". The AMF and SMF retrieve the UE's MM and SM context from EPC. For connected mode mobility from EPC to 5GC, either inter-system handover or RRC Connection Release with Redirection to NG-RAN is performed. At inter-system handover, the MME selects target AMF based on TAC used in the Target ID as specified in TS 38.413 [34]. During the Registration procedure, the HSS+UDM cancels any MME registration.\nNOTE 2:\tDuring a transition period, the source eNB may be configured via O&M to know that the MME is not upgraded and thus supports only 2 octet TAC. The Target ID for the NG-RAN node is set as \"Target eNB ID\" in the existing IEs as defined in TS 38.413 [34].\nFor both idle mode and connected mode mobility from EPC to 5GC:\n-\tThe UE includes the native 5G-GUTI as an additional GUTI in the Registration request; the AMF uses the native 5G-GUTI to retrieve MM context identified by the 5G-GUTI from old AMF or from UDSF (if UDSF is deployed and the old AMF is within the same AMF set).\n-\tIf this is the first mobility event for a PDU Session that was established while being connected to EPC, the UE shall trigger the PDU Session Modification procedure and:\n-\tshould indicate the support of Reflective QoS to the network (i.e. SMF) if the UE supports Reflective QoS functionality. If the UE indicated support of Reflective QoS, the network may provide a Reflective QoS Timer (RQ Timer) value to the UE;\n-\tshall indicate the number of supported packet filters for signalled QoS rules, if the UE supports more than 16 packet filters for the PDU Session. The network shall store this information so that subsequent mobility events do not require another signalling of it.\n-\tshould indicate the support of Multi-homed IPv6 PDU session to the network (i.e. SMF) if the UE supports Multi-homed IPv6 PDU session. If the UE indicated support of Multi-homed IPv6 PDU session, the network shall consider that this PDU session is supported to use multiple IPv6 prefixes.\n-\tshould provide the UE Integrity Protection Maximum Data Rate to the network (i.e. SMF). The network shall consider that the maximum data rate per UE for user-plane integrity protection supported by the UE is valid for the lifetime of the PDU session.\nFor interworking without the N26 interface, IP address preservation is provided to the UEs on inter-system mobility by storing and fetching SMF+PGW-C and corresponding APN/DNN information via the HSS+UDM. In such networks AMF also provides an indication that interworking without N26 is supported to UEs during Initial Registration in 5GC or MME may optionally provide an indication that interworking without N26 is supported in the Attach procedure in EPC as defined in TS 23.502 [3] and TS 23.401 [26]. The UE provides an indication that it supports Request Type flag \"handover\" for PDN connectivity request during the attach procedure as described in clause 5.3.2.1 of TS 23.401 [26] and during initial Registration and Mobility Registration Update in 5GC.\nNOTE 1:\tThe UE support of Request Type flag \"handover\" for PDN connectivity request during the attach procedure is needed for IP address preservation in the case of interworking without N26.\nThe indication that interworking without N26 is valid for the entire Registered PLMN and for PLMNs equivalent to the Registered PLMN that are available in the Registration Area. The same indication is provided to all UEs served by the same PLMN. UEs that operate in interworking without N26 may use this indication to decide whether to register early in the target system. UEs that only support single registration mode may use this indication as described in clause 5.17.2.3.2. UE that support dual registration mode uses this indication as described in clause 5.17.2.3.3.\nInterworking procedures without N26 interface use the following two features:\n1.\tWhen UE performs Initial Attach in EPC (with or without \"Handover\" indication in PDN CONNECTIVITY Request message) and indicates that it is moving from 5GC, the MME indicates to the HSS+UDM not to cancel the registration of AMF, if any.\n2.\tWhen UE performs Initial Registration in 5GC and indicates that it is moving from EPC, the AMF indicates to the HSS+UDM not to cancel the registration of MME, if any.\nTo support mobility both for single and dual registration mode UEs, the following also are supported by the network:\n3.\tWhen PDU Session are created in 5GC, the SMF+PGW-C which supports EPS interworking stores the SMF+PGW-C FQDN along with DNN in the HSS+UDM.\n4.\tThe HSS+UDM provides the information about dynamically allocated SMF+PGW-C and APN/DNN information to the target CN network. If there are multiple SMF+PGW-C serving the UE for the same DNN which support EPS interworking in 5GS, the HSS+UDM select one of them according to operator's policy and provides together with the associated APN to the MME.\n5.\tWhen PDN connections are created in EPC, the MME stores the SMF+PGW-C and APN information in the HSS+UDM.\nNOTE 2:\tItems 3, 4 and 5 are also supported in networks that support interworking with N26 procedures. This enables a VPLMN that does not deploy N26 interface to provide IP address preservation to roamed-in single-registration mode UEs from a HPLMN that only supports interworking with N26 procedures.\nWhen the network serving the UE supports 5GS-EPS interworking procedures without N26 interface, the SMF shall not provide the UEs with mapped target system parameters of the target system when UE is in the source network.\nA UE that operates in dual registration mode ignores any received mapped target system parameters (e.g. QoS parameters, bearer IDs/QFI, PDU Session ID, etc.).\nWhen the UE supports single-registration mode and network supports interworking procedure without N26 interface:\n-\tFor mobility from 5GC to EPC, the UE with at least one PDU Session established in 5GC may either:\n-\tif supported and if it has received the network indication that interworking without N26 is supported, perform Attach in EPC with a native EPS GUTI, if available, otherwise with IMSI with Request type \"Handover\" in PDN CONNECTIVITY Request message (clause 5.3.2.1 of TS 23.401 [26]) and indicating that the UE is moving from 5GC and subsequently moves all its other PDU Session using the UE requested PDN connectivity establishment procedure with Request Type \"handover\" flag (clause 5.10.2 of TS 23.401 [26]), or.\n-\tperform TAU with 4G-GUTI mapped from 5G-GUTI sent as old Native GUTI (clause 5.3.3 of TS 23.401 [26]) indicating that it is moving from 5GC, in which case the MME instructs the UE to re-attach. IP address preservation is not provided in this case.\n-\tfor the first TAU after 5GC initial Registration, the UE and MME for the handling of UE Radio Capabilities follow the procedures as defined in clause 5.11.2 TS 23.401 [26] for first TAU after GERAN/UTRAN Attach.\nNOTE 1:\tThe first PDN connection may be established during the E-UTRAN Initial Attach procedure (see TS 23.401 [26]).\nNOTE 2:\tAt inter-PLMN mobility to a PLMN that is not an equivalent PLMN the UE always uses the TAU procedure.\n-\tFor mobility from 5GC to EPC, the UE with no PDU Session established in 5GC\n-\tperforms Attach in EPC (clause 5.3.2.1 of TS 23.401 [26]) indicating that the UE is moving from 5GC.\n-\tFor mobility from EPC to 5GC, the UE performs Mobility Registration Update in 5GC with 5G-GUTI mapped from EPS GUTI and a native 5G-GUTI, if available, as Additional GUTI and indicating that the UE is moving from EPC. In this case, the AMF determines that old node is an MME, but proceeds as if the Registration is of type \"initial registration\". The UE may either:\n-\tif supported and if it has received the network indication \"interworking without N26 supported\", move all its PDN connections from EPC using the UE initiated PDU Session Establishment procedure with \"Existing PDU Sessions\" flag (clause 4.3.2.2.1 of TS 23.502 [3]), or\n-\tre-establish PDU Sessions corresponding to the PDN connections that it had in EPS. IP address preservation is not provided in this case.\nNOTE 3:\tThe additional native 5G-GUTI enables the AMF to find the UE's 5G security context (if available).\nNOTE 4:\tWhen single-registration mode UE uses interworking procedures without N26, the registration states during the transition period (e.g. while UE is transferring all PDU Sessions / PDN Connections on the target side) are defined in Stage 3 specifications.\n-\tIf the network determines that the UE is changing RAT type, if the UE requests to relocate the PDU session from EPC to 5GC or 5GC to EPC, the SMF/MME uses the \"PDU session continuity at inter RAT mobility\" or \"PDN continuity at inter-RAT mobility\" information, respectively, in the subscription to determine whether to maintain the PDU session/PDN connection (if being handed over) or reject the PDU session request, with the relevant cause.\n-\tIf the UE requested to move the PDU session and the \"PDN continuity at inter RAT mobility\" information indicated \"disconnect the PDN connection with a reactivation request\" the network should provide a suitable cause code to the UE so that it can request a new PDU session.\nTo support mobility in dual-registration mode, the support of N26 interface between AMF in 5GC and MME in EPC is not required. A UE that supports dual registration mode may operate in this mode when it receives an indication from the network that interworking without N26 is supported.\nFor UE operating in dual-registration mode the following principles apply for PDU Session transfer from 5GC to EPC:\n-\tUE operating in Dual Registration mode may register in EPC ahead of any PDU Session transfer using the Attach procedure indicating that the UE is moving from 5GC without establishing a PDN Connection in EPC if the EPC supports EPS Attach without PDN Connectivity as defined in TS 23.401 [26]. Support for EPS Attach without PDN Connectivity is mandatory for UE supporting dual-registration procedures.\nNOTE 1:\tBefore attempting early registration in EPC the UE needs to check whether EPC supports EPS Attach without PDN Connectivity by reading the related SIB in the target cell.\n-\tUE performs PDU Session transfer from 5GC to EPC using the UE initiated PDN connection establishment procedure with \"handover\" indication in the PDN Connection Request message (clause 5.10.2 of TS 23.401 [26]).\n-\tIf the UE has not registered with EPC ahead of the PDU Session transfer, the UE can perform Attach in EPC with \"handover\" indication in the PDN Connection Request message (clause 5.3.2.1 of TS 23.401 [26]).\n-\tUE may selectively transfer certain PDU Sessions to EPC, while keeping other PDU Sessions in 5GC.\n-\tUE may maintain the registration up to date in both 5GC and EPC by re-registering periodically in both systems. If the registration in either 5GC or EPC times out (e.g. upon mobile reachable timer expiry), the corresponding network starts an implicit detach timer.\nNOTE 2:\tWhether UE transfers some or all PDU Sessions on the EPC side and whether it maintains the registration up to date in both EPC and 5GC can depend on UE capabilities that are implementation dependent. The information for determining which PDU Sessions are transferred on EPC side and the triggers can be pre-configured in the UE and are not specified in this Release of the specification. The UE does not know before-hand, i.e. before trying to move a given PDU session to EPC, whether that PDU session can be transferred to EPC.\nNOTE 3:\tThe Start of Unavailability Period and/or Unavailability Period Duration that the UE determines for NR satellite access with discontinuous network coverage in 5GS (see clause 5.4.1.4) and determines for satellite access with discontinuous coverage in EPS (see clause 4.13.8.2 of TS 23.401 [26]) can be different between 5GS and EPS.\nFor UE operating in dual-registration mode the following principles apply for PDN connection transfer from EPC to 5GC:\n-\tUE operating in Dual Registration mode may register in 5GC ahead of any PDN connection transfer using the Registration procedure indicating that the UE is moving from EPC (clause 4.2.2.2.2 of TS 23.502 [3]).\n-\tUE performs PDN connection transfer from EPC to 5GC using the UE initiated PDU Session Establishment procedure with \"Existing PDU Session\" indication (clause 4.3.2.2.1 of TS 23.502 [3]).\n-\tUE may selectively transfer certain PDN connections to 5GC, while keeping other PDN Connections in EPC.\n-\tUE may maintain the registration up to date in both EPC and 5GC by re-registering periodically in both systems. If the registration in either EPC or 5GC times out (e.g. upon mobile reachable timer expiry), the corresponding network starts an implicit detach timer.\nNOTE 4:\tWhether UE transfers some or all PDN connections on the 5GC side and whether it maintains the registration up to date in both 5GC and EPC can depend on UE capabilities that are implementation dependent. The information for determining which PDN connections are transferred on 5GC side and the triggers can be pre-configured in the UE and are not specified in this Release of the specification. The UE does not know before-hand, i.e. before trying to move a given PDN connection to 5GC, whether that PDN connection can be transferred to 5GC.\nNOTE 5:\tIf EPC does not support EPS Attach without PDN Connectivity the MME detaches the UE when the last PDN connection is released by the PGW as described in clause 5.4.4.1 of TS 23.401 [26] (in relation to transfer of the last PDN connection to non-3GPP access).\nWhen sending a control plane request for MT services (e.g. MT SMS) the network routes it via either the EPC or the 5GC. In absence of UE response, the network should attempt routing the control plane request via the other system.\nNOTE 6:\tThe choice of the system through which the network attempts to deliver the control plane request first is left to network configuration.\nWhen the UE supports single-registration mode or dual-registration mode without N26 interface:\n-\tIf the UE is in CM-CONNECTED state in 5GC, the NG-RAN may perform RRC Connection Release with Redirection to E-UTRAN based on certain criteria (e.g. based on local configuration in NG-RAN, or triggered by the AMF upon receiving Handover Request message from NG-RAN).\n-\tIf the UE is in ECM-CONNECTED state in EPC, the E-UTRAN may perform RRC Connection release with redirection to NG-RAN based on certain criteria (e.g. based on local configuration in E-UTRAN, or triggered by the MME upon receiving handover request from E-UTRAN).\nIP address preservation upon direct mobility between 5GS and GERAN/UTRAN is not supported.\nUpon mobility from 5GS to GERAN/UTRAN (e.g. upon leaving NG-RAN coverage) the UE shall perform the A/Gb mode GPRS Attach procedure or Iu mode GPRS Attach procedure (see TS 23.060 [56]).\nAs a UE option, to support IP address preservation at mobility from EPC to 5GS for PDN connections without 5GS related parameters, a 5GS capable UE may:\n-\tFollowing mobility from GERAN/UTRAN to EPS, release those PDN connection(s) and re-establish them as specified in clause 4.11.1.5.4.1 of TS 23.502 [3] so that they support interworking to 5GS.\nNOTE 1:\tIt is recommended that a UE using this option does not do this behaviour after every change to EPS in PLMNs that do not support 5GS, nor for APNs that do not support mobility to 5GS; and, that such a UE supports storage of the 5GS related parameters while in GERAN/UTRAN. Whether and how the UE is aware of which PLMNs support 5GS and which APNs do not support mobility to 5GS is out of scope of this specification.\nTo support mobility from EPC to 5GS to EPC to GERAN/UTRAN for PDN connections established in EPC:\nNOTE 2:\tFor the use of N7 or N40 interfaces while the UE is in GERAN/UTRAN access, the SMF+PGW-C selected by the MME (using the existing selection procedures described in clause 4.11.0a of TS 23.502 [3] and clause 4.3.8 of TS 23.401 [26]) needs to support functionality (e.g. signalling of GERAN/UTRAN cell identification over N7) specified in Annex L.\n-\tin signalling sent on the N26 interface, the MME should send the TI and BSS Container in the EPS Bearer Context (see Table 7.3.1-3 of TS 29.274 [101]), if there is any, of the EPS bearer to the SMF (V-SMF / I-SMF) via the AMF in the Bearer Context within the PDN Connection IE in the Forward Relocation Request and Context Response messages (TS 29.274 [101]); the SMF (V-SMF / I-SMF) should store the TI and BSS Container and the SMF (V-SMF / I-SMF) should provide the TI and BSS Container to the AMF (as part of a procedure to deliver SM context to AMF) so that the AMF sends the TI and BSS Container of the related EPS bearer in the Bearer Context within the EPS PDN Connection information in any subsequent Forward Relocation Request and Context Response message sent to an MME.\nNOTE 3:\tAt mobility from EPC, the SMF+PGW-C / V-SMF / I-SMF receives the TI and BSS Container as part of the UE EPS PDN Connection information from the AMF and stores the TI. At mobility to EPC, the SMF+PGW-C / V-SMF / I-SMF provides the AMF with the TI and BSS Container as part of the UE EPS PDN Connection information. The SMF+PGW-C / V-SMF / I-SMF is not meant to understand the TI/BSS Container nor to use it for any other purpose than providing it back to AMF.\nNOTE 4:\tGERAN/UTRAN Mobility Management Bearer Synchronisation procedures will release any dedicated QoS Flows established in 5GS.\nNOTE 5:\tWhen the UE access the network via GERAN/UTRAN over Gn/Gp interface, Secondary PDP Context Activation Procedure is not supported.\nIP address preservation at mobility from EPC to GERAN/UTRAN for PDU sessions established in 5GS is not supported.\nWith regard to interworking between 5GS and the Circuit Switched domain when the GERAN or UTRAN network is operating in NMO II (i.e. no Gs interface between MSC and SGSN):\n-\tupon mobility from 5GS to GERAN/UTRAN, the UE shall either:\n-\tact as if it is returning after a loss of GERAN/UTRAN coverage (and e.g. only perform a periodic LAU if the periodic LAU timer has expired), or,\n-\tperform a Location Update to the MSC. If the UE is registered for IMS voice and is configured, using Device Management or initial provisioning, to perform additional mobility management procedures when it has moved from a RAT that supports IMS voice over PS sessions to one that does not (see TS 23.060 [56]), it shall follow this option.\nUpon mobility from GERAN/UTRAN to 5GS (e.g. upon selecting an NG-RAN cell) the UE shall perform the Registration procedure of \"initial registration\" type as described in TS 23.502 [3]. The UE shall indicate a 5G-GUTI as UE identity in the Registration procedure if it has a stored valid native 5G-GUTI (e.g. from an earlier registration in the 5G System). Otherwise the UE shall indicate a SUCI.\nIf a UE in MICO mode moves to GERAN/UTRAN and any of the triggers defined in clause 5.4.1.3 occur, then the UE shall locally disable MICO mode and perform the A/Gb mode GPRS Attach procedure or Iu mode GPRS Attach procedure (see TS 23.060 [56]). The UE can renegotiate MICO when it returns to 5GS during (re-)registration procedure.\nIn Single Registration mode, expiry of the periodic RAU timer, or, the periodic LAU timer shall not cause the UE to change RAT.\nThe 5G SRVCC from NG-RAN to UTRAN is specified in the TS 23.216 [88]. After the 5G SRVCC to UTRAN, all the PDU sessions of the UE are released.\nSecondary authentication/authorization by a DN-AAA server during the establishment of a PDN connection over 3GPP access to EPC, is supported based on following principles:\n-\tIt is optional for the UE to support EAP-based secondary authentication and authorization by DN-AAA over EPC,\n-\tA SMF+PGW-C shall be used to serve DNN(s) requiring secondary authentication/authorization by a DN-AAA server,\n-\tFor secondary authentication/authorization by a DN-AAA server, the SMF+PGW-C runs the same procedures with PCF, UDM and DN-AAA and uses the same corresponding interfaces regardless of whether the UE is served by EPS or 5GS,\n-\tThe interface towards the UE is different (usage of NAS for EPS instead of NAS for 5GS) between the EPS and 5GS cases.\nThis is further specified in Annex H of TS 23.502 [3].\nIn this Release, EAP based Secondary authentication by a DN-AAA server during the establishment of a PDN connection over non-3GPP access to EPC is not supported.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.3\tInterworking with EPC in presence of Non-3GPP PDU Sessions",
                            "text_content": "When a UE is simultaneously connected to the 5GC over a 3GPP access and a non-3GPP access, it may have PDU Sessions associated with 3GPP access and PDU Sessions associated with non-3GPP access. When inter-system handover from 5GS to EPS is performed for PDU Sessions associated with 3GPP access, the PDU Sessions associated with non-3GPP access are kept anchored by the network in 5GC and the UE may either:\n-\tkeep PDU Sessions associated with non-3GPP access in 5GS (5GC+N3IWF or TNGF) (i.e. the UE is then registered both in EPS and, for non-3GPP access, in 5GS); or\n-\tlocally or explicitly release PDU Sessions associated with non-3GPP access; or\n-\tonce in EPS, transfer PDU Sessions associated with non-3GPP access to E-UTRAN by triggering PDN connection establishment with Request Type \"Handover\", as specified in TS 23.401 [26].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.4\tNetwork sharing support and interworking between EPS and 5GS",
                            "text_content": "The detailed description for supporting network sharing and interworking between EPS and 5GS is described in clauses 4.11.1.2.1, 4.11.1.2.2, 4.11.1.3.2 and 4.11.1.3.3 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.5\tService Exposure in Interworking Scenarios",
                            "text_content": "Clause 4.3.5 shows the Service Exposure Network Architecture in scenarios where for EPC-5GC Interworking is required.\nIn scenarios where interworking between 5GS and EPC is possible, the network configuration is expected to associate UEs with SCEF+NEF node(s) for Service Capability Exposure. The SCEF+NEF hides the underlying 3GPP network topology from the AF (e.g. SCS/AS) and hides whether the UE is served by 5GC or EPC.\nIf the service exposure function that is associated with a given service for a UE is configured in the UE's subscription information, then an SCEF+NEF identity shall be used to identify the exposure function. For example, if a UE is capable of switching between EPC and 5GC, then the SCEF ID that is associated with any of the UE's APN configurations should point to an SCEF+NEF node.\nFor external exposure of services related to specific UE(s), the SCEF+NEF resides in the HPLMN. Depending on operator agreements, the SCEF+NEF in the HPLMN may have interface(s) with NF(s) in the VPLMN.\nThe SCEF+NEF exposes over N33 the same API as the SCEF supports over T8. If CAPIF is not supported, the AF is locally configured with the API termination points for each service. If CAPIF is supported, the AF obtains the service API information from the CAPIF core function via the Availability of service APIs event notification or Service Discover Response as specified in TS 23.222 [64].\nThe common state information shall be maintained by the combined SCEF+NEF node in order to meet the external interface requirements of the combined node. The common state information includes at least the following data that needs to be common for the SCEF and NEF roles of SCEF+NEF:\n-\tSCEF+NEF ID (must be the same towards the AF).\n-\tSCEF+NEF common IP address and port number.\n-\tMonitoring state for any ongoing monitoring request.\n-\tConfigured set of APIs supported by SCEF+ NEF.\n-\tPDN Connection/PDU Session State and NIDD Configuration Information, including Reliable Data Service state information.\n-\tNetwork Parameter Configuration Information (e.g. Maximum Response Time and Maximum Latency).\nThe SCEF+NEF need not perform the same procedures for the configuration of monitoring events towards the HSS+UDM twice. For example, if the HSS+UDM is deployed as a combined node, a monitoring event only need to be configured by the SCEF+NEF just once.\nThe SCEF+NEF may configure monitoring events applicable to both EPC and 5GC using only 5GC procedures towards UDM. In this case, the SCEF+NEF shall indicate that the monitoring event is also applicable to EPC (i.e. the event must be reported both by 5GC and EPC) and may include a SCEF address (i.e. if the event needs to be configured in a serving node in the EPC and the corresponding notification needs to be sent directly to the SCEF). If the HSS and UDM are deployed as separate network entities, UDM shall use HSS services to configure the monitoring event in EPC as defined in TS 23.632 [102]. The UDM shall return an indication to SCEF+NEF of whether the configuration of the monitoring event in EPC was successful. In the case that the UDM reports that the configuration of a monitoring event was not possible in EPC, then the SCEF+NEF may configure the monitoring event using EPC procedures via the HSS as defined in TS 23.682 [36].\nNOTE 1:\tThe SCEF+NEF uses only 5GC procedures to configure monitoring events in EPC and 5GC.\nNOTE 2:\tIn terms of the CAPIF, the SCEF+NEF is considered a single node.\nIn addition to the interworking principles documented in clause 5.17.2.2, the following applies for interworking with N26:\n-\tWhen UE moves from EPS to 5GS, when the AMF registers in UDM, if no event subscription via UDM is available, the AMF indicates the situation to the UDM, and in this case the UDM can decide if the event subscriptions should be provisioned, otherwise if the AMF has event subscription information, after the registration procedure is completed, the AMF may inform the UDM of the currently subscribed events, and UDM will do synchronization if needed.\n-\tWhen UE moves from 5GS to EPS, the MME gets monitoring event configuration from HSS during as part of mobility procedure as specified in clause 4.11.1.3.2 of TS 23.502 [3].\nIn addition to the interworking principles documented in clause 5.17.2.3, the additional behaviour at EPS to 5GS mobility in clause 5.17.5.2.1 also applies.\nWhen SCEF+NEF performs the procedure of monitoring via the AMF as described in clause 4.15.3.2.4 (\"Exposure with bulk subscription\") in TS 23.502 [3], if the AMF determines the interworking without N26 interface is supported, during mobility from 5GS to EPS, the AMF shall subscribe on behalf of SCEF+NEF for UDM+HSS notification of MME ID as described in clause 7.1.2 to trigger the SCEF+NEF to configure the monitoring request to the new MME. For single-registration mode, when UE's mobility from 5GS to EPS happens and Serving MME sends Update Location Request to the UDM+HSS, the UDM+HSS provides Serving MME ID to the SCEF+NEF which is the notification endpoint based on the subscription request from AMF. Then the SCEF+NEF performs the procedure of configuring monitoring via the MME for the same Monitoring Events as described in clause 5.6.2.1 of TS 23.682 [36].\nWhen SCEF+NEF performs the procedure of monitoring via the UDM+HSS as described in clause 4.15.3.2.2 of TS 23.502 [3], when UE's mobility between 5GS and EPS happens, the UDM+HSS performs the procedure of configuring monitoring at the MME as described in clause 5.6.1.1 of TS 23.682 [36] and at the AMF as described in clause 4.15.3.2.1 of TS 23.502 [3].\nA service related with common north-bound API may become unavailable due to UE being served by a CN node not supporting the service. If the availability or expected level of support of a service API associated with a UE changes, for example due to a mobility between 5GC and EPC, the AF shall be made aware of the change.\nNOTE 1:\tIf CAPIF is supported and the service APIs become (un)available for the 5GC or EPC network, the AF obtains such information from the CAPIF core function.\nIf the SCEF+NEF receives the subscription request from the AF for the availability or expected level of support of a service API, the SCEF+NEF subscribes a CN Type Change event for the UE or Group of UEs to the HSS+UDM. If the HSS+UDM receives the subscription for CN Type Change event, the HSS+UDM includes the latest CN type for the UE or Group of UEs in the response for the subscription. If the HSS+UDM detects that the UE switches between being served by the MME and the AMF, the CN Type Change event is triggered, and the HSS+UDM notifies the latest CN type for the UE or Group of UEs to the SCEF+NEF. Based on the CN type information, the SCEF+NEF can determine the availability or expected level of support of a given service. The AF will be informed of such information via a subscription/notification service operation. The AF can subscribe for the availability or expected level of support of a service API with report type indicating either One-time report or Continuous report. If there is no CN type information for the UE in the SCEF+NEF, the SCEF+NEF subscribes monitoring event for a new CN Type Change event for the UE or Group of UEs to the HSS+UDM, otherwise, SCEF+NEF determines the CN type locally in the following conditions:\n-\tIf the AF subscribes with report type indicating One-time report, the SCEF+NEF may consider the Freshness Timer of the latest CN type information for the UE or Group of UEs. The Freshness Timer is a parameter that is configured based on local SCEF+NEF policy. When a subscription request with One-time report type is received the SCEF+NEF checks if there is the latest CN type information received from the HSS+UDM for the indicated UE ID or External Group ID. If the elapsed time for the CN type information since the last reception is less than the Freshness Timer, then the SCEF+NEF may respond to the AF with the latest CN type information in order to avoid repeated query to HSS+UDM.\n-\tThe SCEF+NEF has established a direct connection with MME or AMF or SMF.\nWhen the UE or all members of a Group of UEs are being served by a MME, EPC is determined as CN type. When the UE or all members of a Group of UEs are being served by an AMF, 5GC is determined as CN type. When the UE is registered both in EPC and 5GC, or some members of a Group of UEs are registered in EPC while some members are registered in 5GC, 5GC+EPC is determined as CN type.\nNOTE 2:\tIf 5GC+EPC is determined as the CN type serving the UE or the group of UEs, the SCEF+NEF determines that service APIs for both 5GC and EPC are available to the UE or the group of UEs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.6\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.7\tConfiguration Transfer Procedure between NG-RAN and E-UTRAN",
                            "text_content": "The purpose of the Configuration Transfer between NG-RAN and E-UTRAN is to enable the transfer the RAN configuration information between the gNB and eNodeB via MME and AMF.\nIn order to make the information transparent for the MME and AMF, the information is included in a transparent container. The source and target RAN node addresses, which allows the Core Network nodes to route the messages. The mechanism depicted in Figure 5.17.7.1-1.\nThe figure depicts a configuration transfer between a gNB and E-UTRAN basic network architecture, illustrating the various components and their interconnections.\nFigure 5.17.7.1-1: Configuration Transfer between gNB and E-UTRAN basic network architecture\nThe NG-RAN transparent containers are transferred from the source NG-RAN node to the destination E-UTRAN node and vice versa by use of Configuration Transfer messages.\nAn ENB Configuration Transfer message is used from the E-UTRAN node to the MME over S1 interface as described in TS 36.413 [100], the destination RAN node includes the en-gNB Identifier and may include a TAI associated with the en-gNB. If MME is aware that the en-gNB serves cells which provide access to 5GC, the MME relays the request towards a suitable AMF via inter-system signalling based on a broadcast 5G TAC. An AMF Configuration Transfer message is used from the AMF to the NG-RAN over N2 interface.\nA Configuration Transfer message is used by the gNB node to the AMF over N2 interface for the reply, and a Configuration Transfer Tunnel message is used to tunnel the transparent container from AMF to MME over the N26 interface. MME relays this reply to the target eNB using a MME CONFIGURATION TRANSFER message. Transport of the RAN containers in E-UTRAN is specified in TS 23.401 [26].\nEach Configuration Transfer message carrying the transparent container is routed and relayed independently by the core network node(s). Any relation between messages is transparent for the AMF and MME, i.e. a request/response exchange between applications, for example SON applications, is routed and relayed as two independent messages by the AMF and MME.\nAll the Configuration Transfer messages contain the addresses of the source and destination RAN nodes.\nAn gNB node is addressed by the Target NG-RAN node identifier as described in TS 38.413 [34].\nAn eNodeB is addressed by the Target eNodeB identifier as described in TS 36.413 [100].\nThe source RAN node sends a message to its core network node including the source and destination addresses.\nMME uses the destination address to route the message to the correct AMF via N26 interface. AMF uses the destination address to route the message to the correct MME via N26 interface.\nThe AMF connected to the destination RAN node decides which RAN node to send the message to, based on the destination address.\nThe MME connected to the destination RAN node decides which RAN node to send the message to, based on the destination address.\nThe AMF performs relaying between N2 and N26 messages as described in TS 38.413 [34] and TS 29.274 [101].\nThe MME performs relaying between S1 and N26 message as described in TS 36.413 [100] and TS 29.274 [101].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.17.8\tURSP Provisioning in EPS",
                            "text_content": "When the UE registers in 5GS, the UE includes the Indication of URSP Provisioning Support in EPS in the UE Policy Container carried in Registration Request. On receiving this indication in the UE Policy Container, the PCF will provision the URSP to UE in EPS.\nThe UE may include the indication of URSP Provisioning Support in EPS in PCO or ePCO to the SMF+PGW-C during:\n-\tInitial Attach with default PDN connection establishment (according to clause 5.3.2.1 of TS 23.401 [26]).\n-\tAny UE requested PDN connectivity request to an additional PDN (according to clause 5.10.2 of TS 23.401 [26].\nIf the SMF+PGW-C supports URSP provisioning in EPS, it provides the Indication of URSP Provisioning Support in EPS in ePCO in the Create Session Response message.\nThe UE ensures that there is only one PDN connection used for URSP rule delivery in EPS. When the UE receives an indication of URSP provisioning support in EPS in the PDN Connectivity Accept message and this PDN connection is not released, then for any subsequent PDN connectivity requests the UE does not include an indication of URSP Provisioning Support in EPS.\nWhen the UE receives the Indication of URSP Provisioning Support in EPS included in ePCO in the PDN Connectivity Accept message, then the UE initiates the UE requested bearer resource modification without QoS update procedure and includes the UE Policy Container ePCO in the Request Bearer Resource Modification message, the UE Policy Container in ePCO will be further forwarded by MME to SMF+PGW-C. When the UE Policy Container ePCO is received by SMF+PGW-C, it forwards transparently the UE Policy Container to PCF for the PDU Session, then the PCF for the PDU Session establishes the UE Policy Association with PCF for the UE. The PCF for the UE generates the corresponding URSP rules in a similar way as it is done in 5GS and sends the URSP rules to UE in the UE Policy Container as described in clause 4.11.0a.5 of TS 23.502 [3].\nNOTE 1:\tThe UE includes the Indication of URSP Provisioning Support in EPS in PCO or ePCO in the PDN connectivity request according to clause 6.6.1.1 of TS 24.301 [13].\nNOTE 2:\tThe MME and Serving-GW can be configured to prioritize the selection of a SMF+PGW-C that support URSP Rule provisioning in EPS.\nIf the UE does not receive the Indication of URSP Provisioning Support in EPS in ePCO in the PDN Connectivity Accept message, then the UE does not initiate the UE requested bearer resource modification procedure to send the UE Policy Container.\nThe PDN Connection used by UE and SMF+PGW-C to convey UE Policy Container PCO shall be kept when the UE is in the CONNECTED mode. When the UE is attached to EPS, the PCF for the PDU Session retrieves the PCRTs for UE Policy from PCF for the UE and subscribes to the applicable PCRTs to SMF+PGW-C. The PCF for the PDU Session sends the UE Policy Container in the same PDN connection/PDU session in which the UE Policy Container was received.\nDuring EPS to 5GS mobility with N26, the UE Policy Association is terminated by PCF for PDU Session when it receives the indication of RAT type change from the SMF+PGW-C.\nDuring 5GS to EPS mobility with N26, the PCF for the PDU Session determines whether the UE supports URSP delivery in EPS by checking UE context policy control subscription information in UDR. The PCF for the PDU Session discovers the address of PCF for the UE serving the UE by querying BSF. The PCF for the UE recovers the information about the PSI list in the UE and the subscribed PCRTs in 5GS from former UE Policy Association for the UE after receiving the UE Policy Association Establishment request including a UE Policy Container only including an indication about the trigger for the UE Policy Association Establishment (\"5GS to EPS mobility\").\nAfter the 5GS to EPS mobility, if PCF for the UE needs to provision the URSP to UE, the PCF for the UE sends the UE Policy Container in Npcf_UEPolicyControl_UpdateNotify Request to the PCF for the PDU Session as described in clause 4.11.0a.2a.10 of TS 23.502 [3]. In case there are more than one PDN connections for the UE, then the PCF for the PDU Session selects any of the ongoing PDN Connections via a SMF+PGW-C supporting URSP delivery in EPS for the UE. Then via the selected PDN Connection, the SMF+PGW-C sends the UE Policy Container via ePCO to UE by initiating the PDN GW initiated bearer modification without QoS update procedure as defined in clause 5.4.3 of TS 23.401 [26].\nNOTE 3:\tAt 5GS to EPS mobility with N26, the guard timer in the AMF (as specified in clauses 4.11.1.2.1 and 4.11.1.3.2 of TS 23.502 [3]) ensures that the UE Policy Association remains until the PCF for the UE detects that a UE Policy Association establishment is received from a PCF for the PDU Session indicating 5GS to EPS mobility.\nNOTE 4:\tIn the case that the UE is still registered and reachable over non-3GPP access, the PCF for UE can have two UE policy associations for one UE, and based on local configuration the PCF can decide to use one of the UE policy associations to update URSP rule to the UE. The UE can receive URSP Rules over any of these two accesses.\nWhen the PCF for the UE decides to update the URSPs in the UE via EPS, the PCF for the UE sends the updated URSP rules in UE Policy Container to the PCF for the PDU Session, then the PCF for the PDU Session forwards it to the SMF+PGW-C. The SMF+PGW-C transfers the received UE Policy Container via ePCO to the UE by triggering PDN-GW initiated Bearer without QoS Modification procedure as described in clause 5.4.3 of TS 23.401 [26]. After update the UE policy provided by the PCF, the UE response about the delivery result via ePCO to the network. The SMF+PGW-C transparently forwards the UE response to the PCF for the PDU Session via Update Bearer Response message, and then the PCF for the PDU Session forwards it to the PCF for the UE via Npcf_UEPolicyControl_Update Request. If the SMF+PGW-C receives a rejection for Update Bearer Request message (e.g. due to paging failure), the delivery failure result is sent to PCF for the PDU Session and the PCF for the UE. To request to forward the result of delivery of UE policies, \"Result of UE Policy Container delivery via EPS\" PCRT is applied to the PCF for the PDU Session and the SMF+PGW-C as described in clause 4.11.0a.2a.10 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.18\tNetwork Sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.18.1\tGeneral concepts",
                            "text_content": "A network sharing architecture shall allow multiple participating operators to share resources of a single shared network according to agreed allocation schemes. The shared network includes a radio access network. The shared resources include radio resources.\nThe shared network operator allocates shared resources to the participating operators based on their planned and current needs and according to service level agreements.\nIn this Release of the specification, only the 5G Multi-Operator Core Network (5G MOCN) network sharing architecture, in which only the RAN is shared in 5G System, is supported. 5G MOCN for 5G System, including UE, RAN and AMF, shall support operators' ability to use more than one PLMN ID (i.e. with same or different country code (MCC) some of which is specified in TS 23.122 [17] and different network codes (MNC)) or combinations of PLMN ID and NID. 5G MOCN supports NG-RAN Sharing with or without multiple Cell Identity broadcast as described in TS 38.300 [27].\n5G MOCN also supports the following sharing scenarios involving non-public networks, i.e.NG-RAN can be shared by any combination of PLMNs, PNI-NPNs (with CAG), and SNPNs (each identified by PLMN ID and NID).\nNOTE 1:\tPNI-NPNs (without CAG) are not explicitly listed above as it does not require additional NG-RAN sharing functionality compared to sharing by one or multiple PLMNs.\nIn all non-public network sharing scenarios, each Cell Identity as specified in TS 38.331 [28] is associated with one of the following configuration options:\n-\tone or multiple SNPNs;\n-\tone or multiple PNI-NPNs (with CAG); or\n-\tone or multiple PLMNs only.\nNOTE 2:\tThis allows the assignment of multiple cell identities to a cell and also allows the cell identities to be independently assigned, i.e. without need for coordination, by the network sharing partners, between PLMNs and/or non-public networks.\nNOTE 3:\tDifferent PLMN IDs (or combinations of PLMN ID and NID) can also point to the same 5GC. When same 5GC supports multiple SNPNs (identified by PLMN ID and NID), it is up to the operator's policy whether they are used as equivalent SNPNs for a UE.\nNOTE 4:\tThere is no standardized mechanism to avoid paging collisions if the same 5G-S-TMSI is allocated to different UEs by different PLMNs or SNPNs of the shared network, as the risk of paging collision is assumed to be very low. If such risk is to be eliminated then PLMNs and SNPNs of the shared network needs to coordinate the value space of the 5G-S-TMSI to differentiate the PLMNs and SNPNs of the shared network.\nThe 5G Multi-Operator Core Network (5G MOCN) in Figure 5.18.1-1 illustrates a network architecture where multiple core networks (CNs) are connected to the same Next-Generation Radio Access Network (NG-RAN). This network design is crucial for supporting a high-speed, low-latency, and efficient communication network. The figure highlights the importance of network slicing, which allows for the creation of virtual networks for different services, such as voice, video, and data. Additionally, the figure shows the use of virtualized radio access network (VRAN) elements, which enable efficient resource allocation and management. Overall, the 5G MOCN is a key component of the 5G network architecture, enabling the delivery of high-quality, low-latency, and efficient communication services.\nFigure 5.18.1-1: A 5G Multi-Operator Core Network (5G MOCN) in which multiple CNs are \nconnected to the same NG-RAN\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.2\tBroadcast system information for network sharing",
                            "text_content": "If a shared NG-RAN is configured to indicate available networks (PLMNs and/or SNPNs) for selection by UEs, each cell in the shared radio access network shall in the broadcast system information include available core network operators in the shared network.\nThe Broadcast System Information broadcasts a set of PLMN IDs and/or PLMN IDs and NIDs and one or more additional set of parameters per PLMN e.g. cell-ID, Tracking Areas, CAG Identifiers. All 5G System capable UEs that connect to NG-RAN support reception of multiple PLMN IDs and per PLMN specific parameters. All SNPN-enabled UEs support reception of multiple combinations of PLMN ID and NID and SNPN-specific parameters.\nThe available core network operators (PLMNs and/or SNPNs) shall be the same for all cells of a Tracking Area in a shared NG-RAN network.\nUEs not set to operate in SNPN access mode decode the broadcast system information and take the information concerning available PLMN IDs into account in PLMN and cell (re-)selection procedures. UEs set to operate in SNPN access mode decode the broadcast system information and take the information concerning available PLMN IDs and NIDs into account in network and cell (re-)selection procedures. Broadcast system information is specified in TS 38.331 [28] for NR, TS 36.331 [51] for E-UTRA and related UE access stratum idle mode procedures in TS 38.304 [50] for NR and TS 36.304 [52] for E-UTRA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.2a\tPLMN list and SNPN list handling for network sharing",
                            "text_content": "The AMF prepares lists of PLMN IDs or SNPN IDs suitable as target PLMNs or target SNPNs for use at idle mode cell (re)selection and for use at handover and RRC Connection Release with redirection. The AMF:\n-\tprovides the UE with the list of PLMNs or list of SNPNs that the UE shall consider as Equivalent to the serving PLMN or the serving SNPN (see TS 23.122 [17]); and\n-\tprovides the NG-RAN with a prioritised list of permitted PLMNs or a prioritized list of permitted SNPNs. When prioritising these PLMNs or SNPNs, the AMF may consider the following information: HPLMN of the UE or the subscribed SNPN of the UE, the serving PLMN or the serving SNPN, a preferred target PLMN (e.g. based on last used EPS PLMN) or a preferred target SNPN, or the policies of the operator(s).\nFor a UE registered in an SNPN, the AMF shall not provide a list of equivalent PLMNs to the UE and shall not provide a list of permitted PLMNs to NG-RAN.\nFor a UE registered in a PLMN, the AMF shall not provide a list of equivalent SNPNs to the UE and shall not provide a list of permitted SNPNs to NG-RAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.3\tNetwork selection by the UE",
                            "text_content": "NOTE:\tThis clause applies to UEs not operating in SNPN access mode. Network selection for UEs set to operate in SNPN access mode is described in clause 5.30.2.4.\nA UE that has a subscription to one of the sharing core network operators shall be able to select this core network operator while within the coverage area of the shared network and to receive subscribed services from that core network operator.\nEach cell in shared NG-RAN shall in the broadcast system information include the PLMN-IDs concerning available core network operators in the shared network.\nWhen a UE performs an Initial Registration to a network, one of available PLMNs shall be selected to serve the UE. UE uses all the received broadcast PLMN-IDs in its PLMN (re)selection processes which is specified in TS 23.122 [17]. UE shall inform the NG-RAN of the selected PLMN so that the NG-RAN can route correctly. The NG-RAN shall inform the core network of the selected PLMN.\nAs per any network, after Initial Registration to the shared network and while remaining served by the shared network, the network selection procedures specified in TS 23.122 [17] may cause the UE to perform a reselection of another available PLMN.\nUE uses all of the received broadcast PLMN-IDs in its cell and PLMN (re)selection processes.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.4\tNetwork selection by the network",
                            "text_content": "The NG-RAN uses the selected PLMN/SNPN (provided by the UE at RRC establishment, or, provided by the AMF/source NG-RAN at N2/Xn handover) to select target cells for future handovers (and radio resources in general) appropriately. The network should not move the UE to another available PLMN/SNPN, e.g. by handover, as long as the selected PLMN/SNPN is available to serve the UE's location.\nIn the case of handover or network controlled release to a PLMN in a shared network:\n-\tWhen multiple PLMN IDs are broadcasted in a cell selected by NG-RAN, NG-RAN shall select a target PLMN, taking into account the prioritized list of PLMN IDs provided via Mobility Restriction List from AMF.\n-\tFor Xn based HO procedure, Source NG-RAN indicates the selected PLMN ID to the target NG-RAN, see TS 38.300 [27].\n-\tFor N2 based HO procedure, the NG-RAN indicates a selected PLMN ID to the AMF as part of the TAI sent in the HO required message. Source AMF uses the TAI information supplied by the source NG-RAN to select the target AMF/MME. The source AMF should forward the selected PLMN ID to the target AMF/MME. The target AMF/MME indicates the selected PLMN ID to the target NG-RAN/eNB so that the target NG-RAN/eNB can select target cells for future handover appropriately.\n-\tFor RRC connection release with redirection to E-UTRAN procedure, NG-RAN decides the target network by using PLMN information as defined in the first bullet.\nA change in serving PLMN is indicated to the UE as part of the UE registration with the selected network via 5G-GUTI in 5GS.\nIn the case of handover or network controlled release to an SNPN in a shared network, the following applies:\n-\tWhen multiple SNPN IDs are broadcasted in a cell selected by NG-RAN, NG-RAN shall select a target SNPN, taking into account the prioritized list of SNPN IDs provided via Mobility Restriction List from AMF.\n-\tFor Xn based HO procedure, Source NG-RAN indicates the selected SNPN ID to the target NG-RAN, see TS 38.300 [27].\n-\tFor N2 based HO procedure, the NG-RAN indicates a selected SNPN ID to the AMF together with the TAI sent in the HO required message. Source AMF uses the selected SNPN ID together with the TAI information supplied by the source NG-RAN to select the target AMF. The source AMF should forward the selected SNPN ID to the target AMF. The target AMF indicates the selected SNPN ID to the target NG-RAN so that the target NG-RAN can select target cells for future handover appropriately.\nA change in serving SNPN is indicated to the UE as part of the UE registration with the selected network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.18.5\tNetwork Sharing and Network Slicing",
                            "text_content": "As defined in clause 5.15.1, a Network Slice is defined within a PLMN or SNPN. Network sharing is performed among different PLMNs and/or SNPNs. In the case of network sharing, each PLMN or SNPN sharing the NG-RAN defines and supports its PLMN- or SNPN- specific set of slices that are supported by the common NG-RAN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.19\tControl Plane Load Control, Congestion and Overload Control",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.19.1\tGeneral",
                            "text_content": "In order to ensure that the network functions within 5G System are operating under nominal capacity for providing connectivity and necessary services to the UE. Thus, it supports various measures to guard itself under various operating conditions (e.g. peak operating hour, extreme situations). It includes support for load (re-)balancing, overload control and NAS level congestion control. A 5GC NF is considered to be in overload when it is operating over its nominal capacity resulting in diminished performance (including impacts to handling of incoming and outgoing traffic).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.2\tTNLA Load Balancing and TNLA Load Re-Balancing",
                            "text_content": "AMF can support load balancing and re-balancing of TNL associations between 5G-AN and AMF by using mechanisms specified in clause 5.21.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.3\tAMF Load Balancing",
                            "text_content": "The AMF Load Balancing functionality permits UEs that are entering into an AMF Region/AMF Set to be directed to an appropriate AMF in a manner that achieves load balancing between AMFs. This is achieved by setting a Weight Factor for each AMF, such that the probability of the 5G-AN selecting an AMF is proportional to Weight Factor of the AMF. The Weight Factor is typically set according to the capacity of an AMF node relative to other AMF nodes. The Weight Factor is sent from the AMF to the 5G-AN via NGAP messages (see TS 38.413 [34]).\nNOTE 1:\tAn operator may decide to change the Weight Factor after the establishment of NGAP connectivity as a result of changes in the AMF capacities. e.g. a newly installed AMF may be given a very much higher Weight Factor for an initial period of time making it faster to increase its load.\nNOTE 2:\tIt is intended that the Weight Factor is NOT changed frequently. e.g. in a mature network, changes on a monthly basis could be anticipated, e.g. due to the addition of 5G-AN or 5GC nodes.\nNOTE 3:\tWeight Factors for AMF Load Balancing are associated with AMF Names.\nLoad balancing by 5G-AN node is only performed between AMFs that belong to the same AMF set, i.e. AMFs with the same PLMN, AMF Region ID and AMF Set ID value.\nThe 5G-AN node may have their Load Balancing parameters adjusted (e.g. the Weight Factor is set to zero if all subscribers are to be removed from the AMF, which will route new entrants to other AMFs within an AMF Set).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.4\tAMF Load Re-Balancing",
                            "text_content": "The AMF load re-balancing functionality permits cross-section of its subscribers that are registered on an AMF (within an AMF Set) to be moved to another AMF within the same AMF set with minimal impacts on the network and end users. AMF may request some or all of the 5G-AN node(s) to redirect a cross-section of UE(s) returning from CM-IDLE state to be redirected to another AMF within the same AMF set, if the 5G-AN is configured to support this. The AMF may request some or all of the 5G-AN node(s) to redirect the UEs served by one of its GUAMI(s) to a specific target AMF within the same AMF set or to any different AMF within the same AMF set.\nWhen indicating a specific target AMF, the AMF should ensure that the load re-balancing will not cause overload in the target AMF.\nNOTE:\tThis requirement can be fulfilled by the AMF itself or by the OAM.\nFor UE(s) in CM-IDLE state, when UE subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS message with a 5G S-TMSI or GUAMI pointing to an AMF that requested for redirection, the 5G-AN should select the specific target AMF (provided by the original AMF) or a different AMF from the same AMF set and forward the initial NAS message.\nFor UE(s) in CONNECTED mode, similar mechanisms for AMF Management can be used to move the UE to another AMF in the same AMF set as described in clause 5.21.2, except that the old AMF deregisters itself from NRF.\nThe newly selected/target AMF (which is now the serving AMF) will re-assign the GUTI (using its own GUAMI(s)) to the UE(s). It is not expected that the 5G-AN node rejects any request or enables access control restriction when it receives a request for redirection for load control from the connected AMF(s).\nWhen the AMF wants to stop redirection, the AMF can indicate that it can serve all UE(s) in CM-IDLE state to stop the redirection.\nNOTE 1:\tAn example use for the AMF load re-balancing functionality is for the AMF to pro-actively re-balance its load prior to reaching overload i.e. to prevent overload situation.\nNOTE 2:\tTypically, AMF Load Re-Balancing is not needed when the AMF becomes overloaded because the Load Balancing function should have ensured that the other AMFs within the AMF Set are similarly overloaded.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.5\tAMF Control Of Overload",
                            "text_content": "The AMF shall contain mechanisms for avoiding and handling overload situations. This includes the following measures:\n-\tN2 overload control that could result in RRC reject, RRC Connection Release and unified access barring.\n-\tNAS congestion control.\nUnder unusual circumstances, if AMF has reached overload situation, the AMF activates NAS level congestion control as specified in Clause 5.19.7 and AMF restricts the load that the 5G-AN node(s) are generating, if the 5G-AN is configured to support overload control. N2 overload control can be achieved by the AMF invoking the N2 overload procedure (see TS 38.300 [27] and TS 38.413 [34]) to all or to a proportion of the 5G-AN nodes with which the AMF has N2 connections. The AMF may include the S-NSSAI(s) in NGAP OVERLOAD START message sent to 5G-AN node(s) to indicate the Network Slice(s) with which NAS signalling is to be restricted. To reflect the amount of load that the AMF wishes to reduce, the AMF can adjust the proportion of 5G-AN nodes which are sent NGAP OVERLOAD START message, and the content of the overload start procedure.\nWhen NGAP OVERLOAD START is sent by multiple AMFs or from the same AMF set in the same PLMN towards the 5G-AN, it should be ensured that the signalling load is evenly distributed within the PLMN and within each AMF set.\nA 5G-AN node supports restricting of 5G-AN signalling connection when a signalling connection establishment are attempted by certain UEs (which are registered or attempting to register with the 5GC), as specified in TS 38.331 [28] and TS 36.331 [51]. Additionally, a 5G-AN node provides support for the barring of UEs as described in TS 22.261 [2]. These mechanisms are further specified in TS 38.331 [28] and TS 36.331 [51]. For 3GPP Access Type, the signalling connection establishment attempt includes a RRC Connection Resume procedure from RRC_INACTIVE.\nBy sending the NGAP OVERLOAD START message, the AMF can request the 5G-AN node to apply the following behaviour for UEs that the AMF is serving:\na)\tRestrict 5G-AN signalling connection requests that are not for emergency, not for exception reporting and not for high priority mobile originated services; or\nb)\tRestrict 5G-AN signalling connection requests for uplink NAS signalling transmission to that AMF;\nc)\tRestrict 5G-AN signalling connection requests where the Requested NSSAI at AS layer only includes the indicated S-NSSAI(s) in the NGAP OVERLOAD START message. This applies also to RRC_INACTIVE Connection Resume procedure where the Allowed NSSAI in the stored UE context in the RAN only includes S-NSSAIs included in the NGAP OVERLOAD START.\nd)\tonly permit 5G-AN signalling connection requests for emergency sessions and mobile terminated services for that AMF; or\ne)\tonly permit 5G-AN signalling connection requests for high priority sessions, exception reporting and mobile terminated services for that AMF;\nThe above applies for RRC Connection Establishment procedure and RRC Connection Resume procedures over 3GPP access, as well as for the UE-N3IWF connection establishment over untrusted Non-3GPP access and for the UE-TNGF connection establishment over trusted Non-3GPP access.\nThe AMF can provide a value that indicates the percentage of connection requests to be restricted in the NGAP OVERLOAD START, and the 5G-AN node may consider this value for congestion control.\nWhen restricting a 5G-AN signalling connection, the 5G-AN indicates to the UE an appropriate wait timer that limits further 5G-AN signalling connection requests until the wait timer expires.\nDuring an overload situation, the AMF should attempt to maintain support for emergency services and for MPS.\nWhen the AMF is recovering, the AMF can either:\n-\tsend a NGAP OVERLOAD START message with a new percentage value that permits more connection requests to be successful, or\n-\tsend a NGAP OVERLOAD STOP message.\nto the same 5G-AN node(s) the NGAP OVERLOAD START was previously sent.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.6\tSMF Overload Control",
                            "text_content": "The SMF shall contain mechanisms for avoiding and handling overload situations. This can include the following measures:\n-\tSMF overload control that could result in rejections of NAS requests.\nThe SMF overload control may be activated by SMF due to congestion situation at SMF e.g. configuration, by a restart or recovery condition of a UPF, or by a partial failure or recovery of a UPF for a particular UPF(s).\nUnder unusual circumstances, if the SMF has reached overload situation, the SMF activates NAS level congestion control as specified in clause 5.19.7. The SMF may restrict the load that the AMF(s) are generating, if the AMF is configured to enable the overload restriction.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.19.7\tNAS level congestion control",
                            "text_content": "NAS level congestion control may be applied in general (i.e. for all NAS messages), per DNN, per S-NSSAI, per DNN and S-NSSAI, or for a specific group of UEs.\nNAS level congestion control is achieved by providing the UE a back-off time. To avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select each back-off time value so that the deferred requests are not synchronized. When the UE receives a back-off time, the UE shall not initiate any NAS signalling with regards to the applied congestion control until the back-off timer expires or the UE receives a mobile terminated request from the network, or the UE initiates signalling for emergency services or high priority access.\nAMFs and SMFs may apply NAS level congestion control, but should not apply NAS level congestion control for procedures not subject to congestion control.\nThis clause only applies to NAS Mobility Management congestion control.\nUnder general overload conditions the AMF may reject NAS messages from UEs using any 5G-AN. When a NAS request is rejected, a Mobility Management back-off time may be sent by the AMF to the UE. While the Mobility Management back-off timer is running, the UE shall not initiate any NAS request except for Deregistration procedure and procedures not subject to congestion control (e.g. high priority access, emergency services) and mobile terminated services. After any such Deregistration procedure, the back-off timer continues to run. While the Mobility Management back-off timer is running, the UE is allowed to perform Mobility Registration Update if the UE is already in CM-CONNECTED state. If the UE receives a paging request or a NAS notification message from the AMF while the Mobility Management back off timer is running, the UE shall stop the Mobility Management back-off timer and initiate the Service Request procedure or the Mobility Registration Update procedure over 3GPP access and/or non-3GPP access as applicable. Over non-3GPP access, if the UE is in CM-IDLE state when the back-off timer is stopped, it shall initiate the UE-triggered Service Request procedure as soon as it switches back to CM-CONNECTED state.\nIn order to allow the UE to report the PS Data Off status change in PDU Session Modification Request message, the UE behaves as follows while keeping the NAS MM back-off timer running in the UE:\n-\tWhen the UE is in CM-IDLE state and has not moved out of the Registration Area, the UE is allowed to send a Service Request message with an indication that the message is exempted from NAS congestion control. When the UE is in CM-IDLE mode and has moved out of the Registration Area, the UE is allowed to send a Mobility Registration Update request message, with a Follow-on request, and with an indication that the message is exempted from NAS congestion control.\n-\tWhen the UE is in CM-CONNECTED state, the UE sends a PDU Session Modification Request with PS Data Off status change carried in UL NAS Transport message with an indication that the message is exempted from NAS congestion control.\nWhen the NAS MM congestion control is activated at AMF, if the UE indicates that the NAS MM message is exempted from NAS congestion control, the AMF shall not reject the NAS MM message and shall forward the NAS SM message to the corresponding SMF with an indication that the NAS SM message was indicated to be exempted from NAS congestion control. The SMF ensures that the NAS SM message is not subject to congestion control otherwise the SMF rejects the message, e.g. the SMF shall reject PDU Session Modification received if it is not for Data Off status reporting.\nThe Mobility Management back-off timer shall not impact Cell/RAT/Access Type and PLMN change. Cell/RAT/TA/Access Type change does not stop the Mobility Management back-off timer. The Mobility Management back-off timer shall not be a trigger for PLMN reselection or SNPN reselection. The back-off timer is stopped as defined in TS 24.501 [47] when a new PLMN or SNPN, that is not an equivalent PLMN or is not an equivalent SNPN, is accessed.\nTo avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the AMF should select the Mobility Management back-off timer value so that the deferred requests are not synchronized.\nIf the UE required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while the NAS MM congestion control timer was running and was unable to initiate MM signalling, the UE defers the related MM signalling until the MM congestion control timer expires and initiates after the expiry of the timer.\nIn the case of a UE with scheduled communication pattern, the AMF may consider the UE's communication pattern while selecting a value for the Mobility Management back-off timer so that the UE does not miss its only scheduled communication window.\nThe AMF should not reject Registration Request message for Mobility Registration Update that are performed when the UE is already in CM-CONNECTED state.\nThe AMF may reject the Service Request message and a UL NAS Transfer with a Mobility Management back-off time when the UE is already in CM-CONNECTED state. If UE receives a DL NAS Transfer message from the AMF while the Mobility Management back off timer is running, the UE shall stop the Mobility Management back-off timer.\nFor CM-IDLE state mobility, the AMF may reject Registration Request messages for Mobility Registration Update by including a Mobility Management back off time value in the Registration Reject message.\nIf UE registered in the same PLMN for 3GPP access and non-3GPP access and receives a Mobility Management back-off time from the AMF, the back-off time (and corresponding start and stop) is applied equally to both 3GPP access and non-3GPP access. If UE registered in different PLMNs for 3GPP access and non-3GPP access respectively and receives a Mobility Management back-off time, the back-off time is only applied to the PLMN that provides the time to the UE.\nIf the AMF rejects Registration Request messages or Service Request with a Mobility Management back-off time which is larger than the sum of the UE's Periodic Registration Update timer and the Implicit Deregistration timer, the AMF should adjust the mobile reachable timer and/or Implicit Deregistration timer such that the AMF does not implicitly deregister the UE while the Mobility Management back-off timer is running.\nNOTE:\tThis is to minimize signalling after the Mobility Management back-off timer expires.\nIf the AMF deregisters the UE with an indication of re-registration required, the UE behaviour for handling the back-off timer(s) is as specified in TS 24.501 [47].\nDNN based congestion control is designed for the purpose of avoiding and handling of NAS SM signalling congestion for the UEs with a back-off timer associated with or without a DNN regardless of the presence of an S-NSSAI. Both UE and 5GC shall support the functionality to enable DNN based congestion control.\nSMFs may apply DNN based congestion control towards the UE by rejecting PDU Session Establishment Request message, or PDU Session Modification Request message except for those sent for the purpose of reporting 3GPP PS Data Off status change for a specific DNN with a running back-off timer. The SMF may release PDU Sessions belonging to a congested DNN by sending a PDU Session Release Command message towards the UE with a DNN back-off timer. If a DNN back-off time is set in the PDU Session Release Command message, the cause value of \"reactivation requested\" shall not be set.\nIf NWDAF is deployed, the SMF may make use of Session Management Congestion Control Experience analytics provided by NWDAF, as defined in clause 6.12 of TS 23.288 [86], to determine back-off timer provided to UEs.\nNOTE:\tFor example, the SMF can apply a short back-off timer to the UEs in the list of high-experienced UEs while the SMF can apply a long back-off timer to the UEs in the list of low-experienced UEs.\nWhen DNN based congestion control is activated at AMF e.g. configured by OAM, the AMF provides a NAS Transport Error message for the NAS Transport message carrying an SM message, and in the NAS Transport Error message it includes a DNN back-off timer.\nThe UE associates the received back-off time with the DNN (i.e. no DNN, DNN only) which the UE included in the uplink NAS MM message carrying the corresponding NAS SM request message.\nThe UE associates the received back-off time with the DNN (i.e. no DNN, DNN only) in any PLMN unless the DNN associated with the back-off timer is an LADN DNN in which case the UE only associates it to the PLMN in which the back-off time was received.\nThe UE behaves as follows when the DNN back-off timer is running:\n-\tIf a DNN is associated with the back-off timer, the UE shall not initiate any Session Management procedures for the congested DNN. The UE may initiate Session Management procedures for other DNNs. The UE shall not initiate any Session Management procedure for the corresponding APN when UE moves to EPS. The UE may initiate Session Management procedures for other APNs when the UE moves to EPS;\n-\tIf no DNN is associated with the back-off timer, the UE may only initiate Session Management requests of any PDU Session Type for a specific DNN;\n-\tUpon Cell/TA/PLMN/RAT change, change of untrusted non-3GPP access network or change of Access Type, the UE shall not stop the back-off timer;\n-\tThe UE is allowed to initiate the Session Management procedures for high priority access and emergency services;\n-\tThe UE is allowed to initiate the Session Management procedure for reporting Data Off status change to the network;\n-\tIf the UE receives a network initiated Session Management message other than PDU Session Release Command for the congested DNN associated to a running back-off timer, the UE shall stop the back-off timer and respond to the 5GC;\n-\tIf the UE receives a PDU Session Release Command message for the congested DNN, it shall stop the back-off timer unless it receives a new back-off time from SMF;\n-\tThe UE is allowed to initiate PDU Session Release procedure (i.e. sending PDU Session Release Request message). The UE shall not stop the back-off timer when the related PDU Session is released;\n-\tThe list above is not an exhaustive list, i.e. more details of the above actions and further conditions, if any, are specified in TS 24.501 [47].\nIf UE initiates one of the Session Management procedures that are exempted from NAS congestion control, the UE indicates that the carried NAS SM message is exempted from NAS congestion control in the UL NAS Transport message as described in TS 24.501 [47]. When the DNN based congestion control is activated at AMF, if the UE indicates that the NAS SM message in the UL NAS Transport message is exempted from NAS congestion control, the AMF shall not apply DNN based congestion control on the UL NAS Transport message and shall forward the NAS SM message to the corresponding SMF with an indication that the message was received with exemption indication. The SMF evaluates whether the NAS SM message is allowed to be exempted from DNN based congestion control. If it is not, the SMF rejects the message, e.g. the SMF shall reject PDU Session Modification received if it is not for Data Off status reporting).\nThe UE shall maintain a separate back-off timer for each DNN that the UE may use.\nTo avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select the back-off timer value so that deferred requests are not synchronized.\nIf the UE required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while DNN based congestion control was running and was unable to initiate SM signalling, the UE defers the related SM signalling until the DNN based congestion control timer expires and initiates the necessary SM signalling after the expiry of the timer.\nThe DNN based Session Management congestion control is applicable to the NAS SM signalling initiated from the UE in the Control Plane. The Session Management congestion control does not prevent the UE from sending and receiving data or initiating Service Request procedures for activating User Plane connection towards the DNN(s) that are under Session Management congestion control.\nS-NSSAI based congestion control is designed for the purpose of avoiding and handling of NAS signalling congestion for the UEs with back-off timer associated with or without an S-NSSAI regardless of the presence of a DNN.\nThe UE associates the received back-off time with the S-NSSAI and DNN (i.e. no S-NSSAI and no DNN, no S-NSSAI, S-NSSAI only, an S-NSSAI and a DNN) which was included in the uplink NAS MM message carrying the corresponding NAS SM request message for the PLMN which is under congestion.\nS-NSSAI based congestion control is applied as follows:\n-\tIf an S-NSSAI is determined as congested, then the SMF may apply S-NSSAI based congestion control towards the UE for SM requests except for those sent for the purpose of reporting 3GPP PS Data Off status change for a specific S-NSSAI and provides a back-off time and an indication of HPLMN congestion;\n-\tIf the UE receives an S-NSSAI based back-off time without an indication of HPLMN congestion, the UE shall apply the S-NSSAI back-off timer only in the PLMN in which the back-off time was received. If the UE receives S-NSSAI based back-off time with an indication of HPLMN congestion, the UE shall apply the S-NSSAI based back-off timer in the PLMN in which the back-off time was received and in any other PLMN;\n-\tThe SMF may release PDU Sessions belonging to a congested S-NSSAI by sending a PDU Session Release Request message towards the UE with a back-off time associated either to the S-NSSAI only (i.e. with no specific DNN) or a combination of the S-NSSAI and a specific DNN. If NWDAF is deployed, the SMF may make use of Session Management Congestion Control Experience analytics provided by NWDAF, as defined in clause 6.12 of TS 23.288 [86], to determine back-off timer provided to UEs;\nNOTE:\tFor example, the SMF can apply a short back-off timer to the UEs in the list of high-experienced UEs while the SMF can apply a long back-off timer to the UEs in the list of low-experienced UEs.\n-\tIf S-NSSAI based congestion control is activated at AMF e.g. configured by OAM and an S-NSSAI is determined as congested, then the AMF applies S-NSSAI based congestion control towards the UE for UE-initiated Session Management requests. In this case, the AMF provides a NAS Transport Error message for the NAS Transport message carrying the SM message, and in the NAS Transport Error message it includes a back-off timer; If NWDAF is deployed, the AMF may determine that S-NSSAI is congested based on the network slice load level analytics defined in TS 23.288 [86].\n-\tThe UE behaves as follows in the PLMN where the S-NSSAI based congestion control applies when the back-off timer is running:\n-\tIf the back-off timer was associated with an S-NSSAI only (i.e. not associated with an S-NSSAI and a DNN), the UE shall not initiate any Session Management procedures for the congested S-NSSAI;\n-\tIf the back-off timer was associated with an S-NSSAI and a DNN, then the UE shall not initiate any Session Management procedures for that combination of S-NSSAI and DNN;\n-\tIf the UE receives a network-initiated Session Management message other than PDU Session Release Command for the congested S-NSSAI, the UE shall stop this back-off timer and respond to the 5GC;\n-\tIf the UE receives a PDU Session Release Command message for the congested S-NSSAI, it shall stop the back-off timer unless it receives a new back-off time from SMF;\n-\tUpon Cell/TA/PLMN/RAT change, change of untrusted non-3GPP access network or change of Access Type, the UE shall not stop the back-off timer for any S-NSSAI or any combination of S-NSSAI and DNN;\n-\tThe UE is allowed to initiate the Session Management procedures for high priority access and emergency services for the S-NSSAI;\n-\tThe UE is allowed to initiate the Session Management procedure for reporting Data Off status change for the S-NSSAI or the combination of S-NSSAI and DNN.\n-\tIf the back-off timer is not associated to any S-NSSAI, the UE may only initiate Session Management procedures for specific S-NSSAI;\n-\tIf the back-off timer is not associated to any S-NSSAI and DNN, the UE may only initiate Session Management procedures for specific S-NSSAI and DNN;\n-\tThe UE is allowed to initiate PDU Session Release procedure (e.g. sending PDU Session Release Request message). The UE shall not stop the back-off timer when the related PDU Session is released;\n-\tThe list above is not an exhaustive list, i.e. more details of the above actions and further conditions, if any, are specified in TS 24.501 [47].\nThe UE shall maintain a separate back-off timer for each S-NSSAI and for each combination of S-NSSAI and DNN that the UE may use.\nIf UE initiates one of the Session Management procedure that are exempt from NAS congestion control, the UE indicates that the carried NAS SM message is exempted from NAS congestion control in the UL NAS Transport message as described in TS 24.501 [47]. When the S-NSSAI based congestion control is activated at AMF, if the UE indicates that the NAS SM message in the UL NAS Transport message is exempted from NAS congestion control, the AMF shall not apply S-NSSAI based congestion control on the UL NAS Transport message and shall forward the NAS SM message to the corresponding SMF with an indication that the message was received with exemption indication. The SMF evaluates whether that the NAS SM message is allowed to be exempted from S-NSSAI based congestion control. If it is not, the SMF rejects the message, e.g. the SMF shall reject PDU Session Modification received if it is not for Data Off status reporting.\nThe back-off timer associated with an S-NSSAI or a combination of an S-NSSAI and a DNN shall only apply to congestion control for Session Management procedures when UE is in 5GS.\nTo avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select the value of the back-off timer for the S-NSSAI based congestion control so that deferred requests are not synchronized.\nIf the UE required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while S-NSSAI based congestion control timer was running and was unable to initiate SM signalling, the UE defers the related SM signalling until the S-NSSAI based congestion control timer expires and initiates the necessary SM signalling after the expiry of the timer.\nThe S-NSSAI based congestion control does not prevent the UE from sending and receiving data or initiating Service Request procedure for activating User Plane connection for a PDU Session associated to the S-NSSAI that is under the congestion control.\nThe group specific NAS level congestion control applies to a specific group of UEs. Group specific NAS level congestion control is performed at the 5GC only, and it is transparent to UE. The AMF or SMF or both may apply NAS level congestion control for a UE associated to an Internal-Group Identifier (see clause 5.9.7).\nNOTE:\t5GC logic for Group specific NAS level congestion control is not described in this Release of the specification.\nUnder overload conditions the AMF may restrict requests from UEs for data transmission via Control Plane CIoT 5GS Optimisation. A Control Plane data back-off timer may be returned by the AMF (e.g. in Registration Accept messages, Service Reject message or Service Accept message). While the Control Plane data back-off timer is running, the UE shall not initiate any data transfer via Control Plane CIoT 5GS Optimisation, i.e. the UE shall not send any Control Plane Service Request with uplink data as defined in TS 24.501 [47]. The AMF shall store the Control Plane data back-off timer per UE and shall not process any further requests (other than exception reporting and a response to paging) for Data Transport via a Control Plane Service Request from that UE while the Control Plane data back-off timer is still running.\nNOTE 1:\tThe Control Plane data back-off timer does not affect any other mobility management or session management procedure.\nNOTE 2:\tThe Control Plane data back-off timer does not apply to user plane data communication.\nIf the UE is allowed to send exception reporting, the UE may send an initial NAS Message for exception reporting even if Control Plane data back-off timer is running.\nThe UE may respond to paging with an initial NAS Message without uplink data even if the Control Plane data back-off timer is running.\nIf the AMF receives an initial NAS Message in reponse to a paging, and the AMF has a Control Plane data back-off timer running for the UE, and the AMF is not overloaded, and AMF decides to accept the Control Plane Service Request, then the AMF shall respond with Service Accept without the Control Plane data back-off timer and stop the Control Plane data back-off timer. If the UE receives a Service Accept without the Control Plane data back-off timer from the AMF while the Control Plane data back-off timer is running, the UE shall stop the Control Plane data back-off timer. The Control Plane data back-off timer in the UE and the AMF is stopped at PLMN change.\nIf the AMF receives a Control Plane Service Request with uplink data, and decides to send the UE a Control Plane data back-off timer, the AMF may decide to process the Control Plane Service Request with uplink data, i.e. decrypt and forward the data payload, or not based on the following:\n-\tIf the UE has indicated Release Assistance Information that no further Uplink and Downlink Data transmissions are expected, then the AMF may process (integrity check/decipher/forward) the received Control Plane data packet, and send a Service Accept to the UE with Control Plane data back-off timer. The UE interprets this as successful transmission of the Control Plane data packet starts the Control Plane data back-off timer.\n-\tFor all other cases, the AMF may decide to not process the received Control Plane data packet and send a Service Reject to the UE with Control Plane data back-off timer. The UE interprets this indication as unsuccessful delivery of the control plane data packet and starts the Control Plane data back-off timer. The AMF may take into consideration whether the PDU Session is set to Control Plane only to make the decision whether to reject the packet and send Service Reject or move the PDU Session to user plane and process the data packet as described in next bullet.\n-\tAlternatively, if UE has not provided Release Assistance Information, and the PDU Session not set to Control Plane only, and UE supports N3 data transfer, then the AMF may initiate establishment of N3 bearer according to the procedure defined in clause 4.2.3 of TS 23.502 [3]. In this case the AMF may also return a Control Plane data back-off timer within the Service Accept.\nThe AMF only includes the Control Plane data back-off timer if the UE has indicated support for Control Plane CIoT 5GS optimizations in the Registration Request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.20\tExternal Exposure of Network Capability",
                    "description": "",
                    "summary": "",
                    "text_content": "The Network Exposure Function (NEF) supports external exposure of capabilities of network functions. External exposure can be categorized as Monitoring capability, Provisioning capability, Policy/Charging capability, Analytics reporting capability and Member UE selection capability. The Monitoring capability is for monitoring of specific event for UE in 5G System and making such monitoring events information available for external exposure via the NEF. The Provisioning capability is for allowing external party to provision of information which can be used for the UE in 5G System. The Policy/Charging capability is for handling access and mobility management, QoS and charging policies for the UE based on the request from external party. The Analytics reporting capability is for allowing an external party to fetch or subscribe/unsubscribe to analytics information generated by 5G System (this is further defined in TS 23.288 [86]). The Member UE selection capability is for allowing an external party to acquire one or more list(s) of candidate UE(s) (among the list of target member UE(s) provided by the AF) and additional information that is based on the assistance information generated by 5G System based on some defined filtering criteria, the details are explained in clause 4.15.13 in TS 23.502 [3].\nMonitoring capability is comprised of means that allow the identification of the 5G network function suitable for configuring the specific monitoring events, detect the monitoring event, and report the monitoring event to the authorised external party. Monitoring capability can be used for exposing UE's mobility management context such as UE location, reachability, roaming status, and loss of connectivity. Monitoring capability can also be used for exposing QoS monitoring result. AMF stores URRP-AMF information in the MM context to determine the NFs that are authorised to receive direct notifications from the AMF. UDM stores URRP-AMF information locally to determine authorised monitoring requests when forwarding indirect notifications. The Monitoring capability also allows AF to subscribe to the group status changes for a group, either a 5G VN group as described in clause 5.29.2, as well as a group configured by OA&M. In this case the AF is notified if the group member list is updated or a group member is no longer subscribed to the group.\nProvisioning capability allows an external party to provision the Expected UE Behaviour or the 5G-VN group information or DNN and S-NSSAI specific Group Parameters or ECS Address Configuration Information or service specific information to 5G NF via the NEF. The provisioning comprises of the authorisation of the provisioning external third party, receiving the provisioned external information via the NEF, storing the information, and distributing that information among those NFs that use it. The externally provisioned data can be consumed by different NFs, depending on the data. In the case of provisioning the Expected UE Behaviour, the externally provisioned information which is defined as the Expected UE Behaviour parameters in clause 4.15.6.3 of TS 23.502 [3] or Network Control parameter in clause 4.15.6.3a of TS 23.502 [3] consists of information on expected UE movement, Expected UE Behaviour parameters or expected Network Configuration parameter. The provisioned Expected UE Behaviour parameters may be used for the setting of mobility management or session management parameters of the UE. In the case of provisioning the 5G-VN group information the externally provisioned information is defined as the 5G-VN group parameters in clause 4.15.6.7 of TS 23.502 [3] and it consists of some information on the 5G-VN group. In the case of the provisioning the DNN and S-NSSAI specific Group Parameters, the externally provisioned information is defined in clause 4.15.6.14 of TS 23.502 [3] and clause 5.20b. In the case of provisioning ECS address, the externally provisioned information is defined as the ECS Address Configuration Information in clause 4.15.6.3d of TS 23.502 [3]. The affected NFs are informed via the subscriber data update as specified in clause 4.15.6.2 of TS 23.502 [3]. The externally provisioned information which is defined as the Service Parameters in clause 4.15.6.7 of TS 23.502 [3] consists of service specific information used for supporting the specific service in 5G system. The provisioned Service Parameters may be delivered to the UEs. The affected NFs are informed of the data update.\nPolicy/Charging capability is comprised of means that allow the request for session and charging policy, enforce QoS policy, apply accounting functionality and requests to influence access and mobility management policies. It can be used for specific QoS/priority handling for the session of the UE, and for setting applicable charging party or charging rate.\nAnalytics reporting capability is comprised of means that allow discovery of type of analytics that can be consumed by external party, the request for consumption of analytics information generated by NWDAF.\nMember UE selection capability is comprised of means that allows filtering and providing one or more list(s) of candidate UE(s) (among the list of target member UE(s) provided by the AF) and additional information that can be consumed by external party, the request for consumption of UE list generated by external party.\nAn NEF may support CAPIF functions for external exposure as specified in clause 6.2.5.1.\nAn NEF may support exposure of NWDAF analytics as specified in TS 23.288 [86].\nThe NEF may support exposure of 5GS and/or UE availability and capabilities for time synchronization service as specified in clause 5.27.1.8.\nAn NEF may support exposure of event based notifications and reports for NSACF as specified in clause 5.15.11.\nAn AF may only be able to identify the target UE of an AF request for external exposure of 5GC capabilities (e.g. Data Provisioning or for Event Exposure for a specific UE) by providing the UE's address information. In this case the NEF first needs to retrieve the Permanent identifier of the UE before trying to fulfil the AF request. The NEF may determine the Permanent identifier of the UE, as described in clause 4.15.3.2.13 of TS 23.502 [3], based on:\n-\tthe address of the UE as provided by the AF; this may be an IP address or a MAC address;\n-\tthe corresponding DNN and/or S-NSSAI information: this may have been provided by the AF or determined by the NEF based on the requesting AF; this is needed if the UE address is an IP address.\nThe NEF may provide an AF specific UE Identifier to the AF:\n-\tthat has explicitly requested a translation from the address of the UE to a unique UE identifier (via Nnef_UEId service); or\n-\tthat has implicitly requested a translation from the address of the UE to a AF specific UE Identifier by requesting external exposure about an individual UE identified by its address.\nThe AF may have its own means to maintain the AF specific UE Identifier through, e.g. an AF session. After the retrieval of an AF specific UE Identifier the AF shall not keep maintaining a mapping between this identifier and the UE IP address as this mapping may change.\nThe AF specific UE Identifier shall not correspond to a MSISDN; it is represented as a GPSI in the form of an External Identifier. When used as an AF specific UE identifier, the External Identifier provided by the 5GCN shall be different for different AF.\nNOTE 1:\tThis is to protect user privacy.\nNOTE 2:\tThe AF specific UE identifier is ensured to be unique across different AFs as defined in TS 23.003 [19] by configuration. Such configuration is assumed to be coordinated between the different involved entities (e.g. NEF(s) and UDM/UDR).\nNOTE 3:\tBased on policies, the NEF can be configured to enforce restriction on the usage of AF specific UE identifier (e.g. rejection of a service request from AF not authorized to use the UE identifier).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.20a\tData Collection from an AF",
                    "description": "",
                    "summary": "",
                    "text_content": "An NF that needs to collect data from an AF may subscribe/unsubscribe to notifications regarding data collected from an AF, either directly from the AF or via NEF.\nThe data collected from an AF is used as input for analytics by the NWDAF.\nThe details for the data collected from an AF as well as interactions between NEF, AF and NWDAF are described in TS 23.288 [86].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.20b\tSupport exposure of DNN and S-NSSAI specific Group Parameters",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.20b.1\tGroup attribute provisioning",
                            "text_content": "A group may be a 5G VN group managed as defined in clause 5.29.2, as well as a group configured by OA&M.\nAn AF may provision DNN and S-NSSAI specific attributes for a group of UEs:\n-\tLADN Service area, which consists of Tracking Area identities or geographical information, it is applicable to each UE member within the group and for a specific DNN and S-NSSAI.\n-\tDefault QoS, the QoS refers to 5QI, ARP and 5QI Priority Level as defined in clause 5.7.2.7 and it is applicable to each UE member within the group and for a specific DNN and S-NSSAI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.20b.2\tSupport LADN service area for a group",
                            "text_content": "The procedure as defined in clause 4.15.6.2 of TS 23.502 [3] is applicable for provisioning of LADN service area for a group with the following clarifications and enhancements:\n-\tThe AF request additionally contains the LADN service area as part of DNN and S-NSSAI specific Group Parameters, and the LADN service area is stored in UDR as subscription data and delivered to AMF. If the AMF receives the LADN service area for a group, the AMF configures the DNN of the group as LADN DNN.\n-\tIf the AF provides the LADN service area in the form of geographical information, the NEF maps the geographical information to a list of TAs before sending the service area to the UDM.\nLADN per DNN and S-NSSAI as defined in clause 5.6.5a is applicable for enforcement of LADN service area.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.20b.3\tSupport QoS for a group",
                            "text_content": "The procedure as defined in clause 4.15.6.2 of TS 23.502 [3] is applicable for provisioning of default QoS for a DNN and S-NSSAI for a group of UEs with the following clarifications and enhancements:\n-\tThe AF request contains the Default QoS for the group, and the UDM stores such QoS in the UDR and uses such QoS to set 5GS Subscribed QoS profile in Session Management Subscription data for each UE within the group.\nNOTE:\tWhen a UE belongs to multiple groups simultaneously, and AF(s) provision different Default QoS for the same DNN and S-NSSAI but different groups, UDM selects a QoS profile among the groups the UE belongs to for a DNN and S-NSSAI to set the 5GS subscribed QoS profile. How the UDM selects a QoS profile is based on implementation and configuration. The UDM can e.g. select a QoS profile with a higher 5QI Priority Level or higher ARP priority level.\nMechanisms as defined in clause 5.7.2.7 are used to enforce the 5GS Subscribed QoS profile for a DNN and S-NSSAI for each UE within a group.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.20b.4\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.20b.5\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.20c\tProvisioning of traffic characteristics and monitoring of performance characteristics for a group",
                    "description": "",
                    "summary": "",
                    "text_content": "NEF provisioning capability as defined in clause 5.20 allows an AF to perform provisioning of traffic characteristics and monitoring of performance characteristics for a group of UEs as specified in clause 4.15.6.14 of TS 23.502 [3] and clause 6.1.3.28 of TS 23.503 [45].\nNOTE :\tThe AF may use application layer functionalities to handle requests for UE-to-UE traffic as defined by SA WG6.\nThe NEF determines whether or not to invoke the TSCTSF in the same way as for AF session with required QoS procedure, as described in step 2 of clause 4.15.6.6 in TS 23.502 [3]. In the case that the TSCTSF is used, the TSCTSF receives the AF requested QoS information from the NEF. In the case that TSCTSF is not used, the AF request is handled as described in clause 4.15.6.14 of TS 23.502 [3] and clause 6.1.3.28 of TS 23.503 [45].\nWhen the TSCTSF receives the AF requested QoS information from NEF or the PCF(s) receive the AF requested QoS information from UDR, the TSCTSF or PCF (s) manage the AF requested QoS information for each UE group member within the group as follows:\n-\tTranslate the External Group ID into a list of SUPIs by invoking Nudm_SDM_Get service.\n-\tDetermine which of these UE group members have active PDU Sessions matching the DNN and S-NSSAI and determine the relevant UE address.\n-\tManage the request status (activated, de-activated, failed) for each UE group member within the group:\n-\tApply the AF requested QoS information if the UE group member is registered or has active PDU Session matching the DNN and S-NSSAI. Set the status to activated if the QoS resources are assigned for the UE group member, otherwise, failed.\n-\tSet the status to de-activated if the UE group member is not registered or has no active PDU Session matching the DNN and S-NSSAI.\n-\tDelete the request status for the UE group member if the UE group member is removed from the group, and further revokes AF request QoS information if the request status is activated.\n-\tCheck whether to apply the AF requested QoS information and update the request status for the UE group member if the UE group member is newly added to the group.\n-\tWhen the AF requested QoS information contains temporal invalidity condition:\n-\tRevoke AF requested QoS information for each UE group member which is marked as active, so to e.g. to remove or modify PCC rules as defined in clause 4.16.5.2 of TS 23.502 [3] if the start-time is reached.\n-\tApply AF requested QoS information for each UE group member that has active PDU Sessions matching the DNN and S-NSSAI, e.g. to add or modify PCC rules as defined in clause 4.16.5.2 of TS 23.502 [3].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.20d\tUser Plane Direct 5GS Information Exposure",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.20d.1\tGeneral",
                            "text_content": "In order to expose network information, the user plane direct 5GS information exposure function may be applied. The user plane direct 5GS information exposure function allows the UPF to report the network information directly to consumer based on the instructions provided by SMF.\nNOTE:\tIn the scenario of Edge Computing as described in TS 23.548 [130], the consumer can be the L-NEF or local AF when the local AF is trusted.\nWhen the exposed network information is provided by the UPF, the PSA UPF may be instructed to report network information via Nupf_EventExposure service (e.g. directly to an AF, i.e. bypassing the SMF and the PCF); or the UPF may be instructed to report the information to the consumer via SMF/PCF/NEF, as described in clause 5.8.2.18.\nWhen the exposed network information is provided by the NG-RAN, the NG-RAN may be instructed by the SMF to report the information via the GTP-U tunnel(s) between the NG RAN and PSA UPF, as defined in clause 5.45.\nThe User Plane Direct 5GS Information Exposure may be used for exposing the following information:\n-\tQoS Monitoring information (see clause 5.45).\n-\tTSC Management Information (see clause 5.28.3).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.21\tArchitectural support for virtualized deployments",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.21.0\tGeneral",
                            "text_content": "5GC supports different virtualized deployment scenarios, including but not limited to the options below:\n-\tA Network Function instance can be deployed as distributed, redundant, stateless, and scalable NF instance that provides the services from several locations and several execution instances in each location.\n-\tThis type of deployments would typically not require support for addition or removal of NF instances for redundancy and scalability. In the case of an AMF this deployment option may use enablers like, addition of TNLA, removal of TNLA, TNLA release and rebinding of NGAP UE association to a new TNLA to the same AMF.\n-\tA Network Function instance can also be deployed such that several network function instances are present within a NF set provide distributed, redundant, stateless and scalability together as a set of NF instances.\n-\tThis type of deployments may support for addition or removal of NF instances for redundancy and scalability. In the case of an AMF this deployment option may use enablers like, addition of AMFs and TNLAs, removal of AMFs and TNLAs, TNLA release and rebinding of NGAP UE associations to a new TNLA to different AMFs in the same AMF set.\n-\tThe SEPP, although not a Network Function instance, can also be deployed distributed, redundant, stateless, and scalable.\n-\tThe SCP, although not a Network Function instance, can also be deployed distributed, redundant, and scalable.\nAlso, deployments taking advantage of only some or any combination of concepts from each of the above options is possible.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.21.1\tArchitectural support for N2",
                            "text_content": "5G-AN node shall have the capability to support multiple TNL associations per AMF, i.e. AMF name.\nAn AMF shall provide the 5G-AN node with the weight factors for each TNL association of the AMF.\nThe AMF shall be able to request the 5G-AN node to add or remove TNL associations to the AMF.\nThe AMF shall be able to indicate to the 5G-AN node the set of TNL associations used for UE-associated signalling and the set of TNL associations used for non-UE associated signalling.\nNOTE: The TNL association(s) indicated for UE-associated and non-UE associated signalling can either be overlap or be different.\nWhile a UE is in CM-Connected state the 5G-AN node shall maintain the same NGAP UE-TNLA-binding (i.e. use the same TNL association and same NGAP association for the UE) unless explicitly changed or released by the AMF.\nAn AMF shall be able to update the NGAP UE-TNLA-binding (i.e. change the TNL association for the UE) in CM-CONNECTED state at any time. The NGAP UE-TNLA-binding can also be updated when a UE-specific NGAP message initiated by AMF is received via a new TNL association.\nAn AMF shall be able to update the NGAP UE-TNLA-binding (i.e. change the TNL association for the UE) in response to an N2 message received from the 5G-AN by triangular redirection (e.g. by responding to the 5G-AN node using a different TNL association).\nAn AMF shall be able to command the 5G-AN node to release the NGAP UE-TNLA-binding for a UE in CM-CONNECTED state while maintaining N3 (user-plane connectivity) for the UE at any time.\nThe 5G-AN node shall consider the following factors for selecting a TNL association for the AMF for the initial N2 message e.g. N2 INITIAL UE MESSAGE:\n-\tAvailability of candidate TNL associations.\n-\tWeight factors of candidate TNL associations.\nThe AMF may use any TNL association intended for non-UE associated signalling for initiation of the N2 Paging procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.21.2\tAMF Management",
                            "text_content": "The 5G System should support establishment of association between AMF and 5G-AN node.\nA new AMF can be added to an AMF set and association between AMF and GUAMI can be created and/or updated as follows:\n-\tAMF shall be able to dynamically update the NRF with the new or updated GUAMI(s) to provide mapping between GUAMI(s) and AMF information. Association between GUAMI(s) and AMF is published to NRF. In addition, to deal with planned maintenance and failure, an AMF may optionally provide backup AMF information, i.e. it act as a backup AMF if the indicated GUAMI associated AMF is unavailable. It is assumed that the backup AMF and the original AMF are in the same AMF set as they have access to the same UE context. Based on that information one GUAMI is associated with an AMF, optionally with a backup AMF used for planned removal and/or another (same or different) backup AMF used for failure.\n-\tUpon successful update, the NRF considers the new and/or updated GUAMI(s) for providing AMF discovery results to the requester. Requester can be other CP network functions.\n-\tThe new AMF provides its GUAMI to 5G-AN and 5G-AN store this association. If the association between the same GUAMI and another AMF exists in the 5G-AN (e.g. due to AMF planned removal), the previously stored AMF is replaced by the new AMF for the corresponding GUAMI association.\nInformation about new AMF should be published and available in the DNS system. It should allow 5G-AN to discover AMF and setup associations with the AMF required. N2 setup procedure should allow the possibility of AMFs within the AMF Set to advertise the same AMF Pointer and/or distinct AMF Pointer value(s) to the 5G-AN node.\nTo support the legacy EPC core network entity (i.e. MME) to discover and communicate with the AMF, the information about the AMF should be published and available in the DNS system. Furthermore, GUMMEI and GUAMI encoding space should be partitioned to avoid overlapping values in order to enable MME discover an AMF without ambiguity.\nAn AMF can be taken graciously out of service as follows:\n-\tIf an UDSF is deployed in the network, then the AMF stores the context for registered UE(s) in the UDSF. The UE context includes the AMF UE NGAP ID that is unique per AMF set. In order for the AMF planned removal procedure to work graciously, 5G-S-TMSI shall be unique per AMF Set. If there are ongoing transactions (e.g. N1 procedure) for certain UE(s), AMF stores the UE context(s) in the UDSF upon completion of an ongoing transaction.\n-\tThe AMF deregister itself from NRF indicating due to AMF planned removal.\nNOTE 1:\tIt is assumed that the UE contexts from the old AMF include all event subscriptions with peer CP NFs.\nNOTE 2: Before removal of AMF the overload control mechanism can be used to reduce the amount of ongoing transaction.\nAn AMF identified by GUAMI(s) shall be able to notify the 5G-AN that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF. Upon receipt of the indication that an AMF(identified by GUAMI(s)) is unavailable, 5G-AN shall take the following action:\n-\t5G-AN should mark this AMF as unavailable and not consider the AMF for selection for subsequent N2 transactions until 5G-AN learns that it is available (e.g. as part of discovery results or by configuration).\n-\tDuring NGAP Setup procedure, the AMF may include an additional indicator that the AMF will rebind or release the NGAP UE-TNLA-binding on a per UE-basis for UE(s) in CM-CONNECTED state. If that indicator is included and the 5G-AN supports timer mechanism, the 5G-AN starts a timer to control the release of NGAP UE-TNLA-binding. For the duration of the timer or until the AMF releases or re-binds the NGAP UE-TNLA-binding the AN does not select a new AMF for subsequent UE transactions. Upon timer expiry, the 5G-AN releases the NGAP UE UE-TNLA-binding(s) with the corresponding AMF for the respective UE(s), for subsequent N2 message, the 5G-AN should select a different AMF from the same AMF set when the subsequent N2 message needs to be sent.\nNOTE 3:\tFor UE(s) in CM-CONNECTED state, after indicating that the AMF is unavailable for processing UE transactions and including an indicator that the AMF releases the NGAP UE-TNLA-binding(s) on a per UE-basis, the AMF can either trigger a re-binding of the NGAP UE associations to an available TNLA on a different AMF in the same AMF set or use the NGAP UE-TNLA-binding per UE release procedure defined in TS 23.502 [3] to release the NGAP UE-TNLA-binding on a per UE-basis while requesting the AN to maintain N3 (user plane connectivity) and UE context information.\nNOTE 4:\tThe support and the use of timer mechanism in 5G-AN is up to implementation.\n-\tIf the instruction does not include the indicator, for UE(s) in CM-CONNECTED state, 5G-AN considers this as a request to release the NGAP UE-TNLA-binding with the corresponding AMF for the respective UE(s) while maintaining N3 (user plane connectivity) and UE context information. For subsequent N2 message, the 5G-AN should select a different AMF from the same AMF set when the subsequent N2 message needs to be sent.\n-\tFor UE(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS message with a 5G S-TMSI or GUAMI pointing to an AMF that is marked unavailable, the 5G-AN should select a different AMF from the same AMF set and forward the initial NAS message. If the 5G-AN can't select an AMF from the same AMF set, the 5G-AN selects another new AMF as described in clause 6.3.5.\nAn AMF identified by GUAMI(s) shall be able to instruct other peer CP NFs, subscribed to receive such a notification, that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF. If the CP NFs register with NRF for AMF unavailable notification, then the NRF shall be able to notify the subscribed NFs to receive such a notification that AMF identified by GUAMI(s) will be unavailable for processing transactions. Upon receipt of the notification that an AMF (GUAMI(s)) is unavailable, the other CP NFs shall take the following actions:\n-\tCP NF should mark this AMF (identified by GUAMI(s)) as unavailable and not consider the AMF for selection for subsequent MT transactions until the CP NF learns that it is available (e.g. as part of NF discovery results or via NF status notification from NRF).\n-\tMark this AMF as unavailable while not changing the status of UE(s) associated to this AMF (UE(s) previously served by the corresponding AMF still remain registered in the network), and AMF Set information.\n-\tFor the UE(s) that were associated to the corresponding AMF, when the peer CP NF needs to initiate a transaction towards the AMF that is marked unavailable, CP NF should select another AMF from the same AMF set (as in clause 6.3.5) and forward the transaction together with the old GUAMI. The new AMF retrieves UE context from the UDSF. If CP NF needs to send a notification to new AMF which is associated with a subscription from the old AMF, the CP NF shall exchange the old AMF information embedded in the Notification Address with the new AMF information, and use that Notification Address for subsequent communication.\nNOTE 5:\tIf the CP NF does not subscribe to receive AMF unavailable notification (either directly from the AMF or via NRF), the CP NF may attempt forwarding the transaction towards the old AMF and detect that the AMF is unavailable after certain number of attempts. When it detects unavailable, it marks the AMF and its associated GUAMI(s) as unavailable. CP NF should select another AMF from the same AMF set (as in clause 6.3.5) and forward the transaction together with the old GUAMI. The new AMF retrieves UE context from the UDSF and process the transaction.\nFollowing actions should be performed by the newly selected AMF:\n-\tWhen there is a transaction with the UE the newly selected AMF retrieves the UE context from the UDSF based on SUPI, 5G-GUTI or AMF UE NGAP ID and processes the UE message accordingly and updates the 5G-GUTI towards the UE, if necessary. For UE(s) in CM-CONNECTED state, it may also update the NGAP UE association with a new AMF UE NGAP ID towards the 5G-AN and replace the GUAMI in the UE context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF if the 5G-GUTI has been updated. The AMF also informs the NG-RAN of the new UE Identity Index Value (derived from the new 5G-GUTI).\n-\tWhen there is a transaction with the UE, the new selected AMF updates the peer NFs (that subscribed to receive AMF unavailability notification from old AMF), with the new selected AMF information.\n-\tIf the new AMF is aware of a different AMF serving the UE (by implementation specific means) it forwards the uplink N2 signalling of the UE to that AMF directly if necessary, the 5G-AN shall be able to receive the message from a different AMF, or it rejects the transaction from the peer CP NFs with a cause to indicate that new AMF has been selected, the peer CP NFs resend the transaction to the new AMF.\nNOTE 6:\tThis bullet above addresses situations where 5G-AN node selects an AMF and CP NFs select another AMF for the UE concurrently. It also addresses the situation where CP NFs select an AMF for the UE concurrently\n-\tIf the UE is in CM-IDLE state and the new AMF does not have access to the UE context, the new AMF selects one available AMF from the old AMF set as described in clause 6.3.5. The selected AMF retrieves the UE context from the UDSF and provides the UE context to the new AMF. If the new AMF doesn't receive the UE context then the AMF may force the UE to perform Initial Registration.\nAn AMF can be taken graciously out of service as follows:\n-\tThe AMF can forward registered UE contexts, UE contexts grouped by the same GUAMI value, to target AMF(s) within the same AMF set, including the source AMF name used for redirecting UE's MT transaction. The UE context includes the per AMF Set unique AMF UE NGAP ID. In order for the AMF planned removal procedure to work graciously, 5G-S-TMSI shall be unique per AMF set. If there are ongoing transactions (e.g. N1 procedure) for certain UE(s), AMF forwards the UE context(s) to the target AMF upon completion of an ongoing transaction.\n-\tThe AMF deregister itself from NRF indicating due to AMF planned removal.\nNOTE 1:\tIt is assumed that the UE contexts from the old AMF include all event subscriptions with peer CP NFs.\nNOTE 2: Before removal of AMF the overload control mechanism can be used to reduce the amount of ongoing transaction.\nAn AMF shall be able to instruct the 5G-AN that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF and its corresponding target AMF(s). The target AMF shall be able to update the 5G-AN that the UE(s) served by the old GUAMI(s) are now served by target AMF. The target AMF provides the old GUAMI value that the 5G-AN can use to locate UE contexts served by the old AMF. Upon receipt of the indication that an old AMF is unavailable, 5G-AN shall take the following action:\n-\t5G-AN should mark this AMF as unavailable and not consider the AMF for selection for subsequent N2 transactions until 5G-AN learns that it is available (e.g. as part of discovery results or by configuration). The associated GUAMIs are marked as unavailable.\n-\tDuring NGAP Setup, the AMF may include an additional indicator that the AMF will rebind or release the NGAP UE-TNLA-binding on per UE-basis. If that indicator is included and the 5G-AN supports timer mechanism, the 5G-AN starts a timer to control the release of NGAP UE-TNLA-binding(s). For the duration of the timer or until the AMF releases or re-binds the NGAP UE-TNLA-binding, the AN does not select a new AMF for subsequent transactions. Upon timer expiry, the 5G-AN releases the NGAP UE-TNLA-binding(s) with the corresponding AMF for the respective UE(s), for subsequent N2 message, the 5G-AN uses GUAMI which points to the target AMF that replaced the old unavailable AMF, to forward the N2 message to the corresponding target AMF(s).\nNOTE 3:\tFor UE(s) in CM-CONNECTED state, after indicating that the AMF is unavailable for processing UE transactions and including an indicator that the AMF releases the NGAP UE-TNLA-binding on a per UE-basis, the AMF can either trigger a re-binding of the NGAP UE associations to an available TNLA on a different AMF within the same AMF set or use the NGAP UE-TNLA-binding per UE release procedure defined in TS 23.502 [3] to release the NGAP UE-TNLA-binding on a per UE-basis while requesting the AN to maintain N3 (user plane connectivity) and UE context information.\nNOTE 4:\tThe support and the use of timer mechanism in 5G-AN is up to implementation.\nIf the instruction does not include the indicator, for UE(s) in CM-CONNECTED state, 5G-AN considers this as a request to release the NGAP UE UE-TNLA-binding(s) with the corresponding AMF for the respective UE(s) while maintaining N3 (user plane connectivity) and UE context information. For subsequent N2 message, the 5G-AN uses GUAMI based resolution which points to the target AMF that replaced the old unavailable AMF, to forward the N2 message to the corresponding target AMF(s).\n-\tFor UE(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS message with a 5G S-TMSI or GUAMI, based resolution the 5G-AN uses 5G S-TMSI or GUAMI which points to the target AMF that has replaced the old unavailable AMF and, the 5G-AN forwards N2 message.\nAn AMF shall be able to instruct other peer CP NFs, subscribed to receive such a notification, that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF and its corresponding target AMF(s). The target AMF shall update the CP NF that the old GUAMI(s) is now served by target AMF. The old AMF provides the old GUAMI value to target AMF and the target AMF can use to locate UE contexts served by the old AMF. If the CP NFs register with NRF for AMF unavailable notification, then the NRF shall be able to notify the subscribed NFs to receive such a notification (along with the corresponding target AMF(s)) that AMF identified by GUAMI(s) will be unavailable for processing transactions. Upon receipt of the notification that an AMF is unavailable, the other CP NFs shall take the following action:\n-\tMark this AMF and its associated GUAMI(s) as unavailable while not changing the status of UE(s) associated to this AMF (UE(s) previously served by the corresponding AMF still remain registered in the network), and AMF Set information.\n-\tFor the UE(s) that were associated to the corresponding AMF, when the peer CP NF needs to initiate a transaction towards the AMF that is marked unavailable and the old unavailable AMF was replaced by the target AMF, CP NF should forward the transaction together with the old GUAMI to the target AMF(s). If CP NF needs to send a notification to new AMF which is associated with a subscription from the old AMF, the CP NF shall exchange the old AMF information embedded in the Notification Address with the new AMF information, and use that Notification Address for subsequent communication.\nNOTE 5:\tIf the CP NF does not subscribe to receive AMF unavailable notification (either directly with the AMF or via NRF), the CP NF may attempt forwarding the transaction towards the old AMF and detect that the AMF is unavailable after certain number of attempts. When it detects unavailable, it marks the AMF and its associated GUAMI(s) as unavailable.\nThe following actions should be performed by the target AMF:\n-\tTo allow AMF process ongoing transactions for some UE(s) even after it notifies unavailable status to the target AMF, the target AMF keeps the association of the old GUAMI(s) and the old AMF for a configured time. During that configured period, if target AMF receives the transaction from the peer CP NFs and cannot locate UE context, it rejects the transaction with old AMF name based on that association, and the indicated AMF is only used for the ongoing transaction. The peer CP NFs resend the transaction to the indicated AMF only for the ongoing transaction. For subsequent transactions, peer CP NFs should use the target AMF. When the timer is expired, the target AMF deletes that association information.\n-\tWhen there is a transaction with the UE the target AMF uses SUPI, 5G-GUTI or AMF UE NGAP ID to locate UE contexts and processes the UE transactions accordingly and updates the 5G-GUTI towards the UE, if necessary. For UE(s) in CM-CONNECTED state, it may also update the NGAP UE association with a new AMF UE NGAP ID towards the 5G-AN and replace the GUAMI in the UE context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF if the 5G-GUTI has been updated. The AMF also informs the NG-RAN of the new UE Identity Index Value (derived from the new 5G-GUTI).\n-\tTarget AMF shall not use old GUAMI to allocate 5G-GUTI for UE(s) that are being served by Target AMF.\nIn order to try and handle AMF failure in a graceful manner (i.e. without impacting the UE), AMF can either back up the UE contexts in UDSF, or per GUAMI granularity in other AMFs (serving as backup AMF for the indicated GUAMI).\nNOTE 1:\tFrequency of backup is left to implementation.\nFor deployments without UDSF, for each GUAMI the backup AMF information (in association to the GUAMI) is configured in the AMF. The AMF sends this information to 5G-AN and other CP NFs during the N2 setup procedure or the first (per NF) interaction with other CP NFs.\nIn the case that an AMF fails and the 5G-AN/peer CP NFs detect that the AMF has failed, or the 5G-AN/peer CP NFs receives notification from another AMF in the same AMF set that this AMF has failed, following actions are taken:\n-\tThe OAM deregister the AMF from NRF indicating due to AMF failure.\n-\t5G-AN marks this AMF as failed and not consider the AMF for selection until explicitly notified.\n-\tFor UE(s) in CM-CONNECTED state, 5G-AN considers failure detection or failure notification as a trigger to release the NGAP UE-TNLA-binding(s) with the corresponding AMF for the respective UE(s) while maintaining N3 (user plane connectivity) and other UE context information. For subsequent N2 message, if the backup AMF information of the corresponding failed AMF is not available the 5G-AN should select a different AMF (as in clause 6.3.5) from the same AMF set when the subsequent N2 message needs to be sent for the UE(s). If no other AMF from the AMF set is available, then it can select an AMF (implementation dependent) from the same AMF Region as in clause 6.3.5. If backup AMF information of the corresponding failed AMF is available, the 5G-AN forwards the N2 message to the backup AMF.\nNOTE 2:\tOne AMF in the AMF set may be configured to send this failure notification message.\n-\tFor UE(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS message with a S-TMSI or GUAMI pointing to an AMF that is marked failed, if the backup AMF information of the corresponding failed AMF is not available the 5G-AN should select a different AMF from the same AMF set and forward the initial NAS message. If no other AMF from the AMF set is available, then it can select an AMF (implementation dependent) from the same AMF Region as in clause 6.3.5. If backup AMF information of the corresponding failed AMF is available, the 5G-AN forwards the N2 message to the backup AMF.\n-\tPeer CP NFs consider this AMF as unavailable while retaining the UE context.\n-\tFor the UE(s) that were associated to the corresponding AMF, when the peer CP NF needs to initiate a transaction towards the AMF, if backup AMF information of the corresponding failed AMF is not available, CP NF should select another AMF from the same AMF set and forward the transaction together with the old GUAMI. If neither the backup AMF nor any other AMF from the AMF set is available, then CP NF can select an AMF from the same AMF Region as in clause 6.3.5. If backup AMF information of the corresponding failed AMF is available, the CP NF forwards transaction to the backup AMF. If CP NF needs to send a notification to new AMF which is associated with a subscription from the old AMF, the CP NF shall exchange the old AMF information embedded in the Notification Address with the new AMF information, and use that Notification Address for subsequent communication.\n-\tWhen the 5G-AN or CP NFs need to select a different AMF from the same AMF set,\n-\tFor deployments with UDSF, any AMF from the same AMF set can be selected.\n-\tFor deployments without UDSF, the backup AMF is determined based on the GUAMI of the failed AMF.\nFollowing actions should be taken by the newly selected AMF:\n-\tFor deployments with UDSF, when there is a transaction with the UE the newly selected AMF retrieves the UE context from the UDSF using SUPI, 5G-GUTI or AMF UE NGAP ID and it processes the UE message accordingly and updates the 5G-GUTI towards the UE, if necessary.\n-\tFor deployments without UDSF, backup AMF (the newly selected AMF), based on the failure detection of the old AMF, instructs peer CP NFs and 5G-AN that the UE contexts corresponding to the GUAMI of the failed AMF is now served by this newly selected AMF. The backup AMF shall not use old GUAMI to allocate 5G-GUTI for UE(s) that are being served by Target AMF. The backup AMF uses the GUAMI to locate the respective UE Context(s).\n-\tWhen there is a transaction with the UE, the new AMF updates the peer NFs (that subscribed to receive AMF unavailability notification from old AMF) with the new AMF information.\n-\tIf the new AMF is aware of a different AMF serving the UE (by implementation specific means) it redirects the uplink N2 signalling to that AMF, or reject the transaction from the peer CP NFs with a cause to indicate that new AMF has been selected. The peer CP NFs may wait for the update from the new AMF and resend the transaction to the new AMF.\nNOTE 3:\tThis bullet above addresses situations where 5G-AN node selects an AMF and other CP NFs select an AMF for the UE concurrently. It also addresses the situation where CP NFs select an AMF for the UE concurrently.\nNOTE 4:\tIt is assumed that the UE contexts from the old AMF include all event subscriptions with peer CP NFs.\n-\tIf the UE is in CM-IDLE state and the new AMF does not have access to the UE context, the new AMF selects one available AMF from the old AMF set as described in clause 6.3.5. The selected AMF retrieves the UE context from the UDSF and provides the UE context to the new AMF. If the new AMF doesn't receive the UE context then the AMF may force the UE to perform Initial Registration.\n-\tIf the UE is in CM-CONNECTED state, the new AMF may also update the NGAP UE association with a new AMF UE NGAP ID towards the 5G-AN and replace the GUAMI in the UE context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF if the 5G-GUTI has been updated.\nNOTE 5:\tThe above N2 TNL association selection and AMF management is applied to the selected PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.21.3\tNetwork Reliability support with Sets",
                            "text_content": "A Network Function instance can be deployed such that several network function instances are present within an NF Set to provide distribution, redundancy and scalability together as a Set of NF instances. The same is also supported for NF Services. This can be achieved when the equivalent NFs and NF Services share the same context data or by Network Function/NF Service Context Transfer procedures as specified in clause 4.26 of TS 23.502 [3].\nNOTE:\tA NF can be replaced by an alternative NF within the same NF Set in the case of scenarios such as failure, load balancing, load re-balancing.\nSuch a network reliability design shall work in both communication modes, i.e. Direct Communication and Indirect Communication. In the Direct Communication mode, the NF Service consumer is involved in the reliability related procedures. In Indirect Communication mode, the SCP is involved in the reliability related procedures.\nEquivalent Control Plane NFs may be grouped into NF Sets, e.g. several SMF instances are grouped into an SMF Set. NFs within a NF Set are interchangeable because they share the same context data, and may be deployed in different locations, e.g. different data centres.\nIn the case of SMF, multiple instances of SMFs within an SMF Set need to be connected to the same UPF:\n-\tIf the N4 association is established between a SMF instance and an UPF, each N4 association is only managed by the related SMF instance.\n-\tIf only one N4 association is established between a SMF Set and an UPF, any SMF in the SMF Set should be able to manage the N4 association with the UPF.\nFurthermore, for a given UE and PDU Session any SMF in the SMF Set should be able to control the N4 session with the UPF (however, at any given time, only one SMF in the SMF Set will control the UPF for a given UE's PDU Session).\nA Control Plane NF is composed of one or multiple NF Services. Within a NF a NF service may have multiple instances. These multiple NF Service instances can be grouped into NF Service Set if they are interchangeable with each other because they share the same context data.\nNOTE:\tThe actual mapping of instances to a given Set is up to deployment.\nThe NF producer instance is the NF instance which host the NF Service Producer. When the NF producer instance is not available, another NF producer instance within the same NF Set is selected.\nFor Direct Communication mode, the NF Service consumer may subscribe to status change notifications of NF instance from the NRF. If the NF Service consumer is notified by the NRF or detects by itself (e.g. request is not responded) that the NF producer instance is not available anymore, another available NF producer instance within the same NF Set is selected by the NF Service consumer.\nFor Indirect Communication mode, the SCP or NF Service consumer may subscribe to status change notifications of NF instance from the NRF and selects another NF producer instance within the same NF Set if the original NF producer instance serving the UE is not available anymore.\nNOTE:\tIt is up to the implementation on how the SCP knows a NF producer instance is not available anymore.\nWhen multiple NF Service instances within a NF Service Set are exposed to the NF Service consumer or SCP and the failure of NF Service instance is detected or notified by the NRF, i.e. it is not available anymore, the NF Service consumer or SCP selects another NF Service instance of the same NF Service Set within the NF instance, if available. Otherwise the NF Service consumer or SCP selects a different NF instance within the same NF Set.\nNOTE:\tThe NF Producer instance can change the NF Service instance in the response to the service request.\nWhen multiple NF Service instances within a NF Service Set are exposed to the NF Service consumer or SCP as a single NF Service, the reliability, i.e. the selection of an alternative NF Service instance is handled within the NF instance.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.21.4\tNetwork Function/NF Service Context Transfer",
                            "text_content": "Network Function/NF Service Context Transfer Procedures allow transfer of Service Context of a NF/NF Service from a Source NF/NF Service Instance to the Target NF/NF Service Instance e.g. before the Source NF/NF Service can gracefully close its NF/NF Service. Service Context Transfer procedures are supported as specified in clause 4.26 of TS 23.502 [3].\nSource NF / OA&M system determines when Source NF needs to transfer UE contexts to an NF in another NF set. Source NF should initiate this only for UE(s) that are not active in order to limit and avoid impacting services offered to corresponding UE(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.22\tSystem Enablers for priority mechanism",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.22.1\tGeneral",
                            "text_content": "The 5GS and the 5G QoS model allow classification and differentiation of specific services such as listed in clause 5.16, based on subscription-related and invocation-related priority mechanisms. These mechanisms provide abilities such as invoking, modifying, maintaining, and releasing QoS Flows with priority, and delivering QoS Flow packets according to the QoS characteristics under network congestion conditions.\nSubscription-related Priority Mechanisms include the ability to prioritize flows based on subscription information, including the prioritization of RRC Connection Establishment based on Unified Access Control mechanisms and the establishment of prioritized QoS Flows.\nInvocation-related Priority Mechanisms include the ability for the service layer to request/invoke the activation of prioritized QoS Flows through an interaction over Rx/N5 and packet detection in the UPF.\nQoS Mechanisms applied to established QoS Flows include the ability to fulfil the QoS characteristics of QoS Flows through preservation of differentiated treatment for prioritized QoS Flow and resource distribution prioritization.\nMessages associated with priority services that are exchanged over service-based interfaces may include a Message Priority header to indicate priority information, as specified in TS 23.502 [3] and TS 29.500 [49].\nIn addition, the separation of concerns between the service classification provided by the core network through the association of Service Data Flows to QoS, and the enforcing of QoS differentiation in (R)AN through the association of QoS Flows to Data Radio bearers, supports the prioritization of QoS Flows when a limitation of the available data radio bearers occurs.\nIn addition, it also includes the ability for the service layer to provide instructions on how to perform pre-emption of media flows with the same priority assigned through an interaction over Rx as defined in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.22.2\tSubscription-related Priority Mechanisms",
                            "text_content": "Subscription-related mechanisms which are always applied:\n-\t(R)AN: During initial Access Network Connection Establishment, the Establishment Cause is set to indicate that special treatment is to be applied by the (R)AN in the radio resource allocation as specified in clause 5.2 for 3GPP access.\n-\tUDM: As defined in clause 5.2.3 of TS 23.502 [3], the UE subscription data in the UDM contains an MPS subscription indication (i.e. MPS priority) and an MCX subscription indication (i.e. MCX priority) for the UE that has subscription to MPS and MCX, respectively. The MPS priority and the MCX priority, if available, are provided to the AMF via the Registration or the UE Configuration Update procedure as defined in clause 4.2 of TS 23.502 [3].\n-\tAMF: Following Access Network Connection Establishment, the receipt of the designated Establishment Cause (i.e. high priority access) by the AMF will result in priority handling of the \"Initial UE Message\" received as part of the Registration procedures of clause 4.2.2 of TS 23.502 [3]. If the AMF did not receive a designated Establishment Cause (i.e. high priority access), but when the AMF determines that there is a MPS priority (or MCX priority) in the UDM for that UE, the AMF shall provide priority handling for that UE at that time and shall provide the MPS priority (or MCX priority) to the UE via the Registration or the UE Configuration Update procedure, as defined in clause 4.2 of TS 23.502 [3]. In addition, certain exemptions to Control Plane Congestion and Overload Control are provided as specified in clause 5.19.\nSubscription-related mechanisms which are conditionally applied:\n-\tUE: When barring control parameters are broadcast by the RAN, access barring based on Access Identity(es) configured in the USIM and/or an Access Category is applied prior to an initial upstream transmission for the UE which provides a mechanism to limit transmissions from UEs categorized as non-prioritized, while allowing transmissions from UEs categorized as prioritized (such as MPS subscribed UEs), during the RRC Connection Establishment procedure as specified in clause 5.2.\n-\tUDM: One or more ARP priority levels are assigned for prioritized or critical services. The ARP of the prioritized QoS Flows for each DN is set to an appropriate ARP priority level. The 5QI is from the standard value range as specified in clause 5.7.2.7. In addition, Priority Level may be configured for the standardized 5QIs, and if configured, it overwrites the default value specified in the QoS characteristics Table 5.7.4-1.\n-\tPCF: The \"IMS Signalling Priority\" information is set for the subscriber in the UDM, and the PCF modifies the ARP of the QoS Flow used for IMS signalling, for each DN which supports prioritized services leveraging on IMS signalling, to an appropriate ARP priority level assigned for that service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.22.3\tInvocation-related Priority Mechanisms",
                            "text_content": "The generic mechanisms used based on invocation-related Priority Mechanisms for prioritised services are based an interaction with an Application Function and between the Application Function and the PCF over Rx/N5 interface.\nThese mechanisms apply to mobile originated as well as mobile terminated SIP call/sessions (clause 5.21 of TS 23.228 [15]) and Priority PDU connectivity services including MPS for Data Transport Service.\nNOTE 1:\tClause 5.21 of TS 23.228 [15] is applicable to 5GS, with the understanding that the term PCRF corresponds to PCF in the 5GS.\nInvocation-related mechanisms for Mobile Originations e.g. via SIP/IMS:\n-\tPCF: When an indication for a session arrives over the Rx/N5 Interface and the UE does not have priority for the signalling QoS Flow, the PCF derives the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, of the QoS Flow for Signalling as per Service Provider policy as specified in clause 6.1.3.11 of TS 23.503 [45].\n-\tPCF: For sessions such as MPS, when establishing or modifying a QoS Flow for media as part of the session origination procedure, the PCF selects the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to provide priority treatment to the QoS Flow(s).\n-\tPCF: When all active sessions to a particular DN are released, and the UE is not configured for priority treatment to that particular PDU Session for a DN, the PCF will downgrade the IMS Signalling QoS Flows from appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to those entitled by the UE based on subscription.\nInvocation-related mechanisms for Mobile Terminations e.g. via SIP/IMS:\n-\tPCF: When an indication for a session arrives over the Rx/N5 Interface, mechanisms as described above for Mobile Originations are applied.\n-\tUPF: If an IP packet arrives at the UPF for a UE that is CM-IDLE, the UPF sends a \"Data Notification\" including the information to identify the QoS Flow for the DL data packet to the SMF, as specified in clause 4.2.3.3 of TS 23.502 [3].\n-\tSMF: If a \" Data Notification\" message arrives at the SMF for a QoS Flow associated with an ARP priority level value that is entitled for priority use, delivery of priority indication during the Paging procedure is provided by inclusion of the ARP in the N11 interface \"N1N2MessageTransfer\" message, as specified in clause 4.2.3.3 of TS 23.502 [3].\n-\tAMF: If an \"N1N2MessageTransfer\" message arrives at the AMF containing an ARP priority level value that is entitled for priority use, the AMF handles the request with priority and includes the \"Paging Priority\" IE in the N2 \"Paging\" message set to a value assigned to indicate that there is an IP packet at the UPF entitled to priority treatment, as specified in clause 4.2.3.3 of TS 23.502 [3].\n-\tSMF: For a UE that is not configured for priority treatment, upon receiving the \"N7 Session Management Policy Modification\" message from the PCF with an ARP priority level that is entitled for priority use, the SMF sends an \"N1N2MessageTransfer\" to update the ARP for the Signalling QoS Flows, as specified in clause 4.3.3.2 of TS 23.502 [3].\n-\tAMF: Upon receiving the \"N1N2MessageTransfer\" message from the SMF with an ARP priority level that is entitled for priority use, the AMF updates the ARP for the Signalling QoS Flows, as specified in clause 4.3.3.2 of TS 23.502 [3].\n-\t(R)AN: Inclusion of the \"Paging Priority\" in the N2 \"Paging\" message triggers priority handling of paging in times of congestion at the (R)AN as specified in clause 4.2.3.3 of TS 23.502 [3].\nInvocation-related mechanisms for the Priority PDU connectivity services:\n-\tPCF: If the state of the Priority PDU connectivity services is modified from disabled to enabled, the QoS Flow(s) controlled by the Priority PDU connectivity services are established/modified to have the service appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, using the PDU Session Modification procedure as specified in clause 4.3.3 of TS 23.502 [3].\n-\tPCF: If the state of Priority PDU connectivity services is modified from enabled to disabled, the QoS Flow(s) controlled by the Priority PDU connectivity services are modified from Priority PDU connectivity service appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to those entitled by the UE as per subscription, using the PDU Session Modification procedure as specified in clause 4.3.3 of TS 23.502 [3].\nInvocation-related mechanisms for MPS for Data Transport Service:\n-\tMPS for Data Transport Service follows the same steps as those for Priority PDU connectivity services. The QoS Flows that will be subject to MPS for Data Transport Service are based on operator policy and regulations by means of local PCF configuration.\nNOTE 2:\tIf no configuration is provided, MPS for Data Transport Service applies to the QoS Flow associated with the default QoS rule.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.22.4\tQoS Mechanisms applied to established QoS Flows",
                            "text_content": "Mechanisms applied to established QoS Flows:\n-\t(R)AN: QoS Flows requested in the Xn \"Handover Request\" or N2 \"Handover Request\" which are marked as entitled to priority by virtue of inclusion of an ARP value from the set allocated by the Service Provider for prioritised services are given priority over requests for QoS Flows which do not include an ARP from the set as specified in clause 4.9 of TS 23.502 [3].\n-\tSMF: Congestion management procedures in the SMF will provide priority to QoS Flows established for sessions during periods of extreme overload. Prioritised services are exempt from any session management congestion controls. See clause 5.19.\n-\tAMF: Congestion management procedures in the AMF will provide priority to any Mobility Management procedures required for the prioritised services during periods of extreme overload. Prioritised services are exempt from any Mobility Management congestion controls. See clause 5.19.5.\n-\tQoS Flows whose ARP parameter is from the set allocated by the Service Provider for prioritised services' use shall be exempt from release during QoS Flow load rebalancing.\n-\t(R)AN, UPF: IMS Signalling Packets associated with prioritised services' use are handled with priority. Specifically, during times of severe congestion when it is necessary to drop packets on the IMS Signalling QoS Flow, or QoS Flow supporting MPS for Data Transport Service signalling, to ensure network stability, these FEs shall drop packets not associated with priority signalling such as MPS or Mission Critical services before packets associated with priority signalling. See clauses 5.16.5 and 5.16.6.\n-\t(R)AN, UPF: During times of severe congestion when it is necessary to drop packets on a media QoS Flow to ensure network stability, these FEs shall drop packets not associated with priority sessions such as MPS or Mission Critical services before packets associated with priority sessions. See clauses 5.16.5 and 5.16.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.23\tSupporting for Asynchronous Type Communication",
                    "description": "",
                    "summary": "",
                    "text_content": "Asynchronous type communication (ATC) enables 5GC to delay synchronizing UE context with the UE, so as to achieve an efficient signalling overhead and increase system capacity. The support of ATC is optional for the AMF.\n5GC supports asynchronous type communication with the following functionality:\n-\tCapability to store the UE context based on the received message, and synchronize the UE context with the involved network functions or UE later;\nFor network function (e.g. PCF, UDM, etc.) triggered signalling procedure (e.g. network triggered Service Request procedure, network triggered PDU Session Modification procedure, etc.), if the UE CM state in the AMF is CM-IDLE state and the requesting network function indicates to the AMF the ATC is allowed for the signalling, if the AMF supports the ATC feature, the AMF may update and store the UE context based on the received message without paging UE immediately. When the UE CM state in the AMF enters CM-CONNECTED state, the AMF forwards N1 and N2 message to synchronize the UE context with the (R)AN and/or the UE.\nIf the originating NF does not require immediate delivery, it may indicate that the AMF is allowed to use ATC.\nNOTE:\tPre-Rel-17 AMF implementation cannot decode the indication that ATC is allowed.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.24\t3GPP PS Data Off",
                    "description": "",
                    "summary": "",
                    "text_content": "This feature, when activated by the user, prevents traffic via 3GPP access of all IP packets, Unstructured and Ethernet data except for those related to 3GPP PS Data Off Exempt Services. The 3GPP PS Data Off Exempt Services are a set of operator services, defined in TS 22.011 [25] and TS 23.221 [23], that are the only allowed services when the 3GPP PS Data Off feature has been activated by the user. The 5GC shall support 3GPP PS Data Off operation in both non-roaming and roaming scenarios.\nUEs may be configured with up to two lists of 3GPP PS Data Off Exempt Services and the list(s) are provided to the UEs by HPLMN via Device Management or UICC provisioning. When the UE is configured with two lists, one list is valid for the UEs camping in the home PLMN and the other list is valid for any VPLMN the UE is roaming in. When the UE is configured with a single list, without an indication to which PLMNs the list is applicable, then this list is valid for the home PLMN and any PLMN the UE is roaming in.\nNOTE 1:\tThe operator needs to ensure coordinated list(s) of 3GPP Data Off Exempt Services provisioned in the UE and configured in the network.\nThe UE reports its 3GPP PS Data Off status in PCO (Protocol Configuration Option) to (H-)SMF during UE requested PDU Session Establishment procedure for establishment of a PDU Session associated with 3GPP access and/or non-3GPP access. The UE does not need to report PS Data Off status during the PDU Session Establishment procedure for handover of the PDU Session between 3GPP access and non 3GPP access if 3GPP PS Data Off status is not changed since the last report. The PS Data Off status for a PDU Session does not affect data transfer over non-3GPP access.\nIf 3GPP PS Data Off is activated, the UE prevents the sending of uplink IP packets, Unstructured and Ethernet data except for those related to 3GPP PS Data Off Exempt Services, based on the pre-configured list(s) of Data Off Exempt Services.\nIf 3GPP PS Data Off is activated for a UE with MA PDU Sessions established through the ATSSS feature (see clause 5.32), the data transferred over the non-3GPP access of the MA PDU sessions are unaffected, which is ensured by the policy for ATSSS Control as specified in clause 5.32.3.\nThe UE shall immediately report a change of its 3GPP PS Data Off status in PCO by using UE requested PDU Session Modification procedure. This also applies to the scenario of inter-RAT mobility to NG-RAN and to scenarios where the 3GPP PS Data Off status is changed when the session management back-off timer is running as specified in clause 5.19.7.3 and clause 5.19.7.4. For UEs in Non-Allowed Area (or not in Allowed Area) as specified in clause 5.3.4.1, the UE shall also immediately report a change of its 3GPP PS Data Off status for the PDU Session. For UEs moving out of LADN area and the PDU Session is still maintained as specified in clause 5.6.5, the UE shall also immediately report a change of its 3GPP PS Data Off status for the PDU Session.\nThe additional behaviour of the SMF for 3GPP PS Data Off is controlled by local configuration or policy from the PCF as defined in TS 23.503 [45].\nNOTE 2:\tFor the PDU Session used for IMS services, the 3GPP Data Off Exempt Services are enforced in the IMS domain as specified TS 23.228 [15]. Policies configured in the (H-)SMF/PCF need to ensure those services are always allowed when the 3GPP Data Off status of the UE is set to \"activated\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.25\tSupport of OAM Features",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.25.1\tSupport of Tracing: Signalling Based Activation/Deactivation of Tracing",
                            "text_content": "5GS supports tracing as described in TS 32.421 [66]. 5GS support may include subscriber tracing (tracing targeting a SUPI) or equipment tracing (tracing targeting a PEI) but also other forms of tracing further described in TS 32.421 [66].\nNOTE 1:\tTS 23.501 / TS 23.502 [3] / TS 23.503 [45] only describe how 5GS signalling supports delivery of Trace Requirements about a UE (Signalling Based Activation/Deactivation of Tracing). OAM delivery of tracing requirements as well as the transfer of tracing results to one or more Operations Systems are out of scope of these documents.\nThe content of Trace Requirements about a UE (e.g. trace reference, address of the Trace Collection Entity, etc.) is defined in TS 32.421 [66].\nTrace Requirements about a UE may be configured in subscription data of the UE and delivered together with other subscription data by the UDM towards the AMF, the SMF and/or the SMSF.\nThe AMF propagates Trace Requirements about a UE received from the UDM to network entities not retrieving subscription information from UDM, i.e. to the 5G-AN, to the AUSF and to the PCF. The AMF also propagates Trace Requirements to the SMF and to the SMSF. If the I-SMF or V-SMF is needed for the PDU session, the AMF propagates Trace Requirements to the I-SMF or V-SMF. The I-SMF or V-SMF also propagates Trace Requirements received from the AMF to the I-UPF or V-UPF (over N4).\nTrace Requirements about a UE may be sent by the AMF to the 5G-AN as part of:\n-\tthe N2 procedures used to move the UE from CM-IDLE to CM-CONNECTED or,\n-\tthe N2 procedures to request a Hand-over from a target NG-RAN or,\n-\ta stand-alone dedicated N2 procedure when tracing is activated while the UE is CM-CONNECTED.\nTrace Requirements about a UE sent to a 5G-AN shall not contain information on the SUPI or on the PEI of the UE. Trace Requirements are directly sent from Source to Target NG-RAN in the case of Xn Hand-Over.\nThe SMF propagates Trace Requirements about a UE received from the UDM to the UPF (over N4) and to the PCF. The SMF provides Trace Requirements to the PCF when it has selected a different PCF than the one received from the AMF.\nOnce the SMF or the SMSF has received subscription data, Trace Requirements received from UDM supersede Trace requirements received from the AMF. Trace Requirements are exchanged on N26 between the AMF and the MME.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.25.2\tSupport of OAM-based 5G VN group management",
                            "text_content": "5GS supports 5G LAN-type service as defined in clause 5.29. 5G LAN-type service includes the 5G VN group management that can be configured by a network administrator.\nThe parameters for 5G VN group is defined in clause 5.29.\nThe 5G VN group parameters about a UE may be configured in subscription data of the UE and delivered together with other subscription data by the UDM towards the AMF and SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.26\tConfiguration Transfer Procedure",
                    "description": "",
                    "summary": "",
                    "text_content": "The purpose of the Configuration Transfer is to enable the transfer of information between two RAN nodes at any time via NG interface and the Core Network. An example of application is to exchange the RAN node's IP addresses in order to be able to use Xn interface between the NG-RAN node for Self-Optimised Networks (SON), as specified in TS 38.413 [34].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.26.1\tArchitecture Principles for Configuration Transfer",
                            "text_content": "Configuration Transfer between two RAN node provides a generic mechanism for the exchange of information between applications belonging to the RAN nodes.\nIn order to make the information transparent for the Core Network, the information is included in a transparent container that includes source and target RAN node addresses, which allows the Core Network nodes to route the messages. The mechanism is depicted in figure 5.26 1.\nFigure 5.26-1 illustrates the inter-NG-RAN configuration transfer basic network architecture, showcasing the interconnection between the core network functions (C-RAN) and the radio network functions (R-RAN). The diagram highlights the interconnection points, such as the core network functions (C-RAN) and radio network functions (R-RAN), and the signaling paths between them. Key components include the core network functions (C-RAN), radio network functions (R-RAN), and the signaling paths between them.\nFigure 5.26-1: inter NG-RAN Configuration Transfer basic network architecture\nThe NG-RAN transparent containers are transferred from the source NG-RAN node to the destination NG-RAN node by use of Configuration Transfer messages.\nA Configuration Transfer message is used from the NG-RAN node to the AMF over N2 interface, a AMF Configuration Transfer message is used from the AMF to the NG-RAN over N2 interface, and a Configuration Transfer Tunnel message is used to tunnel the transparent container from a source AMF to a target AMF over the N14 interface.\nEach Configuration Transfer message carrying the transparent container is routed and relayed independently by the core network node(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.26.2\tAddressing, routing and relaying",
                            "text_content": "All the Configuration Transfer messages contain the addresses of the source and destination RAN nodes. An NG-RAN node is addressed by the Target NG-RAN node identifier.\nThe following description applies to all the Configuration Transfer messages used for the exchange of the transparent container.\nThe source RAN node sends a message to its core network node including the source and destination addresses. The AMF uses the destination address to route the message to the correct AMF via the N14 interface.\nThe AMF connected to the destination RAN node decides which RAN node to send the message to, based on the destination address.\nThe AMF performs relaying between N2 and N14 messages as described in TS 38.413 [34], TS 29.518 [71].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.27\tEnablers for Time Sensitive Communications, Time Synchronization and Deterministic Networking",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.27.0\tGeneral",
                            "text_content": "This clause describes 5G System features that can be used independently or in combination to enable time-sensitive communication, time synchronization and deterministic networking:\n-\tDelay-critical GBR;\n-\tA hold and forward mechanism to schedule traffic as defined in IEEE Std 802.1Q [98] for Ethernet PDU Sessions in DS-TT and NW-TT (see clause 5.27.4) to de-jitter flows that have traversed the 5G System if the 5G System is to participate transparently as a bridge in a TSN network;\n-\tTSC Assistance Information: describes TSC flow traffic characteristics as described in clause 5.27.2 that may be provided optionally for use by the gNB, to allow more efficiently schedule radio resources for periodic traffic and applies to PDU Session type Ethernet and IP.\n-\tTime Synchronization: describes how 5GS can operate as a PTP Relay (IEEE Std 802.1AS [104]), as a Boundary Clock or as Transparent Clock (IEEE Std 1588 [126]) for PDU Session type Ethernet and IP and how 5GS can detect and report the status of the time synchronization.\n-\tRAN feedback for BAT offset and adjusted periodicity describes a mechanism supported by NG-RAN and 5G CN that enables AF to adapt to received BAT offset and adjusted periodicity from NG-RAN for a given traffic flow.\nThe 5G System integration as a bridge in an IEEE 802.1 TSN network as described in clause 5.28 can make use of all features listed above.\nTo support any of the above features to enable time-sensitive communication, time synchronization and deterministic networking, during the PDU Session establishment, the UE shall request to establish a PDU Session as an always-on PDU Session, and the PDU Sessions are established as Always-on PDU session as described in clause 5.6.13. In this release of the specification, to use any of the above features to enable time-sensitive communication, time synchronization and deterministic networking:\n-\tHome Routed PDU Sessions are not supported;\n-\tPDU Sessions are supported only for SSC mode 1;\n-\tService continuity is not supported when the UE moves from 5GS to EPS .i.e. interworking with EPS is not supported for a PDU Session for time synchronization or TSC or deterministic networking.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.27.1\tTime Synchronization",
                            "text_content": "For supporting time synchronization service, the 5GS is configured to operate in one or multiple PTP instances and to operate in one of the following modes (if supported) for each PTP instance:\n1)\tas time-aware system as described in IEEE Std 802.1AS [104],\n2)\tas Boundary Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 [126] Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127];\nNOTE 1:\tVia proper configuration of the IEEE Std 1588 [126] data set members, the 5G internal system clock can become the time source for the PTP grandmaster function for the connected networks in the case of mode 1 and mode 2.\nNOTE 2:\tIn some cases where the 5G internal system clock is the time source for the PTP grandmaster function for the connected networks, it might not be required for the UE to receive gPTP or PTP messages over user plane. The UE and DS-TT uses the 5G timing information and generates the necessary gPTP or PTP message for the end station, if needed (this is implementation specific).\n3)\tas peer-to-peer Transparent Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127]; or\n4)\tas end-to-end Transparent Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127].\nNOTE 3:\tWhen the GM is external, the operation of 5GS as Boundary Clock assumes that profiles that are supported by the 5GS allows the exemption specified in clauses 9.5.9 and 9.5.10 of IEEE Std 1588 [126] where the originTimestamp (or preciseOriginTimestamp in case of two-step operation) is not required to be updated with the syncEventEgressTimestamp (and a Local PTP Clock locked to the external GM). As described in clause 5.27.1.2.2, only correctionField is updated with the 5GS residence time and link delay, in a similar operation as specified by IEEE Std 802.1AS [104].\nThe configuration of the time synchronization service in 5GS for option 1 by TSN AF and CNC is described in clause 5.28.3, and for options 1-4 by AF/NEF and TSCTSF in clause 5.27.1.8 and clause 5.28.3.\nThe 5GS shall be modelled as an IEEE Std 802.1AS [104] or IEEE Std 1588 [126] compliant entity based on the above configuration.\nNOTE 4:\tThis release of the specification does not support the PTP management mechanism or PTP management messages as described in clause 15 in IEEE Std 1588 [126].\nThe DS-TT and NW-TT at the edge of the 5G system may support the IEEE Std 802.1AS [104] or other IEEE Std 1588 [126] profiles' operations respective to the configured mode of operation. The UE, gNB, UPF, NW-TT and DS- TTs are synchronized with the 5G GM (i.e. the 5G internal system clock) which shall serve to keep these network elements synchronized. The TTs located at the edge of 5G system fulfil some functions related to IEEE Std 802.1AS [104] and may fulfil some functions related to IEEE Std 1588 [126], e.g. (g)PTP support and timestamping. Figure 5.27.1-1 illustrates the 5G and PTP grandmaster (GM) clock distribution model via 5GS.\nThe 5G system is modeled as a PTP instance for supporting time synchronization, as depicted in Figure 5.27.1-1. This figure illustrates the network architecture, including the base station (gNB), user equipment (UE), and scatterers. The diagram highlights the use of beamforming techniques to mitigate interference, and the layered design aligns with SDN principles.\nFigure 5.27.1-1: 5G system is modelled as PTP instance for supporting time synchronization\nFigure 5.27.1-1 depicts the two synchronizations systems considered: the 5G Clock synchronization and the (g)PTP domain synchronization.\n-\t5G Access Stratum-based Time Distribution: Used for NG RAN synchronization and also distributed to the UE. The 5G Access Stratum-based Time Distribution over the radio interface towards the UE is specified in TS 38.331 [28]. This method may be used to either further distribute the 5G timing to devices connected to a UE (using implementation-specific means) or to support the operation of the (g)PTP-based time distribution method.\n-\t(g)PTP-based Time Distribution: Provides timing among entities in a (g)PTP domain. This process follows the applicable profiles of IEEE Std 802.1AS [104] or IEEE Std 1588 [126]. This method relies on the 5G access stratum-based time distribution method to synchronize the UE/DS-TT and on the 5GS time synchronization to synchronize the gNB (which, in turn, may synchronize the DS-TT) and the NW-TT.\nThe gNB needs to be synchronized to the 5G GM clock.\nThe 5GS supports two methods for determining the grandmaster PTP Instance and the time-synchronization spanning tree.\n-\tMethod a), BMCA procedure.\n-\tMethod b), local configuration.\nThis is further described in clause 5.27.1.6.\nThe 5G internal system clock shall be made available to all user plane nodes in the 5G system. The UPF and NW-TT may get the 5G internal system clock via the underlying PTP compatible transport network with mechanisms outside the scope of 3GPP. The 5G internal system clock shall be made available to UE with signalling of time information related to absolute timing of radio frames as described in TS 38.331 [28]. The 5G internal system clock shall be made available to DS-TT by the UE.\n5.27.1.2.2.1\tDistribution of gPTP Sync and Follow_Up messages\nThe mechanisms for distribution of TSN GM clock and time-stamping described in this clause are according to IEEE Std 802.1AS [104].\nNOTE 1:\tIt means Externally-observable behaviour of the 5GS bridge needs to comply with IEEE Std 802.1AS [104].\nFor downlink Time Synchronization, upon reception of a downlink gPTP message from NW-TT port in Follower state, the NW-TT makes an ingress timestamping (TSi) for each gPTP event (Sync) message and uses the cumulative rateRatio received inside the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) to calculate the link delay from the upstream TSN node (gPTP entity connected to NW-TT) expressed in TSN GM time as specified in IEEE Std 802.1AS [104]. NW-TT then calculates the new cumulative rateRatio (i.e. the cumulative rateRatio of the 5GS) as specified in IEEE Std 802.1AS [104] and modifies the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) as follows:\n-\tAdds the link delay from the upstream TSN node in TSN GM time to the correction field.\n-\tReplaces the cumulative rateRatio received from the upstream TSN node with the new cumulative rateRatio.\n-\tAdds TSi in the Suffix field of the gPTP packet as described in clause H.2.\nThe UPF/NW-TT uses the ingress port number of the NW-TT, and domainNumber and sdoId in the received gPTP message to assign the gPTP message to a PTP instance in the NW-TT. If the NW-TT does not have a matching PTP instance, the UPF/NW-TT discards the message. The UPF/NW-TT then forwards the gPTP message from TSN network to the PTP ports in DS-TT(s) in Leader state within this PTP instance via PDU sessions terminating in this UPF that the UEs have established to the TSN network. The UPF/NW-TT also forwards the gPTP message to the PTP ports in NW-TT in Leader state within this PTP instance. All gPTP messages are transmitted on a QoS Flow that complies with the residence time upper bound requirement specified in IEEE Std 802.1AS [104].\nNOTE 2:\tLeader and Follower terms in this specification maps to Master and Slave terms respectively for (g)PTP time synchronization as specified in IEEE Std 802.1AS [104] and IEEE Std 1588 [126]. This terminology can require update depending on the IEEE 1588 WG response to SA WG2.\nNOTE 3:\tThe sum of the UE-DS-TT residence time and the PDB of the QoS Flow needs to be lower than the residence time upper bound requirement for a time-aware system specified in IEEE Std 802.1AS [104] in the following cases:\na)\tIf the PTP port in DS-TT is in Follower state and a PTP port in the NW-TT is in Leader state; or\nb)\ta PTP port in DS-TT is in Leader state and a PTP port in NW-TT is in Follower state.\nNOTE 4:\tIf the PTP port in DS-TT is in a Follower state, and a PTP port in another DS-TT is in Leader state, then the sum of the residence time for these two DS-TT ports and the PDB of the QoS flow of the two PDU Sessions needs to be lower than the residence time upper bound requirement for a time-aware system specified in IEEE Std 802.1AS [104].\nA UE receives the gPTP messages and forwards them to the DS-TT. The DS-TT then creates egress timestamping (TSe) for the gPTP event (Sync) messages for external TSN working domains. The difference between TSi and TSe is considered as the calculated residence time spent within the 5G system for this gPTP message expressed in 5GS time. The DS-TT then uses the rateRatio contained inside the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) to convert the residence time spent within the 5GS in TSN GM time and modifies the payload of the gPTP message that it sends towards the downstream TSN node (gPTP entity connected to DS-TT) as follows:\n-\tAdds the calculated residence time expressed in TSN GM time to the correction field.\n-\tRemoves Suffix field that contains TSi.\nIf the ingress DS-TT has indicated support of the IEEE Std 802.1AS [104] PTP profile as described in clause K.2.1 and the network has configured a PTP instance with the IEEE Std 802.1AS [104] PTP profile for the ingress DS-TT, the ingress DS-TT performs the following operations for received UL gPTP messages for the PTP instance:\n-\tAdds the link delay from the upstream TSN node (gPTP entity connected to DS-TT) in TSN GM time to the correction field.\n-\tReplaces the cumulative rateRatio received from the upstream TSN node (gPTP entity connected to DS-TT) with the new cumulative rateRatio.\n-\tAdds TSi in the Suffix field of the gPTP packet.\nThe UE transparently forwards the gPTP message from DS-TT to the UPF/NW-TT. If the ingress DS-TT port is in Passive state, the UPF/NW-TT discards the gPTP messages. If the ingress DS-TT port is in Follower state, the UPF/NW-TT forwards the gPTP messages as follows:\n-\tIn the case of synchronizing end stations behind NW-TT, the egress port is in UPF/NW-TT. For the received UL gPTP messages, the egress UPF/NW-TT performs the following actions:\n-\tAdds the calculated residence time expressed in TSN GM to the correction field.\n-\tRemoves Suffix field that contains TSi.\n-\tIn the case of synchronizing TSN end stations behind DS-TT, the egress TT is DS-TT of the other UE, and the UPF/NW-TT uses the port number of the ingress DS-TT, and domainNumber and sdoId in the received gPTP message to assign the gPTP message to a PTP instance in the NW-TT. If the NW-TT does not have a matching PTP instance, the UPF/NW-TT discards the message. The UPF/NW-TT then forwards the received UL gPTP message to the PTP ports in DS-TT(s) in Leader state within this PTP instance. The egress DS-TT performs same actions as egress UPF/NW-TT in previous case.\n5.27.1.2.2.2\tDistribution of PTP Sync and Follow_Up messages\nThis clause applies if DS-TT and NW-TT support distribution of PTP Sync and Follow_Up messages. PTP support by DS-TT and NW-TT may be determined as described in clause K.2.1.\nThe mechanisms for distribution of PTP GM clock and time-stamping described in this clause are according to IEEE Std 1588 [126] for Transparent clock and for the case of Boundary clock when the GM is external, where the originTimestamp (or preciseOriginTimestamp) is not updated by the 5GS as described by the exemption in clause 5.27.1.1. If the 5GS acts as the GM with a PTP instance type Boundary clock, then the 5GS updates the originTimestamp (or preciseOriginTimestamp in case of two-step operation) with the 5GS internal clock, as described in clause 5.27.1.7.\nNOTE 1:\tThis means externally-observable behaviour of the PTP instance in 5GS needs to comply with IEEE Std 1588 [126].\nUpon reception of a PTP event message from the upstream PTP instance, the ingress TT (i.e. NW-TT or DS-TT) makes an ingress timestamping (TSi) for each PTP event (i.e. Sync) message.\nThe PTP port in the ingress TT measures the link delay from the upstream PTP instance as described in clause H.4.\nThe PTP port in the ingress TT modifies the PTP message payload (carried within Sync message for one-step operation or Follow_Up message for two-step operation) as follows:\n-\t(if the PTP port in the ingress TT has measured the link delay) Adds the measured link delay from the upstream PTP instance in PTP GM time to the correction field.\n-\t(if the PTP port in the ingress TT has measured the link delay and rateRatio is used) Replaces the cumulative rateRatio received from the upstream PTP instance with the new cumulative rateRatio.\n-\tAdds TSi in the Suffix field of the PTP message as described in clause H.2.\nNOTE 2:\tIf the 5GS is configured to use the Cumulative frequency transfer method for synchronizing clocks as described in clause 16.10 in IEEE Std 1588 [126], i.e. when the cumulative rateRatio is measured, then the PTP port in the ingress TT uses the cumulative rateRatio received inside the PTP message payload (carried within Sync message for one-step operation or Follow_Up message for two-step operation) to correct the measured link delay to be expressed in PTP GM time as specified in IEEE Std 1588 [126]. The PTP port in the ingress TT then calculates the new cumulative rateRatio (i.e. the cumulative rateRatio of the 5GS) as specified in IEEE Std 1588 [126].\nNOTE 3:\tIf 5GS acts as an end-to-end Transparent Clock, since the end-to-end Transparent Clock does not support peer-to-peer delay mechanism, the residence time can be calculated with the residence time spent within the 5GS in 5G GM time and if needed, with a correction factor, for instance, as specified in Equation (6) of clause 12.2.2 of IEEE Std 1588 [126], this gives a residence time expressed in PTP GM time that is used to update the correction field of the received PTP Sync or Follow_Up message.\nThe PTP port in the ingress TT then forwards the PTP message to the UPF/NW-TT. The UPF/NW-TT further distributes the PTP message as follows:\n-\tIf the 5GS is configured to operate as Boundary Clock as described in IEEE Std 1588 [126], the UPF/NW-TT uses the port number of the ingress DS-TT and domainNumber and sdoId in the received PTP message to assign the PTP message to a PTP instance in the NW-TT. If the NW-TT does not have a matching PTP instance, the UPF/NW-TT discards the message. The UPF/NW-TT then regenerates the Sync and Follow_Up (for two-step operation) messages based on the received Sync and Follow_Up messages for the PTP ports in Leader state in NW-TT and DS-TT(s) within this PTP instance. The NW-TT/UPF forwards the regenerated Sync and Follow_Up (for two-step operation) messages to the Leader ports in NW-TT and the PDU session(s) related to the Leader ports in the DS-TT(s) within this PTP instance.\n-\tIf the 5GS is configured to operate as a Transparent Clock as described in IEEE Std 1588 [126], the UPF/NW-TT uses the port number of the ingress TT and domainNumber and sdoId in the received PTP message to assign the PTP message to a PTP instance in the NW-TT. If the NW-TT does not have a matching PTP instance, the UPF/NW-TT discards the message. The UPF/NW-TT then forwards the received Sync messages to PTP ports in DS-TT(s) within this PTP instance via corresponding PDU Sessions terminating to this UPF, and to NW-TT ports within this PTP instance, except toward the ingress PTP port in the ingress TT.\nNOTE 4:\tIf 5GS acts as a Transparent Clock, the 5GS does not maintain the PTP port states; the ingress PTP messages received on a PTP Port are retransmitted on all other PTP Ports of the Transparent Clock subject to the rules of the underlying transport protocol.\nNOTE 5:\tDue to the exemption described in clause 5.27.1.1, when the PTP instance in 5GS is configured to operate as a Boundary Clock, the 5GS does not need to synchronize its Local PTP Clock to the external PTP grandmaster. The PTP instance in 5GS measures the link delay and residence time and communicates these in a correction field. The externally observable behaviour of 5GS still conforms to the specifications for a Boundary Clock as described in IEEE Std 1588 [126].\nThe PTP port in the egress TT then creates egress timestamping (TSe) for the PTP event (i.e. Sync) messages for external PTP network. The difference between TSi and TSe is considered as the calculated residence time spent within the 5G system for this PTP message expressed in 5GS time.\nThe PTP port in the egress TT then uses the rateRatio contained inside the PTP message payload (if available, carried within Sync message for one-step operation or Follow_Up message for two-step operation) to convert the residence time spent within the 5GS in PTP GM time.\nThe PTP port in the egress TT modifies the payload of the PTP message (Sync message for one-step operation or Follow_Up message for two-step operation) that it sends towards the downstream PTP instance as follows:\n-\tAdds the calculated residence time to the correction field.\n-\tRemoves Suffix field of the PTP message that contains TSi.\nNOTE 6:\tIf 5GS acts as an end-to-end Transparent Clock, since the end-to-end Transparent Clock does not support peer-to-peer delay mechanism, the residence time is calculated with the residence time spent within the 5GS in 5G GM time and, if needed, corrected for instance with the factor as specified in Equation (6) of clause 12.2.2 of IEEE Std 1588 [126] to get it expressed in PTP GM time. The residence time is used to update the correction field of the received PTP event (e.g. Sync or Follow_Up) message.\nThis clause describes support for multiple domains for gPTP and PTP and for GM clocks connected to DS-TT and NW-TT and only applies if DS-TT and NW-TT support the related functionality. PTP support and support of gPTP for GM clocks connected to DS-TT by DS-TT and NW-TT may be determined as described in clause K.2.1.\nEach (g)PTP domain sends its own (g)PTP messages. The (g)PTP message carries a specific PTP \"domainNumber\" that indicates the time domain they are referring to. The PTP port in ingress TT makes ingress timestamping (TSi) for the (g)PTP event messages of all domains and forwards the (g)PTP messages of all domains to the UPF/NW-TT that further distributes the (g)PTP messages to the egress TTs as specified in clause 5.27.1.2.2.\nThe PTP port in the egress TT receives the original PTP GM clock timing information and the corresponding TSi via (g)PTP messages for one or more (g)PTP domains. The PTP port in the egress TT then makes egress timestamping (TSe) for the (g)PTP event messages for every (g)PTP domain. Ingress and egress time stamping are based on the 5G system clock at NW-TT and DS-TT.\nNOTE 1:\tAn end-station can select PTP timing information of interest based on the \"domainNumber\" in the (g)PTP message.\nThe process described in clause 5.27.1.2.2 is thus repeated for each (g)PTP domain between a DS-TT and the NW-TT it is connected to.\nNOTE 2:\tIf all (g)PTP domains can be made synchronous and the synchronization can be provided by the 5G clock, the NW-TT or DS-TT(s) generates the (g)PTP event messages of all domains using 5G clock as described in clause 5.27.1.7.\nNOTE 3:\tThis Release of the specification supports multiple gPTP domains as defined in IEEE Std 802.1AS [104]. If a 5GS TSN bridge supports stream gates and/or transmission gates as defined in IEEE Std 802.1Q [98], then they operate based on a single given gPTP domain.\nThis clause describes the support of Time Synchronization functionality supported by the 5G System. Synchronization between UPF/NW-TT and NG-RAN is outside scope of 3GPP.\nDS-TT and NW-TT may support the following PTP instance types:\n-\tBoundary Clock as defined in IEEE Std 1588 [126] as described in clause 5.27.1.1;\n-\tEnd-to-End Transparent Clock as defined in IEEE Std 1588 [126] as described in clause 5.27.1.1;\n-\tPeer-to-Peer Transparent Clock as defined in IEEE Std 1588 [126] as described in clause 5.27.1.1;\n-\tPTP Relay instance as defined in IEEE Std 802.1AS [104].\nEditor's note:\tSupport for external networks operating with IEEE Std 1588-2008 [107] is for further study.\nDS-TT and NW-TT may support the following transports for PTP:\n-\tIPv4 as defined in IEEE Std 1588 [126] Annex C;\n-\tIPv6 as defined in IEEE Std 1588 [126] Annex D;\nIEEE Std 802.3 [131] (Ethernet) as defined in IEEE Std 1588 [126] Annex E.\nFor operation as a Boundary clock or as a Transparent Clock, DS-TT and NW-TT may support the following path and link delay measurement methods:\n-\tDelay request-response mechanism as described in clause 11.3 of IEEE Std 1588 [126];\n-\tPeer-to-peer delay mechanism as defined in clause 11.4 of IEEE Std 1588 [126].\nDS-TT and NW-TT may support acting as a PTP grandmaster, i.e. may support generating (g)PTP Announce, Sync and Follow_Up messages. DS-TT and NW-TT supporting (g)PTP shall support one or more PTP profiles as described in clause 20.3 of IEEE Std 1588 [126],  i.e.:\n-\tDefault PTP Profiles in IEEE Std 1588 [126], Annex I;\n-\tIEEE Std 802.1AS [104] PTP profile for transport of timing as defined in IEEE Std 802.1AS [104] Annex F;\n-\tSMPTE Profile for Use of IEEE Std 1588 [126] Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127].\nTSN AF and TSCTSF may determine the PTP functionalities supported by DS-TT and NW-TT and may configure PTP instances in DS-TT and NW-TT using port and user plane node management information exchange as described in Annex K, clause K.2.\nNOTE:\tHow the TSN AF or TSCTSF assigns NW-TT port(s) of one NW-TT to different PTP instances is up to implementation.\nThe procedure described in this clause is applicable when the PTP instance in 5GS is configured to operate as a time-aware system or as a Boundary Clock, and the PTP grandmaster is external to the 5GS, and the BMCA procedure (Method a) is used as described in clause 5.27.1.6.\nThe NW-TT processes Announce messages according to IEEE Std 1588 [126].\nIn particular, the NW-TT shall compute and maintain the time when the Announce and Sync timeout events occur for the PTP port in a Follower state. When the 5GS is configured to operate as a time-aware system, the NW-TT shall determine the Sync and Announce message interval for the PTP Port at the other end of the link to which the Follower PTP Port in 5GS is attached, as described in IEEE Std 802.1AS [104]. When the 5GS is configured to operate as a Boundary Clock, the NW-TT shall determine Announce interval based on the configuration of the Follower port in 5GS, as described in IEEE Std 1588 [126].\nThe configuration of PTP instances in DS-TT and NW-TT for Sync and Announce timeouts is described in clause K.2. Upon detection of the Sync or Announce timeout event, the NW-TT shall re-evaluate the DS-TT and NW-TT port states as described in clause 5.27.1.6.\nThe procedure described in this clause is applicable if DS-TT and NW-TT support operating as a Boundary Clock described in IEEE Std 1588 [126] or as a time-aware system (support of the IEEE 802.1AS [104] PTP profile) and when the PTP instance in 5GS is configured to operate as a time-aware system or as a Boundary Clock. Whether DS-TT/NW-TT support operating as a Boundary Clock or as a time-aware system may be determined as described in clause K.2.1.\nThe externally-observable behaviour of the Announce message handling by 5GS needs to comply with IEEE Std 802.1AS [104] or IEEE Std 1588 [126], respective to the configured mode of operation.\nThe DS-TT forwards the received Announce messages to NW-TT over User plane. The NW-TT port forwards the received Announce messages from N6 interface to NW-TT.\nThe NW-TT maintains the PTP port state for each DS-TT port and NW-TT port. The PTP port states may be determined by NW-TT either via:\n-\tMethod a), BMCA procedure.\n-\tMethod b), local configuration.\nWhen Method b) is used, the following applies:\n-\tWhen the PTP GM is external to the 5GS, for one of the NW-TT or DS-TT ports (per each PTP domain) the PTP port state is Follower and for all other NW-TT and DS-TT ports of the same PTP domain the PTP port state is set either to Passive or Leader (depending on implementation).\n-\tWhen the 5GS is configured as a grandmaster for a (g)PTP domain for the connected networks, all NW-TT ports and DS-TT ports are set to Leader state for that (g)PTP domain.\nThe local configuration of PTP port states in DS-TT and NW-TT for Method b is described in clause K.2.\nWhen the Method a) is used (PTP port states are determined by BMCA procedure), the NW-TT needs to process the received Announce messages (from NW-TT port(s) and over user plane from the DS-TT(s)) for BMCA procedure, determine port states within the 5GS, and maintain the Leader-Follower hierarchy.\nThe DS-TT maintains the Disabled, Initializing and Faulty (if applicable) state for the PTP ports in DS-TT. While in Disabled, Initializing or Faulty state, the port in the DS-TT discards any (g)PTP messages it may receive from the upstream PTP instance or from the NW-TT via user plane.\nWhen the 5GS Clock is determined as a grandmaster for a (g)PTP domain, the Announce messages are distributed as described in clause 5.27.1.7.\nWhen the grandmaster is external to the 5GS, the NW-TT regenerates the Announce messages based on the Announce messages received from Follower port in NW-TT or DS-TT for the Leader ports in NW-TT and DS-TT(s). The NW-TT/UPF forwards the regenerated Announce messages to the PDU session(s) related to the Leader ports in the DS-TT(s).\nNOTE 1:\tThe TSN AF or TSCTSF can use the portDS.portState in the \"Time synchronization information for each DS-TT port\" element in UMIC to read and get notified for the port state changes for the PTP ports in DS-TT(s), and the portDS.portState in PMIC to read and get notified for the port state changes for the PTP ports in NW-TT. Based on the change of the port states, TSN AF or TSCTSF can determine that an external Grandmaster PTP Instance is found to be used instead of the GM in 5GS, or the GM in 5GS is selected as the Grandmaster PTP Instance, and TSN AF or TSCTSF can disable or enable the (g)PTP grandmaster functionality in DS-TT(s), respectively.\nNOTE 2:\tThe TSN AF or TSCTSF can use the portDS.portState in PMIC to read and get notified for the port state changes for the PTP ports in DS-TT for the port state Disabled, Initializing or Faulty (if applicable). The TSCTSF or TSN AF can use the portDS.portEnable to indicate to the NW-TT that the DS-TT port is disabled. This avoids unnecessary (g)PTP traffic over User Plane to a DS-TT port in Disabled, Initializing or Faulty state.\nThe 5GS that is configured to operate as a time-aware system or Boundary Clock may support acting as a PTP grandmaster for a (g)PTP domain.\nThe configuration of PTP instances in DS-TT and NW-TT for PTP grandmaster function is described in clause K.2.\nThe following options may be supported (per DS-TT) for the 5GS to generate the Sync, Follow_Up and Announce messages for the Leader ports on the DS-TT:\na)\tNW-TT generates the Sync, Follow_Up and Announce messages on behalf of DS-TT (e.g. if DS-TT does not support this).\nThe NW-TT/UPF forwards the generated Sync, Follow_Up and Announce messages to the PDU session(s) related to the Leader ports on the DS-TT(s). The NW-TT timestamps the (g)PTP event message when the event message is sent to the PDU Session, and adds TSi corresponding to the timestamp to the Sync message and the OriginTimestamp corresponding to the timestamp to Sync message (if one-step operation is used) or PreciseOriginTimestamp corresponding to the timestamp to Follow_Up message (if two-step operation is used), and sets the cumulative rateRatio value with 1. The OriginTimestamp or PreciseOriginTimestamp shall be set by NW-TT/UPF to the 5GS internal clock.\nWhen DS-TT(s) receive the Sync, Follow_Up messages, it modifies the payload of the Sync, Follow_Up message as described for the PTP port in the egress TT in clause 5.27.1.2.2.2.\nb)\tDS-TT generates the Sync, Follow_Up and Announce messages in this DS-TT. The OriginTimestamp or PreciseOriginTimestamp shall be set by DS-TT to the 5GS internal clock.\nIn both options, the NW-TT generates the Sync, Follow_Up and Announce messages for the Leader ports on the NW-TT.\n5G System supports time synchronization service that can be activated and deactivated by AF. Exposure of time synchronization comprises the following capabilities:\n-\tThe AF may learn 5GS and/or UE availability and capabilities for time synchronization service.\n-\tThe AF controls activation and deactivation of the time synchronization service for the target UE(s).\n-\tThe AF may subscribe to time synchronization service status for the target UE(s).\nThe AF may use the service-specific parameters to control the time synchronization service for targeted UE(s). These parameters are specified in clause 4.15.9.3 and 4.15.9.4 of TS 23.502 [3] for (g)PTP-based and 5G access stratum-based time synchronization services, respectively.\nThe AF may subscribe for 5GS and/or UE availability and capabilities for time synchronization service. The AF indicates in the request the DNN, S-NSSAI, and in addition the AF may indicate a list of UE identities or group identity to limit the subscription only to corresponding UEs. If the AF does not indicate DNN, S-NSSAI, the NEF determines the DNN, S-NSSAI based on the AF Identifier.\nThe TSCTSF (directly or via NEF) exposes the 5GS and/or UE availability and capabilities for synchronization service to the AF as described in clause 4.15.9.2 of TS 23.502 [3]. The exposed information includes the list of user plane node identities, the list of UE identities and may include the supported capabilities for (g)PTP time synchronization service per user plane node and UE.\nThe AF request to control the (g)PTP time synchronization service is sent to the TSCTSF (directly or via NEF). The request is targeted to a set of AF-sessions that are associated with the exposure of UE availability and capabilities for synchronization service.\nThe AF may request to use a specific PTP instance type when requesting the (g)PTP-based time synchronization distribution method (IEEE Std 1588 [126] or IEEE Std 802.1AS [104] operation (i.e. as a Boundary Clock, peer-to-peer Transparent Clock, or end-to-end Transparent Clock or as a PTP relay instance)). The request to control the (g)PTP time synchronization service may contain other service parameters as specified in Table 4.15.9.3-1 in clause 4.15.9.3 of TS 23.502 [3].\nThe AF may request to use the 5G access stratum as a time synchronization distribution method. In this case, the time source is provided by the 5GS. 5G-AN provides the 5GS time to the UE via 3GPP radio access; UE/DS-TT may provide 5G access stratum timing information to end stations using implementation specific means. The request to control the 5G access stratum time distribution (including the parameters such AF requests may contain) is described in clause 4.15.9.4 of TS 23.502 [3].\nThe AF or NEF selects the TSCTSF as specified in clause 6.3.24.\nThe AF request may include a time synchronization error budget (see also clause 5.27.1.9). The time synchronization error budget defines an upper bound for time synchronization errors introduced by 5GS.\nThe AF uses the procedure for configuring the (g)PTP instance in 5GS as described in clause 4.15.9.3 of TS 23.502 [3] and uses the procedure for providing the 5G access stratum time distribution as described in clause 4.15.9.4 of TS 23.502 [3] for the UEs.\nThe TSCTSF uses the Time Synchronization parameters (Table 4.15.9.3-1 in TS 23.502 [3]) as received from the AF (directly or via NEF) to control the (g)PTP time synchronization service. When IEEE Std 1588 [126] or IEEE Std 802.1AS [104] operation have been selected, the TSCTSF determines the necessary (g)PTP parameters to activate and control the service in DS-TT(s) and NW-TTs. For this purpose, the TSCTSF uses the PMIC or UMIC to manage the IEEE Std 1588 [126] or IEEE Std 802.1AS [104] operation in the DS-TT(s) or NW-TTs, respectively (see clause 5.27.1.4).\nThe TSCTSF may indicate whether it can support the service or not as per the requested acceptance criteria (e.g. based on the known timing synchronization status attribute thresholds also pre-configured at gNB) and provide notification when there is a service status update if the AF subscribes to service status updates (see also clause 5.27.1.12).\nThe TSCTSF uses the Time Synchronization parameters (Table 4.15.9.4-1 of TS 23.502 [3]) as received from the AF (directly or via NEF) to control the 5G access stratum time synchronization distribution as described in clause 4.15.9.4 of TS 23.502 [3].\nFor handling (g)PTP traffic, the PCF, according to PCC rule authorization, chooses a 5QI and dynamically set the PDB and/or MDBV according to requirements for (g)PTP protocol. The PCF provides the SMF with a PCC rule generated based on the AF request to control the (g)PTP time synchronization service. The SMF may take the information in the PCC rule to modify a PDU Session to create or modify or release a QoS Flow for transmitting the (g)PTP messages. The PCF acknowledges the policy request to the TSCTSF. The TSCTSF may report the result of the time synchronization request to the AF (directly or via NEF).\nThe AF may provide a temporal validity condition to the TSCTSF (directly or via NEF) when the AF activates or modifies the time synchronization service. Temporal validity condition contains the start-time and stop-time (in absolute time value) attributes that describe the time period when the time synchronization service is active for the targeted AF sessions. The TSCTSF manages the temporal validity condition as described in clauses 4.15.9.3 and 4.15.9.4 of TS 23.502 [3].\nThe AF may provide clock quality detail level and clock quality acceptance criteria to the TSCTSF (directly or via NEF) when the AF activates or modifies the time synchronization service. For ASTI based time synchronization services, the TSCTSF provides the clock quality reporting control information to AMF (see also clause 5.27.1.12).\nThe AF may provide a requested coverage area for the time synchronization service to the TSCTSF (directly or via NEF) when the AF activates or modifies the time synchronization service. The requested coverage area defines a spatial validity condition for the service using a geographical area (e.g. a civic address or shapes), or a list of Tracking Area Identities (TAIs).\nThe AF may request a specific time synchronization error budget when requesting a time synchronization service employing the (g)PTP-based or 5G access stratum-based time distribution method. If the AF includes a time synchronization error budget in its request, the TSCTSF uses it to derive an error budget available for the NG-RAN to provide the 5G access stratum time via the Uu interface to each targeted UE (referred to as Uu time synchronization error budget hereafter).\nThe Time Synchronization Subscription data may optionally contain the authorized Uu time synchronization error budget. When the TSCTSF receives an AF request with a specific time synchronization error budget for the time synchronization service, the TSCTSF validates the Uu time synchronization error budget as described in clause 5.27.1.11.\nTo derive the Uu time synchronization error budget for each targeted UE, the TSCTSF takes the following into account:\n-\tselected time synchronization distribution method (i.e. 5G access stratum-based time distribution or (g)PTP-based time distribution);\n-\tUu time synchronization error budget in the Time Synchronization Subscription data defined in clause 5.27.1.11;\n-\tin the case of the (g)PTP-based time distribution:\n-\twhether 5GS operates as a boundary clock and acts as a GM;\n-\twhether a clock connected to the DS-TT/NW-TT acts as a GM;\n-\tPTP port states;\n-\ta CN part and a Device part of the time synchronization error budget (both parts may be predefined at the TSCTSF, or calculated by the 5GS using the implementation-specific means).\nIf the AF does not include a time synchronization error budget, the TSCTSF uses a preconfigured time synchronization error budget to derive the Uu time synchronization error budget.  TheTSCTSF provides a 5G access stratum time distribution indication and the derived Uu time synchronization error budget to NG-RAN as described in clause 4.15.9.4 of TS 23.502 [3]. Based on this, NG-RAN provides the 5G access stratum time to the UE according to the Uu interface time synchronization error budget as provided by the TSCTSF (if supported by UE and NG-RAN). During Handover, Service Request, mobility registration and AM policy modification procedure, the AMF may provide the 5G access stratum time distribution indication and the Uu time synchronization error budget to NG-RAN as described in clause 4.15.9.4 of TS 23.502 [3], if needed.\nNOTE:\tThis release of the specification assumes that deployments ensure that the targeted UEs and the NG-RAN nodes serving those UEs support Rel-17 propagation delay compensation as defined in TS 38.300 [27].\nThis feature enables the AF to request time synchronization service for a UE or a group of UEs in a specific geographical area (so called coverage area). The requested coverage area contains a list of Tracking Area (TA) or a geographical area (e.g. a civic address or shapes that the NEF transforms to list of TAs based on pre-configuration).\nTSCTSF checks with the UDM if the UE is allowed to receive the time synchronization service requested by AF.\nThe coverage area defines a spatial validity condition for the targeted UE(s) that is resolved at the TSCTSF. In order to do that, the TSCTSF may either:\na)\tdiscover the AMF(s) serving the list of TA(s) that comprise the spatial validity using Nnrf_NFDiscovery_Request service from the NRF and subsequently, the TSCTSF subscribes to the discovered AMF(s) to receive notifications about presence of the UE in an Area of Interest events (as described in clause 5.3.4.4). The subscription is targeted to Any UE. To reduce the number of Area of Interest reports (based on presence of UE) for the discovered AMFs, the TSCTSF may provide additional filtering information (e.g. List of UE IDs, DNN(s)/S-NNSAI(s)) to limit the subscription to the indicated UE identities, or UEs having a PDU Session with the given DNN/S-NSSAI as specified in clause 5.3.4.4.\nb)\tdetermine the serving AMF for each of the targeted UE(s) using the UDM and subscribe to the serving AMF to receive notification about presence of the UE in an Area of Interest (as described in clause 5.3.4.4).\nAn Area of Interest (AoI) for each AMF is represented by a list of TA(s), wherein the Area of Interest is identical to the requested coverage area.\nBased on the outcome provided by the AMF about the UE's presence in the AoI, the TSCTSF determines if the time synchronization service is activated or deactivated.\nFor access stratum distribution activation/deactivation, the TSCTSF will enable/disable access stratum time distribution to the UE at the serving NG-RAN node reusing the procedures in clause 4.15.9.4 of TS 23.502 [3]. For (g)PTP distribution activation/deactivation, the TSCTSF will modify the PTP instance configuration by means of sending a PMIC to the impacted UE/DS-TTs and UMIC to the impacted UPF/NW-TT, as described in clause K.2.2.\nIf the time synchronization service is modified based on the reports of UE presence in the Area of Interest, the TSCTSF informs the AF for the impacted UE(s) by indicating the PTP port state for the related DS-TT PTP port (in the case of (g)PTP based time distribution) or notifying the AF with the indication of 5G access status time distribution status (enabled or disabled, for ASTI based time distribution).\nIf the Time Synchronization Coverage Area requested by the AF includes at least one TA that is a part of UE's Registration Area (RA), the 5GS may provide the AF-requested time synchronization service to the targeted UE within its RA, i.e. all TAs of the RA shall be treated as a Time Synchronization Coverage Area even if some of the TAs were not requested by the AF.\nNOTE 1:\tThis ensures that (1) there is no impact on the Registration Area (RA) of UE if/when the AMF receives a time synchronization service request with a spatial validity condition (i.e. for specific geographical area); and (2) the UE can continue receiving the time synchronization service when it moves within the RA in the RRC_IDLE state.\nNOTE 2:\tSince the RA can be specific to the UE, the result can be different Time Synchronization Coverage Area for different DS-TT ports of different UEs within a PTP instance.\nThe distribution of timing information, 5G access stratum-based time distribution and (g)PTP-based time distribution, for a UE may be controlled based on subscription data stored in the UDM. The (g)PTP-based or 5G access stratum-based time synchronization service may be provided to a UE based on the UE's subscription which is specified in the TS 23.502 [3] clause 5.2.3.3.1.\nThe Access and Mobility Subscription data include for the control of 5G access stratum-based time distribution the following information:\n-\tthe Access Stratum Time Synchronization Service Authorization, which indicates whether the UE should be provisioned with 5G system internal clock timing information over access stratum as specified in TS 38.331 [28].\n-\toptionally, the Uu time synchronization error budget.\n-\toptionally, one or more periods of start and stop times defining the times when the UE should be provisioned with 5G system internal clock timing information.\n-\toptionally, a Time Synchronization Coverage Area comprising a list of TAs where the UE shall be provisioned with 5G system internal clock timing information.\n-\toptionally, a clock quality detail level indicating whether and which clock quality information to provide to the UE. It comprises one of the following values: clock quality metrics or acceptable/not acceptable indication.\n-\toptionally, the clock quality acceptance criteria for the UE. It may be defined based on one or more attributes listed in Table 5.27.1.12-1.\nDuring the Registration procedure, the AMF retrieves the subscription from UDM. If the AMF receives 5G access stratum-based time synchronization service subscription for the given UE, the AMF controls the 5G access stratum-based time distribution:\n-\tIf the 5G access stratum-based time synchronization service is allowed for the UE, the AMF provides the 5G access stratum time distribution indication to the NG-RAN so that it can provide 5G timing information to the UE.\n-\tThe AMF may provide a Uu time synchronization error budget to the NG-RAN (as described in clause 5.27.1.9). If the UE's subscription contains a Uu time synchronization error budget, then AMF sends it to NG-RAN. Otherwise, the AMF uses the pre-configured Uu time synchronization error budget and sends it to NG-RAN.\n-\tIf the UE's subscription contains Coverage Area (defined as a list of TAs), the AMF configures the NG-RAN to provide the 5G timing information to UE only when the UE is in the Coverage Area as described in clause 5.27.1.10.\n-\tIf the AMF receives the start and stop times, then the AMF enables and disables the 5G access stratum time distribution indication to the NG-RAN according to the expiry of start and stop times if the UE is in CM-CONNECTED state. If the UE is in CM-IDLE state when a Start time condition is met, the AMF pages the UE and provides the 5G access stratum time distribution indication to NG-RAN as part of the subsequent service request procedure initiated by the UE in the response to the paging.\n-\tIf the AMF receives the clock quality detail level, then the AMF configures the NG-RAN to provide clock quality detail information reporting to UE as described in clause 5.27.1.12. The AMF may instruct the UE to reconnect to the network when the UE detects that the RAN timing synchronization status has changed while the UE is in RRC_INACTIVE or RRC_IDLE, as described in clause 5.27.1.12.\n-\tIf the AMF receives the same parameters both in the Access and Mobility Subscription data from UDM and in the AM Policy from PCF, the AMF shall use the value received from the AM policy.\nThe Time Synchronization Subscription data is the subscription data for the control of (g)PTP-based time distribution and 5G access stratum-based time distribution and includes the following information:\n-\tthe \"AF request Authorization\", indicating whether the UE is authorized for an AF-requested 5G access stratum-based time distribution and (g)PTP-based time distribution services. The indication is provided separately for each service:\n-\t\"allowed\" or \"not allowed\" for (g)PTP based time synchronization service (per DNN/S-NSSAI and UE identity),\n-\t\"allowed\" or \"not allowed\" for ASTI based time synchronization services (per UE identity).\n-\tIf the \"AF request Authorization\" is set to \"allowed\", the Time Synchronization Subscription data may contain additional information for (g)PTP/ASTI based time synchronization services authorized by:\n-\toptionally, a list of TA(s) which specifies an area (a so-called Authorized Time Synchronization Coverage Area) in which an AF may request time synchronization services;\n-\toptionally, one or more periods of authorized start and stop times, which indicates the allowed time period during which an AF may request time synchronization services;\n-\toptionally, authorized Uu time synchronization error budget, which indicates the limit the AF may request.\n-\tone or more Subscribed time synchronization service ID(s), each containing the DNN/S-NSSAI and a reference to a PTP instance configuration pre-configured at the TSCTSF (e.g. PTP profile, PTP domain, etc.):\n-\toptionally, for each PTP instance configuration, one or more periods of start and stop times defining active times of time synchronization service for the PTP instance.\n-\toptionally, for each PTP instance configuration, a Time Synchronization Coverage Area defining a list of TAs where the (g)PTP-based time synchronization is available for the UEs in the PTP instance.\n-\toptionally, for each PTP instance configuration, Uu time synchronization error budget.\nThe TSCTSF retrieves the Time Synchronization Subscription data from UDM. If the TSCTSF receives the Time Synchronization Subscription data for a UE, the TSCTSF controls the Time Synchronization Service including (g)PTP-based time distribution and 5G access stratum-based time distribution:\n-\tThe TSCTSF retrieves the Time Synchronization Subscription data from the UDM when the TSCTSF receives an AF request for the time synchronization service (either ASTI or (g)PTP). According to the \"AF request Authorization\" in the UE's Time Synchronization Subscription data, the TSCTSF determines whether the UE is authorized for an AF-requested time synchronization service:\n-\tIf the UE's Time Synchronization Subscription data contains an Authorized Time Synchronization Coverage Area (i.e. a list of TA(s) defining the restricted area for AF request), TSCTSF checks whether the AF requested Coverage Area satisfies the authorized area: If the requested Coverage Area (see clause 5.27.1.10) is within the Authorized Time Synchronization Coverage Area, the TSCTSF uses the requested Coverage Area. If the Authorized Time Synchronization Coverage Area is inside of the requested Coverage Area, the TSCTSF uses the Authorized Time Synchronization Coverage Area. If the requested Coverage Area partly overlaps with the Authorized Time Synchronization Coverage Area, the TSCTSF uses the intersection of them. If there is no overlap between them, the TSCTSF shall reject the AF request.\n-\tIf the AF requested Coverage Area satisfies the authorized area totally or partly, TSCTSF notifies to AF with the Time Synchronization Service information based on the Authorized Time Synchronization Coverage Area. TSCTSF subscribes to UE's presence in the Area of Interest at the discovered AMF(s), if the UE(s) moves out of the AF requested coverage area, the TSCTSF shall disable Time Synchronization Service and notifies to AF.\n-\tIf the UE's Time Synchronization Subscription data contains authorized Uu time synchronization error budget, the TSCTSF checks whether the Uu time synchronization error budget derived from AF request satisfies (i.e. equal or larger than) the authorized Uu time synchronization error budget.\n-\tIf the UE's Time Synchronization Subscription data contains periods of authorized start and stop times, the TSCTSF checks whether the AF requested temporal validity condition satisfies (i.e. within) any of the periods of authorized start and stop times. If such period is found, the TSCTSF uses the start and stop times of the AF request.\n-\tIf the AF request is authorized, the TSCTSF proceeds as specified in clause 5.27.1.8 and in TS 23.502 [3]. Otherwise, the TSCTSF rejects the AF request.\n-\tThe TSCTSF retrieves the Time Synchronization Subscription data from the UDM when it receives notification from the PCF that a UE has established a PDU Session that is potentially impacted by (g)PTP-based time synchronization service:\n-\tThe TSCTSF retrieves the PTP instance configurations referenced from the \"Subscribed time synchronization service ID(s)\". The PTP instance configurations are stored locally in the TSCTSF. The TSCTSF determines if one or more of the PTP instance configurations match with the DNN/S-NSSAI of the given PDU Session. If no PTP instance exists for the given PTP instance configuration, the TSCTSF initializes the PTP instance in 5GS as described in clause K.2.2.\n-\tThe TSCTSF configures a PTP port in DS-TT and adds it to the corresponding PTP instance in NW-TT as described in clause K.2.2.\n-\tIf the PTP instance configuration referenced by UE's Time Synchronization Subscription data contains an Uu time synchronization error budget, then the TSCTSF uses it to derive an Uu time synchronization error budget available for the NG-RAN to provide the 5G access stratum time for the UE as specified in clause 5.27.1.9.\n-\tIf the PTP instance configuration referenced by the Time Synchronization Subscription data for the UE contains start and stop times, the TSCTSF, upon expiry of start time, creates the PTP instance and adds the PTP port in DS-TT to the PTP instance. Upon expiry of stop time, if this is the last period of start and stop times in the PTP instance configuration, the TSCTSF deletes the PTP instance, otherwise the TSCTSF temporarily disables the PTP instance.\n-\tIf the PTP instance configuration referenced by the Time Synchronization Subscription data for the UE contains a Time Synchronization Coverage Area, the TSCTSF subscribes to UE's Presence in Area(s) of Interest corresponding to the Time Synchronization Coverage Area at the discovered AMF(s). When the TSCTSF determines that the UE has moved inside or outside of the Time Synchronization Coverage Area, the TSCTSF adds or temporarily removes the PTP port in DS-TT from the corresponding PTP instance.\nWhile the time synchronization service is offered by the 5GS, based on 5G access stratum-based time distribution or (g)PTP-based time distribution, the network timing synchronization status of the nodes involved in the operation (e.g. gNBs and/or UPF/NW-TTs) may change. gNBs and UPF/NW-TT can detect timing synchronization degradation or improvement locally. The support for network timing synchronization status monitoring enables the 5GS to modify time synchronization service for a UE or a group of UEs depending on the current synchronization status and notify service updates. There may be three consumers of this information:\n-\tTSCTSF may receive node-level information about timing synchronization status from gNB and/or UPF/NW-TT directly from OAM or alternatively, if supported by a node, using control plane signalling at node level. Node level signalling uses UMIC for UPF/NW-TT case and an AMF service to report N2 node level information for the gNB case. In the latter case, the AMF controls the gNB node level reporting and subscription using NGAP messages (see TS 38.413 [34]).\n-\tAF may subscribe to time synchronization status notifications for a UE or group of UEs for which the AF requests or has requested time synchronization service (for 5G access stratum time distribution or (g)PTP services).\n-\tFor 5G access stratum time synchronization service, the UE may receive clock quality information from the gNB based on UE subscription data stored in the UDM (see clause 5.27.1.11) or AF request for clock quality reporting to the UE.\nWhen activating time synchronization for a UE, TSCTSF forwards the clock quality detail level (if available) to the AMF (via PCF using AM policy). The AMF instructs the UE to transition to the RRC_CONNECTED state in the case when the UE later detects that the gNB timing synchronization status has changed while the UE is in the RRC_INACTIVE or RRC_IDLE state. When the UE wants to access the 5GS, the UE shall perform Unified Access Control as defined in TS 38.331 [28].\ngNBs may be pre-configured with thresholds for each Timing Synchronization Status (TSS) attribute, if supported, that is described in Table 5.27.1.12-1.\ngNBs may include a reference report ID in SIB information, if supported. A reference report ID consists of a scope of the TSS and an Event ID. A scope of the TSS supports providing TSS information for all cells or a group of cells within a single gNB. Event ID is an integer indicating that the gNB's clock quality has changed, resulting in at least one TSS attribute exceeding or meeting again the pre-configured threshold. Uniqueness of Event ID value is ensured by combining it with a gNB ID as specified in TS 38.300 [27]. When the network TSS attribute exceeds the thresholds (i.e. status degradation), or the network TSS attribute meets the thresholds again (i.e. status improvement), the gNB notifies the TSCTSF (either using N2 node level signalling via AMF, or via OAM) with the scope of the timing synchronization status (i.e. gNB ID or a list of Cell IDs within a single gNB) and the corresponding network timing synchronization status attributes as described in Table 5.27.1.12-1. The gNB indicates the status change to the UEs via the reference report ID change in SIB information:\n-\tWhen the network timing synchronization status exceeds any of the pre-configured thresholds (i.e. status degradation) or meets the threshold again (i.e. status, improvement), the gNB changes the reference report ID in SIB information. Either event serves as a notification for the UEs reading the SIB information that there is new TSS information available.\nNOTE 1:\tNG-RAN is assumed not to provide clock quality metrics better than the pre-configured threshold, i.e. if a clock quality metric is better than the corresponding threshold, the NG-RAN reports the threshold value to the UE in an RRC message instead.\nNOTE 2:\tIt is assumed the pre-configured thresholds in the gNB(s) are sufficient to meet UE time sync performance requirement which are configured by the operator.\n-\tIf supported, the UE in the RRC_INACTIVE or RRC_IDLE state compares the reference report ID in SIB information with its locally stored reference report ID to determine whether it has the latest available clock quality information already or it needs to transit to the RRC_CONNECTED state to retrieve it.\n-\tIf the UE is instructed by AMF (via the Registration procedure, or the UE Configuration Update procedure) to reconnect to the network in the case when the UE determines that the reference report ID has changed, the UE in the RRC_INACTIVE or RRC_IDLE state, if supported by the UE, reconnects to the network. RAN may delay or prioritize UE's transition to the RRC_CONNECTED state using the UAC framework [28], i.e. UEs are not expected to transition to the RRC_CONNECTED state immediately after determining that the clock quality information has changed and receiving instructions from the AMF. After the UE has reconnected to the network, the gNB uses unicast RRC signalling to provision the clock quality information to the UEs.\nThe network timing synchronization status information from gNB or UPF/NW-TT to the TSCTSF may contain the following information as described in the Table 5.27.1.12-1. The details for gNB timing synchronization status information are specified in TS 38.413 [34]. However, it is up to gNB to determine whether to provide its timing synchronization status reporting and which of the information elements to include in the TSS report to the TSCTSF, i.e. based on the implementation gNB may report all, some, or none of the information elements from Table 5.27.1.12-1.\nTable 5.27.1.12-1: Information elements that gNB or UPF/NW-TT timing synchronization status information may contain (all optional)\n\nThe TSCTSF determines the UEs impacted by gNB's timing synchronization status change (i.e. degradation, failure or improvement) or UPF timing synchronization status change (only for the case when UPF/NW-TT is involved in providing time information to DS-TT).\n-\tFor the gNB case, when the TSCTSF receives information about timing synchronization status change, the TSCTSF uses the NRF to discover the AMFs serving the impacted gNBs and subscribes to receive notifications for UE's presence in Area of Interest information from AMF as described in clause 5.3.4.4. The Area of Interest is set to the scope of the timing synchronization status (i.e. gNB ID or a group of cells within the gNB specified with a list of Cell IDs that has reported status degradation (i.e. the pre-configured thresholds are exceeded in the gNB). The subscription is targeted to any UE in the AMF, the TSCTSF may provide additional filtering information as specified in clause 5.3.4.4 (e.g., List of UE IDs, DNN(s)/S-NNSAI(s)) to limit the subscription to the indicated UE identities, UEs having a PDU Session with the given DNN(s)/S-NSSAI(s). The TSCTSF correlates information about impacted gNBs and the UE location information received from the AMF. If the gNB notifies the TSCTSF for the status improvement (i.e. the pre-configured thresholds are met in the gNB), the TSCTSF modifies the subscription to remove the corresponding Area of Interest from the subscription.\n-\tFor UPF case, the TSCTSF determines the UEs for which the impacted UPF/NW-TT is configured to send (g)PTP messages on behalf of DS-TT (see clause 5.27.1.7).\nIf the gNB's or UPF's timing synchronization status change, the TSCTSF may perform the following:\n-\tFor AFs that subscribe for 5G access stratum time synchronization service or (g)PTP time synchronization service status update (i.e. change in support status of the clock quality acceptance criteria provided by the AF and specified using TSS attributes from Table 5.27.1.12-1), the TSCTSF may provide notification towards the AF when there is a change in support status for a UE or group of UEs.\n-\tDeactivating/reactivating/updating time synchronization services:\n-\t(g)PTP time synchronization service case: For UEs that are part of a PTP instance and which are impacted by NG-RAN or UPF time synchronization status degradation or improvement:\n-\tIf TSCTSF determines that the clock quality acceptance criteria provided by AF can still be met, then TSCTSF may update the clock quality information sent in Announce messages (see clause 7.6.2 of IEEE 1588 [8]) for the PTP instance using existing procedures and existing PMIC/UMIC information. The handling of Announce messages follows existing procedures as described in clause 5.27.1.6.\n-\tIf TSCTSF determines that the clock quality acceptance criteria provided by AF cannot be met, then TSCTSF informs the AF for the corresponding PTP ports being inactive due to the result of fulfilling the clock quality acceptance criteria; and the TSCTSF temporarily removes the UE/DS-TT from the PTP instance using the procedure in clause K.2.2.1 and clause K.2.2.4. The AF may send a service update or delete request (see clause 4.15.9.3 of TS 23.502 [3]).\n-\tIf TSCTSF determines that the clock quality acceptance criteria provided by AF can be met again then TSCTSF informs the AF about the result, adds the DS-TT PTP port to the PTP instance again and re-activates the Grandmaster functionality.\nFor 5G access stratum time synchronization service, clock quality reporting control information manages the gNBs timing synchronization status reporting to the UE. When AMF provides the 5G access stratum time distribution indication and the Uu time synchronization error budget to gNB, the AMF also includes the clock quality reporting control information (CQRCI) provided by the TSCTSF or retrieved from UDM. CQRCI may be a part of Access and Mobility Subscription data at the UDM, or AF may include CQRCI in its request. CQRCI contains the following fields:\n-\tClock quality detail level. It indicates whether and which clock quality information to provide to the UE and can take one of the following values: \"clock quality metrics\" or \"acceptable/not acceptable indication\".\n-\tIf the clock quality detail level equals \"clock quality metrics\", the NG-RAN provides clock quality metrics to the UE that reflect its current timing synchronization status. i.e. one or more of the following information elements: clock accuracy, traceability to UTC, traceability to GNSS, frequency stability, parent time source, synchronization state as defined in Table 5.27.1.12-1. NG-RAN is locally configured which of the clock quality metrics supported by NG-RAN are provided to UE(s).\n-\tIf the clock quality detail level equals \"acceptable/not acceptable indication\", NG-RAN provides clock quality acceptance criteria for the UE. The gNB provides an acceptable indication to the UE if the gNB's timing synchronization status matches the acceptance criteria received from the AMF; otherwise, the gNB indicates \"not acceptable\" to the UE. Clock quality acceptance criteria can be defined based on one or more information elements listed in Table 5.27.1.12-1. If AF includes clock quality acceptance criteria in its request towards TSCTSF, the AF shall be notified about the result once TSCTSF determines whether the clock quality acceptance criteria can be met or not. Based on the notification, the AF may decide to modify the service if preferred (e.g., disable the service upon status degradation or enable it again upon status improvement).\nWhen determining the clock quality metrics for a UE and when determining whether clock quality is acceptable or not acceptable for a UE, the gNB considers whether propagation delay compensation is performed.\nNOTE 3:\tIn this Release, UE capabilities and internal inaccuracies are assumed to be budgeted by the client network operator when agreeing the required clock accuracy with the 5G network operator.\nTo provision clock quality information to the UEs, a gNB uses unicast RRC signalling:\n-\tFor UEs in the RRC_CONNECTED state, the gNB uses unicast RRC signalling.\n-\tUEs that are not in the RRC_CONNECTED state first need to establish or resume the RRC connection to receive the clock quality information from the gNB via unicast RRC signalling.\nDuring N2 Handover and Xn handover, Service Request, mobility registration and AM policy modification procedure, the AMF may provide the CQRCI to NG-RAN.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.27.1.12-1: Information elements that gNB or UPF/NW-TT timing synchronization status information may contain (all optional)",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.27.1a\tPeriodic deterministic communication",
                            "text_content": "This clause describes 5G System features that allow support of periodic deterministic communication where the traffic characteristics are known a-priori, and a schedule for transmission from the UE to a downstream node, or from the UPF to an upstream node is provided via external protocols outside the scope of 3GPP (e.g. IEEE 802.1 TSN).\nThe features include the following:\n-\tProviding TSC Assistance Information (TSCAI) that describe TSC flow traffic characteristics (as described in clause 5.27.2) at the gNB ingress and the egress of the UE for traffic in downlink and uplink direction, respectively;\n-\tSupport for hold & forward buffering mechanism (see clause 5.27.4) in DS-TT and NW-TT to de-jitter flows that have traversed the 5G System.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.27.2\tTSC Assistance Information (TSCAI) and TSC Assistance Container (TSCAC)",
                            "text_content": "TSC Assistance Information (TSCAI) is defined in Table 5.27.2-1 and describes TSC traffic characteristics for use in the 5G System. TSCAI may be used by the 5G-AN, if provided by SMF. The knowledge of TSC traffic pattern is useful for 5G-AN as it allows more efficiently scheduling of QoS Flows that have a periodic, deterministic traffic characteristics either via Configured Grants, Semi-Persistent Scheduling or with Dynamic Grants. TSCAI can be provided for both GBR and non-GBR QoS flows.\nThe TSCTSF determines the TSC Assistance Container (defined in Table 5.27.2-2) based on information provided by an AF/NEF or a DetNet controller as described in clause 5.27.2.3 and provides it to the PCF for IP type and Ethernet type PDU Sessions. In the case of integration with IEEE TSN network, the TSN AF determines TSC Assistance Container as described in clause 5.27.2.2 and provides it to the PCF for Ethernet PDU Sessions. The PCF receives the TSC Assistance Container from the TSCTSF or the TSN AF and forwards it to the SMF as part of PCC rule as described in clause 6.1.3.23a of TS 23.503 [45].\nThe SMF binds a PCC rule with a TSC Assistance Container to a QoS Flow as described in clause 6.1.3.2.4 of TS 23.503 [45]. The SMF uses the TSC Assistance Container to derive the TSCAI for that QoS Flow and sends the derived TSCAI to the NG-RAN. The Periodicity, Periodicity Range, Burst Arrival Time (BAT), BAT Window and Survival Time components of the TSCAI are specified by the SMF with respect to the 5G clock. The SMF is responsible for mapping the Burst Arrival Time, BAT Window, Periodicity and Periodicity Range from an external clock (when available) to the 5G clock based on the time offset and cumulative rateRatio (when available) between the external clock time and 5GS time as measured and reported by the UPF. The SMF determines the TSCAI as described in clause 5.27.2.4.\nA Survival Time, which indicates the time period an application can survive without any data burst, may be provided by TSN AF/AF or by the TSCTSF either in terms of maximum number of messages (message is equivalent to all packets of a data burst) or in terms of time units. Only a single data burst is expected within a single time period referred to as the periodicity.\nThe SMF may send an update of the TSCAI to the NG-RAN as defined in clauses 4.3.3.2, 4.9.1.2.2 and 4.9.1.3.2 of TS 23.502 [3] or as defined in clause 5.37.8.2.\nTable 5.27.2-1: TSC Assistance Information (TSCAI)\n\nTable 5.27.2-2: TSC Assistance Container (TSCAC)\n\nIn the case of integration with IEEE TSN network, the TSN AF determines a TSC Assistance Container (defined in Table 5.27.2-2) and provides it to the PCF. The determination of TSC Assistance Container based on Per-Stream Filtering and Policing (PSFP) information applies only to Ethernet type PDU Sessions.\nNOTE 1:\tThis clause assumes that PSFP information as defined in IEEE Std 802.1Q [98] and Table K.3.1-1is provided by CNC. PSFP information may be provided by CNC if TSN AF has declared PSFP support to CNC. TSN AF indicates the support for PSFP to CNC only if all the DS-TT and NW-TT ports of the 5GS Bridge have indicated support of PSFP. Means to derive the TSC Assistance Container if PSFP is not supported by 5GS and/or the CNC are beyond the scope of this specification.\nThe TSN AF may be able to identify the ingress port and thereby the PDU Session as described in clause 5.28.2.\nThe TSN AF interfaces towards the CNC for the PSFP (IEEE Std 802.1Q [98]) managed objects that correspond to the PSFP functionality implemented by the DS-TT and the NW-TT. Thus, when PSFP information is provided by the CNC, the TSN AF may extract relevant parameters from the PSFP configuration. The TSN AF calculates traffic pattern parameters (such as burst arrival time with reference to the ingress port and periodicity). TSN AF also obtains the flow direction as specified in clause 5.28.2. Survival Time may be pre-configured in TSN AF.\nTSN AF may enable aggregation of TSN streams if the TSN streams belong to the same traffic class, terminate in the same egress port and have the same periodicity and compatible Burst arrival time. When Survival Time information is provided for a TSN stream, then it should not be aggregated with other TSN streams into a single QoS Flow, or if they are aggregated, then the Survival Time parameter shall not be provided. One set of parameters and one TSC Assistance Container are created by the TSN AF for multiple TSN streams to enable aggregation of TSN streams to the same QoS Flow.\nAnnex I describe how the traffic pattern information is determined.\nNOTE 2:\tFurther details of aggregation of TSN streams (including determination of burst arrival times that are compatible so that TSN streams can be aggregated) are left for implementation.\nNOTE 3:\tIn order for the TSN AF to get Burst Arrival Time, Periodicity on a per TSN stream basis, support for IEEE Std 802.1Q [98] (as stated in clause 4.4.8.2) Per-Stream Filtering and Policing (PSFP) with stream gate operation is a prerequisite.\nFor a UE-UE TSC stream, the (TSN) AF divides the stream into one uplink stream and one or more downlink streams as defined in clause 5.28.2. The TSN AF binds the uplink and downlink streams to the PDU Sessions, and provides the streams on AF Session basis to the PCF(s). The TSN AF calculates traffic pattern parameters for the UL and the DL stream using the PSFP configuration (if provided) respectively:\n-\tFor the uplink stream, the Flow Direction is set to uplink and traffic pattern parameters (such as burst arrival time with reference to the ingress port and periodicity) is determined as described in Annex I.\n-\tFor downlink stream, the Flow Direction is set to downlink, the burst arrival time is set to sum of burst arrival time of the UL stream and 5GS Bridge delay of PDU Session carrying the UL stream, and the periodicity is determined as described in Annex I.\nThe TSCTSF constructs TSC Assistance Container (defined in Table 5.27.2-2) based on information provided (directly or via NEF) by the AF for IP or Ethernet type PDU Sessions, or by the DetNet controller for IP type PDU Sessions.\nIn the case of an AF request, the AF may provide Flow Direction, Burst Arrival Time (optional) at the UE/DS-TT (uplink) or UPF/NW-TT (downlink), Maximum Burst Size, Periodicity, Survival Time (optional), and a Time Domain (optional) to the TSCTSF. If the AF is able to adjust the burst sending time, the AF may in addition provide a BAT Window or the Capability for BAT adaptation to the TSCTSF. Addtionally if the AF is able to adjust the periodicity, the AF may also provide the Periodicity Range along with the Periodicity to the TSCTSF. Based on these parameters, the TSCTSF constructs a TSC Assistance Container and provides it to PCF. If the AF provides to the TSCTSF a Burst Arrival Time or Periodicity without corresponding Time Domain, the TSCTSF sets the Time Domain = \"5GS\" in the TSC Assistance Container.\nIf the AF is able to adjust the transmission time and periodicity then in addition to above parameters, it may provide a BAT Window (optional) or the capability for BAT adaptation (optional), or Periodicity Range (optional), to the TSCTSF.\nNOTE:\tThe Maximum Burst Size is signalled separately, i.e. it is not part of the TSC Assistance Container.\nThe AF provides these parameters to the NEF and the NEF forwards these parameters to the TSCTSF. The AF trusted by the operator provides these parameters to the TSCTSF directly.\nIn the case of Deterministic Networking, the TSCTSF constructs the TSC Assistance Container based on information provided by the DetNet controller as defined in clause 6.1.3.23b of TS 23.503 [45].\nThe TSCTSF sends the TSC Assistance Container to the PCF as follows:\n-\tThe TSCTSF uses the UE IP address/DS-TT port MAC address to identify the PCF and N5 association related to the PDU Session of a UE/DS-TT.\nThe SMF determines the TSCAI (defined in Table 5.27.2-1) for the QoS Flow based on the TSC Assistance Container of the PCC rule bound to the QoS Flow. This clause is applicable irrespective of whether the TSC Assistance Container is determined by the TSN AF or by the TSCTSF.\nThe Burst Arrival Time and Periodicity component of the TSCAI that the SMF sends to the 5G-AN are specified with respect to the 5G clock. The SMF is responsible for mapping the Burst Arrival Time and Periodicity in the TSC Assistance Container from an external clock to the 5G clock based on the time offset and cumulative rateRatio (when available) between external time and 5GS time as measured and reported by the UPF. The SMF may correct the TSCAI based on the UPF report for time offset and cumulative rateRatio between external PTP time and 5GS time as measured and reported by the UPF.\nThe TSCAI parameter determination in SMF is done as follows:\n-\tFor traffic in downlink direction, the SMF corrects the Burst Arrival Time in the TSC Assistance Container based on the latest received time offset measurement from the UPF and sets the TSCAI Burst Arrival Time as the sum of the corrected value and CN PDB as described in clause 5.7.3.4, representing the latest possible time when the first packet of the data burst arrives at the AN.\n-\tFor traffic in uplink direction, the SMF corrects the Burst Arrival Time in the TSC Assistance Container based on the latest received time offset measurement from the UPF and sets the TSCAI Burst Arrival Time as the sum of the corrected value and UE-DS-TT Residence Time, representing the latest possible time when the first packet of the data burst arrives at the egress of the UE. How the SMF corrects the Burst Arrival Time if the UE-DS-TT Residence Time has not been provided by the UE is up to SMF implementation.\n-\tThe SMF corrects the Periodicity in the TSC Assistance Container using the cumulative rateRatio if the cumulative rateRatio was previously received from the UPF and sets the TSCAI Periodicity as the corrected value. Otherwise, the SMF sets the received Periodicity in the TSCAI without any correction.\n-\tThe SMF sets the TSCAI Flow Direction as the Flow Direction in the TSC Assistance Container.\n-\tIf Survival Time is provided in terms of maximum number of messages, the SMF converts maximum number of messages into time units by multiplying its value by the TSCAI Periodicity, and sets the TSCAI Survival Time to the calculated value. If Survival Time is provided in time units, the SMF corrects the Survival Time using the cumulative rateRatio if the cumulative rateRatio was previously received from the UPF and sets the TSCAI Survival Time to the corrected value. Otherwise, SMF sets the TSCAI Survival Time without correction.\n-\tIf the TSC Assistance Container contains a BAT Window, the SMF sets and corrects the indicated earliest and latest possible arrival time of the first packet in the same way it is described for the correction of the Burst Arrival Time above.\n-\tIf the TSC Assistance Container contains a Capability for BAT adaptation, the SMF sets the Capability for BAT adaptation in the TSCAI. When the SMF determines that the TSCAI contains the Capability for BAT adaptation without a BAT, the SMF enables notification control for the QoS Flow in order to receive the BAT offset along with the \"GFBR can no longer be guaranteed\" notification described in clause 5.7.2.4.\n-\tIf the TSC Assistance Container contains a Periodicity Range, the SMF sets and corrects the Periodicity Range in the same way it is described for the correction of the Periodicity above.\nDepending on whether the Time Domain is provided in the TSC Assistance container, SMF may perform the following:\n-\tthe SMF provisions the UPF/NW-TT to report the clock drifting between 5G clock and the external GM clock for the (g)PTP time domain number that is configured to the NW-TT.\n-\tthe SMF provisions the UPF/NW-TT to report the clock drifting between 5G clock and the external GM clock for the given Time Domain number.\nThe SMF uses the N4 Association Setup or Update procedures as described in clause 4.4.3 of TS 23.502 [3] to provision the UPF to report the clock drifting.\nIf the SMF has clock drift information for a Time Domain and if the Time Domain matches with the Time Domain in the TSC Assistance Container (i.e. clock drift between 5G timing and AF supplied Time Domain determined based on UPF reporting), or Time Domain information is not provided in the TSC Assistance Container, then the SMF may adjust the TSCAI information so that it reflects the 5GS Clock as described in clause 5.27.2.1.\nIf the SMF does not have synchronization information for a requested Time Domain in the TSC Assistance Container, or the Time Domain in the TSC Assistance Container is set to a value = \"5GS\", then the TSCAI information will be used without adjustment.\nIn the case of drift between external GM clock and 5G clock, the UPF updates the offset to SMF using the N4 Report Procedure as defined in clause 4.4.3.4 of TS 23.502 [3]. If the cumulative rateRatio is available and in the case of change of cumulative rateRatio between external PTP time and 5G time, the UPF updates the cumulative rateRatio to SMF using the N4 Report Procedure as defined in clause 4.4.3.4 of TS 23.502 [3]. The SMF may then trigger a PDU Session Modification as defined in clause 4.3.3 of TS 23.502 [3] in order to update the TSCAI to the NG-RAN without requiring AN or N1 specific signalling exchange with the UE.\nNOTE 4:\tIn order to prevent frequent updates from the UPF, the UPF sends the offset or the cumulative rateRatio only when the difference between the current measurement and the previously reported measurement is larger than a threshold as described in clause 4.4.3.4 of TS 23.502 [3].\nIf the NG-RAN receives a TSCAI containing a BAT Window or the Capability for BAT adaptation for a QoS Flow, the NG-RAN can determine a BAT offset in order to align the arrival of the traffic bursts with the next expected transmission opportunity over the air interface in each direction (i.e. DL or UL). The BAT offset can take a positive or a negative values.\nIf the NG-RAN receives a TSCAI containing a Periodicity Range for a QoS Flow, the NG-RAN can determine an adjusted Periodicity along with above specified BAT offset, in order to align the periodicity of the traffic bursts with the expected time interval between subsequent transmission opportunities over the air interface in each direction (i.e. DL or UL). If the TSCAI contained a value range, the adjusted Periodicity should be any value between the lower bound and upper bound. If the TSCAI contained a list of Periodicity value(s), the adjusted Periodicity should be one of these values.\nNG-RAN may support the following feedback mechanisms:\n-\tProactive RAN feedback for adaptation of Burst Arrival Time and Periodicity: NG-RAN may provide a Burst Arrival Time offset and an adjusted Periodicity as part of QoS flow establishment or modification as illustrated in clause 5.27.2.5.2;\n-\tReactive RAN feedback for Burst Arrival Time adaptation: NG-RAN may provide a Burst Arrival Time offset after QoS flow establishment as illustrated in clause 5.27.2.5.3.\nIf the NG-RAN receives a Burst Arrival Time and Burst Arrival Time Window in the TSCAI for a QoS Flow, the 5GS will perform the following actions:\n-\tThe NG-RAN can determine a BAT offset in order to align the expected arrival of the traffic bursts (as indicated in the BAT) with the time when the next transmission over the air interface in each direction (i.e. DL or UL) is expected. The BAT offset shall always be provided by NG-RAN and it shall be within the BAT Window. The BAT offset is calculated with reference to the BAT.\n-\tIf the BAT offset is provided from NG-RAN to the SMF in the response to the QoS Flow establishment or modification request, the SMF provides the BAT offset to the PCF and the PCF notifies the AF as described in clause 6.1.3.23a of TS 23.503 [45].\n-\tThe SMF may adjust the BAT offset received from NG-RAN based on the clock drifting report from UPF as specified in clause 4.4.3.4 of TS 23.502 [3].\nNOTE:\tThe feedback from RAN implies that the RAN accepts the BAT offset. If the AF requested BAT is acceptable for NG-RAN, the NG-RAN provides a BAT offset of zero.\n-\tIf the RAN also receives a Periodicity Range along with the Periodicity in the TSCAI for a QoS flow, the 5GS will further perform the following actions:\n-\tThe RAN may determine an adjusted periodicity in order to align the periodicity of the traffic bursts with the expected time interval between subsequent transmission opportunities over the air interface in each direction (i.e. DL or UL). If the RAN determines an adjusted periodicity, the RAN provides it together with a BAT offset mentioned above. The adjusted periodicity shall be within the Periodicity Range and the BAT offset is based on the adjusted periodicity.\n-\tThe adjusted periodicity is forwarded to the AF via the SMF and the PCF together with a BAT offset in the same way it is described above.\n-\tIf interworking with a TSN network deployed in the transport network is supported, the SMF/CUC uses the adjusted periodicity (if provided) and BAT offset accepted by the RAN to adjust the EarliestTransmitOffset and LatestTransmitOffset in the Talker/Listener Group in IEEE Std 801.Q [98] as described in Annex M, clause M.1.\nIf the RAN receives the capability for BAT adaptation without a Burst Arrival Time in the TSCAI and notification control is enabled for this QoS Flow, the 5GS will perform the following actions:\n-\tIf NG-RAN determines that the PDB of the QoS flow cannot be fulfilled in DL and UL direction, then if supported, NG-RAN shall determine a BAT offset value which reduces the time between the arrival of the traffic bursts and the time of the next possible transmission over the air interface for DL and UL, respectively. NG-RAN shall not provide a BAT offset with the same value until the PDB of the QoS Flow can be fulfilled again.\nNOTE:\tNG-RAN determines BAT offset value in reference to the current arrival time of the bursts experienced by RAN in DL and by UE in UL. Further details on BAT offset determination for DL and UL will be defined by RAN WG2.\n-\tThe BAT offset is provided from NG-RAN to the SMF when sending the notification towards the SMF that the \"GFBR can no longer be guaranteed\" described in clause 5.7.2.4. The SMF provides the BAT offset to the PCF and the PCF provides the BAT offset to the AF as part of notifying the AF as described in clause 6.1.3.23a of TS 23.503 [45]\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.27.2-1: TSC Assistance Information (TSCAI)",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 5.27.2-2: TSC Assistance Container (TSCAC)",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "5.27.3\tSupport for TSC QoS Flows",
                            "text_content": "TSC QoS Flows use a Delay-critical GBR resource type and TSC Assistance Information. TSC QoS Flows may use standardized 5QIs, pre-configured 5QIs or dynamically assigned 5QI values (which requires signalling of QoS characteristics as part of the QoS profile) as specified in clause 5.7.2. For each instance of Periodicity, within each Period (defined by periodicity value), TSC QoS Flows are required to transmit only one burst of maximum size MDBV within the 5G-AN PDB. Known QoS Flow traffic characteristics provided in the TSCAI may be used to optimize scheduling in the 5GS.\nThe following is applicable for the QoS profile defined for TSC QoS Flows:\n1.\tThe TSC Burst Size may be used to set the MDBV as follows:\nThe maximum TSC Burst Size is considered as the largest amount of data within a time period that is equal to the value of 5G-AN PDB of the 5QI. The maximum value of TSC Burst Size should be mapped to a 5QI with MDBV that is equal or higher. When integration with IEEE TSN applies, this 5QI also shall have a PDB value that satisfies the bridge delay capabilities (see clause 5.27.5 for more details) reported for the corresponding traffic class. For TSC QoS Flows, the Maximum Burst Size of the aggregated TSC streams to be allocated to this QoS Flow can be similarly mapped to a 5QI with MDBV value that is equal or higher. If interworking with a TSN network deployed in the transport network is supported, the maximum value of TSC Burst Size should be mapped to a 5QI with MDBV that is equal.\n2.\tThe PDB is explicitly divided into 5G-AN PDB and CN PDB as described in clause 5.7.3.4. Separate delay budgets are necessary for calculation of expected packet transmit times on 5G System interfaces. For the TSC QoS Flow, the5G-AN PDB is set to value of 5QI PDB minus the CN PDB as described in clause 5.7.3.4. The CN PDB may be static value or dynamic value and is up to the implementation of 5GS bridge.\n3.\tWhen integration with IEEE TSN applies, the Maximum Flow Bitrate calculated by the TSN AF as per Annex I.1 may be used to set GBR. In this case, MBR is set equal to GBR.\n4.\tARP is set to a pre-configured value.\n5.\t5QI value is derived using QoS mapping tables and TSN QoS information as described in clause 5.28.4 in the case of integration with IEEE TSN network, or using QoS Reference parameters and Requested PDB, Burst Size, Priority parameters as described in clause 4.15.6.6 or clause 4.15.6.6a of TS 23.502 [3] in the case of AF requested Time Sensitive Communication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.27.4\tHold and Forward Buffering mechanism",
                            "text_content": "DS-TT ports and NW-TT ports support a hold and forward mechanism to schedule traffic as defined in IEEE Std 802.1Q [98] if 5GS is to participate transparently as a bridge in a TSN network. That is, the hold and forward buffering mechanism in this release of the specification provides externally observable behaviour identical to scheduled traffic with up to eight queues (clause 8.6.8.4 in IEEE Std 802.1Q [98]) and with protected windows (Annex Q.2 in IEEE Std 802.1Q [98]). Frames are only transmitted from a given buffer according to the open time interval of the corresponding transmission gate; otherwise, frames are hold back (which corresponds to a closed transmission gate). The protected windows scheme implies that only a single transmission gate is open at any single time. Thus, the Hold and Forward buffering mechanism allows PDB based 5GS QoS to be used for TSC traffic.\nFor Ethernet frames that contain a VLAN tag, DS-TT and NW-TT determine the priority based on the PCP value contained in the VLAN tag. For Ethernet frames that do not contain a VLAN tag, DS-TT and NW-TT apply a priority value of 0.\nTo achieve externally observable behaviour according to the protected windows scheme, 5GS provides AdminControlList, AdminBaseTime, AdminCycleTime and TickGranularity as defined in IEEE Std 802.1Q [98] on a per Ethernet port basis to DS-TT and NW-TT for the hold and forward buffering mechanism as described in clause 5.28.3.\nNOTE:\tThe details of how Hold and Forward buffering mechanism is provided by the DS-TT and NW-TT is up to implementation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.27.5\t5G System Bridge delay",
                            "text_content": "This clause applies if 5GS is integrated as a bridge into an IEEE TSN network.\nIn order for the 5G System to participate as a TSN bridge according to transmission gate schedules specified, the 5GS Bridge is required to provide Bridge Delays as defined in IEEE Std 802.1Q [98] for each port pair and traffic class of the 5GS bridge to an IEEE 802.1 TSN system. In order to determine 5GS Bridge Delays, the following components are needed:\n1.\tUE-DS-TT Residence Time.\n2.\tPer traffic class minimum and maximum delays between the UE and the UPF/NW-TT that terminates the N6 interface (including UPF and NW-TT residence times), independent of frame length that a given 5GS deployment supports. The per-traffic class delays between the UE and the UPF/NW-TT are pre-configured in the TSN AF (see clause 5.28.4).\nThe TSN AF calculates the 5GS independentDelayMin and independentDelayMax values for each port pair and for each traffic class using the above components. If the UE-DS-TT Residence Time has not been provided by the UE, then the TSN AF uses a locally configured minimum UE-DS-TT Residence Time for the calculation of independentDelayMin and a locally configured maximum UE-DS-TT Residence Time for the calculation of independentDelayMax.\nThe dependentDelayMin and dependentDelayMax for 5GS Bridge specify the time range for a single octet of an Ethernet frame to transfer from ingress to egress and include the time to receive and store each octet of the frame, which depends on the link speed of the ingress Port as per IEEE Std 802.1Q [98].\nNOTE:\tFurther details how TSN AF determines dependentDelayMin and dependentDelayMax are up to implementation.\nSince residence times may vary among UEs and per traffic class delay between the UE and the UPF/NW-TT may vary among UPFs, the 5GS Bridge Delay is determined after the PDU Session Establishment for the corresponding UPF and the UE by the TSN AF. The TSN AF deduces the related port pair(s) from the port number of the DS-TT Ethernet port and port number of the NW-TT Ethernet port(s) of the same 5GS Bridge when the TSN AF receives the 5GS Bridge information for a newly established PDU Session and calculates the bridge delays per port pair. Additionally, TSN AF deduces the port pair(s) consisting of two DS-TT ports connecting to the same 5GS bridge and determines the 5GS bridge delay as sum of bridge delays related to PDU Sessions of two DS-TT ports.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.28\tSupport of integration with TSN, Time Sensitive Communications, Time Synchronization and Deterministic Networking",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.28.0\tGeneral",
                            "text_content": "Clause 5.28 defines the 5GS integration in TSN DN as a 5GS bridge.\nIn this scenario, 5GS is deployed in a TSN DN to provide wireless connectivity. From the perspective of the TSN DN, the 5GS is modelled as a Layer 2 Ethernet Bridge of the TSN DN.\nIn addition to supporting interoperation with TSN, 5GS also supports Time Sensitive Communication, Time Synchronization and integration with Deterministic Networking.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.1\t5GS bridge management for TSN",
                            "text_content": "5GS acts as a Layer 2 Ethernet Bridge. When integrated with IEEE TSN network, 5GS functions acts as one or more TSN Bridges of the TSN network. The 5GS Bridge is composed of the ports on a single UPF (i.e. PSA) side, the user plane tunnel between the UE and UPF, and the ports on the DS-TT side. For each 5GS Bridge of a TSN network, the port on NW-TT support the connectivity to the TSN network, the ports on DS-TT side are associated to the PDU Session providing connectivity to the TSN network.\nThe granularity of the 5GS TSN bridge is per UPF for each network instance or DNN/S-NSSAI. The bridge ID of the 5GS TSN bridge is bound to the UPF ID of the UPF as identified in TS 23.502 [3]. The TSN AF stores the binding relationship between a port on UE/DS-TT side and a PDU Session during reporting of 5GS TSN bridge information. The TSN AF also stores the information about ports on the UPF/NW-TT side. The UPF/NW-TT forwards traffic to the appropriate egress port based on the traffic forwarding information. From the TSN AF point of view, a 5GS TSN bridge has a single NW-TT entity within UPF and the NW-TT may have multiple ports that are used for traffic forwarding.\nNOTE 1:\tHow to realize single NW-TT entity within UPF is up to implementation.\nNOTE 2:\tEthernet PDU Session type in this release of the specification may be subject to the constraint that it supports a single N6 interface in a UPF associated with the N6 Network Instance.\nThere is only one PDU Session per DS-TT port for a given UPF. All PDU Sessions which connect to the same TSN network via a specific UPF are grouped into a single 5GS bridge. The capabilities of each port on UE/DS-TT side and UPF/NW-TT side are integrated as part of the configuration of the 5GS Bridge and are notified to TSN AF and delivered to CNC for TSN bridge registration and modification.\nNOTE 3:\tIt is assumed that all PDU Sessions which connect to the same TSN network via a specific UPF are handled by the same TSN AF.\nThe figure depicts a 5G-based 5G-PPP (Per UPF) bridge, which is a type of 5G-PPP-based 5G-PPP (Per UPF) bridge. It is designed to support 5G-PPP (Per UPF) and 5G-PPP-based 5G-PPP (Per UPF) services. The bridge is equipped with various components such as 5G-PPP-based 5G-PPP (Per UPF) and 5G-PPP-based 5G-PPP (Per UPF) modules, as well as 5G-PPP-based 5G-PPP (Per UPF) and 5G-PPP-based 5G-PPP (Per UPF) modules. The bridge is designed to support 5G-PPP (Per UPF) and 5G-PPP-based 5G-PPP (Per UPF) services, and it is equipped with various components such as 5G-PPP-based 5G-PPP (Per UPF) and 5G-PPP-based\nFigure 5.28.1-1: Per UPF based 5GS bridge\nNOTE 4:\tIf a UE establishes multiple PDU Sessions terminating in different UPFs, then the UE is represented by multiple 5GS TSN bridges.\nIn order to support IEEE 802.1Q features related to TSN, including TSN scheduled traffic (clause 8.6.8.4 in IEEE Std 802.1Q [98]) over 5GS Bridge, the 5GS supports the following functions:\n-\tConfigure the bridge information in 5GS.\n-\tReport the bridge information of 5GS Bridge to TSN network after PDU Session establishment.\n-\tReceiving the configuration from TSN network as defined in clause 5.28.2.\n-\tMap the configuration information obtained from TSN network into 5GS QoS information (e.g. 5QI, TSC Assistance Information) of a QoS Flow in corresponding PDU Session for efficient time-aware scheduling, as defined at clause 5.28.2.\nThe bridge information of 5GS Bridge is used by the TSN network to make appropriate management configuration for the 5GS Bridge. The bridge information of 5GS Bridge includes at least the following:\n-\tInformation for 5GS Bridge:\n-\tBridge ID\nBridge ID is to distinguish between bridge instances within 5GS. The Bridge ID can be derived from the unique bridge MAC address as described in IEEE Std 802.1Q [98], or set by implementation specific means ensuring that unique values are used within 5GS;\n-\tNumber of Ports;\n-\tlist of port numbers.\n-\tCapabilities of 5GS Bridge as defined in IEEE Std 802.1Q [98]:\n-\t5GS Bridge delay per port pair per traffic class, including 5GS Bridge delay (dependent and independent of frame size, and their maximum and minimum values: independentDelayMax, independentDelayMin, dependentDelayMax, dependentDelayMin), ingress port number, egress port number and traffic class.\n-\tPropagation delay per port (txPropagationDelay), including transmission propagation delay, egress port number.\n-\tVLAN Configuration Information.\nNOTE 5:\tThis Release of the specification does not support the modification of VLAN Configuration Information at the TSN AF.\n-\tTopology of 5GS Bridge as defined in IEEE Std 802.1AB [97]:\n-\tLLDP Configuration Information.\n-\tChassis ID subtype and Chassis ID of the 5GS Bridge.\n-\tLLDP Discovery Information for each discovered neighbor of each NW-TT port and DS-TT port.\n-\tTraffic classes and their priorities per port as defined in IEEE Std 802.1Q [98].\n-\tStream Parameters as defined in clause 12.31.1 in IEEE Std 802.1Q [98], in order to support PSFP:\n-\tMaxStreamFilterInstances: The maximum number of Stream Filter instances supported by the bridge;\n-\tMaxStreamGateInstances: The maximum number of Stream Gate instances supported by the bridge;\n-\tMaxFlowMeterInstances: The maximum number of Flow Meter instances supported by the bridge (optional);\n-\tSupportedListMax: The maximum value supported by the bridge of the AdminControlListLength and OperControlListLength parameters.\nThe following parameters: independentDelayMax and independentDelayMin, how to calculate them is left to implementation and not defined in this specification.\nDS-TT and NW-TT report txPropagationDelay to the TSN AF relative to the time base of the TSN GM clock (identified by the TSN time domain number received in PMIC). If the TSN AF has subscribed for notifications on txPropagationDelay and if the difference to the previously reported txPropagationDelay is larger than the txPropagationDelayDeltaThreshold received in PMIC, the corresponding DS-TT or NW-TT informs the TSN AF about the updated txPropagationDelay using PMIC signalling.\nNOTE 6:\tConfiguration of TSN time domain number and txPropagationDelayDeltaThreshold via PMIC is optional for NW-TT. NW-TT can instead be pre-configured with the threshold and the single time domain that is used by the CNC for bridge configuration and reporting.\nBridge ID of the 5GS Bridge, port number(s) of the Ethernet port(s) in NW-TT could be preconfigured on the UPF. The UPF is selected for a PDU Session serving TSC as described in clause 6.3.3.3.\nThis release of the specification requires that each DS-TT port is assigned with a globally unique MAC address.\nNOTE 7:\tThe MAC address of the DS-TT port must not be used in user data traffic; it is used for identification of the PDU Session and the associated bridge port within the 3GPP system.\nWhen there are multiple network instances within a UPF, each network instance is considered logically separate. The network instance for the N6 interface (clause 5.6.12) may be indicated by the SMF to the UPF for a given PDU Session during PDU Session establishment. UPF allocates resources based on the Network Instance and S-NSSAI and it is supported according to TS 29.244 [65]. DNN/S-NSSAI may be indicated by the SMF together with the network instance to the UPF for a given PDU Session during PDU Session establishment procedure.\nThe TSN AF is responsible to receive the bridge information of 5GS Bridge from 5GS, as well as register or update this information to the CNC.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.2\t5GS Bridge configuration for TSN",
                            "text_content": "The configuration information of 5GS Bridge as defined in clause 8.6.8.4 of IEEE Std 802.1Q [98], includes the following:\n-\tBridge ID of 5GS Bridge.\n-\tConfiguration information of scheduled traffic on ports of DS-TT and NW-TT:\n-\tEgress ports of 5GS Bridge, e.g. ports on DS-TT and NW-TT;\n-\tTraffic classes and their priorities.\nNOTE 1:\tIn this Release of the specification, scheduled traffic (clause 8.6.8.4 in IEEE Std 802.1Q [98]) is only supported with protected windows, (see clause Q.2 in IEEE Std 802.1Q [98]), therefore, it is enough to support AdminControlList, AdminBaseTime, AdminCycleTime and TickGranularity for the configuration of the 5GS.\nThe configuration information of 5GS Bridge as defined in IEEE Std 802.1Q [98], includes the following:\n-\tChassis ID of 5GS Bridge;\n-\tTraffic forwarding information as defined in clause 8.8.1 of IEEE Std 802.1Q [98]:\n-\tDestination MAC address and VLAN ID of TSN stream;\n-\tPort number in the Port MAP as defined in clause 8.8.1 of IEEE Std 802.1Q [98].\n-\tConfiguration information per stream according to clause 8.6.5.1 of IEEE Std 802.1Q [98] including:\n-\tStream filters.\n-\tStream gates.\nNOTE 2:\tIn order to support clause 8.6.5.2.1 of IEEE Std 802.1Q [98], it is required to support the Stream Identification function as specified by IEEE Std 802.1CB [83].\nThe SMF report the MAC address of the DS-TT port of the related PDU Session to TSN AF via PCF. The association between the DS-TT MAC address, 5GS Bridge ID and port number on DS-TT is maintained at TSN AF and further used to assist to bind the TSN traffic with the UE's PDU session.\nTwo models are supported to configure 5GS QoS for TSN traffic:\n-\tBased on the assumption that PSFP information is always provided by CNC: In this case the QoS Flows are setup based on the PSFP information provided by CNC;\nNOTE 3:\tPSFP information may be provided by CNC if TSN AF has declared PSFP support to CNC. TSN AF indicates the support for PSFP to CNC only if each DS-TT and NW-TT of the 5GS bridge has indicated support of PSFP.\n-\tWithout requiring PSFP information provided by the CNC.: In this case, pre-configured QoS Flows are used and configured e.g. during PDU session establishment as described in clause 5.28.4. Additional QoS Flows are setup as necessary based on the PSFP, if available, as described in this clause.\nWhen PSFP information is available, TSN AF identifies the ingress and egress port for the TSN stream as described in Annex I and determines the DS-TT port MAC address(es) identifying the corresponding PDU session(s) carrying the TSN stream. Flow direction of a TSN stream is determined as follows: if the ingress port is a DS-TT port, then the Flow direction is UL; otherwise if the ingress port(s) is (are) NW-TT port, the Flow direction is DL. Flow direction is part of the TSCAI as defined in clause 5.27.2.\nThe TSN AF uses the stream filter instances of PSFP information to derive the service data flow for TSN streams. The TSN AF uses the Priority values in the stream filter instances in PSFP information (if available) as defined in clause 8.6.5.2.1 of IEEE Std 802.1Q [98], the 5GS bridge delay information (see clause 5.27.5) and may additionally use scheduled traffic information as defined in clause 8.6.8.4 of IEEE Std 802.1Q [98], to derive the TSN QoS information (i.e. priority and delay) for a given TSN stream or flow of aggregated TSN streams as specified in clause 5.28.4.\nThe TSN AF identifies the egress port(s) for the TSN stream using local configuration or static filtering entry that matches the TSN stream. If the TSN AF determines that the TSN stream is for UE-UE communication (i.e. ingress and egress ports are in DS-TTs), the TSN AF divides the stream into one uplink stream and one or more downlink streams and provides the streams on AF Session basis to the PCF(s). The SMF applies local switching as specified in clause 5.8.2.13 or clause 5.8.2.5.3 in order to enable UPF locally forward uplink stream from one PDU session as downlink stream in another PDU session.\nWhen CNC configures the PSFP information to the TSN AF, TSN AF determines the TSC Assistance Container as described in clause 5.27.2. The TSN AF associates the TSN QoS information and TSC Assistance Container (if available) with the corresponding service data flow description and provides to the PCF and the SMF as defined in clause 6.1.3.23 of TS 23.503 [45].\nNOTE 4:\tWhen the TSN stream priority information from PSFP is not available (priority value in stream filters is set to wild card), in certain configurations it can be possible to use the scheduled traffic information as defined in clause 8.6.8.4 of IEEE Std 802.1Q [98] to derive the Priority of the TSN stream. For example, when there is a single downlink stream for a given DS-TT port, it can be possible to determine the affected DS-TT port in the downlink and the associated TSN stream priority based on the scheduled traffic information of the affected egress port, and to derive an estimated MDBV based on the gate open interval and the assumed ingress port bitrate.\nIf TSN AF provides PSFP and/or scheduled traffic information to DS-TT and NW-TT then DS-TT and NW-TT execute on this information relative to the time base of the TSN GM clock (identified by the TSN time domain number received in PMIC).\nNOTE 5:\tConfiguration of TSN time domain number via PMIC is optional for NW-TT. NW-TT can instead be pre-configured with the single time domain that is used by the CNC for bridge configuration and reporting.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.3\tPort and user plane node management information exchange in 5GS",
                            "text_content": "Port number for the PDU Session is assigned by the UPF during PDU session establishment. The port number for a PDU Session shall be reported to the SMF from the UPF and further stored at the SMF. The SMF provides the port number via PCF to the TSN AF or TSCTSF. TSN AF or TSCTSF maintains an association between the port number for the PDU Session and the DS-TT port MAC address (with Ethernet type PDU session) or IP address (applicable for TSCTSF only, with IP type PDU Session) of the UE. If a PDU session for which SMF has reported a port number to TSN AF or TSCTSF is released, then SMF informs TSN AF or TSCTSF accordingly. The port number for the PDU Session corresponds to the device side port of the 5GS bridge/router. When the device supports the DS-TT functionality, the port number represents the DS-TT port number corresponding to the given PDU Session.\nNOTE 1:\tPort number can refer either to Ethernet port or PTP port. In Ethernet type PDU Sessions, it is assumed that the PTP port number is the same as the associated Ethernet port number.\nWhen the DS-TT or the NW-TT functions are used, the 5GS shall support transfer of standardized and deployment-specific port management information transparently between TSN AF or TSCTSF and DS-TT or NW-TT, respectively inside a Port Management Information Container. NW-TT may support one or more ports. In this case, each port uses separate Port Management Information Container. 5GS shall also support transfer of standardized and deployment-specific user plane node management information transparently between TSN AF or TSCTSF and NW-TT, respectively inside a User Plane Node Management Information Container. Clause K.1 lists standardized port management information and user plane node management information, respectively.\nIf TSN AF is deployed, i.e. if 5GS is integrated with an IEEE TSN network, the port and user plane node management information is exchanged between CNC and TSN AF. The port management information is related to ports located in DS-TT or NW-TT. The user plane node management information container is related to 5GS bridge management.\nIf TSN AF is not deployed, the port and user plane node management information is exchanged between TSCTSF and DS-TT/NW-TT.\nNOTE 2:\tThe time synchronization parameters used in Port Management Information Container and User Plane Node Management Information Container are from IEEE Std 1588 [126], Edition 2019, and from IEEE Std 802.1AS [104]. Since the IEEE time synchronization data sets are not exposed, care needs to be taken when interoperating with devices supporting Edition 2008, IEEE Std 1588-2008 [107] (which can be the case when operating under the SMPTE profile, ST 2059-2:2015 [127]) and using a common management.\nExchange of port and user plane node management information between TSN AF or TSCTSF and NW-TT or between TSN AF or TSCTSF and DS-TT allows TSN AF or TSCTSF to:\n1)\tretrieve port management information for a DS-TT or NW-TT port or user plane node management information;\n2)\tsend port management information for a DS-TT or NW-TT port or user plane node management information;\n3)\tsubscribe to and receive notifications if specific port management information for a DS-TT or NW-TT port changes or user plane node management information changes.\n4)\tdelete selected entries in the following data structures:\n-\t\"DS-TT port neighbour discovery configuration for DS-TT port\" in UMIC using the DS-TT port number to reference the selected entry.\n-\t\"Stream Filter Instance Table\" in PMIC using the Stream Filter Instance ID to reference the selected entry.\n-\t\"Stream Gate Instance Table\" in PMIC using the Stream Gate Instance ID to reference the selected entry.\n-\t\"Static Filtering Entries table\" in UMIC using the (MAC address, VLAN ID) pair to reference the selected entry.\n5)\tdelete PTP Instances in a DS-TT port or NW-TT port using the PTP Instance ID to reference the selected entry as described in clause K.2.2.1.\nExchange of port management information between TSN AF or TSCTSF and NW-TT or DS-TT is initiated by DS-TT or NW-TT to:\n-\tnotify TSN AF or TSCTSF if port management information has changed that TSN AF or TSCTSF has subscribed for.\nExchange of user plane node management information between TSN AF or TSCTSF and NW-TT is initiated by NW-TT to:\n-\tnotify TSN AF or TSCTSF if user plane node management information has changed that TSN AF or TSCTSF has subscribed for.\n-\tnotify TSCTSF if time synchronization status information of UPF has changed that the TSCTSF has subscribed for.\nExchange of port management information is initiated by DS-TT to:\n-\tprovide port management capabilities, i.e. provide information indicating which standardized and deployment-specific port management information is supported by DS-TT.\nTSN AF or TSCTSF indicates inside the Port Management Information Container or user plane node Management Information Container whether it wants to retrieve or send port or user plane node management information or intends to (un-)subscribe for notifications. If the TSN AF or TSCTSF has requested to receive notification of TSC management information and both SMF and UPF support direct reporting, the UPF may directly report TSC management information to the TSN AF or TSCTSF using Nupf_EventExposure_Notify.\nPort management information is transferred transparently via 5GS between TSN AF or TSCTSF and DS-TT or NW-TT, respectively, inside a Port Management Information Container (PMIC). User plane node management information is transferred transparently via 5GS between TSN AF or TSCTSF and NW-TT inside a user plane node Management Information Container (UMIC). The transfer of port or user plane node management information is as follows:\n-\tTo convey port management information from DS-TT or NW-TT to TSN AF or TSCTSF:\n-\tDS-TT provides a PMIC and the DS-TT port MAC address (if available) to the UE, which includes the PMIC as an optional Information Element of an N1 SM container and triggers the UE requested PDU Session Establishment procedure or PDU Session Modification procedure to forward the PMIC to the SMF. SMF forwards the PMIC and the port number of the related DS-TT port to TSN AF or TSCTSF as described in clauses 4.3.2.2 and 4.3.3.2 of TS 23.502 [3];\n-\tNW-TT provides PMIC(s) and/or UMIC to the UPF, which may trigger the N4 Session Level Reporting Procedure to forward the PMIC(s) and/or UMIC to SMF. UPF selects an N4 session corresponding to any of the N4 sessions for this NW-TT. SMF in turn forwards the PMIC(s) and the port number(s) of the related NW-TT port(s), or the UMIC, to TSN AF or TSCTSF as described in clause 4.16.5.1 of TS 23.502 [3].\n-\tNW-TT may provide PMIC(s) and/or UMIC to the UPF, which may trigger UPF Event Exposure Notification to forward the PMIC(s) and/or UMIC to TSN AF or TSCTSF. UPF directly reports TSC management information event via Nupf_EventExposure_Notify service operation as described in clause 5.2.26.2 of TS 23.502 [3].\nNOTE 1:\tThere has to be at least one established PDU session for DS-TT port before the UPF can report PMIC/UMIC information towards the TSN AF or TSCTSF.\n-\tTo convey port management information from TSN AF or TSCTSF to DS-TT:\n-\tTSN AF or TSCTSF provides a PMIC, DS-TT port MAC address or UE IP address (applicable for TSCTSF only) reported for a PDU Session (i.e. MAC address of the DS-TT port or IP address related to the PDU session) and the port number of the DS-TT port to manage to the PCF by using the AF Session level Procedure, which forwards the information to SMF based on the MAC or IP address using the PCF initiated SM Policy Association Modification procedure as described in clause 4.16.5.2 of TS 23.502 [3]. SMF determines that the port number relates to a DS-TT port and based on this forwards the PMIC to DS-TT using the network requested PDU Session Modification procedure as described in clause 4.3.3.2 of TS 23.502 [3].\n-\tTo convey port or user plane node management information from TSN AF or TSCTSF to NW-TT:\n-\tTSN AF or TSCTSF selects a PCF-AF session corresponding to any of the DS-TT MAC or IP addresses (applicable for TSCTSF only) for the related PDU sessions of this bridge or router and provides a PMIC(s) and the related NW-TT port number(s) and/or UMIC to the PCF. The PCF uses the PCF initiated SM Policy Association Modification procedure to forward the information received from TSN AF or TSCTSF to SMF as described in clause 4.16.5.2 of TS 23.502 [3]. SMF determines that the included information needs to be delivered to the NW-TT either by determining that the port number(s) relate(s) to a NW-TT port(s) or based on the presence of UMIC, and forwards the container(s) and/or related port number(s) to NW-TT using the N4 Session Modification procedure described in clause 4.4.1.3 of TS 23.502 [3].\nThe CNC obtains the 5GS bridge VLAN configuration from TSN AF according to clause 12.10.1.1 of IEEE Std 802.1Q [98]. The TSN AF and UPF/NW-TT are pre-configured with same 5GS bridge VLAN configuration.\nNOTE:\tIn this Release, the VLAN Configuration Information are pre-configured at the TSN AF and the NW-TT and is not exchanged between the TSN AF and the UPF/NW-TT.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.4\tQoS mapping tables for TSN",
                            "text_content": "The mapping tables between the traffic class and 5GS QoS Profile is provisioned and further used to find suitable 5GS QoS profile to transfer TSN traffic over the PDU Session. QoS mapping procedures are performed in two phases: (1) QoS capability report phase as described in clause 5.28.1, and (2) QoS configuration phase as in clause 5.28.2\n(1)\tThe TSN AF shall be pre-configured (e.g. via OAM) with a mapping table. The mapping table contains TSN traffic classes, pre-configured bridge delays (i.e. the preconfigured delay between UE and UPF/NW-TT) and priority levels. Once the PDU session has been setup and after retrieving the information related to UE-DS-TT residence time, the TSN AF deduces the port pair(s) in the 5GS bridge and determines the bridge delay per port pair per traffic class based on the pre-configured bridge delay and the UE-DS-TT residence time as described in clause 5.27.5. The TSN AF updates bridge delays per port pair and traffic class and reports the bridge delays and other relevant TSN information such as the Traffic Class Table (clause 12.6.3 in IEEE Std 802.1Q [98]) for every port, according to the IEEE Std 802.1Q [98] to the CNC.\n(2)\tCNC may distribute PSFP information and transmission gate scheduling parameters to 5GS Bridge via TSN AF, which can be mapped to TSN QoS requirements by the TSN AF.\nThe PCF mapping table provides a mapping from TSN QoS information (see clauses 6.2.1.2 and 6.1.3.23 of TS 23.503 [45]) to 5GS QoS profile. Based on trigger from TSN AF, the PCF may trigger PDU session modification procedure to establish a new 5G QoS Flow or use the pre-configured 5QI for 5G QoS Flow for the requested traffic class according to the selected QoS policies and the TSN AF traffic requirements.\nFigure 5.28.4-1 illustrates the functional distribution of the mapping tables.\nThe figure depicts a QoS mapping function distribution between PCF (Point-to-Point Function) and TSN (Time-Sensitive Networking) AF (Access Function) in a network. The QoS mapping function is a crucial component in ensuring reliable and efficient communication, with PCF responsible for low-latency and high-throughput data transmission, and TSN AF for high-throughput and low-latency data transmission. The figure illustrates the distribution of QoS mapping functions between these two functions, highlighting the importance of proper mapping in ensuring QoS requirements are met in a network.\nFigure 5.28.4-1: QoS Mapping Function distribution between PCF and TSN AF\nThe minimum set of TSN QoS-related parameters that are relevant for mapping the TSN QoS requirements are used by the TSN AF: traffic classes and their priorities per port, TSC Burst Size of TSN streams, 5GS bridge delays per port pair and traffic class (independentDelayMax, independentDelayMin, dependentDelayMax, dependentDelayMin), propagation delay per port (txPropagationDelay) and UE-DS-TT residence time.\nOnce the CNC retrieves the necessary information, it proceeds to calculate scheduling and paths. The configuration information is then set in the bridge as described in clauses 5.28.2 and 5.28.3. The most relevant information received is the PSFP information and the schedule of transmission gates for every traffic class and port of the bridge. At this point, it is possible to retrieve the TSN QoS requirements by identifying the traffic class of the TSN stream. The traffic class to TSN QoS and delay requirement (excluding the UE-DS-TT residence time) mapping can be performed using the QoS mapping table in the TSN AF as specified in TS 23.503 [45]. Subsequently in the PCF, the 5G QoS Flow can be configured by selecting a 5QI as specified in TS 23.503 [45]. This feedback approach uses the reported information to the CNC and the feedback of the configuration information coming from the CNC to perform the mapping and configuration in the 5GS.\nIf the Maximum Burst Size of the aggregated TSC streams in the traffic class is provided by CNC via TSN AF to PCF, PCF can derive the required MDBV taking the Maximum Burst Size as input. If the default MDBV associated with a standardized 5QI or a pre-configured 5QI in the QoS mapping table cannot satisfy the aggregated TSC Burst Size, the PCF provides the derived MDBV in the PCC rule and then the SMF performs QoS Flow binding as specified in clause 6.1.3.2.4 of TS 23.503 [45].\nMaximum Flow Bit Rate is calculated over StreamGateAdminCycleTime as described in Annex I and provided by the TSN AF to the PCF. The PCF sets the GBR and MBR values to the Maximum Flow Bitrate value.\nThe Maximum Flow Bit Rate is adjusted according to Averaging Window associated with a pre-configured 5QI in the QoS mapping table or another selected 5QI (as specified in TS 23.503 [45]) to obtain GBR of the 5GS QoS profile. GBR is then used by SMF to calculate the GFBR per QoS Flow. QoS mapping table in the PCF between TSN parameters and 5GS parameters should match the delay, aggregated TSC burst size and priority, while preserving the priorities in the 5GS. An operator enabling TSN services via 5GS can choose up to eight traffic classes to be mapped to 5GS QoS profiles.\nOnce the 5QIs to be used for TSN streams are identified by the PCF as specified in TS 23.503 [45], then it is possible to enumerate as many bridge port traffic classes as the number of selected 5QIs.\nWhen PSFP information is not available to the TSN AF for a given TSN stream (e.g. because of lack of PSFP support in the DS-TTs or the NW-TTs, or exceeding the number of supported table entries for PSFP functions, or because CNC does not provide PSFP information), the 5GS can support the TSN streams using pre-configured mapping from stream priority (i.e. PCP as defined in IEEE Std 802.1Q [98]) to QoS Flows.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28.5\tSupport of integration with IETF Deterministic Networking",
                            "text_content": "5GS acts as a DetNet Router according to the architecture defined in clause 4.4.8.4. When integrated with an IETF Deterministic Network, 5GS acts as one or more routers. A 5GS router is composed of the ports on a single UPF (i.e. PSA) network side, the user plane tunnel between the UE and UPF, and the ports on the device side. For each 5GS router of a deterministic network, the ports on the network side and the ports on device side that are associated to the PDU Sessions support connectivity to the deterministic network.\nThe granularity of the 5GS DetNet node is per UPF for each network instance or DNN/S-NSSAI. The TSCTSF stores the binding relationship between a device side port and a PDU Session identified by the UE address. The TSCTSF also stores information about ports on the UPF/NW-TT side.\nThe integration with IETF Deterministic Networking assumes the following.\n-\tThe existing 3GPP routing mechanisms are re-used for DetNet.\n-\tThe existing multicast capabilities can be re-used for DetNet communications.\n-\tThe 5GS integration to IETF DetNet is based on DetNet for IP; DetNet for MPLS is not supported.\n-\tIPbased DetNet traffic is carried in IPtype PDU Sessions.\n-\t5GS functions realize the DetNet forwarding sub-layer. For the IP case, according to clause 1 of IETF RFC 8939 [157], no service sub-layer function needs to be defined. The 5GS DetNet Router acts as a DetNet transit node as defined in IETF RFC 8655 [150].\nThe interface between the TSCTSF and the DetNet controller uses protocols defined in IETF. The DetNet configuration is carried in the YANG model [154] over Netconf [155] or Restconf [156].\nThe TSCTSF may provide exposure information to the DetNet controller using information collected from the 5GS entities. The exposure information can be used by the DetNet controller to build up the network topology information. The exposure may be based on IETF RFC 8343 [151] and IETF RFC 8344 [152].\nThe TSCTSF may collect the information from the UPF/NW-TT via parameters in PMIC as defined in clause 5.28.3.1. For the device side ports, the TSCTSF collects information using parameters provided from SMF to TSCTSF via PCF as described in clause 6.1.3.23b of TS 23.503 [45].\nWhen the MTU size for IPv4 or IPv6 is not provided to TSCTSF for a port, the TSCTSF may use a pre-configured default value for IPv4 or IPv6.\nIn the case of network side ports, the TSCTSF may collect information on the type of the interface (defined in IETF RFC 8343 [151], with values defined in IETF RFC 7224 [153]) associated with the port. In the case of device side ports, which correspond to the PDU Sessions that are reported to the TSCTSF, the default value of \"3GPP WWAN\" (wwanPP) for the interface type is assumed. The TSCTSF can differentiate network side ports as they are reported from the NW-TT within UMIC/PMIC, while device side ports correspond to the PDU Sessions, reported to the TSCTSF in the associated AF sessions.\nFor device side ports also information on IP addresses or IP prefixes not directly assigned to the port but reachable via the port may be provided. On the device side ports, these are related to Framed Routes, i.e. a range of IPv4 addresses or IPv6 prefixes reachable over a single PDU Session, as defined in clause 5.6.14, or prefixes delegated by IPv6 prefix delegation as defined in clause 5.8.2.2. This additional information helps both the TSCTSF and the DetNet controller to map flows to the correct UE address as described in clause 5.28.5.3. For the network side ports, the TSCTSF may also collect information on the link layer address and neighbor IP nodes.\nThe ports are identified by the port number within the 3GPP system. The port number may also be used to generate interface identifiers towards the DetNet controller that are unique within the 5GS node.\nNOTE 1:\tOne possibility to generate unique interface identifiers towards the DetNet controller is to use the port number as the if-Index as defined in IETF RFC 8343 [151]. Based on the if-Index, an interface name is generated, e.g. by using the if-Index as a string, possibly adding a substring prefix or postfix based on configuration. The if-Index and the name of the interface contain essentially the same information, but both can be provided, since the name is used as the key in the YANG model, while if-Index is usually considered as the basis for interface management of IP nodes.\nThe TSCTSF may use the user-plane node ID provided by the UPF to generate an identifier of the 5GS node that is provided to the DetNet controller.\nNOTE 2:\tThe 5GS node identification can be realized by providing an identifier of the 5GS node to the DetNet controller, or the TSCTSF can use different termination points (addresses) for the signalling between the DetNet controller and the TSCTSF.\nFor network side ports, the information is transferred in PMIC between the NW-TT and the TSCTSF. For device side ports, the information is transferred without relying on PMIC, using parameters from the SMF via the PCF to the TSCTSF.\nThe TSCTSF maps the parameters in the DetNet YANG configuration to 5GS parameters as defined in clause 6.1.3.23b of TS 23.503 [45].\nThe TSCTSF determines the UE address to bind the DetNet configuration as follows:\n-\tWhen available, the TSCTSF uses the identity of the incoming and outgoing interface to determine the affected UE address and whether the flow is uplink or downlink or UE-to-UE.\n-\tIf there is no incoming interface for UL traffic, the TSCTSF may determine the UE address based on the source IP address of the UL traffic in the DetNet configuration, or using local configuration to map the DetNet flow information to the UE address. If there is no incoming interface for traffic with an outgoing interface on the device side, the TSCTSF may determine whether the flow is UE-to-UE based on the source IP address of the traffic in the DetNet configuration, or using local configuration.\nNOTE 1:\tThe incoming interface is optional in the DetNet YANG configuration. It is assumed that any IP prefix on the device side is reachable via, at most, a single device side interface. Thus if the flow source IP address is available and belongs to a prefix associated with a device side interface, that interface can be uniquely determined as the incoming interface for the flow.\nNOTE 2:\tIf there is no incoming interface for the UL traffic or no incoming interface for traffic with outgoing interface on the device side, the details on how the TSCTSF uses local configuration are not specified.\n-\tWhen the information on IP addresses or IP prefixes not directly assigned to the port but reachable via the port is available as described in clause 5.28.5.2, the TSCTSF also takes such info into account.\n-\tIf the flow is UE-to-UE, two PDU Sessions will be affected for the flow, and the TSCTSF breaks up the requirements to individual requirements for the PDU Sessions.\nThe TSCTSF provides a response to the DetNet controller regarding the success of the configuration setup. When both the TSCTSF and the DetNet controller support 3GPP extensions to the IETF draft-ietf-detnet-yang [154], the TSCTSF may provide 5GS specific status code information on the result of the configuration to the DetNet controller.\nNOTE 3:\tThe 3GPP extension to the IETF draft-ietf-detnet-yang [154] is defined in 3GPP as a YANG model which imports draft-ietf-detnet-yang [154] and adds the 3GPP specific parameters. The 3GPP defined YANG model uses the 3GPP namespace as defined in IETF RFC 5279 [158].\nIf the status of the flow changes later on for any reason, the TSCTSF notifies the DetNet controller. Upon release of a PDU Session that is part of the existing DetNet configuration, the PCF notifies the TSCTSF of the PDU Session release, and TSCTSF notifies the DetNet controller on the status of the flow.\nThe 5GS routing is not modified by the configuration received from the DetNet controller. Still the TSCTSF may verify whether the explicit routing information provided by the DetNet controller is in line with the 5GS mapping of IP addresses and prefixes to PDU sessions. The verification may be based on whether the source or destination IP address in the DetNet flow on the given port corresponds to the IP address or prefix associated with the given PDU Session. Based on operator configuration, the TSCTSF may use other criteria (not routing related) to determine whether to accept or reject a given DetNet configuration.\n5GS DetNet Node can forward via its device side interface IP packets destined not only to the UE's IP address or prefix but also to a range of IPv4 addresses or IPv6 IP prefixes according to one or more Framed Routes or prefixes delegated to the UE by IPv6 prefix delegation. To facilitate this, the additional IP addresses used for framed routes and IPv6 prefix delegation are exposed by the SMF to the TSCTSF via the PCF and the TSCTSF may expose them to the DetNet controller, as defined in clause 5.28.5.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.28a\tSupport for TSN enabled Transport Network",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.28a.1\tGeneral",
                            "text_content": "When the 5GS supports interworking with IEEE TSN deployed in the transport network, the CUC that is collocated with SMF interworks with the CNC in the transport network (TN CNC) as specified in clause 46.2 of IEEE Std 802.1Q [98]. The SMF/CUC provides the stream requirements on QoS Flow basis (i.e. translated Talker group and Listener group information) via the User/Network-Interface (UNI) to the TN CNC. The TN CNC uses the stream requirements as input to configure respective path(s) and schedules in TN. Based on the results, the TN CNC provides a Status group that contains the end station communication-configuration back to the SMF/CUC.\nWhen interworking with TSN deployed in the transport network is applied, the dynamic value for the CN PDB of a Delay-critical GBR 5QI shall be configured in the SMF as described in clause 5.7.3.4. When the SMF setups a new QoS Flow, the SMF signals the dynamic value for the CN PDB and TSCAI for the QoS Flow to NG-RAN on QoS Flow basis. Upon receiving the TSCAI for a QoS Flow from the SMF, if the TSCAI includes a BAT in UL direction, the RAN may determine a dynamic value of 5G-AN PDB in UL direction for the QoS Flow. The NG-RAN provides the dynamic value of 5G-AN PDB to the SMF in a response to the QoS Flow request. The dynamic value of 5G-AN PDB is used to generate EarliestTransmitOffset as described in Annex M.\nThe details of providing End Station related information to generate the stream requirements for the QoS Flow by the SMF/CUC are described in Annex M.\nIf the NG-RAN and UPF support the TSN Talker and Listener functionality (i.e. implement the AN-TL and CN-TL, respectively), the SMF/CUC can communicate with the AN-TL and CN-TL via TL-Container. The TL-Container conveys the data sets defined in IEEE P802.1Qdj [146] between the SMF/CUC and AN-TL and CN-TL.\nThe AN-TL and CN-TL enable the following functions:\na)\thold and buffer functionality in a case when the TSCAI contains a BAT in UL and/or DL direction.\nb)\tsupport of stream transformation functionality with respective information exchange with SMF/CUC.\nc)\tfor SMF/CUC to retrieve the InterfaceCapabilities and/or EndStationInterfaces from the AN-TL or CN-TL.\nd)\ttopology information exchange functionality via LLDP in the TN as described in clause 5.28a.3.\nNOTE 1:\tHow to realize AN-TL in the base station and CN-TL in UPF is up to implementation.\nNOTE 2:\tIn this Release of the specification, it is assumed that connected mode mobility is not used in deployments with a TSN enabled TN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28a.2\tTransfer of TL-Container between SMF/CUC and AN-TL and CN-TL",
                            "text_content": "If NG-RAN and UPF support AN-TL and CN-TL, the SMF/CUC may use the TL-Container to send a:\n1)\tget-request.\n2)\tset-request: submits the following information elements to the AN-TL or CN-TL:\n-\tInterfaceConfiguration as described in Annex M, clause M.1 (one InterfaceConfiguration is associated with each QFI in the N3 tunnel)\n-\tInterface ID Group.\n-\tTN Stream Identification Information for DataFrameSpecification.\n-\tTN Stream Identification Information for mask-and-match.\n-\tInterval (only provided together with TimeAwareOffset).\n-\tMaxFrameSize (only provided together with TimeAwareOffset).\nThe AN-TL or CN-TL may use the TL-Container to send a:\n1)\tget-response: indicates the following elements of the Talker or Listener group from the AN-TL or CN-TL:\n-\tEndStationInterfaces: list of InterfaceIDs.\n-\tInterfaceCapabilities.\n-\tBuffer capability: maximum possible buffer duration for a packet of a stream with the maximum size of an Ethernet packet (1522 Bytes) that is supported by the AN-TL / CN-TL when acting as a Talker.\n2)\tset-response: reports the processing results for the corresponding set-request to the SMF/CUC.\nDetails on the TL-Container information are provided in Table M.2-1 of clause M.2.\nThe SMF/CUC may request the NG-RAN/UPF to report AN-TL or CN-TL information by including a TL-Container with a get-request to the AN-TL or CN-TL, respectively. The get-request is sent to AN-TL in the N2 SM information and to CN-TL in the N4 Session Establishment as described in clause 4.3.2.2 of TS 23.502 [3].\nIf the NG-RAN/UPF supports AN-TL/CN-TL, the NG-RAN/AN-TL and UPF/CN-TL responds with a TL-Container including the elements defined for the get-response.\nThe SMF/CUC may submit TL-Container including a set-request the elements defined for the set-request to NG-RAN/AN-TL and UPF/CN-TL. The set-request is sent to AN-TL in the N2 SM information and to CN-TL in the N4 Session Modification request as described in clause 4.3.3.2 of TS 23.502 [3]. The SMF/CUC shall initiate to the CN-TL/AN-TL the deletion of TN stream configurations as described in 4.3.4.2 of TS 23.502 [3].\nThe InterfaceConfiguration is associated with the corresponding QFI in the N3 tunnel in the NG-RAN or UPF, respectively. The AN-TL/CN-TL uses the provided configuration for the traffic in the QoS Flow of the given QFI as described in Annex M.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.28a.3\tTopology Information for TSN TN",
                            "text_content": "NG-RAN and UPF may support u-plane LLDP functionality to provide topology information to the TN. When LLDP is supported, AN-TL and CN-TL shall perform the LLDP functionality at the u-plane without the need to interact with the c-plane. Further there is no need for 5GS interaction with TN CNC directly. This is achieved with following measures:\n-\tAN-TL and CN-TL implement the Transmit Only operation mode as defined in clause 9.1 of IEEE Std 802.1AB [97].\n-\tThe TSN End Station is pre-configured with parameter set for Transmit Only operating mode as defined in clause 9.2 of IEEE Std 802.1AB [97].\n-\tThe System Capabilities TLV may also be set to Station Only as defined in clause 8.5.8 of IEEE Std 802.1AB [97].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.29\tSupport for 5G LAN-type service",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.29.1\tGeneral",
                            "text_content": "The service requirements for 5G LAN-type service are specified in TS 22.261 [2].\nA 5G Virtual Network (VN) group consists of a set of UEs using private communication for 5G LAN-type services.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.29.2\t5G VN group management",
                            "text_content": "5G System supports management of 5G VN Group identification and membership (i.e. definition of 5G VN group identifiers and membership) and 5G VN Group data (i.e. definition of 5G VN group data). The 5G VN Group management can be configured by a network administrator or can be managed dynamically by AF.\nA 5G VN group is characterized by the following:\n-\t5G VN group identities: External Group ID and Internal Group ID are used to identify the 5G VN group.\n-\t5G VN group membership: The 5G VN group members are uniquely identified by GPSI. The group as described in clause 5.2.3.3.1 of TS 23.502 [3] is applicable to 5G LAN-type services.\n-\t5G VN group data. The 5G VN group data may include the following parameters: PDU session type, DNN, S-NSSAI and Application descriptor, the indication that the 5G VN group is associated with 5G VN group communication, Information related with secondary authentication / authorization (e.g. to enable IP address assignment by the DN-AAA, Maximum Group Data Rate).\nThe Information related with secondary authentication / authorization corresponds to the procedures described in clause 5.6.6; it allows e.g. the AF to provide DN-AAA server addressing information and possibly to request the SMF to get the UE IP address from the DN-AAA server.\nIn order to support dynamic management of 5G VN Group identification and membership, the NEF exposes a set of services to manage (e.g. add/delete/modify) 5G VN groups and 5G VN members. The NEF also exposes services to dynamically manage 5G VN group data.\nAn AF can request provisioning of traffic characteristics, QoS parameters and monitoring of QoS parameters for a 5G VN group as described in clause 6.1.3.28 of TS 23.503 [45].\nA 5G VN group is identified by the AF using External Group ID. The NEF provides the External Group ID to UDM. The UDM maps the External Group ID to Internal Group ID. For a newly created 5G VN Group, an Internal Group ID is determined by the UDM based on implementation specific means.\nNOTE 1:\tThe Internal Group ID determined by UDM has to comply with the format defined in TS 23.003 [19].\nThe NEF can retrieve the Internal Group ID from UDM via Nudm_SDM_Get service operation (External Group ID, Group Identifier translation).\nAn External Group ID for a 5G VN group corresponds to a unique set of 5G VN group data parameters.\nThe 5G VN group configuration is either provided by OA&M or provided by an AF to the NEF.\nWhen configuration is provided by an AF, the procedures described in clause 4.15.6.2 of TS 23.502 [3] apply for storing the 5G VN group identifiers, group membership information and group data in the UDR, as follows:\n-\tThe NEF provides the External Group ID, 5G VN group membership information and 5G VN group data to the UDM.\n-\tThe UDM updates the Internal Group ID-list of the corresponding UE's subscription data in UDR, if needed.\n-\tThe UDM updates the Group Identifier translation in the Group Subscription data with the Internal Group ID, External Group ID and list of group members, if needed.\n-\tThe UDM stores/updates the 5G VN group data (PDU session type, DNN and S-NSSAI, Application descriptor, the indication that the 5G VN group is associated with 5G VN group communication, Information related with secondary authentication / authorization, Maximum Group Data Rate) in UDR.\nNOTE 2:\tIt is assumed that all members of a 5G VN group belong to the same UDM Group ID. The NEF can select a UDM instance supporting the UDM Group ID of any of the member GPSIs of the 5G VN group.\nNOTE 3:\tShared data mechanisms as defined in TS 29.503 [122] can be used to support large 5G VN groups.\nAn AF may also configure and update the service area, QoS for the 5G VN group as described in clause 5.20b as well as other parameters (e.g. Expected UE Behaviour parameters, Network Configuration parameters, ECS Address Configuration Information, etc.) for a 5G VN group as described in clause 4.15.6 of TS 23.502 [3].\nIf a UE is member of a 5G VN Group, UDM retrieves UE subscription data and corresponding 5G VN group data from UDR, and provides the AMF and SMF with UE subscription data with 5G VN group data included. If the 5G VN group data contains the indication that the 5G VN group is associated with 5G VN group communication, the SMF may apply the 5G VN group communication as defined in clauses 5.29.3 and 5.29.4 for the PDU Sessions accessing to the 5G VN group.\nThe PCF generates URSP rules based on 5G VN group data. The PCF retrieves 5G VN group data from UDR. The PCF(s) that have subscribed to modifications of 5G VN group data receive(s) a Nudr_DM_Notify notification of 5G VN group data change from the UDR as defined in TS 29.505 [145]. The PCF receives from the AMF at the UE Policy association establishment the Internal Group ID(s) corresponding to a UE, so that PCF identifies the 5G VN group data that needs to be used to generate URSP rules to the UE. If the PCF is made aware of a change of UE Internal Group Identifier(s) as defined in TS 29.525 [144] or change of 5G VN group membership as defined in TS 29.505 [145], or both, the PCF then may update the URSP rules for the impacted 5G VN group members.\nNOTE 4:\tThe proper way to obtain the 5G VN group membership changes of a specific UE, e.g. if the UE is added to a new 5G VN group, is via the notification of change of UE Internal Group Identifier(s) from the AMF as specified in TS 29.525 [144]. The subscription in the UDR is for being notified about changes in the 5G VN group data and in the 5G VN group membership of a specific 5G VN group.\nIf the PCF receives the Maximum Group Data Rate as part of the 5G VN group data, it performs the group related policy control as described in clauses 6.1.5 and 6.2.1.11 of TS 23.503 [45].\nAn AF may update the UE Identities of the 5G VN group at any time after the initial provisioning.\nAn AF may subscribe to notification of the group status changes for the 5G VN group as described in clause 5.20.\nThe DNN, S-NSSAI provided within 5G VN group data cannot be modified after the initial provisioning.\nIn this Release of the specification, the home network of the 5G VN group members is same.\nIn this Release of the specification, only a 1:1 mapping between (DNN, S-NSSAI) combination and 5G VN group is supported.\nThe PCF delivers 5G VN group configuration information (DNN, S-NSSAI, PDU session type) to the UE for each GPSI that belongs to a 5G VN group. The 5G VN group configuration information is delivered in the URSP from the PCF to the UE using the UE Configuration Update procedure for transparent UE Policy delivery as described in clause 4.2.4.3 of TS 23.502 [3] and clause 6.1.2.2 of TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.29.3\tPDU Session management",
                            "text_content": "Session management as defined for 5GS in clause 5.6 is applicable to 5G-VN-type services with the following clarification and enhancement:\n-\tA UE gets access to 5G LAN-type services via a PDU Session of IP PDU Session type or Ethernet PDU Session type.\n-\tA PDU Session provides access to one and only one 5G VN group. The PDU Sessions accessing to a certain 5G VN group should all anchor at the same network, i.e. the common home network of 5G VN group members.\n-\tA DNN and S-NSSAI is associated with a 5G VN group.\n-\tA dedicated SMF, a dedicated SMF Set or multiple SMF (Sets) can be responsible for all the PDU Sessions for communication of a certain 5G VN group. Multiple SMF (Sets) may apply for a 5G VN group extended over a large area, bigger than the service area of any SMF Set serving the DNN/S-NSSAI of the 5G VN group. SMF selection is described in clause 6.3.2.\nNOTE 1:\tIf a dedicated SMF (Set) is used to serve a 5G VN, the network is configured so that the same SMF (Set) is always selected for a certain 5G VN group, e.g. only one SMF, or SMFs in one SMF Set, registers on the NRF with the DNN/S-NSSAI used for a given 5G VN group.\nNOTE 2:\tHaving a dedicated SMF serving a 5G VN does not contradict that redundancy solutions can be used to achieve high availability. If SMF Set(s) serve the 5G VN group, high availability is achieved by the set functionality.\n-\tIn the case that more than one SMF sets or SMF instances in a SMF Set are responsible for all the PDU Sessions for communication of a certain 5G VN group to enable SMF redundancy for reliability of the 5G VN group communication:\n-\tThe associations between one or more SMF Sets and the DNN, S-NSSAI of the associated 5G VN group is registered and discovered in NRF.\n-\tThe SMFs that registered to associate with the DNN, S-NSSAI of the 5G VN group should be available in the LADN service area of the 5G VN group.\n-\tThe UE provides the DNN and S-NSSAI associated with the 5G VN group to access the 5G LAN-type services for that 5G VN, using the PDU Session Establishment procedure described in clause 4.3.2 of TS 23.502 [3].\n-\tDuring establishment of the PDU Session, secondary authentication as described in clause 5.6.6 and in clause 4.3.2.3 of TS 23.502 [3], may be performed in order to authenticate and authorize the UE for accessing the DNN and S-NSSAI associated with the 5G VN group. Authentication and authorization for a DNN and S-NSSAI using secondary authentication implies authentication and authorization for the associated 5G VN group. There is no 5G VN group specific authentication or authorization defined.\n-\tThe SM level subscription data for a DNN and S-NSSAI available in UDM, as described in clause 5.6.1, applies to the DNN and S-NSSAI associated to a 5G VN group.\n-\tSession management related policy control for a DNN and S-NSSAI as described in TS 23.502 [3], is applicable to the DNN and S-NSSAI associated to a 5G VN group. This includes also usage of URSP, for the UE to determine how to route outgoing traffic to a PDU Session for the DNN and S-NSSAI associated to a 5G VN group.\n-\tSession and service continuity SSC mode 1, SSC mode 2, and SSC mode 3 as described in clause 5.6.9 are applicable to N6-based traffic forwarding of 5G VN communication within the associated 5G VN group.\n-\tA PDU Session provides unicast, broadcast and multicast communication for the DNN and S-NSSAI associated to a 5G VN group. The PSA UPF determines whether the communication is for unicast, broadcast or multicast based on the destination address of the received data, and performs unicast, broadcast or multicast communication handling.\n-\tDuring the PDU Session Establishment procedure, the SMF retrieves SM subscription data related to 5G-VN type service from the UDM as part of the UE subscription data for the DNN and S-NSSAI.\n-\tIn order to realize N19 traffic routing in the case that a single SMF (or single SMF Set) is serving the 5G VN, the SMF (or SMF Set) correlates PDU sessions established to the same 5G VN group and uses this to configure the UPF with the group level N4-session including packet detection and forwarding rules for N19 tunnelling forwarding.\nNOTE 3:\tIn the case of a SMF Set serving a 5G VN, implementation dependent mechanism can be used between SMF(s) that are part of a SMF Set to control the N19 configuration.\n-\tIn order to realize N6/N19 traffic routing between PSA UPFs in case multiple SMF Sets are serving the 5G VN, traffic forwarding between UPFs belonging to different SMF (Set)s can be realized via User Plane tunnels that are configured using OAM between UPFs served by different SMF (Set)s. How to implement the user plane tunnels and traffic forwarding configured between these UPFs is up to network implementation and deployment and is out of scope of this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.29.4\tUser Plane handling",
                            "text_content": "User Plane management as defined for 5GS in clause 5.8 is applicable to 5G LAN-type services with the following clarifications:\n-\tThere are three types of traffic forwarding methods allowed for 5G VN communication:\n-\tN6-based, where the UL/DL traffic for the 5G VN communication is forwarded to/from the DN;\nNOTE 1:\tOptionally a L2TP tunnel can be established over N6 as described in clause 5.8.2.16.\n-\tN19-based, where the UL/DL traffic for the 5G VN group communication is forwarded between PSA UPFs of different PDU sessions via N19. N19 is based on a shared User Plane tunnel connecting PSA UPFs of a single 5G VN group.\n-\tLocal switch, where traffic is locally forwarded by a single UPF if this UPF is the common PSA UPF of different PDU Sessions for the same 5G VN group.\n-\tFor UPFs served by a single SMF Set, the SMF instance(s) in the SMF set handles the user plane paths of the 5G VN group, including:\n-\tThe SMF instance(s) may prefer to select a single PSA UPF for as many PDU sessions (targeting the same 5G VN group) as possible, in order to implement local switch on the UPF.\n-\t(if needed) Establishing N19 tunnels between PSA UPFs served by the same SMF set to support N19-based traffic forwarding.\n-\tIf multiple SMF (Set)s are serving a 5G VN, user plane forwarding between UPFs served by different SMF (Set)s can be achieved via the DN (i.e. N6) or via user plane tunnels on N6/N19 as described in clause 5.29.3.\nNOTE 2:\tThe above user plane tunnels may be using GTP-U or IETF VPN. For example, for IP-type traffic, the traffic routing can be based on routing protocols or pre-configured IP address ranges/prefixes corresponding different SMF sets; for ethernet-type traffic, the traffic routing can be based on the learned MAC address over the user plane tunnels between UPFs controlled by different SMF sets, etc. How to implement such user plane tunnels configured between these UPFs is up to network implementation and deployment.\n-\tFor Ethernet PDU Session, the SMF may instruct the UPF(s) to classify frames based on VLAN tags, and to add and remove VLAN tags, on frames received and sent on N6 or N19 or internal interface (\"5G VN internal\"), as described in clause 5.6.10.2.\nNOTE 3:\tFor handling VLAN tags for traffic on N6, TSP ID could also be used as described in clause 6.2.2.6 of TS 23.503 [45].\nFurther description on User Plane management for 5G VN groups is available in clause 5.8.2.13.\nWhen N6-based traffic forwarding is expected, after creation of a 5G VN group the AF can influence the traffic routing for all the members of the 5G VN group, by providing information identifying the traffic, DNAI(s) suitable for selection and an optional indication of traffic correlation together with a 5G VN External Group ID identifying the 5G VN group in an AF request sent to the PCF, as described in clause 5.6.7. If the optional indication of traffic correlation is provided, it means the PDU sessions of the 5G VN group member UEs should be correlated by a common DNAI in the user plane for the traffic. The PCF transforms the AF request into policies that apply to PDU Sessions of the 5G VN group and sends the policies to the SMF. According to the policies, the SMF (re)selects DNAI(s) for the PDU Sessions and configures their UP paths to route the traffic to the selected DNAI(s). If the policies include the traffic correlation indication, the SMF (re)selects a common DNAI for the PDU Sessions so that the traffic of the 5G VN group is routed to the common DNAI.\nNOTE 4:\tWhen receiving a new PDU session establishment request for a 5G VN group, to avoid unnecessary N19 tunnels between UPFs, SMF can check previously selected UPFs for the same 5G VN group, and decide whether a previously selected UPF could serve the requested PDU session.\nNOTE 5:\tN19 tunnel(s) can be established between a new UPF and other UPF(s) that belongs to a 5G VN group when the new UPF is selected for the 5G VN group during PDU session establishment. The N19 tunnel(s) to a UPF can be released during or after PDU session release when there is no more PDU sessions for a 5G VN group in that UPF. Establishment or release of the N19 tunnels at the UPF is performed within a group-level N4 Session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.30\tSupport for non-public networks",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.30.1\tGeneral",
                            "text_content": "A Non-Public Network (NPN) is a 5GS deployed for non-public use, see TS 22.261 [2]. An NPN is either:\n-\ta Stand-alone Non-Public Network (SNPN), i.e. operated by an NPN operator and not relying on network functions provided by a PLMN, or\n-\ta Public Network Integrated NPN (PNI-NPN), i.e. a non-public network deployed with the support of a PLMN.\nNOTE:\tAn NPN and a PLMN can share NG-RAN as described in clause 5.18.\nStand-alone NPN are described in clause 5.30.2 and Public Network Integrated NPNs are described in clause 5.30.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.30.2\tStand-alone Non-Public Networks",
                            "text_content": "SNPN 5GS deployments are based on:\n-\tthe architecture depicted in clause 4.2.3;\n-\tthe architecture for 5GC with Untrusted non-3GPP access (Figure 4.2.8.2.1-1) for either access to SNPN services via a PLMN (and vice versa) or for direct access to SNPN via non-3GPP access;\n-\tthe architecture for 5GC with Trusted non-3GPP access (Figure 4.2.8.2.1-2); and\n-\tthe additional functionality covered in clause 5.30.2.\nAlternatively, a Credentials Holder (CH) may authenticate and authorize access to an SNPN separate from the Credentials Holder based on the architecture specified in clause 5.30.2.9. Idle and connected mode mobility is supported as defined in clause 5.30.2.11.\nClauses 5.30.2.1 to 5.30.2.11 specify the common SNPN aspects applicable to both 3GPP and non-3GPP access, except where stated differently.\nAspects specific to Untrusted non-3GPP access for SNPN are specified in clause 5.30.2.12.\nAspects specific to Trusted non-3GPP access for SNPN are specified in clause 5.30.2.13.\nAspects specific to N5CW devices accessing SNPN services are specified in clause 5.30.2.15.\nThe following 5GS features and functionalities are not supported for SNPNs:\n-\tInterworking with EPS;\n-\tEmergency services when the UE accesses the SNPN over NWu via a PLMN;\n-\tRoaming, e.g. roaming between SNPNs. However, it is possible for a UE to access an SNPN with credentials from a CH as described in clause 5.30.2.9 and to move between equivalent SNPNs;\n-\tHandover between SNPN and PLMN or PNI-NPN;\n-\tCIoT 5GS Optimizations;\n-\tCAG; and\n-\tProximity based Services (ProSe) as defined in TS 23.304 [128].\nA UE with two or more network subscriptions, where one or more network subscriptions may be for a subscribed SNPN, can apply procedures specified for Multi-USIM UEs as described in clause 5.38. The UE shall use a separate PEI for each network subscription when it registers to the network.\nNOTE:\tThe number of preconfigured PEIs for a UE is limited. If the number of network subscriptions for a UE is greater than the preconfigured number of PEIs, the number of network subscriptions that can be registered with the network simultaneously is restricted by the number of pre-configured number of PEIs.\nThe combination of a PLMN ID and a Network identifier (NID) identifies an SNPN.\nNOTE 1:\tThe PLMN ID used for SNPNs is not required to be unique. PLMN IDs reserved for use by private networks can be used for non-public networks, e.g. based on mobile country code (MCC) 999 as assigned by ITU [78]). Alternatively, a PLMN operator can use its own PLMN IDs for SNPN(s) along with NID(s), but registration in a PLMN and mobility between a PLMN and an SNPN are not supported using an SNPN subscription given that the SNPNs are not relying on network functions provided by the PLMN.\nThe NID shall support two assignment models:\n-\tSelf-assignment: NIDs are chosen individually by SNPNs at deployment time (and may therefore not be unique) but use a different numbering space than the coordinated assignment NIDs as defined in TS 23.003 [19].\n-\tCoordinated assignment: NIDs are assigned using one of the following two options:\n1.\tThe NID is assigned such that it is globally unique independent of the PLMN ID used; or\n2.\tThe NID is assigned such that the combination of the NID and the PLMN ID is globally unique.\nNOTE 2:\tWhich legal entities manage the number space is beyond the scope of this specification.\nNOTE 3:\tThe use of SNPN with self-assignment model NID such that the combination of PLMN ID and NID is not globally unique is not assumed for the architecture described in Figure 5.30.2.9.3-1, Figure 5.30.2.9.2-1 and for SNPN - SNPN Mobility as described in clause 5.30.2.11.\nThe GIN shall support two assignment models:\n-\tSelf-assignment: GINs are chosen individually and may therefore not be unique. It is defined as in TS 23.003 [19]; or\n-\tCoordinated assignment: GIN uses a combination of PLMN ID and NID and is assigned using one of the following two options as defined in TS 23.003 [19]:\n1.\tThe GIN is assigned such that the NID is globally unique (e.g. using IANA Private Enterprise Numbers) independent of the PLMN ID used; or\n2.\tThe GIN is assigned such that the combination of the NID and the PLMN ID is globally unique.\nNOTE 4:\tWhich legal entities manage the number space for GIN is beyond the scope of this specification.\nAn optional human-readable network name helps to identify an SNPN during manual SNPN selection. The human-readable network name and how it is used for SNPN manual selection is specified in TS 22.261 [2] and TS 23.122 [17].\nNG-RAN nodes or Trusted non-3GPP access networks which provide access to SNPNs broadcast the following information:\n-\tOne or multiple PLMN IDs;\n-\tList of NIDs per PLMN ID identifying the non-public networks NG-RAN provides access to; and\nNOTE 1:\tIt is assumed that an NG-RAN node supports broadcasting a total of twelve NIDs. Further details are defined in TS 38.331 [28].\nNOTE°2:\tThe presence of a list of NIDs for a PLMN ID indicates that the related PLMN ID and NIDs identify SNPNs.\n-\tOptionally:\n-\tA human-readable network name per SNPN;\nNOTE 3:\tThe human-readable network name per SNPN is only used for manual SNPN selection. If the SNPN supports Localized Service, the human-readable network name of the SNPN can be information related to the Localized Service. The mechanism how human-readable network name is provided (i.e. whether it is broadcasted or unicasted) to the UE is specified in TS 38.331 [28].\n-\tInformation, as described in TS 38.300 [27], TS 38.331 [28] and in TS 38.304 [50], to prevent UEs not supporting SNPNs from accessing the cell, e.g. if the cell only provides access to non-public networks;\n-\tAn indication per SNPN of whether access using credentials from a Credentials Holder is supported;\n-\tList of supported Group IDs for Network Selection (GINs) per SNPN; and\n-\tAn indication per SNPN of whether the SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN, i.e. UEs that do not have any PLMN ID and NID nor GIN broadcast by the SNPN in the Credentials Holder controlled prioritized lists of preferred SNPNs/GINs.\nNOTE 4:\tFurther details (including number of supported GINs per SNPN) are defined in TS 38.331 [28].\nAn SNPN-enabled UE is configured with the following information for each subscribed SNPN:\n-\tPLMN ID and NID of the subscribed SNPN;\n-\tSubscription identifier (SUPI) and credentials for the subscribed SNPN;\n-\tOptionally, an N3IWF FQDN and the MCC of the country where the configured N3IWF is located;\n-\tOptionally, if the UE supports access to an SNPN using credentials from a Credentials Holder:\n-\tUser controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of GINs;\n-\tOptionally, if the UE supports access to an SNPN using credentials from a Credentials Holder and access to an SNPN providing access for Localized Services:\n-\tUser controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred SNPNs for accessing Localized Services, each entry of the list includes:\n-\tan SNPN identifier;\n-\tvalidity information; and\n-\toptionally, location assistance information;\n-\tCredentials Holder controlled prioritized list of GINs for accessing Localized Services, each entry of the list includes:\n-\ta GIN;\n-\tvalidity information; and\n-\toptionally, location assistance information;\n-\tProtection scheme for concealing the SUPI as defined in TS 33.501 [29].\nNOTE 1:\tAdditionally the UE can be configured with indication to use anonymous SUCI as defined in TS 24.501 [47].\nValidity information consists of:\n-\tTime validity information, i.e. time periods (defined by start and end times) when access to the SNPN for accessing Localized Services is allowed; and/or\nLocation assistance information consisting of:\n-\tGeolocation information, and/or,\n-\tTracking Area information of serving networks, i.e. lists of TACs per PLMN ID or per PLMN ID and NID.\nThe UE may use the location assistance information to determine where to search for the SNPNs in the Credentials Holder controlled prioritized list of SNPNs and GINs for accessing Localized Services, i.e. the location assistance information is not used for any area restriction enforcement.\nFor an SNPN-enabled UE with SNPN subscription, the Credentials Holder controlled prioritized lists of preferred SNPNs and GINs, or Credentials Holder controlled prioritized lists of preferred SNPNs and GINs for accessing Localized Services may be updated by the Credentials Holder using the Steering of Roaming (SoR) procedure as defined in Annex C of TS 23.122 [17]. Updating Credentials Holder controlled prioritized lists of preferred SNPNs and GINs, or Credentials Holder controlled prioritized lists of preferred SNPNs and GINs for accessing Localized Services via the Steering of Roaming (SoR) procedure is not applicable for Credentials Holder with AAA Server.\nA subscription of an SNPN is either:\n-\tidentified by a SUPI containing a network-specific identifier that takes the form of a Network Access Identifier (NAI) using the NAI RFC 7542 [20] based user identification as defined in clause 28.7.2 of TS 23.003 [19]. The realm part of the NAI may include the NID of the SNPN; or\n-\tidentified by a SUPI containing an IMSI.\nNOTE 2:\tAs to route network signalling to AUSF and UDM instances serving the SNPN-enabled UE, the UE can be configured with Routing Indicator locally or updated with Routing Indicator using the UE Parameters Update via UDM Control Plane procedure defined in clause 4.20 of TS 23.502 [3]. When the SNPN credential is stored in the USIM, the Routing Indicator is provisioned in the USIM, when the SNPN credential is stored in the ME, the Routing Indicator is provisioned in the ME.\nIn the case of access to an SNPN using credentials owned by a Credentials Holder as specified in clause 5.30.2.9.2 and clause 5.30.2.9.3, the SUPI shall also contain identification for the Credentials Holder (i.e. the realm in the case of Network Specific Identifier based SUPI or the MCC and MNC in the case of an IMSI based SUPI). In the case of access to an SNPN using credentials owned by a Credentials Holder using AAA-S as specified in clause 5.30.2.9.2, only Network Specific Identifier based SUPI is supported.\nNOTE 3:\tWhen Credentials Holder is an SNPN, and the MCC and MNC of the SNPN is not unique (e.g. MCC =999 is used and MNC is not coordinated amongst the SNPNs), then IMSI based SUPI is not supported as the MCC and MNC need not be globally unique always; instead USIM credentials are supported using Network Specific Identifier based SUPI.\nNOTE 4:\tNetwork Specific Identifier are not supported for the case the Credentials Holder is provided by a PLMN.\nNOTE 5:\tIt is assumed that normally the SNPN and the Credentials Holder use different PLMN ID. If the SNPN and CHs (where CH can be another SNPN or a PLMN) share PLMN ID, and IMSI based SUPI is used, then the Routing Indicator can be used for AUSF/UDM discovery and selection as long as the Routing Indicator values are coordinated among the involved SNPN and CHs. When the PLMN ID is not shared between SNPNs and CHs (where CH can be another SNPN or a PLMN) and IMSI based SUPI is used, then PLMN ID is sufficient to be used for AUSF/UDM discovery & selection unless the CHs deploys multiple AUSF/UDM in which case also the Routing Indicator can be used as long as the Routing Indicator values are coordinated within the CH.\nAn SNPN-enabled UE that supports access to an SNPN using credentials from a Credentials Holder and that is equipped with a PLMN subscription may additionally be configured with the following information for SNPN selection and registration using the PLMN subscription in SNPN access mode:\n-\tUser controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred SNPNs;\n-\tCredentials Holder controlled prioritized list of preferred GINs.\n-\tOptionally if the UE supports access to an SNPN providing access for Localized Services:\n-\tCredentials Holder controlled prioritized list of preferred SNPNs for accessing Localized Services, each entry of the list includes:\n-\tan SNPN identifier;\n-\tvalidity information; and\n-\toptionally, location assistance information;\n-\tCredentials Holder controlled prioritized list of preferred GINs for accessing Localized Services, each entry of the list includes:\n-\ta GIN;\n-\tvalidity information; and\n-\toptionally, location assistance information.\nValidity information consists of:\n-\tTime validity information, i.e. time periods (defined by start and end times) when access to the SNPN for accessing Localized Services is allowed; and/or,\nLocation assistance information consisting of:\n-\tGeolocation information, and/or,\n-\tTracking Area information of serving networks, i.e. lists of TACs per PLMN ID or per PLMN ID and NID.\nThe UE may use the location assistance information to determine where to search for the SNPNs in the Credentials Holder controlled prioritized list of SNPNs and GINs for accessing Localized Services, i.e. the location assistance information is not used for any area restriction enforcement.\nFor an SNPN-enabled UE with PLMN subscription, the Credentials Holder controlled prioritized lists of preferred SNPNs and GINs, or the Credentials Holder controlled prioritized lists of preferred SNPNs and GINs for accessing Localized Services may be updated by the Credentials Holder using the Steering of Roaming (SoR) procedure as defined in Annex C of TS 23.122 [17].\nWhen the Credentials Holder updates a UE with the Credentials Holder controlled prioritized lists of preferred SNPNs and GINs, and/or the Credentials Holder controlled prioritized lists of preferred SNPNs and GINs for accessing Localized Services, the UE may perform SNPN selection again, e.g. to potentially select a higher prioritized SNPN or to potentially select an SNPN that provides access for Localized Services.\nAn SNPN-enabled UE supports the SNPN access mode. When the UE is set to operate in SNPN access mode the UE selects and registers with SNPNs over Uu as described in clause 5.30.2.4. Network selection in SNPN access mode for access to SNPN services via Untrusted non-3GPP access, Trusted non-3GPP access and Wireline access is specified in clause 5.30.2.12, clause 5.30.2.13 and clause 5.30.2.14 respectively. Access network selection in SNPN access mode for 5G NSWO is specified in clause 6.3.12b.\nEmergency services are supported in SNPN access mode over Uu as defined in clause 5.16.4.1. Support for Emergency in SNPN access mode via Untrusted non-3GPP access is specified in clause 5.30.2.12.\nIf a UE is not set to operate in SNPN access mode, even if it is SNPN-enabled, the UE does not select and register with SNPNs. A UE not set to operate in SNPN access mode performs PLMN selection procedures as defined in clause 4.4 of TS 23.122 [17]. For a UE capable of simultaneously connecting to an SNPN and a PLMN, the setting for operation in SNPN access mode is applied to each of the Uu/Yt/NWu interfaces independently. Clause D.4 provides more details.\nAn SNPN-enabled UE that supports access to an SNPN using credentials from a Credentials Holder and that is equipped with a PLMN subscription needs to first enter SNPN access mode to be able to select SNPNs. Once the UE has entered SNPN access mode, SNPN selection is performed as described in clause 5.30.2.4. Once an SNPN has been selected the UE attempts registration in the SNPN using the PLMN credentials.\nNOTE 1:\tDetails of activation and deactivation of SNPN access mode are up to UE implementation.\nWhen a UE is set to operate in SNPN access mode the UE does not perform normal PLMN selection procedures as defined in clause 4.4 of TS 23.122 [17].\nUEs operating in SNPN access mode read the information described in clause 5.30.2.2 from the broadcast system information and take them into account during network selection. Furthermore, if the UE supports access to an SNPN providing access for Localized Services, and the end user enables to access the Localized Services the UE may select an SNPN providing access for Localized Services.\nNOTE 2:\tDetails of how the user enables/disables access to Localized Services are up to UE implementation.\nNOTE 1:\tIf the UE has multiple subscriptions (SNPN and/or PLMN) it is assumed that the subscription to use for automatic selection is determined by implementation specific means prior to network selection.\nIf the UE supports accessing an SNPN providing access for Localized Services and the end user enables to access Localized Services, for automatic network selection, the UE shall select and attempts registration on available SNPN in the following order:\n(a)\tif the UE supports access to an SNPN using Credentials from a Credentials Holder then the UE continues by selecting and attempting registration on available and allowable SNPNs which broadcasts the indication that access using credentials from a Credentials Holder is supported in the following order:\ni\tthe SNPN with the validity information the UE was last registered with (if the validity information is met) or the SNPN's equivalent SNPN(s) (if available and the validity information of the SNPN that the UE was last registered with is met);\nNOTE 2:\tThe equivalent SNPN(s) are assumed to provide access to the same Localized Services as the SNPN the UE was last registered with.\nii\tSNPNs in the Credentials Holder controlled prioritized list of preferred SNPNs for accessing Localized Services (in priority order) if the validity information is met;\niii\tSNPNs, which additionally broadcast a GIN contained in the Credentials Holder controlled prioritized list of preferred GINs for accessing Localized Services (in priority order) if validity information is met;\n(b)\tthe SNPN without validity information the UE was last registered with (if available) or the equivalent SNPN (if available);\n(c)\tthe subscribed SNPN, which is identified by the PLMN ID and NID for which the UE has SUPI and credentials;\n(d)\tthe available and allowable SNPNs which broadcast the indication that access using credentials from a Credentials Holder is supported in the following order:\ni\tSNPNs in the user controlled prioritized list of preferred SNPNs (in priority order);\nii\tSNPNs in the Credentials Holder controlled prioritized list of preferred SNPNs (in priority order);\niii\tSNPNs, which additionally broadcast a GIN contained in the Credentials Holder controlled prioritized list of preferred GINs (in priority order);\niv-\tSNPNs, which additionally broadcast an indication that the SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN, i.e. the broadcasted NID or GIN is not present in the Credentials Holder controlled prioritized lists of preferred SNPNs/GINs, nor in the Credentials Holder controlled prioritized lists of preferred SNPNs/GINs for accessing Localized Services in the UE.\nIf the UE supports accessing an SNPN providing access for Localized Services and the end user enables to access Localized Services, the UE shall periodically attempt reselection and registration on a higher priority SNPN 1) based on the order of the above sub-bullets (i) to (iii) of bullet (a), bullet (c), sub-bullets (i) to (iii) of bullet (d) if the UE is not registered to the sub-bullet (i) of bullet (a) or 2) based on the order of the above sub-bullets (ii) to (iii) of bullet (a), bullet (c), sub-bullets (i) to (iii) of bullet (d) if the UE is registered to the sub-bullet (i) of bullet (a) if any of the below conditions is met:\n-\tif there are one or more SNPNs with validity information which is met, and the UE is not registered to an SNPN which has highest priority among the one or more SNPNs; or\n-\tif there is no SNPN with validity information which is met, and there are one or more GINs with the validity information which is met, and the UE is not registered to an SNPN broadcasting a GIN which has highest priority among the one or more GINs; or\n-\tif there is no SNPN with validity information which is met and there is no GIN with validity information which is met, and the UE is not registered to the subscribed SNPN\nOtherwise, the UE does not trigger periodic reselection and does not attempt registration on a higher priority SNPN\nNOTE 3:\tDetails of network selection (e.g. validity information handling, periodicity determination) specified in TS 23.122 [17].\nIf a validity condition in Credentials Holder controlled prioritized lists of preferred SNPNs/GINs for accessing Localized Services changes from met to not met (and vice versa), the UE shall attempt selection and registration on an SNPN based on the above bullets (a) to (d).\nIf the UE does not support to access an SNPN providing access for Localized Services or the end user does not enable to access the Localized Services, for automatic network selection the UE shall select and attempts registration on available and allowable SNPNs in the following order:\n-\tthe SNPN without validity information the UE was last registered with (if available) or the equivalent SNPN (if available);\n-\tthe subscribed SNPN, which is identified by the PLMN ID and NID for which the UE has SUPI and credentials.;\n-\tIf the UEs supports access to an SNPN using credentials from a Credentials Holder then the UE continues by selecting and attempting registration on available and allowable SNPNs which broadcast the indication that access using credentials from a Credentials Holder is supported in the following order:\n-\tSNPNs in the user controlled prioritized list of preferred SNPNs (in priority order);\n-\tSNPNs in the Credentials Holder controlled prioritized list of preferred SNPNs (in priority order);\n-\tSNPNs, which additionally broadcast a GIN contained in the Credentials Holder controlled prioritized list of preferred GINs (in priority order);\nNOTE 4:\tIf multiple SNPNs are available that broadcast the same GIN, the order in which the UE selects and attempts a registration with those SNPNs is implementation specific.\n-\tSNPNs, which additionally broadcast an indication that the SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN, i.e. the broadcasted NID or GIN is not present in the Credentials Holder controlled prioritized lists of preferred SNPNs/GINs in the UE.\nNOTE 5:\tIf multiple SNPNs are available that broadcast the indication that the SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN, the order in which the UE selects and attempts a registration with those SNPNs is implementation specific.\nWhen a UE performs Registration or Service Request to an SNPN, the UE shall indicate the PLMN ID and NID as broadcast by the selected SNPN to NG-RAN. NG-RAN shall inform the AMF of the selected PLMN ID and NID.\nFor manual network selection UEs operating in SNPN access mode provide to the user the list of SNPNs (each is identified by a PLMN ID and NID) and related human-readable names (if available) of the available SNPNs the UE has respective SUPI and credentials for. If the UEs supports access to an SNPN using credentials from a Credentials Holder, the UE also presents available SNPNs which broadcast the \"access using credentials from a Credentials Holder is supported\" indication and the human-readable names related to the SNPNs (if available).\nNOTE:\tThe details of manual SNPN selection are defined in TS 23.122 [17].\nWhen a UE performs Initial Registration to an SNPN, the UE shall indicate the selected PLMN ID and NID as broadcast by the selected SNPN to NG-RAN. NG-RAN shall inform the AMF of the selected PLMN ID and NID.\nIf a UE performs the registration or service request procedure in an SNPN identified by a PLMN ID and a self-assigned NID and there is no subscription for the UE, then the AMF shall reject the UE with an appropriate cause code to temporarily prevent the UE from automatically selecting and registering with the same SNPN.\nIf a UE performs the registration or service request procedure in an SNPN identified by a PLMN ID and a coordinated assigned NID and there is no subscription for the UE, then the AMF shall reject the UE with an appropriate cause code to permanently prevent the UE from automatically selecting and registering with the same SNPN.\nNOTE:\tThe details of rejection and cause codes is defined in TS 24.501 [47].\nIf a UE performs the registration in an SNPN using credentials from a Credentials Holder (i.e. the CH is the PLMN/SNPN that owns the UE subscription and controls the access) and the Credentials Holder does not authorize the UE to access that specific SNPN due to access authorization based on subscription data or invalid time for accessing an SNPN that provides access to Localized Services, then the UDM, in the Credentials Holder, can reject the UE which results in AMF rejecting the registration request from the UE with an appropriate cause code to prevent the UE from automatically selecting and registering with the same SNPN using credentials from the Credentials Holder as described in TS 24.501 [47].\nIn order to prevent access to SNPNs for authorized UE(s) in the case of network congestion/overload, Unified Access Control information is configured per SNPN (i.e. as part of the subscription information that the UE has for a given SNPN) and provided to the UE as described in TS 24.501 [47].\nUEs operating in SNPN access mode only select cells and networks broadcasting both PLMN ID and NID of the selected SNPN or its equivalent SNPN.\nNOTE:\tFurther details on the NR idle and inactive mode procedures for SNPN cell selection is defined in TS 38.331 [28] and in TS 38.304 [50].\nTo access PLMN services, a UE in SNPN access mode that has successfully registered with an SNPN may perform another registration via the SNPN User Plane with a PLMN (using the credentials of that PLMN) following the same architectural principles as specified in clause 4.2.8 (including the optional support for PDU Session continuity between PLMN and SNPN using the Handover of a PDU Session procedures in clauses 4.9.2.1 and 4.9.2.2 of TS 23.502 [3]) and the SNPN taking the role of \"Untrusted non-3GPP access\". Annex D, clause D.3 provides additional details.\nNOTE:\tQoS differentiation in the SNPN can be provided on per-IPsec Child Security Association basis by using the UE or network requested PDU Session Modification procedure described in clause 4.3.3.2 of TS 23.502 [3]. In the PLMN, N3IWF determines the IPsec child SAs as defined in clause 4.12 of TS 23.502 [3]. The N3IWF is preconfigured by PLMN to allocate different IPsec child SAs for QoS Flows with different QoS profiles.\nTo support QoS differentiation in the SNPN with network-initiated QoS, the mapping rules between the SNPN and the PLMN are assumed to be governed by an SLA including: 1) mapping between the DSCP markings for the IPsec child SAs on NWu and the corresponding QoS, which is the QoS requirement of the PLMN and is expected to be provided by the SNPN, and 2) N3IWF IP address(es) in the PLMN. The non-alteration of the DSCP field on NWu is also assumed to be governed by an SLA and by transport-level arrangements that are outside of 3GPP scope. The packet detection filters in the SNPN can be based on the N3IWF IP address and the DSCP markings on NWu.\nTo support QoS differentiation in the SNPN with UE-requested QoS, the UE can request for an IPsec SA the same 5QI from the SNPN as the 5QI provided by the PLMN. It is assumed that UE-requested QoS is used only when the 5QIs used by the PLMN are from the range of standardized 5QIs. The packet filters in the requested QoS rule can be based on the N3IWF IP address and the SPI associated with the IPsec SA.\nRefer to clause D.7 for details on how to support QoS differentiation.\nWhen the UE accesses the PLMN over NWu via a SNPN, the AMF in the serving PLMN shall send an indication toward the UE during the Registration procedure to indicate whether an IMS voice over PS session is supported or not.\nTo access SNPN services, a UE that has successfully registered with a PLMN over 3GPP access may perform another registration via the PLMN User Plane with an SNPN (using the credentials of that SNPN) following the same architectural principles as specified in clause 4.2.8 (including the optional support for PDU Session continuity between PLMN and SNPN using the Handover of a PDU Session procedures in clauses 4.9.2.1 and 4.9.2.2 of TS 23.502 [3]) and the PLMN taking the role of \"Untrusted non-3GPP access\" of the SNPN, i.e. using the procedures for Untrusted non-3GPP access in clause 4.12.2 of TS 23.502 [3]. Annex D, clause D.3 provides additional details. The case where UE that has successfully registered with a PLMN over non-3GPP access to access SNPN services is not specified in this Release.\nNOTE:\tQoS differentiation in the PLMN can be provided on per-IPsec Child Security Association basis by using the UE or network requested PDU Session Modification procedure described in clause 4.3.3.2 of TS 23.502 [3]. In the SNPN, N3IWF determines the IPsec child SAs as defined in clause 4.12 of TS 23.502 [3]. The N3IWF is preconfigured by SNPN to allocate different IPsec child SAs for QoS Flows with different QoS profiles.\nTo support QoS differentiation in the PLMN with network-initiated QoS, the mapping rules between the PLMN and the SNPN are assumed to be governed by an SLA including: 1) mapping between the DSCP markings for the IPsec child SAs on NWu and the corresponding QoS, which is the QoS requirement of the SNPN and is expected to be provided by the PLMN, and 2) N3IWF IP address(es) in the SNPN. The non-alteration of the DSCP field on NWu is also assumed to be governed by an SLA and by transport-level arrangements that are outside of 3GPP scope. The packet detection filters in the PLMN can be based on the N3IWF IP address and the DSCP markings on NWu.\nTo support QoS differentiation in the PLMN with UE-requested QoS, the UE can request for an IPsec SA the same 5QI from the PLMN as the 5QI provided by the SNPN. It is assumed that UE-requested QoS is used only when the 5QIs used by the SNPN are from the range of standardized 5QIs. The packet filters in the requested QoS rule can be based on the N3IWF IP address and the SPI associated with the IPsec SA.\nRefer to clause D.7 for details on how to support QoS differentiation.\nWhen the UE accesses the SNPN over NWu via a PLMN, the AMF in the SNPN shall send an indication toward the UE during the Registration procedure to indicate whether an IMS voice over PS session is supported or not.\nSNPNs may support UE access using credentials owned by a Credentials Holder separate from the SNPN. In this case the Session Management procedures (i.e. PDU Sessions) terminate in an SMF in the SNPN.\nWhen an SNPN supports UE access using credentials assigned by a Credentials Holder separate from the SNPN, it is assumed that is supported homogeneously within the whole SNPN.\nCredentials Holder using AAA Server for primary authentication and authorization is described in clause 5.30.2.9.2 and Credentials Holder using AUSF and UDM for primary authentication and authorization is described in clause 5.30.2.9.3.\nThe AUSF and the UDM in SNPN may support primary authentication and authorization of UEs using credentials from a AAA Server in a Credentials Holder (CH).\n-\tOnly NSI based SUPI is supported and the SUPI is used to identify the UE during primary authentication and authorization towards the AAA Server. SUPI privacy is achieved according to methods in clause I.5 of TS 33.501 [29].\n-\tThe AMF discovers and selects the AUSF as described in clause 6.3.4 using the Home Network Identifier (realm part) and Routing Indicator present in the SUCI provided by a UE configured as described in clause 5.30.2.3.\n-\tThe AMF selects the UDM in the same SNPN, based on local configuration (e.g. using the realm part of the SUCI), or using the NRF procedure defined in clause 4.17.4a of TS 23.502 [3].\n-\tIf the UDM decides that the primary authentication is performed by AAA Server in CH based on the UE's SUPI and subscription data. The Home Network Identifier, is derived by UDM from the SUCI received from AUSF. If the SUCI was generated using a privacy protection scheme that requires de-concealment, UDM de-conceal the SUCI as defined in TS 33.501 [29]. The UDM then instructs the AUSF that primary authentication by a AAA Server in a CH is required, the AUSF shall discover and select the NSSAAF, and then forward EAP messages to the NSSAAF. The NSSAAF selects AAA Server based on the domain name corresponds to the realm part of the SUPI, relays EAP messages between AUSF and AAA Server (or AAA proxy) and performs related protocol conversion. The AAA Server acts as the EAP Server for the purpose of primary authentication.\nNOTE 1:\tThe UDM in SNPN, based on SLA between Credentials Holder and SNPN, is pre-configured with information indicating whether the UE needs primary authentication from AAA Server.\nNOTE 2:\tIt is assumed that the SNPN is configured on per Home Network Identifier basis to determine whether to perform primary authentication with AUSF/UDM or AAA server.\n-\tThe AMF and SMF shall retrieve the UE subscription data from UDM using SUPI.\nFigure 5.30.2.9.2-1 depicts the 5G System architecture for SNPN with Credentials Holder using AAA Server for primary authentication and authorization.\nNOTE 3:\tThe SNPN in Figure 5.30.2.9.2-1 can be the subscribed SNPN for the UE (i.e. NG-RAN broadcasts SNPN ID of the subscribed SNPN). As a deployment option, the SNPN in Figure 5.30.2.9.2-1 can also be another SNPN than the subscribed SNPN for the UE (i.e. none of the SNPN IDs broadcast by NG-RAN matches the SNPN ID corresponding to the subscribed SNPN). In both cases, the AUSF, UDM and NSSAAF are configured to support the HNI of the UE's SUPI/SUCI, SUPI privacy settings (when using privacy protection scheme other than the 'null-scheme' to generate the SUCI as defined in TS 33.501 [29]), subscription data of the UE and authentication settings to allow UE authentication with AAA-S in CH.\nThe 5G system architecture, as depicted in Figure 5.30.2.9.2, showcases a comprehensive network infrastructure that leverages the principles of SDN (Software-Defined Networking) to enable seamless communication between various network components. The architecture is designed to support a wide range of applications, including IoT devices, smart cities, and enterprise networks. The figure illustrates the various components of the 5G network, including the core switches, optical line terminals (OLTs), and distributed nodes. The layered design of the network ensures redundancy and failover reliability, making it suitable for high-speed data transmission and real-time applications.\nFigure 5.30.2.9.2-1: 5G System architecture with access to SNPN using credentials from Credentials Holder using AAA Server\nNOTE 4:\tThe NSSAAF deployed in the SNPN can support primary authentication in the SNPN using credentials from Credentials Holder using a AAA Server (as depicted) and/or the NSSAAF can support Network Slice-Specific Authentication and Authorization with a Network Slice-Specific AAA Server (not depicted).\nAn SNPN may support primary authentication and authorization of UEs that use credentials from a Credentials Holder using AUSF and UDM. The Credentials Holder may be an SNPN or a PLMN. The Credentials Holder UDM provides to SNPN the subscription data.\nNOTE 1:\tA list of functionalities not supported in SNPN is provided in clause 5.30.2.0.\nOptionally, an SNPN may support network slicing (including Network Slice-Specific Authentication and Authorization, Network Slice Access Control and subscription-based restrictions to simultaneous registration of network slices) for UEs that use credentials from a Credentials Holder using AUSF and UDM. The SNPN retrieves NSSAA and NSSRG information from the UDM of the Credentials Holder.\nFigure 5.30.2.9.3-1 depicts the 5G System architecture for SNPN with Credentials Holder using AUSF and UDM for primary authentication and authorization and network slicing.\nNOTE 2:\tThe architecture for SNPN and Credentials Holder using AUSF and UDM is depicted as a non-roaming reference architecture as the UE is not considered to be roaming, even though some of the roaming architecture reference points are also used, e.g. for AMF and SMF in SNPN to register with and retrieve subscription data from UDM of the Credentials Holder.\nThe 5G system architecture, as depicted in Figure 5.30.2, includes access to the Service National Point Network (SNPN) using credentials from the Credentials Holder using AUSF and UDM. This architecture is designed to support various network services, including mobile, fixed, and IoT, and is based on the 5G New Radio (NR) standard. The architecture includes a combination of physical, logical, and virtual layers, with the physical layer responsible for the physical layer functions, the logical layer for the network functions, and the virtual layer for the network functions. The architecture also includes a set of key components, such as the base station (gNB), user equipment (UE), and scatterers, which are essential for the efficient operation of the network.\nFigure 5.30.2.9.3-1: 5G System architecture with access to SNPN using credentials from Credentials Holder using AUSF and UDM\nOnboarding of UEs for SNPNs allows the UE to access an Onboarding Network (ONN) for the purpose of provisioning the UE with SNPN credentials for primary authentication and other information to enable access to a desired SNPN, i.e. (re-)select and (re-)register with SNPN.\nTo provision SNPN credentials in a UE that is configured with Default UE credentials (see clause 5.30.2.10.2.4), the UE selects an SNPN as ONN and establishes a secure connection with that SNPN referred to as Onboarding SNPN (ON-SNPN), see more details in clause 5.30.2.10.2.\nNOTE:\tIf the UE is already provisioned with a set of SNPN credentials or credentials owned by a Credentials Holder and needs to be provisioned with an additional set of SNPN credentials, the UE can access an SNPN using the network selection in SNPN access mode as described in clause 5.30.2.4, normal registration (i.e. not registration for onboarding) and normal PDU Session (i.e. not a restricted PDU Session used for onboarding) and then leverage the SNPN's User Plane connection to get access to a PVS. The PVS address can be provided in the same way as when the Onboarding Network is a PLMN.\nTo provision SNPN credentials in a UE that is equipped with a USIM configured with PLMN credentials, the UE selects a PLMN as ONN and establishes a secure connection with that PLMN, see more details in clause 5.30.2.10.3.\nAfter the secure connection is established, the UE is provisioned with SNPN credentials and possibly other data to enable discovery, (re-)selection and (re-)registration for a desired SNPN, see more details in clause 5.30.2.10.4.\nON-SNPN and SO-SNPN can be roles taken by either an SNPN or different SNPNs. It is possible for the same network to be in both roles with respect to a specific UE.\n5.30.2.10.2.1\tGeneral\nA UE configured with Default UE credentials may register with an ON-SNPN for the provisioning of SO-SNPN credentials.\n5.30.2.10.2.2\tArchitecture\nFigures 5.30.2.10.2.2-1, 5.30.2.10.2.2-2 and 5.30.2.10.2.2-3 depict the architecture for Onboarding of UEs in an ON-SNPN.\nThe architecture for UE Onboarding in ON-SNPN when the DCS includes an AUSF and a UDM is depicted in Figure 5.30.2.10.2.2-1. This figure illustrates the components and their interconnections required for the seamless onboarding of an UE (User Equipment) into the network. The diagram includes the AUSF (Access Unit Switching Function) and UDM (User Data Module) as key components, which are essential for the efficient and secure onboarding process. The figure also highlights the use of redundant paths to ensure failover reliability, and the layered design of the network architecture aligns with SDN principles.\nFigure 5.30.2.10.2.2-1: Architecture for UE Onboarding in ON-SNPN when the DCS includes an AUSF and a UDM\nThe architecture for UE Onboarding in ON-SNPN when the DCS includes a AAA Server used for primary authentication is depicted in Figure 5.30.2.10.2.2-2. The figure illustrates the primary authentication process, which involves the use of an AAA Server to authenticate the UE. The diagram shows the connection between the DCS and the AAA Server, as well as the communication between the UE and the AAA Server. The figure also includes a visual representation of the authentication process, such as the use of a password and the display of the authentication result.\nFigure 5.30.2.10.2.2-2: Architecture for UE Onboarding in ON-SNPN when the DCS includes a AAA Server used for primary authentication\nThe architecture for UE Onboarding in ON-SNPN when the DCS is not involved during primary authentication is depicted in Figure 5.30.2.10.2.2-3. The figure illustrates the steps involved in the onboarding process, including the use of a DCS (Distributed Control System) for primary authentication. The architecture is designed to ensure a seamless and secure onboarding experience for the UE (User Equipment).\nFigure 5.30.2.10.2.2-3: Architecture for UE Onboarding in ON-SNPN when the DCS is not involved during primary authentication\nNOTE 1:\tAUSF in the ON-SNPN interfaces with the DCS via NSSAAF as shown in Figure 5.30.2.10.2.2-2 owned by an entity that is internal or external to the ON-SNPN.\nNOTE 2:\tThe functionality with respect to exchange information between PVS and SO-SNPN to provision SNPN credentials and other data from the SO-SNPN in the UE is out of 3GPP scope.\nNOTE 3:\tThe dotted lines in Figure 5.30.2.10.2.2-1, Figure 5.30.2.10.2.2-2 and Figure 5.30.2.10.2.2-3 indicate that whether domains (e.g. DCS domain, PVS domain, and SO-SNPN) are separated depends on the deployment scenario.\nNOTE 4:\tSee TS 33.501 [29] for the functionality beyond AUSF, and other interfaces required for security.\nNOTE 5:\tWhen secondary authentication is used in the context of the UE onboarding architecture in Figure 5.30.2.10.2.2-3, the same S-NSSAI/DNN or different S-NSSAI/DNNs can be used for the onboarding PDU Sessions of different UEs even though the DN-AAA servers that authenticate the UEs can reside in different administrative domains.\nWhen the DCS is involved during mutual primary authentication during the Onboarding procedure (as in Figure 5.30.10.2.2-1 and Figure 5.30.10.2.2-2), the following applies:\n-\tWhen the DCS includes an AUSF and a UDM functionality, then the AMF selects AUSF in the DCS domain. The ON-SNPN and DCS domain are connected via N32 and SEPP which are not shown in the Figure 5.30.2.10.2.2-1.\n-\tWhen the DCS includes a AAA Server functionality, only NSI based SUPI is supported and the AMF selects AUSF in the ON-SNPN. Based on local configuration (e.g. using the realm part of the Onboarding SUCI), the AUSF skips the UDM selection and directly performs primary authentication towards DCS with AAA Server functionality using Default UE credentials for primary authentication. The AUSF uses an NSSAAF (and the NSSAAF may use a AAA-P which is not shown in the figure 5.30.2.10.2.2-2) to relay EAP messages towards the DCS including a AAA Server. The NSSAAF selects AAA Server based on the domain name corresponding to the realm part of the SUPI.\nNOTE 5:\tThe AMF in ON-SNPN uses the Home Network Identifier of the Onboarding SUCI to select the DCS. It is assumed that the ON-SNPN is configured on per Home Network Identifier basis to determine whether to perform primary authentication with AUSF/UDM or AAA server.\n-\tUpon establishment of the PDU Session used for User Plane Remote Provisioning the ON-SNPN may trigger secondary authentication procedure, as described in clause 4.3.2.3 of TS 23.502 [3], with a DN-AAA using Default UE credentials for secondary authentication as described in clause I.9.2.4 of TS 33.501 [29].\nWhen the DCS is not involved during primary authentication (as in Figure 5.30.10.2.2-3), the following applies:\n-\tThe AMF selects a local AUSF as described in clause 5.30.2.10.2.6 and performs primary authentication towards the local AUSF using Default UE credentials for primary authentication as described in TS 33.501 [29].\n-\tUpon establishment of the PDU Session used for User Plane Remote Provisioning the ON-SNPN may trigger secondary authentication procedure, as described in clause 4.3.2.3 of TS 23.502 [3], with the DCS or with a DN-AAA server using Default UE credentials for secondary authentication, as described in clause I.9.2.4 of TS 33.501 [29]. When secondary authentication is used, the SMF identifies the DCS or the DN-AAA server as defined in clause 4.3.2.3 of TS 23.502 [3].\nNOTE 6:\tIf the secondary authentication fails, the SMF rejects the PDU Session used for User Plane Remote Provisioning. Based on local policy the AMF can deregister the UE as described in clause 5.30.2.10.2.7.\nNOTE 7:\tThe DCS and PVS can be owned by an administrative entity that can be different from either the ON-SNPN or SO-SNPN. The ownership of DCS and PVS is outside the scope of 3GPP.\n5.30.2.10.2.3\tBroadcast system information\nWhen the SNPN supports Onboarding of UEs for SNPNs (i.e. the SNPN can be used as ON-SNPN), the NG-RAN node or the Trusted non-3GPP access network providing access to SNPN additionally broadcasts the following information:\n-\tAn onboarding enabled indication that indicates whether onboarding is currently enabled for the SNPN. For access to SNPN via NG-RAN the onboarding enabled indication is broadcasted per cell e.g. to allow start of the onboarding procedure only in parts of the SNPN.\nNOTE:\tOnboarding enabled indication per cell does not affect mobility management functions, i.e. once the UE selects the ON-SNPN as described in clause 5.30.2.10.2.5 and successfully registers within ON-SNPN as described in clause 5.30.2.10.2.6, the UE can move to a cell of the ON-SNPN not indicating onboarding support and continue with the remote provisioning as described in clause 5.30.2.10.4.\n5.30.2.10.2.4\tUE Configuration Aspects\nA UE enabled to support UE Onboarding, shall be pre-configured with Default UE credentials, and the UE may be pre-configured with ON-SNPN selection information. The Default UE credentials consist of credentials for primary authentication and optionally credentials for secondary authentication, as described in clause I.9 of TS 33.501 [29].\nNOTE 1:\tThe content of the ON-SNPN network selection information depends on UE implementation and can include SNPN network identifiers and/or GIN(s).\nThe UE uses the ON-SNPN selection information for selection of ON-SNPN (see clause 5.30.2.10.2.5).\nThe UE Configuration Data for UP Remote Provisioning is described in the clause 5.30.2.10.4.2.\nNOTE 2:\tIt is assumed that the UE is not pre-configured with a S-NSSAI and DNN for the purpose of UE onboarding in the ON-SNPN.\nNOTE 3:\tThe Default UE credentials for primary authentication are used to derive a SUPI. When the UE derives the SUPI from the Default UE credentials for primary authentication, the UE performs specific onboarding procedure as described in clauses 5.30.2.10.2.5, 5.30.2.10.2.6 and 5.30.2.10.2.7.\n5.30.2.10.2.5\tNetwork selection\nThis clause applies only when the UE is in SNPN access mode.\nWhen the UE wants to perform UE onboarding via an SNPN, the UE shall perform ON-SNPN selection as described below. An ON-SNPN is an SNPN providing onboarding access and enabling remote provisioning for a UE registered for onboarding as specified in clause 4.2.2.2.4 of TS 23.502 [3].\nNOTE:\tThe trigger for the UE to initiate the UE Onboarding procedure is UE implementation dependent (e.g. the trigger can be a power-on event in the UE, or an input by the user).\nFor automatic or manual selection, the UE may select and attempt to register to an ON-SNPN which broadcast the Onboarding enabled indication described in clause 5.30.2.10.2.3 and matches the pre-configured ON-SNPN selection information such as SNPN network identifier and/or GIN(s) (if available) described in clause 5.30.2.10.2.4 according to the UE implementation-specific logic. If the registration fails, the UE may select and attempt to register to a different ON-SNPN as defined in clause 4.9.3.1.3 or clause 4.9.3.1.4 of TS 23.122 [17].\n5.30.2.10.2.6\tRegistration for UE onboarding\nWhen the user or UE has selected an ON-SNPN according to clause 5.30.2.10.2.5, the UE establishes an RRC connection towards the NG-RAN node of the ON-SNPN. The UE provides an indication in RRC Connection Establishment that the RRC connection is for onboarding as defined in TS 38.331 [28]. This indication allows the NG-RAN node to select an appropriate AMF that supports the UE onboarding procedures. The UE indicates the ON-SNPN as the selected network, and the NG-RAN node shall indicate the selected PLMN ID and NID of the ON-SNPN to the AMF.\nNOTE 1:\tAs the configuration information in the UE does not include any S-NSSAI and DNN used for onboarding, the UE does not include S-NSSAI and DNN in RRC when it registers for UE onboarding purposes to the ONN.\nThe UE shall initiate the NAS registration procedure by sending a NAS Registration Request message with the following characteristics:\n-\tThe UE shall set the 5GS Registration Type to the value \"SNPN Onboarding\" indicating that the registration request is for onboarding.\n-\tThe UE shall provide a SUCI derived from a SUPI as specified in TS 23.003 [19] and TS 33.501 [29]. The SUPI shall uniquely identify the UE and shall be derived from the Default UE credentials for primary authentication. The SUPI used for onboarding may contain an IMSI or a network-specific identifier. The ON-SNPN may determine the corresponding DCS identity or address/domain, based on the SUCI (i.e. based on the Home Network Identifier of the SUCI).\nThe UE does not include a Requested NSSAI in NAS signalling when it registers for UE onboarding purposes to the ON-SNPN.\nThe AMF supporting UE onboarding is configured with AMF Onboarding Configuration Data that includes e.g.:\n-\tS-NSSAI and DNN to be used for onboarding or a configured SMF for the S-NSSAI and DNN used for onboarding.\n-\tInformation to use a local AUSF(s) within the ON-SNPN for onboarding of UEs with a SUCI for a DCS with AAA Server or for onboarding of UEs in the case where the DCS is not involved during primary authentication.\nNOTE 2:\tThe S-NSSAI used for onboarding is assumed to be configured in both the AMF (i.e. in the AMF Onboarding Configuration Data) and the NG-RAN nodes for the corresponding Tracking Areas where onboarding is enabled.\nWhen the AMF receives a NAS Registration Request with a 5GS Registration Type set to \"SNPN Onboarding\", the AMF:\n-\tstarts an authentication procedure towards the AUSF, the authentication procedure is specified in TS 33.501 [29]. The AMF may be provided with PVS IP address(es) or PVS FQDN(s) from the DCS during authentication procedure. The AMF selects an appropriate AUSF as described in clause 6.3.4 based on the Home Network Identifier of the SUCI used during onboarding or based on local configuration in the AMF.\n-\tapplies the AMF Onboarding Configuration Data e.g. used to restrict UE network usage to only onboarding for User Plane Remote Provisioning of UE as described in clause 5.30.2.10.4.3.\n-\tstores in the UE context in AMF an indication that the UE is registered for SNPN onboarding.\n-\tshall handle the list of equivalent SNPNs as described in TS 24.501 [47].\nUpon successful authentication from AUSF, the AMF informs the UE about the result of the registration. If the UE is not successfully authenticated, the AMF shall reject the registration procedure for onboarding, and the UE may select a different ON-SNPN to attempt to register.\nNOTE 3:\tThe AMF does not interact with the UDM of the ON-SNPN or DCS (i.e. for registration or subscription management purposes) when it receives a NAS Registration Request with a 5GS Registration Type set to \"SNPN Onboarding\" (see clause 4.2.2.2.4 of TS 23.502 [3]).\n5.30.2.10.2.7\tDeregistration from the ON-SNPN for onboarding registered UE\nOnce remote provisioning of SO-SNPN credentials is completed, the UE should initiate deregistration from the ON-SNPN.\nBased on ON-SNPN policies, the AMF may start an implementation specific timer once the UE has registered to the ON-SNPN for the purpose of onboarding. Expiry of this timer triggers the AMF to deregister the onboarding registered UE from the ON-SNPN.\nThe AMF may also deregister the UE when it determines that the PDU Session used for User Plane Remote Provisioning has been released by the SMF.\nWhen AMF re-allocation occurs for a UE registered for SNPN onboarding during mobility registration update procedure as described in TS 23.502 [3] in clause 4.2.2.2.4 or during N2 based handover as described in TS 23.502 [3] clause 4.9.1.3, the new AMF supporting SNPN Onboarding should be selected as described in clause 6.3.5. If the new AMF receives in UE context the indication that the UE is registered for SNPN onboarding, the new AMF may start an implementation specific timer for when to deregister the UE when the new AMF completes the Registration procedure (i.e. sends Registration Accept to the UE) or completes the N2 based handover procedure.\nNOTE:\tThis specific timer is used to prevent onboarding registered UEs from staying at the ON-SNPN indefinitely.\n5.30.2.10.3.1\tGeneral\nA UE configured with PLMN credentials in USIM for primary authentication may register with a PLMN for the provisioning of SO-SNPN credentials.\n5.30.2.10.3.2\tNetwork selection and Registration\nThis clause applies only when the UE is not in SNPN access mode.\nWhen the UE is using PLMN credentials for accessing a PLMN as the Onboarding Network (ONN), then regular network selection, as per TS 23.122 [17] and regular initial registration procedures apply, as per TS 23.502 [3]. After successfully registering to the ON-PLMN, the UE is provisioned with the SO-SNPN credentials via User Plane as in clause 5.30.2.10.4.4.\nNOTE:\tWhen Onboarding network is a PLMN and the UE's subscription only allows for Remote Provisioning, then based on PLMN policies, the AMF can start an implementation specific timer once the UE has registered to the PLMN. Expiry of this timer triggers the AMF to deregister the UE from the PLMN. This specific timer is used to prevent registered UEs that are only allowed for Remote Provisioning from staying at the PLMN indefinitely.\n5.30.2.10.4.1\tGeneral\nRemote Provisioning of UEs that registered with an Onboarding Network enables provisioning the UE with SNPN credentials for primary authentication and other information to enable access to the desired SNPN.\nOnboarding Services are provided using a PDU Session for DNN and S-NSSAI used for onboarding allowing remote provisioning of UEs via User Plane. The PDU Session may be restricted only to be used for Remote Provisioning of the UE.\n5.30.2.10.4.2\tOnboarding configuration for the UE\nIn order to enable UP Remote Provisioning of SNPN credentials for a UE, UE Configuration Data for User Plane Remote Provisioning are either pre-configured on the UE or provided by the ONN. UE Configuration Data for User Plane Remote Provisioning provided by the ONN take precedence over corresponding configuration data stored in the UE.\nUE Configuration Data for User Plane Remote Provisioning consist of PVS IP address(es) and/or PVS FQDN(s).\nIf the UE does not have any PVS IP address or PVS FQDN after the establishment of the PDU Session used for User Plane Remote Provisioning, the UE may construct an FQDN for PVS discovery as defined in TS 23.003 [19].\nThe UE Configuration Data for User Plane Remote Provisioning may be stored in the ME.\nThe UE Configuration Data for User Plane Remote Provisioning (i.e. PVS IP address(es) or PVS FQDN(s), or both) may be:\n-\tlocally configured in the SMF of ONN; and/or\n-\tprovided by the DCS to the AMF of ON-SNPN as part of the authentication procedure as specified in TS 33.501 [29] and sent by the AMF in the Nsmf_PDUSession_CreateSMContext Request message to the SMF\nIf the SNPN acting as ON-SNPN is not capable to provide access to Localized Services, the PVS IP address(es) and/or PVS FQDN(s) provided by the DCS take precedence over the locally configured PVS IP address(es) and/or PVS FQDN(s) in the ON-SNPN. If the SNPN acting as ON-SNPN is capable to provides access to Localized Services, the SMF should include both DCS provided and the locally configured PVS IP address(es) and/or PVS FQDN(s), in the UE Configuration Data for User Plane Remote Provisioning.\nIf the PCF is used for User Plane Remote Provisioning, the SMF provides the UE Configuration Data to the PCF as described in clause 5.30.2.10.4.3.\nThe UE Configuration Data for User Plane Remote Provisioning may be provided to the UE during the establishment of the PDU Session used for User Plane Remote Provisioning as part of Protocol Configuration Options (PCO) in the PDU Session Establishment Response.\nNOTE:\tIf there are multiple PVS IP addresses and/or PVS FQDNs in the UE, how the UE selects PVS from this information is up to UE implementation.\n5.30.2.10.4.3\tUser Plane Remote Provisioning of UEs when Onboarding Network is an ON-SNPN\nThe AMF selects an SMF used for User Plane Remote Provisioning using the SMF discovery and selection functionality as described in clause 6.3.2. The S-NSSAI and DNN of the AMF Onboarding Configuration Data may be used to discover and select an SMF for User Plane Remote Provisioning. Alternatively, for SMF selection, the AMF Onboarding Configuration Data may contain a configured SMF for the S-NSSAI and DNN used for onboarding. The AMF provides Onboarding Indication to SMF via Nsmf_PDUSession_CreateSMContext request message when a PDU Session used for User Plane Remote Provisioning is established. During PDU Session establishment for remote provisioning, the AMF may provide the PVS IP address(es) and/or PVS FQDN(s) to the SMF.\nWhen a UPF is selected for User Plane Remote Provisioning, the UPF selection function described in clause 6.3.3 for normal services is applied considering the S-NSSAI and DNN used for onboarding.\nThe SMF or the PCF may store S-NSSAI and DNN information used for onboarding. Onboarding Configuration Data available to PCF (for details see TS 23.503 [45]) and/or SMF may include PVS FQDN(s) and/or PVS IP address(es). The SMF and the PCF may use Onboarding Indication and DNN and S-NSSAI used for onboarding to access the Onboarding Configuration Data.\nNOTE:\tThe SMF is aware about the PVS IP address(es) and/or PVS FQDN(s) in one of the following ways: either received from the AMF or retrieved locally from the Onboarding Configuration Data.\nWhen the UE registered for Onboarding (i.e. 5GS Registration Type is set to the value \"SNPN Onboarding\") successfully completes the User Plane Remote Provisioning of SNPN credentials via the Onboarding Network, then the UE should deregister from the Onboarding Network.\nInitial QoS parameters used for User Plane Remote Provisioning are configured in the SMF when dynamic PCC is not used.\nDynamic PCC may be used for a PDU Session used for User Plane Remote Provisioning as described in TS 23.503 [45]. If a PCF is used and the AMF provided an Onboarding Indication, the SMF provides Onboarding Indication to the PCF when requesting an SM Policy Association. The SMF may provide the UE Configuration Data (i.e. PVS IP address(es) and/or PVS FQDN(s)) to the PCF when requesting an SM Policy Association.\nThe QoS Flows of a restricted PDU Session, which is associated with the S-NSSAI/DNN used for Onboarding, shall be dedicated to Onboarding Services. The SMF may configure in the UPF PDR(s) and FAR(s) including PVS and DNS server IP addresses to block any traffic that is not from or to PVS and DNS server addresses.\nIf the UE is registered for Onboarding (i.e. 5GS Registration Type is set to the value \"SNPN Onboarding\"), the network should apply S-NSSAI and DNN in the Onboarding Configuration Data for the PDU Session Establishment request from the UE.\n5.30.2.10.4.4\tUser Plane Remote Provisioning of UEs when Onboarding Network is a PLMN\nSubscription data of such a UE shall contain the DNN and S-NSSAI used for onboarding.\nThe AMF selects an SMF used for User Plane Remote Provisioning using the SMF discovery and selection functionality as described in clause 6.3.2, considering the DNN and S-NSSAI used for onboarding provided by the UE or the default DNN and S-NSSAI provided by UDM.\nThe UPF selection function described in clause 6.3.3 is applied, considering the DNN and S-NSSAI used for onboarding.\nThe SMF may be configured with one or more PVS FQDN(s) and/or PVS IP address(es) per DNN and S-NSSAI used for onboarding. When the UE requests a PDU Session used for User Plane Remote Provisioning by using DNN and S-NSSAI used for onboarding, the SMF sends the PVS FQDN(s) and/or PVS IP address(es) associated to the DNN and S-NSSAI of the PDU Session to the UE as part of Protocol Configuration Options (PCO) in the PDU Session Establishment Response if the following conditions are met:\n-\tthe UE subscription data contains the DNN and S-NSSAI used for onboarding; and\n-\tthe SMF has obtained the PVS FQDN(s) and/or PVS IP address(es) associated to the DNN and S-NSSAI of the PDU Session from local configuration; and\n-\tthe UE has requested PVS information via PCO in PDU Session Establishment Request.\nNOTE 1:\tLocal PCC or dynamic PCC can be used as described for PLMNs in TS 23.503 [45] and based on operator policy, PDR(s) and FAR(s) can be configured to restrict traffic other than provisioning traffic between PVS/DNS server(s) and UE(s).\nNOTE 2:\tIf the UE receives multiple PVS IP addresses and/or PVS FQDNs, how the UE uses this information is up to UE implementation.\nIf the UE moves its 3GPP access between SNPN and PLMN, the network selection is performed as specified in TS 23.122 [17] and UE performs initial registration as specified in clause 4.2.2.2.2 of TS 23.502 [3].\nNOTE 1:\tWhen the UE moves its 3GPP access between SNPN and PLMN, it is up to UE implementation to activate/deactivate SNPN access mode.\nIf the UE moves its 3GPP access between SNPNs, the network selection is performed as specified in TS 23.122 [17], then the UE performs initial or mobility registration as specified in clause 4.2.2.2.2 of TS 23.502 [3].\nNOTE 2:\tWhen the UE moves its 3GPP access between SNPNs, it is up to UE implementation whether and when to establish again PDU Sessions using existing mechanism.\nIf the UE and network supports equivalent SNPNs, the AMF may provide list of equivalent SNPNs to the UE and NG-RAN. The UE may move its 3GPP access to the SNPN in the list of equivalent SNPNs without performing network selection. A UE supporting equivalent SNPNs gets a new registered SNPN ID during the Registration procedure if serving SNPN is changed.\nAccess to SNPN services via Untrusted non-3GPP access network follows the specification in the previous 5.30.2 clauses with the differences as specified in this clause.\nN3IWF selection is supported as follows:\n-\tWhen UE registers to SNPN with credentials owned by the SNPN, UE uses the same N3IWF selection procedure as specified for access to stand-alone non-public network services via PLMN in clause 6.3.6.2a.\nEmergency services are supported as follows:\n-\tUE initiates N3IWF selection for emergency services when the UE detects a user request for emergency session and determines that Untrusted non-3GPP access is to be used for the emergency access. The UE in SNPN access mode the following:\n-\tIf the UE determines that it is located in the same country as the configured N3IWF of the subscribed SNPN, the UE uses the configured N3IWF FQDN for N3IWF selection.\n-\tOtherwise, the UE performs a DNS query using the Visited Country Emergency SNPN FQDN, as specified in clause 28.3.2.2.6.3 of TS 23.003 [19] to determine which SNPNs in the visited country support emergency services in untrusted non-3GPP access via N3IWF; and:\n-\tIf the DNS response contains one or more records, the UE selects an SNPN that supports emergency services in untrusted non-3GPP access via N3IWF based on UE implementation specific methods. Each record in the DNS response shall contain the identity of an SNPN (i.e. SNPN ID) in the visited country supporting emergency services in untrusted non-3GPP access via N3IWF.\nNOTE 1:\tSelf-assigned NIDs are not supported, since a DNS cannot be properly configured for multiple SNPNs using the same self-assigned NID (i.e. in collision scenarios).\n-\tOnce the UE has selected an SNPN, the UE selects an N3IWF for Emergency for the selected SNPN, as specified in TS 23.003 [19].\nWhen an N3IWF has been selected, the UE initiates an Emergency Registration. If the Emergency Registration fails, the UE shall select another SNPN supporting emergency services in untrusted non-3GPP access.\nIf the DNS response of the Visited Country Emergency SNPN FQDN does not contain any record, or if the DNS response contains one or more records but the UE fails to select an SNPN that supports emergency services in untrusted non-3GPP access, or if the Emergency Registration procedure has failed for all SNPNs supporting emergency services in untrusted non-3GPP access, the UE deactivates the SNPN access mode over NWu and attempts emergency services via PLMN untrusted non-3GPP access, by following the N3IWF selection procedure as defined in clause 6.3.6.4.2.\nNOTE 2:\tIf the UE determines that it is located in a different country as the configured N3IWF of the subscribed SNPN, the UE can deactivate the SNPN access mode over NWu and attempts emergency services via PLMN untrusted non-3GPP access, by following the N3IWF selection procedure defined in clause 6.3.6.4.2, without performing a DNS query using the Visited Country Emergency SNPN FQDN.\nUE onboarding is supported as follows:\n-\tWhen UE registers to SNPN over Untrusted non-3GPP access for UE Onboarding, if the UE determines that it is located in the country where the configured N3IWF for onboarding is located, the UE may select the N3IWF in the SNPN which supports UE Onboarding by using the configured N3IWF FQDN used for Onboarding.\n-\tIf the UE determines that it is located in a country different from the country where the configured N3IWF for onboarding is located (called the visited country), then in order to determine which SNPNs in the visited country support Untrusted non-3GPP access for UE Onboarding via N3IWF performs a DNS query using the Visited Country FQDN for SNPN N3IWF supporting Onboarding, as specified in clause 28.3.2.2.6.2 of TS 23.003 [19]; and:\n-\tIf no DNS response is received, the UE shall stop the N3IWF selection.\n-\tIf the DNS response contains one or more records, the UE selects an SNPN that supports Untrusted non-3GPP access for UE Onboarding via N3IWF. Each record in the DNS response shall contain the identity of an SNPN in the visited country supporting Untrusted non-3GPP access for UE Onboarding via N3IWF. In this case:\n-\tThe UE shall select an SNPN based on its own implementation means.\nIf the UE cannot select any N3IWF included in the DNS response, then the UE shall stop the N3IWF selection.\n-\tIf the DNS response contains no records, then the UE determines that the visited country does not mandate the selection of an N3IWF that supports Untrusted non-3GPP access for UE Onboarding via N3IWF in this country. In this case the UE uses the configured N3IWF for onboarding.\n-\tIf the UE has selected an SNPN for onboarding, the UE constructs the Operator Identifier based Onboarding FQDN for SNPN N3IWF as specified in clause 28.3.2.2.7.2 of TS 23.003 [19], based on the SNPN ID of the selected SNPN and performs a DNS query:\n-\tThe DNS response contains the identifier of the N3IWF supporting the onboarding in the SNPN identified by the SNPN ID.\n-\tIf the PVS is reachable from the local Untrusted non-3GPP access network (e.g. via the Internet) using the local IP connectivity, UE may connect directly (i.e. without being connected to an N3WIF) with a PVS to obtain the SNPN credentials.\n-\tAs part of UE registration via Untrusted non-3GPP access, in Figure 4.12.2.2-1, step 5 of TS 23.502 [3], the UE provides an onboarding indication inside the AN-Parameters.\nAccess to SNPN services via Trusted non-3GPP access network follows the specification in the previous (sub)clauses of clause 5.30.2 with the differences as specified in this clause.\nTo access SNPN services via a Trusted non-3GPP access network, the UE follows the procedure for accessing a PLMN via a Trusted non-3GPP access network defined in clause 6.3.12.2 with the following clarifications and additions:\n-\tA non-3GPP access network may advertise (e.g. with ANQP), not only the PLMNs with which 5G connectivity is supported (as specified in clause 6.3.12.2), but also the SNPNs with which 5G connectivity is supported and the related parameters and indications defined in clause 5.30.2.2 (i.e. human-readable network name(s), GIN(s), indication whether access using credentials from a Credentials Holder is supported, indication whether SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN, etc.).\n-\tThe UE initiates the access network selection procedure specified in clause 6.3.12.2 and constructs a list of available SNPNs. This list contains the SNPNs advertised by all discovered non-3GPP access networks.\n-\tThe UE selects an SNPN that is included in the list of available SNPNs following the procedure in clause 5.30.2.4.\n-\tThe UE selects a non-3GPP access network that supports 5G connectivity to the selected SNPN and initiates the registration procedure via Trusted non-3GPP access specified in clause 4.12a.2.2 of TS 23.502 [3] in order to register with the selected SNPN via the selected non-3GPP access network. During the EAP authentication procedure the NAI provided by the UE indicates that 5G connectivity to a specific SNPN is required (e.g. NAI = \"<username>@nai.5gc.nid<NID>.mnc<MNC>.mcc<MCC>.3gppnetwork.org\").\nNOTE:\tIn the case of SNPN ID with self-assigned NID, if the UE, when trying to register with an SNPN ID via TNAN X, is rejected by the AMF with a cause code that temporarily prevents the UE from registering with this SNPN ID, the UE does temporarily not attempt to register with the same SNPN ID, even if the same SNPN ID is advertised via another TNAN.\n-\tIf there are multiple non-3GPP access networks that support 5G connectivity to the selected SNPN, then the UE places these non-3GPP access networks in a prioritized list and selects the highest priority non-3GPP access network from this list. To determine the priority of a non-3GPP access network, the UE shall apply the WLANSP rules (if provided), and the procedure specified in clause 6.6.1.3 of TS 23.503 [45], \"UE procedure for selecting a WLAN access based on WLANSP rules\". If the UE is not provided with WLANSP rules, the UE determines the priority of a non-3GPP access network by using implementation means.\nUE onboarding via Trusted non-3GPP access is supported as follows:\n-\tThe non-3GPP access network advertises (e.g. via ANQP) an Onboarding enabled indication, as specified in clause 5.30.2.10.2.3.\n-\tThe UE selects an SNPN advertising the Onboarding enabled indication following the network selection procedure specified in clause 5.30.2.10.2.5.\n-\tAs part of UE registration via Trusted non-3GPP access, in Figure 4.12a.2.2-1, step 5 of TS 23.502 [3] the UE provides an onboarding indication inside the AN-Parameters.\nAccess to SNPN services via a wireline access network is specified in TS 23.316 [84].\nDevices that do not support 5GC NAS signalling over WLAN access (referred to as \"Non-5G-Capable over WLAN\" devices, or N5CW devices for short), may access 5GC in an SNPN via a trusted WLAN access network that supports a TWIF function. To access SNPN services the N5CW device performs the following procedure:\n-\tA WLAN access network may advertise (e.g. with ANQP), not only the PLMNs with which \"5G connectivity-without-NAS\" is supported (as specified in clause 6.3.12a.1), but also the SNPNs with which \"5G connectivity-without-NAS\" is supported, as well as the related parameters and indications defined in clause 5.30.2.2 (i.e. human-readable network name(s), GIN(s), indication whether access using credentials from a Credentials Holder is supported, indication whether SNPN allows registration attempts from UEs that are not explicitly configured to select the SNPN).\n-\tThe N5CW device initiates the access network selection procedure by sending an ANQP query to each discovered WLAN access network and constructs a list of available SNPNs with which \"5G connectivity-without-NAS\" is supported. This list contains the SNPNs with which \"5G connectivity-without-NAS\" is supported as advertised by all the discovered WLAN access networks.\n-\tThe N5CW device selects an SNPN that is included in the list of available SNPNs with which \"5G connectivity-without-NAS\" is supported following the procedure in clause 5.30.2.4.\n-\tThe N5CW device selects a WLAN access network (e.g. an SSID) that supports \"5G connectivity-without-NAS\" to the selected SNPN and initiates the \"Initial Registration and PDU Session Establishment\" procedure specified in clause 4.12b.2 of TS 23.502 [3]. If there are multiple WLAN access networks that support \"5G connectivity-without-NAS\" to the selected SNPN, then the N5CW device selects the highest priority WLAN access network from this list. To determine the priority of a WLAN access network, the N5CW device shall apply the WLANSP rules (if provided), and the procedure specified in clause 6.6.1.3 of TS 23.503 [45], \"UE procedure for selecting a WLAN access based on WLANSP rules\". If the N5CW device is not provided with WLANSP rules, the N5CW device determines the priority of a WLAN access network by using implementation means.\nNOTE:\tHow the N5CW device selects credentials to use for SNPN access is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.30.3\tPublic Network Integrated NPN",
                            "text_content": "Public Network Integrated NPNs are NPNs made available via PLMNs e.g. by means of dedicated DNNs, or by one (or more) Network Slice instances allocated for the NPN. The existing network slicing functionalities apply as described in clause 5.15. When a PNI-NPN is made available via a PLMN, then the UE shall have a subscription for the PLMN in order to access PNI-NPN.\nNOTE 1:\tAnnex D provides additional consideration to consider when supporting Non-Public Network as a Network Slice of a PLMN.\nAs network slicing does not enable the possibility to prevent UEs from trying to access the network in areas where the UE is not allowed to use the Network Slice allocated for the NPN, Closed Access Groups may optionally be used to apply access control.\nA Closed Access Group identifies a group of subscribers who are permitted to access one or more CAG cells associated to the CAG.\nCAG is used for the PNI-NPNs to prevent UE(s), which are not allowed to access the NPN via the associated cell(s), from automatically selecting and accessing the associated CAG cell(s).\nNOTE 2:\tCAG is used for access control e.g. authorization at cell selection and configured in the subscription as part of the Mobility Restrictions i.e. independent from any S-NSSAI. CAG is not used as input to AMF selection nor Network Slice selection. If NPN isolation is desired, operator can better support NPN isolation by deploying network slicing for PNI-NPN, configuring dedicated S-NSSAI(s) for the given NPN as specified in Annex D, clause D.2 and restricting NPN's UE subscriptions to these dedicated S-NSSAI(s).\nThe UE and PNI-NPN may support remote provisioning of credentials for NSSAA or credentials for secondary authentication/authorization to the UE, as specified in clause 5.39.\nNOTE 3:\tAfter successful provisioning of the credentials to the UE, specific service subscription data (e.g. to enable the use of PNI-NPN) can be activated in the UE Subscription data in the UDR/UDM. This can result in a change of the UE Subscription Data to include new S-NSSAI, DNN or CAG information, which can trigger update of the UE configurations, e.g. described in clause 5.15.5.2.2.\nNOTE 4:\tThe UE always has subscription to the HPLMN providing the PNI-NPN and has a USIM that contains primary authentication credentials.\nSupport for Proximity based Services (ProSe) as defined in TS 23.304 [128] in conjunction with CAG is not specified in this Release of the specification.\nThe following is required for identification:\n-\tA CAG is identified by a CAG Identifier which is unique within the scope of a PLMN ID;\n-\tA CAG cell broadcasts one or multiple CAG Identifiers per PLMN;\nNOTE 1:\tIt is assumed that a cell supports broadcasting a total of twelve CAG Identifiers. Further details are defined in TS 38.331 [28].\n-\tA CAG cell may in addition broadcast a human-readable network name per CAG Identifier:\nNOTE 2:\tThe human-readable network name per CAG Identifier is only used for presentation to user when user requests a manual CAG selection.\nTo use CAG, the UE, that supports CAG as indicated as part of the UE 5GMM Core Network Capability, may be pre-configured or (re)configured with the following CAG information, included in the subscription as part of the Mobility Restrictions:\n-\tan Allowed CAG list i.e. a list of CAG Identifiers the UE is allowed to access; and\n-\teach entry of the Allowed CAG list may be associated with time validity information; and\n-\toptionally, a CAG-only indication whether the UE is only allowed to access 5GS via CAG cells (see TS 38.304 [50] for how the UE identifies whether a cell is a CAG cell);\nThe HPLMN may configure or re-configure a UE with the above CAG information using the UE Configuration Update procedure for access and mobility management related parameters described in clause 4.2.4.2 of TS 23.502 [3].\nThe above CAG information is provided by the HPLMN on a per PLMN basis. In a PLMN the UE shall only consider the CAG information provided for this PLMN. The entries of the Allowed CAG list with validity condition are provided to the UE only if the UE indicates support of CAG with validity information.\nNOTE 1:\tIf the UE supports CAG but not CAG with validity information and there are entries of the Allowed CAG list that are associated with validity information in the subscription data, the CAG Identifier of the corresponding entry in subscription data can be provided to the UE without validity information when the validity condition is evaluated as true and removed when the evaluation changes to false. It is up to AMF local policy whether to provide such CAG Identifier to the UE. In case the AMF does not support CAG with validity information e.g. in the case of roaming, the UDM provides CAG information to the AMF without entries including validity information.\nWhen the subscribed CAG information changes, UDM sets a CAG information Subscription Change Indication and sends it to the AMF. The AMF shall provide the UE with the CAG information when the UDM indicates that the CAG information within the Access and Mobility Subscription data has been changed. When AMF receives the indication from the UDM that the CAG information within the Access and Mobility Subscription has changed, the AMF uses the CAG information received from the UDM to update the UE. Once the AMF updates the UE and obtains an acknowledgment from the UE, the AMF informs the UDM that the update was successful and the UDM clears the CAG information Subscription Change Indication flag.\nThe AMF may update the UE using either the UE Configuration Update procedure after registration procedure is completed, or by including the new CAG information in the Registration Accept or in the Registration Reject or in the Deregistration Request or in the Service Reject.\nWhen the UE is roaming and the Serving PLMN provides CAG information, the UE shall update only the CAG information provided for the Serving PLMN while the stored CAG information for other PLMNs are not updated. When the UE is not roaming and the HPLMN provides CAG information, the UE shall update the CAG information stored in the UE with the received CAG information for all the PLMNs.\nThe UE shall store the latest available CAG information for every PLMN for which it is provided and keep it stored when the UE is de-registered or switched off, as described in TS 24.501 [47].\nThe CAG information is only applicable with 5GS.\nNOTE 2:\tCAG information has no implication on whether and how the UE accesses 5GS over non-3GPP access.\nThe following is assumed for network and cell selection, and access control:\n-\tThe CAG cell shall broadcast information such that only UEs supporting CAG are accessing the cell (see TS 38.300 [27], TS 38.304 [50]);\nNOTE 1:\tThe above also implies that cells are either CAG cells or normal PLMN cells. For network sharing scenario between SNPN, PNI-NPN and PLMNs, please see clause 5.18.\n-\tIn order to prevent access to NPNs for authorized UE(s) in the case of network congestion/overload, existing mechanisms defined for Control Plane load control, congestion and overload control in clause 5.19 can be used, as well as the access control and barring functionality described in clause 5.2.5, or Unified Access Control using the access categories as defined in TS 24.501 [47] can be used.\n-\tFor aspects of automatic and manual network selection in relation to CAG, see TS 23.122 [17];\n-\tFor aspects related to cell (re-)selection, see TS 38.304 [50];\n-\tIf the UE is accessing a CAG cell and the corresponding entry of the Allowed CAG list configured on the UE is associated with validity information, the UE may trigger cell reselection and/or network selection procedure if the evaluation of the validity condition changes.\n-\tThe Mobility Restrictions shall be able to restrict the UE's mobility according to the Allowed CAG list (if configured in the subscription) and include an indication whether the UE is only allowed to access 5GS via CAG cells (if configured in the subscription) as described in clause 5.30.3.3;\n-\tThe AMF shall update the Allowed CAG list in the Mobility Restrictions towards NG-RAN if the evaluation of the validity condition of an entry in the Allowed CAG list changes between true and false, unless the AMF releases the NAS signalling connection to the UE based on operator's policy if the evaluation of the validity condition changes from true to false.\n-\tDuring transition from CM-IDLE to CM-CONNECTED and during Registration after connected mode mobility from E-UTRAN to NG-RAN as described in clause 4.11.1.2.2 of TS 23.502 [3]:\n-\tThe AMF shall verify whether UE access is allowed by Mobility Restrictions:\nNOTE 2:\tIt is assumed that the AMF is made aware of the supported CAG Identifier(s) of the CAG cell by the NG-RAN.\n-\tIf the UE is accessing the 5GS via a CAG cell and if at least one of the CAG Identifier(s) received from the NG-RAN is part of the UE's Allowed CAG list (for entries with validity information if any, the evaluation of the condition is true), then the AMF accepts the NAS request;\n-\tIf the UE is accessing the 5GS via a CAG cell and if none of the CAG Identifier(s) received from the NG-RAN are part of the UE's Allowed CAG list (for entries with validity information if any, the evaluation of the condition is true), then the AMF rejects the NAS request and the AMF should include CAG information in the NAS reject message. The AMF shall then release the NAS signalling connection for the UE by triggering the AN release procedure; and\n-\tIf the UE is accessing the 5GS via a non-CAG cell and the UE's subscription contains an indication that the UE is only allowed to access CAG cells, then the AMF rejects the NAS request and the AMF should include CAG information in the NAS reject message. The AMF shall then release the NAS signalling connection for the UE by triggering the AN release procedure.\n-\tDuring transition from RRC_INACTIVE to RRC_CONNECTED state:\n-\tWhen the UE initiates the RRC Resume procedure for RRC_INACTIVE to RRC_CONNECTED state transition in a CAG cell, NG-RAN shall reject the RRC Resume request from the UE if none of the CAG Identifiers supported by the CAG cell are part of the UE's Allowed CAG list according to the Mobility Restrictions received from the AMF or if no Allowed CAG list has been received from the AMF.\n-\tWhen the UE initiates the RRC Resume procedure for RRC_INACTIVE to RRC_CONNECTED state transition in a non-CAG cell, NG-RAN shall reject the UE's Resume request if the UE is only allowed to access CAG cells according to the Mobility Restrictions received from the AMF.\n-\tDuring connected mode mobility procedures within NG-RAN, i.e. handover procedures as described in clause 4.9.1 of TS 23.502 [3]:\n-\tSource NG-RAN shall not handover the UE to a target NG-RAN node if the target is a CAG cell and none of the CAG Identifiers supported by the CAG cell are part of the UE's Allowed CAG list in the Mobility Restriction List or if no Allowed CAG list has been received from the AMF;\n-\tSource NG-RAN shall not handover the UE to a non-CAG cell if the UE is only allowed to access CAG cells based on the Mobility Restriction List;\n-\tIf the target cell is a CAG cell, target NG-RAN shall reject the N2 based handover procedure if none of the CAG Identifiers supported by the CAG cell are part of the UE's Allowed CAG list in the Mobility Restriction List or if no Allowed CAG list has been received from the AMF;\n-\tIf the target cell is a non-CAG cell, target NG-RAN shall reject the N2 based handover procedure if the UE is only allowed to access CAG cells based on the Mobility Restriction List.\n-\tUpdate of Mobility Restrictions:\n-\tWhen the AMF receives the Nudm_SDM_Notification from the UDM and the AMF determines that the Allowed CAG list or the indication whether the UE is only allowed to access CAG cells have changed;\n-\tThe AMF shall update the Mobility Restrictions in the UE and NG-RAN accordingly under the conditions as described in clause 4.2.4.2 of TS 23.502 [3].\nNOTE 3:\tWhen the UE is accessing the network for emergency services the conditions for AMF in clause 5.16.4.3 apply.\nEmergency Services are supported in CAG cells, for UEs supporting CAG, whether normally registered or emergency registered as described in clause 5.16.4 and in clause 4.13.4 of TS 23.502 [3].\nA UE may camp on an acceptable CAG cell in limited service state as specified in TS 23.122 [17] and TS 38.304 [50], based on operator policy defined in TS 38.300 [27].\nNOTE:\tSupport for Emergency services requires each cell with a Cell Identity associated with PLMNs or PNI-NPNs to only be connected to AMFs that supports emergency services.\nThe UE shall select a PLMN (of a CAG cell or non-CAG cell), as described in TS 23.122 [17] and TS 23.167 [18], when initiating emergency services from limited service state.\nDuring handover to a CAG cell, if the UE is not authorized to access the target CAG cell as described in clause 5.30.3.4 and has emergency services, the target NG-RAN node only accepts the emergency PDU Session and the target AMF releases the non-emergency PDU Sessions that were not accepted by the NG-RAN node. Upon completion of handover the UE behave as emergency registered.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.31\tSupport for Cellular IoT",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.31.1\tGeneral",
                            "text_content": "This clause provides an overview about 5GS optimisations and functionality for support of Cellular Internet-of-Things (Cellular IoT, or CIoT) according to service requirements described in TS 22.261 [2]. Cellular IoT is in earlier 3GPP releases also referred to as Machine Type Communication (MTC) (see clause 4.3.17 of TS 23.401 [26]). The specific functionality is described in the affected procedures and features of this specification, in TS 23.502 [3], TS 23.503 [45] and other specifications.\nIn this Release Control Plane CIoT 5GS Optimisations (clause 5.31.4) and User Plane CIoT 5GS Optimisations (clause 5.31.18) are only supported over E-UTRA and these CIoT 5GS optimisations are not supported over Non-3GPP RAT type accesses.\nCIoT functionality is provided by the visited and home networks when the networks are configured to support CIoT. It applies to both the non-roaming case and the roaming case and some functionality may be dependent upon the existence of appropriate roaming agreements between the operators.\nSome of the CIoT functions are controlled by subscriber data. Other CIoT functions are based on indicators sent by the UE to the network. CIoT functionality is performed by UEs that are configured to support different options as described in clause 5.31.2\nThough motivated by scenarios and use cases defined in TS 22.261 [2], the functions added to support CIoT have general applicability and are in no way constrained to any specific scenario, use case or UE types, except where explicitly stated.\nIn the context of CIoT the term AF denotes an SCS/AS as defined TS 23.682 [36].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.2\tPreferred and Supported Network Behaviour",
                            "text_content": "At registration, a UE includes its 5G Preferred Network Behaviour indicating the network behaviour the UE can support and what it would prefer to use.\nNOTE:\tIf the UE supports S1-mode then the UE will indicate the supported EPS Network Behaviour Information in the S1 UE network capability IE.\nThe 5G Preferred Network Behaviour signalled by the UE includes the following information in the 5GMM Capability IE:\n-\tWhether Control Plane CIoT 5GS Optimisation is supported.\n-\tWhether User Plane CIoT 5GS Optimisation is supported.\n-\tWhether N3 data transfer is supported.\n-\tWhether header compression for Control Plane CIoT 5GS Optimisation is supported.\nAnd the following 5G Preferred Network Behaviour in other IEs:\n-\tWhether Control Plane CIoT 5GS Optimisation or User Plane CIoT 5GS Optimisation is preferred.\nIf N3 data transfer is supported is indicated by the UE, the UE supports data transfer that is not subject to CIoT 5GS Optimisations. If the UE indicates support of User Plane CIoT 5GS Optimisation then it shall also indicate support of N3 data transfer.\nThe AMF indicates the network behaviour the network accepts in the 5G Supported Network Behaviour information. This indication is per Registered Area. The AMF may indicate one or more of the following:\n-\tWhether Control Plane CIoT 5GS Optimisation is supported.\n-\tWhether User Plane CIoT 5GS Optimisation is supported.\n-\tWhether N3 data transfer is supported.\n-\tWhether header compression for Control Plane CIoT 5GS Optimisation is supported.\nIf the AMF indicates support of User Plane CIoT 5GS Optimisation then it shall also indicate support of N3 data transfer. If the UE and AMF indicate support for User Plane CIoT 5GS Optimisation, the AMF indicates support of User Plane CIoT 5GS Optimisation support for the UE to NG-RAN.\nFor NB-IoT UEs that only support Control Plane CIoT 5GS Optimisation, the AMF shall include support for Control Plane CIoT 5GS Optimisation in the Registration Accept message.\nA UE that supports the NB-IoT shall always indicate support for Control Plane CIoT 5GS Optimisation.\nA UE that supports WB-E-UTRA shall always indicate support for N3 data transfer.\nThe 5G Preferred Network Behaviour indication from the UE may be used to influence policy decisions that can cause rerouting of the Registration Request from an AMF to another AMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.3\tSelection, steering and redirection between EPS and 5GS",
                            "text_content": "The UE selects the core network type (EPC or 5GC) based on the broadcast indications for both EPC and 5GC, and the UE's EPC and 5GC Preferred Network Behaviour. Networks that support NB-IoT shall broadcast an indication whether N3 data transfer is supported or not in system information.\nWhen the UE performs the registration procedure it includes its Preferred Network Behaviour (for 5G and EPC) in the Registration Request message and the AMF replies with the 5G Supported Network Behaviour in the Registration Accept message.\nIf the UE supports any of the CIoT 5GS Optimisations included in 5GC Preferred Network Behaviour, then when the UE performs an Attach or TAU procedure and the UE includes its EPC Preferred Network Behaviour then the UE shall also include its 5GC Preferred Network Behaviour.\nIn networks that support CIoT features in both EPC and 5GC, the operator may steer UEs from a specific CN type due to operator policy, e.g. due to roaming agreements, Preferred and Supported Network Behaviour, load redistribution, etc. Operator policies in EPC and 5GC are assumed to avoid steering UEs back and forth between EPC and 5GC.\nTo redirect a UE from 5GC to EPC, when the UE sends a Registration Request or Service Request, the AMF sends a Registration Reject or Service Reject with an EMM cause value indicating that the UE should not use 5GC. The UE disables N1 mode and re-enables S1 mode, if it was disabled. The UE then performs either an Attach or TAU in EPC as described in clause 5.17.2.\nTo redirect a UE from EPC to 5GC, when the UE requests an Attach or TAU procedure or Service Reject, the MME sends a reject message with an EMM cause indicating the UE should not use EPC. The UE disables S1 mode and re-enables N1 mode, if it was disabled. The UE then registers with 5GC as described in clause 5.17.2.\nWhen determining whether to redirect the UE, the AMF/MME takes into account the UE support of S1/N1 mode, respectively, and the UE's Preferred Network Behaviour and the Supported Network Behaviour of the network the UE is being redirected towards.\nWhen determining to redirect the UE in 5GMM-CONNECTED mode to EPC, the AMF shall initiate the UE Configuration Update procedure to indicate registration requested and release of the N1 NAS signalling connection not requested, then the AMF redirects the UE to EPC by rejecting the subsequent Registration Request, see TS 24.501 [47].\nIf after redirection the UE cannot find a cell supporting connectivity, the UE may re-enable the disabled N1/S1 mode and then perform Registration, Attach or TAU.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.4\tControl Plane CIoT 5GS Optimisation",
                            "text_content": "The Control Plane CIoT 5GS Optimisation is used to exchange user data between the UE and the SMF as payload of a NAS message in both uplink and downlink directions, avoiding the establishment of a user plane connection for the PDU Session. The UE and the AMF perform integrity protection and ciphering for the user data by using NAS PDU integrity protection and ciphering. For IP and Ethernet data, the UE and the SMF may negotiate and perform header compression.\nNOTE:\tIn the context of Control Plane CIoT 5GS Optimisation, established or activated user plane resources/connection refers to radio user plane resources/connection i.e Data Radio Bearer and N3 tunnel.\nUE and AMF negotiate support and use of Control Plane CIoT 5GS Optimisation as defined in clause 5.31.2. When the Control Plane CIoT 5GS Optimisation feature is used and the PDU Session Type is unstructured, the SMF selects either NEF or UPF based on information in the UE's subscription.\nIf UE and network have negotiated support and use of Control Plane CIoT 5GS Optimisation then the following paragraphs of this clause apply.\nDuring the PDU Session Establishment procedure the AMF indicates to the SMF that Control Plane CIoT 5GS Optimisation is available for data transmission.\nDuring the PDU Session Establishment procedure the AMF also determines based on Preferred and Supported Network Behaviour (see clause 5.31.2), subscription data, other already established PDU Sessions and local policy whether a new PDU Session shall only use the Control Plane CIoT 5GS Optimisation (i.e. that a user-plane connection shall never be established for the new PDU Session). If a PDU Session shall only use Control Plane CIoT 5GS Optimisation, the AMF provides a Control Plane Only Indicator to the SMF during the PDU Session Establishment. The SMF provides the Control Plane Only Indicator in the Session Management Request to the UE. A UE and SMF receiving the Control Plane Only Indicator for a PDU Session shall always use the Control Plane CIoT 5GS Optimisation for this PDU Session.\nThe following rules apply for the use of the Control Plane Only Indicator during PDU Session Establishment:\n-\tIf N3 data transfer was not successfully negotiated, all PDU Sessions shall include Control Plane Only Indicator.\n-\tIf N3 data transfer was successfully negotiated then:\n-\tFor a new PDU Session for a DNN/S-NSSAI for which the subscription data for SMF Selection includes an Invoke NEF indication (i.e. for a PDU Session which will be anchored in NEF), the AMF shall always include the Control Plane Only Indicator.\n-\tFor a new PDU Session for a DNN/S-NSSAI for which the subscription data for SMF Selection does not include an Invoke NEF indication (i.e. for a PDU Session which will be anchored in UPF) and that supports interworking with EPS based on the subscription data defined in TS 23.502 [3]:\n-\tfor the first PDU Session the AMF determines based on local policy whether to include the Control Plane Only Indicator or not;\n-\tif the AMF previously included a Control Plane Only Indicator for PDU Sessions that support interworking with EPS based on the subscription data defined in TS 23.502 [3] and that are anchored in UPF, the AMF shall include it also for the new PDU Session;\n-\tif the AMF previously did not include a Control Plane Only Indicator for any of the PDU Sessions that support interworking with EPS based on the subscription data defined in TS 23.502 [3] and that are anchored in UPF, the AMF shall not include it for the new PDU Session.\n-\tFor a new PDU Session for a DNN/S-NSSAI for which the subscription data for SMF Selection does not include an Invoke NEF indication (i.e. for a PDU Session which will be anchored in UPF) and that does not support interworking with EPS based on the subscription data defined in TS 23.502 [3], AMF determines individually per PDU Session whether to include the Control Plane Only Indicator or not.\nAs described in clause 5.31.4.2, if UE and AMF successfully negotiate N3 data transfer in addition to Control Plane CIoT 5GS Optimisation, the UE or SMF may request to establish N3 data transfer for one or more PDU Sessions for which Control Plane Only Indicator was not received. In CM-CONNECTED, the UE and the network use N3 delivery for PDU Sessions for which user plane resources are established, and uses NAS for data transmission for PDU Sessions for which user plane resources are not established.\nIf the AMF determines that Control Plane Only indication associated with PDU Session is not applicable any longer due to e.g. change of Preferred and Supported Network Behaviour, subscription data, and local policy, the AMF should request the SMF to release the PDU Session as specified in clause 4.3.4.2 or clause 4.3.4.3 of TS 23.502 [3].\nEarly Data Transmission may be initiated by the UE for mobile originated Control Plane CIoT 5GS Optimisation when the RAT Type is E-UTRA.\nThe QoS model as defined in clause 5.7 is not supported for PDU Sessions using Control Plane CIoT 5GS Optimisation as user plane resources are not established for those PDU Sessions.\nIf UE and AMF have successfully negotiated N3 data transfer in addition to Control Plane CIoT 5GS Optimisation based on the Preferred and Supported Network Behaviour as defined in clause 5.31.2, then the SMF may decide to establish N3 data transfer for any PDU session for which Control Plane Only Indicator was not included based on local SMF decision e.g. based on the amount of data transferred in UL or DL using Control Plane CIoT 5GS Optimisation. In that case, the SMF initiates the SMF-triggered N3 data transfer establishment procedure as described in clause 4.2.10.2 of TS 23.502 [3].\nIf UE and AMF successfully negotiate N3 data transfer in addition to Control Plane CIoT 5GS Optimisation based on the Preferred and Supported Network Behaviour as defined in clause 5.31.2, then the UE may decide to establish N3 data transfer for any PDU session for which Control Plane Only Indicator was not included based on local decision, e.g. based on the amount of data to be transferred. In that case, the UE performs the UE triggered N3 data transfer establishment procedure as described in clause 4.2.10.1 of TS 23.502 [3].\nFor intra-NB-IoT mobility when UE and AMF are using Control Plane CIoT 5GS Optimisation, the CP Relocation Indication procedures may be used. The purpose of the CP Relocation Indication procedure is to request the AMF to authenticate the UE's re-establishment request (see TS 33.501 [29]), and initiate the establishment of the UE's N2 connection after the UE has initiated an RRC Re-Establishment procedure in a new NG-RAN node (see TS 38.300 [27]).\nThe RRC Re-Establishment procedure uses the Truncated 5G-S-TMSI as the UE identifier. The NG-RAN is configured with the sizes of the components of the Truncated 5G-S-TMSI and it is configured with how to recreate the AMF Set ID, the AMF Pointer and 5G-TMSI from the equivalent truncated parameters (see TS 23.003 [19]).\nThe AMF configures the UE with the Truncated 5G-S-TMSI Configuration that provides the sizes of the components of the Truncated 5G-S-TMSI as described in TS 24.501 [47] during the Registration. The configuration of these parameters are specific to each PLMN.\nNOTE:\tNetwork sharing default configuration of the sizes of the truncated components is described in TS 23.003 [19].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.5\tNon-IP Data Delivery (NIDD)",
                            "text_content": "Functions for NIDD may be used to handle Mobile Originated (MO) and Mobile Terminated (MT) communication for unstructured data (also referred to as Non-IP). Such delivery to the AF is accomplished by one of the following two mechanisms:\n-\tDelivery using the NIDD API;\n-\tDelivery using UPF via a Point-to-Point (PtP) N6 tunnel.\nNIDD is handled using an Unstructured PDU session to the NEF. The UE may obtain an Unstructured PDU session to the NEF during the PDU Session Establishment procedure. Whether or not the NIDD API shall be invoked for a PDU session is determined by the presence of a \"NEF Identity for NIDD\" for the DNN/S-NSSAI combination in the subscription. If the subscription includes a \"NEF Identity for NIDD\" corresponding with the DNN and S-NSSAI information, then the SMF selects that NEF and uses the NIDD API for that PDU session.\nThe NEF exposes the NIDD APIs described in TS 23.502 [3] on the N33/Nnef reference point.\nThe NEF uses the provisioned policies to map an AF Identifier and UE Identity to a DNN/S-NSSAI combination if the Reliable Data Service (RDS) is not enabled. If RDS is enabled, the NEF determines the association based on RDS port numbers and the provisioned policies that may be used to map AF Identifier and User identity to a DNN.\nThe NEF also supports distribution of Mobile Terminated messages to a group of UEs based on the NIDD API. If an External Group Identifier is included in the MT NIDD request, the NEF uses the UDM to resolve the External Group Identifier to a list of SUPIs and sends the message to each UE in the group with an established PDU Session.\nThe Protocol Configuration Options (PCO) may be used to transfer NIDD parameters to and from the UE (e.g. maximum packet size). The PCO is sent in the 5GSM signalling between UE and SMF. NIDD parameters are sent to and from the NEF via the N29 interface.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.6\tReliable Data Service",
                            "text_content": "The Reliable Data Service (RDS) may be used between the UE and NEF or UPF when using a PDU Session of PDU Type 'Unstructured'. The service provides a mechanism for the NEF or UPF to determine if the data was successfully delivered to the UE and for the UE to determine if the data was successfully delivered to the NEF or UPF. When a requested acknowledgement is not received, the Reliable Data Service retransmits the packet. The service is enabled or disabled based on DNN and NSSAI Configuration per SLA.\nWhen the service is enabled, a protocol is used between the end-points of the unstructured PDU Session. The protocol uses a packet header to identify if the packet requires no acknowledgement, requires an acknowledgement, or is an acknowledgment and to allow detection and elimination of duplicate PDUs at the receiving endpoint. RDS supports both single and multiple applications within the UE. Port Numbers in the header are used to identify the application on the originator and to identify the application on the receiver. The UE, NEF and the UPF may support reservation of the source and destination port numbers for their use and subsequent release of the reserved port numbers. Reliable Data Service protocol (as defined in TS 24.250 [80]) also enables applications to query their peer entities to determine which port numbers are reserved and which are available for use at any given time. The header is configured based on Reliable Data Service Configuration information which is obtained in the NIDD configuration, MT NIDD, and MO NIDD procedures with the AF as specified in TS 23.502 [3].\nDuring NIDD Configuration, the AF may indicate which serialization formats it supports for mobile originated and mobile terminated traffic in the Reliable Data Server Configuration. When port numbers are reserved by the UE, the serialization format that will be used by the application may be indicated to the NEF. When port numbers are reserved by the NEF, the serialization format that will be used by the application may be indicated to the UE. If the receiver does not support the indicated serialization format, it rejects the port number reservation request and the sender may re-attempt to reserve the port number with a different serialization format. If, during NIDD Configuration, the AF indicated that it supports multiple serialization formats, the NEF determines the serialization format that it will indicate to the UE based on local policies and previous negotiations with the UE (e.g. the NEF may indicate the same serialization format that was indicated by the UE or avoid indicating a serialization format that was previously rejected by the UE). When serialization formats are configured for reserved port numbers, the NEF stores the serialization formats as part of the Reliable Data Service Configuration and provides the updated Reliable Data Service Configuration to the AF.\nNOTE:\tWhether the UE Application or AF supports a given serialization format is outside the scope of 3GPP specifications.\nThe UE indicates its capability of supporting RDS in the Protocol Configuration Options (PCO) and the SMF negotiates RDS support with the NEF or UPF. If the NEF or UPF supports and accepts RDS then the SMF indicates to the UE, in the PCO, that the RDS shall be used if enabled in the DNN and NSSAI configuration.\nIn order to prevent situations where an RDS instance needs to interface to both the user and control plane, RDS may only be used with PDU Sessions for which the \"Control Plane CIoT 5GS Optimisation\" indication is set or with PDU sessions using the Control Plane CIoT 5GS Optimisation when the AMF does not move the PDU session to the user plane.\nReliable Data Service protocol is defined in TS 24.250 [80].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.7\tPower Saving Enhancements",
                            "text_content": "To enable UE power saving and to enhance MT reachability while using MICO mode, e.g. for CIoT, the following features are specified in the following clauses:\n-\tExtended Discontinuous Reception (DRX) for CM-IDLE and CM-CONNECTED with RRC_INACTIVE;\n-\tMICO mode with Extended Connected Time;\n-\tMICO mode with Active Time;\n-\tMICO mode and Periodic Registration Timer Control.\nIf a UE requests via NAS to enable both MICO mode with Active Time and extended idle mode DRX, e.g. based on local configuration, Expected UE Behaviour, if available, UE requested Active Time value, UE subscription information and network policies etc, the AMF may decide to enable MICO mode with or without Active Time, extended idle mode DRX or both.\nThe functions and procedures to enable a UE using power saving functions to receive MBS service are defined in TS 23.247 [129].\nThe UE and the network may negotiate over non-access stratum signalling the use of extended idle mode DRX for reducing its power consumption, while being available for mobile terminating data and/or network originated procedures within a certain delay dependent on the DRX cycle value. Extended DRX in CM-IDLE is supported for E-UTRA and NR connected to 5GC. Extended DRX in CM-CONNECTED with RRC_INACTIVE mode is supported for WB-E-UTRA, LTE-M and NR connected to 5GC. RRC_INACTIVE is not supported by NB-IoT connected to 5GC.\nThe negotiation of the eDRX parameters for NR, WB-E-UTRA and LTE-M is supported over any RAT.\nApplications that want to use extended idle mode DRX need to consider specific handling of mobile terminating services or data transfers, and in particular they need to consider the delay tolerance of mobile terminated data. A network side application may send mobile terminated data, an SMS, or a device trigger, and needs to be aware that extended idle mode DRX may be in place. A UE should request for extended idle mode DRX only when all expected mobile terminating communication is tolerant to delay.\nNOTE 1:\tThe extended idle mode DRX cycle length requested by UE takes into account requirements of applications running on the UE. Subscription based determination of eDRX cycle length can be used in those rare scenarios when applications on UE cannot be modified to request appropriate extended idle mode DRX cycle length. The network accepting extended DRX while providing an extended idle mode DRX cycle length value longer than the one requested by the UE, can adversely impact reachability requirements of applications running on the UE.\nUE and NW negotiate the use of extended idle mode DRX as follows:\nIf the UE decides to request for extended idle mode DRX, the UE includes an extended idle mode DRX parameters information element in the Registration Request message. The UE may also include the UE specific DRX parameters information element for regular idle mode DRX according to clause 5.4.5. The extended DRX parameters information element includes the extended idle mode DRX cycle length.\nThe AMF decides whether to accept or reject the UE request for enabling extended idle mode DRX. If the AMF accepts the extended idle mode DRX, the AMF based on operator policies and, if available, the extended idle mode DRX cycle length value in the subscription data from the UDM, may also provide different values of the extended idle mode DRX parameters than what was requested by the UE. The AMF taking into account the RAT specific Subscribed Paging Time Window, the UE's current RAT and local policy also assigns a Paging Time Window length to be used, and provides this value to the UE during Registration Update procedures together with the extended idle mode DRX cycle length in the extended DRX parameter information element. If the AMF accepts the use of extended idle mode DRX, the UE shall apply extended idle mode DRX based on the received extended idle mode DRX length, the UE's current RAT (NR, NB-IoT, WB-E-UTRA or LTE-M) and RAT specific Paging Time Window length. If the UE does not receive the extended DRX parameters information element in the relevant accept message because the AMF rejected its request or because the request was received by AMF not supporting extended idle mode DRX, the UE shall apply its regular discontinuous reception as defined in clause 5.4.5. For NR, Paging Time Window applies for extended DRX lengths greater than 10.24s as defined in TS 38.304 [50]. For WB-E-UTRA, Paging Time Window applies for extended DRX lengths of 10.24s and greater as defined in TS 36.304 [52].\nWhen the UE is accessing NR, if the AMF provides an extended idle mode DRX cycle length value of 10.24s, and the registration area of the UE contains only NR cells, the AMF does not include a Paging Time Window. If the AMF provides an extended idle mode DRX cycle length value of 10.24s, and the registration area of the UE contains E-UTRA cells and NR cells if the UE supports both E-UTRA and NR, the AMF includes a Paging Time Window.\nFor WB-E-UTRA and LTE-M the eNB broadcasts an indicator for support of extended idle mode DRX in 5GC in addition to the existing indicator for support of extended idle mode DRX in EPC as defined in TS 36.331 [51]. For NR the gNB broadcasts an indicator for support of extended idle mode DRX as defined in TS 38.331 [28]. This indicator is used by the UE in CM-IDLE state.\nNOTE 2:\tA broadcast indicator for support of extended idle mode DRX is not needed for NB-IoT as it is always supported in NB-IoT.\nThe specific negotiation procedure handling is described in TS 23.502 [3].\nNOTE 3:\tIf the Periodic Registration Update timer assigned to the UE is not longer than the extended idle mode DRX cycle the power savings are not maximised.\nFor RAT types that support extended DRX for CM-CONNECTED with RRC_INACTIVE state, the AMF passes the UE's accepted idle mode eDRX values to NG-RAN. If the UE supports eDRX in RRC_INACTIVE, based on its UE radio capabilities, NG-RAN configures the UE with an eDRX cycle in RRC_INACTIVE as specified in TS 38.300 [27] up to the value for the UE's idle mode eDRX cycle as provided by the AMF in \"RRC Inactive Assistance Information\" as defined in clause 5.3.3.2.5.\nIf an eDRX cycle is applied in RRC_INACTIVE, the RAN can buffer DL packets up to the duration of the eDRX cycle chosen by NG-RAN if the eDRX cycle does not last more than 10.24 seconds. If the CN based MT communication handling support indication is received in RRC Inactive Assistance Information, the NG-RAN may select an eDRX cycle that lasts more than 10.24s. In this case, based on implementation the NG-RAN may send an indication in N2 message that the UE is transitioning to RRC_INACTIVE state and the NG-RAN determined eDRX values (i.e. the eDRX cycle length and the Paging Time Window length) for RRC_INACTIVE to the AMF. The CN takes the indication in the N2 message into account, then handles mobile terminated (MT) communication as specified in clause 5.31.7.2.4 and it can apply high latency communication as specified in clause 5.31.8. The AMF replies to NG-RAN that the indication in the N2 message has been taken into account and the MT signalling or data may be buffered by the Core Network based on high latency communication. If and when the NG-RAN chooses to send the indication is up to NG-RAN implementation. If the NG-RAN delays sending the indication and it receives a DL NAS message for the UE, the NG-RAN proceeds as described in clause 4.8.1.1a of TS 23.502 [3].\nNOTE 4:\tIf the indication that the UE is transitioning to RRC_INACTIVE state is not sent (or sent after UE has entered RRC_INACTIVE state) by the NG-RAN then until CN receives it the CN cannot apply the high latency communication functionality, other NFs will not be aware of the UE reachability, certain high latency communication related services provided to the AF via NEF would not be available, NAS message delivery might fail and downlink data in RAN might be lost.\nNOTE 5:\tThe CN based MT communication handling support indication in RRC Inactive Assistance Information is provided when all entities (e.g. AMF, SMF and UPF) involved in the CN support corresponding functionalities (including the support providing buffered downlink data size) based on deployment and configuration.\nWhen the UE has PDU Session associated with emergency services, the UE and AMF follow regular discontinuous reception as defined in clause 5.4.5 and shall not use the extended idle mode DRX. Extended idle mode DRX parameters may be negotiated while the UE has PDU Session associated with emergency services. When the PDU Session associated with emergency services is released, the UE and AMF shall reuse the negotiated extended idle mode DRX parameters in the last Registration Update procedure.\nThe UE shall include the extended DRX parameters information element in each Registration Request message if it still wants to use extended idle mode DRX. At AMF to AMF, AMF to MME and MME to AMF mobility, the extended idle mode DRX parameters are not sent from the old CN node to the new CN node as part of the MM context information.\n5.31.7.2.2.0\tGeneral\nFor WB-E-UTRA and LTE-M connected to 5GC, the extended idle mode DRX value range will consist of values starting from 5.12s (i.e. 5.12s, 10.24s, 20.48s, etc.) up to a maximum of 2621.44s (almost 44 min). For NB-IoT, the extended idle mode DRX value range will start from 20.48s (i.e. 20.48s, 40.96s, 81.92, etc.) up to a maximum of 10485.76s (almost 3 hours) (see TS 36.304 [52]). For NR, the extended idle mode DRX value range will consist of values starting from 2.56s (i.e. 2.56s, 5.12s, 10.24s, 20.48s, etc.) up to a maximum of 10485.76s (almost 3 hours) (see TS 38.304 [50]). The extended idle mode DRX cycle length is negotiated via NAS signalling. The AMF includes the extended idle mode DRX cycle length for NR, WB-E-UTRA, LTE-M or NB-IoT in paging message to assist the NG-RAN node in paging the UE. For NR, Paging Time Window applies for extended DRX lengths longer than 10.24s as defined in TS 38.304 [50]. For WB-E-UTRA, LTE-M and NB-IoT, Paging Time Window applies for extended DRX lengths of 10.24s and longer as defined in TS 36.304 [52].\nThe network follows the regular paging strategy as defined in clause 5.4.5 when the extended idle mode DRX cycle length is 5.12s or less for WB-E-UTRA, LTE-M and NB-IoT, or 10.24s or less for NR.\nClauses 5.31.7.2.2.1, 5.31.7.2.2.2 and 5.31.7.2.2.3 apply when the extended idle mode DRX cycle length is 10.24s or longer for WB-E-UTRA, LTE-M and NB-IoT, or longer than 10.24s for NR.\n5.31.7.2.2.1\tHyper SFN, Paging Hyperframe and Paging Time Window length\nA Hyper-SFN (H-SFN) frame structure is defined on top of the SFN used for regular idle mode DRX. Each H-SFN value corresponds to a cycle of the legacy SFN of 1024 radio frames, i.e. 10.24s. When extended idle mode DRX is enabled for a UE, the UE is reachable for paging in specific Paging Hyperframes (PH), which is a specific set of H-SFN values. The PH computation is a formula that is function of the extended idle mode DRX cycle, and a UE specific identifier, as described in TS 36.304 [52] and TS 38.304 [50]. This value can be computed at all UEs and AMFs without need for signalling. The AMF includes the extended idle mode DRX cycle length and the PTW length in paging message to assist the NG-RAN nodes in paging the UE.\nThe AMF also assigns a Paging Time Window length, and provides this value to the UE during Registration Update procedures together with the extended idle mode DRX cycle length. The UE first paging occasion is within the Paging Hyperframe as described in TS 36.304 [52] and TS 38.304 [50]. The UE is assumed reachable for paging within the Paging Time Window. The start and end of the Paging Time Window is described in TS 36.304 [52] and TS 38.304 [50]. After the Paging Time Window length, the AMF considers the UE unreachable for paging until the next Paging Hyperfame.\n5.31.7.2.2.2\tLoose Hyper SFN synchronization\nNOTE:\tThis clause applies when the extended DRX cycle length is 10.24s or longer for WB-E-UTRA, LTE-M and NB-IoT, and longer than 10.24s for NR.\nIn order for the UE to be paged at roughly similar time, the H-SFN of all NG-RAN nodes and AMFs should be loosely synchronized.\nEach NG-RAN node and AMF synchronizes internally the H-SFN counter so that the start of H-SFN=0 coincides with the same a preconfigured time epoch. If NG-RAN nodes and AMFs use different epochs, e.g. due to the use of different time references, the GPS time should be set as the baseline, and the NG-RAN nodes and AMFs synchronize the H-SFN counter based on the GPS epoch considering the time offset between GPS epoch and other time-reference epoch a preconfigured time. It is assumed that NG-RAN nodes and AMFs are able to use the same H-SFN value with accuracy in the order of legacy DRX cycle lengths, e.g. 1 to 2 seconds. There is no need for synchronization at SFN level.\nThere is no signalling between network nodes required to achieve this level of loose H-SFN synchronization.\n5.31.7.2.2.3\tAMF paging and paging retransmission strategy\nNOTE:\tThis clause applies when the extended DRX cycle length is 10.24s or longer for WB-E-UTRA, LTE-M and NB-IoT, and longer than 10.24s for NR.\nWhen the AMF receives trigger for paging and the UE is reachable for paging, the AMF sends the paging request. If the UE is not reachable for paging, then the AMF pages the UE just before the next paging occasion.\nThe AMF determines the Paging Time Window length and a paging retransmission strategy, and executes the retransmission scheme.\nFor extended DRX length of 10.24s, in the paging request message the AMF sends the Paging Time Window to the ng-eNB but does not send the Paging Time Window to the gNB.\nWhen the UE is registered in a registration area with heterogeneous support of extended idle mode DRX (e.g. comprising WB-E-UTRA and NR cells) and has negotiated eDRX, the AMF shall, for any paging procedure, perform at least one paging attempt during a PTW.\nNOTE:\tHeterogeneous support of extended idle mode DRX in tracking areas assigned by AMF in a TAI list can result in significant battery life reduction in the UE as compared to homogeneous support by NG-RAN nodes of extended idle mode DRX.\nFor NR, the NG-RAN may request the CN to handle mobile terminated (MT) communication for the UE configured with eDRX for RRC_INACTIVE state by means of the Connection Inactive procedure with CN based MT communication handling Procedure (see clause 4.8.1.1a of TS 23.502 [3]). This allows the CN to apply high latency communication functions as specified in clause 5.31.8. The NG-RAN provides the determined eDRX values (i.e. the eDRX cycle length and the Paging Time Window length) for RRC_INACTIVE to AMF (i.e. >10.24s). Based on the request from NG-RAN, the AMF responds to NG-RAN and informs other NFs (e.g. SMF and UPF) involved in downlink data or signalling handling and trigger the data buffering as specified in clause 4.8.1.1a of TS 23.502 [3].\nWhen MT data or signalling arrives for a UE in RRC_INACTIVE state, the other NFs communicate with the AMF for delivery of MT data or signalling. The AMF calculates the UE reachability based on the eDRX values for RRC_INACTIVE state provided by NG-RAN and triggers NG-RAN paging via an N2 RAN Paging Request message if the UE is considered reachable as specified in clause 4.8.2.2b of TS 23.502 [3]. Otherwise, the AMF stores the information received in the NF request and replies to the requesting NF to apply high latency communication functions as specified in clause 5.31.8 based on eDRX values for RRC_INACTIVE (e.g. an Estimated Maximum Wait Time is calculated based on eDRX values for RRC_INACTIVE). When the AMF determines that the UE has become reachable for paging, the AMF uses the stored information to send an N2 RAN Paging Request message. If UPF/SMF provides the downlink data size information, the AMF provides the information to NG-RAN as described in clause 4.8.2.2b of TS 23.502 [3].\nWhen the UE resumes the RRC connection as specified in TS 38.300 [27] (e.g. including mobile originated small data transmission procedure), if the NG-RAN had sent the indication for the CN to handle mobile terminated (MT) communication, NG-RAN proceeds as specified in clause 4.8.2.2 of TS 23.502 [3], which indicates to the AMF that the UE is now reachable for downlink data and/or signalling. The AMF then informs other NFs that the UE is now reachable using the high latency communication functions as specified in clause 5.31.8 and MT data and signalling can be delivered to the UE.\nWhen a UE, using MICO mode, initiates MO signalling or MO data and the AMF is aware of pending or expected MT traffic, the AMF may keep the UE in CM-CONNECTED state and the RAN may keep the UE in RRC_CONNECTED state for an Extended Connected Time period in order to ensure the downlink data and/or signalling is delivered to the UE. The Extended Connected Time is determined by the AMF and is based on local configuration and/or the Maximum Response Time, if provided by the UDM.\nThe AMF maintains the N2 connection for at least the Extended Connected Time and provides the Extended Connected Time value to the RAN. The Extended Connected Time value indicates the minimum time the RAN should keep the UE in RRC_CONNECTED state regardless of inactivity. The Extended Connected Time value is provided to the RAN together with the\n-\tNAS Registration Accept message; or\n-\tNAS Service Accept message.\nAt inter-RAN node handovers, if some signalling or data are still pending, the target AMF may send the Extended Connected Time value to the target RAN node.\nDuring a Registration procedure the UE may optionally request an Active Time value from the AMF as part of MICO Mode negotiation. In response, if the AMF receives an Active Time value from the UE and determines that the MICO mode is allowed for the UE, the AMF may assign an Active Time value for the UE, e.g. based on local configuration, Expected UE Behaviour if available, UE requested Active Time value, UE subscription information and network policies, and indicates it to the UE during Registration procedure. When an Active Time value is assigned to the UE the AMF shall consider the UE reachable for paging after the transition from CM-CONNECTED to CM-IDLE for the duration of the Active Time. Together with the Active Time value, the UE may request a periodic registration time value as specified in clause 5.31.7.45.\nWhen the AMF indicates MICO mode with an Active Time to a UE, the registration area may be constrained by paging area size. To avoid paging in the entire PLMN, when the AMF allocates the Active Time the AMF should not allocate \"all PLMN\" registration area to the UE.\nThe UE and AMF shall set a timer corresponding to the Active Time value negotiated during the most recent Registration procedure. The UE and AMF shall start the timer upon entering CM-IDLE state from CM-CONNECTED. When the timer expires (i.e. reaches the Active Time) the UE enters MICO mode and the AMF can deduce that the UE has entered MICO mode and is not available for paging. If the UE enters CM-CONNECTED state before the timer expires, the UE and AMF shall stop and reset the timer.\nIf no Active Time value was negotiated during the most recent Registration procedure the UE shall not start the timer and it shall instead enter MICO mode directly upon entering CM-IDLE state.\nActive Time is not transferred between AMF and MME.\nIf the Expected UE Behaviour indicates the absence of DL communication, the AMF may allow MICO mode for the UE and allocate a large periodic registration timer value based on e.g. Network Configuration parameters to the UE so that the UE can maximise power saving between Periodic Registration Updates.\nIf the Expected UE Behaviour indicates scheduled DL communication the AMF should allow MICO mode for the UE and allocate a periodic registration timer value such that the UE performs Periodic Registration Update to renegotiate MICO mode before or at the scheduled DL communication time, if the AMF decides to allow MICO mode for the UE. When UE requests the MICO mode with active time, the UE may also request a periodic registration timer value suitable for the latency/responsiveness of the DL communication service known to UE. If the UE wants to change the periodic registration timer value, e.g. when the conditions are changed in the UE, the UE consequently requests the value it wants in the registration procedure. The AMF takes the UE requested periodic registration time value into consideration when providing the periodic registration timer to UE during Registration procedure as specified in clause 4.2.2.2.2 of TS 23.502 [3].\nIf the UE supports 'Strictly Periodic Registration Timer Indication', the UE indicates its capability of supporting 'Strictly Periodic Registration Timer Indication' in the Registration Request message. If the UE indicates its support of 'Strictly Periodic Registration Timer Indication' in the Registration Request message, the AMF may provide a Strictly Periodic Registration Timer Indication to the UE together with the periodic registration timer value, e.g. based on Expected UE Behaviour. If the indication is provided by the AMF, the UE and the AMF shall start the periodic registration timer after completion of the Registration procedure. The UE and the AMF shall neither stop nor restart the periodic registration timer when the UE enters CM-CONNECTED, and shall keep it running while in CM-CONNECTED state and after returning to CM-IDLE state. If and only when the timer expires and the UE is in CM-IDLE, the UE shall perform a Periodic Registration Update. If the timer expires and the UE is in CM-CONNECTED state, the AMF and the UE restart the periodic registration timer while still applying 'Strictly Periodic Registration Timer Indication'. The AMF may use the UE Configuration Update procedure to trigger the UE to perform Registration procedure, in which the periodic registration timer value and 'Strictly Periodic Registration Timer Indication' can be renegotiated.\nWhen the UE and the AMF locally disable MICO mode (e.g. when an emergency service is initiated), the UE and the AMF shall not apply 'Strictly Periodic Registration Timer Indication'.\nIf the periodic registration timer is renegotiated during a Registration procedure, e.g. triggered by UE Configuration Update, and if the periodic registration timer is running, then the periodic registration timer is stopped and restarted using the renegotiated value even when the Strictly Periodic Registration Timer Indication was provided to the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.8\tHigh latency communication",
                            "text_content": "Functions for High latency communication may be used to handle mobile terminated (MT) communication with UEs being unreachable while using power saving functions as specified in clause 5.31.7 or due to discontinuous coverage as described in clause 5.4.13. \"High latency\" refers to the initial response time before normal exchange of packets is established. That is, the time it takes before a UE has woken up from its power saving state and responded to an initial downlink packet or signal.\nWhen a NR RedCap UE requests to use the power saving functions as specified in clause 5.31.7, then the AMF may, based on local policy, reroute the Registration Request to another AMF that supports High latency communication as specified in clause 6.3.5.\nHigh latency communication is supported by extended buffering of downlink data in the UPF, SMF or NEF when a UE is using power saving functions in CM-IDLE state or in RRC_INACTIVE state, or when the UE is using a satellite access with discontinuous coverage and the UE is not reachable. For UPF anchored PDU sessions the SMF configures during AN release or when NG-RAN indicates via the AMF the UE is in extended DRX for RRC_INACTIVE, the UPF with user data Forwarding Action Rule and user data Buffering Action Rule according to TS 29.244 [65]. The rules include instructions whether UPF buffering applies or the user data shall be forwarded to the SMF for buffering in the SMF. For NEF anchored PDU sessions only extended buffering in the NEF is supported in this release of the specification. During the Network Triggered Service Request procedure or Mobile Terminated Data Transport procedures when using Control Plane CIoT 5GS Optimisation, the AMF provides an Estimated Maximum Wait Time to the SMF if the SMF indicates the support of extended buffering. The SMF determines the Extended Buffering Time based on the received Estimated Maximum Wait Time or local configuration. The handling is e.g. specified in the Network Triggered Service Request procedure, clauses 4.2.3.3, 4.2.6, 4.24.2 and 4.25.5 of TS 23.502 [3].\nHigh latency communication is also supported through notification procedures. The following procedures are available based on different monitoring events:\n-\tUE Reachability;\n-\tAvailability after DDN failure;\n-\tDownlink Data Delivery Status.\nAn AF may request a one-time \"UE Reachability\" notification when it wants to send data to a UE which is using a power saving function (see event subscription procedure in clause 4.15.3.2 of TS 23.502 [3]). The SCS/AS/AF then waits with sending the data until it gets a notification that the UE is reachable (see notification procedures in TS 23.502 [3]).\nAn AF may request repeated \"Availability after DDN failure\" notifications where each UE reachability notification is triggered by a preceding DDN failure, i.e. the AF sends a downlink packet to request a UE reachability notification when the UE becomes reachable. That downlink packet is discarded by the UPF or SMF or NEF (see notification procedures in TS 23.502 [3]).\nAn AF may request repeated \"Downlink Data Delivery Status\" notifications when it wants indications that DL data has been buffered or when buffered DL data has been delivered to the UE.\nIf MICO mode or extended idle mode DRX is enabled, Idle Status Indication allows the AF to determine when the UE transitions into idle mode. When requesting to be informed of either \"UE Reachability\" or \"Availability after DDN failure\" notification, the AF may also request Idle Status Indication. If the UDM and the AMF support Idle Status Indication, then when the UE for which MICO mode or extended idle mode DRX is enabled transitions into idle mode, the AMF includes in the notification towards the NEF the time at which the UE transitioned into idle mode, the active time and the periodic registration update timer granted to the UE by the AMF, the eDRX cycle length and the Suggested number of downlink packets if a value was provided to the SMF.\nAn AF may provide parameters related to High latency communication for different methods to UDM, via NEF, as part of provisioning capability as specified in clause 5.20. The UDM can further deliver the parameters to other NFs (e.g. AMF or SMF) as specified in clause 4.15.6 of TS 23.502 [3].\nIf the AMF is aware that some signalling or data is pending in the network for an UE that is known as being unreachable for a long duration, e.g. for UE's having extended idle mode DRX, extended DRX for RRC_INACTIVE or MICO enabled, the AMF maintains the N2 connection for at least the Extended Connected Time and provides the Extended Connected Time value in a NG-AP message to the RAN. The Extended Connected Time value indicates the minimum time the RAN should keep the UE in RRC_CONNECTED state regardless of inactivity. At inter-RAN node handovers, if some signalling or data are still pending, the target AMF may send the Extended Connected Time value to the target RAN node.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.9\tSupport for Monitoring Events",
                            "text_content": "The Monitoring Events feature is intended for monitoring of specific events in the 3GPP system and reporting such Monitoring Events via the NEF. The feature allows NFs in 5GS to be configured to detect specific events and report the events to the requested party. Clause 5.20 further discusses the Monitoring capabilities of the NEF.\nFor CIoT, the list of supported monitoring events is specified in Table 4.15.3.1-1 of TS 23.502 [3].\nSupport for Monitoring Events can be offered via AMF, UDM, NSACF and SMF, and can be reported via the NEF, as specified in clause 4.15.3 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.10\tNB-IoT UE Radio Capability Handling",
                            "text_content": "NB-IoT Radio Capabilities are handled in the network independently from other RATs' Radio Capabilities, see clause 5.4.4.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.11\tInter-RAT idle mode mobility to and from NB-IoT",
                            "text_content": "Tracking Areas are configured so that they do not contain both NB-IoT and other RATs' cells, so when the UE is changing RAT type to or from NB-IoT while remaining registered with 5GC, the UE will perform the Mobility Registration Update procedure, see clause 5.3.2.3. When the UE is changing RAT type to or from NB-IoT and moving between 5GC and EPC, during the Registration, Attach or TAU procedure the RAT type change is determined.\nThe specification in this clause does not apply to RAT type corresponding to Non-3GPP Access type.\nPDU session handling is controlled by \"PDU Session continuity at inter RAT mobility\" in the UE's subscription data, which indicates per DNN/S-NSSAI whether to;\n-\tmaintain the PDU session,\n-\tdisconnect the PDU session with a reactivation request,\n-\tdisconnect the PDU session without reactivation request, or\n-\tleave it up to local VPLMN policy\nwhen the UE moves between a \"broadband\" RAT (e.g. NR or WB-E-UTRA) and a \"narrowband\" RAT (NB-IoT).\nDuring PDU session establishment the SMF retrieves the \"PDU Session continuity at inter RAT mobility\" subscription information (if available) from the UDM. Local SMF configuration is used if \"PDU Session continuity at inter RAT mobility\" is not available for a PDU Session.\nThe AMF informs the SMF at an inter-RAT idle mobility event, e.g. to or from NB-IoT connected to 5GC about the RAT type change in the Nsmf_PDUSession_UpdateSMContext message during the Registration procedure. Based on this (H-)SMF handles the PDU session according to \"PDU session continuity at inter RAT mobility information\" subscription data or based on local policy.\nNOTE:\tThe \"PDU Session continuity at inter RAT mobility\" and \"PDN continuity at inter-RAT mobility\" subscription should be the same so that the PDU sessions/PDN connections are handled the same by both CN types.\nDuring inter-RAT idle mode mobility to NB-IoT, if a PDU session has more than one QoS rule, the SMF shall initiate a PDU session modification procedure as described in TS 23.502 [3] to remove any non-default QoS rule, and maintain only the default QoS rule.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.12\tRestriction of use of Enhanced Coverage",
                            "text_content": "Support of UEs in E-UTRA Enhanced Coverage is specified in TS 36.300 [30].\nThe usage of Enhanced Coverage requires use of extensive resources (e.g. radio and signalling resources). Specific subscribers can be restricted to use the Enhanced Coverage feature through Enhanced Coverage Restricted information that is stored in the UDM as part of subscription data and specifies per PLMN whether the Enhanced Coverage functionality is restricted or not for the UE. For eMTC, the Enhanced Coverage Restricted information indicates whether CE mode B is restricted for the UE, or both CE mode A and CE mode B are restricted for the UE, or both CE mode A and CE mode B are not restricted for the UE. For NB-IoT, the NB-IoT Enhanced Coverage Restricted information indicates whether the Enhanced Coverage is restricted or not for the UE.\nThe AMF receives Enhanced Coverage Restricted information from the UDM during the Registration procedure. If the UE includes the support for restriction of use of Enhanced Coverage in the Registration Request message, the AMF based on local configuration, UE Usage setting, UE subscription information and network policies, or any combination of them, determines whether Enhanced Coverage is restricted for the UE and stores updated Enhanced Coverage Restriction information in the UE context in the AMF. If the UE usage setting indicated that UE is \"voice centric\", then the AMF shall set CE mode B restricted for the UE in Enhanced Coverage Restriction information.\nThe AMF sends Enhanced Coverage Restricted information to the UE in the Registration Accept message. The UE shall use the value of Enhanced Coverage Restricted information to determine if enhanced coverage feature is restricted or not. The AMF provides an Enhanced Coverage Restricted information to the RAN via N2 signalling whenever the UE context is established in the RAN, e.g. during N2 Paging procedure, Service Request procedure, Initial Registration and Periodic Registration procedure.\nFor roaming UEs, if the UDM doesn't provide any Enhanced Coverage Restricted information or the provided Enhanced Coverage Restricted information is in conflict with the roaming agreement, the AMF uses default Enhanced Coverage Restricted information locally configured in the VPLMN based on the roaming agreement with the subscriber's HPLMN.\nThe UE indicates its capability of support for restriction of use of Enhanced Coverage to the AMF in the Registration procedure for the RAT it is camping on. A UE that supports Enhanced Coverage shall also support restriction of the Enhanced Coverage.\nThe UE shall assume that restriction for use of Enhanced Coverage indicated by Enhanced Coverage Restricted information is the same in the equivalent PLMNs. NB-IoT cells also broadcast the support of restriction of use of Enhanced Coverage as defined in TS 36.331 [51].\nIf the UE supports CE mode B and use of CE mode B is not restricted according to the Enhanced Coverage Restriction information in the UE context in the AMF, then the AMF shall use the extended NAS-MM timer setting for the UE as specified in TS 24.501 [47] and shall send the extended NAS-SM timer indication during PDU session establishment to the SMF.\nIf the UE supports CE mode B and use of CE mode B changes from restricted to unrestricted or vice versa in the Enhanced Coverage Restriction information in the UE context in the AMF (e.g. due to a subscription change) then:\n-\tThe AMF determines when to enforce the change of restriction of use of Enhanced Coverage.\n-\tWhen the UE is in CM-CONNECTED mode, the AMF can use the UE Configuration Update procedure, as specified in step 3a of clause 4.2.4.2 of TS 23.502 [3], to trigger a mobility registration update procedure in CM-CONNECTED mode for the AMF to inform the change of restriction of Enhanced Coverage towards the UE.\n-\tIf the UE has already established PDU sessions, then the AMF shall trigger a PDU session modification to the SMFs serving the UE's PDU sessions to update the use of the extended NAS-SM timer setting as described in step 1f of clause 4.3.3.2 of TS 23.502 [3] when the AMF determines that NAS-SM timer shall be updated due to the change of Enhanced Coverage Restriction.\n-\tThe UE and network applies the new Enhanced Coverage Restriction information after mobility registration procedure is completed.\nBased on the extended NAS-SM timer indication, the SMF shall use the extended NAS-SM timer setting for the UE as specified in TS 24.501 [47].\nThe support for Enhanced Coverage Restriction Control via NEF enables AF to query status of Enhanced Coverage Restriction or enable/disable Enhanced Coverage Restriction per individual UEs. The procedure for Enhanced Coverage Restriction Control via NEF is described in clause 4.27 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.13\tPaging for Enhanced Coverage",
                            "text_content": "Support of UEs in E-UTRA Enhanced Coverage is specified in TS 36.300 [30].\nWhenever N2 is released and Paging Assistance Data for CE capable UE is available for the UE, the NG-RAN sends it to the AMF as described in clause 4.2.6 of TS 23.502 [3].\nThe AMF stores the received Paging Assistance Data for CE capable UE and then the AMF includes it in every subsequent Paging message for all NG-RAN nodes selected by the AMF for paging.\nIf Enhanced Coverage is restricted for the UE as described in clause 5.31.12, the AMF sends the Enhanced Coverage Restriction parameter as defined in TS 38.413 [34].\nNOTE:\tOnly the NG-RAN node which cell ID is included in the Paging Assistance Data considers the assistance data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.14\tSupport of rate control of user data",
                            "text_content": "The rate of user data sent to and from a UE (e.g. a UE using CIoT 5GS Optimisations) can be controlled in two different ways:\n-\tServing PLMN Rate Control;\n-\tSmall Data Rate Control.\nServing PLMN Rate Control is intended to allow the Serving PLMN to protect its AMF and the Signalling Radio Bearers in the NG-RAN from the load generated by NAS Data PDUs.\nSmall Data Rate Control is intended to allow HPLMN operators to offer customer services such as \"maximum of Y messages per day\".\nNOTE:\tExisting Session-AMBR mechanisms are not suitable for such a service since, for radio efficiency and UE battery life reasons, an AMBR of e.g. > 100kbit/s is desirable and such an AMBR translates to a potentially large daily data volume.\nThe SMF in the Serving PLMN may send the Small Data rate control parameter for an emergency PDU session.\nThe Serving PLMN Rate Control value is configured in the (V-)SMF.\nNOTE 1:\tHomogeneous support of Serving PLMN Rate Control in a network is assumed.\nAt PDU Session establishment and PDU Session modification, the (V-)SMF may inform the UE and UPF/NEF of any per PDU Session local Serving PLMN Rate Control that the Serving PLMN intends to enforce for NAS Data PDUs. The (V-)SMF shall only indicate a Serving PLMN Rate Control command to the UPF if the PDU Session is using N4 and is set to Control Plane only. The (V-)SMF shall only indicate a Serving PLMN Rate Control command to the NEF if that PDN connection is using NEF.\nServing PLMN rate control is operator configurable and expressed as \"X NAS Data PDUs per deci hour\" where X is an integer that shall not be less than 10. There are separate limits for uplink and downlink NAS Data PDUs:\n-\tThe UE shall limit the rate at which it generates uplink NAS Data PDUs to comply with the Serving PLMN policy. In the UE the indicated rate control applies only on the PDU Session where it was received, and therefore the UE shall limit the rate of its uplink NAS Data PDUs to comply with the rate that is indicated for the PDU Session. The indicated rate is valid until the PDU Session is released.\n-\tThe UPF/NEF shall limit the rate at which it generates downlink Data PDUs. In the UPF/NEF the indicated rate control applies only on the PDU Session where it was received, and therefore the UPF/NEF shall limit the rate of its downlink Data PDUs to comply with the rate that is indicated for the PDU Session.\n-\tThe (V-)SMF may enforce these limits per PDU Session by discarding or delaying packets that exceed these limits. The Serving PLMN Rate does not include SMS using NAS Transport PDUs. The (V-)SMF starts the Serving PLMN Rate Control when the first NAS Data PDU is received.\nNOTE 2:\tIf the UE/UPF/NEF start the Serving PLMN rate control at a different time than the (V-)SMF, PDUs sent within the limit enforced at the UE/UPF/NEF can still exceed the limit enforced by the (V-)SMF.\nNOTE 3\tIt is assumed that the Serving PLMN Rate is sufficiently high to not interfere with the Small Data Rate Control as the Small Data Rate Control, if used, is assumed to allow fewer messages. NAS PDUs related to exception reports are not subject to the Serving PLMN Rate Control.\nThe (H-)SMF may consider, e.g. based on operator policy, subscription, DNN, S-NSSAI, RAT type etc. to determine whether to apply Small Data Rate Control or not. The (H-)SMF can send a Small Data Uplink Rate Control command to the UE using the PCO information element. The (H-)SMF informs the UPF or NEF of any Small Data Rate Control that shall be enforced.\nThe Small Data Rate Control applies to data PDUs sent on that PDU Session by either Data Radio Bearers or Signalling Radio Bearers (NAS Data PDUs).\nThe rate control information is separate for uplink and downlink and in the form of:\n-\tan integer 'number of packets per time unit', and\n-\tan integer 'number of additional allowed exception report packets per time unit' once the rate control limit has been reached.\nThe UE shall comply with this uplink rate control instruction. If the UE exceeds the uplink 'number of packets per time unit', the UE may still send uplink exception reports if allowed and the 'number of additional allowed exception reports per time unit' has not been exceeded. The UE shall consider this rate control instruction as valid until it receives a new one from (H-)SMF.\nWhen a PDU Session is first established, the (H-)SMF may provide the configured Small Data Rate Control parameters to the UE and UPF or NEF.\nWhen the PDU Session is released, the Small Data Rate Control Status (including the number of packets still allowed in the given time unit, the number of additional exception reports still allowed in the given time unit and the termination time of the current Small Data Rate Control validity period) may be stored in the AMF so that it can be retrieved for a subsequent re-establishment of a new PDU Session.\nAt subsequent establishment of a new PDU Session, the (H-)SMF may receive the previously stored Small Data Rate Control Status and if the validity period has not expired, it provides the parameters to the UE in the PCO and to the UPF/NEF as the initially applied parameters, in addition to the configured Small Data Rate Control parameters. If the initially applied parameters are provided, the UE and UPF or NEF shall apply them and shall use the SMF provided configured Small Data Rate Control parameters once the initially applied Small Data Rate Control validity period expires.\nNOTE 1:\tStorage of Small Data Rate Control Status information for very long time intervals can be implementation specific.\nFor the UPF and NEF, Small Data Rate Control is based on a 'maximum allowed rate' per direction. If (H-)SMF provided the 'number of additional allowed exception report packets per time unit', then the 'maximum allowed rate' is equal to the 'number of packets per time unit' plus the 'number of additional allowed exception report packets per time unit', otherwise the 'maximum allowed rate' is equal to the 'number of packets per time unit'.\nThe UPF or NEF may enforce the uplink rate by discarding or delaying packets that exceed the 'maximum allowed rate'. The UPF or NEF shall enforce the downlink rate by discarding or delaying packets that exceed the downlink part of the 'maximum allowed rate'.\nNOTE 2:\tIt is assumed that the Serving PLMN Rate is sufficiently high to not interfere with the Small Data Rate Control as the Small Data Rate Control, if used, is assumed to allow fewer messages. NAS PDUs related to exception reports are not subject to the Serving PLMN Rate Control.\nFor NB-IoT the AMF maintains an \"MO Exception Data Counter\" which is incremented when the RRC establishment cause \"MO exception data\" is received from NG-RAN. The AMF reports whether the UE accessed using \"MO exception data\" RRC establishment cause, to all (H-)SMFs which have PDU Sessions that are subject to Small Data Rate Control and if the UE is accessing using \"MO exception data\" then the \"MO Exception Data Counter\" is also provided by the AMF. The SMF indicates each use of the RRC establishment cause \"MO Exception Data\" by including the related counter on the charging information.\nNOTE 3:\tSince Exception Data PDUs and normal priority PDUs cannot be distinguished within an RRC connection, the AMF is only counting the number of RRC Connection establishments with \"MO Exception data\" priority.\nIf the UE moves to EPC then the UE and the PGW-U+UPF store the current Small Data Rate Control Status for all PDU Sessions that are not released. If the UE moves back to 5GC the stored Small Data Rate Control Status is restored and continues to apply to PDU Session(s) that are moved from EPC to 5GC, taking into account remaining validity period of the stored Small Data Rate Control Status. When the UE moves to EPC the Small Data Rate Control Status for all PDU Session(s) may also be stored in the AMF if the PDU Session is released while the UE is connected to EPC and re-established when the UE moves to 5GC. The time to store the Small Data Rate Control Status information is implementation specific.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.15\tControl Plane Data Transfer Congestion Control",
                            "text_content": "NAS level congestion control may be applied in general for all NAS messages. To enable congestion control for control plane data transfer, a Control Plane data back-off timer is used, see clause 5.19.7.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.16\tService Gap Control",
                            "text_content": "Service Gap Control is an optional feature intended for CIoT UEs to control the frequency at which these UEs can access the network. That is, to ensure a minimum time gap between consecutive Mobile Originated data communications initiated by the UE. This helps reducing peak load situations when there are a large number of these UEs in an operator network. Service Gap Control is intended to be used for \"small data allowance plans\" for MTC/CIoT UEs where the applications are tolerant to service latency.\nNOTE 1:\tTime critical applications, such as regulatory prioritized services like Emergency services can suffer from the latency caused by the Service Gap Control feature. Therefore Service Gap Control feature is not recommended for subscriptions with such applications and services.\nService Gap Time is a subscription parameter used to set the Service Gap timer and is enforced in the UE and in the AMF on a per UE level (i.e. the same Service Gap Timer applies for all PDU Sessions that the UE has). The UE indicates its capability of support for Service Gap Control in the Registration Request message to the AMF. The AMF passes the Service Gap Time to the UE in the Registration Accept message for a UE that has indicated its support of the Service Gap Control. The Service Gap Control shall be applied in a UE when a Service Gap Time is stored in the UE context and applied in the AMF when the Service Gap Time is stored in the UE Context in the AMF.\nService Gap Control requires the UE to stay in CM-IDLE mode for at least the whole duration of the Service Gap timer before triggering Mobile Originated user data transmission, except for procedures that are exempted (see TS 24.501 [47]). The Service Gap timer shall be started each time a UE moves from CM-CONNECTED to CM-IDLE, unless the connection request was initiated by the paging of a Mobile Terminated event, or after a Mobility or Periodic Registration procedure without Follow-on Request indication and without Uplink data status, which shall not trigger a new or extended Service Gap interval. When a Service Gap timer expires, the UE is allowed to send a connection request again. If the UE does so, the Service Gap timer will be restarted at the next CM-CONNECTED to CM-IDLE transition.\nThe Service Gap control is applied in CM-IDLE state only and does not impact UE Mobile Originated user data transmission or Mobile Originated signalling in CM-CONNECTED state. The Service Gap timer is not stopped upon CM-IDLE state to CM-CONNECTED state transition. The UE shall not initiate connection requests for MO user plane data, MO control plane data, or MO SMS when a Service Gap timer is running. The UE shall not initiate PDU Session Establishment Requests when a Service Gap timer is running, unless it is for Emergency services which are allowed. CM-CONNECTED with RRC_INACTIVE is not used for UEs that have a Service Gap Time configured.\nNOTE 2:\tAs a consequence of allowing Initial Registration Request procedure, the UE with a running Service Gap timer does not initiate further MO signalling, except for Mobility Registration procedure, until the UE receives MT signalling or after the UE has moved to CM-IDLE state and the Service Gap Timer is not running.\nNOTE 3:\tImplementations need to make sure that latest and up-to-date data are always sent when a Service Gap timer expires.\nThe AMF may enforce the Service Gap timer by rejecting connection requests for MO user plane data, MO control plane data, or MO SMS when a Service Gap timer is running. The AMF may enforce the Service Gap timer by not allowing MO signalling after Initial Registration requests when a Service Gap timer is running except for Mobility Registration procedure, Periodic Registration procedure or access to the network for regulatory prioritized services like Emergency services, which are allowed. When rejecting the connection requests and the SM signalling after Initial Registration Requests while the Service Gap timer is running, the AMF may include a Mobility Management back-off timer corresponding to the time left of the current Service Gap timer. For UEs that do not support Service Gap Control (e.g. pre-release-16 UEs), Service Gap Control may be enforced using \"General NAS level congestion control\" as defined in clause 5.19.7.2.\nNOTE 4:\tAfter MT signalling in CM-CONNECTED state the AMF does not further restrict MO signalling when a Service Gap timer is running as this case is considered equal to a connectivity request in response to paging.\nWhen the AMF starts the Service Gap timer, the AMF should invoke the Service Gap timer with a value that is slightly shorter than the Service Gap Time value provided to the UE based on the subscription information received from the UDM.\nNOTE 5:\tThis ensures that the AMF does not reject any UE requests just before the Service Gap timer expires e.g. because of slightly unsynchronized timers between UE and AMF.\nA UE which transitions from a MICO mode or eDRX power saving state shall apply Service Gap Control when it wakes up if the Service Gap timer is still running.\nAdditional aspects of Service Gap Control:\n-\tService Gap Control applies in all PLMNs.\n-\tWhen the Service Gap timer is running and the UE receives paging, the UE shall respond as normal.\n-\tService Gap Control does not apply to exception reporting for NB-IoT.\n-\tAccess to the network for regulatory prioritized services like Emergency services are allowed when a Service Gap timer is running.\n-\tService Gap Control shall be effective also for UEs performing de-registration and re-registration unless access to the network for regulatory prioritized services like Emergency services is required.\n-\tIf the Service Gap timer is running, the Service Gap is applied at PLMN selection as follows:\na)\tRe-registration to the registered PLMN: The remaining Service Gap timer value survives.\nb)\tRegistration to a different PLMN: The remaining Service Gap timer value survives.\nc)\tUSIM swap: The Service Gap timer is no longer running and the Service Gap feature does not apply, unless re-instantiated by the serving PLMN.\n-\tMultiple uplink packets and downlink packets are allowed during one RRC connection for UE operating within its Rate Control limits.\nThe following procedures are impacted by Service Gap Control:\n-\tRegistration Procedure, see clause 4.2.2.2 of TS 23.502 [3];\n-\tUE Triggered Service Request, see clause 4.2.3.2 of TS 23.502 [3];\nNOTE 6:\tSince UE triggered Service Request is prevented by Service Gap timer, this implicitly prevents the UE from initiating UPF anchored Mobile Originated Data Transport in Control Plane CIoT 5GS Optimisation (see clause 4.24.1 of TS 23.502 [3]), NEF Anchored Mobile Originated Data Transport (see clause 4.25.4 of TS 23.502 [3]) and MO SMS over NAS in CM-IDLE (see clause 4.13.3.3 of TS 23.502 [3]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.17\tInter-UE QoS for NB-IoT",
                            "text_content": "To allow NG-RAN to prioritise resource allocation between different UEs accessing via NB-IoT when some of the UEs are using Control Plane CIoT 5GS Optimisation, NG-RAN may, based on configuration, retrieve from the AMF the subscribed NB-IoT UE Priority for any UE accessing via NB-IoT by using the UE's 5G-S-TMSI as the identifier.\nIn order to reduce signalling load on the AMF, NG-RAN may be configured to request the NB-IoT UE Priority from the AMF e.g. only when the NG-RAN's NB-IoT load exceeds certain threshold(s) or when the NG-RAN needs to cache the QoS profile.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.18\tUser Plane CIoT 5GS Optimisation",
                            "text_content": "User Plane CIoT 5GS Optimisation enables transfer of user plane data from CM-IDLE without the need for using the Service Request procedure to establish Access Stratum (AS) context in NG-RAN and UE.\nIf the following preconditions are met:\n-\tUE and AMF negotiated support User Plane CIoT 5GS Optimisation (see clause 5.31.2) over NAS,\n-\tthe UE has indicated support of User Plane CIoT 5GS Optimisation in the UE radio capabilities as defined in TS 36.331 [51],\n-\tAMF has indicated User Plane CIoT 5GS Optimisation support for the UE to NG-RAN,\n-\tthe UE has established at least one PDU session with active UP connection, i.e. AS context is established in NG-RAN and the UE,\nthen the RRC connection can be suspended by means of the Connection Suspend Procedure (see clause 4.8.1.2 of TS 23.502 [3]).\nBased on a trigger from the NAS layer when a UE is in CM-IDLE with Suspend, the UE should attempt the Connection Resume in CM-IDLE with Suspend procedure (clause 4.8.2.3 of TS 23.502 [3]). If the Connection Resume in CM-IDLE with Suspend procedure fails, the UE initiates the pending NAS procedure. To maintain support for User Plane CIoT 5GS Optimisation for UE mobility across different NG-RAN nodes, the AS Context should be transferred between the NG-RAN nodes, see TS 38.300 [27] and TS 38.423 [99].\nFor MT data or signalling when the UE is in CM-IDLE with Suspend, Network Triggered Service Request procedure (clause 4.2.3.3 of TS 23.502 [3]) applies.\nBy using the Connection Suspend Procedure:\n-\tthe UE at transition into CM-IDLE stores the AS information;\n-\tNG-RAN stores the AS information, the NGAP UE association and the PDU session context for that UE;\n-\tAMF stores the NGAP UE association and other information necessary to later resume the UE, interacts with the SMF(s) to deactivate the user plane resources for the UE's PDU Sessions and enters CM-IDLE.\nNG-RAN may decide based on implementation to delete the stored UE context and NGAP association. In that case, the RAN shall initiate the AN Release procedure as described in clause 4.2.6 of TS 23.502 [3]. NG-RAN does not initiate any RRC procedure to notify the UE of the UE context release.\nBy using the Connection Resume in CM-IDLE with Suspend procedure:\n-\tthe UE resumes the connection from CM-IDLE with the network using the AS information stored during the Connection Suspend procedure;\n-\tNG-RAN notifies the AMF that the connection with the UE has been resumed;\n-\tAMF enters CM-CONNECTED and interacts with the SMF to activate the user plane resources for the UE's PDU Sessions.\nEarly Data Transmission may be initiated by the UE for mobile originated User Plane CIoT 5GS Optimisation during Connection Resume.\nIf the AMF establishes an NGAP UE association with a new NG-RAN node different from the stored NGAP UE association, e.g. the UE initiates service request or registration procedure from a different NG-RAN node, the AMF initiates UE N2 release command towards the old NG-RAN node.\nNG-RAN maintains the N3 tunnel endpoint information while a UE is in CM-IDLE with Suspend. UPF is instructed to remove DL N3 Tunnel Info of AN during Connection Suspend procedure, while UPF keeps UL N3 Tunnel Info (i.e. UPF accepts and forwards UL data). If a UE sends MO data with resume procedure, the NG-RAN can send the MO data to the UPF which is addressed by the N3 tunnel endpoint information. In the case of change of serving NG-RAN node due to UE mobility, if NG-RAN determines that it is not able to connect to the UPF which is addressed by the N3 tunnel endpoint information, NG-RAN performs Path Switch procedure before sending the MO data received from the UE.\nEarly Data Transmission may be initiated by the UE for mobile originated User Plane CIoT 5GS Optimisation when the RAT Type is E-UTRA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.19\tQoS model for NB-IoT",
                            "text_content": "5GC QoS model described in clause 5.7 applies to NB-IoT with the following requirements:\n-\tThe default QoS rule shall be the only QoS rule of a PDU Session for a UE connected to 5GC via NB-IoT. There is only one QoS Flow (corresponding to the default QoS rule) per PDU session.\n-\tReflective QoS is not supported over NB-IoT.\n-\tFor NB-IoT, there is a 1:1 mapping between the QoS Flow corresponding to the default QoS of a PDU session and a Data Radio Bearer when user plane resources are active for that PDU session.\n-\tA maximum of two Data Radio Bearers are supported over NB-IoT. Therefore, at most two PDU sessions can have active user plane resources at the same time.\n-\tThe capability of multiple UP resource support for NB-IoT UEs is indicated in the UE 5GMM Core Network Capability (see TS 24.501 [47]). During PDU Session Establishment or UP resource activation, the AMF checks if the UE can support the establishment of user plane resources (See clause 4.2.3.2 and clause 4.3.2.2.1 of TS 23.502 [3]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.31.20\tCategory M UEs differentiation",
                            "text_content": "This functionality is used by the network to identify traffic to/from Category M UEs, e.g. for charging differentiation.\nA Category M UE using E-UTRA shall provide a Category M indication to the NG-RAN during RRC Connection Establishment procedure as defined in TS 36.331 [51].\nWhen the UE has provided a Category M indication to the NG-RAN during RRC Connection Establishment, the NG-RAN shall provide an LTE-M Indication to the AMF in the Initial UE Message (see clause 4.2.2.2.1 of TS 23.502 [3] and TS 38.413 [34]).\nWhen the AMF receives an LTE-M Indication from NG-RAN in an Initial UE Message or from an MME during EPS to 5GS handover, the AMF shall store the LTE-M Indication in the UE context, consider that the RAT type is LTE-M and signal it accordingly to the SMSF during registration procedure for SMS over NAS, to the SMF during PDU Session Establishment or PDU Session Modification procedure. The PCF will also receive the RAT Type as LTE-M, when applicable, from the SMF during SM Policy Association Establishment or SM Policy Association Modification procedure.\nThe NFs generating CDRs shall include the LTE-M RAT type in their CDRs.\nUpon AMF change or inter-system mobility from 5GS to EPS, the source AMF shall provide the \"LTE-M Indication\" to the target AMF or MME as part of the UE context.\nDuring EPS to 5GS Mobility Registration Procedure, the AMF shall disregard any \"LTE-M Indication\" received from the MME in the UE context (see TS 23.401 [26]), and take into account the \"LTE-M Indication\" received from NG-RAN, as specified above.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.32\tSupport for ATSSS",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.32.1\tGeneral",
                            "text_content": "The ATSSS feature is an optional feature that may be supported by the UE and the 5GC network.\nThe ATSSS feature enables a multi-access PDU Connectivity Service, which can exchange PDUs between the UE and a data network by simultaneously using one 3GPP access network and one non-3GPP access network and two independent N3/N9 tunnels between the PSA and RAN/AN. The multi-access PDU Connectivity Service is realized by establishing a Multi-Access PDU (MA PDU) Session, i.e. a PDU Session that may have user-plane resources on two access networks. This assumes both 3GPP access and non-3GPP access are allowed for the S-NSSAI of the PDU Session.\nThe UE may request a MA PDU Session when the UE is registered via both 3GPP and non-3GPP accesses, or when the UE is registered via one access only.\nAfter the establishment of a MA PDU Session, and when there are user-plane resources on both access networks, the UE applies network-provided policy (i.e. ATSSS rules) and considers local conditions (such as network interface availability, signal loss conditions, user preferences, etc.) for deciding how to distribute the uplink traffic across the two access networks. Similarly, the UPF anchor of the MA PDU Session applies network-provided policy (i.e. N4 rules) and feedback information received from the UE via the user-plane (such as access network Unavailability or Availability) for deciding how to distribute the downlink traffic across the two N3/N9 tunnels and the two access networks. When there are user-plane resources on only one access network, the UE applies the ATSSS rules and considers local conditions for triggering the establishment or activation of the user plane resources over another access.\nThe type of a MA PDU Session may be one of the following types defined in clause 5.6.1: IPv4, IPv6, IPv4v6, and Ethernet. In this release of the specification, the Unstructured type is not supported. The clause 5.32.6.2.1, the clause 5.32.6.2.2 and the clause 5.32.6.3.1 below define what Steering Functionalities can be used for each supported type of a MA PDU Session.\nThe handling of 3GPP PS Data Off feature for MA PDU Session is specified in clause 5.24.\nThe ATSSS feature can be supported over any type of access network, including untrusted and trusted non-3GPP access networks (see clauses 4.2.8 and 5.5), wireline 5G access networks (see clause 4.2.8), etc. as long as a MA PDU Session can be established over this type of access network.\nIn this Release of the specification, a MA PDU Session using IPv6 multi-homing (see clause 5.6.4.3) or UL Classifier (see clause 5.6.4.2) is not specified.\nIn this Release of the specification, support for ATSSS assumes SMF Service Areas covering the whole PLMN or that a MA PDU Session is released over both accesses when the UE moves out of the SMF Service Area.\nA MA PDU Session does not support LADN. If the AMF receives a request to establish a MA PDU Session for a LADN DNN, the AMF shall reject the request. If the AMF receives a request to establish a PDU Session for a LADN DNN with \"MA PDU Network-Upgrade Allowed\" indication, the AMF shall not forward \"MA PDU Network-Upgrade Allowed\" indication to the SMF.\nIf the UE, due to mobility, moves from being served by a source AMF supporting ATSSS to a target AMF not supporting ATSSS, the MA PDU Session is released as described in TS 23.502 [3].\nNOTE 1:\tDeployment of ATSSS that is homogeneous per PLMN, or network slice enables consistent behaviour. In the case of non-homogenous support of ATSSS in a PLMN/slice (i.e. some NFs in a PLMN/slice may not support ATSSS), MA PDU Sessions can be released due to UE mobility.\nA Multi-Access PDU Session may, for the 3GPP access and/or non-3GPP access, use user-plane resources of an associated PDN Connection in EPC (e.g. one 3GPP access path via EPC and one non-3GPP access path via 5GC or one 3GPP access path via 5GC and one non-3GPP access path via ePDG/EPC). Such use of ATSSS with EPS interworking may apply to Ethernet and IP-based PDU Session and PDN Connection types.\nNOTE 2:\tCo-existence with NBIFOM is not defined. It is assumed that NBIFOM and the multi-access connectivity described in this clause are not deployed in the same network.\nNOTE 3:\tTo the MME and SGW this is a regular PDN Connection and the support for ATSSS is transparent to MME and SGW.\nFor a MA PDU Session established for the Ethernet PDU Session type, if the UE has not indicated support for Ethernet PDN connection type or if the network does not support Ethernet PDN connection type, when the 3GPP access use user-plane resources of an associated PDN Connection, the following takes place:\n-\tThe SMF+PGW-C considers that the Multi-Access PDU Session is still using the Ethernet PDU Session / PDN Connection type but in a restricted mode where EPS signalling can only refer to non-IP PDN Connection type.\n-\tMAR rules in the UPF are still used for distributing DL traffic between 3GPP access and non-3GPP access.\n-\tFor traffic on 3GPP access, the SMF may update N4 rules and QoS rules/EPS bearer contexts on the UE to take into account that no QoS differentiation is possible over 3GPP access.\nSupport of Multi-Access PDU Sessions using one leg associated with PDN Connection in EPC and one leg associated with PDU Session in 5GC is further defined in TS 23.502 [3].\nThe following clauses specify the functionality that enables ATSSS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.2\tMulti Access PDU Sessions",
                            "text_content": "A Multi-Access PDU (MA PDU) Session is managed by using the session management functionality specified in clause 5.6, with the following additions and modifications:\n-\tWhen the UE wants to request a new MA PDU Session:\n-\tIf the UE is registered to the same PLMN over 3GPP and non-3GPP accesses, then the UE shall send a PDU Session Establishment Request over any of the two accesses. The UE also provides Request Type as \"MA PDU Request\" in the UL NAS Transport message. The AMF informs the SMF that the UE is registered over both accesses and this triggers the establishment of user-plane resources on both accesses and two N3/N9 tunnels between PSA and the RAN/AN.\n-\tIf the UE is registered to different PLMNs over 3GPP and non-3GPP accesses, then the UE shall send a PDU Session Establishment Request over one access. The UE also provides Request Type as \"MA PDU Request\" in the UL NAS Transport message. After this PDU Session is established with one N3/N9 tunnel between the PSA and (R)AN established, the UE shall send another PDU Session Establishment Request over the other access. The UE also provides the same PDU Session ID and Request Type as \"MA PDU Request\" in the UL NAS Transport message. Two N3/N9 tunnels and User-plane resources on both accesses are established.\n-\tIf the UE is registered over one access only, then the UE shall send a PDU Session Establishment Request over this access. The UE also provides Request Type as \"MA PDU Request\" in the UL NAS Transport message. One N3/N9 tunnel between the PSA and (R)AN and User-plane resources on this access only are established. After the UE is registered over the second access, the UE shall establish user-plane resources on the second access.\n-\tIn the PDU Session Establishment Request that is sent to request a new MA PDU Session, the UE shall provide also its ATSSS capabilities, which indicate the steering functionalities and the steering modes supported in the UE. These functionalities are defined in clause 5.32.6.\n-\tIf the UE indicates it is capable of supporting:\n-\tthe ATSSS-LL functionality with any steering mode (as specified in clause 5.32.6.1);\nand the network accepts to activate this functionality, then the network may provide to UE Measurement Assistance Information (see details in clause 5.32.5) and shall provide to UE one or more ATSSS rules.\nNOTE 1:\tAs specified in Table 5.32.8-1 and in Table 5.8.5.8-1, the ATSSS-LL functionality cannot be used together with the Redundant steering mode. When the UE indicates it is capable of supporting the ATSSS-LL functionality with any steering mode, it is implied that the UE can support the ATSSS-LL functionality with any steering mode except the Redundant steering mode.\n-\tIf the UE indicates it is capable of supporting:\n-\tthe MPTCP functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1); or\n-\tthe MPTCP functionality with any steering mode and the ATSSS-LL functionality with any steering mode (as specified in clause 5.32.6.1);\nand the network accepts to activate these functionalities, then the network provides MPTCP proxy information to UE, and allocates to UE (a) one IP address/prefix for the MA PDU session (as defined in clause 5.8.2.2) and (b) two additional IP addresses/prefixes, called \"MPTCP link-specific multipath\" addresses. Further details are provided in clause 5.32.6.2.1. In addition, the network may provide to UE Measurement Assistance Information and shall provide to UE one or more ATSSS rules. If the UE supports the ATSSS-LL functionality with only the Active-Standby steering mode, the network shall provide to UE an ATSSS rule for non-MPTCP traffic. The ATSSS rule for non-MPTCP traffic shall use the ATSSS-LL functionality and the Active-Standby Steering Mode to indicate how the non-MPTCP traffic shall be transferred across the 3GPP access and the non-3GPP access in the uplink direction.\n-\tIf the UE indicates it is capable of supporting\n-\tthe MPQUIC functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1); or\n-\tthe MPQUIC functionality with any steering mode and the ATSSS-LL functionality with any steering mode (as specified in clause 5.32.6.1);\nand the network accepts to activate these functionalities, then the network provides MPQUIC proxy information to UE, and allocates to UE (a) one IP address/prefix for the MA PDU session (as defined in clause 5.8.2.2) and (b) two additional IP addresses/prefixes, called \"MPQUIC link-specific multipath\" addresses. Further details are provided in clause 5.32.6.2.2. In addition, the network may provide to UE Measurement Assistance Information and shall provide to UE one or more ATSSS rules. If the UE supports the ATSSS-LL functionality with only the Active-Standby steering mode, the network shall provide to UE an ATSSS rule for non-MPQUIC traffic. The ATSSS rule for non-MPQUIC traffic shall use the ATSSS-LL functionality and the Active-Standby Steering Mode to indicate how the non-MPQUIC traffic shall be transferred across the 3GPP access and the non-3GPP access in the uplink direction.\n-\tIf the UE indicates it is capable of supporting\n-\tthe MPTCP functionality with any steering mode, and the MPQUIC functionality with any steering mode, and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1); or\n-\tthe MPTCP functionality with any steering mode, and the MPQUIC functionality with any steering mode, and the ATSSS-LL functionality with any steering mode (as specified in clause 5.32.6.1);\nand the network accepts to activate these functionalities, then the network provides MPTCP proxy information and MPQUIC proxy information to UE and allocates to UE (a) one IP address/prefix for the MA PDU session (as defined in clause 5.8.2.2), (b) two additional IP addresses/prefixes, called \"MPTCP link-specific multipath\" addresses, and (c) two additional IP addresses/prefixes, called \"MPQUIC link-specific multipath\" addresses. Further details are provided in clause 5.32.6.2.1 and in clause 5.32.6.2.2. In addition, the network may provide to UE Measurement Assistance Information and shall provide to UE one or more ATSSS rules. If the UE supports the ATSSS-LL functionality with only the Active-Standby steering mode, the network shall provide to UE an ATSSS rule for non-MPTCP and non-MPQUIC traffic (i.e. the traffic for which neither the MPTCP nor the MPQUIC functionalities are applied). The ATSSS rule for non-MPTCP and non-MPQUIC traffic shall use the ATSSS-LL functionality and the Active-Standby Steering Mode to indicate how the non-MPTCP and non-MPQUIC traffic shall be transferred across the 3GPP access and the non-3GPP access in the uplink direction.\nNOTE 2:\tThe \"MPTCP link-specific multipath\" addresses and the \"MPQUIC link-specific multipath\" addresses can be the same.\n-\tIf the UE requests an S-NSSAI, this S-NSSAI should be allowed on both accesses. Otherwise, the MA PDU Session shall not be established.\n-\tThe SMF determines the ATSSS capabilities supported for the MA PDU Session based on the ATSSS capabilities provided by the UE and per DNN configuration on SMF, as follows:\na)\tIf the UE includes in its ATSSS capabilities \"MPTCP functionality with any steering mode and ATSSS-LL functionality with only Active-Standby steering mode\" (as specified in clause 5.32.6.1), then:\ni)\tIf the DNN configuration allows MPTCP and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), including RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPTCP and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (2) MPTCP and ATSSS-LL with Active-Standby mode in the uplink.\nNOTE 3:\tIn this case, it is assumed that ATSSS-LL with \"Smallest Delay\" steering mode is selected for the downlink only when the UPF can measure RTT without using the PMF protocol, e.g. by using other means not defined by 3GPP such as using the RTT measurements of MPTCP.\nii)\tIf the DNN configuration allows MPTCP and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), but not RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPTCP in the downlink (2) ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (3) MPTCP and ATSSS-LL with Active-Standby mode in the uplink.\niii)\tIf the DNN configuration allows MPTCP with any steering mode and ATSSS-LL with only Active-Standby steering mode, the MA PDU Session is capable of MPTCP and ATSSS-LL with Active-Standby mode in the uplink and in the downlink.\nb)\tIf the UE includes in its ATSSS capabilities \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with only Active-Standby steering mode\" (as specified in clause 5.32.6.1), then:\ni)\tIf the DNN configuration allows MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), including RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (2) MPQUIC and ATSSS-LL with Active-Standby mode in the uplink.\nNOTE 4:\tIn this case, it is assumed that ATSSS-LL with \"Smallest Delay\" steering mode is selected for the downlink only when the UPF can measure RTT without using the PMF protocol, e.g. by using other means not defined by 3GPP such as using the RTT measurements of MPQUIC.\nii)\tIf the DNN configuration allows MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), but not RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPQUIC in the downlink (2) ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (3) MPQUIC and ATSSS-LL with Active-Standby mode in the uplink.\niii)\tIf the DNN configuration allows MPQUIC with any steering mode and ATSSS-LL with only Active-Standby steering mode, the MA PDU Session is capable of MPQUIC and ATSSS-LL with Active-Standby mode in the uplink and in the downlink.\nc)\tIf the UE includes in its ATSSS capabilities \"MPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode\" (as specified in clause 5.32.6.1), and the DNN configuration allows MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), the MA PDU Session is capable of MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the uplink and in the downlink.\nd)\tIf the UE includes in its ATSSS capabilities \"ATSSS-LL functionality with any steering mode\" (as specified in clause 5.32.6.1) and the DNN configuration allows ATSSS-LL with any steering mode allowed for ATSSS-LL, the MA PDU Session is capable of ATSSS-LL with any steering mode allowed for ATSSS-LL in the uplink and in the downlink.\ne)\tIf the UE includes in its ATSSS capabilities \"MPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode\" (as specified in clause 5.32.6.1), and the DNN configuration allows MPTCP and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), the MA PDU Session is capable of MPTCP and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the uplink and in the downlink.\nf)\tIf the UE includes in its ATSSS capabilities \"MPTCP functionality with any steering mode, and the MPQUIC functionality with any steering mode, and the ATSSS-LL functionality with any steering mode\" (as specified in clause 5.32.6.1), and the DNN configuration allows MPTCP and MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), the MA PDU Session is capable of MPTCP and MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the uplink and in the downlink.\ng)\tIf the UE includes in its ATSSS capabilities \"MPTCP functionality with any steering mode, and the MPQUIC functionality with any steering mode, and the ATSSS-LL functionality with only the Active-Standby steering mode\" (as specified in clause 5.32.6.1), then:\ni)\tIf the DNN configuration allows MPTCP and MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), including RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPTCP and MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (2) MPTCP and MPQUIC and ATSSS-LL with Active-Standby mode in the uplink.\nNOTE 5:\tIn this case, it is assumed that ATSSS-LL with \"Smallest Delay\" steering mode is selected for the downlink only when the UPF can measure RTT without using the PMF protocol, e.g. by using other means not defined by 3GPP such as using the RTT measurements of MPTCP or MPQUIC.\nii)\tIf the DNN configuration allows MPTCP and MPQUIC and ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL), but not RTT measurement without using PMF protocol, the MA PDU Session is capable of (1) MPTCP and MPQUIC in the downlink (2) ATSSS-LL with any steering mode (i.e. any Steering Mode allowed for ATSSS-LL) in the downlink, and (3) MPTCP and MPQUIC and ATSSS-LL with Active-Standby mode in the uplink.\niii)\tIf the DNN configuration allows MPTCP and MPQUIC with any steering mode and ATSSS-LL with only Active-Standby steering mode, the MA PDU Session is capable of MPTCP and MPQUIC and ATSSS-LL with Active-Standby mode in the uplink and in the downlink.\nThe SMF provides the ATSSS capabilities of the MA PDU Session to the PCF during PDU Session Establishment.\n-\tThe PCC rules provided by PCF include MA PDU Session Control information (see TS 23.503 [45]). They are used by SMF to derive ATSSS rules for the UE and N4 rules for the UPF. When dynamic PCC is not used for the MA PDU Session, the SMF shall provide ATSSS rules and N4 rules based on local configuration (e.g. based on DNN or S-NSSAI).\n-\tThe UE receives ATSSS rules from SMF, which indicate how the uplink traffic should be routed across 3GPP access and non-3GPP access. Similarly, the UPF receives N4 rules from SMF, which indicate how the downlink traffic should be routed across 3GPP access and non-3GPP access.\n-\tWhen the SMF receives a PDU Session Establishment Request and a \"MA PDU Request\" indication and determines that UP security protection (see clause 5.10.3) is required for the PDU Session, the SMF shall only confirm the establishment of the MA PDU session if the 3GPP access network can enforce the required UP security protection. The SMF needs not confirm whether the non-3GPP access can enforce the required UP security protection.\n-\tThe UE indicates during MA PDU Session Establishment to the AMF whether it supports non-3GPP access path switching, i.e. whether the UE can transfer the non-3GPP access path of the MA PDU Session from a source non-3GPP access (N3IWF/TNGF) to a target non-3GPP access (a different N3IWF/TNGF). If the UE has indicated support for non-3GPP access path switching and the AMF supports non-3GPP access path switching, the AMF selects an SMF that supports non-3GPP access path switching, if such an SMF is available. If the AMF supports to maintain two N2 connections for non-3GPP access during the Registration procedure and the selected SMF supports non-3GPP path switching, the AMF indicates whether the UE supports non-3GPP path switching to the SMF. The SMF indicates support for non-3GPP path switching to the UE in the PDU Session Establishment Accept message.\nNOTE 6:\tIf the AMF selects an SMF not supporting non-3GPP access path switching, the non-3GPP access path switching can still be performed with the AMF triggering release of the old user plane resources before new user plane resources are established.\n-\tAfter the MA PDU Session establishment:\n-\tAt any given time, the MA PDU session may have user-plane resources on both 3GPP and non-3GPP accesses, or on one access only, or may have no user-plane resources on any access.\n-\tThe AMF, SMF, PCF and UPF maintain their MA PDU Session contexts, even when the UE deregisters from one access (but remains registered on the other access).\n-\tWhen the UE deregisters from one access (but remains registered on the other access), the AMF informs the SMF to release the resource of this access type in the UPF for the MA PDU Session. Subsequently, the SMF notifies the UPF that the access type has become unavailable and the N3/N9 tunnel for the access type are released.\n-\tIf the UE wants to add user-plane resources on one access of the MA PDU Session, e.g. based on access network performance measurement and/or ATSSS rules, then the UE shall send a PDU Session Establishment Request over this access containing PDU Session ID of the MA PDU Session. The UE also provides Request Type as \"MA PDU Request\" and the same PDU Session ID in the UL NAS Transport message. If there is no N3/N9 tunnel for this access, the N3/N9 tunnel for this access is established.\n-\tIf the UE wants to re-activate user-plane resources on one access of the MA PDU Session, e.g. based on access network performance measurement and/or ATSSS rules, then the UE shall initiate the UE Triggered Service Request procedure over this access.\n-\tIf the network wants to re-activate the user-plane resources over 3GPP access or non-3GPP access of the MA PDU Session, the network shall initiate the Network Triggered Service Request procedure, as specified in clause 4.22.7 of TS 23.502 [3].\n-\tIf the UE wants to move the non-3GPP user-plane resources of the MA PDU Session from a source non-3GPP access (e.g. source N3IWF or TNGF) to a target non-3GPP access (e.g. target N3IWF or TNGF), the UE initiates a Mobility Registration Update via the target non-3GPP access as described in TS 23.502 [3], clause 4.22.9.5. This procedure may also be used to move the non-3GPP user-plane resources of single access PDU Session(s).\nNOTE 7:\tThe UE can request activation of single access PDU Session(s) over the target non-3GPP access while performing Mobility Registration Update procedure according to the existing procedure.\n-\tThe SMF may add, remove or update one or more individual ATSSS rules of the UE by sending new or updated ATSSS rules with the corresponding Rule IDs to the UE.\nA MA PDU Session may be established either:\na)\twhen it is explicitly requested by an ATSSS-capable UE; or\nb)\twhen an ATSSS-capable UE requests a single-access PDU Session but the network decides to establish a MA PDU Session instead. This is an optional scenario specified in clause 4.22.3 of TS 23.502 [3], which may occur when the UE requests a single-access PDU Session but no policy (e.g. no URSP rule) and no local restrictions in the UE mandate a single access for the PDU Session.\nA MA PDU Session may be established during a PDU Session modification procedure when the UE moves from EPS to 5GS, as specified in clause 4.22.6.3 of TS 23.502 [3].\nThe AMF indicates as part of the Registration procedure whether ATSSS is supported or not. When ATSSS is not supported, the UE shall not\n-\trequest establishment of a MA PDU Session (as described in clause 4.22.2 of TS 23.502 [3]); or\n-\trequest addition of User Plane resources for an existing MA PDU Session (as described in clause 4.22.7 of TS 23.502 [3]); or\n-\trequest establishment of a PDU Session with \"MA PDU Network-Upgrade Allowed\" indication (as described in clause 4.22.3 of TS 23.502 [3]); or\n-\trequest PDU Session Modification with Request Type of \"MA PDU request\" or with \"MA PDU Network-Upgrade Allowed\" indication after moving from EPC to 5GC (as described in clause 4.22.6.3 of TS 23.502 [3]).\nThe AMF indicates as part of the Registration procedure whether it supports non-3GPP access path switching. When the AMF does not indicate support of non-3GPP access path switching, the UE shall not perform the Mobility Registration Update procedure for non-3GPP access path switching, i.e. to switch traffic from a source non-3GPP access to a target non-3GPP access. The SMF indicates as part of the PDU Session Establishment procedure whether it supports non-3GPP access path switching. If the UE has more than one PDU session and at least one serving SMF for the PDU Sessions supports non-3GPP access path switching, the UE may include (\"Non-3GPP path switching while using old AN resources\") indication when the UE performs the Mobility Registration Update procedure for non-3GPP access path switching. If the UE is registered to different PLMNs over 3GPP and non-3GPP accesses, the UE shall use the capability received over non-3GPP access to determine whether to perform the Mobility Registration Update procedure for non-3GPP path switching and whether to include (\"Non-3GPP access path switching while using old AN resources\") indication.\nNOTE 8:\tIf the AMF receives (\"Non-3GPP path switching while using old AN resources\") indication from Mobility Registration Update procedure, and the serving SMF(s) for PDU Session(s) is not supporting non-3GPP access path switching, the non-3GPP access path switching can still be performed with the AMF triggering for each PDU Session the release of the old user plane resources before new user plane resources are established.\nAn ATSSS-capable UE may decide to request a MA PDU Session based on the provisioned URSP rules. In particular, the UE should request a MA PDU Session when the UE applies a URSP rule, which triggers the UE to establish a new PDU Session and the Access Type Preference component of the URSP rule indicates \"Multi-Access\" (see TS 23.503 [45]).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.3\tPolicy for ATSSS Control",
                            "text_content": "If dynamic PCC is to be used for the MA PDU Session, the PCF may take ATSSS policy decisions and create PCC rules that contain MA PDU Session Control information, (as specified in TS 23.503 [45]), which determines how the uplink and the downlink traffic of the MA PDU Session should be distributed across the 3GPP and non-3GPP accesses. If dynamic PCC is not deployed, local policy in SMF is used.\nThe SMF receives the PCC rules with MA PDU Session Control information and maps these rules into (a) ATSSS rules, which are sent to the UE, and (b) N4 rules, which are sent to the UPF. The ATSSS rules are provided as a prioritized list of rules (see clause 5.32.8), which are applied by the UE to enforce the ATSSS policy in the uplink direction and the N4 Rules are applied by the UPF to enforce the ATSSS policy in the downlink direction.\nThe ATSSS rules are sent to UE with a NAS message when the MA PDU Session is created or updated by the SMF, e.g. after receiving updated/new PCC rules from the PCF. Similarly, the N4 rules are sent to UPF when the MA PDU Session is created or updated by the SMF.\nThe details of the policy control related to ATSSS are specified in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.4\tQoS Support",
                            "text_content": "The 5G QoS model for the Single-Access PDU Session is also applied to the MA PDU Session, i.e. the QoS Flow is the finest granularity of QoS differentiation in the MA PDU Session. One difference compared to the Single-Access PDU Session is that in a MA PDU Session there can be separate user-plane tunnels between the AN and the PSA, each one associated with a different access. However, the QoS Flow is not associated with specific access, i.e. it is access agnostic, so the same QoS is supported when the traffic is distributed over 3GPP and non-3GPP accesses. The SMF shall provide the same QFI in 3GPP and non-3GPP accesses so that the same QoS is supported in both accesses.\nA QoS Flow of the MA PDU Session may be either Non-GBR or GBR depending on its QoS profile.\nFor a Non-GBR QoS Flow, the SMF provides a QoS profile to both 5G-ANs during MA PDU Session Establishment or MA PDU Session Modification procedure:\n-\tDuring MA PDU Session Establishment procedure, the QoS profile to both ANs if the UE is registered over both accesses.\n-\tDuring MA PDU Session Modification procedure, the QoS profile is provided to the 5G-AN(s) over which the user plane resources are activated.\nFor a GBR QoS Flow, the SMF shall provide a QoS profile to 5G-AN(s) as follows:\n-\tIf the PCC rule allows a GBR QoS Flow in a single access, the SMF provides the QoS profile for the GBR QoS Flow to the access network allowed by the PCC rule.\n-\tIf the PCC rule allows a GBR QoS Flow in both accesses and the Steering Mode is different from Redundant, the SMF decides to which access network to provide the QoS profile for the GBR QoS Flow based on its local policy (e.g. the access where the traffic is ongoing according to the Multi Access Routing rule).\n-\tIf the PCC rule allows a GBR QoS Flow in both accesses and the Steering Mode is Redundant, the SMF provides the QoS profile for the GBR QoS Flow to both access networks. Whenever the SMF recognizes that resources are not allocated in one access network, the SMF shall notify the PCF about the resource allocation failure and indicate the respective Access Type. Whenever the SMF recognizes that resources are not allocated in both access networks, the SMF shall release the resources for the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\nNOTE 1:\tThe SMF knows about the allocation of resources in an access network from the interaction with the access network during GBR QoS Flow establishment/modification as well as during the release of resources by the access network.\nFor a GBR QoS Flow, traffic splitting is not supported. If the UPF determines that it cannot send GBR traffic over the current ongoing access e.g. based on the N4 rules and access availability and unavailability report from the UE as described in clause 5.32.5.3, the UPF shall send an Access Availability report to the SMF.\nBased on the Access Availability report and if the Steering Mode is different from Redundant, the SMF decides whether to move GBR QoS Flows to the other access when one access is not available:\n-\tif the PCC rule allows the GBR QoS Flows only on this access, the SMF shall release the resources for the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\n-\tif the corresponding PCC rule allows the GBR QoS Flow on both accesses and the other access is not available, the SMF shall release the resources for the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\n-\tif the PCC rule allows the GBR QoS Flow on both accesses and the other access is available, the SMF shall try to move the GBR QoS Flow to the other access. The SMF may trigger a PDU session modification procedure to provide the QoS profile to the other access and release the resources for the GBR QoS Flow in the current access.\n-\tif Notification Control parameter is not included in the PCC rule for the GBR QoS Flow and the other access does not accept the QoS profile, the SMF shall release the resources for the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\n-\tif the Notification Control parameter is included in the PCC rule, the SMF shall notify the PCF that GFBR can no longer be guaranteed. After the other access accepts the QoS profile, the SMF shall notify the PCF that GFBR can again be guaranteed. If the other access does not accept the QoS profile, the SMF shall delete the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\nNOTE 2:\tThe ATSSS rule for GBR QoS Flow only allows the UE to steer traffic over a single access so that the network knows in which access the UE sends GBR traffic. If the network wants to move GBR QoS Flow to the other access, the network needs to update ATSSS rule of the UE.\nBased on the Access Availability report and if the Steering Mode is Redundant, the SMF behaves as follows:\n-\tif both accesses are not available, the SMF shall release the resources for the GBR QoS Flow and report to the PCF about the removal of the PCC rule.\nNOTE 3:\tThe UPF can detect that both accesses are not available based on implementation specific means.\n-\twhen one of the accesses becomes unavailable while the other access is still available, the SMF shall neither release the resources for the GBR QoS Flow nor notify the PCF that GFBR can no longer be guaranteed (if the Notification Control parameter is included in the PCC rule).\nNOTE 4:\tThe access network will typically release the resources for a GBR QoS Flow if there is no traffic transferred for a certain amount of time and this will then trigger the SMF notification to PCF described above.\nWhen the MA PDU Session is established or when the MA PDU Session is modified, the SMF may provide QoS rule(s) to the UE via one access, which are applied by the UE as specified in clause 5.7.1.4. The QoS rule(s) provided by SMF via one access are commonly used for both 3GPP access and non-3GPP access, so the QoS classification is independent of ATSSS rules.\nThe derived QoS rule generated by Reflective QoS is applied independently of the access on which the RQI was received. When the MPTCP functionality and/or the MPQUIC functionality is used in the UE, the UE shall use the IP address/prefix of the MA PDU Session and the final destination address to generate the derived QoS rule.\nWhen the MPTCP functionality and/or MPQUIC functionality is enabled for the MA PDU Session:\n-\tany QoS rules or PDRs that apply to the MA PDU Session IP address/prefix and port also apply (a) to the MPTCP \"link-specific multipath\" addresses/prefixes and ports used by the UE to establish MPTCP subflows over 3GPP and non-3GPP accesses , and (b) to the \"MPQUIC link-specific multipath\" addresses and ports used by the UE to transmit UDP flows over 3GPP and non-3GPP accesses; and\n-\tany QoS rules or PDRs that apply to the IP address/prefix and port of the final destination server in DN also apply (a) to the IP address and port of the MPTCP proxy for corresponding MPTCP subflows that are terminated at the proxy and (b) to the IP address and port of the MPQUIC proxy for corresponding UDP flows that are terminated at the proxy.\nNOTE 5:\tHow these associations are made is left up to the UE and UPF implementations.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.5\tAccess Network Performance Measurements",
                            "text_content": "When an MA PDU Session is established, the network may provide the UE with Measurement Assistance Information. This information assists the UE in determining which measurements shall be performed over both accesses, as well as whether measurement reports need to be sent to the network.\nMeasurement Assistance Information shall include the addressing information of a Performance Measurement Function (PMF) in the UPF, the UE can send PMF protocol messages to:\n-\tFor a PDU Session of IP type, Measurement Assistance Information contains one IP address for the PMF, one UDP port associated with 3GPP access and another UDP port associated with non-3GPP access. PMF messages sent by UE to one of these UDP ports, shall be transmitted to UPF via the QoS Flow associated with the default QoS rule.\n-\tFor a PDU Session of Ethernet type, Measurement Assistance Information contains one MAC address associated with 3GPP access and another MAC address associated with non-3GPP access. PMF messages sent by UE to one of these MAC addresses, shall be transmitted to UPF via the QoS Flow associated with the default QoS rule.\nNOTE 1:\tTo protect the PMF in the UPF (e.g. to block DDOS to the PMF), the IP addresses of the PMF are only accessible from the UE IP address via the N3/N9 interface.\nNOTE 2:\tAfter the MA PDU Session is released, the same UE IP address/prefix is not allocated to another UE for MA PDU Session in a short time.\nIf the SMF determines that access performance measurements per QoS Flow shall be applied for the MA PDU Session, then the Measurement Assistance Information shall also include a list of QoS Flows on which access performance measurements may be performed. For each QoS Flow in this list, the following information is included:\n-\tThe QFI of the associated QoS Flow.\n-\tFor a PDU Session of IP type, one UDP port associated with 3GPP access and another UDP port associated with non-3GPP access. PMF messages sent by UE to one of these UDP ports, shall be transmitted to UPF via the associated QoS Flow.\n-\tFor a PDU Session of Ethernet type, one MAC address associated with 3GPP access and another MAC address associated with non-3GPP access. PMF messages sent by UE to one of these MAC addresses, shall be transmitted to UPF via the associated QoS Flow.\nThe QoS rules and the N4 rules provided by SMF to UE and to UPF respectively shall include information (e.g. packet filters containing the UDP port or the MAC address associated with a QoS Flow), which enables the UE and UPF to route a PMF message to a specific QoS Flow.\nThe UE and the UPF may need to perform access performance measurements in order to estimate the Round-Trip Time (RTT) and/or the Packet Loss Rate (PLR) that an SDF is expected to experience when transmitted on a certain access type. Based on these measurements and the provisioned ATSSS rules in the UE and MAR rules in the UPF, the UE and the UPF decide how to distribute the traffic of an SDF across the two accesses.\nIf the UE and the UPF decide to initiate access performance measurements to estimate the RTT and/or the PLR for an SDF, the access performance measurements shall be performed either\n(a)\tusing the QoS Flow associated with the default QoS rule; or\n(b)\tusing the target QoS Flow, which is the QoS Flow that the SDF traffic is transmitted on.\nWhen the access performance measurements are using the target QoS Flow, it is termed that \"access performance measurements per QoS Flow\" are applied for the MA PDU Session.\nThe UE shall indicate in its ATSSS capabilities that it supports access performance measurements per QoS Flow. Based on this UE capability and other information (such as local policy), the SMF determines whether access performance measurements per QoS Flow shall be applied for the MA PDU Session or not. If the SMF determines that access performance measurements per QoS Flow shall be applied for the MA PDU Session, then:\n-\tThe SMF determines a list of QoS Flows over which access performance measurements may be performed and provides this list to the UE (within the Measurement Assistance Information) and to the UPF.\n-\tThe UE and the UPF may initiate access performance measurements on one or more of the QoS Flows included in this list. The UE and the UPF shall be able to receive and respond to PMF messages sent on any QoS Flow included in this list.\n-\tThe SMF may update the list of QoS Flows over which access performance measurements may be performed during the lifetime of a MA PDU Session, e.g. when a new PCC rule that could benefit from PMF access performance measurements is bound to a QoS Flow.\nNOTE 3:\tThe SMF can e.g. add a QoS Flow into the list when at least one PCC Rule is bound to that QoS Flow that is using one of the Steering Modes where performance measurements via PMF are applicable, such as Lowest Delay Steering Mode or a Steering Mode where threshold values have been provided.\nThe UE shall perform access performance measurements per QoS Flow only when this is explicitly indicated in the Measurement Assistance Information, i.e. only when the UE receives the list of QoS Flows over which access performance measurements may be performed. Otherwise, the UE shall perform access performance measurements based on the QoS Flow associated with the default QoS rule. The UPF shall perform access performance measurements per QoS Flow only when this is explicitly indicated by SMF, i.e. only when the UPF receives the list of QoS Flows over which access performance measurements may be performed. Otherwise, the UPF shall perform access performance measurements based on the QoS Flow associated with the default QoS rule. In this case the UPF learns what QoS Flow to use as described in TS 29.244 [65].\nThe UE and the UPF may decide not to initiate access performance measurements using PMF over a certain target QoS Flow, when they already have access performance measurements for another target QoS Flow which they determine can be reused.\nNOTE 4:\tHow the UE and UPF determine that the performance measurements using a certain target QoS Flow apply to another target QoS Flow is based on implementation, e.g. AN resource to QoS Flow mapping in the UE or getting similar access measurements results with other QoS Flow.\nWhen access performance measurements for an SDF are performed based on the target QoS Flow, the UE needs to be able to determine the QoS Flow a downlink packet arrives on. In order to enable this, the SMF shall include downlink Packet Filter information in the QoS rule provided to UE matching this SDF, unless Reflective QoS is used for the SDF.\nNOTE 5:\tFor example, if a QoS Flow requires to activate Reflective QoS, the SMF does not need to provide downlink QoS Flow information for the QoS Flow to minimize usage of packet filters. When a data packet is received over a QoS Flow, the UE can decide whether to check the downlink QoS Flow information based on the existence of SDAP header for the QoS Flow.\nThe addressing information of the PMF in the UPF is retrieved by the SMF from the UPF during N4 session establishment. If the UPF receives from the SMF, during N4 session establishment or modification procedure, a list of QoS Flows over which access performance measurements may be performed, the UPF allocates different UDP ports per QoS Flow per access for IP PDU sessions, or allocates different MAC addresses per QoS Flow per access for Ethernet PDU sessions. For IP PDU sessions, the UPF sends the PMF IP addressing information and the UDP ports with the QFI of the associated QoS Flow to the SMF. For Ethernet PDU sessions, the UPF sends the MAC addresses with the QFI of the associated QoS Flow to the SMF.\nThe following PMF protocol messages can be exchanged between the UE and the UPF:\n-\tMessages to allow for Round Trip Time (RTT) measurements, i.e. when the \"Smallest Delay\" steering mode is used or when either \"Priority-based\", \"Load-Balancing\" or \"Redundant\" steering mode is used with RTT threshold value being applied;\n-\tMessages to allow for Packet Loss Rate (PLR) measurements, i.e. when steering mode is used either \"Priority-based\", \"Load-Balancing\" or \"Redundant\" steering mode is used with PLR threshold value being applied;\n-\tMessages for reporting Access availability/unavailability by the UE to the UPF.\n-\tMessages for sending UE-assistance data to UPF. Such messages may be sent from the UE to UPF only when the UE receives the UE-assistance indicator in an ATSSS rule, as specified in clause 5.32.8. Further details are provided in clause 5.32.5.5.\n-\tMessages for sending Suspend Traffic Duplication and Resume Traffic Duplication from UPF to UE to suspend or resume traffic duplication as defined in clause 5.32.5.6.\nSince steering modes can be different in up-link and down-link, the UE needs to be able to handle PMF protocol messages for RTT and PLR measurements received from UPF even if it is not using one of the steering modes associated with the RTT and PLR measurements (and vice versa).\nThe PMF protocol is specified in TS 24.193 [109].\nThe PMF protocol messages used for access availability/unavailability reports shall be sent on the QoS Flow associated with the default QoS rule. The PMF protocol messages used for access performance measurements shall be sent either on the QoS Flow associated with the default QoS rule, or on the target QoS Flow, as specified above.\nThe QoS Flow associated with the default QoS rule for MA PDU Session is Non-GBR QoS Flow.\nThe UE shall not apply the ATSSS rules and the UPF shall not apply the MAR rules for the PMF protocol messages.\nWhen the UE requests a MA PDU session and indicates it is capable to support:\n-\tthe MPTCP functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1); or\n-\tthe MPQUIC functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1); or\n-\tthe MPTCP functionality with any steering mode, and the MPQUIC functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1);\nthe network may send Measurement Assistance Information for the UE to send Access availability/unavailability reports to the UPF. In this case, the UE and UPF shall not perform RTT and PLR measurements using PMF as the UE and UPF can use measurements available at the MPTCP layer and/or at the MPQUIC layer.\nAs described in clause 5.32.5.2, 5.32.5.2a and 5.32.5.3, a UE and UPF may exchange PMF messages to measure access performance and report access availability/unavailability. When the UE and UPF exchanges PMF message, source and destination address of the PMF messages shall be assigned as follows:\n1.\tIn the case of a MA PDU Session of IP type:\n-\tIf access performance measurements are performed only over the QoS Flow associated with the default QoS rule, the PMF in the UE sends PMF messages to the PMF in the UPF over UDP/IP. The destination IP address is the IP address contained in the Measurement Assistance Information and the destination UDP port is one of the two UDP ports contained in the Measurement Assistance Information. One UDP port is used for sending PMF messages to UPF over 3GPP access and the other UDP port is used for sending PMF messages to UPF over non-3GPP access. The source IP address is the IP address assigned to UE for the MA PDU Session and the source UDP port is a UDP port that is dynamically allocated by the UE for PMF communication. This source UDP port in the UE remains the same for the entire lifetime of the MA PDU Session.\nIf access performance measurements per QoS Flow is performed, the Measurement Assistance Information contains UDP ports, one for each QoS Flow and access combination. When the UE sends PMF message over a QoS Flow of an access, the UE shall set the destination UDP port as the UDP port for the QoS Flow and the access in Measurement Assistance information.\n-\tIf access performance measurements are performed only over the QoS Flow associated with the default QoS rule, the PMF in the UPF sends PMF messages to the PMF in the UE over UDP/IP. The source IP address is the same IP address as the one provided in the Measurement Assistance Information and the source UDP port is one of the two UDP ports as provided in the Measurement Assistance Information. One UDP port is used for sending PMF messages to UE over 3GPP access and the other UDP port is used for sending PMF messages to UE over the non-3GPP access. The destination IPv4 address is the IPv4 address assigned to UE for the MA PDU Session (if any) and the destination IPv6 address is an IPv6 address selected by the UE from the IPv6 prefix assigned for the MA PDU Session (if any). The destination UDP port is the dynamically allocated UDP port in the UE, which is contained in all PMF messages received from the UE.\nIf access performance measurements per QoS Flow is performed, when the UPF sends PMF message over a QoS Flow of an access, the UPF shall set the source UDP port with the UDP port for the QoS Flow and the access as the one for the QoS Flow and the access provided in Measurement Assistance information.\n-\tIf the UE receives Measurement Assistance Information, the UE shall inform the network via the user plane about the UE's dynamically allocated UDP port, and the IPv6 address if IPv6 is used for PMF messages, so that it is possible for the UPF to know the UE's IPv6 address (if applicable) and dynamically allocated UDP port as soon as the MA PDU Session has been established.\nNOTE 1:\tRegardless of whether access performance measurements per QoS Flow is applied or not, the UE only allocates a single UDP port for PMF messages.\n2.\tIn the case of a MA PDU Session of Ethernet type:\n-\tThe PMF in the UE sends PMF messages to the PMF in the UPF over Ethernet. The Ethertype is the Ethertype contained in the Measurement Assistance Information. If access performance measurements are performed only over the QoS Flow associated with the default QoS rule, the destination MAC address is one of the two MAC addresses contained in the Measurement Assistance Information. One MAC address is used for sending PMF messages to UPF over 3GPP access and the other MAC address is used for sending PMF messages to UPF over non-3GPP access. The source MAC address is a MAC address of the UE, which remains the same for the entire lifetime of the MA PDU Session.\nIf access performance measurements per QoS Flow is performed, Measurement Assistance Information contains MAC addresses for each QoS Flow and each access. When the UE sends PMF message over a QoS Flow of an access, the UE shall set the destination MAC address as the MAC address for the QoS Flow and the access in Measurement Assistance information.\n-\tThe PMF in the UPF sends PMF messages to the PMF in the UE over Ethernet. The Ethertype is the same Ethertype as the one provided in the Measurement Assistance Information. If access performance measurements are performed only over the QoS Flow associated with the default QoS rule, the source MAC address is one of the two MAC addresses as provided in the Measurement Assistance Information. One MAC address is used for sending PMF messages to UE over 3GPP access and the other MAC address is used for sending PMF messages to UE over non-3GPP access. The destination MAC address is the MAC address of the UE, which is contained in all PMF messages received from the UE.\nIf access performance measurements per QoS Flow is performed, when the UPF sends PMF message over a QoS Flow of an access, the UPF shall set the source MAC address with the MAC address for the QoS Flow and the access as the one for the QoS Flow and the access provided in Measurement Assistance information.\n-\tIf the UE receives Measurement Assistance Information, the UE shall inform the network via the user plane about the UE's MAC address so that it is possible for the UPF to know the UE's MAC address as soon as the MA PDU Session has been established.\nNOTE 2:\tRegardless of whether access performance measurements per QoS Flow is applied or not, the UE only use a single MAC address.\nRTT measurements can be conducted by the UE and UPF independently. There is no measurement reporting from one side to the other. RTT measurements are defined to support the \"Smallest Delay\", \"Priority-based\", \"Load Balancing\" or \"Redundant\" steering mode (i.e. when RTT threshold value is applied).\nThe estimation of the RTT by the UE and by the UPF is based on the following mechanism:\n1.\tThe PMF in the UE sends over the user plane PMF-Echo Request messages to the PMF in the UPF, and the PMF in the UPF responds to each one with a PMF-Echo Response message. Similarly, the PMF in the UPF sends over the user plane PMF-Echo Request messages to the PMF in the UE, and the PMF in the UE responds to each one with a PMF-Echo Response message.\n2.\tWhen the UP connection of the MA PDU session is deactivated on an access, no PMF-Echo Request messages are sent on this access. The PMF in the UPF shall not send PMF-Echo Request on this access if the UP connection is not available or after it receives notification from the (H-)SMF to stop sending the PMF-Echo Request on this access.\n3.\tThe UE and the UPF derive an estimation of the average RTT over an access type and QoS Flow by averaging the RTT measurements obtained over this access type and QoS Flow.\nThe UE and the UPF may decide to estimate the Packet Loss Rate (PLR) for an SDF over both accesses. For example, the UE may take this decision when an ATSSS rule in the UE requires the traffic of an SDF to be steered in accordance with a PLR-based threshold condition (e.g. PLR < 2%).\nThe UE and the UPF calculate the PLR for an SDF by exchanging PMF-PLR Report messages, as specified below. A PMF-PLR Report message is sent over 3GPP access or over non-3GPP access, using either the QoS Flow associated with the default QoS rule or a \"target\" QoS Flow, as specified in clause 5.32.5.1.\nThe calculation of the PLR by the UE and by the UPF is based on the following mechanism. It is assumed that the PLR should be calculated for a target QoS Flow, however, the same mechanism applies when the PLR should be calculated for the QoS Flow associated with the default QoS rule.\n-\tThe UE requests from UPF to start counting the number of received UL packets by sending a PMF-PLR Count Request message over the target QoS Flow. The UPF starts counting of the received UL packets over the target QoS Flow and over the access network which the PMF-PLR Count Request message was received from. The UE starts counting the transmitted UL packets over the target QoS Flow and access network when it sends a PMF-PLR Count Request message to UPF.\n-\tThe UE stops the counting and requests from UPF to report the number of counted UL packets by sending a PMF-PLR Report Request message over the target QoS Flow. The UPF stops the counting and sends a PMF-PLR Report Response message over the QoS Flow including the number of UL packets counted since it received the last PMF-PLR Count Request message.\nNOTE 1:\tA PMF-PLR Report Request message can also indicate to UPF to start counting packets if the UE wants to measure the Packet Loss Rate again.\n-\tThe UE calculates the UL packet loss ratio based on the local counting result of the number of transmitted UL packets and reported number of received UL packets in the UPF.\n-\tThe UPF applies the same procedure for calculating the DL PLR, i.e. it sends to UE a PMF-PLR Count Request message on a target QoS Flow to request from UE to start counting the number of DL packets received on this target QoS Flow. As defined in clause 5.32.5.1, the UE determines which DL packets are received on the target QoS Flow by checking the QFI included in the header of DL packets (e.g. in the SDAP header). If no QFI is included in the header of a DL packet, the UE determines the QFI for this DL packet by applying the Packet Filters for downlink in the QoS Rules received from SMF.\n-\tWhen the UP connection of the MA PDU session is deactivated on an access, no PMF-PLR messages are sent on this access. The PMF in the UPF shall not send PMF-PLR message on this access if the UP connection is not available or after it receives notification from the (H-)SMF to stop sending the PMF-PLR message on this access.\n-\tThe UE and the UPF derive an estimation of the average PLR per QoS Flow over an access type by averaging the PLR measurements obtained over this access.\nNOTE 2:\tThe details of the packet loss measurements, including error cases and mechanisms for improving the measurement accuracy, are considered in the Stage 3 specifications.\nIf required by the network in the Measurement Assistance Information, the UE shall provide access availability/unavailability reports to the network. How the UE detects the unavailability and the availability of an access is based on implementation. The CM state of a UE is not a factor when determining whether the 3GPP access is available. When the UE detects the unavailability/availability of an access, it shall:\n-\tbuild a PMF-Access Report containing the access type and an indication of availability/unavailability of this access;\n-\tsend the PMF-Access Report to the UPF via the user plane.\nThe UPF shall acknowledge the PMF-Access Report received from the UE.\nThe figure depicts a protocol stack for 3GPP access and an MA PDU Session with type IP, illustrating the measurements related to the UE/UPF.\nFigure 5.32.5.4-1: UE/UPF measurements related protocol stack for 3GPP access and for an MA PDU Session with type IP\nIn the case of an MA PDU Session with type Ethernet, the protocol stack over 3GPP access is that same as the one in the above figure, but the PMF protocol operates on top of Ethernet, instead of UDP/IP.\nThe figure depicts a protocol stack for an Untrusted non-3GPP access and an MA PDU Session with type IP, illustrating the measurements related to the protocol stack.\nFigure 5.32.5.4-2: UE/UPF measurements related protocol stack for Untrusted non-3GPP access and for an MA PDU Session with type IP\nIn the case of an MA PDU Session with type Ethernet, the protocol stack over Untrusted non-3GPP access is the same as the one in the above figure, but the PMF protocol operates on top of Ethernet, instead of UDP/IP.\nThe figure depicts a protocol stack for a Trusted non-3GPP access and an MA PDU Session with type IP, illustrating the measurements related to the protocol stack.\nFigure 5.32.5.4-3: UE/UPF measurements related protocol stack for Trusted non-3GPP access and for an MA PDU Session with type IP\nIn the case of an MA PDU Session with type Ethernet, the protocol stack over Trusted non-3GPP access is the same as the one in the above figure, but the PMF protocol operates on top of Ethernet, instead of UDP/IP.\nWhen UE-assistance operation is authorized by the PCF in the PCC Rule, the SMF provides an indication for UE-assistance in the ATSSS Rule to the UE, as described in clause 5.32.8, and in the MAR to the UPF, as described in clause 5.8.5.8.\nIf the UE receives the UE-assistance indicator in an ATSSS rule (as specified in clause 5.32.8) and the UE decides to apply a different UL traffic distribution for an SDF than the default UL traffic distribution indicated in the Steering Mode component of the ATSSS rule (e.g. because the UE is running out of battery), then the following applies:\n-\tThe UE may apply any split percentages for the UL traffic distribution of an SDF, based on implementation specific criteria.\n-\tThe UE may send a PMF-UAD (UE Assistance Data) message to UPF that contains the split percentages that may be used by UPF for all DL traffic that the UE-assistance operation applies. The UPF acknowledges the reception of the PMF-UAD message by sending a PMF-UAD complete message to the UE.\nNOTE:\tIf the UE has multiple ATSSS rules that allow UE-assistance operation, and the UE decides to use different UL split percentages for their respective SDFs, then the split percentages included in the PMF-UAD message are selected by the UE based on implementation specific criteria.\n-\tThe UPF may apply the information in a received PMF-UAD message to align the DL traffic distribution for traffic that is allowed to use UE-assistance operation, i.e. traffic where the MAR contains a Steering Mode Indicator set to UE-assistance operation.\n-\tIf the UE decides to terminate the UE assistance operation, the UE may send a PMF-UAT (UE Assistance Termination) message to the UPF indicating that the UE assistance operation is terminated and the UE performs the UL traffic distribution according to the split percentages in the ATSSS rule received from the network. If the UPF receives the PMF-UAT message, the UPF acknowledges the reception by sending a PMF-UAT complete message and performs DL traffic distribution by applying the split percentages included in the MAR.\nAs part of the Redundant Steering Mode, a UPF can decide to suspend traffic duplication for a UE by sending PMF- Suspend Duplication Request message to the UE. How the UPF determines to suspend traffic duplication is implementation specific.\nNOTE 1:\tThe Suspension of traffic duplication can be caused by e.g. the locally detected UPF congestion. In that way the UPF can stop receiving duplicated traffic via 3GPP and non-3GPP access network simultaneously.\nThe UPF may indicate in the PMF-Suspend Duplication Request message the type of traffic (i.e. GBR or non-GBR) for which traffic duplication is being suspended. The PMF-Suspend Duplication Request message is sent over the user plane of any available access network of the MA PDU Session. Once the UE receives the PMF-Suspend Duplication Request message from the UPF, the UE shall stop duplicating the type of traffic for which traffic duplication is suspended.\nIf the UPF does not provide the type of traffic (GBR or non-GBR) in the PMF-Suspend Duplication Request message, traffic duplication is suspended for all traffic for which traffic duplication is being performed. Once UPF suspended traffic duplication and if no Primary Access is configured, both the UE and the UPF decide, based on their own implementation, which access network to use for sending UL and DL traffic. If the Primary Access is configured, both the UE and the UPF use the Primary Access for sending UL and DL traffic.\nThe UPF may decide to resume traffic duplication for a UE by sending the PMF-Resume Duplication Request message. How the UPF determines to resume traffic duplication is implementation specific.\nNOTE 2:\tTraffic duplication can be resumed e.g. when the UPF has detected that local congestion has diminished.\nOnce the UE receives the PMF-Resume Duplication Request message from the UPF, the UE may restart to duplicate the type of traffic for which traffic duplication is resumed based on the provided Redundant steering mode policies and UE implementation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.6\tSupport of Steering Functionalities",
                            "text_content": "The functionality in an ATSSS-capable UE that can steer, switch and split the MA PDU Session traffic across 3GPP access and non-3GPP access, is called a \"steering functionality\". An ATSSS-capable UE may support one or more of the following types of steering functionalities:\n-\tHigh-layer steering functionalities, which operate above the IP layer:\n-\tIn this release of the specification, two high-layer steering functionalities are vspecified:\n-\tThe first applies the MPTCP protocol (IETF RFC 8684 [81]) and is called \"MPTCP functionality\" (see clause 5.32.6.2.1). This steering functionality can be applied to steer, switch and split the TCP traffic flows identified in the ATSSS/N4 rules. The MPTCP functionality in the UE may communicate with an associated MPTCP Proxy functionality in the UPF, by using the MPTCP protocol over the 3GPP and/or the non-3GPP user plane.\n-\tThe second applies the QUIC protocol (RFC 9000 [166], RFC 9001 [167], RFC 9002 [168]) and its multipath extensions (draft-ietf-quic-multipath [174]), and it is called \"MPQUIC functionality\" (see clause 5.32.6.2.2). This steering functionality can be applied to steer, switch and split the UDP traffic flows identified in the ATSSS/N4 rules. The MPQUIC functionality in the UE may communicate with an associated MPQUIC Proxy functionality in the UPF, by using the QUIC protocol and its multipath extensions over the 3GPP and/or the non-3GPP user plane.\n-\tLow-layer steering functionalities, which operate below the IP layer:\n-\tOne type of low-layer steering functionality defined in the present document is called \"ATSSS Low-Layer functionality\", or ATSSS-LL functionality (see clause 5.32.6.3.1). This steering functionality can be applied to steer, switch and split all types of traffic, including TCP traffic, UDP traffic, Ethernet traffic, etc. ATSSS-LL functionality is mandatory for MA PDU Session of type Ethernet. In the network, there shall be in the data path of the MA PDU session one UPF supporting ATSSS-LL.\nNOTE:\tFilters used in ATSSS rules related with a MA PDU Session of type Ethernet can refer to IP level parameters such as IP addresses and TCP/UDP ports.\nThe UE indicates to the network its supported steering functionalities and steering modes by including in the UE ATSSS Capability one of the following:\n1)\tATSSS-LL functionality with any steering mode.\nIn this case, the UE indicates that it is capable to steer, switch and split all traffic of the MA PDU Session by using the ATSSS-LL functionality with any steering mode allowed for ATSSS-LL, as specified in clause 5.32.8.\n2)\tMPTCP functionality with any steering mode and ATSSS-LL functionality with only Active-Standby steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPTCP traffic of the MA PDU Session by using the MPTCP functionality with any steering mode specified in clause 5.32.8; and\nb)\tit is capable to steer and switch all other traffic (i.e. the non-MPTCP traffic) of the MA PDU Session by using the ATSSS-LL functionality with the Active-Standby steering mode specified in clause 5.32.8.\n3)\tMPTCP functionality with any steering mode and ATSSS-LL functionality with any steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPTCP traffic of the MA PDU Session by using the MPTCP functionality with any steering mode specified in clause 5.32.8; and\nb)\tit is capable to steer, switch and split all other traffic (i.e. the non-MPTCP traffic) of the MA PDU Session by using the ATSSS-LL functionality with any steering mode, as specified in clause 5.32.8.\n4)\tMPQUIC functionality with any steering mode and ATSSS-LL functionality with only Active-Standby steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPQUIC traffic of the MA PDU Session by using the MPQUIC functionality with any steering mode specified in clause 5.32.8; and\nb)\tit is capable to steer and switch all other traffic (i.e. the non-MPQUIC traffic) of the MA PDU Session by using the ATSSS-LL functionality with the Active-Standby steering mode specified in clause 5.32.8.\n5)\tMPQUIC functionality with any steering mode and ATSSS-LL functionality with any steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPQUIC traffic of the MA PDU Session by using the MPQUIC functionality with any steering mode specified in clause 5.32.8; and\nb)\tit is capable to steer, switch and split all other traffic (i.e. the non-MPQUIC traffic) of the MA PDU Session by using the ATSSS-LL functionality with any steering mode that can be used with ATSSS-LL, as specified in clause 5.32.8.\n6)\tMPTCP functionality with any steering mode, MPQUIC functionality with any steering mode, and ATSSS-LL functionality with only Active-Standby steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPTCP traffic of the MA PDU Session by using the MPTCP functionality with any steering mode specified in clause 5.32.8;\nb)\tit is capable to steer, switch and split the MPQUIC traffic of the MA PDU Session by using the MPQUIC functionality with any steering mode specified in clause 5.32.8; and\nc)\tit is capable to steer and switch all other traffic (i.e. the non-MPTCP traffic and the non-MPQUIC traffic) of the MA PDU Session by using the ATSSS-LL functionality with the Active-Standby steering mode specified in clause 5.32.8.\n7)\tMPTCP functionality with any steering mode, MPQUIC functionality with any steering mode, and ATSSS-LL functionality with any steering mode.\nIn this case, the UE indicates that:\na)\tit is capable to steer, switch and split the MPTCP traffic of the MA PDU Session by using the MPTCP functionality with any steering mode specified in clause 5.32.8;\nb)\tit is capable to steer, switch and split the MPQUIC traffic of the MA PDU Session by using the MPQUIC functionality with any steering mode specified in clause 5.32.8; and\nc)\tit is capable to steer, switch and split all other traffic (i.e. the non-MPTCP traffic and the non-MPQUIC traffic) of the MA PDU Session by using the ATSSS-LL functionality with any steering mode that can be used with ATSSS-LL, as specified in clause 5.32.8.\n\nThe above steering functionalities are schematically illustrated in the Figure 5.32.6.1-1, which shows an example model for an ATSSS-capable UE supporting the MPTCP functionality, the MPQUIC functionality and the ATSSS-LL functionality. The MPTCP flows and the MPQUIC flows in this figure represent the traffic of the applications for which MPTCP can be applied and for which MPQUIC can be applied respectively. The five different IP addresses illustrated in the UE are further described in clause 5.32.6.2.1 and in clause 5.32.6.2.2. When the MPTCP functionality and the MPQUIC functionality are both applied, the addresses (IP@1, IP@2) used for MPTCP may be the same as the addresses (IP@4, IP@5) used for MPQUIC. The \"Low-Layer\" in this figure contains functionality that operates below the IP layer (e.g. different network interfaces in the UE), while the \"High-Layer\" contains functionality that operates above the IP layer.\nThe figure depicts a UE model with steering functionalities, illustrating how the UE can adjust its steering angle to optimize signal reception and avoid interference. The figure includes various components such as the steering wheel, steering angle, and steering angle sensor, which are essential for the UE to make informed decisions about steering angle adjustments. The figure also highlights the importance of steering angle in ensuring signal reception and avoiding interference, as well as the role of the steering wheel in providing tactile feedback to the UE.\nFigure 5.32.6.1-1: Steering functionalities in an example UE model\nWithin the same MA PDU Session in the UE, it is possible to steer the MPTCP flows by using the MPTCP functionality, to steer the MPQUIC flows by using the MPQUIC functionality and, simultaneously, to steer all other flows by using the ATSSS-LL functionality. For the same packet flow, only one steering functionality shall be used.\nAll steering functionalities in the UE shall take ATSSS decisions (i.e. decide how to steer, switch and split the traffic) by using the same set of ATSSS rules. Similarly, all ATSSS decisions in the UPF shall be taken by applying the same set of N4 rules, which support ATSSS. The ATSSS rules and the N4 rules supporting ATSSS are provisioned in the UE and in the UPF respectively, when the MA PDU Session is established.\nIf the UE supports multiple steering functionalities, e.g. both the MPTCP functionality and the ATSSS-LL functionality, or the MPTCP functionality, the MPQUIC functionality and the ATSSS-LL functionality, it shall use the provisioned ATSSS rules (see TS 23.503 [45]) to decide which steering functionality to apply for a specific packet flow.\nAs mentioned in clause 5.32.6.1, the MPTCP functionality in the UE applies the MPTCP protocol (IETF RFC 8684 [81]) and the provisioned ATSSS rules for performing access traffic steering, switching and splitting. The MPTCP functionality in the UE may communicate with the MPTCP Proxy functionality in the UPF using the user plane of the 3GPP access, or the non-3GPP access, or both.\nThe MPTCP functionality may be enabled in the UE when the UE provides an \"MPTCP capability\" during PDU Session Establishment procedure.\nThe network shall not enable the MPTCP functionality when the type of the MA PDU Session is Ethernet.\nIf the UE indicates it is capable of supporting the MPTCP functionality, as described in clause 5.32.2, and the network agrees to enable the MPTCP functionality for the MA PDU Session then:\ni)\tAn associated MPTCP Proxy functionality is enabled in the UPF for the MA PDU Session by MPTCP functionality indication received in the Multi-Access Rules (MAR).\nii)\tThe network allocates to UE one IP address/prefix for the MA PDU Session and two additional IP addresses/prefixes, called \"MPTCP link-specific multipath\" addresses/prefixes; one associated with 3GPP access and another associated with the non-3GPP access. In the UE, these two IP addresses/prefixes are used only by the MPTCP functionality. Each \"MPTCP link-specific multipath\" address/prefix assigned to UE may not be routable via N6. The MPTCP functionality in the UE and the MPTCP Proxy functionality in the UPF shall use the \"MPTCP link-specific multipath\" addresses/prefixes for subflows over non-3GPP access and over 3GPP access and MPTCP Proxy functionality shall use the IP address/prefix of the MA PDU session for the communication with the final destination. In Figure 5.32.6.1-1, the IP@3 corresponds to the IP address of the MA PDU Session and the IP@1 and IP@2 correspond to the \"MPTCP link-specific multipath\" IP addresses. The following UE IP address management applies:\n-\tThe MA PDU IP address/prefix shall be provided to the UE via mechanisms defined in clause 5.8.2.2.\n-\tThe \"MPTCP link-specific multipath\" IP addresses/prefixes shall be allocated by the UPF and shall be provided to the UE via SM NAS signalling.\nNOTE 1:\tAfter the MA PDU Session is released, the same UE IP addresses/prefixes are not allocated to another UE for MA PDU Session in a short time.\nNOTE 2:\tThe act of the UPF performing translation on traffic associated with the \"MPTCP link-specific multipath\" addresses to/from the MA PDU session IP address can lead to TCP port collision and exhaustion. The port collision can potentially occur because the UE also uses the MA PDU session IP address for non-MPTCP traffic, and this causes the port namespace of such address to be owned simultaneously by the UE and UPF. In addition, the port exhaustion can potentially occur when the UE creates a large number of flows, because multiple IP addresses used by the UE are mapped to a single MA PDU session IP address on the UPF. The UPF needs to consider these problems based on the UPF implementation, and avoid them by, for example, using additional N6-routable IP addresses for traffic associated to the link-specific multipath addresses/prefixes. How this is done is left to the implementation.\niii)\tThe network shall send MPTCP proxy information to UE, i.e. the IP address, a port number and the type of the MPTCP proxy. The following type of MPTCP proxy shall be supported in this release:\n-\tType 1: Transport Converter, as defined in IETF RFC 8803 [82].\nThe MPTCP proxy information is retrieved by the SMF from the UPF during N4 session establishment.\nThe UE shall support the client extensions specified in IETF RFC 8803 [82].\niv)\tThe network may indicate to UE the list of applications for which the MPTCP functionality should be applied. This is achieved by using the Steering Functionality component of an ATSSS rule (see clause 5.32.8).\nNOTE 3:\tTo protect the MPTCP proxy function (e.g. to block DDOS to the MPTCP proxy function), the IP addresses of the MPTCP Proxy Function are only accessible from the two \"MPTCP link-specific multipath\" IP addresses of the UE via the N3/N9 interface.\nv)\tWhen the UE indicates it is capable of supporting the MPTCP functionality with any steering mode and the ATSSS-LL functionality with only the Active-Standby steering mode (as specified in clause 5.32.6.1) and these functionalities are enabled for the MA PDU Session, then the UE shall route via the MA PDU Session the TCP traffic of applications for which the MPTCP functionality should be applied (i.e. the MPTCP traffic), as defined in bullet iv. The UE may route all other traffic (i.e. the non-MPTCP traffic) via the MA PDU Session, but this type of traffic shall be routed on one of 3GPP access or non-3GPP access, based on the received ATSSS rule for non-MPTCP traffic (see clause 5.32.2). The UPF shall route all other traffic (i.e. non-MPTCP traffic) based on the N4 rules provided by the SMF. This may include N4 rules for ATSSS-LL, using any steering mode as instructed by the N4 rules.\nThe MPQUIC functionality enables steering, switching, and splitting of UDP traffic between the UE and UPF, in accordance with the ATSSS policy created by the network. The operation of the MPQUIC functionality is based on RFC 9298 [170] \"proxying UDP in HTTP\", which specifies how UDP traffic can be transferred between a client (UE) and a proxy (UPF) using the RFC 9114 [171] HTTP/3 protocol. The HTTP/3 protocol operates on top of the QUIC protocol (RFC 9000 [166], RFC 9001 [167] , RFC 9002 [168]), which supports simultaneous communication over multiple paths, as defined in draft-ietf-quic-multipath [174].\nThe MPQUIC functionality in the UE communicates with the MPQUIC Proxy functionality in the UPF (see Figure 4.2.10-1) using the user plane of the 3GPP access, or the non-3GPP access, or both.\nThe MPQUIC functionality may be enabled for an MA PDU Session with type IPv4, IPv6 or IPv4v6, when both the UE and the network support this functionality. The MPQUIC functionality shall not be enabled when the type of the MA PDU Session is Ethernet.\nThe MPQUIC functionality is composed of three components:\n1)\tQoS flow selection & Steering mode selection: This component in the UE initiates the establishment of one or more multipath QUIC connections, after the establishment of the MA PDU Session and, for each uplink UDP flow, it selects a QoS flow (based on the QoS rules), a steering mode and a transport mode (based on the ATSSS rules). This component in the UPF selects, for each downlink UDP flow, a QoS flow (based on the N4 rules), a steering mode and a transport mode (based on the N4 rules). The supported transport modes are defined below.\nIn the UE, this component is only used in the uplink direction, while, in the UPF, this component is only used in the downlink direction.\n2)\tHTTP/3 layer: Supports the HTTP/3 protocol defined in RFC 9114 [171] and the extensions defined in:\n-\tRFC 9298 [170] for supporting UDP proxying over HTTP;\n-\tRFC 9297 [172] for supporting HTTP datagrams; and\n-\tRFC 9220 [173] for supporting Extended CONNECT.\nThe HTTP/3 layer selects a multipath QUIC connection to be used for each UDP flow and allocates a new QUIC stream on this connection that is associated with the UDP flow. It also configures this QUIC stream to apply a specific steering mode.\nIn the UE, the HTTP/3 layer implements an HTTP/3 client, while, in the UPF, it implements an HTTP/3 proxy.\n3)\tQUIC layer: Supports the QUIC protocol as defined in the applicable IETF specifications (RFC 9000 [166], RFC 9001 [167], RFC 9002 [168]) and the extensions defined in:\n-\tRFC 9221 [169] for supporting unreliable datagram transport with QUIC; and\n-\tdraft-ietf-quic-multipath [174] for supporting QUIC connections using multiple paths simultaneously.\nWhen the MPQUIC functionality is applied, the protocol stack of the user plane is depicted in figure below.\nThe given telecommunication figure depicts a network architecture with various components, including base stations (gNB), user equipment (UE), and scatterers. The figure illustrates the signal propagation in a 5G network, highlighting the multi-path signal path and beamforming techniques to mitigate interference. The diagram also shows the fiber-optic backbone architecture, with core switches, optical line terminals (OLTs), and distributed nodes. The layered design aligns with SDN principles, demonstrating redundancy paths and failover reliability.\nFigure 5.32.6.2.2-1: UP protocol stack when the MPQUIC functionality is applied\nEditor's note:\tThe above figure might need changes (e.g. related with the mandatory use of TLS) based on the security work in SA WG3.\nIf the UE indicates that it is capable of supporting the MPQUIC functionality, as described in clause 5.32.2, and the network agrees to enable the MPQUIC functionality for the MA PDU Session then:\ni)\tAn associated MPQUIC Proxy functionality is enabled in the UPF for the MA PDU Session.\nii)\tThe network allocates to UE one IP address/prefix for the MA PDU Session and two additional IP addresses/prefixes, called \"MPQUIC link-specific multipath \" addresses/prefixes; one associated with 3GPP access and another associated with the non-3GPP access. In the UE, these two IP addresses/prefixes are used only by the MPQUIC functionality. Each \"MPQUIC link-specific multipath\" address/prefix assigned to UE may not be routable via N6. The MPQUIC functionality in the UE and the MPQUIC Proxy functionality in the UPF shall use the \"MPQUIC link-specific multipath\" addresses/prefixes for transmitting UDP flows over non-3GPP access and over 3GPP access. The MPQUIC Proxy functionality shall use the IP address/prefix of the MA PDU session for the communication with the final destination. In Figure 5.32.6.1-1, the IP@3 corresponds to the IP address of the MA PDU Session and the IP@4 and IP@5 correspond to the \"MPQUIC link-specific multipath\" addresses. The following UE IP address management applies:\n-\tThe MA PDU IP address/prefix shall be provided to the UE via mechanisms defined in clause 5.8.2.2.\n-\tThe \"MPQUIC link-specific multipath\" IP addresses/prefixes shall be allocated by the UPF and shall be provided to the UE via SM NAS signalling.\nNOTE 1:\tAfter the MA PDU Session is released, the same UE IP addresses/prefixes are not allocated to another UE for MA PDU Session in a short time.\niii)\tThe network shall send MPQUIC proxy information to UE, i.e. one IP address of UPF, one UDP port number and the proxy type (e.g. \"connect-udp\"). This information is used by the UE for establishing multipath QUIC connections with the UPF, which implements the MPQUIC Proxy functionality.\niv)\tAfter the MA PDU Session is established, the UE determines the number of multipath QUIC connections to be established with the UPF. The UE determines to establish at least as many multipath QUIC connections as the number of QoS flows of the MA PDU Session, i.e. one multipath QUIC connection per QoS flow. Each multipath QUIC connection carries the UDP traffic mapped to a single QoS flow.\nFor the downlink traffic to which the MPQUIC functionality is to be applied, the QoS rules provided to UE include downlink QoS information and the UE applies the downlink QoS information to establish multipath QUIC connections for the QoS flows used for the downlink traffic only.\nv)\tDuring a QUIC connection establishment, the UE and UPF negotiate QUIC transport parameters and indicate (a) support of QUIC Datagram frames and (b) support of multipath. They indicate support of QUIC Datagram frames by providing the \"max_datagram_frame_size\" transport parameter with a non-zero value (see RFC 9221 [169]) and they indicate support of multipath by providing the \"enable_multipath\" transport parameter (see draft-ietf-quic-multipath [174]).\nIn addition, during a QUIC connection establishment the QoS flow associated with this connection is determined. The UE sends all traffic of a QUIC connection over the QoS flow associated with this QUIC connection. This enables the UPF to determine the QoS flow associated with a QUIC connection and to select a QUIC connection for sending the downlink traffic of a QoS flow.\nvi)\tAfter a QUIC connection establishment, the HTTP/3 client in the UE and the HTTP/3 proxy in the UPF negotiate HTTP settings and indicate support of HTTP Datagrams (see RFC 9297 [172]) and support of Extended CONNECT (see RFC 9220 [173]). To use MPQUIC proxying for a UDP traffic flow, the UE then sends a HTTP/3 CONNECT request (see RFC 9298 [170]) to the HTTP/3 proxy in the UPF.\nvii) The network may indicate to UE the list of applications for which the MPQUIC functionality should be applied. This is achieved by using the Steering Functionality component of an ATSSS rule (see clause 5.32.8).\n5.32.6.2.2.1\tSupported Transport Modes\nThe MPQUIC functionality supports the following transport modes for transmitting a UDP flow between UE and UPF. The PCF selects which of these transport modes shall be applied for a UDP flow (SDF). The selected transport mode is provided to UE and UPF within the ATSSS rules and N4/MAR rules respectively.\n-\tDatagram mode 2: This transport mode is the mode defined in RFC 9298 [170]. It encapsulates UDP packets within QUIC Datagram frames and provides unreliable transport with no sequence numbering and no packet reordering / deduplication.\n-\tDatagram mode 1: This transport mode is an extension of the mode defined in RFC 9298 [170]. It encapsulates UDP packets within QUIC Datagram frames and provides unreliable transport but with sequence numbering and with packet reordering / deduplication. It can be applied for any UDP flow. The details of the datagram mode 1, including the potential use of a Context ID (see RFC 9298 [170]), are considered in stage-3 specifications.\nEditor's note:\tA reference to the applicable stage-3 specification needs to be added to the above paragraph, to point to the stage-3 details of Datagram mode 1.\n-\tStream mode: This transport mode is readily supported by the QUIC protocol. It encapsulates UDP packets within QUIC Stream frames and provides reliable transport with sequence numbering and with packet reordering / deduplication. It can be applied for UDP flows where it is known that the application does not perform retransmissions.\nNOTE 1:\tThe Stream mode provides strict reliability and in-order delivery with re-transmissions and therefore can lead to melt down phenomena when reliable traffic (e.g. QUIC) is carried, or counteracts application decisions when UDP is selected to avoid reliability and/or in-order delivery. Therefore, it can be avoided for applications which perform their own reliability mechanisms.\nNOTE 2:\tWhen a steering mode is supported by ATSSS-LL for a UDP flow (e.g. Active-Standby), the MPQUIC steering functionality can be selected if additional features, which are not supported by the ATSSS-LL steering functionality and PMF, are required for the traffic steering/switching/splitting of the UDP flow.\nThe ATSSS-LL functionality in the UE does not apply a specific protocol. It is a data switching function, which decides how to steer, switch and split the uplink traffic across 3GPP and non-3GPP accesses, based on the provisioned ATSSS rules and local conditions (e.g. signal loss conditions). The ATSSS-LL functionality in the UE may be applied to steer, switch and split all types of traffic, including TCP traffic, UDP traffic, Ethernet traffic, etc. The ATSSS-LL functionality does not support the Redundant Steering Mode.\nThe ATSSS-LL functionality may be enabled in the UE when the UE provides an \"ATSSS-LL capability\" during the PDU Session Establishment procedure.\nThe ATSSS-LL functionality is mandatory in the UE for MA PDU Session of type Ethernet. In addition:\n-\tWhen the UE neither supports the MPTCP functionality nor the MPQUIC functionality, the ATSSS-LL functionality is mandatory in the UE for an MA PDU Session of type IP.\n-\tWhen the UE supports the MPTCP functionality and does not support the MPQUIC functionality, the ATSSS-LL functionality with Active-Standby Steering Mode is mandatory in the UE for an MA PDU Session of type IP to support non-MPTCP traffic.\n-\tWhen the UE supports the MPQUIC functionality and does not support the MPTCP functionality, the ATSSS-LL functionality with Active-Standby Steering Mode is mandatory in the UE for an MA PDU Session of type IP to support non-MPQUIC traffic.\n-\tWhen the UE supports both the MPTCP functionality and the MPQUIC functionality, the ATSSS-LL functionality with Active-Standby Steering Mode is mandatory in the UE for an MA PDU Session of type IP to support non-MPTCP and non-MPQUIC traffic.\nThe network shall also support the ATSSS-LL functionality as defined for the UE. The ATSSS-LL functionality in the UPF is enabled for a MA PDU Session by ATSSS-LL functionality indication received in the Multi-Access Rules (MAR).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.7\tInterworking with EPS",
                            "text_content": "Multi-access connectivity using ATSSS via EPC only is not supported.\nInterworking for MA PDU Session, if allowed by the network, is based on the interworking functionality specified in clause 5.17.2, with the differences and clarifications described in the following clauses.\nA PDN Connection in EPS may be modified into a MA PDU Session when transferred to 5GS if the UE and the SMF+PGW-C support the ATSSS feature.\nInterworking with N26 interface is based on clause 5.17.2.2, with the following differences and clarifications:\n-\tWhen the UE is registered to the same PLMN over 3GPP and non-3GPP accesses, and the UE request a new MA PDU Session via non-3GPP access, the AMF also includes the indication of interworking with N26 to SMF.\n-\tThe SMF does not request EBI allocation when MA PDU Session is established only over non-3GPP access. If MA PDU Session is released over 3GPP access, the allocated EBI(s) for the MA PDU Session is revoked by the SMF as described in clause 4.11.1.4.3 of TS 23.502 [3].\n-\tThe SMF does not request EBI allocation for GBR QoS Flow if the GBR QoS Flow is only allowed over non-3GPP access.\n-\tIf the UE and the network support MA PDU Sessions with 3GPP access connected to EPC, the MA PDU Session may be simultaneously associated with user-plane resources on 3GPP access network connected to EPC and with non-3GPP access network connected to 5GC. This case is further described in clause 5.32.1 and in clause 4.22.2.3 of TS 23.502 [3].\n-\tIf the UE or the network does not support MA PDU Session with 3GPP access connected to EPC, the MA PDU Session is handled as follows:\n-\tWhen UE moves from 5GS to EPS, for both idle mode and connected mode mobility, if the MA PDU Session is moved to EPS as a PDN connection, the SMF triggers PDU Session Release procedure to release the MA PDU Session over Non-3GPP access in 5GS. UE and SMF remove ATSSS related contexts e.g. ATSSS rules, Measurement Assistance Information.\n-\tWhen UE moves from 5GS to EPS, for both idle mode and connected mode mobility, if the MA PDU Session is not moved to EPS as a PDN connection, the 3GPP access of this MA PDU session becomes unavailable and the AMF notifies the SMF. In turn, the SMF may decide to move the traffic to Non-3GPP access of the MA PDU session, if it is available. When UE moves back from EPS to 5GS, after the UE is registered over the 3GPP, the UE may add user-plane resources over the 3GPP access to the MA PDU session by triggering PDU Session Establishment procedure as specified in clause 5.32.2.\n-\tAfter UE moves from EPS to 5GS, for both idle mode and connected mode mobility, if the UE requires MA PDU session, or if no policy in the UE (e.g. no URSP rule) and no local restrictions mandate a single access for the PDU Session, UE triggers the PDU Session Modification procedure as described in clause 4.22.6.3 of TS 23.502 [3] to provide the ATSSS Capability to SMF+PGW-C. The SMF+PGW-C may determine whether to modify this PDU Session to a MA PDU Session in 5GS, e.g. based on SMF+PGW-C and UE's ATSSS Capability, subscription data and local policy. If dynamic PCC is to be used for the MA PDU Session, the PCF decides whether the MA PDU session is allowed or not based on operator policy and subscription data. If the MA PDU Session is allowed, the SMF provides ATSSS rule(s) and Measurement Assistance Information to the UE. If the UE receives ATSSS rules and is not registered to non-3GPP access, the UE establishes the second user-plane over non-3GPP access after the UE is registered to non-3GPP access. If UE was registered to non-3GPP access in 5GS, the UP resources over non-3GPP access are also established by the SMF using the PDU Session Modification procedure.\nInterworking without N26 interface is based on clause 5.17.2.3, with the following differences and clarifications:\n-\tAfter UE moves from 5GS to EPS, UE may send a PDN Connectivity Request with \"handover\" indication to transfer the MA PDU Session to EPS. Then, if the UE or the network does not support MA PDU Session with 3GPP access connected to EPC, the SMF+PGW-C triggers to release MA PDU in 5GS. If UE does not transfer the MA PDU Session to EPS, UE keeps the MA PDU Session in 5GS. If the UE and the network support MA PDU Session with 3GPP access connected to EPC, the UE includes a \"handover\" indication and a \"MA PDU Request\" indication as well as the PDU Session ID in the PCO and the SMF+PGW-C keeps the user-plane resources over non-3GPP access in 5GC as described in clause 4.22.6.2.5 of TS 23.502 [3]. In this case, UE may report to UPF that 3GPP access is unavailable, all MA PDU Session traffic is transported over N3GPP access. Later, if UE returns to 5GS, UE may report the 3GPP access availability to UPF.\n-\tAfter UE moves from EPS to 5GS, UE may trigger PDU Session Establishment procedure to transfer the PDN Connection to 5GS. During the PDU Session Establishment procedure, if the PDN Connection was not used as the 3GPP access leg of the MA PDU Session, the UE may request to establish a MA PDU Session by including \"MA PDU Request\" or, if no policy in the UE (e.g. no URSP rule) and no local restrictions mandate a single access for the PDU Session, the UE may include the \"MA PDU Network-Upgrade Allowed\" indication.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.32.8\tATSSS Rules",
                            "text_content": "As specified in clause 5.32.3, after the establishment of a MA PDU Session, the UE receives a prioritized list of ATSSS rules from the SMF. The structure of an ATSSS rule is specified in Table 5.32.8-1.\nTable 5.32.8-1: Structure of ATSSS Rule\n\nThe UE evaluates the ATSSS rules in priority order.\nEach ATSSS rule contains a Traffic Descriptor (containing one or more components described in Table 5.32.8-1) that determines when the rule is applicable. An ATSSS rule is determined to be applicable when every component in the Traffic Descriptor matches the considered service data flow (SDF).\nDepending on the type of the MA PDU Session, the Traffic Descriptor may contain the following components (the details of the Traffic Descriptor generation are described in clause 5.32.3):\n-\tFor IPv4, or IPv6, or IPv4v6 type: Application descriptors and/or IP descriptors.\n-\tFor Ethernet type: Application descriptors and/or Non-IP descriptors.\nOne ATSSS rule with a \"match all\" Traffic Descriptor may be provided, which matches all SDFs. When provided, it shall have the least Rule Precedence value, so it shall be the last one evaluated by the UE.\nNOTE 1:\tThe format of the \"match all\" Traffic descriptor of an ATSSS rule is defined in stage-3.\nEach ATSSS rule contains an Access Selection Descriptor that contains the following components:\n-\tA Steering Mode, which determines how the traffic of the matching SDF should be distributed across 3GPP and non-3GPP accesses. The following Steering Modes are supported:\n-\tActive-Standby: It is used to steer a SDF on one access (the Active access), when this access is available, and to switch the SDF to the available other access (the Standby access), when Active access becomes unavailable. When the Active access becomes available again, the SDF is switched back to this access. If the Standby access is not defined, then the SDF is only allowed on the Active access and cannot be transferred on another access.\n-\tSmallest Delay: It is used to steer a SDF to the access that is determined to have the smallest Round-Trip Time (RTT). As defined in clause 5.32.5, measurements may be obtained by the UE and UPF to determine the RTT over 3GPP access and over non-3GPP access. In addition, if one access becomes unavailable, all SDF traffic is switched to the other available access. It can only be used for the Non-GBR SDF.\n-\tLoad-Balancing: It is used to split a SDF across both accesses if both accesses are available. It contains the percentage of the SDF traffic that should be sent over 3GPP access and over non-3GPP access. Load-Balancing is only applicable to Non-GBR SDF. In addition, if one access becomes unavailable, all SDF traffic is switched to the other available access, as if the percentage of the SDF traffic transported via the available access was 100%.\n-\tPriority-based: It is used to steer all the traffic of an SDF to the high priority access, until this access is determined to be congested. In this case, the traffic of the SDF is sent also to the low priority access, i.e. the SDF traffic is split over the two accesses. In addition, when the high priority access becomes unavailable, all SDF traffic is switched to the low priority access. How UE and UPF determine when a congestion occurs on an access is implementation dependent. It can only be used for the Non-GBR SDF.\n-\tRedundant (without Threshold Values): It is used to duplicate traffic of an SDF on both accesses if both accesses are available. A Primary Access (either 3GPP access or Non-3GPP access) may be provided to the UE in the ATSSS rules and to the UPF in the N4 rules. If a Primary Access is provided, UE and UPF shall send all data packets of the SDF on the Primary Access and may duplicate data packets of the SDF on the other access. How many and which data packets are duplicated by UE and UPF on the other access is based on implementation. If the Primary Access is not provided to UE and UPF, the UE and UPF shall send all data packets of the SDF on both accesses. It can be used for GBR and Non-GBR SDF.\n-\tA Steering Mode Indicator, which indicates that the UE may change the default steering parameters provided in the Steering Mode component and may adjust the traffic steering based on its own decisions. Only one of the following Steering Mode Indicators may be provided:\n-\tAutonomous load-balance indicator: This indicator may be provided only when the Steering Mode is Load-Balancing. When provided, the UE may ignore the percentages in the Steering Mode component (i.e. the default percentages provided by the network) and may autonomously determine its own percentages for traffic splitting, in a way that maximizes the aggregated bandwidth in the uplink direction. The UE is expected to determine its own percentages for traffic splitting by performing measurements across the two accesses. The UPF may apply a similar behaviour when the autonomous load-balance indicator is included in an N4 rule.\n-\tUE-assistance indicator: This indicator may be provided only when the Steering Mode is Load-Balancing. When provided by the network, it indicates that (a) the UE may decide how to distribute the UL traffic of the matching SDF based on the UE's internal state (e.g. when the UE is in the special internal state, e.g. lower battery level), and that (b) the UE may inform the UPF how it decided to distribute the UL traffic of the matching SDF. In the normal cases, although with this indicator provided, the UE shall distribute the UL traffic as indicated by the network.\nNOTE 2:\tTypically, the UE-assistance indicator can be provided for SDFs for which the network has no strong steering requirements. For example, when the network has no strong steering requirements for the default traffic of an MA PDU Session, the network can indicate (i) that this traffic must be steered with Load-Balancing steering mode using 50% - 50% split percentages, and (ii) that the UE is allowed to use other split percentages, such as 0% - 100%, if this is needed by the UE to optimize its operation (e.g. to minimize its battery consumption).\n-\tThreshold Values: One or more threshold values may be provided when the Steering Mode is Priority-based or when the Steering Mode is Load-Balancing with fixed split percentages (i.e. without the Autonomous load-balance indicator or UE assistance indicator). One threshold value may be provided when the Steering Mode is Redundant. A threshold value may be either a value for RTT or a value for Packet Loss Rate. The threshold values are applicable to both accesses and are applied by the UE and UPF as follows:\n-\tLoad-Balancing Steering Mode with fixed split percentages (i.e. without the Autonomous load-balance indicator or UE assistance indicator): When at least one measured parameter (i.e. RTT or Packet Loss Rate) on one access exceeds the provided threshold value, the UE and UPF may stop sending traffic on this access, or may continue sending traffic on this access but should reduce the traffic on this access by an implementation specific amount and shall send the amount of reduced traffic on the other access. When all measured parameters (i.e. RTT and Packet Loss Rate) for both accesses do not exceed the provided threshold values, the UE and UPF shall apply the fixed split percentages.\n-\tPriority-based Steering Mode: When one or more threshold values are provided for the Priority-based Steering Mode, these threshold values should be considered by UE and UPF to determine when an access becomes congested. For example, when a measured parameter (i.e. RTT or Packet Loss Rate) on one access exceeds the provided threshold value, the UE and UPF may consider this access as congested and send the traffic also to the low priority access.\n-\tRedundant Steering Mode: When the measured Packet Loss Rate exceeds the provided threshold value on both accesses, the UE and UPF shall duplicate the traffic of the SDF on both accesses. When the measured RTT exceeds the provided threshold value on both accesses, the UE and UPF may duplicate the traffic of the SDF on both accesses based on implementation. When the measured parameter (i.e. either RTT or Packet Loss Rate) exceeds the provided threshold value on one access only, the UE and UPF shall send the traffic of the SDF only over the other access. When the measured parameter (i.e. either RTT or Packet Loss Rate) does not exceed the provided threshold value on any access, the UE and UPF shall send the traffic of the SDF only over the Primary Access. The Primary Access (either 3GPP access or Non-3GPP access) may be provided to the UE in the ATSSS rules and to the UPF in the N4 rules. If the Primary Access is not provided to the UE and UPF, UE and UPF shall select a Primary Access based on their own implementation (e.g. using the lowest RTT access or the lowest Packet Loss Rate access). If measurement results on an access are not available for a parameter, it is considered that the measured parameter for this access has not exceeded the provided threshold value. If a threshold value is provided when the Steering Mode is Redundant, the Steering Mode can only be used for Non-GBR SDF.\n-\tA Steering Functionality, which identifies whether the MPTCP functionality, or the MPQUIC functionality, or the ATSSS-LL functionality should be used to steer the traffic of the matching SDF. This is used when the UE supports multiple functionalities for ATSSS, as specified in clause 5.32.6 (\"Support of Steering Functions\").\n-\tA Transport Mode, which identifies the transport mode that should be applied by the MPQUIC functionality for the matching traffic. The transport modes supported by the MPQUIC functionality are defined in clause 5.32.6.2.2.1.\nNOTE 3:\tThere is no need to update the ATSSS rules when one access becomes unavailable or available.\nAs an example, the following ATSSS rules could be provided to UE:\na)\t\"Traffic Descriptor: UDP, DestAddr 1.2.3.4\", \"Steering Mode: Active-Standby, Active=3GPP, Standby=non-3GPP\":\n-\tThis rule means \"steer UDP traffic with destination IP address 1.2.3.4 to the active access (3GPP), if available. If the active access is not available, use the standby access (non-3GPP)\".\nb)\t\"Traffic Descriptor: TCP, DestPort 8080\", \"Steering Mode: Smallest Delay\":\n-\tThis rule means \"steer TCP traffic with destination port 8080 to the access with the smallest delay\". The UE needs to measure the RTT over both accesses, in order to determine which access has the smallest delay.\nc)\t\"Traffic Descriptor: TCP traffic of Application-1\", \"Steering Mode: Load-Balancing, 3GPP=20%, non-3GPP=80%\", \"Steering Functionality: MPTCP\":\n-\tThis rule means \"send 20% of the TCP traffic of Application-1 to 3GPP access and 80% to non-3GPP access by using the MPTCP functionality\".\nd)\t\"Traffic Descriptor: TCP traffic of Application-1\", \"Steering Mode: Load-Balancing, 3GPP=20%, non-3GPP=80%, \"Threshold Value for Packet Loss Rate: 1%\", \"Steering Functionality: MPTCP\":\n-\tThis rule means \"send 20% of the TCP traffic of Application-1 to 3GPP access and 80% to non-3GPP access as long as the Packet Loss Rate does not exceed 1% on both accesses, by using the MPTCP functionality. If the measured Packet Loss Rate of an access exceeds 1%, then the TCP traffic of Application-1 may be reduced on this access and sent via the other access\".\ne)\t\"Traffic Descriptor: UDP traffic of Application-1\", \"Steering Mode: Load-Balancing, 3GPP=30%, non-3GPP=70%\", \"Steering Functionality: MPQUIC\", \"Transport Mode: Datagram mode 1\":\n-\tThis rule means \"send 30% of the UDP traffic of Application-1 to 3GPP access and 70% to non-3GPP access by using the MPQUIC functionality with the Datagram mode 1\".\nf)\t\"Traffic Descriptor: com.example.app0, TCP\", \"Steering Mode: Redundant\", \"Steering Functionality: MPTCP\":\n-\tThis rule means \"traffic duplication is applied by the MPTCP steering functionality to the TCP traffic of application com.example.app0 and 100% of the traffic is duplicated over both accesses\".\ng)\t\"Traffic Descriptor: com.example.app1, TCP\", \"Steering Mode: Redundant, Primary Access=3GPP, Threshold Value for Packet Loss Rate: 0.1%\", \"Steering Functionality: MPTCP\":\n-\tThis rule means \"traffic duplication is applied to the TCP traffic of application com.example.app1. If the measured PLR exceeds 0.1% on both accesses, all matched traffic is duplicated on both accesses. If the measured PLR exceeds 0.1% on one access only (either 3GPP or non-3GPP access), all matched traffic is sent over the other access only. If the measured PLR does not exceed 0.1% on any access, all matched traffic is sent over 3GPP access only as this is the Primary Access\".\nh)\t\"Traffic Descriptor: com.example.app2, TCP\", \"Steering Mode: Redundant, Threshold Value for Packet Loss Rate: 0.1%\", \"Steering Functionality: MPTCP\".\n-\tThis rule means \"traffic duplication is applied to the TCP traffic of application com.example.app2. If the measured PLR exceeds 0.1% on both accesses, all matched traffic is duplicated and transmitted on both accesses. If the measured PLR exceeds 0.1% on one access only (either 3GPP or non-3GPP access), all matched traffic is sent over the other access only. If the measured PLR does not exceed 0.1% on any access, the UE or UPF selects the access based on their own implementation, e.g. the access with lower Packet Loss Rate to transmit all matched traffic\".\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 5.32.8-1: Structure of ATSSS Rule",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "5.33\tSupport for Ultra Reliable Low Latency Communication",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.33.1\tGeneral",
                            "text_content": "The following features described in 5.33 may be used to enhance 5GS to support Ultra Reliable Low Latency Communication (URLLC):\n-\tRedundant transmission for high reliability communication.\nIn this Release, URLLC applies to 3GPP access only.\nWhen a PDU Session is to serve URLLC QoS Flow, the UE and SMF should establish the PDU Session as always-on PDU Session as described in clause 5.6.13.\nNOTE 1:\tHow the UE knows whether a PDU Session is to serve a URLLC QoS Flow when triggering PDU Session establishment is up to UE implementation.\nNOTE 2:\tNo additional functionality is specified for URLLC in order to support Home Routed roaming scenario in this Release.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.33.2\tRedundant transmission for high reliability communication",
                            "text_content": "In order to support highly reliable URLLC services, a UE may set up two redundant PDU Sessions over the 5G network, such that the 5GS sets up the user plane paths of the two redundant PDU Sessions to be disjoint. The user's subscription indicates if user is allowed to have redundant PDU Sessions and this indication is provided to SMF from UDM.\nNOTE 1:\tIt is out of scope of 3GPP how to make use of the duplicate paths for redundant traffic delivery end-to-end. It is possible to rely on upper layer protocols, such as the IEEE 802.1 TSN (Time Sensitive Networking) FRER (Frame Replication and Elimination for Reliability) [83], to manage the replication and elimination of redundant packets/frames over the duplicate paths which can span both the 3GPP segments and possibly fixed network segments as well.\nNOTE 2:\tThe following redundant network deployment aspects are within the responsibility of the operator and are not subject to 3GPP standardization:\n-\tRAN supports dual connectivity, and there is sufficient RAN coverage for dual connectivity in the target area.\n-\tUEs support dual connectivity.\n-\tThe core network UPF deployment is aligned with RAN deployment and supports redundant user plane paths.\n-\tThe underlying transport topology is aligned with the RAN and UPF deployment and supports redundant user plane paths.\n-\tThe physical network topology and geographical distribution of functions also supports the redundant user plane paths to the extent deemed necessary by the operator.\n-\tThe operation of the redundant user plane paths is made sufficiently independent, to the extent deemed necessary by the operator, e.g. independent power supplies.\nFigure 5.33.2.1-1 illustrates an example user plane resource configuration of dual PDU Sessions when redundancy is applied. One PDU Session spans from the UE via Master RAN node to UPF1 acting as the PDU Session Anchor, and the other PDU Session spans from the UE via Secondary RAN node to UPF2 acting as the PDU Session Anchor. As described in TS 37.340 [31], NG-RAN may realize redundant user plane resources for the two PDU Sessions with two NG-RAN nodes (i.e. Master RAN node and Secondary RAN node as shown in Figure 5.33.2.1-1) or a single NG-RAN node. In both cases, there is a single N1 interface towards AMF.\nBased on these two PDU Sessions, two independent user plane paths are set up. UPF1 and UPF2 connect to the same Data Network (DN), even though the traffic via UPF1 and UPF2 may be routed via different user plane nodes within the DN.\nIn order to establish two redundant PDU Sessions and associate the duplicated traffic coming from the same application to these PDU Sessions, URSP as specified in TS 23.503 [45] may be used, or alternatively the UE may perform this task independently from URSP.\nWhen URSP is used to establish two redundant PDU Sessions, duplicated traffic from the application, associated to the redundant PDU Sessions, is differentiated by two distinct traffic descriptors, each in a distinct URSP rule. These traffic descriptors need to have different DNNs, IP descriptors or non-IP descriptors (e.g. MAC address, VLAN ID), so that the two redundant PDU Sessions are matched to the Route Selection Descriptors of distinct URSP rules. These Route Selection Descriptors of distinct URSP rules may include corresponding RSNs and PDU Session Pair IDs. The Route Selection Descriptors share same PDU Session Pair ID, if included, to denote the two traffic are redundant with each other. How does UE determines the PDU Session Pair ID and/or RSN from the matched URSP rules is described in clause 6.6.2 of TS 23.503 [45].\nWhen the UE performs the establishment of two redundant PDU Sessions and the duplication of traffic independently from URSP, the UE may establish two redundant PDU Sessions even when the application does not duplicate the traffic and the application does not provide two distinct traffic descriptors. In this case the UE may set the RSN and PDU Session Pair ID in the PDU Session Establishment Request message based on UE implementation.\nNOTE 3:\tAs an example, the UE may use the implementation of FRER (Frame Replication and Elimination for Reliability), IEEE Std 802.1CB-2017 [83], in the UE's operating system.\nIf the operator decides to allow UE to use its own mechanisms to determine PDU Session Pair ID and RSN (where such UE capability is known based on local PCF configuration based on e.g. deployment, terminal implementation or policies per group of UE(s)), then the PCF shall not include PDU Session Pair ID and RSN in URSP rule.\nThe redundant user plane set up applies to both IP and Ethernet PDU Sessions.\nIn this scenario, we have a 5G network with a dual connectivity approach, where the User Plane (UP) paths are redundant. This is achieved by using dual connectivity, where the UP paths are split into two paths, one for each user. This ensures that in the event of a single path failure, the network can still function, as the other path is available. The figure shows the end-to-end path for a user, with two paths, one for each user, ensuring redundancy and reliability.\nFigure 5.33.2.1-1: Example scenario for end to end redundant User Plane paths using Dual Connectivity\nSupport of redundant PDU Sessions include:\n-\tUE initiates two redundant PDU Sessions and may provide PDU Session Pair ID (optional) and the RSN (optional). Different combinations of RSN, DNN and S-NSSAI are used for each PDU Session within a given pair of redundant PDU Sessions. Different combinations of PDU Session Pair ID, DNN and S-NSSAI are used between the different pairs of redundant PDU Session.\n-\tThe UE may include a PDU Session Pair ID and/or RSN in each of the PDU Session establishment Request when it establishes redundant PDU Sessions. UE determines the PDU Session Pair ID and/or RSN based on UE local mechanism or the matched URSP rules.\n-\tThe SMF determines whether the PDU Session is to be handled redundantly. The determination is based on the presence of the PDU Session Pair ID and/or RSN in the PDU Session Establishment Request or the determination is based on an indication that redundant PDU Session is required provided by PCF for the PDU Session, if dynamic PCC applies for the PDU Session or the combination of the S-NSSAI, DNN, user subscription and local policy configuration in the SMF if dynamic PCC is not used for the PDU Session. If the PDU session is to be handled redundantly and the PDU Session Pair ID was not included in the PDU Session Establishment request, the SMF uses S-NSSAI, DNN and local configuration to determine the PDU Session Pair ID. If the PDU session is to be handled redundantly and RSN was not included in the PDU Session Establishment request, the SMF uses S-NSSAI, DNN to determine the RSN value. The RSN differentiates the PDU Sessions that are handled redundantly and indicates redundant user plane requirements for the PDU Sessions in NG-RAN.\n-\tThe SMF shall provide the RSN and PDU Session Pair ID to the NG-RAN for a redundant PDU Session.\n-\tOperator configuration of UPF selection ensures the appropriate UPF selection for disjoint paths.\n-\tAt establishment of the PDU Sessions or at transitions to CM-CONNECTED state, the RSN parameter indicates to NG-RAN that redundant user plane resources shall be provided for the given PDU Sessions by means of dual connectivity. The PDU Session Pair ID identifies the two redundant PDU Sessions that belong together. The value of the RSN parameter and the PDU Session Pair ID indicates redundant user plane requirements for the PDU Sessions. This request for redundant handling is made by indicating the RSN to the NG-RAN node on a per PDU Session granularity. PDU Sessions associated with different RSN values shall be realized by different, redundant UP resources. Based on the RSN, the PDU Session Pair ID and RAN configuration, the NG-RAN sets up dual connectivity as defined in TS 37.340 [31] so that the sessions have end to end redundant paths. When there are multiple PDU Sessions with the RSN parameter set, of different values of RSN and the same PDU Session Pair ID, this indicates to NG-RAN that CN is requesting dual connectivity to be set up and the user plane shall be handled as indicated by the RSN parameter, the PDU Session Pair ID and the associated RAN configuration. If the RSN value and PDU Session Pair ID are provided to the NG-RAN, NG-RAN shall consider the RSN value and PDU Session Pair ID when it associates the PDU Sessions with NG-RAN UP.\nNOTE 4:\tThe decision to set up dual connectivity remains in NG-RAN as defined today. NG-RAN takes into account the additional request for the dual connectivity setup provided by the CN.\n-\tUsing NG-RAN local configuration, NG-RAN determines whether the request to establish RAN resources for a PDU Session is fulfilled or not considering user plane requirements indicated by the RSN parameter and the PDU Session Pair ID by means of dual connectivity. If the request to establish RAN resources for PDU Session can be fulfilled by the RAN, the PDU Session is established even if the user plane requirements indicated by RSN cannot be satisfied. The decision for each PDU Session is taken independently (i.e. rejection of a PDU Session request shall not release the previously established PDU Session). The RAN shall determine whether to notify the SMF if the RAN resources indicated by the RSN parameter and the PDU Session Pair ID can no longer be maintained and SMF can use that to determine if the PDU Session should be released.\n-\tIn the case of Ethernet PDU Sessions, the SMF has the possibility to change the UPF (acting as the PSA) and select a new UPF based on the identity of the Secondary RAN node for the second PDU Session if the Secondary RAN node is modified (or added/released), using the Ethernet PDU Session Anchor Relocation procedure described in clause 4.3.5.8 of TS 23.502 [3].\n-\tThe SMF's charging record may reflect the RSN information.\n-\tThe RSN parameter and the PDU Session Pair ID, if available, is transferred from Source NG-RAN to Target NG-RAN in the case of handover.\nIf the reliability of NG-RAN node, UPF and CP NFs are high enough to fulfil the reliability requirement of URLLC services served by these NFs, but the reliability of single N3 tunnel is considered not high enough, e.g. due to the deployment environment of backhaul network, the redundant transmission may be deployed between PSA UPF and NG-RAN via two independent N3 tunnels, which are associated with a single PDU Session, over different transport layer path to enhance the reliability. SMF may make use of Redundant Transmission Experience analytics provided by NWDAF, as described in clause 6.13 of TS 23.288 [86], to determine whether redundant transmission for the PDU session of the URLLC shall be performed or (if activated) shall be stopped.\nTo ensure the two N3 tunnels are transferred via disjointed transport layer paths, the SMF or PSA UPF should provide different routing information in the tunnel information (e.g. different IP addresses or different Network Instances), and these routing information should be mapped to disjoint transport layer paths according to network deployment configuration. The SMF indicates NG-RAN and PSA UPF that one of the two CN/AN Tunnel Info is used as the redundancy tunnel of the PDU Session accordingly. The redundant transmission using the two N3/N9 tunnels are performed at QoS Flow granularity and are sharing the same QoS Flow ID.\nDuring or after a URLLC QoS Flow establishment, if the SMF decided that redundant transmission shall be performed based on authorized 5QI, NG-RAN node capability, operator configuration and/or Redundant Transmission Experience analytics, the SMF informs the PSA UPF and NG-RAN to perform redundant transmission via N4 interface and N2 information accordingly. In this case, NG-RAN should also provide different routing information in the tunnel information (e.g. different IP addresses), and these routing information should be mapped to disjoint transport layer paths according to network deployment configuration.\nNOTE 1:\tThe NG-RAN node capability to support the redundant transmission on N3/N9 can be configured in the SMF per network slice or per SMF service area.\nIf duplication transmission is performed on N3/N9 interface, for each downlink packet of the QoS Flow the PSA UPF received from DN, the PSA UPF replicates the packet and assigns the same GTP-U sequence number to them for the redundant transmission. The NG-RAN eliminates the duplicated packets based on the GTP-U sequence number and then forwards the PDU to the UE.\nFor each uplink packet of the QoS Flow the NG-RAN received from UE, the NG-RAN replicates the packet and assigns the same GTP-U sequence number to them for redundant transmission. These packets are transmitted to the PSA UPF via two N3 Tunnels separately. The PSA UPF eliminates the duplicated packet based on the GTP-U sequence number accordingly.\nNOTE 2:\tHow to realize the sequence number for support of GTP-U duplication over N3/N9 is up to stage 3.\nNOTE 3:\tFor redundant transmission on N3/N9 interfaces, reordering is not required on the receiver side.\nThe PSA UPF and NG-RAN may transmit packets via one or both of the tunnels per QoS Flow based on SMF instruction.\nNOTE 4:\tThe AMF selects an SMF supporting redundant transmission based on the requested S-NSSAI and/or DNN.\nDuring UE mobility, when the UE moves from NG-RAN supporting redundant transmission to NG-RAN not supporting redundant transmission, the SMF may release the QoS Flow which are subject to redundant transmission.\nFigure 5.33.2.2-1 illustrates the case that the redundant transmission is performed only on N3 interface. These packets are transmitted to the NG-RAN via two N3 Tunnels separately. The RAN node and PSA UPF shall support the packet replication and elimination function as described above.\nThe figure depicts a redundant transmission system with two N3 tunnels between the PSA UPF and a single NG-RAN node. The system utilizes two redundant paths to ensure reliable communication, with one path being the primary path and the other being a backup. This design is based on SDN principles, allowing for efficient network management and failover capabilities.\nFigure 5.33.2.2-1: Redundant transmission with two N3 tunnels between the PSA UPF and a single NG-RAN node\nTwo Intermediate UPFs (I-UPFs) between the PSA UPF and the NG-RAN may be used to support the redundant transmission based on two N3 and N9 tunnels between a single NG-RAN node and the PSA UPF. The NG-RAN node and PSA UPF shall support the packet replication and elimination function as described above.\nThe figure depicts two N3 and N9 tunnels connecting the N3 and N9 sub-networks of the 5G network, facilitating redundant transmission between the two networks. The N3 and N9 tunnels are crucial for ensuring reliable and efficient communication in the 5G network, as they help to prevent network congestion and ensure seamless data transmission.\nFigure 5.33.2.2-2: Two N3 and N9 tunnels between NG-RAN and PSA UPF for redundant transmission\nIn figure 5.33.2.2-2, there are two N3 and N9 tunnels between NG-RAN and PSA UPF for the URLLC QoS Flow(s) of the same PDU Session for redundant transmission established during or after a URLLC QoS Flow establishment. In the case of downlink traffic, the PSA UPF duplicates the downlink packet of the QoS Flow from the DN and assigns the same GTP-U sequence number to them. These duplicated packets are transmitted to I-UPF1 and I-UPF2 via N9 Tunnel 1 and N9 Tunnel 2 separately. Each I-UPF forwards the packet with the same GTP-U sequence number which receives from the PSA UPF to NG-RAN via N3 Tunnel 1 and N3 Tunnel 2 respectively. The NG-RAN eliminates the duplicated packet based on the GTP-U sequence number. In the case of uplink traffic, the NG-RAN duplicates the packet of the QoS Flow from the UE and assigns the same GTP-U sequence number to them. These duplicated packets are transmitted to I-UPF1 and I-UPF2 via N3 Tunnel 1 and N3 Tunnel 2 separately. Each I-UPF forwards the packet with the same GTP-U sequence number which receives from the NG-RAN to PSA UPF via N9 Tunnel 1 and N9 Tunnel 2 respectively. The PSA UPF eliminates the duplicated packets based on the GTP-U sequence number.\nThe I-UPFs inserted on one leg of the redundant paths shall not behave in an UL CL or Branching Point role.\nRedundant transmission can be supported within the 5G System without making any assumption on support for protocols such as IEEE FRER in the application layer (DN only) at the same time it can be supported without requiring redundant GTP-U tunnel over N3. The backhaul provides two disjoint transport paths between UPF and NG-RAN. The redundancy functionality within NG-RAN and UPF make use of the independent paths at transport layer. Support of redundant transmission at transport layer requires no 3GPP protocol impact.\nFollowing are the required steps:\n-\tUE establishes the PDU session for URLLC services. Based on DNN, S-NSSAI, knowledge of supporting redundant transmission at transport layer and other factors as described in clause 6.3.3, SMF selects a UPF that supports redundant transmission at transport layer for the PDU session. One N3 GTP-U tunnel is established between UPF and NG-RAN.\nThe knowledge of supporting redundant transmission at transport layer can be configured in the SMF, or be configured in UPF and then obtained by the SMF via N4 capability negotiation during N4 Association setup procedure.\n-\tFor DL data transmission, UPF sends the DL packets on N3 GTP-U tunnel. Redundant functionality in the UPF duplicates the DL data on the transport layer. Redundant functionality in the NG-RAN eliminates the received duplicated DL data and sends to NG-RAN.\n-\tFor UL data transmission, NG-RAN sends the received UL packets on N3 GTP-U tunnel, the Redundant functionality in the NG-RAN performs the redundant handling on the backhaul transport layer. The Redundant functionality in the UPF eliminates the received duplicated UL data and sends to UPF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.33.3\tQoS Monitoring for packet delay",
                            "text_content": "QoS Monitoring for packet delay can be applied based on 3rd party application request or PCF policy control or both, e.g. to assist URLLC services. The packet delay between UE and PSA UPF is a combination of the RAN part of UL/DL packet delay as defined in TS 38.314 [120] and UL/DL packet delay between NG-RAN and PSA UPF. The NG-RAN is required to provide the QoS monitoring results on the RAN part of UL/DL packet delay measurement. The measurement of the UL/DL packet delay between NG-RAN and PSA UPF can be performed on different levels of granularities, i.e. per QoS Flow per UE level, or per GTP-U path level, subject to the operators' configuration.\nThe PCF generates the authorized QoS Monitoring policy for a service data flow based on the QoS Monitoring request received from the AF (as described in clause 6.1.3.21 of TS 23.503 [45]). The PCF includes the authorized QoS Monitoring policy in the PCC rule and provides it to the SMF.\nWhen SMF receives the authorized QoS Monitoring policy for packet delay in a PCC rule from the PCF (as described in clause 6.1.3.21 of TS 23.503 [45]), SMF configures the UPF(s) and NG-RAN to perform delay measurements according to the method selected: per QoS Flow per UE QoS measurement (as described in clause 5.33.3.2) or per GTP-U Path measurement (as described in clause 5.33.3.3). The SMF configure the UPF to report the QoS monitoring results for the QoS Flow as described in clause 5.8.2.18 with parameters determined by the SMF based on the authorized QoS Monitoring policy received from the PCF and/or local configuration.\nThe UPF reporting behaviour for QoS Monitoring for packet delay of a QoS Flow is the same when per QoS Flow per UE level measurement (described further in clause 5.33.3.2) or when per GTP-U path level measurement (described further in clause 5.33.3.3) is used.\nSMF may activate the end to end UL/DL packet delay measurement between UE and PSA UPF for a QoS Flow during the PDU Session Establishment or Modification procedure.\nThe SMF sends a QoS Monitoring request to the PSA UPF via N4 and NG-RAN via N2 signalling to request the QoS monitoring between PSA UPF and NG-RAN. The QoS Monitoring request may contain monitoring parameters determined by SMF based on the authorized QoS Monitoring policy received from the PCF and/or local configuration.\nThe NG-RAN initiates the RAN part of UL/DL packet delay measurement based on the QoS Monitoring request from SMF. NG-RAN reports the RAN part of UL/DL packet delay result to the PSA UPF in the UL data packet or dummy UL packet.\nIf the NG-RAN and PSA UPF are time synchronised, the one way packet delay monitoring between NG-RAN and PSA UPF is supported.\nIf the NG-RAN and PSA UPF are not time synchronised, it is assumed that the UL packet delay and the DL packet delay between NG-RAN and PSA UPF are the same.\nFor both time synchronised and not time synchronised between NG-RAN and PSA UPF, the PSA UPF creates and sends the monitoring packets to the RAN in a measurement frequency, decided by the PSA UPF, taking the Reporting frequency for QoS Monitoring received from the SMF into account:\n-\tThe PSA UPF encapsulates in the GTP-U header with QFI, QoS Monitoring Packet (QMP) indicator (which indicates the packet is used for UL/DL packet delay measurement) and the local time T1 when the PSA UPF sends out the DL monitoring packets.\n-\tThe NG-RAN records the local time T1 received in the GTP-U header and the local time T2 at the reception of the DL monitoring packets.\n-\tWhen receiving an UL packet from UE for that QFI or when the NG-RAN sends a dummy UL packet as monitoring response (in case there is no UL service packet for UL packet delay monitoring), the NG-RAN encapsulates QMP indicator, the RAN part of UL/DL packet delay result, the time T1 received in the GTP-U header, the local time T2 at the reception of the DL monitoring packet and the local time T3 when NG-RAN sends out this monitoring response packet to the UPF via N3 interface, in the GTP-U header of the monitoring response packet.\nNOTE 1:\tWhen the NG-RAN sends the dummy UL packet as monitoring response to PSA UPF depends on NG-RAN's implementation.\n-\tThe PSA UPF records the local time T4 when receiving the monitoring response packets and calculates the round trip (if not time synchronized) or UL/DL packet delay (if time synchronized) between NG-RAN and anchor PSA UPF based on the time information contained in the GTP-U header of the received monitoring response packet. If the NG-RAN and PSA UPF are not time synchronised, the PSA UPF calculates the UL/DL packet delay between the NG-RAN and the PSA UPF based on the (T2-T1+T4-T3)/2. If the NG-RAN and PSA UPF are time synchronised, the PSA UPF calculates the UL packet delay and DL packet delay between the NG-RAN and the PSA UPF based on (T4-T3) and (T2-T1), respectively. The PSA UPF calculates the UL/DL packet delay between UE and PSA UPF based on the received RAN part of UL/DL packet delay result and the calculated UL/DL packet delay between RAN and PSA UPF.\nNOTE 2:\tIf the NG-RAN and PSA UPF are not time synchronised, it can cause inaccurate result of UL/DL packet delay.\n-\tThe PSA UPF reports the QoS Monitoring results as described in clause 5.8.2.18.\nIf the redundant transmission on N3/N9 interfaces is activated, the UPF and NG-RAN performs QoS monitoring for both UP paths. The UPF reports the packet delays of the two UP paths independently to the SMF.\nThe SMF can request to activate QoS monitoring for the GTP-U path(s) between all UPF(s) and the (R)AN based on locally configured policies. Alternatively, when a QoS monitoring policy is received in a PCC rule and the QoS monitoring is not yet active for the DSCP corresponding to the 5QI in the PCC rule, the SMF activates QoS Monitoring for all UPFs currently in use for this PDU Session and the (R)AN. In this case, the SMF performs the QoS Flow Binding without taking the QoS Monitoring Policy within the PCC rule into account. The SMF sends the QoS monitoring policy to each involved UPF and the (R)AN via N4 interface and via N2 interface respectively.\nNOTE 1:\tThe PCC rule containing a QoS monitoring policy is just a trigger for the SMF to instruct the UPFs to initiate the GTP-U based QoS Monitoring.\nA GTP-U sender performs an estimation of RTT to a GTP-U receiver on a GTP-U path by sending Echo messages and measuring time that elapses between the transmission of Request message and the reception of Response message. A GTP-U sender computes an accumulated packet delay by adding RTT/2, the processing time and, if available, an accumulated packet delay from an upstream GTP-U sender (i.e. an immediately preceding GTP-U sender in user plane path) thus the measured accumulated packet delay represents an estimated elapsed time since a user plane packet entered 3GPP domain.\nIt is expected that a GTP-U sender determines RTT periodically in order to detect changes in transport delays. QoS monitoring is performed by a GTP-U end-point (UP function) that receives, stores and executes the QoS monitoring policy as described below for a QoS Flow. QoS monitoring is performed by comparing a measured accumulated packet delay with the stored parameters. If the GTP-U end-point (the PSA UPF, in the case of accumulated packet delay reporting) determines that the packet delay exceeds the value of a stored parameter, then the node triggers QoS monitoring alert signalling to the relevant SMF or to the OA&M function as further described in TS 29.244 [65].\nNOTE 2:\tEcho Request message and Echo Response message are sent outside GTP-U tunnels (the messages are using TEID set to 0). If underlying transport is using QoS differentiation (e.g. IP DiffServ) then it is up to the implementation to ensure that the Echo messages are classified correctly and receive similar treatment by the underlaying transport as GTP-U GTP-PDUs carrying QoS Flows (user data).\nWhen QoS Monitoring is used to measure the packet delay for a QoS Flow, the following applies:\n-\tPacket delay measurement is performed by using GTP-U Echo Request/Response as defined in the TS 28.552 [108], in the corresponding user plane transport path(s), independent of the corresponding PDU Session and the 5QI for a given QoS Flow.\n-\tRAN measures and provides the RAN part of UL/DL packet delay towards UPF (in the GTP-U header of the respective QoS Flow via N3).\n-\tThe UPF calculates the UL/DL packet delay by combining the received measurements of RAN part with the measurements of N3/N9 interface (N9 is applicable when I-UPF exists).\n-\tThe UPF reports the QoS Monitoring results as described in clause 5.8.2.18.\nQoS Monitoring can also be used to measure the packet delay for transport paths to influence the mapping of QoS Flows to appropriate network instances, DSCP values as follows:\n-\tSMF activates QoS monitoring for the GTP-U path(s) between all UPF(s) and all (R)AN nodes based on locally configured policies.\n-\tUPF does measurement of network hop delay per transport resources that it will use towards a peer network node identified by an IP destination address (the hop between these two nodes) and port. The network hop measured delay is computed by sending an Echo Request over such transport resource (Ti) and measuring RTT/2 when Echo Response is received.\n-\tUPF maps {network instance, DSCP} into Transport Resource and measures delay per IP destination address and port. Thus, for each IP destination address, the measured delay per (network instance, DSCP) entry is determined.\n-\tThe UPF performing the QoS monitoring can provide the corresponding {Network instance, DSCP} along with the measured accumulated packet delay for the corresponding transport path to the SMF. The UPF reports the measurement results to the SMF based on some specific conditions e.g. first time, periodic, event triggered, when thresholds for reporting towards SMF (via N4) are reached.\n-\tBased on this, SMF can determine QoS Flow mapping to the appropriate {Network instance, DSCP} considering {5QI, QoS characteristics, ARP} for the given QoS Flow.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.34\tSupport of deployments topologies with specific SMF Service Areas",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.34.1\tGeneral",
                            "text_content": "When the UE is outside of the SMF Service Area, or current SMF cannot serve the target DNAI for the traffic routing for local access to the DN, an I-SMF is inserted between the SMF and the AMF. The I-SMF has a N11 interface with the AMF and a N16a interface with the SMF and is responsible of controlling the UPF(s) that the SMF cannot directly control. The exchange of the SM context and forwarding of tunnel information if needed are done between two SMFs directly without involvement of AMF.\nDepending on scenario, a PDU Session in non-roaming case or local breakout is either served by a single SMF or served by an SMF and an I-SMF. When a PDU Session is served by both an SMF and an I-SMF, the SMF is the NF instance that has the interfaces towards the PCF and CHF.\nIn this Release of the specification, deployments topologies with specific SMF Service Areas apply only for 3GPP access.\nThe SMF shall release or reject the PDU Session if the DNN of the PDU Session corresponds to a LADN and the I-SMF is inserted to the PDU Session.\nNOTE 1:\tThis implies that operators need to plan the LADN deployment in such a way that the LADN Service area needs to be within the SMF Service Area, but not across SMFs' Service Areas.\nNOTE 2:\tThis is to cover the case where the UE is not in or moves out of SMF Service Area and an I-SMF is inserted to the PDU Session e.g. during PDU Session Establishment, Service Request. If the PDU Session is maintained with I-SMF, the SMF is not be able to enforce the LADN Service control, e.g. SMF is not notified in the case of Service Request.\nIndependent of whether deployments topologies with specific SMF Service Areas apply, the SMF may trigger the PDU Session re-establishment to the same DN, if the PDU Session is associated with the SSC mode 2 or SSC mode 3.\nNOTE 3:\tSSC mode 2 or SSC mode 3 can be used to optimize SMF location for a PDU Session and/or, depending on deployment, ensure that the UE is always within the service area of the SMF controlling the PDU Session. In this case (when PDU Session continuity over the PLMN is not required) procedures described in this clause are not needed.\nIn this Release, how TSC (as defined in clauses 5.27 and 5.28) is supported for PDU Sessions involving an I-SMF is not specified.\nIn this Release, Redundant User Plane Paths as defined in clause 5.33.2.2 is not supported for PDU Sessions involving an I-SMF.\nRedundant PDU sessions support as defined in clause 5.33.2.1 is supported for PDU Sessions involving an I-SMF, when different S-NSSAIs are used for the redundant PDU sessions.\nRedundant User Plane Paths as defined in clause 5.33.2.3 is supported for PDU Sessions involving an I-SMF only if this PDU session is established for a S-NSSAI referring to network instances requiring redundant transmission at transport layer.\nQoS monitoring (as defined in clause 5.33.3) is supported as long as SMF and not I-SMF initiates the QoS monitoring function.\nDynamic CN PDB provisioning (as defined in clause 5.7.3.4) is supported for PDU Sessions involving an I-SMF.\nIn this Release, no dedicated functionality is specified for I-SMF and N16a in order to support NPN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.2\tArchitecture",
                            "text_content": "In non-roaming case the SBA architecture described in Figure 4.2.3-1 shall apply. In local breakout scenarios the SBA architecture described in Figure 4.2.4-1 shall apply. In Home Routed scenarios the SBA architecture described in Figure 4.2.4-3 shall apply.\nFigure 5.34.2.2-1 depicts the non-roaming architecture with an I-SMF insertion to the PDU Session without UL-CL/BP, using reference point representation.\n\"Figure 1: N16a Interface\"\nNOTE 1:\tN16a is the interface between SMF and I-SMF.\nNOTE 2:\tN38 is the interface between I-SMFs.\n\nFigure 5.34.2.2-1: Non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, with no UL-CL/BP\nFigure 5.34.2.2-2 depicts the non-roaming architecture for an I-SMF insertion to the PDU Session with UL-CL/BP, using reference point representation.\nThe given telecommunication figure depicts a non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, illustrating the use of UL-CL/BP. The figure shows the non-roaming architecture with I-SMF insertion to the PDU Session, which is a reference point representation. UL-CL/BP is used to ensure reliable communication in non-roaming scenarios.\nFigure 5.34.2.2-2: Non-roaming architecture with I-SMF insertion to the PDU Session in reference point representation, with UL-CL/BP\nFigure 5.34.2.3-1 depicts 5G System roaming architecture in the case of local break out scenario where the SMF controlling the UPF connecting to NG-(R)AN is separated from the SMF controlling PDU Session anchor, using the reference point representation.\nThe figure depicts a 5G roaming system architecture with a local breakout scenario in reference point representation. It illustrates the use of Software-Defined Networking (SDN) to manage the network, with a focus on the role of Software-Defined Mobile Femtocells (SMF/I-SMF). The figure shows the network's structure, including the core switches, optical line terminals (OLTs), and distributed nodes, which are interconnected to provide a robust and efficient network.\nFigure 5.34.2.3-1: Roaming 5G System architecture with SMF/I-SMF - local breakout scenario in reference point representation\nFor the case of home routed scenario, Figure 4.2.4-6 applies.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.3\tI-SMF selection, V-SMF reselection",
                            "text_content": "The AMF is responsible of detecting when to add or to remove an I-SMF or a V-SMF for a PDU Session. For this purpose, the AMF gets from NRF information about the Service Area and supported DNAI(s) of SMF(s).\nDuring mobility events such as Hand-Over or AMF change, if the service area of the SMF does not include the new UE location, then the AMF selects and inserts an I-SMF which can serve the UE location and the S-NSSAI. Conversely if the AMF detects that an I-SMF is no more needed (as the service area of the SMF includes the new UE location) it removes the I-SMF and interfaces directly with the SMF of the PDU Session. If the AMF detects that the SMF cannot serve the UE location (e.g. due to mobility), then the AMF selects a new I-SMF serving the UE location. If the existing I-SMF (or V-SMF) cannot serve the UE location (e.g. due to mobility) and the service area of the SMF does not include the new UE location (or the PDU Session is Home Routed), then the AMF initiates an I-SMF (or V-SMF) change. A V-SMF change may take place either at intra-PLMN or inter-PLMN mobility.\nAccording to the PCC rules related with AF influence traffic mechanism regarding DNAI(s), the SMF determines the target DNAI which is applicable to the current UE location and which can be based on the common DNAI (if applicable) as described in TS 23.548 [130]. If current (I-)SMF cannot serve the target DNAI or if the SMF can server the target DNAI and existing I-SMF is not needed, the SMF may send the target DNAI information to the AMF for triggering I-SMF (re)selection or removal, e.g. the AMF performs I-SMF (re)selection or removal based on the target DNAI and supported DNAI(s) of (I-)SMF. If the SMF determines that target DNAI currently served by I-SMF should not be used for the PDU Session hence the existing I-SMF is not needed (e.g. due to the updated PCC rules removes DNAI(s) that was provided in the previous PCC rules), the SMF sends the target DNAI information without including target DNAI to AMF, which may trigger the I-SMF removal.\nAt PDU Session Establishment in non-roaming and roaming with LBO scenarios, if the AMF or SCP cannot select an SMF with a Service Area supporting the current UE location for the selected (DNN, S-NSSAI) and required SMF capabilities, the AMF selects an SMF for the selected (DNN, S-NSSAI) and required capabilities and in addition selects an I-SMF serving the UE location and the S-NSSAI.\nCompared to the SMF selection function defined in clause 6.3.2, the following parameters are not applicable for I-SMF/V-SMF selection:\n-\tData Network Name (DNN).\n-\tSubscription information from UDM.\nNOTE 1:\tAll SMF(s) and I-SMF are assumed to be able to control the UPF mapping between EPC bearers and 5GC QoS Flows.\nIf HR-SBO roaming is allowed for a PDU Session, the DNN is also considered for V-SMF selection.\nIf delegated SMF discovery is used at PDU Session establishment:\n1.\tThe AMF sends Nsmf_PDUSession_CreateSMContext Request to SCP and includes the parameters as defined in clause 6.3.2 (e.g. the DNN, required SMF capabilities, UE location) as discovery and selection parameters. If the SCP successfully selects an SMF matching all discovery and selection parameters, the SCP forwards the Nsmf_PDUSessionCreateSMContext Request to the selected SMF.\n2.\tIf the SCP cannot select an SMF matching all discovery and selection parameters, the SCP returns a dedicated error to AMF. In this case the I-SMF also need be discovered.\n3.\tUpon reception of the error from the SCP that an SMF matching all discovery and selection parameters cannot be found, the AMF performs the discovery and selection of the SMF from NRF (thus not providing the UE location as a discovery parameter). The AMF may indicate the maximum number of SMF instances to be returned from NRF, i.e. SMF selection at NRF.\n4.\tThe AMF sends Nsmf_PDUSession_CreateSMContext Request to SCP, which includes the endpoint (e.g. URI) of the selected SMF and the discovery and selection parameters as defined in clause 6.3.2 except the DNN and the required SMF capabilities, i.e. parameter for I-SMF selection. The SCP performs discovery and selection of the I-SMF and forwards the Nsmf_PDUSession_CreateSMContext Request to the selected I-SMF.\n5.\tThe I-SMF sends the Nsmf_PDUSession_Create Request towards the SMF via the SCP; the I-SMF uses the received endpoint (e.g. URI) of the selected SMF to construct the target destination to be addressed. The SCP forwards the Nsmf_PDUSession_Create Request to the SMF.\n6.\tThe SMF answers to the I-SMF that answers to the AMF; in this answer the AMF receives the I-SMF ID.\n7.\tUpon reception of a response from I-SMF, based on the received I-SMF ID, the AMF may obtain the SMF Service Area of the I-SMF from NRF. The AMF uses the SMF Service Area of the I-SMF to determine the need for I-SMF relocation upon subsequent UE mobility.\nIf delegated I-SMF discovery is used once the PDU Session establishment has been established, the procedure starts at step 4 above and is further detailed in the messages flows in clause 23 of TS 23.502 [3].\nIf delegated V-SMF discovery is used for V-SMF reselection, clause 6.3.2 applies, but there is no need for discovery and selection of the H-SMF. This is further detailed in the messages flows in clause 23 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.4\tUsage of an UL Classifier for a PDU Session controlled by I-SMF",
                            "text_content": "This clause applies only in the case of non-roaming or LBO roaming as control of UL CL/BP in VPLMN is not supported in HR case.\nWhen I-SMF is involved for a PDU Session, it is possible that the UL CL controlled by I-SMF is inserted into the data path of the PDU Session. The usage of an ULCL controlled by I-SMF in the data path of a PDU Session is depicted in Figure 5.34.4-1.\nThe figure depicts the user plane architecture for the Uplink Classifier controlled by I-SMF, illustrating the various components and their interconnections. The architecture includes the Uplink Classifier, which is responsible for classifying the received signal, and the I-SMF, which is responsible for managing the signal flow and ensuring efficient communication. The figure also shows the various layers of the architecture, including the User Plane, the I-SMF, and the I-SMF-Uplink Interface, which are interconnected to ensure smooth communication.\nFigure 5.34.4-1: User plane Architecture for the Uplink Classifier controlled by I-SMF\nThe I-SMF determines whether UL CL will be inserted based on information received from SMF, and the I-SMF selects the UPFs acting as UL CL and/or PDU Session Anchor providing local access to the Data Network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.5\tUsage of IPv6 multi-homing for a PDU Session controlled by I-SMF",
                            "text_content": "This clause applies only in the case of non-roaming or LBO roaming as control of UL CL/BP in VPLMN is not supported in HR case.\nWhen I-SMF is involved for a PDU Session, it is possible that the BP controlled by I-SMF is inserted into the data path of the PDU Session. The usage of a BP controlled by I-SMF in the data path of a PDU Session is depicted in Figure 5.34.5-1.\nThe figure depicts a multi-homed PDU session with branching points controlled by I-SMF (Inter-Switch Multiplexing). It illustrates the process of switching between different PDU sessions, which is crucial for managing network traffic and ensuring efficient use of resources.\nFigure 5.34.5-1: Multi-homed PDU Session: Branching Point controlled by I-SMF\nThe I-SMF determines whether BP will be inserted based on information received from SMF, and the I-SMF selects the UPFs acting as BP and/or PDU Session Anchor providing local access to the Data Network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.6\tInteraction between I-SMF and SMF for the support of traffic offload by UPF controlled by the I-SMF",
                            "text_content": "This clause applies only in the case of non-roaming or LBO roaming as control of UL CL/Branching Point in VPLMN is not supported in HR case. It applies for the architectures described in clauses 5.34.4 and 5.34.5\nWhen the I-SMF is inserted into a PDU Session, e.g. during PDU Session establishment or due to UE mobility, the I-SMF may provide the DNAI list it supports to the SMF. Based on the DNAI list information received from I-SMF, the SMF may provide the DNAI(s) of interest for this PDU Session for local traffic steering to the I-SMF e.g. immediately or when a new or updated or removed PCC rule(s) is/are received. The DNAI(s) of interest is derived from PCC rules.\nThe I-SMF is responsible for the insertion, modification and removal of UPF(s) to ensure local traffic steering. The SMF does not need to have access to local configuration or NRF output related with UPF(s) controlled by I-SMF. Based on the DNAI(s) of interest for this PDU Session for local traffic steering and UE location the I-SMF determines which DNAI(s) are to be selected, selects UPF(s) acting as UL CL/BP and/or PDU Session Anchor based on selected DNAI, and insert these UPF(s) into the data path of the PDU Session.\nWhen a UL CL/BP has been inserted, changed or removed, the I-SMF indicates to the SMF that traffic offload have been inserted, updated or removed for a DNAI, providing also the IPv6 prefix that has been allocated if a new IPv6 prefix has been allocated for the PDU Session.\nFrom now on the SMF and I-SMF interactions entail:\n-\tNotifying the SMF with the new Prefix (multi-Homing case): the SMF is responsible of issuing Router Advertisement message. The SMF constructs a link-local address as the source IP address. The Router Advertisement message includes the IPv6 multi-homed routing rules provided to the UE to select the source IPv6 prefix among the prefixes related with the PDU Session according to RFC 4191 [8]. The SMF sends the Router Advertisement message to the UE via the PSA UPF controlled by the SMF.\n-\tN4 interactions related with traffic offloading. The SMF provide N4 information to the I-SMF for how the traffic shall be detected, enforced, monitored in UPF(s) controlled by the I-SMF: the SMF issues requests to the I-SMF containing N4 information to be used for creating / updating /removing PDR, FAR, QER, URR, etc. The N4 information for local traffic offload provided by the SMF to the I-SMF are described in clause 5.34.6.2.\n-\tReceiving N4 notifications related with traffic usage reporting: the I-SMF forwards to the SMF N4 information corresponding to UPF notifications related with traffic usage reporting; the SMF aggregates and constructs usage reports towards PCF/CHF.\nNOTE:\tHow the SMF decides what traffic steering and enforcement actions are enforced in UPF(s) controlled by I-SMF is left for implementation.\nThe I-SMF is responsible of the N4 interface towards the local UPF(s) including:\n-\tthe usage of AN Tunnel Info received from the 5G AN via the AMF in order to build PDR and FAR;\n-\trequesting the allocation of the CN Tunnel Info between local UPFs (if needed);\n-\tto control UPF actions when the UP of the PDU Session becomes INACTIVE.\n-\tprovide Trace Requirements on the N4 interface towards the UPF(s) it is controlling, using Trace Requirements received from AMF.\nThe SMF generates N4 information for local traffic offload based on the available DNAI(s) indicated by the I-SMF, PCC rules associated with these DNAI(s) and charging requirement. This N4 information is sent from the SMF to the I-SMF after UL CL/Branching Point insertion/update/removal, and the I-SMF uses this N4 information to derive rules installed in the UPFs controlled by the I-SMF.\nThe N4 information for local traffic offload corresponds to rules and parameters defined in clause 5.8.5, i.e. PDR, FAR, URR and QER. It contains identifiers allowing the SMF to later modify or delete these rules.\nN4 information for local traffic offload is generated by the SMF without knowledge of how many local UPF(s) are actually used by the I-SMF. The SMF indicates whether a rule within N4 information is enforced in UL CL/ Branching Point or local PSA. If the rule is applied to the local PSA, the N4 information includes the associated DNAI. The I-SMF generates suitable rules for the UPF(s) based on the N4 information received from SMF.\nNOTE:\tThe SMF is not aware of whether there is a single PSA or multiple PSA controlled by I-SMF.\nThe following parameters are managed by the I-SMF:\n-\tThe 5G AN Tunnel Info.\n-\tCN tunnel info between local UPFs.\n-\tNetwork instance (if needed).\nThe N4 information exchanged between I-SMF and SMF are not associated with a N4 Session ID but are associated with an N16a association allowing the SMF to modify or delete the N4 information at a later stage.\nThe I-SMF generates an N4 Session ID and for each rule a Rule ID (unless the ones received from the SMF can be used) and maintains a mapping between the locally generated identifiers and the ones received from the SMF. The I-SMF replaces those IDs in the PDR(s), QER(s), URR(s) and FAR(s) received from the SMF. When the I-SMF receives the N4 information, the Network instance (if needed) included in the rules sent to the UPF is generated by I-SMF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.7\tEvent Management",
                            "text_content": "When an I-SMF is involved in a PDU Session, the SMF and I-SMF independently subscribe to \"UE mobility event notification\" service provided by AMF. The AMF treats the SMF's and I-SMF's subscription separately and notifies the event directly to the SMF or I-SMF. If the SMF does not know the serving AMF address, the SMF gets the serving AMF address from the UDM as described in clause 5.2.3.2.4, TS 23.502 [3] and subscribes directly with the serving AMF.\nIn the case of AMF change (e.g. Inter NG-RAN node N2 based handover), the target AMF receives mobility event subscription information from the source AMF and updates the mobility event subscription information with the SMF and I-SMF independently (i.e. target AMF allocates the Subscription Correlation ID for each event and notifies the respective SMFs and I-SMF as described in clause 5.3.4.4).\nIn the case of I-SMF change or I-SMF insertion (e.g. at Inter NG-RAN node N2 based handover), the subscription of mobility event (from AMF) is not transferred from the old I-SMF or SMF to the new I-SMF, the new I-SMF triggers a new subscription event if the new I-SMF wants to receive the corresponding mobility event. In the case of I-SMF removal, the subscription of mobility event at the AMF is not transferred from the old I-SMF to the SMF, the SMF triggers a new subscription event if the SMF wants to receive the corresponding mobility event.\nThe subscription from the old SMF entity (old I-SMF, SMF) is removed via an explicitly request from this old SMF entity.\nConsumers of SMF events do not need to be aware of the insertion / removal / change of an I-SMF as they always subscribe to the SMF of the PDU Session.\nExcept for the events documented in the present clause, the I-SMF does not need to support the events defined in clause 5.2.8.3.1 of TS 23.502 [3].\nFor Events \"First downlink packet per source of the downlink IP traffic (buffered / discarded / transmitted)\", when an I-SMF is involved in the PDU Session, the SMF subscribes / unsubscribes onto I-SMF for the PDU Session ID on behalf of the event consumer (e.g. at I-SMF insertion or when a consumer subscribes or un subscribes while an I-SMF serves the PDU Session) and the I-SMF directly notifies the event consumer. At I-SMF change, the related SMF event subscriptions are not transferred from source I-SMF to the target I-SMF. The SMF may trigger new subscription event to the target I-SMF if the SMF wants to receive the corresponding SMF event. At I-SMF change or removal the corresponding subscription is removed in the source I-SMF when it removes the context associated with the PDU Session Id.\nWhen creating an association with a SMF or I-SMF for a PDU Session, the AMF implicitly subscribes to SMF / I-SMF about events related with the PDU Session (the AMF provides the relevant notification information to the SMF or the I-SMF respectively). This implicit subscription is implicitly released when the corresponding association with the SMF / I-SMF is removed (e.g. as no more needed due to a I-SMF insertion / change / removal).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.8\tSupport for Cellular IoT",
                            "text_content": "This clause defines the specific impacts of deployments topologies with specific SMF Service Areas on how 5GS supports Cellular IoT as defined in clause 5.31.\nFor a PDU Session supporting Control Plane CIoT 5GS Optimisation as defined in clause 5.31.4:\n-\tFor a PDU session towards a DNN/S-NSSAI for which the subscription includes a NEF Identity for NIDD (i.e. for a PDU session which will be anchored in NEF), the AMF never inserts an I-SMF.\nWhen an I-SMF is inserted to serve a PDU Session, the I-SMF supports the features that, as specified in clause 5.31, apply to the V-SMF in the case of Home Routed.\nNOTE:\tThis can require the SMF to subscribe onto I-SMF about RAT type change for a PDU Session as described in clause 4.23 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.9\tSupport of the Deployment Topologies with specific SMF Service Areas feature within and between PLMN(s)",
                            "text_content": "When Deployments Topologies with specific SMF Service Areas need to be used in a PLMN for a S-NSSAI, all AMF serving this S-NSSAI are configured to support Deployments Topologies with specific SMF Service Areas.\nNOTE 1:\tThe specifications do not support AMF selection related with Deployment Topologies with specific SMF Service Areas.\nFor HR roaming, the AMF discovers at PDU Session establishment whether a H-SMF supports V-SMF change based on feature support indication received from the NRF, possibly via the SCP. When the V-PLMN requires Deployments Topologies with specific SMF Service Areas but no H-SMF can be selected that supports V-SMF change, a H-SMF not supporting V-SMF change may be selected by the VPLMN. In that case, and if a V-SMF serving the full VPLMN is available, AMF should prefer to select such V-SMF.\nIn this release of the specifications, when an AMF detects the need to change the V-SMF while the H-SMF does not support V-SMF change, the AMF shall not trigger V-SMF change but shall trigger the release of the PDU Session.\nNOTE 2:\tThe AMF can determine whether the H-SMF supports V-SMF change based on NRF look up.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.34.10\tSupport for 5G LAN-type service",
                            "text_content": "This clause defines how 5GS supports 5G LAN-type service as defined in clause 5.29 in the case of deployments topologies with specific SMF Service Areas.\nThe UE may be connected with the PSA via an I-UPF which is controlled by the I-SMF. In this case, traffic switching (e.g. UPF local traffic switching) is controlled by the SMF as described in clause 5.29.4 without any specific knowledge or involvement of the I-SMF to support the 5G LAN-type service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.35\tSupport for Integrated access and backhaul (IAB)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.35.1\tIAB architecture and functional entities",
                            "text_content": "Integrated access and backhaul (IAB) enables wireless in-band and out-of-band relaying of NR Uu access traffic via NR Uu backhaul links. In this Release of the specification, NR satellite access is not applicable. The serving PLMN may provide the mobility restriction for NR satellite access as specified in clause 5.3.4.1\nThe Uu backhaul links can exist between the IAB-node and:\n-\ta gNB referred to as IAB-donor; or\n-\tanother IAB-node.\nThe part of the IAB node that supports the Uu interface towards the IAB-donor or another parent IAB-node (and thus manages the backhaul connectivity with either PLMN or SNPN it is registered with) is referred to as an IAB-UE.\nIn this Release of the specification, the IAB-UE function does not apply to the NR RedCap UE.\nAt high level, IAB has the following characteristics:\n-\tIAB uses the CU/DU architecture defined in TS 38.401 [42], and the IAB operation via F1 (between IAB-donor and IAB-node) is invisible to the 5GC;\n-\tIAB performs relaying at layer-2, and therefore does not require a local UPF;\n-\tIAB supports multi-hop backhauling;\n-\tIAB supports dynamic topology update, i.e. the IAB-node can change the parent node, e.g. another IAB-node, or the IAB-donor, during operation, for example in response to backhaul link failure or blockage.\nFigure 5.35.1-1 shows the IAB reference architecture with two backhaul hops, when connected to 5GC.\nThe IAB (Interoperability Architecture for 5G) architecture for 5GS is depicted in Figure 5.35.1-1, illustrating the interconnection of various components such as base stations (BSs), mobile stations (MSs), and access points (APs). The figure highlights the importance of inter-domain connectivity, with each domain having its own set of IAB components. The architecture is designed to ensure seamless communication between different domains, facilitating the efficient operation of 5G networks.\nFigure 5.35.1-1: IAB architecture for 5GS\nThe gNB-DU in the IAB-node is responsible for providing NR Uu access to UEs and child IAB-nodes. The corresponding gNB-CU function resides on the IAB-donor gNB, which controls IAB-node gNB-DU via the F1 interface. IAB-node appears as a normal gNB to UEs and other IAB-nodes and allows them to connect to the 5GC.\nThe IAB-UE function behaves as a UE, and reuses UE procedures to connect to:\n-\tthe gNB-DU on a parent IAB-node or IAB-donor for access and backhauling;\n-\tthe gNB-CU on the IAB-donor via RRC for control of the access and backhaul link;\n-\t5GC, e.g. AMF, via NAS;\n-\tOAM system via a PDU session or PDN connection (based on implementation).\nNOTE:\tThe 5GC, e.g. SMF, may detect that a PDU session for the IAB-UE is for the OAM system access, e.g. by checking the DNN and/or configuration. It is up to the operator configuration to choose whether to use 1 or multiple QoS Flows for OAM traffic and the appropriate QoS parameters, e.g. using 5QI=6 for software downloading, and 5QI=80 with signalled higher priority or a pre-configured 5QI for alarm or control traffic.\nThe IAB-UE can connect to 5GC over NR (SA mode) or connect to EPC (EN-DC mode). The UE served by the IAB-node can operate in the same or different modes than the IAB-node as defined in TS 38.401 [42]. The operation mode with both UE and IAB-node connected to EPC is covered in TS 23.401 [26]. Operation modes with UE and IAB-node connected to different core networks are described in clause 5.35.6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35.2\t5G System enhancements to support IAB",
                            "text_content": "In IAB operation, the IAB-UE interacts with the 5GC using procedures defined for UE. The IAB-node gNB-DU only interacts with the IAB-donor-CU and follows the CU/DU design defined in TS 38.401 [42].\nFor the IAB-UE operation, the existing UE authentication methods as defined in TS 33.501 [29] applies. Both USIM based methods and EAP based methods are allowed, and NAI based SUPIs can be used.\nThe following aspects are enhanced to support the IAB operation in the Registration procedure as defined in clause 4.2.2.2 of TS 23.502 [3]:\n-\tThe IAB-node provides an IAB-indication to the IAB-donor-CU when the RRC connection is established as defined in TS 38.331 [28]. When the IAB-indication is received, the IAB-donor-CU selects an AMF that supports IAB and includes the IAB-indication in the N2 INITIAL UE MESSAGE as defined in TS 38.413 [34] so that the AMF can perform IAB authorization;\n-\tthe UE Subscription data as defined in clause 5.2.3 of TS 23.502 [3] is enhanced to include the authorization information for the IAB operation;\n-\tAuthorization procedure during the UE Registration procedure is enhanced to perform verification of IAB subscription information;\n-\tIf the IAB operation is not authorized and IAB-UE is not allowed to be registered, the AMF rejects the IAB-UE's registration or de-register the IAB-UE. The AMF initiates UE Context setup/modification procedure by providing IAB authorized indication with the value set to \"not authorized\" to the NG-RAN, if the IAB-UE is still allowed to be registered;\n-\tIf the IAB operation is authorized, UE Context setup/modification procedure is enhanced to provide IAB authorized indication with the value set to \"authorized\" to NG-RAN.\nAfter registered to the 5G system, the IAB-node remains in CM-CONNECTED state if the IAB operation is authorized. In the case of radio link failure, the IAB-UE uses existing UE procedure to restore the connection with the network. The IAB-UE uses Deregistration Procedure as defined in clause 4.2.2.3 of TS 23.502 [3] to disconnect from the network. In the case of controlled IAB-node release as specified in clause 8.9.10 of TS 38.401 [42] (including the case when authorization state of the IAB-node is changed from authorized to non-authorized), after UE Context Modification message to NG-RAN with authorization indication as not authorized and after a certain period (e.g. based on the expiration of a timer configured on the AMF), the AMF may trigger the IAB-UE Deregistration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35.3\tData handling and QoS support with IAB",
                            "text_content": "Control plane and user plane protocol stacks for IAB operation are defined in TS 38.300 [27].\nQoS management for IAB can remain transparent to the 5GC. If NG-RAN cannot meet a QoS requirement for a QoS Flow to IAB-related resource constraints, the NG-RAN can reject the request using procedures defined in TS 23.502 [3].\nThe IAB-UE function can establish a PDU session or PDN connection, e.g. for OAM purpose (protocol stack not shown here). In that case, the IAB-UE obtains an IP address/prefix from the core network using normal UE procedures. The IAB-UE's IP address is different from that of the IAB-node's gNB DU IP address.\nNOTE:\tFor OAM traffic, based on their specific requirements, operators can select QoS characteristics and reference them by operator specific 5QI(s) or using signalled QoS characteristics within the operator's network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35.4\tMobility support with IAB",
                            "text_content": "For UEs, all existing NR intra-RAT mobility and dual-connectivity procedures are supported when the UE is served by an IAB-node except for the cases of NR satellite access. For a UE served by an IAB-node when the serving IAB-node changes its IAB-donor-CU due to mobility, the mobility support is specified in clause 5.35A.1 and clause 5.35A.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35.5\tCharging support with IAB",
                            "text_content": "IAB-donor has all the information regarding the UE and the IAB-node and corresponding mapping of the bearers. The PDU sessions for the UE and IAB-node are separate from IAB-node onwards to the core network. Therefore, the existing charging mechanism as defined in clause 5.12 can be used to support IAB.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35.6\tIAB operation involving EPC",
                            "text_content": "When the IAB-donor gNB has connection to both EPC and 5GC, based on PLMN configuration, there are two possible operation modes:\n-\tthe IAB-node connects to a 5GC via the IAB-donor gNB, while the UEs served by the IAB-node connect to EPC with Dual Connectivity as defined in TS 37.340 [31]. In this operation mode, the IAB-donor gNB has connection to an eNB, and the 5GC is restricted for IAB-node access only; and\n-\tthe IAB-node connects to an EPC via the IAB-donor gNB with Dual Connectivity as defined in TS 37.340 [31], while the UEs served by the IAB-node connect to the 5GC. In this operation mode, the EPC is restricted for IAB-node access only.\nTo support the above operation modes, the IAB-UE shall be configured to select only a specific PLMN (as defined in TS 23.122 [17]) and whether it needs to connect to 5GC or EPC.\nNOTE:\tFor a particular PLMN, it is expected that only one of the modes would be deployed in a known region.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.35A\tSupport for Mobile Base Station Relay (MBSR)",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.35A.1\tGeneral",
                            "text_content": "The MBSR uses the IAB architecture as defined in clause 5.35, and operates as an IAB node (with an IAB-UE and gNB-DU) with mobility when integrated with the serving PLMN. The architecture described in clause 5.35 applies unless specific handling is specified in clause 5.35A. Additionally, the following limitations apply to the MBSR:\n-\tthe MBSR has a single hop to the IAB-donor node;\n-\tNR Uu is used for the radio link between a MBSR and served UEs, and between MBSR and IAB-donor node.\nRegulatory requirements (e.g. emergency services, priority services) are supported when UEs access 5GS via a MBSR. LCS framework as defined in TS 23.273 [87] is used for providing the location service to the served UEs, with additional enhancements described in clause 5.35A.5.\nRoaming of the MBSR is supported, i.e. a MBSR can integrated with a VPLMN's IAB-donor node. The corresponding enhancements to support MBSR roaming are described in clause 5.35A.4.\nCAG mechanism as defined in clause 5.30 can be used for the control of UE's access to the MBSR. Optional enhancements to the CAG mechanism for MBSR use are described in clause 5.35A.6.\nFor a MBSR node to operate as a MBSR, it provides a mobile IAB-indication to the IAB-donor-CU when the RRC connection is established as defined in TS 38.331 [28]. When the mobile IAB-indication is received, the IAB-donor-CU selects an AMF that supports mobile IAB-node and includes the mobile IAB-indication in the N2 INITIAL UE MESSAGE as defined in TS 38.413 [34] so that the AMF can perform MBSR authorization as described in clause 5.35A.4. If the MBSR node is not authorized, e.g. due to the MBSR authorization indication from AMF, it also provides the mobile IAB-indication when establishing new RRC connection so that the AMF supporting mobile IAB-node will be selected by the IAB-donor-CU, to ensure that the operation related to MBSR authorization status change for a registered MBSR node can be performed as described in clause 5.35A.4. If the MBSR receives MBSR authorized indication from AMF, it provides the information about the authorization result to its IAB-DU component based on non-standardized interface as described in clause 5.35A.4.\nAfter the IAB-UE performs registration procedure in 5GS, further mobility procedure can be performed to change the IAB-donor-DU, the IAB-donor-CU as specified in TS 38.401 [42]. The mobility support of UEs served by the MBSR is specified in clause 5.35A.3\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.2\t\tConfiguration of the MBSR",
                            "text_content": "In order for an MBSR to operate as a mobile IAB node, it receives configuration from the OAM system of the serving PLMN as specified in TS 38.401 [42]. The MBSR IAB-UE establishes a secure and trusted connection to the OAM server only if it is authorized to operate as MBSR in the serving PLMN as defined in TS 38.401 [42].\nIn addition, the MBSR(IAB-UE) is assumed to be configured with preferred PLMN lists and forbidden PLMNs by the HPLMN to perform PLMN selection as specified in TS 23.122 [17].\nWhen a PDU session is used for the MBSR to access the OAM server, the MBSR establishes a dedicated PDU session for the OAM traffic. The serving PLMN provides an Allowed NSSAI and establishes the PDU session for the OAM server access, considering the S-NSSAI and DNN requested by MBSR and/or the default values in subscription data. The MBSR can be (pre-)configured with UE policy or provisioned using existing UE Policy mechanism as defined in TS 23.503 [45] including the OAM access PDU session parameters for the authorized PLMNs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.3\tMobility support of UEs served by MBSR",
                            "text_content": "The procedure of Inter-gNB-DU Mobility as defined in TS 38.401 [42] or the handover procedure using the Xn/N2 reference points as defined in TS 23.502 [3] can be used.\nFor UEs in RRC_IDLE and RRC_INACTIVE state when a MBSR goes out-of-service, procedure for cell (re-)selection as specified in TS 38.304 [50] for RRC_IDLE and RRC_INACTIVE is used.\nFor UEs in RRC_CONNECTED state, if the MBSR goes out-of-service due to e.g. MBSR moves to an area where the MBSR is not allowed to provide the relay service, the procedure for IAB node release as specified in TS 38.401 [42] is used.\nThe IAB-donor-CU triggers handover procedure when it is possible for the UEs accessing emergency service and being served by the MBSR, if MBSR is about to become unavailable to provide the services.\nSimilar to the behaviours described in clause 5.35A.3.1, UEs use existing procedures defined in TS 38.401 [42], TS 23.502 [3], or TS 38.304 [50] to handle the mobility between MBSR cells.\nThe TAC broadcasted by the MBSR cell(s) can be configured by the OAM or donor-CU. When MBSR moves to a serving cell with a different TAC, the TAC to be broadcasted by the MBSR may also change.\nFor a UE served by a MBSR cell, it may observe change of TAC and/or cell IDs, even if it is still connected to the same MBSR. This can trigger mobility registrations, as defined in TS 23.502 [3], if the new TAC is not in the TAI list in the RA.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.4\tMBSR authorization",
                            "text_content": "For a MBSR, the subscription information stored in the HPLMN indicates whether it is authorized to operate as MBSR, and the corresponding location and time information as specified in TS 23.502 [3].\nNOTE 1:\tFor non-roaming MBSRs, the operator local policy can be taken into consideration for MBSR authorization, e.g. based on the network status, or a limit on the number of MBSRs operating in a certain area.\nWhen the MBSR (IAB-UE) performs initial registration with the serving PLMN, it indicates the request to operate as a MBSR as described in clause 5.35A.1. The AMF authorizes the MBSR based on the subscription information, and provides MBSR authorized indication to the MBSR node over NAS and NG-RAN over NGAP as described in the registration procedure in TS 23.502 [3]. The MBSR establishes the connection to OAM system using the configuration information for MBSR operation upon the reception of MBSR authorization indication (authorized). The MBSR provides the information about the authorization result (authorized) to its IAB-DU component. When the AMF formulates the registration area for an authorized MBSR, the TAs included in the registration area are authorized for MBSR operation homogenously, taking any MBSR Operation allowed information in subscription data and operator local policy into account.\nNOTE 2:\tThe MBSR support can be deployed in certain Network Slices based on operator configuration and Network slicing functionalities (e.g. the function specified in clause 5.15.18) can be applied when suitable.\nWhen MBSR roaming is supported, a roaming agreement between VPLMN and HPLMN regarding MBSR operation is in place. The AMF can make use of the subscription data for authorization of the MBSR in the V-PLMN.\nMBSR (IAB-DU) can use IAB-node integration procedure or inter-IAB-donor gNB mobility procedure to integrate into the serving PLMN to provide service.\nNOTE 3:\tHow the MBSR obtains the configuration information for MBSR operation is described in clause 5.35A.2.\nIf the MBSR operation is not authorized (e.g. due to location or time limitation), the AMF of the MBSR can indicate to the MBSR IAB-UE that it is not allowed to act as an MBSR, i.e. the MBSR authorization indication (not authorized), as part of registration procedure. The AMF may provide the indication in a Registration Accept (if the PLMN allows the MBSR IAB-UE to be registered in the PLMN). In this case, the AMF includes the MBSR authorization indication (not authorized) to donor-gNB. The MBSR provides the information about the authorization result (not authorized) to its IAB-DU component. The AMF may reject the Registration (if the PLMN does not allow the MBSR IAB-UE to be registered in the PLMN).\nEditor's note:\tThe details of the additional information and corresponding MBSR behaviour will be added.\nWhen the MBSR authorization state changes for a registered MBSR node (either authorized, or not authorized), the AMF updates the MBSR and the NG-RAN accordingly. Based on the operator configuration, the AMF may use either Deregistration (with re-registration required indication) or the UE Configuration Update procedure to inform the MBSR regarding the updated authorization status:\n-\tWhen Deregistration (with re-registration required indication) procedure is used, AMF provides the new authorization indication to MBSR (IAB-UE) as described above, when the MBSR performs initial Registration procedure after the deregistration.\n-\tWhen UE Configuration Update procedure is used, the AMF provides the new authorization indication and additional information to the MBSR in the UE Configuration Update Command. The MBSR provides the information about the new authorization status to its IAB-DU component.\nThe AMF informs the NG-RAN of the new authorization status using UE Context Modification, Initial Context Setup procedure or the DOWNLINK NAS TRANSPORT message, with the following principles:\n-\tIf the authorization state changes from authorized to not authorized and AMF uses the UE Configuration Updated procedure to update the MBSR, the AMF updates the NG-RAN with the new authorization indication (not authorized) by including this information in the DOWNLINK NAS TRANSPORT message. The NG-RAN completes handover of the UEs served by the MBSR before releasing the F1 connection to the MBSR IAB-DU.\n-\tIf the authorization state changes from authorized to not authorized and the AMF uses the Deregistration procedure to update the MBSR, the AMF sends the UE Context Modification message to NG-RAN and after a certain period (e.g. based on the expiration of a timer configured on the AMF) the AMF executes the deregistration procedure with MBSR and releases the NAS signalling connection.\nIf the Network-initiated Deregistration procedure is triggered for MBSR IAB-UE that is registered with authorization to act as MBSR, the AMF sends the UE Context Modification message to NG-RAN and updates the NG-RAN with the authorization indication as not authorized and after a certain period (e.g. based on the expiration of a timer configured on the AMF) the AMF executes the deregistration procedure with MBSR and releases the NAS signalling connection.\nNOTE 4:\tThe AMF delays the MBSR de-registration to allow the IAB-donor gNB to move all connected UEs via MBSR to other cells as specified in clause 8.9.10 of TS 38.401 [42].\nIf a PDU session is used to provide OAM access for MBSR when it is not authorized but remains registered, the AMF may notify the SMF serving the PDU session for O&M access to trigger the release of the PDU Session.\nNOTE 5:\tThe mechanism applies to both roaming and non-roaming MBSR operations.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.5\tLocation Service Support of UEs served by MBSR",
                            "text_content": "When a UE accesses 5GS via a MBSR, it can use the location service as defined in TS 23.273 [87]. However, in order to provide accurate estimation of the UE location, LMF needs to take the location of the MBSR into account. Enhancements to the LCS framework for MBSR support is described in clause 5.9 of TS 23.273 [87].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.6\tProviding cell ID/TAC of MBSR for services",
                            "text_content": "The TAC and cell ID broadcasted by the MBSR cell(s) are configured as specified in TS 38.470 [165].\nAfter the MBSR is authorized as defined in 5.35A.4, when a UE is served by a cell of this MBSR, the IAB-donor-CU may provide 'Additional ULI' in addition to User Location Information, in N2 messages. The 'Additional ULI' is the ULI of the IAB-UE. The AMF may consider the 'Additional ULI' when it determines UE location and manages the UE location related functions (e.g. Mobility Restrictions).\nWhen the AMF provides user location information to other NFs (e.g. LMF as specified in clause 5.9 of TS 23.273 [87]) for a UE connected via MBSR, the AMF may also send the Additional ULI received via N2 messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.35A.7\tControl of UE access to MBSR",
                            "text_content": "CAG Identifier is used to control the access of UE via MBSR (i.e. mobile IAB-node) and existing CAG mechanism defined in clause 5.30.3 can be used for managing UE's access to MBSR, with the following additional considerations:\n-\tWhen the MBSR is allowed to operate as an IAB node for a PLMN, the MBSR is configured, either during the communication with the serving PLMN OAM or (pre-)configuration mechanism, with a CAG identifier which is unique within the scope of this PLMN. If the MBSR is (pre-)configured with the PLMN list in which the MBSR is allowed to operate as MBSR, the corresponding CAG Identifier per PLMN is also configured in the MBSR.\nNOTE 1:\tThe CAG for MBSR is supported as part of the PNI-NPN concept described in clause 5.30.3.\n-\tNG-RAN and 5GC support the UE access control based on the CAG identifier associated with the MBSR cell and the allowed CAG identifiers for the UE that supports CAG functionality.\n-\tFor the UE that does not support CAG functionality, NG-RAN and 5GC are allowed to use not only CAG mechanism but also the other existing mechanism e.g. forbidden Tracking Area, to manage its access to MBSR.\n-\tTime duration restriction may be provided together with the CAG Identifier(s) for the MBSR(s) that the UE can access. The enhanced Allowed CAG list will be provided to UE and AMF for enforcement, to make sure that UE not accessing the MBSR cell outside of the time duration. For example, if the time when a certain CAG is allowed for a UE is up, the CAG for the UE is revoked from the network.\nNOTE 2:\tControl of the MBSR access to the serving network is based on normal mobility restriction management based on subscription data form MBSR (i.e. IAB-UE).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.36\tRIM Information Transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "The purpose of RIM Information Transfer is to enable the transfer of RIM information between two RAN nodes via 5GC. The RIM Information Transfer is specified in TS 38.413 [34].\nWhen the source AMF receives RIM information from source NG-RAN towards target NG-RAN, the source AMF forwards the RIM information to the target AMF, as described in TS 38.413 [34] and TS 29.518 [71]. The AMF does not interpret the transferred RIM information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.37\tSupport for high data rate low latency services, eXtended Reality (XR) and interactive media services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.37.1\tGeneral",
                            "text_content": "This clause provides an overview of 5GS functionalities for support of XR services (AR/VR applications) and interactive media services that require high data rate and low latency communication, e.g. cloud gaming and tactile/multi-modal communication services according to service requirements documented in TS 22.261 [2]. The standardized 5QI characteristics for such interactive services are provided in Table 5.7.4-1 and TSCAI is used to describe the related traffic characteristics as defined in clause 5.27.2. Further enhancements for these interactive media services are as follows:\n-\tThe 5GS may support QoS policy control for multi-modal traffic, see clause 5.37.2.\n-\tThe 5GS may support network information exposure which can be based on ECN markings for L4S, see clause 5.37.3 or 5GS exposure API, see clause 5.37.4.\n-\tThe 5GS may support PDU Set based QoS handling including PDU Set identification and marking, see clause 5.37.5.\n-\tThe 5GS may ensure that the UL and DL packets together meet the requested round trip delay and also update the delay for UL and DL considering QoS monitoring results, see clause 5.37.6.\n-\tThe 5GS may perform per-flow Packet Delay Variation (PDV) monitoring and policy control according to AF provided requirements, see clause 5.37.7.\n-\tThe 5GC may provide traffic assistance information to the NG-RAN to enable Connected mode DRX power saving, see clause 5.37.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.2\tPolicy control enhancements to support multi-modal services",
                            "text_content": "A multi-modal service is a communication service that consists of several data flows that relate to each other and that are subject to application coordination. The data flows can transfer different types of data (for example audio, video, positioning, haptic data) and may come from different sources(e.g. a single UE, a single device or multiple devices connected to the single UE, or multiple UEs).\nFor the single UE case, it is expected that those data flows are closely related and require strong application coordination for the proper execution of the multi-modal application and therefore, all those data flows are transmitted in a single PDU session.\nThe Nnef_AFsessionWithQoS service allows the AF to provide, at the same time, for each data flow that belongs to the multi-modal service, a Multi-modal Service ID, the service requirements and the QoS monitoring requirements:\n-\tThe Multi-modal Service ID is an explicit indication that data flows are related to a multi-modal service. The PCF may use this information to derive the correct PCC rules and to apply appropriate QoS policies for the data flows that are part of a specific multi-modal application.\n-\tThe AF may provide QoS monitoring requirements for data flows associated to a multi-modal service to the PCF . The PCF generates the authorized QoS Monitoring policy for each data flow.\nNOTE:\tIn order to start the QoS monitoring for the data flows associated to a multi-modal service within a certain period of time, the PCF needs to receive the QoS monitoring requirements for those data flows from AF within a single request or, in case of multiple requests, within a short period of time.\nIn addition to the features that are provided for the case that the data flows are associated with a single UE, the following features are provided for the case where the data flows are associated with more than one UE:\n-\tThe same DNN/S-NSSAI combination for the multi-modal service should be selected by each of the involved UEs. The URSP Rule evaluation framework is used to ensure that the same DNN/S-NSSAI is selected.\n-\tThe AF should use the same Multi-modal Service ID in the interactions with the PCF(s) for all the involved UEs that relate to a multi-modal service. The PCF may take this information into account (e.g. to apply a specific QoS policy) when processing each AF request independently. The data flows contribute to the service experience, but are still valid stand-alone, as they are transmitted over separate PDU Sessions to/from the involved UEs.\n-\tIf multiple PCFs are involved, the PCFs take policy decisions according to the input provided by the AF. There is no support for policy coordination among the multiple PCFs in this Release of the specification. Policy decisions are taken by each PCF separately on a per PDU Session basis.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.3\tSupport of ECN marking for L4S to expose the congestion information",
                            "text_content": "L4S (Low Latency, Low Loss and Scalable Throughput) is described in IETF RFC 9330 [159], IETF RFC 9331 [160] and IETF RFC 9332 [161]. It exposes congestion information by marking ECN bits in the IP header of the user IP packets between the UE and the application server to trigger application layer rate adaptation.\nIn 5G System, ECN marking for L4S may be supported. ECN marking for L4S is enabled on a per QoS Flow basis in the uplink and/or downlink direction and may be used for GBR and non-GBR QoS Flows. ECN marking for the L4S in the IP header is supported in either the NG-RAN (see clause 5.37.3.2 and TS 38.300 [27]), or in the PSA UPF (see clause 5.37.3.3).\nNOTE 1:\tBased on operator's network configuration and policies, SMF decides whether NG-RAN or PSA UPF based ECN marking for L4S is used.\nIn the case of ECN marking for L4S by PSA UPF, the NG-RAN is instructed to perform congestion information monitoring and report to the PSA UPF the congestion information (i.e. a percentage of packets that UPF uses for ECN marking for L4S) of the QoS Flow on UL and/or DL directions via GTP-U header extension to PSA UPF.\nNOTE 2:\tAs for any QoS Flow, QoS rules in the UE and PDRs in the PSA UPF control which packets are bound to the L4S enabled QoS flow. The Packet Filter Set in the QoS rule or PDR can use packet filter(s) in clause 5.7.6.2 (e.g. match packets with ECT(1) or CE (See RFC 9331 [160]) together with IP 5 tuple) to steer traffic to an L4S enabled QoS Flow.\nNOTE 3:\tA QoS Flow may be enabled with ECN marking for L4S requirement e.g. statically when a PDU session is established based on configuration in SMF or PCF, or dynamically based on detection of the L4S traffic (e.g. match packets with ECT(1) or CE (See RFC 9331 [160]) together with IP 5 tuple) in the IP header whereby SMF or PCF triggers a setup of a QoS Flow enabled for L4S, or by requests by an AF.\nNOTE 4:\tTo support this functionality, the UE needs to support L4S feedback as described in IETF RFC 9330 [159], which is not in the scope of 3GPP.\nWhen serving PSA UPF or NG-RAN is changed e.g. due to inter-NG-RAN handover or PSA UPF relocation, target NG-RAN and target PSA UPF, if supported, should continue to perform ECN marking for L4S for the QoS Flow. However, if not available (i.e. ECN marking for L4S is not supported in both, target NG-RAN and target PSA UPF), AF should be notified when ECN marking for L4S had been enabled for the QoS Flow based on AF request.\nECN marking for L4S may be supported in NG-RAN as specified in TS 38.300 [27].\nTo enable ECN marking for L4S in NG-RAN, dedicated QoS Flow(s) are used for carrying L4S enabled IP traffic. The SMF may be instructed, based on either dynamic or predefined PCC rule, to provide an indication for ECN marking for L4S to NG-RAN for a corresponding QoS Flow(s) in UL and/or DL directions. In the absence of such PCC rule, the use of ECN marking for L4S in NG-RAN on a QoS Flow is controlled by a coordinated configuration in NG-RAN and 5GC.\nThe criteria based on which NG-RAN decides to mark ECN bits for L4S is NG-RAN implementation specific.\nIn the case of inter NG-RAN UE mobility, if the ECN marking for L4S has been enabled on source NG-RAN, but the target NG-RAN does not support ECN marking for L4S, then the SMF may, if supported, enable ECN marking for L4S in PSA UPF as defined in clause 5.37.3.3.\nTo enable ECN marking for L4S by a PSA UPF, a QoS Flow level ECN marking for L4S indicator may be sent by SMF to PSA UPF over N4. SMF also indicates to NG-RAN to report the congestion information (i.e. a percentage of packets that UPF uses for ECN marking for L4S) of the QoS Flow on UL and/or DL directions via GTP-U header extension to PSA UPF. If there is no UL packet when report for DL and/or UL needs to be provided, NG-RAN may generate an UL Dummy GTP-U Packet for such a reporting.\nThe SMF may be instructed, based on either dynamic or predefined PCC rule, to provide an indication for ECN marking for L4S to PSA UPF for a corresponding QoS Flow(s) in UL and/or DL directions.\nUpon successful activation of congestion information reporting for UL and/or DL directions, PSA UPF uses information sent by NG-RAN in GTP-U header extension (see TS 38.415 [116] and TS 38.300 [27]) to perform ECN bits marking for L4S for the corresponding direction.\nNOTE:\tHow the congestion information is converted to ECN markings is UPF implementation specific.\nThe criteria based on which NG-RAN decides to provide the congestion information is up to NG-RAN implementation.\nIn the case of PSA UPF relocation, if the ECN marking for L4S has been enabled on source PSA UPF, SMF should select a target PSA UPF supporting ECN marking for L4S. If the target PSA UPF does not support ECN marking for L4S, then SMF may, if supported, switch to ECN marking for L4S in target NG-RAN by following clause 5.37.3.2. In such case, the target NG-RAN stops sending congestion information to the target PSA UPF.\nIn the case of inter NG-RAN UE mobility, if the congestion information reporting has been enabled on source NG-RAN while the target NG-RAN does not support congestion information reporting, then the SMF shall inform PSA UPF to stop ECN marking for L4S. If ECN marking for L4S is supported by the target NG-RAN, the SMF may instruct the target NG-RAN to perform ECN marking for L4S in NG-RAN by following clause 5.37.3.2. For a given QoS Flow, if the target NG-RAN supports congestion information reporting, the target NG-RAN shall report congestion information to UPF once it is available.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.4\tNetwork Exposure of 5GS information",
                            "text_content": "5GS and XR/media services cooperate to provide a better user experience using External Network Exposure.\nBased on the AF request, the 5GS can expose the following information based on the QoS Monitoring as defined in clause 5.33.3 and/or clause 5.45:\n-\tThe UL and/or DL congestion information monitoring (see clause 5.45.3).\nBased on the PCC rule from PCF, the SMF requests the NG-RAN to report the information via GTP-U header to PSA UPF. This NG-RAN reported information is common to support congestion information exposure and to support ECN marking for L4S in PSA UPF as described in clause 5.37.3.3. In the case of congestion information exposure, the PSA UPF exposes the UL and/or DL congestion information via Nupf_EventExposure service or via SMF/PCF/NEF as described in clause 5.8.2.18. It can be applied to a Non-GBR or GBR QoS Flow.\n-\tThe UL and/or DL Data rate information (see clause 5.45.4).\nBased on the PCC rule from PCF, the SMF requests the PSA UPF to measure and report the information. They may be exposed to the AF directly by PSA UPF via Nupf_EventExposure service or via SMF/PCF/NEF as described in clause 5.8.2.18.\n-\tThe round trip delay for two service data flows considering the UL direction of a service data flow and the DL direction of another service data flow. in the same PDU Session.\nIt is determined based on the QoS Monitoring for packet delay of individual QoS Flows as described in clause 5.33.3. The PCF derives the separate QoS monitoring policies for each direction packet delay (see clause 5.33.3) based on AF request and local policy. The PCF provides the two QoS Monitoring policies in the PCC rules for the service data flows. The PSA UPF reports the delay information per QoS Flow to the SMF. The SMF reports to PCF. The PCF derives round trip delay information based on the two direction's packet delay result for the service data flows and exposes the information to the AF directly or via NEF.\n-\tThe round trip delay for one service data flow.\nIf the service data flow is mapped to two QoS Flows (i.e. the UL traffic and DL traffic of the service data flow are separated into two QoS flows respectively) in the same PDU Session, similarly to the round trip delay for two service data flows over two QoS flows, the PCF triggers QoS Monitoring for each direction packet delay of individual QoS flows respectively and derives round trip delay based on the two direction QoS flows' packet delay monitored result.\nNOTE:\tHow PCF calculates the requested round trip delay for multiple QoS Flows from delays of individual QoS Flows is not specified in this specification.\nThe AF may provide the Alternative QoS parameter set requirements and Averaging Window to the NEF/PCF for the GBR QoS Flow as specified in clause 4.15.6.6 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.5\tPDU Set based Handling",
                            "text_content": "A PDU Set is comprised of one or more PDUs carrying an application layer payload such as a video frame or video slice. The PDU Set based QoS handling by the NG-RAN is determined by PDU Set QoS Parameters in the QoS profile of the QoS Flow (specified in clause 5.7.7) and PDU Set information provided by the PSA UPF via N3/N9 interface as described in clause 5.37.5.2. The PDU Set based QoS Handling can be applied for GBR and non-GBR QoS Flows.\nThe AF should provide PDU Set related assistance information for dynamic PCC control. One or more of the following PDU Set related assistance information may be provided to the NEF/PCF using the AF session with required QoS procedures in clauses 4.15.6.6 and 4.15.6.6a of TS 23.502 [3].\n-\tPDU Set QoS Parameters as described in clause 5.7.7\n-\tProtocol Description: Indicates the transport protocol used by the service data flow (e.g. RTP, SRTP) and information, e.g. the following:\n-\tRTP [185] or SRTP [186];\n-\tRTP or SRTP with RTP Header Extensions, including:\n-\tRTP Header Extensions for PDU Set Marking as defined in TS 26.522 [179];\n-\tOther RTP Header Extensions as defined RFC 8285 [189];\n-\tRTP or SRTP without RTP Header Extensions, but together with RTP Payload Format (e.g. H.264 [187] or H.265 [188]);\n-\tRTP or SRTP with RTP Header Extensions for PDU Set Marking as defined in TS 26.522 [179], and together with RTP Payload Format (e.g. H.264 [187] or H.265 [188]);\n-\tRTP or SRTP with other RTP Header Extensions following RFC 8285 [189], and together with RTP Payload Format (e.g. H.264 [187] or H.265 [188]).\nWhen RTP Header Extensions for PDU Set Marking (as defined in TS 26.522 [179] or other RTP header extensions as defined in RFC 8285 [189] is included, the differentiation between different RTP Header Extension Types should be supported.\nWhen RTP Payload Format is included, the differentiation between different RTP Payload Formats should be supported.\nNOTE 1:\tMultiplexing of different transport protocols and different media traffic for differentiated PDU Set QoS handling is not supported in the current Release.\nAF provided PDU Set QoS Parameters and Protocol Description may be used in determining the PCC Rule by the PCF as defined in clause 6.1.3.27.4 of TS 23.503 [45] and the Protocol Description may be used for identifying the PDU Set information by the PSA UPF.\nWhen the SMF receives the PCC rule, the SMF performs binding of the PCC rule to one QoS Flow as described in clause 6.1.3.2.4 of TS 23.503 [45]. If the PCC rule contains one or more PDU Set QoS Parameters (PSER, PSDB and PSIHI), the SMF adds these PDU Set QoS parameters to the QoS Profile of the QoS Flow as described in clause 6.2.2.4 of TS 23.503 [45]. Alternatively, the SMF may be configured to support PDU Set based QoS Handling without receiving PCC rules from a PCF.\nFor the downlink direction, the PSA UPF identifies PDUs that belong to PDU Sets and marks them accordingly as described in clause 5.37.5.2. If the PSA UPF receives a PDU that does not belong to a PDU Set based on Protocol Description for PDU Set identification, then the PSA UPF still maps it to a PDU Set and determines the PDU Set Information as described in clause 5.37.5.2.\nNOTE 2:\tIf the PSA UPF receives a PDU that does not belong to a PDU Set, then it is assumed that the UPF determines the PDU Set Importance value based on pre-configuration.\nFor the uplink direction, the UE may identify PDU Sets, and how this is done is left up to UE implementation. The SMF may send Protocol Description associated with the QoS rule to UE.\nNOTE 3:\tUsing the Protocol Description or not is left to UE implementation. The use of Protocol Description does not impact QoS Flow Mapping in the UE.\nIn this Release, the PDU Set based QoS handling is supported in 5GS for UE registered in 3GPP access for single access PDU Session with IP PDU Session Type.\nTo support PDU Set based QoS handling, the PSA UPF identifies PDUs that belong to PDU Sets and determines the below PDU Set Information which it sends to the NG-RAN in the GTP-U header. The PDU Set information is used by the NG-RAN for PDU Set based QoS handling as described above.\nThe PDU Set Information comprises:\n-\tPDU Set Sequence Number.\n-\tIndication of End PDU of the PDU Set.\n-\tPDU Sequence Number within a PDU Set.\n-\tPDU Set Size in bytes.\n-\tPDU Set Importance, which identifies the relative importance of a PDU Set compared to other PDU Sets within a QoS Flow.\nThe NG-RAN may use the Priority Level (see clause 5.7.3.3) across QoS Flows and PDU Set Importance within a QoS Flow for PDU Set level packet discarding in presence of congestion.\nNOTE 1:\tIn addition to considering the PDU Set Importance within a QoS Flow, NG-RAN could also consider the relative PDU Set Importance across QoS Flows of the same Priority Level when determining which PDU Set needs to be discarded, which is up to implementation and configuration of operator.\nNOTE 2:\tThe PDU Set Information can be different for different PDU Sets within a QoS Flow.\nThe SMF instructs PSA UPF to perform PDU Set marking and may provide the PSA UPF the Protocol Description used by the service data flow. The Protocol Description may be received in the PCC rule, based on information provided by the AF or by PCF local policies as described in clause 5.37.5.1.\nPSA UPF can identify the PDU Set Information using the Protocol Description and the received transport protocol headers and payload or using implementation specific means. The details of the RTP/SRTP headers, header extensions and/or payloads used to identify PDU Set Information are defined in TS 26.522 [179].\nFor each DL PDU received on N6 for which PDU Set based QoS handling is indicated from the SMF, the PSA UPF applies the rules for PDU Set identification and provides the available PDU Set Information to the RAN in the GTP-U header.\nNOTE 3:\tThe PSA UPF is expected to assign a unique PDU Set Sequence Number in the GTP-U header to each PDU Set of the QoS Flow.\nBy sending at least one PDU Set QoS parameter to the NG-RAN, the SMF requests the NG-RAN to activate PDU Set QoS handling for a given QoS flow and the NG-RAN provides the SMF with an indication of whether the PDU Set based handling is supported. Based on this indication, SMF may activate the PDU Set identification and marking in the PSA UPF.\nFor the mobility procedures that may result in the change of NG-RAN for PDU Set based handling support, the target NG-RAN provides to the SMF with an indication of whether the target NG-RAN node supports PDU Set based handling, as specified in TS 38.413 [34]. Based on the target NG-RAN indication, the SMF may, upon completion of the mobility procedure, initiate the PDU Session modification procedure to provide PDU Set QoS parameters to NG-RAN and may configure the PSA UPF to activate/deactivate the PDU Set identification and marking.\nIn the case where the PSA UPF identifies and marks PDUs with PDU Set information in GTP-U header, it shall start doing so from a complete PDU Set.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.6\tUL/DL policy control based on round-trip latency requirement",
                            "text_content": "For XR and other interactive media services that require very low Round-Trip (RT) latency, Uplink-Downlink policy control may be supported to meet the RT latency requirement. RT latency requirement is the upper bound for the sum of UL delay and DL delay of a single data flow or two different data flows between UE and N6 termination point at the UPF. PCF may support Uplink-Downlink policy control based on RT latency requirement based on an RT latency indication from AF (as defined in clause 6.1.3.27.2 of TS 23.503 [45]) during the AF session with the required QoS procedure as defined in clause 4.15.6.6 of TS 23.502 [3].\nThe AF can provide an RT latency indication with a single direction delay requirement between the UE and the PSA UPF expressed as the QoS Reference parameter or individual QoS parameters (as defined in clause 6.1.3.22 of TS 23.503 [45]). The RT latency indication indicates the need to meet the RT latency requirement for data flow, i.e. doubling of the single direction delay requirement between the UE and the PSA UPF expressed by the QoS Reference parameter or individual QoS parameter.\nPCF determines the data flow's UL PDB and DL PDB based on the RT latency requirement. The UL PDB and DL PDB can be unequal, but their sum shall not exceed the RT latency requirement. The PCF shall generate two PCC rules, one for UL QoS flow for UL traffic of the data flow and one for DL QoS flow for DL traffic of the data flow, respectively. PCF shall assign the 5QIs for each of these two PCC rules according to the derived UL PDB and DL PDB.\nTo support UL and DL delay tracking, the QoS monitoring for UL packet delay and the DL packet delay (as defined in clause 6.1.3.21 of TS 23.503 [45]) shall be triggered respectively to request tracking the UL packet delay of the QoS flow used in UL and DL packet delay of the QoS flow used in DL independently. Based on the QoS monitoring results, the PCF may readjust the UL PDB and/or DL PDB under the consideration of the RT latency requirement to better fit the new situation.\nThe Uplink-Downlink policy control based on round-trip latency requirement for two unidirectional service data flows is described in clause 6.1.3.27.2 of TS 23.503 [45].\nNOTE:\tHow the PCF derives the round-trip latency and takes policy decisions is up to the implementation.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.7\t5GS Packet Delay Variation monitoring and reporting",
                            "text_content": "The 5GS Packet Delay Variation is the variation of packet delay measured between UE and PSA UPF. The AF may send the requirement for Packet Delay Variation monitoring to 5GS together with the requirement for packet delay measurement, as described in clause 6.1.3.21 of TS 23.503 [45].\nUpon AF request for Packet Delay Variation monitoring together with packet delay monitoring, the PCF triggers the QoS monitoring procedure, and gets the UL, DL or RT QoS Monitoring result from the SMF. The PCF derives the 5GS Packet Delay Variation based on the QoS Monitoring result and then reports to the AF/NEF both packet delay measurements and Packet Delay Variation.\nNOTE:\tThe derivation of 5GS Packet Delay Variation by PCF, based on QoS Monitoring, is implementation dependent. The Packet Delay Variation calculation method needs to be the same within the PLMN, based on operator policy.\nQoS Monitoring is used to obtain measurement of QoS parameters of individual QoS Flows. PCF determines the measurements required based on input from AF and enables the measurements by generating an authorized QoS Monitoring Policy for the PCC Rule as specified in clause 6.1.3.21 of TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.37.8\tUE power saving management",
                            "text_content": "The following traffic assistance information may be provided by the CN to NG-RAN in order to configure UE power saving management scheme for connected mode DRX:\n-\tUL and/or DL Periodicity;\n-\tN6 Jitter Information associated with the DL Periodicity;\n-\tIndication of End of Data Burst.\nThe UL and/or DL Periodicity and N6 Jitter Information associated with the DL Periodicity are provided by the CN to NG RAN via TSCAI.\nIn the procedures for setting up or updating an AF session with QoS, the 5G System may be provided with UL/DL Periodicity information for NG-RAN to configure UE power management for connected mode DRX. The UL/DL Periodicity information is provided by the AF to the PCF via NEF or directly to the PCF when the AF is trusted.\nIf UL/DL Periodicity information is available at the PCF, the PCF sends the Periodicity information received from the AF/NEF to the SMF. In accordance with the operator's local policies, the PCF may include an indication for SMF to request the UPF to perform N6 Traffic Parameter(s) measurement (i.e. N6 Jitter Information associated with the DL Periodicity and if not provided by the AF, UL/DL periodicity) within the PCC Rules.\nUpon reception of a PCC rule with Periodicity information, the SMF determines the TSCAI and forwards it to the NG-RAN. If the PCC rule indicates to perform N6 Traffic Parameter measurements, the SMF shall request the UPF to monitor and periodically report the N6 Traffic Parameters (i.e. the N6 Jitter Information associated with the DL Periodicity and, if not provided by the AF, UL/DL periodicity) using the N4 Session Modification procedure, see clause 5.8.5.11. If the measurement of N6 Jitter Information associated with the DL Periodicity is required and the DL Periodicity is available at the SMF, the SMF also sends the DL Periodicity to the UPF. The UPF reports the measured N6 Traffic Parameters to SMF via N4 interface.\nNOTE 1:\tHow the UPF derives the N6 jitter and periodicity (i.e. when periodicity is not provided by the AF) is implementation dependent.\nAt reception of measured N6 Traffic Parameter(s) from the UPF in the N4 Session Level Report, the SMF includes the N6 Jitter Information associated with the DL Periodicity together with the DL periodicity and the UL periodicity if not provided by the AF in the TSCAI and forwards it to the NG-RAN in an NGAP message, see clause 5.27.2.\nNOTE 2:\tIn order to prevent frequent updates from the UPF, the UPF sends the N6 Jitter Measurement Report periodically or only when the N6 jitter is larger than a threshold.\nThe N6 Jitter Information associated with the DL Periodicity indicates the range of the positive or negative deviation of the arrival time of first arrived packet of a Data Burst compared to the ideal Data Burst start time which is be determined based on the DL periodicity.\nAn indication of End of Data Burst may be provided to the NG-RAN by the UPF, e.g. to configure UE power management schemes like connected mode DRX.\nBased on the End of Data Burst Marking Indication in a PCC rule and/or on local operator policies, SMF should request the UPF to detect the last PDU of the data burst and mark the End of Data burst in the GTP-U header of the last PDU in downlink. The SMF may provide the PSA UPF the End of Data Burst Marking Indication and Protocol Description used by the service data flow. The Protocol Description may be received in the PCC rule, based on information provided by the AF or by PCF local policies as described in clause 5.37.5.1.\nAccording to the request and information from the SMF, the UPF identifies the last PDU of a Data burst in the DL traffic based on the End indication according to the Protocol Description or UPF implementation and provides an End of Data Burst indication to the NG-RAN over GTP-U of the last PDU of a Data burst.\nNOTE:\tThere can be some packets from the Data Burst received by NG-RAN after the PDU with End of Data Burst Indication if packets are received out of sequence.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.38\tSupport for Multi-USIM UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.38.1\tGeneral",
                            "text_content": "A network and a Multi-USIM UE may support one or more of the following features for Multi-USIM UE operation:\n-\tConnection Release as described in clause 5.38.2;\n-\tPaging Cause Indication for Voice Service, as described in clause 5.38.3;\n-\tReject Paging Request, as described in clause 5.38.4;\n-\tPaging Restriction, as described in clause 5.38.5;\n-\tPaging Timing Collision Control, as described in clause 5.38.6.\nIn the Registration procedure (as specified in clause 4.2.2.2.2), when a Multi-USIM UE has more than one USIM active, supports and intends to use one or more Multi-USIM specific features, it indicates to the AMF the corresponding Multi-USIM feature(s) are supported (except for the Paging Timing Collision Control feature). Based on the received indication of the supported Multi-USIM features from the UE, the AMF shall indicate to the UE the support of the Multi-USIM features based on the Multi-USIM features supported by network and any preference policy by the network, if available. When a UE returns to having only one USIM active from a Multi-USIM UE that previously indicated to the network it supported Multi-USIM feature(s), the UE shall indicate all the Multi-USIM features are not supported to the network for that USIM. The AMF shall only indicate the support of Paging Restriction feature together with the support of either Connection Release feature or Reject Paging Request feature.\nThe Multi-USIM UE includes the support of individual features for Connection Release, Paging Cause Indication for Voice Service, Reject Paging Request and Paging Restriction as specified in clause 5.4.4a.\nNOTE:\tThe Paging Timing Collision Control feature being based on the Mobility Registration Update, and it doesn't require capability exchange between the UE and network.\nThe network shall not indicate support for any Multi-USIM feature to the UE as part of the Emergency Registration procedure.\nA Multi-USIM UE shall use a separate PEI for each USIM when it registers with the network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.38.2\tConnection Release",
                            "text_content": "A Multi-USIM UE may request the network to release the UE from RRC_CONNECTED state in 3GPP access for a USIM due to activity on another USIM in 3GPP access, if both UE and network indicate the Connection Release feature is supported to each other.\nIn the case of NAS connection release procedure, the UE indicates that it requests to be released from RRC_CONNECTED state, by initiating either a Service Request procedure over 3GPP access or a Registration procedure over 3GPP access (if case the UE needs to perform Registration Update at the same time with this network, including the case where the Registration Request is sent due to mobility outside the Registration Area, i.e. before detecting whether the network supports the feature in the new Tracking Area, provided that the network has already indicated support for Connection Release feature in the current stored Registration Area), by including a Release Request Indication. If supported by the UE and network, the UE may also provide, only together with the Release Request Indication, Paging Restriction Information, as specified in clause 5.38.5, which requests the network to restrict paging. If the UE is performing an Emergency Registration then it shall not include a Release Request Indication.\nFor NR/5G access, an AS method for the UE to request the network to release the UE from RRC_CONNECTED state is specified in TS 38.300 [27]. This mechanism does not allow the UE to indicate Paging Restrictions.\nNOTE 1:\tWhen both the access stratum and NAS based approaches for requesting the connection release are supported by the UE and the network, it depends on the UE implementation which of the two to use (for example: based on the preferred end state (RRC_INACTIVE or RRC_IDLE) and whether Paging Restriction Information is to be provided).\nNOTE 2:\tWhen there is no PLMN-wide support for the Connection Release feature, it can occur that upon Mobility Registration Update with Release Request indication the UE is not released by the network. The UE behaviour, when it detects that the network does not support the feature in a new RA, is outside the scope of this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.38.3\tPaging Cause Indication for Voice Service",
                            "text_content": "A Multi-USIM UE and the network may support Paging Cause Indication for Voice Service feature.\nThe network that supports Paging Cause Indication for Voice Service feature shall provide a Voice Service Indication for IMS voice service in the Paging message, only if the UE indicates the Paging Cause Indication for Voice Service feature is supported to the network. The network determines the IMS voice service based on the Paging Policy Indicator as specified in clause 5.4.3.2.\nUpon reception of the Voice Service Indication in NGAP Paging Message from AMF, the NG-RAN supporting Paging Cause Indication for Voice Service should include the Voice Service Indication in the Uu Paging message to the UE.\nWhen the UE context in the AMF indicates Paging Cause Indication for Voice Service feature is supported, in order to require NG RAN to deliver the Voice Service Indication in RAN paging for the UE in RRC_INACTIVE state, the AMF provides an indication indicating the Paging Cause Indication for Voice Service feature is supported to the NG-RAN. Upon reception of the indication, the NG-RAN that supports the feature stores a Paging Cause Indication for Voice Service indication in its the UE context. For a UE in RRC_INACTIVE, the NG-RAN should provide the Voice Service Indication in the RAN Paging message only when there is Paging Cause Indication for Voice Service indication in the UE context and detects the downlink data which triggers the RAN Paging message is related to voice service based on the Paging Policy Indicator, in the header of the received downlink data, as specified in clause 5.4.3.2.\nUE that supports the Paging Cause Indication for Voice Service feature is capable of differentiation between Paging from a network that does not support the Paging Cause Indication for Voice Service feature and Paging without the Voice Service Indication. How the UE distinguishes the Paging from a RAN that does not support the Paging Cause Indication for Voice Service feature and Paging without the Voice Service Indication is defined in TS 38.331 [28]. The UE determines whether the Paging Cause Indication for Voice Service feature is supported in the current Registration Area by 5GC based on the MUSIM capability exchange with the AMF, see clause 5.38.1. The UE determines that the Paging Cause Indication for Voice Service feature is supported if it is supported by both the RAN, as indicated in the received Uu Paging message, and by 5GC, as indicated in the MUSIM capability exchange with the AMF.\nThe UE uses the Paging Cause Indication for Voice Service as described in TS 24.501 [47] and TS 38.331 [28].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.38.4\tReject Paging Request",
                            "text_content": "A Multi-USIM UE may set up a connection to respond to a page with a Reject Paging Indication to the network indicating that the UE does not accept the paging and requests to return to CM-IDLE state after sending this response, if both UE and network indicate the Reject Paging Request feature is supported to each other.\nUpon being paged by the network, the Multi-USIM UE in CM-IDLE state attempts to send a Service Request message to the paging network including the Reject Paging Indication as the response to the paging, unless it is unable to do so, e.g. due to UE implementation constraints. In addition to the Reject Paging Indication, the UE may include Paging Restriction Information as specified in clause 5.38.5 in the Service Request message, if supported by UE and network.\nNOTE:\tA Multi-USIM UE in RRC_INACTIVE state can decide to not initiate the RRC connection resumption procedure, e.g. when it decides not to respond to the paging message due to UE implementation constraints as specified in TS 24.501 [47] and TS 38.331 [28].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.38.5\tPaging Restriction",
                            "text_content": "A Multi-USIM UE and the network may support Paging Restriction. A Multi-USIM UE, if the AMF indicates that the network supports Paging Restriction feature, may indicate Paging Restriction Information in the Service Request or Registration Request message (including the case where the Registration Request is sent due to mobility outside the Registration Area, i.e. before detecting whether the network supports the feature in the new Tracking Area, provided that the network has already indicated support for Paging Restriction feature in the current stored Registration Area) as specified in clauses 5.38.2 and 5.38.4.\nBased on operator policy the AMF may accept or reject the Paging Restriction Information requested by the UE. If the AMF accepts the Paging Restriction Information from the UE, the AMF stores the Paging Restriction Information from the UE in the UE context. If the AMF rejects the Paging Restriction Information, the AMF removes any stored Paging Restriction Information from the UE context and discards the UEs requested Paging Restriction Information. The AMF informs the UE about the acceptance/rejection of the requested Paging Restriction Information in the Registration Accept or Service Accept message.\nIf the UE does not provide any Paging Restriction Information in the Service Request over 3GPP access or the Registration Request over 3GPP access, the AMF removes any stored Paging Restriction Information from the UE context.\nThe Paging Restriction Information may indicate any of the following:\na)\tall paging is restricted; or\nb)\tall paging is restricted, except paging for voice service (IMS voice); or\nc)\tall paging is restricted, except for certain PDU Session(s); or\nd)\tall paging is restricted, except paging for voice service (IMS voice) and certain PDU session(s).\nNOTE 1:\tThe UE expects not to be paged for any purpose in case a). The UE expects to be paged only for voice service in case b). The UE expects to be paged only for certain PDU Session(s) in case c). The UE expects to be paged for voice service and certain PDU session(s) in case d). The AMF can page the UE for mobile terminated signalling based on local policy considering the stored Paging Restriction Information, except for case a). In this case, to comply with the UE provided Paging Restriction Information, the AMF can trigger AN release procedure as soon as possible after the mobile terminated signalling procedure is executed.\nNOTE 2:\tIn the case of roaming, the Paging Restrictions for voice service implied by bullet b) and d) depends on the existence of an agreement with the HPLMN to support voice service via IMS. Hence the support of Paging Restrictions in bullets b) and d) takes the IMS voice service agreement into consideration.\nNOTE 3:\tWhen there is no PLMN-wide support for the Paging Restriction feature, it can occur that upon Mobility Registration Update with Paging Restriction Information the UE detects the network does not support the feature. If so, the UE assumes that no Paging Restriction Information is applied.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.38.6\tPaging Timing Collision Control",
                            "text_content": "To avoid possible paging occasion collision and to enhance the likelihood that paging is received successfully for different USIMs, a Multi-USIM UE may need a new 5G-GUTI to modify the timing of the Paging Occasions (POs) for a USIM when the USIM's registration is not emergency registration. When a Multi-USIM UE needs a 5G-GUTI assignment, it performs a Mobility Registration Update without any specific indication (i.e. it is using a normal Registration procedure). This triggers the AMF to allocate a new 5G-GUTI and provide it to the Multi-USIM UE in the Registration Accept message.\nNOTE:\tIt is recommended to avoid excessive signalling load from UE due to this procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.39\tRemote provisioning of credentials for NSSAA or secondary authentication/authorization",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.39.1\tGeneral",
                            "text_content": "The UE's subscribed network (i.e. HPLMN, or subscribed SNPN) may provide functionalities to provision or update the credentials used for NSSAA or credentials used for secondary authentication/authorization to the UE. The provisioning procedure is supported via User Plane.\nFor User Plane Remote Provisioning, the UE establishes a PDU Session that is used for remote provisioning, e.g. by using DNN(s)/S-NSSAI(s) which can access the PVS. The AMF selects an SMF used for remote provisioning using the SMF discovery and selection functionality as described in clause 6.3.2. If the SMF is configured with the PVS address(es) and/or PVS FQDN(s), the SMF shall send the PVS address(es) and/or PVS FQDN(s) per DNN/S-NSSAI to the UE via PCO during PDU Session Establishment procedure, based on the UE's subscribed DNN(s)/S-NSSAI(s) and the UE's request of PVS information from the network. Alternatively, the UE may be configured with an address of a PVS or the PVS may subscribe for UE Reachability Notification and may use the Application Triggering procedure as specified in TS 23.502 [3] to trigger the UE to initiate the setup of a connection for remote provisioning.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.39.2\tConfiguration for the UE",
                            "text_content": "In order to enable UP Remote Provisioning of credentials for NSSAA or secondary authentication/authorization, UE Configuration Data for UP Remote Provisioning are either pre-configured on the UE or provided by the network to the UE. UE Configuration Data for UP Remote Provisioning provided by the network take precedence over corresponding configuration data stored in the UE.\nUE Configuration Data for UP Remote Provisioning consist of PVS IP address(es) and/or PVS FQDN(s). The PVS IP address or PVS FQDN may be associated with dedicated DNN(s) and/or S-NSSAI(s).\nIf the UE does not have any PVS IP address or PVS FQDN after the establishment of a PDU Session used for UP remote provisioning, the UE may construct an FQDN for PVS discovery as defined in TS 23.003 [19].\nThe UE Configuration Data for UP Remote Provisioning may be stored in the ME.\nThe UE Configuration Data for UP Remote Provisioning (i.e. PVS IP address(es) or PVS FQDN(s)) associated with dedicated DNN(s) and/or S-NSSAI(s) may be locally configured in the SMF. The UE Configuration Data for UP Remote Provisioning, if available, shall be provided to the UE during the establishment of any PDU Session used for UP Remote Provisioning as part of Protocol Configuration Options (PCO) in the PDU Session Establishment Response, if the UE has requested the PVS information via PCO in the PDU Session Establishment Request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.40\tSupport of Disaster Roaming with Minimization of Service Interruption",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.40.1\tGeneral",
                            "text_content": "Subject to operator policy and national/regional regulations, 5GS provides Disaster Roaming service (e.g. voice call and data service) for the UEs from PLMN(s) with Disaster Condition. The UE shall attempt Disaster Roaming only if:\n-\tthere is no available PLMN which is allowable (see TS 23.122 [17]);\n-\tthe UE is not in RM-REGISTERED and CM-CONNECTED state over non-3GPP access connected to 5GCN;\n-\tthe UE cannot get service over non-3GPP access through ePDG;\n-\tthe UE supports Disaster Roaming service;\n-\tthe UE has been configured by the HPLMN with an indication of whether Disaster roaming is enabled in the UE set to \"disaster roaming is enabled in the UE\" as specified in clause 5.40.2; and\n-\ta PLMN without Disaster Condition is able to accept Disaster Inbound Roamers from the PLMN with Disaster Condition.\nIn this Release of the specification, the Disaster Condition only applies to NG-RAN nodes, which means the rest of the network functions except one or more NG-RAN nodes of the PLMN with Disaster Condition can be assumed to be operational.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.40.2\tUE configuration and provisioning for Disaster Roaming",
                            "text_content": "A UE supporting Disaster Roaming is configured with the following information:\n-\tOptionally, indication of whether disaster roaming is enabled in the UE;\n-\tOptionally, indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN';\n-\tOptionally, list of PLMN(s) to be used in Disaster Condition.\nThe Activation of Disaster Roaming is performed by the HPLMN by setting the indication of whether Disaster roaming is enabled in the UE to \"disaster roaming is enabled in the UE\" using the UE Parameters Update Procedure as defined in TS 23.502 [3]. The UE shall only perform disaster roaming if the HPLMN has configured the UE with the indication of whether disaster roaming is enabled in the UE and set the indication to \"disaster roaming is enabled in the UE\". The UE, registered for Disaster Roaming service, shall deregister from the PLMN providing Disaster Roaming service if the received indication of whether disaster roaming is enabled in the UE is set to \"disaster roaming is disabled in the UE\".\nThe optional 'list of PLMN(s) to be used in Disaster Condition' may be pre-configured in USIM or provided by the HPLMN during and after a successful registration procedure over 3GPP access or non-3GPP access via Registration Request procedure or UE Configuration Update procedure as defined in TS 23.502 [3]. The 'list of PLMN(s) to be used in Disaster Condition' may be configured over non-3GPP access before disaster condition has occurred.\nWhile roaming (i.e. not in HPLMN), the Registered PLMN may provide the 'list of PLMN(s) to be used in Disaster Condition' during and after a successful registration procedure to the UE via Registration Request procedure or UE Configuration Update procedure as specified in TS 23.502 [3]. This list shall not alter any list provided by the HPLMN and shall only be used if the UE is configured by the HPLMN using the UE Parameters Update Procedure as defined in TS 23.502 [3] with the indication of 'applicability of \"lists of PLMN(s) to be used in disaster condition\" provided by a VPLMN' set to \"True\".\nThe details of the UE behaviour regarding the usage of this list are described in TS 23.122 [17] and TS 24.501 [47]. If the UE is not configured with 'list of PLMN(s) to be used in Disaster Condition', the UE follows the procedure described in TS 23.122 [17] to select PLMN to be used in Disaster Condition.\nThe HPLMN may use UE Parameters Update Procedure as defined in TS 23.502 [3] to update the Disaster Roaming information configuration in UE, if the UDM has received MINT support indication as indicated in 5GMM capability from the AMF. The UE indicates the support of MINT in 5GMM capability as specified in clause 5.4.4a, during registration procedure as defined in TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.40.3\tDisaster Condition Notification and Determination",
                            "text_content": "The NG-RAN in the PLMN that provides Disaster Roaming service, broadcasts an indication of accessibility for Disaster Roaming service, and optionally, a 'list of one or more PLMN(s) with Disaster Condition for which Disaster Roaming service is offered by the available PLMN' in the impacted area as described in TS 38.304 [50] and TS 38.331 [28].\nA UE determines the Disaster Condition based on the information broadcasted from the NG-RAN providing Disaster Roaming service, and performs the network selection and the access control for the Disaster Roaming as described in TS 23.122 [17] and TS 24.501 [47].\nNOTE 1:\tHow a PLMN is notified that another PLMN is a PLMN with Disaster Condition and how a PLMN is notified of the area where the associated Disaster Condition applies is managed by the government agencies or the authorities, and is out of scope of 3GPP.\nNOTE 2:\tThe broadcast for Disaster Roaming service from the NG-RAN occurs only during the Disaster Condition.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.40.4\tRegistration for Disaster Roaming service",
                            "text_content": "For a UE to receive Disaster Roaming service from a PLMN providing Disaster Roaming service, the UE sends a NAS Registration Request message with Registration Type value \"Disaster Roaming Initial Registration\" or \"Disaster Roaming Mobility Registration Update\":\n-\tWhen the AMF in the PLMN providing Disaster Roaming service receives a NAS Registration Request with Registration Type set to \"Disaster Roaming Initial Registration\" or \"Disaster Roaming Mobility Registration Update\";\n-\tthe AMF controls if the UE is allowed to access Disaster Roaming service in the area with Disaster Condition as specified in clause 4.2.2.2.2 of TS 23.502 [3];\n-\tthe AMF may provide the Disaster Roaming service indication to AUSF and UDM as specified in clause 4.2.2.2.2 of TS 23.502 [3] and TS 33.501 [29]. The AMF may provide the Disaster Roaming service indication to SMF as specified in clause 4.3.2 of TS 23.502 [3].\nNOTE 1:\tThe AUSF and the UDM are configured with Disaster Condition via OAM based on operator policy and the request by the government agencies. Based on this local configuration and/or the Disaster Roaming service indication, the AUSF can execute authentication of the UE, and the UDM can provides the subscription data for a Disaster Roaming service to the AMF and/or the SMF.\nTo support the Disaster Roaming service, the PLMN providing Disaster Roaming service is configured to support communication with the network entities in the HPLMN of the UE, i.e. configurations related to roaming interfaces for communication between serving PLMN and HPLMN shall be deployed in the affected entities. This communication between the PLMNs need only be enabled during the Disaster Condition.\nThe Disaster Roaming service is limited to the impacted geographic area with Disaster Condition. The NG-RAN nodes and AMF in the PLMN providing Disaster Roaming service are configured with the area information, i.e. a list of TAIs which can be formulated by the PLMN providing the Disaster Roaming service based on the geographic area with Disaster Condition in the other PLMN(s).\nThe AMF in the PLMN providing Disaster Roaming service provides the mobility restriction list to the NG-RAN as specified in clause 5.3.4.1.1 considering the area with Disaster Condition, and also indicating that EPC is not an allowed core network.\nNOTE 2:\tFrom the perspective of emergency services, a UE is following procedures as described in clause 4.24 of TS 24.501 [47] when registered for Disaster Roaming service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.40.5\tHandling when a Disaster Condition is no longer applicable",
                            "text_content": "When a UE detects a Disaster Condition is no longer applicable, the UE performs PLMN selection as described in TS 23.122 [17] and TS 24.501 [47] and may return to the PLMN previously with Disaster Condition.\nA PLMN providing Disaster Roaming:\n-\tMay trigger the Disaster Inbound Roaming UEs to return to the PLMN previously with Disaster Condition when the Disaster Inbound Roamers attempt to transit to 5GMM-CONNECTED mode.\n-\tMay trigger the Disaster Inbound Roaming UEs to return to the PLMN previously with Disaster Condition by triggering Deregistration procedure.\n-\tMay trigger the Disaster Inbound Roaming UEs to return to the PLMN previously with Disaster Condition by rejecting Registration Request message.\n-\tMay trigger the Disaster Inbound Roaming UEs to return to the PLMN previously with Disaster Condition by rejecting Service Request message.\n-\tShall organise the return of the Disaster Roaming UEs in a manner that does not cause overload (e.g. of signalling) in the PLMN that previously had the Disaster Condition.\n-\tStop broadcasting of providing Disaster Roaming service as specified in clause 5.40.3.\n-\tMay determine that the disaster condition has ended and the UE which is registered for disaster roaming services has an emergency PDU session, the AMF initiates the UE configuration update procedure to indicate that the UE is registered for emergency services as described in TS 24.501 [47].\n-\tMay determine that the disaster condition has ended and inform the UE by initiating the UE configuration update procedure indicating re-registration from UE is required as specified in clause 5.4.4 of TS 24.501 [47] if the UE is in CM-CONNECTED mode.\nNOTE:\tWhether and how long the PLMN waits before paging the Disaster Inbound Roamers upon being notified that a Disaster Condition no longer applies is up to operator's policy.\nThe HPLMN i.e. the UDM may trigger the Disaster Inbound Roaming UEs to return to the PLMN previously with Disaster Condition by triggering Deregistration procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.40.6\tPrevention of signalling overload related to Disaster Condition and Disaster Roaming service",
                            "text_content": "The load control, congestion and overload control mechanism specified in clause 5.19 and access control and barring specified in clause 5.2.5 can be used to mitigate the load caused by UE requesting the Disaster Roaming service in the PLMN providing Disaster Roaming service and returning of UE to allowable PLMN when Disaster Condition is no longer applicable.\nTo prevent signalling overload in PLMN providing Disaster Roaming, the HPLMN or registered PLMN:\n-\tmay provide the UE in a prioritized manner with the list of PLMNs described in clause 5.40.2 for Disaster Roaming;\n-\tmay provide disaster roaming wait range information to control when the UE can initiate the registration for Disaster Roaming service upon arriving in the PLMN providing Disaster Roaming service as specified in TS 23.122 [17] and TS 24.501 [47]; and\n-\tapplies Access Identity 3 for Disaster Roaming service request as specified in TS 24.501 [47].\nNOTE:\tThe mechanisms available at the AMF and the SMF for mitigation of overload and congestion are used for 5GSM congestion mitigation during the Disaster Roaming.\nTo prevent signalling overload by returning UEs in PLMN previously with Disaster Condition which is no long applicable, the HPLMN or registered PLMN:\n-\tmay provide disaster return wait range information to control when the UE can initiate the registration upon returning to the PLMN previously with Disaster Condition as specified in TS 23.122 [17] and TS 24.501 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.41\tNR RedCap UEs differentiation",
                    "description": "",
                    "summary": "",
                    "text_content": "This functionality is used by the network to identify traffic to/from UEs accessing over NR RedCap, e.g. for charging differentiation.\nAn NR RedCap UE using NR shall provide an NR RedCap indication to the NG-RAN during RRC Connection Establishment procedure as defined in TS 38.300 [27].\nWhen the UE has provided an NR RedCap indication to the NG-RAN during RRC Connection Establishment, the NG-RAN shall provide an NR RedCap Indication to the AMF in the Initial UE Message (see clause 4.2.2.2.1 of TS 23.502 [3] and TS 38.413 [34]).\nWhen the AMF receives an NR RedCap Indication from NG-RAN in an Initial UE Message, the AMF shall store the NR RedCap Indication in the UE context, consider that the RAT type is NR RedCap and signal it accordingly to the SMSF during registration procedure for SMS over NAS, to the SMF during PDU Session Establishment or PDU Session Modification procedure. The PCF will also receive the NR RedCap RAT type indication when applicable, from the SMF during SM Policy Association Establishment or SM Policy Association Modification procedure.\nDuring handover from E-UTRA to NR, the target NG-RAN (i.e. gNB) provides the NR RedCap indication to AMF in NGAP Path Switch Request message during Xn handover, or NGAP Handover Request Acknowledge message during N2 handover (including intra 5GS N2 handover and EPS to 5GS handover) based on the UE capability information provided by the source RAN to the target RAN as specified in TS 38.300 [27].\nThe NFs interacting with CHF shall include the NR RedCap as RAT type.\nUpon AMF change, the source AMF shall provide the \"NR RedCap Indication\" to the target AMF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.42\tSupport of Non-seamless WLAN offload",
                    "description": "",
                    "summary": "",
                    "text_content": "Non-seamless WLAN offload is an optional capability of a UE supporting WLAN radio access.\nThe architecture to support authentication for Non-seamless WLAN offload in 5GS is defined in clause 4.2.15.\nA UE supporting Non-seamless WLAN offload may, while connected to WLAN access, route specific data flows via the WLAN access without traversing the 5GC. These UE data flows are identified using URSP configuration for Non-Seamless Offload, or UE Local Configurations as defined in TS 23.503 [45]. For these data flows, the UE uses the local IP address allocated by the WLAN access network and no IP address preservation is provided between WLAN and NG-RAN.\nFor performing the Non-seamless WLAN offload, the UE needs to acquire a local IP address from the WLAN access network and it is not required to connect to an N3IWF, ePDG or TNGF. If the WLAN access network is configured to require the 5GS based access authentication of the UE for connecting to the WLAN, the UE performs the authentication procedure for Non-seamless WLAN offload in 5GS defined in clause 4.2.15 and in Annex S of TS 33.501 [29]. After successful authentication, the UE is not considered to be entered in 5GS Registered state. The UE can send and receive traffic not traversing the 5GC and which is not under the control of the 5GC.\nA non-3GPP access network may be connected via SWa' to multiple PLMNs for 5G NSWO. In a roaming scenario the HPLMN may be reached by the UE via a WLAN access connected to more than one VPLMN. Therefore, a UE when roaming shall be able to indicate a specific selected VPLMN (e.g. using decorated NAI for 5G NSWO) through which the NSWO request should be sent towards the HPLMN.\nA non-3GPP access network may be connected to multiple SNPNs different from the Credentials Holder for 5G NSWO. When using the credentials owned by CH, the UE shall be able to indicate a specific selected SNPN (e.g. using decorated NAI for 5G NSWO) through which the NSWO request should be sent towards the CH in the following scenarios:\n-\tThe CH hosts AUSF/UDM and the CH is reached by the UE via a WLAN access connected to a SNPN different from the CH as defined in Figure 4.2.15-3a.\n-\tThe CH hosts AAA server and the CH is reached by the UE via a WLAN access connected to the AAA proxy in specific SNPN as defined in Figure 4.2.15-3b.\nA UE connected to a WLAN access network using 5GS credentials (as shown in Figure 4.2.15-1), may also be connected to the 5GC, for example to establish a PDU session. For example, the UE may connect to the 5GC either via another access type (such as NG-RAN), or via the same WLAN access network by performing the 5GS registration via Untrusted non-3GPP access procedure (using N3IWF) or interworking between ePDG connected to EPC and 5GS (using ePDG) defined in TS 23.502 [3].\nWhen a UE is connected to a WLAN access network (e.g. using 5GS credentials) and using an Untrusted non-3GPP access, the UE can perform Non-Seamless Offload of some or all data traffic to this WLAN access network sending the traffic outside the IPSec tunnel encapsulation as defined in URSP rules with Non-Seamless Offload indication.\nA UE may use the Registration procedure for Trusted non-3GPP access defined in clause 4.12a.2.2 of TS 23.502 [3] and then determine to send some traffic (to be subject to Non-seamless WLAN offload) outside of the IPSec tunnel established with the TNGF.\nNOTE:\tA UE cannot first connect to a WLAN access network using 5GS credentials and without performing 5GS registration, and then later, on this WLAN access network, perform 5GS registration using the Trusted non-3GPP access procedure without first having to release the WLAN and then to establish a new WLAN association per the Registration procedure for Trusted non-3GPP access as defined in clause 4.12a.2.2 of TS 23.502 [3].\nWhen the UE decides to use 5G NSWO to connect to the WLAN access network using its 5GS credentials but without registration to 5GS, the NAI format for 5G NSWO is used whose realm is different than the realm defined for usage of Trusted non-3GPP access to the 5GC (defined in clauses 28.7.6 and 28.7.7 of TS 23.003 [19]).\nThe NAI format for 5G NSWO is defined in TS 23.003 [19].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.43\tSupport for 5G Satellite Backhaul",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.43.1\tGeneral",
                            "text_content": "Satellite may be used as part of the backhaul between (R)AN and 5GC. The 5G System supports to report of usage of satellite backhaul as described in clause 5.43.2.\nFor some deployments, UPF may be deployed on the satellite. In these cases, edge computing or local switch via UPF deployed on the satellite may be performed as described in clauses 5.43.2 and 5.43.3. Deployments with satellite backhaul and edge computing with UPF on the ground is supported as described in clause 5.13, i.e. without satellite backhaul specific requirements.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.43.2\tEdge Computing via UPF deployed on satellite",
                            "text_content": "This clause only applies to the case where Edge Computing is deployed with UPF and Edge Computing services on-board the satellite. The UPF deployed on satellite can act as UL CL/BP/local PSA UPF or act as PSA UPF.\nNOTE 1:\tIn this Release, Edge Computing via UPF deployed on satellite only applies to GEO satellite backhaul.\nTo select the UPF deployed on satellite as PSA, the following enhancements apply:\n-\tIf the UE is accessing gNB with satellite backhaul, and AMF is aware of the satellite backhaul category, the AMF sends the satellite backhaul category to the PCF. If GEO satellite backhaul category is indicated, the PCF may take it into account to generate or update the URSP rule as defined in clause 6.1.2.2 of TS 23.503 [45] to including an appropriate Route Selection Descriptor for services deployed on GEO satellite, which further enable PDU Session Establishment with PSA UPF on the satellite.\nBased on GEO satellite ID provided by the AMF, the SMF performs PSA UPF selection or UL CL/BP/local PSA selection and insertion during the PDU Session Establishment procedure as described in clause 4.3.2 of TS 23.502 [3] or PDU Session Modification procedure as described in clause 4.3.3 of TS 23.502 [3] to select the UPF deployed on the GEO satellite if available, which includes:\n-\tBased on configuration, the AMF may determine the GEO Satellite ID serving the UE and send it to the SMF. If GEO satellite ID changes, e.g. due to UE handover to an gNB using different GEO satellite as part of backhaul, the AMF may update the latest GEO Satellite ID to the SMF.\nNOTE 2:\tIt is assumed that AMF determines the GEO Satellite ID based on local configuration, e.g. based on Global RAN Node IDs associated with satellite backhaul.\n-\tThe SMF determines DNAI based on local configuration, DNN or S-NSSAI or both and the GEO Satellite ID received from AMF.\nNOTE 3:\tIt is assumed that one or more DNAI values are assigned for each GEO Satellite ID by the operator. SMF is locally configured with mapping relationship between DNAI and GEO Satellite ID.\n-\tIf the UE is allowed to access the service(s) according to the EAS Deployment Information as described in clause 6.2.3.4 of TS 23.548 [130], the SMF selects the PSA UPF or UL CL/BP/local PSA based on the DNAI corresponding to the GEO Satellite ID and other factors as described in clause 6.2.3.2 of TS 23.548 [130].\nNOTE 4:\tEASDF may be deployed on satellite based on local configuration.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.43.3\tLocal switch for UE-to-UE communications via UPF deployed on GEO satellite",
                            "text_content": "The UE to UE traffic may be locally routed by UPF(s) deployed on satellite (i.e. through local switch) to the target UE without traversing back to the satellite gateway on the ground.\nLocal switching via UPF(s) deployed on satellite in this clause only applies on GEO satellite backhaul case and considers only DNNs and slices for 5G VN.\nN19 tunnel may be established between two UPFs deployed on different satellites for traffic between UEs. Also, N6 may be used for carrying traffic between UPFs deployed on different satellites.\nOnly a single SMF is supported for local switching and N19 forwarding, i.e. both UEs are served by the same SMF.\nNOTE:\tThe latency optimisation that can be gained by inter-satellite link between UPFs on different GEO satellites depends on the distance between the satellites that can be substantial, depending on the number of deployed satellites.\nClause 5.43.3.2 describes the case of PSA UPF deployed on satellite, clause 5.43.3.3 describes the case of UL CL/BP and local PSA deployed on satellite (PSA UPF is on the ground). Selection of PSA UPF or UL CL/BP/local PSA on satellite is described in clause 6.3.3 and determination of DNAI to select the UPF deployed on the corresponding GEO satellite reuses the mechanism described in clause 5.43.2.\nA combination of DNN/S-NSSAI is assigned by the operator for the communications between UEs where backhaul with UPF is deployed on GEO satellite, the URSP is described in TS 23.503 [45] and its configuration to enable the selection PSA UPF on the GEO satellite reuses the mechanism described in clause 5.43.2.\nIf SMF selects the UPF deployed on satellite as PSA of UE's PDU Session, the SMF configures the UE's N4 session to forward/detect packet to/from the internal interface as specified for the configuration for the 5GVN group member's N4 Session in clause 5.8.2.13.1 (Support for unicast traffic forwarding of a 5G VN).\nSMF may reuse the mechanism described in clause 5.8.2.13.1 to configure group-level N4 session rules for each N19 tunnel.\nFor establishing N19 tunnel between the PSA UPFs onboard the satellite, the PSA UPFs are controlled by the same SMF.\n-\tTo process packets between UE and servers residing in DN, SMF configures rules to route traffic via N6 as described in clause 5.8.2.13.1.\nThe group-level N4 session is per DNN and S-NSSAI. The SMF can create, update or delete the group-level N4 Session, i.e. add or delete N4 rules, allocate or release the N19 tunnel resources based on operator deployment, e.g. based on GEO satellite's planned obsolescence or new GEO satellite setup.\nN6 may be used for carrying traffic between PSA UPFs deployed on different satellites. If N6 is used, SMF configures corresponding N4 rules for processing traffic to/from N6.\nIf the UEs using GEO satellite backhaul are served by the same SMF and the GEO satellite(s) serving the UEs has UPF deployed, the SMF may determine to activate local switching and N19 forwarding for the UEs, based on:\n1)\tAF request including of UE identifiers which require communication between UEs as described in clause 5.29.2; and/or\n2)\tDestination IP address(es) reported by on-ground PSA UPF as current reporting mechanism in clause 5.8.5.7. To enable the destination IP address(es) reporting, SMF configures the on-ground PSA UPF to detect UL packets with destination IP addresses which belong to the current UPF address pool.\nIf the SMF determines that the UEs (i.e. corresponding to AF request in bullet 1) and/or the Destination IP address(es) reported in bullet 2)) are under the same GEO satellite (or multiple connectable GEO satellites) based on GEO Satellite ID(s) reported by AMF and the UEs are allowed to access the DNAIs corresponding to the GEO satellite IDs, for each UE communicating with target UE(s) in the communication group, the SMF may select and insert the UPF deployed on GEO satellite according to the DNAI as UL CL/BP and L-PSA, and configures UL CL/BP with the following rule:\n-\tRoute the data traffic received from the UE and destined to IP address(es) of the target UE(s) to the L-PSA.\n-\tRoute other data traffic received from the UE to the PSA UPF of the UE's PDU Session.\nNOTE 1:\tThe SMF determines the GEO satellites are connectable based on configuration.\nThe SMF configures the Local PSA with local forwarding rules to forward the data traffic to the target UEs directly. If the selected L-PSAs are different for the UEs in the communication group, N19 tunnel is established between the L-PSAs. For establishing N19 tunnel between the UPFs onboard the satellite, the UPFs are controlled by the same SMF. If UEs are members of the same 5G VN group, the SMF may configure the local data forwarding rules on L-PSA(s) using 5GVN user plane handing mechanism in clause 5.8.2.13.1 (Support for unicast traffic forwarding of a 5G VN).\nNOTE 2:\tThe selected UPF deployed on satellite can be inserted as UL CL/BP/L-PSA reusing existing UL CL/BP insertion procedures defined in TS 23.502 [3] or TS 23.548 [130].\nN6 may be used for carrying traffic between L-PSA UPFs deployed on different satellites. If N6 is used, SMF configures corresponding N4 rules for processing traffic to/from N6.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.43.4\tReporting of satellite backhaul to SMF",
                            "text_content": "If the AMF is aware that a satellite backhaul is used towards 5G AN, the AMF may report this to SMF as part of the PDU Session establishment procedure as described in clause 4.3.2 of TS 23.502 [3]. If AMF is aware that satellite backhaul category changes (e.g. at handover), the AMF reports the current satellite backhaul category and indicates the satellite backhaul category change to SMF.\nSatellite backhaul category refers to the type of the satellite (i.e. GEO, MEO, LEO or OTHERSAT, DYNAMIC_GEO, DYNAMIC _MEO, DYNAMIC _LEO, DYNAMIC _OTHERSAT) used in the backhaul as specified in clause 5.4.3.39 of TS 29.571 [183]. Only a single backhaul category can be indicated.\nIf dynamic satellite backhaul is used by the NG-RAN, i.e. capabilities (latency and/or bandwidth) of the satellite backhaul change over time due to e.g. use of varying inter-satellite links as part of backhaul, the AMF notifies the SMF of the corresponding dynamic satellite backhaul category to serve the PDU Session and the SMF can notify it to other NFs as described in clause 5.2.8.3 of TS 23.502 [3].\nNOTE:\tIt is assumed that the AMF can determine the Satellite backhaul category for the notification to the SMF based on local configuration, e.g. based on Global RAN Node IDs associated with satellite backhaul.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.43.5\tQoS monitoring when dynamic Satellite Backhaul is used",
                            "text_content": "If dynamic satellite backhaul is used, QoS monitoring can be used to measure packet delay as specified in clause 5.45.2.\nIf the Satellite backhaul category received from SMF indicates dynamic satellite backhaul is used, the PCF may, based on PCF local policy or configuration, request QoS monitoring for the packet delay between UE and PSA UPF as specified in clause 5.45.2. The AF can also trigger QoS monitoring by requesting QoS monitoring report from the PCF e.g. when the AF has received dynamic satellite backhaul indication.\nNOTE:\tPCF handling of satellite backhaul category indication and possible QoS monitoring is specified in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.44\tSupport of Personal IoT network service",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.44.1\tGeneral",
                            "text_content": "Personal IoT Network (PIN) provides local connectivity between PIN elements i.e. UEs and/or non-3GPP devices. PIN elements communicate using PIN direct communication, PIN indirect communication and the PIN-DN communication. The management of the PIN direct communication is out of the scope of this specification. For the PIN indirect communication and PIN-DN communication, the data traffic and management traffic pass via a UE acting as PIN element with Gateway Capability (PEGC). With the support of the PEGC registered to 5G network, the PIN Elements have access to the 5G network services and may communicate with other PIN Elements within the PIN or with the DN via 5GC. A PEGC may support multiple PINs. For each PIN, a dedicated DNN/S-NSSAI shall be configured.\nPIN and PIN elements are managed by specific PIN element with Management Capability (PEMC) with support of an AF, if AF (Application Server and PIN server as specified in TS 23.542 [181]) is deployed. A PIN includes at least one PEGC and at least one PEMC. The management of the PIN network (i.e. the management of PIN network creation, deletion and update) and PIN Element (including the management role distribution between PEMC and AF) is out of the scope of this specification.\nThe PEGC is a UE with subscription data related to PIN within the 5GS (i.e. (DNN, S-NSSAI) combination(s) for PIN) and shall register to 5GS as UE in order to support PIN indirect communication and PIN-DN communication via dedicated PDU session. The UE acting as PEMC does not have subscription data related to PIN within the 5GS and behaves as normal UE if it is registered in 5GS.\nAn AF for PIN may be deployed to support the PIN service. The AF for PIN may communicate with PIN elements, including PEMC and PEGC, via application layer for management of the PIN which is transported as user plane data transparently to 5GS and with the 5GC via NEF.\nThe PEMC can manage the PIN via PIN direction communication or PIN indirect communication with the other elements of PIN or via PIN-DN communication with PIN AF which enables the exchange of information with 5GC.\nThe 5GC is enhanced to support the delivery of UE policy related to PIN service for UE acting as PEGC (as specified in clause 5.44.2) and to support the PDU session management for PIN service (as specified in clause 5.44.3).\nSee information in Annex P for the relation between PIN and 5GS. The PINE, PEMC and PEGC application layer functionalities are defined in TS 23.542 [181] and are transparent in 5GS.\nThe support of PIN by 5G-RG and FN-RG is not specified.\nRedundant PDU session for URLLC is not supported in conjunction with PIN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.44.2\tUE policy delivery for PIN",
                            "text_content": "For a PEGC registered in the 5GS, the 5GS supports the provisioning of URSP rules that include a PIN ID as Traffic Descriptor. URSP rules with a PIN ID in the Traffic Descriptor are sent to the UE based on the information provided from an AF for PIN as specified in TS 23.502 [3] and TS 23.503 [45] for policy delivery.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.44.3\tSession management enhancement for PIN service support",
                            "text_content": "When a PDU Session associated with a PIN is established by PEGC, an SMF is selected according to clause 4.3.2.2.3 of TS 23.502 [3] based on S-NSSAI/DNN. The PEGC may use IP address allocation methods as specified in clause 5.8.2 (e.g. IPv6 Prefix Delegation feature).\nOne PEGC may serve more than one PIN. The PEGC may use a single or multiple PDU sessions to serve multiple PINs. One PDU Session may be shared by more than one PIN served by the PEGC, if differentiation or isolation for the traffics to/from different PINs via PEGC is not required in 5GS. Otherwise, different DNNs and S-NSSAIs shall be applied to distinguish the PINs by different PDU sessions of the PEGC.\nOne PIN can be served by only one PDU session in the PEGC. If there are multiple PDU sessions for a PIN from different PEGCs connecting to the same UPF, the same mechanism for local switching in the UPF as defined for 5G VN group communication, as described in clause 5.8.2.13, may be applied.\nFor PIN indirect communication and PIN-DN communication via PEGC  and5GC with PDU session, the 5GC supports the session policy control. The policy control is based on session management procedures as specified in TS 23.502 [3] and TS 23.503 [45].\nAn AF may provide QoS parameters for PIN traffic to 5GC as specified in clauses 4.15.6.6, 4.15.6.6a, and 4.15.6.14 of TS 23.502 [3].\nAn AF may influence traffic routing for PDU sessions for PIN-DN communication as specified in clause 5.6.7 and in clause 4.3.6 of TS 23.502 [3].\nQoS experienced by PINEs connected behind a PEGC depends on the end-to-end path between a PINE and the application server, i.e. depends on the QoS differentiation in both the 3GPP network and the non-3GPP network attached to the PEGC. Non-3GPP QoS Assistance Information (N3QAI) enables the PEGC to perform QoS differentiation for the PINEs in the non-3GPP network behind the PEGC.\nDuring PDU session establishment and PDU session modification, if the SMF provides the PEGC with QoS flow descriptions, the SMF may additionally signal N3QAI for each QoS flow to the PEGC based on the (DNN, S-NSSAI) combination of the PDU Session. Based on the N3QAI together with QoS rule information, the PEGC may reserve resources in the non-3GPP network. N3QAI consists of the following QoS information: QoS characteristics, GFBR/MFBR, Maximum Packet Loss Rate, Notification Control.\nHow to enforce QoS based on the N3QAI in the non-3GPP network is considered outside the scope of 3GPP.\nFor PIN indirect communication and PIN-DN communication via PEGC and 5GC, non-3GPP delay is the delay between the PEGC and the PINE. 5GC may need to be aware of the non-3GPP delay and compensate for this delay in 5GS. The compensation is achieved by adjusting the dynamic CN PDB for the 3GPP network by the non-3GPP delay (i.e. the network determined original PDB value is unchanged, but it needs to cover non-3GPP delay, besides the AN PDB and CN PDB).\nIf the PEGC supports providing of the non-3GPP delay budget for a specific QoS flow of the PIN traffic, the PEGC may provide a non-3GPP delay budget to SMF by using the UE requested PDU Session Modification procedure. Based on the (DNN, S-NSSAI) combination of the PDU Session, the SMF may, according to operator policy and implementation, consider the non-3GPP delay budget when signalling the dynamic CN PDB to NG-RAN. The dynamic CN PDB signalled to the NG-RAN ismay be calculated as the sum of the value of dynamic CN PDB for the related GBR QoS flow and the requested non-3GPP delay budge. If the dynamic CN PDB changes in the SMF (e.g., when an I-UPF is inserted by the SMF), based on the (DNN, S-NSSAI) combination of the PDU Session, the SMF may apply the non-3GPP delay budget again before signalling the dynamic CN PDB to NG-RAN. The non-3GPP delay budget does not impact the QoS flow binding in SMF.\nNOTE 1:\tFor deployments that support a PEGC to request a non-3GPP delay budget it is assumed that RAN is locally configured to give precedence to the CN PDB value received via N2 signalling as specified in clause 5.7.3.4.\nIt is assumed that the PEGC will limit the frequency of triggering the UE-initiated PDU Session Modification request to provide the non-3GPP delay budget to the network to avoid unnecessary signalling.\nNOTE 2:\tIt is up to CT WG1 to discuss to potentially introduce a timer to limit how often a PEGC is allowed to request a delay budget.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.44.4\tIdentifiers for PIN",
                            "text_content": "A PIN is managed at the PIN application layer. A unique PIN ID in a PLMN is designated to a PIN, e.g. by PIN application layer as specified in TS 23.542 [181]. In 5GS the PIN ID is only used in the traffic descriptor of URSP rules, for routing traffic of specific PIN towards a dedicated (DNN, S-NSSAI) combination as specified in clause 6.6.2 of TS 23.503 [45].\nIf a PIN contains more than one PEGCs, the list of PEGCs may be grouped together following the 5G VN group management principles as specified in clause 5.29.2. Then the PEGCs of a PIN can be identified by an External Group ID by the AF for PIN. The AF for PIN may use the External Group ID to manage the list of PEGCs that are part of a PIN and for providing URSP guidance (as specified in clause 5.44.2) and/or QoS requests applicable to all the PEGCs (as specified in clause 5.44.3).\nNOTE:\tThe PEMCs can also be grouped together with the PEGCs using the 5G VN group management functionality for enabling the PEMCs to communicate with PEGCs via UPF local switch in order to manage the PIN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.45\tQoS Monitoring",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.45.1\tGeneral",
                            "text_content": "QoS monitoring comprises of measurements of QoS monitoring parameters and reports of the measurement result for a QoS Flow and can be enabled based on 3rd party application requests and/or operator policies configured in the PCF. Event Reporting from PCF is specified in clause 6.1.3.18 of TS 23.503 [45] and User Plane QoS Flow related QoS monitoring and reporting in clause 5.8.2.18.\nThe AF may request measurements for one or more of the following QoS monitoring parameters, which may trigger QoS monitoring for service data flow(s):\n-\tUL packet delay, DL packet delay, round trip packet delay for a service data flow, see clause 5.45.2.\n-\tCongestion, see clause 5.45.3.\n-\tData Rate, see clause 5.45.4.\n-\tPacket Delay Variation, see clause 5.37.7.\n-\tRound trip packet delay considering UL on a service data flow and DL of another service data flow, see clause 5.37.4.\nThe following AF requested QoS requirements may trigger QoS monitoring for service data flow(s):\n-\tRound-trip latency requirement, see clause 5.37.6.\nThe PCF may generate the authorized QoS Monitoring policy for a service data flow based on the QoS Monitoring request received from the AF (as described in clause 6.1.3.21 of TS 23.503 [45]) or based on PCF local policy or configuration reasons, such as PCF awareness of dynamic satellite backhaul connection. The PCF includes the authorized QoS Monitoring policy in the PCC rule and provides it to the SMF.\nThe QoS monitoring parameter(s) that can be measured by means of QoS monitoring are listed below. The QoS monitoring policy in PCC rule (described in clause 6.3.1 of TS 23.503 [45]) may include the following:\n-\tUL packet delay, DL packet delay, round trip packet delay, see clause 5.45.2.\n-\tCongestion, see clause 5.45.3.\n-\tData Rate, see clause 5.45.4.\nThe SMF configures the UPF to perform QoS monitoring for the QoS Flow and to report the monitoring results as described in clause 5.8.2.18 with parameters determined by the SMF based on the authorized QoS Monitoring policy received from the PCF or local configuration or both.\nThe SMF may also configure RAN to measure the QoS monitoring parameters by sending QoS monitoring request based on the authorized QoS Monitoring policy received from the PCF and/or local configuration. The QoS monitoring request to the NG RAN for different parameters is as defined in clause 5.45.2 and 5.45.3.\nThe following clauses describe the QoS monitoring parameters which can be measured and any specific actions or constraints for their measurement.\nNOTE:\tThe QoS monitoring parameter which can be measured are parameters which describe the QoS experienced in the 5GS by the application, i.e. they are not restricted to the 5G QoS Parameters defined in clause 5.7.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.45.2\tPacket delay monitoring",
                            "text_content": "QoS Monitoring for packet delay allows for the measurement of UL packet delay, DL packet delay or round trip packet delay between UE and PSA UPF. The details of the QoS Monitoring for packet delay are described in clause 5.33.3.\nThe PCF may calculate Packet Delay Variation (clause 5.37.7) and the round trip packet delay when UL and DL are on different QoS flows (clause 5.37.4) based on packet delay monitoring results of QoS flows.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.45.3\tCongestion information monitoring",
                            "text_content": "The NG-RAN may be required to provide the UL and/or DL QoS Flow congestion information to UPF (i.e. a percentage of congestion level for exposure). The UPF may be required to monitor and expose the UL and/or DL QoS Flow congestion information reported from the NG-RAN.\nQoS monitoring request for congestion information provided by the SMF to the NG-RAN is to trigger the NG-RAN to measure and report UL and/or DL QoS Flow congestion information to PSA UPF as defined in 5.37.3.\nNOTE 1:\tHow the RAN measures and reports the congestion information is up to RAN implementation.\nNOTE 2:\tIt is assumed that the RAN reports whenever there is a change in the percentage of packets to be marked with ECN for L4S marking and/or congestion information. The granularity of change in percentage determination is up to RAN implementation.\nFor the reporting of the congestion information from PSA UPF, the periodical reporting is not applied and only the Reporting frequency 'event triggered' applies, see clause 5.8.2.18. The PSA UPF shall send a report when the measurement result crosses the indicated Reporting threshold. Subsequent reports shall not be sent by the PSA UPF during the Minimum waiting time.\nThe PSA UPF reports the received UL and/or DL QoS Flow congestion information to the target NF as instructed by the QoS Monitoring request (see clause 5.8.2.18) from the SMF.\nOnly one of ECN marking for L4S (in the case of ECN marking for L4S in RAN as described in clause 5.37.3) or QoS monitoring of congestion information may be requested to NG-RAN for a QoS Flow. They are mutually exclusive, therefore, measurements of Congestion information on a QoS Flow are not provided in QoS Monitoring reports if SMF enables ECN marking for L4S in RAN (see clause 5.37.3).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.45.4\tData rate monitoring",
                            "text_content": "The QoS Monitoring for data rate allows the measurement of the UL and/or DL data rate per QoS flow at the PSA UPF and it can be applied to a Non-GBR or GBR QoS flow. The data rate is measured over a monitoring averaging window with a standardized value.\nThe SMF may configure the UPF to perform and report QoS monitoring for data rates as described in clause 5.8.2.18. According to the QoS Monitoring request for UL and/or DL data rate from the SMF, the UPF is required to initiate data rate measurement for a QoS Flow and to report the measured data rate as instructed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.45.5\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.46\tAssistance to AI/ML Operations in the Application Layer",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.46.1\tGeneral",
                            "text_content": "This clause describes the list of 5GC enablers to support the following AI/ML operations in the Application layer over the 5G System:\n-\tAI/ML operation splitting between AI/ML endpoints;\n-\tAI/ML model/data distribution and sharing;\n-\tDistributed/Federated Learning.\nNOTE 1:\tRequirements on 5G System assistance to AI/ML operations in the Application layer are specified in clause 6.40 of TS 22.261 [2].\nThe AF may subscribe to NEF monitoring events as described in clause 4.15.3.2.3 of TS 23.502 [3] in order to assist its application AI/ML operations. For example, the AF may subscribe to session inactivity time monitoring event in order to assist the AI/ML application server in scheduling available UE(s) to participate in the AI/ML operation (e.g. Federated Learning). In addition, the AF may subscribe to NEF to be notified on the traffic volume exchanged between the UE and the AI/ML application server in order to assist the AF with the transfer of AI/ML data.\nThe AF that aims to provide an AI/ML operation may request assistance from the 5GC as described in clause 5.46.2. The AF initially provides a list of target member UE(s) and at least one filtering criterion, when subscribing to the NEF to be notified about a subset list of UE(s) (i.e. list of candidate UE(s)) that fulfil certain filtering criteria. Details of the procedures are described in clause 4.15.13 of TS 23.502 [3]. This subset list of UE(s) may become the member UE(s) used in the AI/ML operation depending on the AF's final decision, considering its internal logic. Alternatively, the AF may select the list of UEs for the AI/ML operation without NEF involvement as described in Annex I of TS 23.502 [3]: in this case, the AF determines a list of UEs without any assistance from the NEF and may use, for example, NWDAF analytics to assist with the AI/ML operation over 5G System.\nThe AF may request the network to provide a recommended time window for the AI/ML operation using the Planned Data Transfer with QoS (PDTQ) requirements and procedures as described in clause 6.1.2.7 of TS 23.503 [45] and in clause 4.16.15 of TS 23.502 [3].\nAt the time or during the AI/ML operation, the AF may request the serving NEF to provide QoS for a list of UEs. Each UE is identified by its UE IP address. The AF may subscribe to QoS Monitoring which may include also Consolidated Data Rate monitoring as described in clause 5.45 and in clause 4.15.6.13 of TS 23.502 [3] for those AF requests for QoS that result in a successful resource allocation. The AF provides QoS parameters that are derived from the performance requirements listed in clause 7.10 of TS 22.261 [2].\nAs a result of the AF subscription to NEF to provide the subset list of UE(s) that fulfil certain filtering criteria, the AF may be notified about changes in the subset list of UE(s) and in such a case the AF may determine a updated list of UEs used in the AI/ML operation from the new subset list of UE(s) provided by NEF, and the AF may request a new recommended time window for the AI/ML operation using the Planned Data Transfer with QoS (PDTQ) requirements as described in clause 6.1.2.7 of TS 23.503 [45] and in clause 4.16.15 of TS 23.502 [3]. The AF may request the NEF to provide QoS for the updated list of UEs, each identified by UE IP address, that results in QoS resources previously allocated to some UEs to be released, while QoS resources for other UEs to be allocated and QoS monitoring to be initiated.\nThe AF may also subscribe to, or request Network Data Analytics as defined in TS 23.288 [86], such as End-to-end data volume transfer time analytics, DN performance analytics, Network performance analytics, UE mobility analytics, WLAN performance analytics etc. in order to assist its AI/ML operations.\nThe AF hosting an AI/ML based application may provision the Expected UE Behaviour parameters captured in Table 4.15.6.3-1 of TS 23.502 [3] and/or the Application-Specific Expected UE Behaviour parameter(s) captured in Table 4.15.6.3f-1 of TS 23.502 [3] to the 5GC. The parameters may be provisioned with corresponding confidence and/or accuracy levels, and a threshold may also be provided to the UDM by the NF (e.g. AMF or SMF) subscribing to such externally provisioned parameters as described in clause 4.15.6.2 of TS 23.502 [3].\nIn addition, the following principles apply when 5GS assists the AI/ML operation at the application layer:\n-\tAF requesting 5GS assistance to AI/ML operations in the application layer shall be authorized by the 5GC using the existing mechanisms.\nNOTE 2:\tIn this Release, assistance to AI/ML operations in the application layer is not supported for roaming UEs.\nNOTE 3:\tPolicy and charging control as defined in TS 23.503 [45] can be used for traffic related to AI/ML operations as described in clause 6.40.1 of TS 22.261 [2]. Capabilities based on Flow Based Charging can be used together with an appropriate PCF configuration for charging differentiation between AI/ML traffic and other type of traffic from the same application. As long as the AF can provide different filter information as described in TS 23.503 [45] for the AI/ML traffic and the other type of traffic from the same application in the procedures utilized for the resource request, the PCF can assign different rating groups (i.e. charging key) or rating group + service-ids based on an appropriate PCF configuration. The UPF will then handle such traffic accordingly. This enables charging of AI/ML traffic according to operator's policies.\n-\tApplication AI/ML decisions and their internal operation logic reside at the AF and UE application client and is out of scope of 3GPP.\n-\tBased on application logic, it is the application decision whether to request assistance from 5GC, e.g. for the purpose of selection of Member UEs that participate in certain AI/ML operation.\n-\tIn this Release, 5GS assistance to AI/ML operations in the application layer is conducted within a single slice.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.46.2\tMember UE selection assistance functionality for application operation",
                            "text_content": "5G System may support Member UE selection assistance functionality to assist the AF to select member UE(s) that can be used in application operations such as AI/ML based applications (e.g. Federated Learning) as specified in clause 5.46.1 according to the AF's inputs.\nThe Member UE selection assistance functionality shall be hosted by NEF, and the features of the Member UE selection assistance functionality hosted by the NEF include (see clause 4.15.13 of TS 23.502 [3] for details of Member UE selection procedures):\n-\tReceiving a request from the AF that shall include a list of target member UE(s) (which may not necessarily be a part of the subsequent updated request), optionally (a) time window(s), and one or more filtering criteria as specified in Table 4.15.13.2-1 of TS 23.502 [3] (e.g. UE current location, UE historical location, UE direction, UE separation distance, QoS requirements, DNN, preferred access/RAT type, Desired end-to-end data volume transfer time performance, or Service Experience).\n-\tReferring to the filtering criteria provided by the AF and then interacting with 5GC NFs using existing services in order to have the corresponding data for all the UEs in the list of target member UE from relevant 5GC NFs (e.g. PCF, NWDAF, AMF, SMF) to derive the list(s) of candidate UE(s) (i.e. UE(s) among the list of target member UE(s) provided by the AF) which fulfil the filtering criteria.\n-\tProviding the AF with the Member UE selection assistance information, including one or more lists of candidate UE(s), and optionally other additional information (e.g. one or more recommended time window(s) for performing the application operation, QoS of each target UE, UE(s) location, Access/RAT type, or Service Experience). NEF may also provide the number of UEs per each filtering criterion that do not fulfil the corresponding filtering criterion.\nThe Member UE selection assistance information provided by the NEF may be used by the AF to select member UE(s) used in application AI/ML operation. (See clause 5.2.6.32 of TS 23.502 [3] for details of parameters).\nNOTE:\tThe AF can decide whether to use the Member UE selection assistance functionality provided by NEF.\nWithout using the Member UE selection assistance functionality, AF in either trusted or untrusted domain can select the Member UE(s) for e.g. participating in federating learning operation, by collecting the corresponding data using network exposure information as described in clause 4.15 of TS 23.502 [3], e.g. UE location reporting from the AMF, user plane information from the UPF and network data analytics from NWDAF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tNetwork Functions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 6 provides the functional description of the Network Functions and network entities and the principles for Network Function and Network Function Service discovery and selection.\nNG-RAN functions and entities are described in TS 38.300 [27] and TS 38.401 [42].\nSecurity functions and entities are described in TS 33.501 [29] and TS 33.535 [124].\n5G Media streaming functions are described in TS 26.501 [135].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.2\tNetwork Function Functional description",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tAMF",
                            "text_content": "The Access and Mobility Management function (AMF) includes the following functionality. Some or all of the AMF functionalities may be supported in a single instance of an AMF:\n-\tTermination of RAN CP interface (N2).\n-\tTermination of NAS (N1), NAS ciphering and integrity protection.\n-\tRegistration management.\n-\tConnection management.\n-\tReachability management.\n-\tMobility Management.\n-\tLawful intercept (for AMF events and interface to LI System).\n-\tProvide transport for SM messages between UE and SMF.\n-\tTransparent proxy for routing SM messages.\n-\tAccess Authentication.\n-\tAccess Authorization.\n-\tProvide transport for SMS messages between UE and SMSF.\n-\tSecurity Anchor Functionality (SEAF) as specified in TS 33.501 [29].\n-\tLocation Services management for regulatory services.\n-\tProvide transport for Location Services messages between UE and LMF as well as between RAN and LMF.\n-\tEPS Bearer ID allocation for interworking with EPS.\n-\tUE mobility event notification.\n-\tS-NSSAIs per TA mapping notification.\n-\tSupport for Control Plane CIoT 5GS Optimisation.\n-\tSupport for User Plane CIoT 5GS Optimisation.\n-\tSupport for restriction of use of Enhanced Coverage.\n-\tProvisioning of external parameters (Expected UE Behaviour parameters or Network Configuration parameters).\n-\tSupport for Network Slice-Specific Authentication and Authorization.\n-\tSupport for charging.\n-\tControlling the 5G access stratum-based time distribution based on UE's subscription data.\n-\tControlling the gNB's time synchronization status reporting and subscription.\nNOTE 1:\tRegardless of the number of Network functions, there is only one NAS interface instance per access network between the UE and the CN, terminated at one of the Network functions that implements at least NAS security and Mobility Management.\nIn addition to the functionalities of the AMF described above, the AMF may include the following functionality to support non-3GPP access networks:\n-\tSupport of N2 interface with N3IWF/TNGF. Over this interface, some information (e.g. 3GPP Cell Identification) and procedures (e.g. Handover related) defined over 3GPP access may not apply, and non-3GPP access specific information may be applied that do not apply to 3GPP accesses.\n-\tSupport of NAS signalling with a UE over N3IWF/TNGF. Some procedures supported by NAS signalling over 3GPP access may be not applicable to untrusted non-3GPP (e.g. Paging) access.\n-\tSupport of authentication of UEs connected over N3IWF/TNGF.\n-\tManagement of mobility, authentication, and separate security context state(s) of a UE connected via a non-3GPP access or connected via a 3GPP access and a non-3GPP access simultaneously.\n-\tSupport as described in clause 5.3.2.3 a co-ordinated RM management context valid over a 3GPP access and a Non 3GPP access.\n-\tSupport as described in clause 5.3.3.4 dedicated CM management contexts for the UE for connectivity over non-3GPP access.\n-\tDetermine whether the serving N3IWF/TNGF is appropriate based on the slices supported by the N3IWFs/TNGFs as specified in clause 6.3.6 and clause 6.3.12 respectively.\nNOTE 2:\tNot all of the functionalities are required to be supported in an instance of a Network Slice.\nIn addition to the functionalities of the AMF described above, the AMF may include policy related functionalities as described in clause 6.2.8 of TS 23.503 [45].\nThe AMF uses the N14 interface for AMF re-allocation and AMF to AMF information transfer. This interface may be either intra-PLMN or inter-PLMN (e.g. in the case of inter-PLMN mobility).\nIn addition to the functionality of the AMF described above, the AMF may include the following functionality to support monitoring in roaming scenarios:\n-\tNormalization of reports according to roaming agreements between VPLMN and HPLMN (e.g. change the location granularity in a report from cell level to a level that is appropriate for the HPLMN); and\n-\tGeneration of charging/accounting information for Monitoring Event Reports that are sent to the HPLMN.\nIn addition to the functionality of the AMF described above, the AMF may provide support for Network Slice restriction and Network Slice instance restriction based on NWDAF analytics.\nIn addition to the functionalities of the AMF described above, the AMF may provide support for the Disaster Roaming as described in clause 5.40.\nIn addition to the functionalities of the AMF described above, the AMF may also include following functionalities to support Network Slice Admission Control:\n-\tSupport of NSAC for maximum number of UEs as defined in clauses 5.15.11.1 and 5.15.11.3.\nIn addition to the functionality of the AMF described above, the AMF may include the following functionality to support SNPNs:\n-\tSupport for Onboarding of UEs for SNPNs.\nIn addition to the functionalities of the AMF described above, the AMF may also include following functionalities to support satellite backhaul:\n-\tSupport for reporting satellite backhaul category and its modification based on AMF local configuration to SMF as defined in clause 5.43.4.\nIn addition to the functionalities of the AMF described above, the AMF may provide support for Network Slice instance change for PDU sessions as defined in clause 5.15.5.3.\nIn addition to the functionalities of the AMF described above, the AMF may also support functionalities for Partial Network Slice support in a Registration Area as described in clause 5.15.17.\nIn addition to the functionalities of the AMF described above, the AMF may also include functionalities to support NS-AoS not matching deployed Tracking Areas as described in clause 5.15.18.\nIn addition to the functionalities of the AMF described above, the AMF may also include functionalities to support Network Slice Replacement as described in clause 5.15.19.\nIn addition to the functionalities of the AMF described above, the AMF may also include functionalities to enforce the LADN Service Area per LADN DNN and S-NSSAI for a UE as described in clause 5.6.5a, as well as to enforce the LADN Service Area per LADN DNN for a UE in clause 5.6.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tSMF",
                            "text_content": "The Session Management function (SMF) includes the following functionality. Some or all of the SMF functionalities may be supported in a single instance of a SMF:\n-\tSession Management e.g. Session Establishment, modify and release, including tunnel maintain between UPF and AN node.\n-\tUE IP address allocation & management (including optional Authorization). The UE IP address may be received from a UPF or from an external data network.\n-\tDHCPv4 (server and client) and DHCPv6 (server and client) functions.\n-\tFunctionality to respond to Address Resolution Protocol (ARP) requests and / or IPv6 Neighbour Solicitation requests based on local cache information for the Ethernet PDUs. The SMF responds to the ARP and / or the IPv6 Neighbour Solicitation Request by providing the MAC address corresponding to the IP address sent in the request.\n-\tSelection and control of UP function, including controlling the UPF to proxy ARP or IPv6 Neighbour Discovery, or to forward all ARP/IPv6 Neighbour Solicitation traffic to the SMF, for Ethernet PDU Sessions.\n-\tConfigures traffic steering at UPF to route traffic to proper destination.\n-\t5G VN group management, e.g. maintain the topology of the involved PSA UPFs, establish and release the N19 tunnels between PSA UPFs, configure traffic forwarding at UPF to apply local switching, N6-based forwarding or N19-based forwarding, manage traffic forwarding in the case that a SMF Set or multiple SMF Sets are serving a 5G VN.\n-\tTermination of interfaces towards Policy control functions.\n-\tLawful intercept (for SM events and interface to LI System).\n-\tSupport for charging.\n-\tControl and coordination of charging data collection at UPF.\n-\tTermination of SM parts of NAS messages.\n-\tDownlink Data Notification.\n-\tInitiator of AN specific SM information, sent via AMF over N2 to AN.\n-\tDetermine SSC mode of a session.\n-\tSupport for Control Plane CIoT 5GS Optimisation.\n-\tSupport of header compression.\n-\tAct as I-SMF in deployments where I-SMF can be inserted, removed and relocated.\n-\tProvisioning of external parameters (Expected UE Behaviour parameters or Network Configuration parameters).\n-\tSupport P-CSCF discovery for IMS services.\n-\tAct as V-SMF with following roaming functionalities:\n-\tHandle local enforcement to apply QoS SLAs (VPLMN).\n-\tCharging (VPLMN).\n-\tLawful intercept (in VPLMN for SM events and interface to LI System).\n-\tSupport for interaction with external DN for transport of signalling for PDU Session authentication/authorization by external DN.\n-\tInstructs UPF and NG-RAN to perform redundant transmission on N3/N9 interfaces.\n-\tGeneration of the TSC Assistance Information based on the TSC Assistance Container received from the PCF.\n-\tSupport for RAN feedback for BAT offset and adjusted periodicity as defined in clause 5.27.2.5.\nNOTE:\tNot all of the functionalities are required to be supported in an instance of a Network Slice.\nIn addition to the functionalities of the SMF described above, the SMF may include policy related functionalities as described in clause 6.2.2 of TS 23.503 [45].\nIn addition to the functionality of the SMF described above, the SMF may include the following functionality to support monitoring in roaming scenarios:\n-\tNormalization of reports according to roaming agreements between VPLMN and HPLMN; and\n-\tGeneration of charging information for Monitoring Event Reports that are sent to the HPLMN.\nThe SMF may also include following functionalities to support Edge Computing enhancements (further defined in TS 23.548 [130]):\n-\tSelection of EASDF and provision of its address to the UE as the DNS Server for the PDU session;\n-\tUsage of EASDF services as defined in TS 23.548 [130];\n-\tFor supporting the Application Layer Architecture defined in TS 23.558 [134]: Provision and updates of ECS Address Configuration Information to the UE.\nThe SMF and SMF+ PGW-C may also include following functionalities to support Network Slice Admission Control:\n-\tSupport of NSAC for maximum number of PDU sessions as defined in clauses 5.15.11.2, 5.15.11.3 and 5.15.11.5.\n-\tSupport of NSAC for maximum number of UEs as defined in clauses 5.15.11.3 and 5.15.11.5.\n-\tSupport of PDU Set based QoS handling as described in clause 5.37.5.\nThe SMF may also include following functionalities:\n-\tProviding per-QoS flow Non-3GPP QoS assistance information to the UE (e.g. PEGC) and formulation of the CN PDB based on non-3GPP delay budget from UE (e.g. PEGC) as described in clause 5.44.3.4.\nIn addition to the functionalities of the SMF described above, the SMF may also include functionalities to support Network Slice Replacement as described in clause 5.15.19.\nThe SMF may also include functionalities to support indirect UPF event exposure service subscription on behalf of the consumer NF(s) as described in clause 4.15.4.5 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tUPF",
                            "text_content": "The User plane function (UPF) includes the following functionality. Some or all of the UPF functionalities may be supported in a single instance of a UPF:\n-\tAnchor point for Intra-/Inter-RAT mobility (when applicable).\n-\tAllocation of UE IP address/prefix (if supported) in response to SMF request.\n-\tExternal PDU Session point of interconnect to Data Network.\n-\tPacket routing & forwarding (e.g. support of Uplink classifier to route traffic flows to an instance of a data network, support of Branching point to support multi-homed PDU Session, support of traffic forwarding within a 5G VN group (UPF local switching, via N6, via N19)).\n-\tPacket inspection (e.g. Application detection based on service data flow template and the optional PFDs received from the SMF in addition).\n-\tUser Plane part of policy rule enforcement, e.g. Gating, Redirection, Traffic steering).\n-\tLawful intercept (UP collection).\n-\tTraffic usage reporting.\n-\tQoS handling for user plane, e.g. UL/DL rate enforcement, Reflective QoS marking in DL.\n-\tUplink Traffic verification (SDF to QoS Flow mapping).\n-\tTransport level packet marking in the uplink and downlink.\n-\tDownlink packet buffering and downlink data notification triggering.\n-\tSending and forwarding of one or more \"end marker\" to the source NG-RAN node.\n-\tFunctionality to respond to Address Resolution Protocol (ARP) requests and / or IPv6 Neighbour Solicitation requests based on local cache information for the Ethernet PDUs. The UPF responds to the ARP and / or the IPv6 Neighbour Solicitation Request by providing the MAC address corresponding to the IP address sent in the request.\n-\tPacket duplication in downlink direction and elimination in uplink direction in GTP-U layer.\n-\tNW-TT functionality.\n-\tHigh latency communication, see clause 5.31.8.\n-\tATSSS Steering functionality to steer the MA PDU Session traffic, refer to clause 5.32.6.\nNOTE:\tNot all of the UPF functionalities are required to be supported in an instance of user plane function of a Network Slice.\n-\tInter PLMN UP Security (IPUPS) functionality, specified in clause 5.8.2.14.\n-\tEvent exposure, including exposure of network information, i.e. the QoS monitoring information, as specified in clause 5.8.2.18, events as specified in clause 5.2.26.2 of TS 23.502 [3], exposure of data collected for analytics, as specified in clause 5.2.26.2 of TS 23.502 [3] and exposure of the TSC management information as specified in clause 5.8.5.14.\n-\tExposure of the UE information, e.g. UE IP address translation information as specified in clause 5.2.26.3 of TS 23.502 [3] and clause 4.15.10 of TS 23.502 [3] if Network address translation (i.e. NAT) functionality of the UE IP address is deployed within UPF.\n-\tSupport PDU Set Handling as defined in clause 5.37.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.4\tPCF",
                            "text_content": "The Policy Control Function (PCF) includes the following functionality:\n-\tSupports unified policy framework to govern network behaviour.\n-\tProvides policy rules to Control Plane function(s) to enforce them.\n-\tAccesses subscription information relevant for policy decisions in a Unified Data Repository (UDR).\n-\tSupport PDU Set Handling as defined in clause 5.37.5.\nNOTE:\tThe PCF accesses the UDR located in the same PLMN as the PCF.\nThe details of the PCF functionality are defined in clause 6.2.1 of TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.5\tNEF",
                            "text_content": "The Network Exposure Function (NEF) supports the following independent functionality:\n-\tExposure of capabilities and events:\nNF capabilities and events may be securely exposed by NEF for e.g. 3rd party, Application Functions, Edge Computing as described in clause 5.13.\nNEF stores/retrieves information as structured data using a standardized interface (Nudr) to the Unified Data Repository (UDR).\n-\tSecure provision of information from external application to 3GPP network:\nIt provides a means for the Application Functions to securely provide information to 3GPP network, e.g. Expected UE Behaviour, 5G-VN group information, time synchronization service information and PDU Set handling service specific information. In that case the NEF may authenticate and authorize and assist in throttling the Application Functions.\n-\tTranslation of internal-external information:\nIt translates between information exchanged with the AF and information exchanged with the internal network function. For example, it translates between an AF-Service-Identifier and internal 5G Core information such as DNN, S-NSSAI, as described in clause 5.6.7.\nIn particular, NEF handles masking of network and user sensitive information to external AF's according to the network policy.\n-\tRedirecting the AF to a more suitable NEF/L-NEF e.g. when serving an AF request for local information exposure and detecting there is a more appropriate NEF instance to serve the AF's request.\n-\tThe Network Exposure Function receives information from other network functions (based on exposed capabilities of other network functions). NEF stores the received information as structured data using a standardized interface to a Unified Data Repository (UDR). The stored information can be accessed and \"re-exposed\" by the NEF to other network functions and Application Functions, and used for other purposes such as analytics.\n-\tA NEF may also support a PFD Function: The PFD Function in the NEF may store and retrieve PFD(s) in the UDR and shall provide PFD(s) to the SMF on the request of SMF (pull mode) or on the request of PFD management from NEF (push mode), as described in TS 23.503 [45].\n-\tA NEF may also support a 5G-VN Group Management Function: The 5G-VN Group Management Function in the NEF may store the 5G-VN group information in the UDR via UDM as described in TS 23.502 [3].\n-\tSupport management of ECS Address Information.\n-\tSupport management of relationship between DNAI and EAS Address Information.\n-\tExposure of analytics:\nNWDAF analytics may be securely exposed by NEF for external party, as specified in TS 23.288 [86].\n-\tRetrieval of data from external party by NWDAF:\nData provided by the external party may be collected by NWDAF via NEF for analytics generation purpose. NEF handles and forwards requests and notifications between NWDAF and AF, as specified in TS 23.288 [86].\n-\tSupport of Non-IP Data Delivery:\nNEF provides a means for management of NIDD configuration and delivery of MO/MT unstructured data by exposing the NIDD APIs as described in TS 23.502 [3] on the N33/Nnef reference point. See clause 5.31.5.\n-\tCharging data collection and support of charging interfaces.\n-\tSupport of Member UE selection assistance functionality:\n-\tNEF may provide one or more list(s) of candidate UE(s) (among the list of target member UE(s) provided by the AF) and additional information to the AF based on the parameters contained in the request from the AF as described in clause 5.46.2. NEF supports the translation of the member UE selection filtering criteria parameters received from the AF to the corresponding event or analytics filters that can be understood by the 5GC NFs for events or analytics related data collection. NEF interacts with 5GC NFs using existing services in order to collect the corresponding data and then derive the list(s) of candidate UE(s) and other assistance information as described in clause 4.15.13 of TS 23.502 [3].\n-\tSupport of Multi-member AF session with required QoS for a set of UEs identified by a list of UE addresses:\n-\tDetails are specified in clause 4.15.6.13 of TS 23.502 [3].\n-\tSupport of UAS NF functionality:\nDetails are defined in TS 23.256 [136].\n-\tSupport of EAS deployment functionality:\nDetails are defined in TS 23.548 [130].\n-\tSupport of SBI-based MO SM transmit for MSISDN-less MO SMS:\nDetails are defined in TS 23.540 [142].\n-\tSupport PDU Set Handling as defined in clause 5.37.5.\n-\tSupport management of common EAS and common DNAI:\nDetails are defined in TS 23.548 [130].\nA specific NEF instance may support one or more of the functionalities described above and consequently an individual NEF may support a subset of the APIs specified for capability exposure.\nNOTE:\tThe NEF can access the UDR located in the same PLMN as the NEF.\nThe services provided by the NEF are specified in clause 7.2.8.\nFor external exposure of services related to specific UE(s), the NEF resides in the HPLMN. Depending on operator agreements, the NEF in the HPLMN may have interface(s) with NF(s) in the VPLMN.\nWhen a UE is capable of switching between EPC and 5GC, an SCEF+NEF is used for service exposure. See clause 5.17.5 for a description of the SCEF+NEF.\nWhen an NEF is used for external exposure, the CAPIF may be supported. When CAPIF is supported, an NEF that is used for external exposure supports the CAPIF API provider domain functions. The CAPIF and associated API provider domain functions are specified in TS 23.222 [64].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.5a\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.6\tNRF",
                            "text_content": "The Network Repository Function (NRF) supports the following functionality:\n-\tSupports service discovery of NRF services and their endpoint addresses by the NRF bootstrapping service.\n-\tSupports service discovery function. Receive NF Discovery Request from NF instance or SCP, and provides the information of the discovered NF instances (be discovered) to the NF instance or SCP.\n-\tSupports P-CSCF discovery (specialized case of AF discovery by SMF).\n-\tMaintains the NF profile of available NF instances and their supported services.\n-\tMaintains SCP profile of available SCP instances.\n-\tSupports SCP discovery by SCP instances.\n-\tNotifies about newly registered/updated/ deregistered NF and SCP instances along with its potential NF services to the subscribed NF service consumer or SCP.\n-\tMaintains the health status of NFs and SCP.\nIn the context of Network Slicing, based on network implementation, multiple NRFs can be deployed at different levels (see clause 5.15.5):\n-\tPLMN level (the NRF is configured with information for the whole PLMN),\n-\tshared-slice level (the NRF is configured with information belonging to a set of Network Slices),\n-\tslice-specific level (the NRF is configured with information belonging to an S-NSSAI).\nIn the context of roaming, multiple NRFs may be deployed in the different networks (see clause 4.2.4):\n-\tthe NRF(s) in the Visited PLMN (known as the vNRF) configured with information for the visited PLMN.\n-\tthe NRF(s) in the Home PLMN (known as the hNRF) configured with information for the home PLMN, referenced by the vNRF via the N27 interface.\nNF profile of NF instance maintained in an NRF includes the following information:\n-\tNF instance ID.\n-\tNF type.\n-\tPLMN ID in the case of PLMN, PLMN ID + NID in the case of SNPN.\n-\tNetwork Slice related Identifier(s) e.g. S-NSSAI, NSI ID.\n-\tFQDN or IP address of NF.\n-\tNF capacity information.\n-\tNF priority information.\nNOTE 1:\tThis parameter is used for AMF selection, if applicable, as specified in clause 6.3.5. See clause 6.1.6.2.2 of TS 29.510 [58] for its detailed use.\n-\tNF Set ID.\n-\tNF Service Set ID of the NF service instance.\n-\tNF Specific Service authorization information.\n-\tif applicable, Names of supported services.\n-\tEndpoint Address(es) of instance(s) of each supported service.\n-\tIdentification of stored data/information.\nNOTE 2:\tThis is only applicable for a UDR profile. See applicable input parameters for Nnrf_NFManagement_NFRegister service operation in clause 5.2.7.2.2 of TS 23.502 [3]. This information applicability to other NF profiles is implementation specific.\n-\tOther service parameter, e.g. DNN or DNN list, notification endpoint for each type of notification that the NF service is interested in receiving.\n-\tLocation information for the NF instance.\nNOTE 3:\tThis information is operator specific. Examples of such information can be geographical location, data centre.\n-\tTAI(s).\n-\tNF load information.\n-\tRouting Indicator, Home Network Public Key identifier, for UDM and AUSF.\n-\tFor UDM, AUSF and NSSAAF in the case of access to an SNPN using credentials owned by a Credentials Holder with AAA Server, identification of Credentials Holder (i.e. the realm of the Network Specific Identifier based SUPI).\n-\tFor UDM and AUSF, and if UDM/AUSF is used for access to an SNPN using credentials owned by a Credentials Holder, identification of Credentials Holder (i.e. the realm if Network Specific Identifier based SUPI is used or the MCC and MNC if IMSI based SUPI is used); see clause 5.30.2.1.\n-\tFor AUSF and NSSAAF in the case of SNPN Onboarding using a DCS with AAA server, identification of DCS (i.e. the realm of the Network Specific Identifier based SUPI).\n-\tFor UDM and AUSF, and if UDM/AUSF is used as DCS in the case of SNPN Onboarding, identification of DCS (i.e. the realm if Network Specific Identifier based SUPI, or the MCC and MNC if IMSI based SUPI).\n-\tOne or more GUAMI(s), in the case of AMF.\n-\tFor the UPF, see clause 5.2.7.2.2 of TS 23.502 [3].\n-\tUDM Group ID, range(s) of SUPIs, range(s) of GPSIs, range(s) of internal group identifiers, range(s) of external group identifiers for UDM.\n-\tUDR Group ID, range(s) of SUPIs, range(s) of GPSIs, range(s) of external group identifiers for UDR.\n-\tAUSF Group ID, range(s) of SUPIs for AUSF.\n-\tPCF Group ID, range(s) of SUPIs for PCF.\n-\tHSS Group ID, set(s) of IMPIs, set(s) of IMPU, set(s) of IMSIs, set(s) of PSIs, set(s) of MSISDN for HSS.\n-\tFor NWDAF, the following information are supported:\n-\tAnalytics ID(s) (possibly per service).\n-\tNWDAF Serving Area information (i.e. list of TAIs for which the NWDAF can provide services and/or data).\n-\tSupported Analytics Delay per Analytics ID (if available).\n-\tNF types of the NF data sources, NF Set IDs of the NF data sources, if available.\n-\tAnalytics aggregation capability (if available).\n-\tAnalytics metadata provisioning capability (if available).\n-\tML model Filter information parameters include S-NSSAI(s) and Area(s) of Interest for the trained ML model(s) per Analytics ID(s).\n-\tML Model Interoperability indicator (if available) per Analytics ID(s).\n-\tFL capability information per analytics ID including FL capability type (i.e. FL server NWDAF or FL client NWDAF, if available).\n-\tTime interval supporting FL (if available).\n-\tAccuracy checking capability for ML model accuracy monitoring or Analytics Accuracy Monitoring (if available).\n-\tRoaming exchange capability (if available).\nNOTE 4:\tThe NWDAF's Serving Area information is common to all its supported Analytics IDs.\nNOTE 5:\tThe Analytics IDs supported by the NWDAF may be associated with a Supported Analytics Delay i.e. the Analytics report can be generated with a time (including data collection delay and inference delay) in less than or equal to the Supported Analytics Delay.\nNOTE 6:\tThe determination of Supported Analytics Delay, and how the NWDAF avoid updating its Supported Analytics Delay in NRF frequently is NWDAF implementation specific.\n-\tEvent ID(s) supported by AFs, in the case of NEF.\n-\tEvent Exposure service supported event ID(s) by UPF.\n-\tApplication Identifier(s) supported by AFs, in the case of NEF.\n-\tRange(s) of External Identifiers, or range(s) of External Group Identifiers, or the domain names served by the NEF, in the case of NEF.\nNOTE 7:\tThis is applicable when NEF exposes AF information for analytics purpose as detailed in TS 23.288 [86].\nNOTE 8:\tIt is expected service authorization information is usually provided by OA&M system, and it can also be included in the NF profile in the case that e.g. an NF instance has an exceptional service authorization information.\nNOTE 9:\tThe NRF may store a mapping between UDM Group ID and SUPI(s), UDR Group ID and SUPI(s), AUSF Group ID and SUPI(s) and PCF Group ID and SUPI(s), to enable discovery of UDM, UDR, AUSF and PCF using SUPI, SUPI ranges as specified in clause 6.3 or interact with UDR to resolve the UDM Group ID/UDR Group ID/AUSF Group ID/PCF Group ID based on UE identity, e.g. SUPI (see clause 6.3.1 for details).\n-\tIP domain list as described in clause 6.1.6.2.21 of TS 29.510 [58], Range(s) of (UE) IPv4 addresses or Range(s) of (UE) IPv6 prefixes, Range(s) of SUPIs or Range(s) of GPSIs or a BSF Group ID, in the case of BSF.\n-\tSCP Domain the NF belongs to.\n-\tDCCF Serving Area information, NF types of the data sources, NF Set IDs of the data sources, if available, in the case of DCCF.\n-\tSupported DNAI list, in the case of SMF.\n-\tFor SNPN, capability to support SNPN Onboarding in the case of AMF and capability to support User Plane Remote Provisioning in the case of SMF.\n-\tIP address range, DNAI for UPF.\n-\tAdditional V2X related NF profile parameters are defined in TS 23.287 [121].\n-\tAdditional ProSe related NF profile parameters are defined in TS 23.304 [128].\n-\tAdditional MBS related NF profile parameters are defined in TS 23.247 [129].\n-\tAdditional UAS related NF profile parameters are defined in TS 23.256 [136].\n-\tAdditional Ranging based services and Sidelink Positioning related NF profile parameters are defined in TS 23.586 [180].\n-\tFor additional information in PCF profile, see clause 5.2.7.2.2 of TS 23.502 [3].\nSCP profile maintained in an NRF includes the following information:\n-\tSCP ID.\n-\tFQDN or IP address of SCP.\n-\tIndication that the profile is of an SCP (e.g. NF type parameter set to type SCP).\n-\tSCP capacity information.\n-\tSCP load information.\n-\tSCP priority.\n-\tLocation information for the SCP (see locality in clause 6.1.6.2.2 of TS 29.510 [58]).\n-\tServed Location(s) (see servingScope in clause 6.1.6.2.2 of TS 29.510 [58]).\n-\tNetwork Slice related Identifier(s) e.g. S-NSSAI, NSI ID.\n-\tRemote PLMNs reachable through SCP.\n-\tEndpoint addresses accessible via the SCP.\n-\tNF sets of NFs served by the SCP.\n-\tSCP Domain the SCP belongs to. If an SCP belongs to more than one SCP Domain, the SCP will be able bridge these domains, i.e. sending messages between these domains.\nNOTE:\tService definition defines optional and mandatory parameters, see TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.7\tUDM",
                            "text_content": "The Unified Data Management (UDM) includes support for the following functionality:\n-\tGeneration of 3GPP AKA Authentication Credentials.\n-\tUser Identification Handling (e.g. storage and management of SUPI for each subscriber in the 5G system).\n-\tSupport of de-concealment of privacy-protected subscription identifier (SUCI).\n-\tAccess authorization based on subscription data (e.g. roaming restrictions).\n-\tUE's Serving NF Registration Management (e.g. storing serving AMF for UE, storing serving SMF for UE's PDU Session).\n-\tSupport to service/session continuity e.g. by keeping SMF/DNN assignment of ongoing sessions.\n-\tMT-SMS delivery support.\n-\tLawful Intercept Functionality (especially in outbound roaming case where UDM is the only point of contact for LI).\n-\tSubscription management.\n-\tSMS management.\n-\t5G-VN group management handling.\n-\tSupport of external parameter provisioning (Expected UE Behaviour parameters or Network Configuration parameters).\n-\tSupport for the Disaster Roaming as described in clause 5.40.\n-\tSupport for the control of time synchronization service based on subscription data as described in clause 5.27.1.11.\nTo provide this functionality, the UDM uses subscription data (including authentication data) that may be stored in UDR, in which case a UDM implements the application logic and does not require an internal user data storage and then several different UDMs may serve the same user in different transactions.\nNOTE 1:\tThe interaction between UDM and HSS, when they are deployed as separate network functions, is defined in TS 23.632 [102] and TS 29.563 [103] or it is implementation specific.\nNOTE 2:\tThe UDM is located in the HPLMN of the subscribers it serves, and access the information of the UDR located in the same PLMN.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.8\tAUSF",
                            "text_content": "The Authentication Server Function (AUSF) supports the following functionality:\n-\tSupports authentication for 3GPP access and untrusted non-3GPP access as specified in TS 33.501 [29].\n-\tSupports authentication of UE for a Disaster Roaming service as specified in TS 33.501 [29].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.9\tN3IWF",
                            "text_content": "The functionality of N3IWF in the case of untrusted non-3GPP access includes the following:\n-\tSupport of IPsec tunnel establishment with the UE: The N3IWF terminates the IKEv2/IPsec protocols with the UE over NWu and relays over N2 the information needed to authenticate the UE and authorize its access to the 5G Core Network.\n-\tTermination of N2 and N3 interfaces to 5G Core Network for control - plane and user-plane respectively.\n-\tRelaying uplink and downlink control-plane NAS (N1) signalling between the UE and AMF.\n-\tHandling of N2 signalling from SMF (relayed by AMF) related to PDU Sessions and QoS.\n-\tEstablishment of IPsec Security Association (IPsec SA) to support PDU Session traffic.\n-\tRelaying uplink and downlink user-plane packets between the UE and UPF. This involves:\n-\tDe-capsulation/ encapsulation of packets for IPSec and N3 tunnelling.\n-\tEnforcing QoS corresponding to N3 packet marking (e.g. DSCP), taking into account QoS requirements associated to such marking received over N2. QoS includes 5QI, the Priority Level (if explicitly signalled) and optionally, the ARP priority level.\nNOTE:\tBased on operator policy and/or regional/national regulations, the N3IWF can apply a different DSCP value to the outer ESP tunnel packet than the DSCP value of the inner IP packet.\n-\tPacket marking, e.g. setting the DSCP value based on the Establishment cause on N2, and based on 5QI, the Priority Level (if explicitly signalled) and optionally, the ARP priority level on N3.\n-\tLocal mobility anchor within untrusted non-3GPP access networks using MOBIKE per IETF RFC 4555 [57].\n-\tSupporting AMF selection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.9A\tTNGF",
                            "text_content": "The functionality of TNGF in the case of trusted non-3GPP access includes the following:\n-\tTerminates the N2 and N3 interfaces.\n-\tTerminates the EAP-5G signalling and behaves as authenticator when the UE attempts to register to 5GC via the TNAN.\n-\tImplements the AMF selection procedure.\n-\tTransparently relays NAS messages between the UE and the AMF, via NWt.\n-\tHandles N2 signalling with SMF (relayed by AMF) for supporting PDU sessions and QoS.\n-\tTransparently relays PDU data units between the UE and UPF(s).\n-\tImplements a local mobility anchor within the TNAN.\n-\tPacket marking in the downlink, and the uplink on N2 and N3, as for the N3IWF (clause 6.2.9).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.10\tAF",
                            "text_content": "The Application Function (AF) interacts with the 3GPP Core Network in order to provide services, for example to support the following:\n-\tApplication Function influence on traffic routing (see clause 5.6.7);\n-\tApplication Function influence on Service Function Chaining (see clause 5.6.16.2);\n-\tAccessing Network Exposure Function (see clause 5.20);\n-\tInteracting with the Policy and charging control framework (see clause 5.14);\n-\tTime synchronization service (see clause 5.27.1.8);\n-\tIMS interactions with 5GC (see clause 5.16).\n-\tSupport PDU Set Handling as defined in clause 5.37.5.\nBased on operator deployment, Application Functions considered to be trusted by the operator can be allowed to interact directly with relevant Network Functions.\nApplication Functions not allowed by the operator to access directly the Network Functions shall use the external exposure framework (see clause 7.3) via the NEF to interact with relevant Network Functions.\nThe functionality and purpose of Application Functions are only defined in this specification with respect to their interaction with the 3GPP Core Network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.11\tUDR",
                            "text_content": "The Unified Data Repository (UDR) supports the following functionality:\n-\tStorage and retrieval of subscription data by the UDM.\n-\tStorage and retrieval of policy data by the PCF.\n-\tStorage and retrieval of structured data for exposure.\n-\tApplication data (including Packet Flow Descriptions (PFDs) for application detection, AF request information for multiple UEs, 5G-VN group information for 5G-VN management).\n-\tStorage and retrieval of NF Group ID corresponding to subscriber identifier (e.g. IMPI, IMPU, SUPI).\nThe Unified Data Repository is located in the same PLMN as the NF service consumers storing in and retrieving data from it using Nudr. Nudr is an intra-PLMN interface.\nNOTE 1:\tDeployments can choose to collocate UDR with UDSF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.12\tUDSF",
                            "text_content": "The UDSF is an optional function that supports the following functionality:\n-\tStorage and retrieval of information as unstructured data by any NF. Notify a NF consumer if information validity has expired.\n-\tTimer service to any NF.\nNOTE 1:\tStructured data in this specification refers to data for which the structure is defined in 3GPP specifications. Unstructured data refers to data for which the structure is not defined in 3GPP specifications.\nNOTE 2:\tDeployments can choose to collocate UDSF with UDR.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.13\tSMSF",
                            "text_content": "The SMSF supports the following functionality to support SMS over NAS:\n-\tSMS management subscription data checking and conducting SMS delivery accordingly.\n-\tSM-RP/SM-CP with the UE (see TS 24.011 [6]).\n-\tRelay the SM from UE toward SMS-GMSC/IWMSC/SMS-Router.\n-\tRelay the SM from SMS-GMSC/IWMSC/SMS-Router toward the UE.\n-\tSMS charging.\n-\tLawful Interception.\n-\tInteraction with AMF and SMS-GMSC for notification procedure that the UE is unavailable for SMS transfer (i.e, notifies SMS-GMSC to inform UDM when UE is unavailable for SMS).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.14\tNSSF",
                            "text_content": "The Network Slice Selection Function (NSSF) supports the following functionality:\n-\tSelecting the set of Network Slice instances serving the UE;\n-\tDetermining the Allowed NSSAI and, if needed, the mapping to the Subscribed S-NSSAIs;\n-\tDetermining the Configured NSSAI and, if needed, the mapping to the Subscribed S-NSSAIs;\n-\tDetermining the AMF Set to be used to serve the UE, or, based on configuration, a list of candidate AMF(s), possibly by querying the NRF;\n-\tThe NSSF may provide support for Network Slice restriction and Network Slice instance restriction based on NWDAF analytics.\n-\tDetermining whether an S-NSSAI has to be replaced and providing to the AMF the indication that the S-NSSAI is unavailable and a corresponding Alternative S-NSSAI, e.g. based on received NWDAF analytics (e.g. for Service Experience for a Network Slice or Slice load level), or local trigger from the OAM system.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.15\t5G-EIR",
                            "text_content": "The 5G-EIR is an optional network function that supports the following functionality:\n-\tCheck the status of PEI (e.g. to check that it has not been prohibited).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.16\tLMF",
                            "text_content": "The functionality of LMF is defined in clause 4.3.8 of TS 23.273 [87].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.16A\tGMLC",
                            "text_content": "The functionality of GMLC is defined in clause 4.3.8 of TS 23.273 [87].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.17\tSEPP",
                            "text_content": "The Security Edge Protection Proxy (SEPP) is a non-transparent proxy and supports the following functionality:\n-\tMessage filtering and policing on inter-PLMN control plane interfaces.\nNOTE:\tThe SEPP protects the connection between Service Consumers and Service Producers from a security perspective, i.e. the SEPP does not duplicate the Service Authorization applied by the Service Producers as specified in clause 7.1.4.\n-\tTopology hiding.\nDetailed functionality of SEPP, related flows and the N32 reference point, are specified in TS 33.501 [29].\nThe SEPP applies the above functionality to every Control Plane message in inter-PLMN signalling, acting as a service relay between the actual Service Producer and the actual Service Consumer. For both Service Producer and Consumer, the result of the service relaying is equivalent to a direct service interaction. Every Control Plane message in inter-PLMN signalling between the SEPPs may pass via IPX entities. More details on SEPPs and the IPX entities are described in TS 29.500 [49] and TS 33.501 [29].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.18\tNetwork Data Analytics Function (NWDAF)",
                            "text_content": "The Network Data Analytics Function (NWDAF) includes one or more of the following functionalities:\n-\tSupport data collection from NFs and AFs;\n-\tSupport data collection from OAM;\n-\tSupport retrieval of information from data repositories (e.g. UDR via UDM for subscriber-related information or via NEF(PFDF) for PFD information);\n-\tSupport data collection of location information from LCS system;\n-\tNWDAF service registration and metadata exposure to NFs and AFs;\n-\tSupport analytics information provisioning to NFs and AFs;\n-\tSupport Machine Learning (ML) model training and provisioning to NWDAFs (containing Analytics logical function);\n-\tSupport bulked data related to Analytics ID(s) provisioning for NFs;\n-\tSupport accuracy information about Analytics IDs provisioning for NFs;\n-\tSupport accuracy information or accuracy degradation about ML model provisioning for NFs;\n-\tSupport roaming exchange capability to exchange data and analytics between PLMNs;\n-\tSupport Federated Learning (FL) to train an ML model among multiple NWDAFs (containing MTLF).\nThe details of the NWDAF functionality are defined in TS 23.288 [86].\nNOTE 1:\tSome or all of the NWDAF functionalities can be supported in a single instance of an NWDAF.\nNOTE 2:\tNWDAF functionality beyond its support for Nnwdaf is out of scope of 3GPP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.19\tSCP",
                            "text_content": "The Service Communication Proxy (SCP) includes one or more of the following functionalities. Some or all of the SCP functionalities may be supported in a single instance of an SCP:\n-\tIndirect Communication (see clause 7.1.1 for details).\n-\tDelegated Discovery (see clauses 7.1.1 and 6.3.1 for details).\n-\tMessage forwarding and routing to destination NF/NF service.\n-\tMessage forwarding and routing to a next hop SCP.\n-\tCommunication security (e.g. authorization of the NF Service Consumer to access the NF Service Producer API), load balancing, monitoring, overload control, etc.\n-\tOptionally interact with UDR, to resolve the UDM Group ID/UDR Group ID/AUSF Group ID/PCF Group ID/CHF Group ID/HSS Group ID based on UE identity, e.g. SUPI or IMPI/IMPU (see clause 6.3.1 for details).\nNOTE 1:\tCommunication security, e.g. authorization of the NF Service Consumer to access the NF Service Producer's API is specified in TS 33.501 [29].\nNOTE 2:\tLoad balancing, monitoring, overload control functionality provided by the SCP is left up to implementation.\nThe SCP may be deployed in a distributed manner.\nNOTE 3:\tMore than one SCP can be present in the communication path between NF Services.\nSCPs can be deployed at PLMN level, shared-slice level and slice-specific level. It is left to operator deployment to ensure that SCPs can communicate with relevant NRFs.\nIn order to enable SCPs to route messages through several SCPs (i.e. next SCP hop discovery, see clause 6.3.16), an SCP may register its profile in the NRF. Alternatively, local configuration may be used.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.20\tW-AGF",
                            "text_content": "The functionality of W-AGF is specified in TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.21\tUE radio Capability Management Function (UCMF)",
                            "text_content": "The UCMF is used for storage of dictionary entries corresponding to either PLMN-assigned or Manufacturer-assigned UE Radio Capability IDs. An AMF may subscribe with the UCMF to obtain from the UCMF new values of UE Radio Capability ID that the UCMF assigns for the purpose of caching them locally.\nProvisioning of Manufacturer-assigned UE Radio Capability ID entries in the UCMF is performed from an AF that interacts with the UCMF either directly or via the NEF (or via Network Management) using a procedure defined in TS 23.502 [3]. A UCMF that serves both EPS and 5GS shall require provisioning the UE Radio Capability ID with the TS 36.331 [51] format or TS 38.331 [28] format or both the formats of the UE radio capabilities.\nThe UCMF also assigns the PLMN-assigned UE Radio Capability ID values.\nEach PLMN-assigned UE Radio Capability ID is also associated to the TAC of the UE model(s) that it is related to. When an AMF requests the UCMF to assign a UE Radio Capability ID for a set of UE radio capabilities, it indicates the TAC of the UE that the UE Radio Capability information is related to.\nThe UCMF stores a Version ID value for the PLMN assigned UE Radio Capability IDs so it is included in the PLMN assigned UE Radio Capability IDs it assigns. This shall be configured in the UCMF.\nThe UCMF may be provisioned with a dictionary of Manufacturer-assigned UE Radio Capability IDs which include a \"Vendor ID\" that applies to the Manufacturers of these UE, and a list of TACs for which the PLMN has obtained-Manufacturer-assigned UE Radio Capability IDs.\nA PLMN-assigned UE Radio Capability IDs is kept in the UCMF storage as long as it is associated with at least a TAC value. When a TAC value is related to a UE model that is earmarked for operation based on Manufacturer assigned UE Radio Capability IDs, this TAC value is disassociated in the UCMF from any PLMN assigned UE Radio Capability IDs.\nFor the case that the PLMN is configured to store PLMN assigned IDs in the Manufacturer Assigned operation requested list defined in clause 4.4.1a, the UCMF does not remove from storage any PLMN assigned UE Radio Capability ID no longer used, and rather quarantines it to avoid any future reassignment.\nA UCMF dictionary entry shall include also the related UE Radio Capability for Paging for each RAT.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.22\tTWIF",
                            "text_content": "The functionality of Trusted WLAN Interworking Function (TWIF) is specified in clause 4.2.8.5.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.23\tNSSAAF",
                            "text_content": "The Network Slice-specific and SNPN Authentication and Authorization Function (NSSAAF) supports the following functionality:\n-\tSupport for Network Slice-Specific Authentication and Authorization as specified in TS 23.502 [3] with a AAA Server (AAA-S). If the AAA-S belongs to a third party, the NSSAAF may contact the AAA-S via a AAA proxy (AAA-P).\n-\tSupport for access to SNPN using credentials from Credentials Holder using AAA server (AAA-S) as specified in clause 5.30.2.9.2 or using credentials from Default Credentials Server using AAA server (AAA-S) as specified in clause 5.30.2.10.2. If the Credentials Holder or Default Credentials Server belongs to a third party, the NSSAAF may contact the AAA server via a AAA proxy (AAA-P).\nNOTE:\tWhen the NSSAAF is deployed in a PLMN, the NSSAAF supports Network Slice-Specific Authentication and Authorization, while when the NSSAAF is deployed in a SNPN the NSSAAF can support Network Slice-Specific Authentication and Authorization and/or the NSSAAF can support access to SNPN using credentials from Credentials Holder.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.24\tDCCF",
                            "text_content": "The Data Collection Coordination Function (DCCF) supports the following functionality:\n-\tDetermining Data Sources that can provide data for a received data request.\n-\tDetermining whether data is already being collected from a data source.\n-\tInstructing a Messaging Framework to send data to consumers or notification endpoints.\n-\tInstructing a Messaging Framework to do formatting and processing of the data sent via the Messaging Framework.\n-\tFormatting and processing of data.\n-\tSending data to consumers or notification endpoints.\n-\tRegistering NWDAFs and ADRFs that are already receiving data from a Data Source.\nThe DCCF functionality is specified in TS 23.288 [86].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.25\tMFAF",
                            "text_content": "The Messaging Framework Adaptor Function (MFAF) supports the following functionality:\n-\tInterfacing with a DCCF that controls how a messaging framework will process, format and send data to consumers or notification endpoints.\n-\tReceiving data from Data Sources via services offered by those Data Sources.\n-\tSending data received from Data Sources to a messaging framework (outside the scope of 3GPP).\n-\tReceiving data from a messaging framework (outside the scope of 3GPP).\n-\tProcessing, formatting and sending data to specified consumers or notification endpoints.\nNOTE:\tThe internal logic of Messaging Framework is outside the scope of 3GPP, only MFAF and the interface between MFAF and other 3GPP defined NF is under 3GPP scope.\nThe MFAF functionality is specified in TS 23.288 [86].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.26\tADRF",
                            "text_content": "The Analytics Data Repository Function (ADRF) supports the following functionality:\n-\tStorage and retrieval of analytics generated by NWDAFs and collected data.\n-\tStorage and retrieval of ML model files trained by NWDAFs containing MTLF.\nThe Analytics Data Repository Function (ADRF) is specified in TS 23.288 [86].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.27\tMB-SMF",
                            "text_content": "The functionality of MB-SMF is specified in TS 23.247 [129].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.27a\tMB-UPF",
                            "text_content": "The functionality of MB-UPF is specified in TS 23.247 [129].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.27b\tMBSF",
                            "text_content": "The functionality of MBSF is specified in TS 23.247 [129].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.27c\tMBSTF",
                            "text_content": "The functionality of MBSTF is specified in TS 23.247 [129].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.28\tNSACF",
                            "text_content": "The Network Slice Admission Control Function (NSACF) supports the following functionality:\n-\tSupport of monitoring and controlling the number of registered UEs per network slice.\n-\tSupport of monitoring and controlling the number of UEs with at least one PDU Session/PDN Connection per network slice in case of EPC interworking.\n-\tSupport of monitoring and controlling the number of established PDU Sessions per network slice.\n-\tSupport of event based Network Slice status notification and reports to a consumer NF.\n-\tActing as a Centralized NSACF in PLMNs deploying a centralized architecture as described in clause 5.15.11.0.\n-\tSupport of different type of NSAC modes for roaming UEs for the number of UEs per network slice.\n-\tSupport of different type of NSAC modes for roaming UEs for the number of PDU Sessions per network slice.\n-\tActing as a Primary NSACF in PLMNs deploying a hierarchal architecture as described in clause 5.15.11.0.\nThe details of the NSACF functionality are defined in clause 5.15.11.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.29\tTSCTSF",
                            "text_content": "The Time Sensitive Communication and Time Synchronization Function (TSCTSF) supports the following functionality:\n-\tAssociating the time synchronization service request (see clause 5.27.1.8) from the NF consumer to the AF sessions with the PCF (the session between the PCF and TSCTSF).\n-\tControlling time synchronization service request from the NF consumer, (g)PTP-based time distribution and ASTI-based time distribution based on subscription data. The TSCTSF may be pre-configured with one or several PTP instance configurations. For each PTP instance configuration, it may contain:\n-\ta reference to the PTP instance configuration.\n-\tPTP profile.\n-\tPTP domain.\n-\tDetecting and reporting time synchronization service status based on NG-RAN and UPF/NW-TT timing synchronization status information and reporting status updates.\n-\tManaging the DS-TT and NW-TT via exchange of PMIC and UMIC as described in Annex K.\n-\tDetecting availability of 5GS Bridge/Router information (including user plane node ID that applies also for IP type PDU Sessions) as reported by PCF for both Ethernet and IP type PDU Sessions (including the need to (un)subscribe 5GS Bridge/Router information Notification from PCF).\n-\tCreating the TSC Assistance Container based on individual traffic pattern parameters from the NEF/AF or DetNet controller and providing it to the PCF.\n-\tDetermining the Requested PDB by subtracting the UE-DS-TT Residence Time from the Requested 5GS Delay provided by the NEF/AF or DetNet controller and providing the determined Requested PDB to the PCF.\n-\tDiscovering the AMFs serving the list of TA(s) that comprise the spatial validity condition from the NRF or AMFs serving the UE(s) from the UDM and subscribing to the discovered AMF(s) to receive notifications about presence of the UE in an Area of Interes.\n-\tDiscovering the AMF(s) serving a UE or a list of TA(s) and subscribing to gNB's node-level timing synchronization status.\n-\tObtaining gNB's and UPF's node-level timing synchronization status information as defined in clause 5.27.1.12.\n-\tDetermining the spatial validity condition from the requested coverage area by the NEF/AF and enforcing time synchronization service for the requested coverage area.\n-\tSupport for RAN feedback for BAT offset and adjusted periodicity as defined in clause 5.27.2.5.\n-\tIn the case of support of integration with IETF Deterministic Networking (as depicted in clauses 4.4.8.4 and 5.28.5), acting as a stateful translator function between a DetNet controller and 5G System Network Functions and Procedures, including the NW-TT. This includes exposing the information about the 5GS router to the DetNet controller and mapping 5GS router configuration parameters provided by the DetNet controller to 5G System parameters. The details are defined in clause 5.28.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.30\t5G DDNMF",
                            "text_content": "The functionality of 5G DDNMF is defined in TS 23.304 [128].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.31\tEASDF",
                            "text_content": "The functionality of EASDF is defined in TS 23.548 [130].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.32\tTSN AF",
                            "text_content": "The TSN AF supports control plane translator functionality for the integration of the 5GS with a TSN network, this involves e.g.:\n-\t5GS Bridge management.\n-\tPort and bridge management information exchange with DS-TT or NW-TT.\n-\tInteractions with the CNC for 5GS Bridge configuration and reporting.\n-\tdetermining the TSC Assistance Container and TSN QoS information by mapping TSN Stream(s) based on IEEE standards. The traffic pattern parameter determination may be based on PSFP (IEEE Std 802.1Q [98]) as specified in Annex I, clause I.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.33\tNSWOF",
                            "text_content": "The NSWOF interfaces the WLAN access network using the SWa interface as defined in TS 23.402 [43] and interfaces the AUSF using the Nausf SBI performing protocol translation and AUSF discovery (see clause 6.3.4).\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3\tPrinciples for Network Function and Network Function Service discovery and selection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tGeneral",
                            "text_content": "The NF discovery and NF service discovery enable Core Network entities (NFs or Service Communication Proxy (SCP)) to discover a set of NF instance(s) and NF service instance(s) for a specific NF service or an NF type. NF service discovery is enabled via the NF discovery procedure, as specified in clauses 4.17.4, 4.17.5, 4.17.9 and 4.17.10 of TS 23.502 [3].\nUnless the expected NF and NF service information is locally configured on the requester NF, e.g. when the expected NF service or NF is in the same PLMN as the requester NF, the NF and NF service discovery is implemented via the Network Repository Function (NRF). NRF is the logical function that is used to support the functionality of NF and NF service discovery and status notification as specified in clause 6.2.6.\nNOTE 1:\tNRF can be colocated together with SCP e.g. for communication option D, depicted in Annex E.\nIn order for the requested NF type or NF service to be discovered via the NRF, the NF instance need to be registered in the NRF. This is done by sending a Nnrf_NFManagement_NFRegister containing the NF profile. The NF profile contains information related to the NF instance, such as NF instance ID, supported NF service instances (see clause 6.2.6 for more details regarding the NF profile). The registration may take place e.g. when the producer NF instance and its NF service instance(s) become operative for the first time. The NF service registration procedure is specified in clause 4.17.1 of TS 23.502 [3].\nIn order for the requester NF or SCP to obtain information about the NF and/or NF service(s) registered or configured in a PLMN/slice, based on local configuration the requester NF or SCP may initiate a discovery procedure with the NRF by providing the type of the NF and optionally a list of the specific service(s) it is attempting to discover. The requester NF or SCP may also provide other service parameters e.g. slicing related information. For the detailed service parameter(s) used for specific NF and NF service discovery refer to clause 5.2.7.3.2 of TS 23.502 [3]. The requester NF may also provide NF Set related information to enable reselection of NF instances within the NF set. The requester NF may also provide the required supported features of the NF.\nFor some Network Functions which have access to the subscription data (e.g. HSS, UDM) the NRF may need to resolve the NF Group ID corresponding to a subscriber identifier. If the NRF has no stored configuration mapping identity sets/ranges to NF Group ID locally, the NRF may retrieve the NF Group ID corresponding to a specific subscriber identifier from the UDR using the Nudr_GroupIDmap_Query service operation.\nIn the case of Indirect Communication, a NF Service Consumer employs an SCP which routes the request to the intended target of the request.\nIf the requester NF is configured to delegate discovery, the requester NF may omit the discovery procedure with the NRF and instead delegate the discovery to the SCP; the SCP will then act on behalf of the requester NF. In this case, the requester NF adds any necessary discovery and selection parameters to the request in order for the SCP to be able to do discovery and associated selection. The SCP may interact with the NRF to perform discovery and obtain discovery result and it may interact with the NRF or UDR to obtain NF Group ID corresponding to subscriber identifier.\nNOTE 2:\tFor delegated discovery of the HSS or the UDM, the SCP can rely on the NRF to discover the group of HSS/UDM instance(s) serving the provided user identity, or in some deployments the SCP can first query the UDR for the HSS/UDM Group ID for the provided user identity. It is expected that the stage 3 defines a single encoding for the user identity provided by the service consumer that can be used for both variants of delegated discovery to avoid that the service consumer needs to be aware of the SCP behaviour.\nThe NRF provides a list of NF instances and NF service instances relevant for the discovery criteria. The NRF may provide the IP address or the FQDN of NF instance(s) and/or the Endpoint Address(es) of relevant NF service instance(s) to the NF Consumer or SCP. The NRF may also provide NF Set ID and/or NF Service Set ID to the NF Consumer or SCP. The response contains a validity period during which the discovery result is considered valid and can be cached. The result of the NF and NF service discovery procedure is applicable to any subscriber that fulfils the same discovery criteria. The entity that does the discovery may cache the NF profile(s) received from the NF/NF service discovery procedure. During the validity period, the cached NF profile(s) may be used for NF selection for any subscriber matching the discovery criteria.\nNOTE 3:\tRefer to TS 29.510 [58] for details on using the validity period.\nIn the case of Direct Communication, the requester NF uses the discovery result to select NF instance and a NF service instance that is able to provide a requested NF Service (e.g. a service instance of the PCF that can provide Policy Authorization).\nIn the case of Indirect Communication without Delegated Discovery, the requester NF uses the discovery result to select a NF instance while the associated NF service instance selection may be done by the requester NF and/or an SCP on behalf of the requester NF.\nIn both the cases above, the requester NF may use the information from a valid cached discovery result for subsequent selections (i.e. the requester NF does not need to trigger a new NF discovery procedure to perform the selection).\nIn the case of Indirect Communication with Delegated Discovery, the SCP will discover and select a suitable NF instance and NF service instance based on discovery and selection parameters provided by the requester NF and optional interaction with the NRF. The NRF to be used may be provided by the NF consumer as part of the discovery parameters, e.g. as a result of a NSSF query. The SCP may use the information from a valid cached discovery result for subsequent selections (i.e. the SCP does not need to trigger a new NF discovery procedure to perform the selection).\nNOTE 4:\tIn a given PLMN, Direct Communication, Indirect Communication, or both may apply.\nThe requester NF or SCP may subscribe to receive notifications from the NRF of a newly updated NF profile of an NF (e.g. NF service instances taken in or out of service), or newly registered de-registered NF instances. The NF/NF service status subscribe/notify procedure is defined in clauses 4.17.7 and 4.17.8 of TS 23.502 [3].\nFor NF and NF service discovery across PLMNs, the NRF in the local PLMN interacts with the NRF in the remote PLMN to retrieve the NF profile(s) of the NF instance(s) in the remote PLMN that matches the discovery criteria. The NRF in the local PLMN reaches the NRF in the remote PLMN by forming a target PLMN specific query using the PLMN ID provided by the requester NF. The NF/NF service discovery procedure across PLMNs is specified in clause 4.17.5 of TS 23.502 [3].\nNOTE 5:\tSee TS 29.510 [58] for details on using the target PLMN ID specific query to reach the NRF in the remote PLMN.\nFor topology hiding, see clause 6.2.17.\nBinding can be used to indicate suitable target NF producer instance(s) for NF service instance selection, reselection and routing of subsequent requests associated with a specific NF producer resource (context) and NF service. This allows the NF producer to indicate that the NF consumer, for a particular context, should be bound to an NF service instance, NF instance, NF service set or NF set depending on local policies and other criteria (e.g. at what point it is in the middle of a certain procedure, considering performance aspects etc).\nBinding can also be used by the NF consumer to indicate suitable NF consumer instance(s) for notification target instance reselection and routing of subsequent notification requests associated with a specific notification subscription and for providing Binding Indication for service(s) that the NF consumer produces for the same data context and the NF service producer is subsequently likely to invoke.\nThe Binding Indication contains the information in Table 6.3.1.0-1.\nThe Routing Binding Indication may be included in Request, Subscribe or Notification messages (see clause 7.1.2). It may be used in the case of indirect communication by the SCP to route the message. The Routing Binding Indication is a copy of the information in the Binding Indication and also contains the information in Table 6.3.1.0-1.\nNOTE 1:\tSubscription request messages can contain both a Binding Indication and a Routing Binding Indication.\nThe NF service producer may provide a Binding Indication to the NF service consumer as part of the Direct or Indirect Communication procedures, to be used in subsequent related service requests. The level of Binding Indication provided by the NF service producer to the NF consumer indicates if the resource in the NF service producer is either bound to NF service instance, NF instance, NF Service Set or NF set as specified in Table 6.3.1.0-1. The Binding Indication may include NF Service Set ID, NF Set ID, NF instance ID, or NF service instance ID, for use by the NF consumer or SCP for NF Service Producer (re-)selection. If the resource is created in the NF Service Producer, the NF Service Producer provides resource information which includes the endpoint address of the NF service producer. For indirect communication, the NF service consumer copies the Binding Indication into the Routing Binding Indication in Request or Subscribe message, unless the NF service consumer performs a reselection for indirect communication without delegated discovery.\nDuring explicit or implicit notification subscription, a Binding Indication may be provided by the NF service consumer to NF service producer; the NF service consumer will also provide a Notification Endpoint. The NF service consumer may also provide a Binding Indication in response to notification requests. The level of Binding Indication provided by the NF service consumer to the NF service provider indicates if the Notification Endpoint is either bound to NF service instance, NF instance, NF Service Set or NF set as specified in Table 6.3.1.0-1. The Binding Indication shall include at least one of NF Set ID, NF instance ID, NF Service Set ID and/or NF service instance ID, and may also include the service name. The NF Service Set ID, NF service instance ID, and service name relate to the service of the NF service consumer that will handle the notification.\nNOTE 2:\tThe NF service can either be a standardised service as per this specification or a custom service. The custom service can be used for the sole purpose of registering endpoint address(es) to receive notifications at the NRF.\nThe Binding Indication is used by the NF service producer as notification sender to reselect an endpoint address and construct the Notification Endpoint, i.e. the URI where the notification is to be sent, e.g. if the provided Notification Endpoint of the NF service consumer included in the subscription cannot be reached, according to the following:\n-\tIf the service name in the Binding Indication is omitted and the binding for notification is on NF Set or NF Instance level, the endpoint address registered in the NRF at NF Profile level of the NF(s) selected according to the Binding Indication shall be used to construct a new Notification Endpoint.\n-\tIf the service name is included in the Binding Indication, an endpoint address registered in the NRF for that service in the NF profile(s) selected according to the Binding Indication shall be used to construct a new Notification Endpoint.\nFor indirect communication, the NF service producer copies the Binding Indication into the Routing Binding Indication that is included in the Notification request, to be used by the SCP to discover an alternative endpoint address and construct a Notification Endpoint e.g. if the Notification Endpoint that the request targets cannot be reached, according to the following:\n-\tIf the service name in the Routing Binding Indication is omitted and the binding for notification is on NF Set or NF Instance level, the endpoint address registered in the NRF at NF Profile level of the NF(s) selected according to the Binding Indication shall be used to construct a new Notification Endpoint.\n-\tIf the service name is included in the Routing Binding Indication, an endpoint address registered in the NRF for that service in the NF profile(s) selected according to the Binding Indication shall be used to construct a new Notification Endpoint.\nFor subscription to notifications via another network function, a separate Binding Indication for subscription related events may be provided by the NF service consumer (see clause 4.17.12.4 of TS 23.502 [3]) and if provided shall be associated with an applicability indicating notification for subscription related events.\nIf the NF as an NF consumer provides a Binding Indication for services that the NF produces in service requests, the Binding Indication shall be associated with an applicability indicating other service and may contain the related service name(s), in addition to the other parameters listed in Table 6.3.1.0-1. If no service name(s) are provided, the Binding Indication relates to all services that the NF produces.\nFor NF Set or NF Instance level of binding, a Binding Indication for notifications and other services may be combined if it relates to the same service, and that combined Binding Indication shall then be associated with an applicability indicating all scenarios that the Binding Indication relates to (For this purpose, the applicability can indicate a combination of values).\nIf no applicability is indicated in a request or subscribe messages, a Binding Indication in that messages is applicable for notification to all events except for the subscription related event (see clause 4.17.12.4 of TS 23.502 [3]).\nNOTE 3:\tSuch a request message can be used for implicit subscription.\nNOTE 4:\tRequest messages can contain both the Binding Indications for services and for notifications, and in addition, the Routing Binding Indication in the case of indirect communication.\nA Binding Indication may be shared by a group of resources (e.g. contexts) identified by a group identifier. This enables a NF Service consumer or producer to update the binding indication for this group of resources in a single request or notification towards a given peer NF service instance, e.g. when a group of resources need to be taken over by a different NF within an NF set. See clause 6.12.1 of TS 29.500 [49].\nTable 6.3.1.0-1 defines the selection and reselection behaviour of NF services consumers and SCPs depending on the Binding Indication provided by an NF service producer. The detailed procedures refer to clause 4.17.11 and 4.17.12 of TS 23.502 [3].\nTable 6.3.1.0-1: Binding, selection and reselection\n\nFor indirect communication shown in Annex E, the SCP performs the following functionalities regarding Network Function and Network Function Service discovery and selection:\n-\tIf the request includes a Routing Binding Indication, the SCP shall route the service request to the requested target as specified in Table 6.3.1.0-1. If the Routing Binding Indication does not exist, the SCP may get the NF Set ID from the NRF or local configuration (if available).\n-\tIf the request recipient had previously provided a Binding Indication, then the request sender shall include a Routing Binding Indication with the same contents in subsequent related requests.\nThe location information describes the network location of the NF instance. It can consist of one or more levels. Each level describes one location aspect, such as geographic location, data centre, cluster, etc. An NF instance has only one location.\nThe location information may be used to select the NF service instance or NF instance from a particular network location based on local configuration.\nNOTE:\tThe location information in TS 29.510 [58] specifies the granularity of location information. It is up to each deployment to determine the granularity of location information to be used.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 6.3.1.0-1: Binding, selection and reselection",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.3.2\tSMF discovery and selection",
                            "text_content": "The SMF selection functionality is supported by the AMF and SCP and is used to allocate an SMF that shall manage the PDU Session. The SMF selection procedures are described in clause 4.3.2.2.3 of TS 23.502 [3].\nThe SMF discovery and selection functionality follows the principles stated in clause 6.3.1.\nIf the AMF does discovery, the AMF shall utilize the NRF to discover SMF instance(s) unless SMF information is available by other means, e.g. locally configured on AMF. The AMF provides UE location information to the NRF when trying to discover SMF instance(s). The NRF provides NF profile(s) of SMF instance(s) to the AMF. In addition, the NRF also provides the SMF service area of SMF instance(s) to the AMF. The SMF selection functionality in the AMF selects an SMF instance and an SMF service instance based on the available SMF instances obtained from NRF or on the configured SMF information in the AMF.\nNOTE 1:\tProtocol aspects of the access to NRF are specified in TS 29.510 [58].\nThe SMF selection functionality is applicable to both 3GPP access and non-3GPP access.\nThe SMF selection for Emergency services is described in clause 5.16.4.5.\nThe following factors may be considered during the SMF selection:\na)\tSelected Data Network Name (DNN). In the case of the home routed roaming, the DNN is not applied for the V-SMF selection.\nb)\tS-NSSAI of the HPLMN (for non-roaming and home-routed roaming scenarios), and S-NSSAI of the VPLMN (for roaming with local breakout and home-routed roaming scenarios).\nc)\tNSI-ID.\nNOTE 2:\tThe use of NSI -ID in the network is optional and depends on the deployment choices of the operator. If used, the NSI ID is associated with S-NSSAI.\nd)\tAccess technology being used by the UE.\ne)\tSupport for Control Plane CIoT 5GS Optimisation.\nf)\tSubscription information from UDM, e.g.\n-\tper DNN: whether LBO roaming is allowed.\n-\tper DNN: whether HR-SBO roaming is allowed.\n-\tper S-NSSAI: the subscribed DNN(s).\n-\tper (S-NSSAI, subscribed DNN): whether LBO roaming is allowed.\n-\tper (S-NSSAI, subscribed DNN): whether HR-SBO roaming is allowed.\n-\tper (S-NSSAI, subscribed DNN): whether EPC interworking is supported.\n-\tper (S-NSSAI, subscribed DNN): whether selecting the same SMF for all PDU sessions to the same S-NSSAI and DNN is required.\n-\tper (S-NSSAI, DNN) associated with 5G VN group: Service Area (LADN service area) for the 5G VN group. In the case of SMF selection for a PDU Session targeting 5G VN group, the AMF may prefer candidate SMF(s) that have an intersection with the LADN service area of the 5G VN group.\ng)\tVoid.\nh)\tLocal operator policies.\nNOTE 3:\tThese policies can take into account whether the SMF to be selected is an I-SMF or a V-SMF or a SMF.\ni)\tLoad conditions of the candidate SMFs.\nj)\tAnalytics (i.e. statistics or predictions) for candidate SMFs' load as received from NWDAF (see TS 23.288 [86]), if NWDAF is deployed.\nk)\tUE location (i.e. TA).\nl)\tService Area of the candidate SMFs.\nm)\tCapability of the SMF to support a MA PDU Session.\nn)\tIf interworking with EPS is required.\no)\tPreference of V-SMF support. This is applicable only for V-SMF selection in the case of home routed roaming.\np)\tTarget DNAI.\nq)\tCapability of the SMF to support User Plane Remote Provisioning (see clause 5.30.2.10.4.3).\nr)\tSupported DNAI list.\ns)\tHR-SBO support (according to clause 6.7 of TS 23.548 [130]).\nt)\tCapability of the SMF (V-SMF and H-SMF) to support non-3GPP access path switching.\nTo support the allocation of a static IPv4 address and/or a static IPv6 prefix as specified in clause 5.8.2.2.1, a dedicated SMF may be deployed for the indicated combination of DNN and S-NSSAI and registered to the NRF, or provided by the UDM as part of the subscription data.\nIn the case of delegated discovery, the AMF, shall send all the available factors a)-d), k) and n) to the SCP.\nIn addition, the AMF may indicate to the SCP which NRF to use (in the case of NRF dedicated to the target slice).\nIf there is an existing PDU Session and the UE requests to establish another PDU Session to the same DNN and S-NSSAI of the HPLMN, and the UE subscription data indicates the support for interworking with EPS for this DNN and S-NSSAI of the HPLMN or UE subscription data indicates the same SMF shall be selected for all PDU sessions to the same S-NSSAI, DNN, the same SMF in non roaming and LBO case or the same H-SMF in home routed roaming case, shall be selected. In addition, if the UE Context in the AMF provides a SMF ID for an existing PDU session to the same DNN, S-NSSAI, the AMF uses the stored SMF ID for the additional PDU Session. In any such a case where the AMF can determine which SMF should be selected, if delegated discovery is used, the AMF shall indicate a desired NF Instance ID so that the SCP is able to route the message to the relevant SMF. Otherwise, if UE subscription data does not indicate the support for interworking with EPS for this DNN and S-NSSAI, a different SMF in non roaming and LBO case or a different H-SMF in home routed roaming case, may be selected. For example, to support a SMF load balancing or to support a graceful SMF shutdown (e.g. a SMF starts to no more take new PDU Sessions).\nIn the home-routed roaming case, the SMF selection functionality selects an SMF in VPLMN based on the S-NSSAI of the VPLMN, as well as an SMF in HPLMN based on the S-NSSAI of the HPLMN. This is specified in clause 4.3.2.2.3.3 of TS 23.502 [3].\nIf the HR-SBO roaming is allowed for the PDU Session, the DNN is also considered for V-SMF selection.\nWhen the UE requests to establish a PDU Session to a DNN and an S-NSSAI of the HPLMN, if the UE MM Core Network Capability indicates the UE supports EPC NAS and optionally, if the UE subscription indicates the support for interworking with EPS for this DNN and S-NSSAI of the HPLMN, the selection functionality (in AMF or SCP) selects a combined SMF+PGW-C. Otherwise, a standalone SMF may be selected.\nIf the UDM provides a subscription context that allows for handling the PDU Session in the VPLMN (i.e. using LBO) for this DNN and S-NSSAI of the HPLMN and, optionally, the AMF is configured to know that the VPLMN has a suitable roaming agreement with the HPLMN of the UE, the following applies:\n-\tIf the AMF does discovery, the SMF selection functionality in AMF selects an SMF from the VPLMN.\n-\tIf delegated discovery is used, the SCP selects an SMF from the VPLMN.\nIf an SMF in the VPLMN cannot be derived for the DNN and S-NSSAI of the VPLMN, or if the subscription does not allow for handling the PDU Session in the VPLMN using LBO, then the following applies:\n-\tIf the AMF does discovery, both an SMF in VPLMN and an SMF in HPLMN are selected, and the DNN and S-NSSAI of the HPLMN is used to derive an SMF identifier from the HPLMN.\n-\tIf delegated discovery is used:\n-\tThe AMF performs discovery and selection of H-SMF from NRF. The AMF may indicate the maximum number of H-SMF instances to be returned from NRF, i.e. SMF selection at NRF.\n-\tThe AMF sends Nsmf_PDUSession_CreateSMContext Request to SCP, which includes the endpoint (e.g. URI) of the selected H-SMF, and the discovery and selection parameters as defined in this clause, i.e. parameter for V-SMF selection. The SCP performs discovery and selection of the V-SMF and forwards the request to the selected V-SMF.\n-\tThe V-SMF sends the Nsmf_PDUSession_Create Request towards the H-SMF via the SCP; the V-SMF uses the received endpoint (e.g. URI) of the selected H-SMF to construct the target destination to be addressed. The SCP forwards the request to the H-SMF.\n-\tUpon reception of a response from V-SMF, based on the received V-SMF ID the AMF obtains the Service Area of the V-SMF from NRF. The AMF uses the Service Area of the V-SMF to determine the need for V-SMF relocation upon subsequent UE mobility.\nIf the initially selected SMF in VPLMN (for roaming with LBO) detects it does not understand information in the UE request, it may reject the N11 message (related with a PDU Session Establishment Request message) with a proper N11 cause triggering the AMF to select both a new SMF in the VPLMN and a SMF in the HPLMN (for home routed roaming).\nThe AMF selects SMF(s) considering support for CIoT 5GS optimisations (e.g. Control Plane CIoT 5GS Optimisation).\nIn the case of onboarding of UEs for SNPNs, when the UE is registered for SNPN onboarding the AMF selects SMF(s) of Onboarding Network considering the Capability of SMF to support User Plane Remote Provisioning.\nAdditional details of AMF selection of an I-SMF are described in clause 5.34.\nIn the case of home routed scenario, the AMF selects a new V-SMF if it determines that the current V-SMF cannot serve the UE location. The selection/relocation is same as an I-SMF selection/relocation as described in clause 5.34.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tUser Plane Function Selection",
                            "text_content": "The selection and reselection of the UPF for PDU session establishment, UE mobility or UE traffic offloading are performed by the SMF by considering UPF deployment scenarios such as centrally located UPF and distributed UPF located close to or at the Access Network site. The selection of the UPF shall also enable deployment of UPF with different capabilities, e.g. UPFs supporting no or a subset of optional functionalities.\nThe UPF selection for PDU session establishment in home routed roaming case, the UPF(s) in home PLMN is selected by SMF(s) in HPLMN, and the UPF(s) in the VPLMN is selected by SMF(s) in VPLMN. The exact set of parameters used for the selection mechanism is deployment specific and controlled by the operator configuration.\nThe UPF selection for PDU session establishment, UE mobility or UE traffic offloading involves:\n-\ta step of SMF Provisioning of available UPF(s). This step may take place while there is no PDU Session to establish and may be followed by N4 Node Level procedures defined in clause 4.4.3 of TS 23.502 [3] where the UPF and the SMF may exchange information such as the support of optional functionalities and capabilities.\n-\tA step of selection of an UPF for a particular PDU Session; it is followed by N4 session management procedures defined in clause 4.4.1 of TS 23.502 [3].\nTo collect the data from the UPF as defined in clause 5.8.2.17, the related dedicated UPF is discovered and selected as following:\n-\tWhen the NF consumer or SCP directly subscribes to the UPF, the NF consumer or SCP queries the NRF including the related discovery parameter. The NRF returns the UPF(s) which meet(s) the discovery request.\n-\tWhen the NF consumer or SCP shall subscribe via the SMF, the NF consumer gets the serving SMF information from the UDM per SUPI, DNN and S-NSSAI. After that, the NF consumer sends a subscription to the indicated SMF and the SMF identifies the related UPF(s) using the parameters of the subscription (e.g. target flow description, AoI, etc.) and transfers the related event subscription information to the identified UPF(s). If the NF consumer does not know the SUPI but only the UE IP address, it may need to invoke the BSF to get the SUPI corresponding to the triplet (IP address, DNN and S-NSSAI).\nSMF may be locally configured with the information about the available UPFs, e.g. by OA&M system when UPF is instantiated or removed.\nNOTE 1:\tUPF information can be updated e.g. by OA&M system any time after the initial provisioning, or UPF itself updates its information to the SMF any time after the node level interaction is established.\nThe UPF selection functionality in the SMF may optionally utilize the NRF to discover UPF instance(s). In this case, the SMF issues a request to the NRF that may include following parameters: DNN, S-NSSAI, SMF Area Identity, the requested functionalities and capabilities (e.g. ATSSS steering capabilities, functionality associated with high data rate low latency service etc.). In its answer, the NRF provides the NF profile(s) that include(s) the IP address(es) or the FQDN of the N4 interface of corresponding UPF instance(s) to the SMF.\nUPFs may be associated with an SMF Area Identity in the NRF. This allows limiting the SMF provisioning of UPF(s) using NRF to those UPF(s) associated with a certain SMF Area Identity. This can e.g. be used in the case that an SMF is only allowed to control UPF(s) configured in NRF as belonging to a certain SMF Area Identity.\nThe NRF may be configured by OAM with information on the available UPF(s) or the UPF instance(s) may register its/their NF profile(s) in the NRF. This is further defined in clause 4.17 of TS 23.502 [3].\nIf there is an existing PDU Session, and the SMF receives another PDU Session request to the same DNN and S-NSSAI, and if the SMF determines that interworking with EPC is supported for this PDU Session as specified in clause 4.11.5 of TS 23.502 [3], the SMF should select the same UPF, otherwise, if the SMF determines that interworking with EPC is not supported for the new PDU Session, a different UPF may be selected.\nFor the same DNN and S-NSSAI if different UPF are selected at 5GC, when the UE is moved to EPC network, there is no requirement to enforce APN-AMBR. Whether and how to apply APN-AMBR for the PDN Connection associated with this DNN/APN is implementation dependent, e.g. possibly only AMBR enforcement per PDU Session applies.\nThe following parameter(s) and information may be considered by the SMF for UPF selection and re-selection:\n-\tUPF's dynamic load.\n-\tAnalytics (i.e. statistics or predictions) for UPF load, Service Experience analytics and/or DN Performance analytics per UP path (including UPF and/or DNAI and/or AS instance) and UE related analytics (UE mobility, UE communication, and expected UE behavioural parameters) as received from NWDAF (see TS 23.288 [86]), if NWDAF is deployed.\n-\tUPF's relative static capacity among UPFs supporting the same DNN.\n-\tUPF location available at the SMF.\n-\tUE location information.\n-\tCapability of the UPF and the functionality required for the particular UE session: An appropriate UPF can be selected by matching the functionality and features required for an UE.\n-\tData Network Name (DNN).\n-\tPDU Session Type (i.e. IPv4, IPv6, IPv4v6, Ethernet Type or Unstructured Type) and if applicable, the static IP address/prefix.\n-\tSSC mode selected for the PDU Session.\n-\tUE subscription profile in UDM.\n-\tDNAI as included in the PCC Rules and described in clause 5.6.7.\n-\tLocal operator policies.\n-\tS-NSSAI.\n-\tAccess technology being used by the UE.\n-\tInformation related to user plane topology and user plane terminations, that may be deduced from:\n-\t5G-AN-provided identities (e.g. CellID, TAI), available UPF(s) and DNAI(s);\n-\tIdentifiers (i.e. a FQDN and/or IP address(es)) of N3 terminations provided by a W-AGF or a TNGF or a TWIF;\n-\tInformation regarding the user plane interfaces of UPF(s). This information may be acquired by the SMF using N4;\n-\tInformation regarding the N3 User Plane termination(s) of the AN serving the UE. This may be deduced from 5G-AN-provided identities (e.g. CellID, TAI);\n-\tInformation regarding the N9 User Plane termination(s) of UPF(s) if needed;\n-\tInformation regarding the User plane termination(s) corresponding to DNAI(s).\n-\tRSN, support for redundant GTP-U path or support for redundant transport path in the transport layer (as in clause 5.33.2) when redundant UP handling is applicable.\n-\tInformation regarding the ATSSS Steering Capability of the UE session (e.g. any combination of ATSSS-LL capability, MPTCP capability, MPQUIC capability) and information on the UPF support of RTT measurements without PMF.\n-\tSupport for UPF allocation of IP address/prefix.\n-\tSupport of the IPUPS functionality, specified in clause 5.8.2.14.\n-\tSupport for High latency communication (see clause 5.31.8).\n-\tSupport for functionality associated with high data rate low latency services, eXtended Reality (XR) and interactive media services, specified in clause 5.37 (for example, ECN marking for L4S, specified in clause 5.37.3, PDU Set Marking, specified in clause 5.37.5, UE power saving management, specified in clause 5.37.8).\n-\tUser Plane Latency Requirements within AF request (see clause 5.6.7.1 and clause 6.3.6 of TS 23.548 [130]).\n-\tList of supported Event ID(s) for exposure of UPF-related information via service based interface (see clause 7.2.29 and clause 5.2.26.2 of TS 23.502 [3]).\nNOTE 1:\tHow the SMF determines information about the user plane network topology from information listed above, and what information is considered by the SMF, is based on operator configuration.\nNOTE 2:\tIn this release the SMF uses no additional parameters for UPF selection for a PDU Session serving TSC or Deterministic Networking. If a PDU Session needs to connect to a specific UPF hosting a specific TSN 5GS bridge or 5GS router, this can be achieved e.g. by using a dedicated DNN/S-NSSAI combination.\nA W-AGF or a TNGF may provide Identifiers of its N3 terminations when forwarding over N2 uplink NAS signalling to the 5GC. The AMF may relay this information to the SMF, as part of session management signalling for a new PDU Session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.4\tAUSF discovery and selection",
                            "text_content": "In the case of NF consumer based discovery and selection, the following applies:\n-\tThe AMF and the NSWOF perform AUSF selection to allocate an AUSF Instance that performs authentication between the UE and 5G CN in the HPLMN. The AMF and the NSWOF shall utilize the NRF to discover the AUSF instance(s) unless AUSF information is available by other means, e.g. locally configured on AMF and on NSWOF. The AUSF selection function in the AMF and in the NSWOF selects an AUSF instance based on the available AUSF instances (obtained from the NRF or locally configured in the AMF).\n-\tThe UDM shall utilize the NRF to discover the AUSF instance(s) unless AUSF information is available by other means, e.g. locally configured on UDM. The UDM selects an AUSF instance based on the available AUSF instance(s) obtained from the NRF or based on locally configured information, and information stored (by the UDM) from a previously successful authentication.\nAUSF selection is applicable to both 3GPP access and non-3GPP access.\nThe AUSF selection function in AUSF NF consumers or in SCP should consider one of the following factors when available:\n1.\tHome Network Identifier (e.g. MNC and MCC, realm) of SUCI/SUPI (by an NF consumer in the Serving network) along with the selected NID (provided by the NG-RAN) in the case of SNPN, Routing Indicator and optionally Home Network Public Key identifier (e.g. in the case that Routing Indicator is not enough to provide SUPI range granularity).\nNOTE 1:\tThe UE provides the SUCI, which contains the Routing Indicator and Home Network Public Key identifier as defined in TS 23.003 [19], to the AMF during initial registration and to the NSWOF during NSWO authentication. The AMF can provide the UE's Routing Indicator and optionally Home Network Public Key identifier to other AMFs as described in TS 23.502 [3].\nNOTE 2:\tThe usage of Home Network Public Key identifier for AUSF discovery is limited to the scenario where the AUSF NF consumers belong to the same PLMN as AUSF.\nNOTE 3:\tIn the case of SNPN and if the UE provides an IMSI type SUCI to the AMF and the SUCI provided by UE or the SUPI derived from the SUCI is for an SNPN served by the AMF, the AMF uses the selected NID provided by the NG-RAN together with the selected PLMN ID (from IMSI) or the Routing Indicator provided by the UE within the SUCI for selection of AUSF. In the case of SNPN and the UE provides an NSI type SUCI to the AMF, the AMF uses the Home Network Identifier and Routing Indicator of SUCI/SUPI for selection of AUSF.\nWhen the UE's Routing Indicator is set to its default value as defined in TS 23.003 [19], the AUSF NF consumer can select any AUSF instance within the home network for the UE.\n2.\tAUSF Group ID the UE's SUPI belongs to.\nNOTE 4:\tThe AMF can infer the AUSF Group ID the UE's SUPI belongs to, based on the results of AUSF discovery procedures with NRF. The AMF provides the AUSF Group ID the SUPI belongs to other AMFs as described in TS 23.502 [3].\n3.\tSUPI; e.g. the AMF selects an AUSF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI as input for AUSF discovery.\nNOTE 5:\tIn the case of Onboarding via ON-SNPN, AUSF instances supporting UE onboarding can be registered in NRF or locally configured in the AMF. The AMF in ON-SNPN can discover and select AUSF instance(s) supporting UE onboarding based on the MCC and MNC or realm part in Home Network Identifier of the SUCI/SUPI provided by the onboarding UE.\nIn the case of delegated discovery and selection in SCP, the AUSF NF consumer shall send all available factors to the SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5\tAMF discovery and selection",
                            "text_content": "The AMF discovery and selection functionality is applicable to both 3GPP access and non-3GPP access.\nThe AMF selection functionality can be supported by the 5G-AN (e.g. RAN, N3IWF) and is used to select an AMF instance for a given UE. An AMF supports the AMF selection functionality to select an AMF for relocation or because the initially selected AMF was not an appropriate AMF to serve the UE (e.g. due to change of Allowed NSSAI). Other CP NF(s), e.g. SMF, supports the AMF selection functionality to select an AMF from the AMF set when the original AMF serving a UE is unavailable.\nThe TSCTSF shall use the AMF discovery functionality to determine the AMFs serving the TAs in the spatial validity condition provided by the AF.\n5G-AN selects an AMF Set and an AMF from the AMF Set under the following circumstances:\n1)\tWhen the UE provides no 5G-S-TMSI nor the GUAMI to the 5G-AN.\n2)\tWhen the UE provides 5G-S-TMSI or GUAMI but the routing information (i.e. AMF identified based on AMF Set ID, AMF pointer) present in the 5G-S-TMSI or GUAMI is not sufficient and/or not usable (e.g. UE provides GUAMI with an AMF region ID from a different region).\n3)\tAMF has instructed AN that the AMF (identified by GUAMI(s)) is unavailable and no target AMF is identified and/or AN has detected that the AMF has failed.\n4)\tWhen the UE attempts to establish a signalling connection, and the following conditions are met:\n-\tthe 5G-AN knows in what country the UE is located; and\n-\tthe 5G-AN is connected to AMFs serving different PLMNs of different countries; and\n-\tthe UE provides a 5G-S-TMSI or GUAMI, which indicates an AMF serving a different country to where the UE is currently located; and\n-\tthe 5G-AN is configured to enforce selection of the AMF based on the country the UE is currently located.\nThen the 5G-AN shall select an AMF serving a PLMN corresponding to the UE's current location. How 5G-AN selects the AMF in this case is defined in TS 38.410 [125].\nNOTE:\tAMF selection case 4) does not apply if 5G-AN nodes serves one country only.\nIn the case of NF Service Consumer based discovery and selection, the CP NF selects an AMF from the AMF Set under the following circumstances:\n-\tWhen the AMF has instructed CP NF that a certain AMF identified by GUAMI(s) is unavailable and the CP NF was not notified of target AMF; and/or\n-\tCP NF has detected that the AMF has failed; and/or\n-\tWhen the selected AMF does not support the UE's Preferred Network Behaviour; and/or\n-\tWhen the selected AMF does not support the High Latency communication for NR RedCap UE.\nIn the case of delegated discovery and associated selection, the SCP selects an AMF from the corresponding AMF Set under the following circumstances:\n-\tThe SCP gets an indication \"select new AMF within SET\" from the CP NF; and/or\n-\tSCP has detected that the AMF has failed.\nThe AMF selection functionality in the 5G-AN may consider the following factors for selecting the AMF Set:\n-\tAMF Region ID and AMF Set ID derived from GUAMI;\n-\tRequested NSSAI;\n-\tLocal operator policies;\n-\t5G CIoT features indicated in RRC signalling by the UE;\n-\tIAB-indication;\n-\tNB-IoT RAT Type;\n-\tCategory M Indication;\n-\tNR RedCap Indication;\n-\tSNPN Onboarding indication as indicated in 5G-AN signalling by the UE.\nAMF selection functionality in the 5G-AN or CP NFs or SCP considers the following factors for selecting an AMF from AMF Set:\n-\tAvailability of candidate AMF(s).\n-\tLoad balancing across candidate AMF(s) (e.g. considering weight factors of candidate AMFs in the AMF Set).\n-\tIn 5G-AN, 5G CIoT features indicated in RRC signalling by the UE.\n-\tIn 5G-AN, SNPN Onboarding indication as indicated in 5G-AN signalling by the UE.\nWhen the UE accesses the 5G-AN with a 5G-S-TMSI or GUAMI that identifies more than one AMF (as configured during N2 setup procedure), the 5G-AN selects the AMF considering the weight factors.\nWhen 5G-S-TMSI or GUAMI provided by the UE to the 5G-AN contains an AMF Set ID that is usable, and the AMF identified by AMF pointer that is not usable (e.g. AN detects that the AMF has failed) or the corresponding AMF indicates it is unavailable (e.g. out of operation) then the 5G-AN uses the AMF Set ID for selecting another AMF from the AMF set considering the factors above.\nThe discovery and selection of AMF in the CP NFs or SCP follows the principle in clause 6.3.1\nIn the case of NF Service Consumer based discovery and selection, the AMF or other CP NFs shall utilize the NRF to discover the AMF instance(s) unless AMF information is available by other means, e.g. locally configured on AMF or other CP NFs. The NRF provides the NF profile(s) of AMF instance(s) to the AMF or other CP NFs. The AMF selection function in the AMF or other CP NFs selects an AMF instance as described below:\nWhen NF Service Consumer performs discovery and selection the following applies:\n-\tIn the case of AMF discovery and selection functionality in AMF or other CP NFs use GUAMI (in the SNPN case, along with NID of the SNPN that owns the AMF instances to be discovered and selected) or TAI to discover the AMF instance(s), the NRF provides the NF profile of the associated AMF instance(s). If an associated AMF is unavailable due to AMF planned removal, the NF profile of the backup AMF used for planned removal is provided by the NRF. If an associated AMF is unavailable due to AMF failure, the NF profile of the backup AMF used for failure is provided by the NRF. If AMF pointer value in the GUAMI is associated with more than one AMF, the NRF provides all the AMFs associated with this AMF pointer value. If no AMF instances related to the indicated GUAMI can be found, the NRF may provide a list of NF profiles of candidate AMF instances in the same AMF Set. The other CP NF or AMF may select any AMF instance from the list of candidate AMF instances. If no NF profiles of AMF is returned in the discovery result, the other CP NF or AMF may discover an AMF using the AMF Set as below.\n-\tIn the case of AMF discovery and selection functionality in AMF use AMF Set to discover AMF instance(s), the NRF provides a list of NF profiles of AMF instances in the same AMF Set.\n-\tAt intra-PLMN mobility, the AMF discovery and selection functionality in AMF may use AMF Set ID, AMF Region ID, the target location information, S-NSSAI(s) of Allowed NSSAI to discover target AMF instance(s). The NRF provides the target NF profiles matching the discovery.\n-\tAt intra-SNPN mobility, the AMF discovery and selection functionality in AMF may use AMF Set ID, AMF Region ID (along with NID of the SNPN that owns the AMF instances to be discovered and selected), the target location information, S-NSSAI(s) of Allowed NSSAI, AMF support of SNPN Onboarding (if the UE is registered for SNPN Onboarding) to discover target AMF instance(s). The NRF provides the target NF profiles matching the discovery.\n-\tAt inter PLMN mobility, the source AMF selects an AMF instance(s) in the target PLMN by querying target PLMN level NRF via the source PLMN level NRF with target PLMN ID. The target PLMN level NRF returns an AMF instance address based on the target operator configuration. After the Handover procedure the AMF may select a different AMF instance as specified in clause 4.2.2.2.3 of TS 23.502 [3].\nIn the context of Network Slicing, the AMF selection is described in clause 5.15.5.2.1.\nWhen delegated discovery and associated selection is used, the following applies:\n-\tIf the CP NF includes GUAMI or TAI in the request, the SCP selects an AMF instance associated with the GUAMI or TAI and sends the request to a selected AMF service instance if it is available. The following also applies:\n-\tIf none of the associated AMF service instances are available due to AMF planned removal, an AMF service instance from the backup AMF used for planned removal is selected by the SCP;\n-\tIf none of the associated AMF service instances are available due to AMF failure, an AMF service instance from the backup AMF used for failure is selected by the SCP;\n-\tIf no AMF service instances related to the indicated GUAMI (in the SNPN case, along with NID of the SNPN that owns the AMF instances to be discovered and selected) can be found the SCP selects an AMF instance from the AMF Set; or\n-\tAMF Pointer value used by more than one AMF, SCP selects one of the AMF instances associated with the AMF Pointer.\n-\tIf the CP NF includes AMF Set ID in the request, the SCP selects AMF/AMF service instances in the provided AMF Set.\n-\tAt intra-PLMN mobility, if a target AMF instance needs to be selected, the AMF may provide AMF Set ID, AMF Region ID, and the target location information, S-NSSAI(s) of Allowed NSSAI in the request, optionally NRF to use. The SCP will select a target AMF instance matching the discovery.\n-\tAt intra-SNPN mobility, if a target AMF instance needs to be selected, the AMF may provide AMF Set ID, AMF Region ID along with NID of the SNPN that owns the AMF instances to be discovered and selected, and the target location information, S-NSSAI(s) of Allowed NSSAI, AMF support of SNPN Onboarding in the request (if the UE is registered for SNPN Onboarding), optionally NRF to use. The SCP will select a target AMF instance matching the discovery.\n-\tAt inter PLMN mobility, the source AMF selects indicates \"roaming\" to the SCP. The SCP interacts with the NRF in source PLMN so that the NRF in source PLMN can discover an AMF in the target PLMN via target PLMN NRF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.6\tN3IWF selection",
                            "text_content": "When the UE supports connectivity with N3IWF but does not support connectivity with ePDG, as specified in TS 23.402 [43], the UE shall perform the procedure in clause 6.3.6.2 for selecting an N3IWF.\nWhen the UE supports connectivity with N3IWF, as well as with ePDG, as specified in TS 23.402 [43], the UE shall perform the procedure in clause 6.3.6.3 for selecting either an N3IWF or an ePDG, i.e. for selecting a non-3GPP access node.\nIn both cases above the UE can be configured by the HPLMN with the same information that includes:\n1)\tePDG identifier configuration: It contains the FQDN or IP address of the ePDG in the HPLMN, as specified in clause 4.5.4.3 of TS 23.402 [43]. This is used only when the UE supports connectivity with ePDG and attempts to select an ePDG. It is ignored in all other cases.\n2)\tN3IWF identifier configuration: It contains the FQDN or IP address of the N3IWF in the HPLMN.\n3)\tExtended Home N3IWF identifier configuration: It contains one or multiple tuples of FQDN/IP address of the N3IWF in the HPLMN and the S-NSSAIs supported by this N3IWF.\n4)\tNon-3GPP access node selection information: It contains a prioritized list of PLMNs and for each PLMN it includes (i) a \"Preference\" parameter which indicates if ePDG or N3IWF is preferred in this PLMN and (ii) an FQDN parameter which indicates if the Tracking/Location Area Identity FQDN or the Operator Identifier FQDN (as specified in clause 4.5.4.4 of TS 23.402 [43]) should be used when discovering the address of an ePDG or N3IWF in this PLMN. The list of PLMNs shall include the HPLMN and shall include an \"any PLMN\" entry, which matches any PLMN the UE is connected to except the HPLMN.\n5)\tSlice-specific N3IWF prefix configuration: It contains one or multiple tuples consisting of:\n-\tList of supported S-NSSAIs;\n-\tPrefix for the Prefixed N3IWF OI or TA FQDNs.\nNOTE 1:\tExtended Home N3IWF identifier configuration and Slice-specific N3IWF prefix configuration are assumed to be provided to the UE as part of ANDSP.\nThe ePDG identifier configuration, the N3IWF identifier configuration, the Extended Home N3IWF identifier configuration and the Slice-specific N3IWF Prefix Configuration are optional parameters, while the Non-3GPP access node selection information is required and shall include at least the HPLMN and the \"any PLMN\" entry.\nIf the ePDG identifier configuration is configured in the UE, then, when the UE decides to select an ePDG in the HPLMN (according to the procedure in clause 6.3.6.3), the UE shall use the ePDG identifier configuration to find the IP address of the ePDG in the HPLMN and shall ignore the FQDN parameter of the HPLMN in the Non-3GPP access node selection information.\nIf the N3IWF identifier configuration or the Extended Home N3IWF identifier configuration is configured in the UE, then, when the UE decides to select an N3IWF in the HPLMN (according to the procedure in clause 6.3.6.3 for combined N3IWF/ePDG selection and the procedure in clause 6.3.6.2 for Stand-alone N3IWF selection), the UE shall use the Extended Home N3IWF identifier configuration, if available, and otherwise the N3IWF identifier configuration to find the IP address of the N3IWF in the HPLMN and shall ignore the FQDN parameter of the HPLMN in the Non-3GPP access node selection information.\nThe HPLMN's PCF takes the UE's subscribed S-NSSAIs into account when providing Extended Home N3IWF identifier configuration and/or Slice-specific N3IWF Prefix Configuration to the UE.\nIf a UE does not support the Extended Home N3IWF identifier configuration and the Slice-specific N3IWF Prefix Configuration, then the HPLMN provides to the UE the Non-3GPP access node selection information and the N3IWF identifier configuration by taking into account the UE's subscribed S-NSSAIs.\nNOTE 2:\tIf the HPLMN deploys multiple N3IWFs with different TAs which support different S-NSSAIs, then the HPLMN can configure a UE with N3IWF identifier configuration so that the UE selects an N3IWF that supports the UE's subscribed S-NSSAIs.\nThe UE can be configured by the VPLMN with the following information applicable for the V-PLMN:\nSlice-specific N3IWF prefix configuration: It contains one or multiple tuples consisting of:\n-\tList of supported S-NSSAIs;\n-\tPrefix for the Prefixed N3IWF OI or TA FQDNs.\nTo enable the V-PCF to provide the UE with Slice-specific N3IWF prefix configuration, the AMF provides the V-PCF with the Configured NSSAI for the serving PLMN during the UE Policy Association Establishment/Modification procedure.\nNOTE 3:\tIn non-roaming cases, the UE PCF already receives the subscribed NSSAI from the UDR. Therefore, there is no need for the AMF to provide the Configured NSSAI to the PCF in the non-roaming case.\nNOTE 4:\tPCF (V-PCF in the roaming case) is assumed to be locally configured with information about the slices supported by the different N3IWFs in the serving PLMN.\nDuring the registration procedure the AMF may determine if the N3IWF selected by the UE is suitable for the S-NSSAI(s) requested by the UE considering the UE subscription. If the AMF determines that a different N3IWF should be selected as described in clause 4.12.2.2 of TS 23.502 [3], the AMF:\n-\tmay, if the UE supports slice-based N3IWF selection, triggers the UE Policy Association Establishment or UE Policy Association Update procedure to provide the UE with updated N3IWF selection information as described in clause 6.15.2.1; when the AMF is informed by the PCF that the update of UE policy information on the UE is completed as described in clause 4.12.2.2.2 of TS 23.502 [3], the AMF releases UE Policy Association if the UE is not registered over 3GPP access before proceeding to the Registration Reject over untrusted non-3GPP access;\n-\tshall send a Registration Reject message to the UE. The AMF may include target N3IWF information (FQDN and/or IP address) in the Registration Reject so that the UE can, if supported by the UE, use the target N3IWF information to select the N3IWF to register to 5GC if the UE wishes to send the same Requested NSSAI as during the previous Registration Request. The target N3IWF information only applies to the one N3IWF selection performed by the UE just after receiving the Registration Reject.\nThe AMF may determine the N3IWF based on the list of supported TAs and the corresponding list of supported slices for each TA obtained as defined in clause 5.15.8.\nNOTE 5:\tThe operator is assumed to ensure that UEs that do not support slice-based N3IWF selection always select an N3IWF that supports at least one slice requested by the UE. This is to avoid unnecessary and potentially repetitive rejections of those UEs. To ensure this, the operator is assumed to provide identifiers of N3IWFs that only support a subset of the slices configured in the network only to UEs that support slice-based N3IWF selection.\nThe UE performs N3IWF selection based on the ePDG selection procedure as specified in clause 4.5.4 of TS 23.402 [43] except for the following differences:\n-\tThe Tracking/Location Area Identifier FQDN shall be constructed by the UE based only on the Tracking Area wherein the UE is located. The N3IWF Tracking/Location Area Identifier FQDN may use the 5GS TAI when the UE is registered to the 5GS, or the EPS TAI when the UE is registered to EPS. The Location Area is not applicable on the 3GPP access.\n-\tThe ePDG Operator Identifier (OI) FQDN format is substituted by with N3IWF OI FQDN format as specified in TS 23.003 [19].\n-\tIf the UE is configured with Slice-specific N3IWF prefix configuration, then the UE shall construct the Prefixed N3IWF OI FQDN or the Prefixed N3IWF TA FQDN as specified in TS 23.003 [19] instead of the N3IWF OI FQDN and the N3IWF TA FQDN, respectively. To determine the prefix, the UE selects the Slice-specific N3IWF prefix configuration for the selected PLMN that contains S-NSSAIs that match all (or most, in case there is no full match) of the S-NSSAIs that the UE is going to include in the Requested NSSAI in the subsequent Registration procedure.\nEditor's note:\tThe Prefixed N3IWF OI FQDN is assumed to take the form:\n<Prefix>.tac-lb<TAC-low-byte>.tac-hb<TAC-high-byte>.tac.n3iwf.5gc.mnc<MNC>.mcc<MCC>.pub.3gppnetwork.org.\nThe Prefixed N3IWF TA FQDN is assumed to take the form <Prefix>.n3iwf.5gc.mnc<MNC>.mcc<MCC>.pub.3gppnetwork.org.\nOnce these FQDNs have been added to TS 23.003, this Editor's note will be removed.\n-\tThe ePDG identifier configuration is substituted by the N3IWF identifier configuration and the Extended Home N3IWF identifier configuration. The Extended Home N3IWF identifier configuration takes precedence over the N3IWF identifier configuration. If the UE is located in the home country and the UE is configured with Extended Home N3IWF identifier configuration, then the UE uses the Extended Home N3IWF identifier configuration to select an N3IWF:\n-\tThe UE uses the FQDN or IP address from the Extended Home N3IWF identifier configuration that matches all (or most, if there is no full match) of the S-NSSAIs that the UE is going to request in the subsequent Registration.\n-\tThe ePDG selection information is substituted by the Non-3GPP access node selection information and slice-specific N3IWF prefix information. The UE shall give preference to the N3IWF in all PLMNs in the Non-3GPP access node selection information independent of the \"Preference\" parameter.\n-\tIf the UE determines to be located in a country other than its home country (called the visited country), then instead of clause 4.5.4.4, bullet 3 of TS 23.402 [43], the following applies:\na)\tIf the UE is registered via 3GPP access to a PLMN and this PLMN is included in the Non-3GPP access node selection information, then the UE shall select an N3IWF in this PLMN. If the UE fails to connect to an N3IWF in this PLMN, the UE shall select an N3IWF by performing the DNS procedure specified in clause 4.5.4.5 of TS 23.402 [43].\nb)\tIn all other cases, (e.g. when the UE is not configured with the Non-3GPP access node selection information, or the UE is registered via 3GPP access to a PLMN but this PLMN is not included in the Non-3GPP access node selection information, or the UE is not registered via 3GPP access to any PLMN), the UE shall select an N3IWF by performing the DNS procedure specified in clause 4.5.4.5 of TS 23.402 [43] with the difference that the UE shall construct the Prefixed N3IWF OI FQDN if the UE is configured with Slice-specific N3IWF prefix configuration for the selected PLMN.\nIf the UE is accessing PLMN services via SNPN, the UE uses the procedure defined in this clause to select an N3IWF deployed in the PLMN. If the UE is accessing standalone non-public network service via a PLMN (see supported cases in clause 5.30.2.0), the UE uses the procedure defined in clause 6.3.6.2a.\nThis procedure applies when the UE is accessing the SNPN N3IWF in its subscribed SNPN via a PLMN or directly via untrusted non-3GPP access.\nThe UE shall first determine the country in which it is located. If the UE cannot determine the country in which the UE is located, the UE shall stop N3IWF selection and abort the attempt to access the SNPN via PLMN.\nNOTE 1:\tIt is up to UE implementation how to determine the country in which the UE is located.\nThe UE is configured with one N3IWF address and the MCC of the country where the configured N3IWF is located as defined in TS 24.502 [48].\nIf the UE determines that it is located in the country where the configured N3IWF is located, then the UE uses the configured N3IWF FQDN to select an N3IWF deployed in the SNPN.\nIf the UE determines that it is located in a country (called the visited country) different from the country where the configured N3IWF is located, then:\n-\tThe UE shall construct an FQDN consisting of the SNPN ID of the subscribed SNPN and the Visited Country FQDN and indicating the query is for SNPN, as specified in TS 23.003 [19] and perform a DNS query for the resulting FQDN.\n-\tIf the DNS response contains no records, then the UE determines that the visited country does not mandate the selection of an N3IWF in this country for the SNPN identified by the SNPN ID provided by the UE. In this case the UE uses the configured N3IWF FQDN to select an N3IWF deployed in the SNPN.\n-\tIf no DNS response is received, the UE shall stop the N3IWF selection.\nNOTE 2:\tThe DNS can be configured to return no records for the visited country regardless of the SNPN ID provided by the UE. This addresses the scenario that the visited country in general does not mandate selection of a local N3IWF.\n-\tIf the DNS response contains one or more records, then the UE determines that the visited country mandates the selection of an N3IWF in this country. Each record in the DNS response shall contain the identity of an N3IWF of the UE's subscribed SNPN in the visited country which may be used for N3IWF selection. In this case:\n-\tThe UE shall select an N3IWF included in the DNS response based on its own implementation means.\n-\tIf the UE cannot select any N3IWF included in the DNS response, then the UE shall stop the N3IWF selection.\nNOTE 3:\tVisited countries which mandate the selection of an N3IWF in the country are assumed to configure the DNS as follows:\n(i)\tFor SNPNs that do not have any dedicated N3IWFs in the country and which are not exempt from the requirement to select an N3IWF in the visited country, the DNS response contains a record that cannot be resolved to an IP address;\n(ii)\tfor SNPNs that have dedicated N3IWFs in the country, the DNS response contains the identities of the SNPN's N3IWFs in the visited country;\n(iii)\tfor SNPNs that are exempt from the requirement to select an N3IWF in the visited country, the DNS response contains no records.\nNOTE 4:\tSelf-assigned NIDs are not supported, since a DNS cannot be properly configured for multiple SNPNs using the same self-assigned NID (i.e. in collision scenarios). If the visited country mandates the selection of an N3IWF in the same country, the NAPTR record(s) associated to the Visited Country FQDN of SNPNs that use a self-assigned NID can be provisioned with the replacement field containing an FQDN that cannot be resolved to an IP address.\nNOTE 5:\tThe identity of an SNPN's N3IWF in the visited country can be any FQDN, i.e. is not required to include the SNPN ID.\nNOTE 6:\tIt is assumed that the AMF, SMF, UPF are located in the same country as the N3IWF and belong to the subscribed SNPN of the UE.\nWhen the UE wants to select a non-3GPP access node (either an N3IWF or an ePDG), the UE shall perform the following procedure:\n1)\tThe UE shall attempt to determine the country it is located in. This is determined by implementation-specific methods not defined in this specification. If the UE cannot determine the country it is located in, the UE shall stop the non-3GPP access node selection.\n2)\tIf the UE determines to be located in its home country, then:\na)\tThe UE shall select the HPLMN. If the UE fails to connect to an ePDG/N3IWF in the HPLMN, then the UE shall stop the non-3GPP access node selection.\n3)\tIf the UE determines to be located in a country other than its home country (called the visited country), then:\na)\tIf the UE is registered via 3GPP access to a PLMN and this PLMN is included in the Non-3GPP access node selection information, then the UE shall select this PLMN. If the UE fails to connect to an ePDG/N3IWF in this PLMN, the UE shall select another PLMN by performing the DNS procedure specified in bullet 3c) below.\nb)\tIn all other cases, (e.g. when the UE is not configured with the Non-3GPP access node selection information, or the UE is registered via 3GPP access to a PLMN but this PLMN is not included in the Non-3GPP access node selection information, or the UE is not registered via 3GPP access to any PLMN), the UE shall select a PLMN by performing the DNS procedure specified in bullet 3c) below.\nc)\tThe UE shall select a PLMN as follows:\ni)\tThe UE shall determine if the non-3GPP access node selection is required for an IMS service or for a non-IMS service. The means of that determination are implementation specific.\nii)\tIf the UE determines that the non-3GPP access node selection is required for a non-IMS service, the UE shall select a PLMN as specified in clause 6.3.6.2. As defined below, if the UE fails to connect to an N3IWF in any PLMN, the UE may attempt to select an ePDG according to the procedure specified in clause 4.5.4.5 of TS 23.402 [43].\niii)\tIf the UE determines that the non-3GPP access node selection is required for an IMS service, the UE shall select a PLMN as follows:\n-\tFirst, the UE shall perform a DNS query using the Visited Country FQDN for N3IWF, as specified in TS 23.003 [19] to determine if the visited country mandates the selection of N3IWF in this country. The DNS response received by the UE may be empty or may contain the identities of one or more PLMNs in the visited country, which may be used for N3IWF selection, if the UE decides to select an N3IWF, as specified below. For example, the DNS response may contain the identity of PLMN-1 and the identity of PLMN-2.\n-\tThen, the UE shall perform a DNS query using the Visited Country FQDN for ePDG, as specified in TS 23.003 [19] to determine if the visited country mandates the selection of ePDG in this country. The DNS response received by the UE may be empty or may contain the identities of one or more PLMNs in the visited country, which may be used for ePDG selection, if the UE decides to select an ePDG, as specified below. For example, the DNS response may contain the identity of PLMN-1 and the identity of PLMN-3.\n-\tIf the UE does not receive a DNS response in none of the above two DNS queries, then the UE shall stop the non-3GPP access node selection. Otherwise, the next steps are executed.\n-\tThe UE shall consolidate the PLMN identities received in the above two DNS responses and shall construct a candidate list of PLMNs. For example, the candidate list of PLMNs may contain the identities of PLMN-1, PLMN-2, PLMN-3.\n-\tIf the candidate list of PLMNs is empty, then:\n-\tIf the Non-3GPP access node selection information contains one or more PLMNs in the visited country, the UE shall select one of these PLMNs based on their priorities in the Non-3GPP access node selection information. If the UE fails to connect to a non-3GPP access node in any of these PLMNs, the UE shall select the HPLMN.\n-\tOtherwise, the UE shall select the HPLMN.\n-\tIf the candidate list of PLMNs is not empty, then:\n-\tIf the UE is registered via 3GPP access to a PLMN which is included in the candidate list of PLMNs, then the UE shall select this PLMN. If the UE fails to connect to a non-3GPP access node in this PLMN, then the UE shall select a different PLMN included in the candidate list of PLMNs as specified in the next bullet.\n-\tIf the UE is registered via 3GPP access to a PLMN which is not included in the candidate list of PLMNs, or the UE is not registered via 3GPP access to any PLMN, or the UE fails to connect to a non-3GPP access node according to the previous bullet, then the UE shall select one of the PLMNs included in the candidate list of PLMNs based on the prioritized list of PLMNs in the Non-3GPP access node selection information (i.e. the UE shall select first the highest priority PLMN in the Non-3GPP access node selection information that is contained in the candidate list of PLMNs). If the Non-3GPP access node selection information does not contain any of the PLMNs in the candidate list of PLMNs, or the UE is not configured with the Non-3GPP access node selection information, or the UE was not able to connect to a non-3GPP access node in any of the PLMNs included in the Non-3GPP access node selection information and in the candidate list of PLMN, then the UE shall select a PLMN included in the candidate list of PLMNs based on its own implementation means.\n-\tIf the UE cannot select a non-3GPP access node in any of the PLMNs included in the candidate list of PLMNs, then the UE shall stop the non-3GPP access node selection.\nIn the selected PLMN the UE shall attempt to select a non-3GPP access node as follows:\n1.\tThe UE shall determine if the non-3GPP access node selection is required for an IMS service or for a non-IMS service. The means of that determination are implementation-specific.\n2.\tWhen the selection is required for an IMS service, the UE shall choose a non-3GPP access node type (i.e. ePDG or N3IWF) based on the \"Preference\" parameter specified in clause 6.3.6.1, unless the UE has its 5GS capability disabled in which case it shall choose an ePDG independent of the \"Preference\" parameter setting.\nIf the \"Preference\" parameter for the selected PLMN indicates that ePDG is preferred, the UE shall attempt to select an ePDG. If the \"Preference\" parameter for the selected PLMN indicates that N3IWF is preferred, the UE shall attempt to select an N3IWF.\nIf the selection fails, including the case when, during the registration performed over either 3GPP or non-3GPP access, the UE receives the IMS Voice over PS session Not Supported over Non-3GPP Access indication (specified in clause 5.16.3.2a), the UE shall attempt selecting the other non-3GPP access node type in the selected PLMN, if any. If that selection fails too, or it is not possible, then the UE shall select another PLMN, according to the procedure specified bullet 3c) above.\n3.\tWhen the selection is required for a non-IMS service, the UE shall perform the selection by giving preference to the N3IWF independent of the \"Preference\" parameter setting. If the N3IWF selection fails, or it is not possible, the UE should select another PLMN based on the procedure specified in clause 4.5.4.4 of TS 23.402 [43], and shall attempt to select an N3IWF in this PLMN. If the UE fails to select an N3IWF in any PLMN, the UE may attempt to select an ePDG according to the procedure specified in clause 4.5.4.5 of TS 23.402 [43].\nIn the above procedure, when the UE attempts to construct a Tracking/Location Area Identifier FQDN either for ePDG selection or for N3IWF selection, the UE shall use the Tracking Area wherein the UE is located and shall construct either:\n-\tan ePDG or N3IWF TAI FQDN based on the 5GS TAI, when the UE is registered to the 5GS; or\n-\tan ePDG or N3IWF TAI FQDN based on the EPS TAI, when the UE is registered to EPS.\nNOTE:\tA UE performing both a selection for an IMS service and a selection for a non-IMS service could get simultaneously attached to a N3IWF and to an ePDG in the same PLMN or in different PLMNs.\nIf the UE is configured with Slice-specific N3IWF prefix configuration, then the UE shall construct the Prefixed N3IWF OI FQDN or the Prefixed N3IWF TA FQDN as specified in TS 23.003 [19] instead of the N3IWF OI FQDN and the N3IWF TA FQDN, respectively. Further details on constructing the Prefixed N3IWF OI and TA FQDN are described in clause 6.3.6.2.\nUE initiates PLMN and non-3GPP access node selection for emergency services when it detects a user request for emergency session and determines that untrusted non-3GPP access shall be used for the emergency access.\nWhen the UE supports connectivity with N3IWF but does not support connectivity with ePDG, as specified in TS 23.402 [43], the UE shall perform the procedure in clause 6.3.6.4.2 for selecting an N3IWF.\nWhen the UE supports connectivity with N3IWF, as well as with ePDG, as specified in TS 23.402 [43], the UE shall perform the procedure in clause 6.3.6.4.3 for selecting either an N3IWF or an ePDG, i.e. for selecting a non-3GPP access node.\nIf the UE is attached to 5GC via an N3IWF that is located in the same country as the country in which the UE is currently located and the AMF has previously indicated support for emergency services over non-3GPP access as defined in clause 5.16.4.1, the UE reuses the existing N3IWF connection for emergency services. Otherwise, the UE terminates any existing N3IWF connection and continues as follows:\nIf the UE is equipped with a UICC:\n-\tThe UE determines whether it is located in the home country or a visited country;\n-\tIf the UE is located in the home country, then the UE selects the Home PLMN for emergency services and selects an N3IWF based on the procedure defined in clause 6.3.6.2.\n-\tIf the UE is located in a visited country, the UE performs a DNS query using the Visited Country Emergency N3IWF FQDN, as specified in TS 23.003 [19] to determine which PLMNs in the visited country support emergency services in non-3GPP access via N3IWF; and:\n-\tIf the DNS response contains one or more records, the UE selects a PLMN that supports emergency services in non-3GPP access via N3IWF. Each record in the DNS response shall contain the identity of a PLMN in the visited country supporting emergency services in non-3GPP access via N3IWF.\n-\tThe UE shall consider these PLMNs based on their priorities in the Non-3GPP Access Node Selection Information (if available). If the UE cannot select a PLMN in the Non-3GPP Access Node Selection Information or if non-3GPP Access Node Selection Information is not available, the UE shall attempt to select any PLMN in the list of PLMNs returned in the DNS response.\n-\tOnce the UE has selected a PLMN the UE shall select an N3IWF for the selected PLMN as follows:\n-\tIf non-3GPP Access Node Selection Information is available for the selected PLMN the UE constructs the Tracking Area Identity based N3IWF FQDN or the Operator Identifier based N3IWF FQDN as indicated in the non-3GPP Access Node Selection Information for the selected PLMN.\n-\tIf non-3GPP Access Node Selection Information is not available for the selected PLMN the UE constructs the Operator Identifier based N3IWF FQDN for the selected PLMN.\n-\tIf the DNS response does not contain any record, or if the DNS response contains one or more records but the UE fails to select a PLMN that supports emergency services in non-3GPP access, or if the Emergency Registration procedure has failed for all PLMNs supporting emergency services in non-3GPP access, the UE notifies the user that an emergency session cannot be established.\nIf the UE is not equipped with a UICC, the UE shall perform the emergency N3IWF selection procedure above as if always in a visited country and without using the Non-3GPP Access Node Selection Information, i.e. the UE may construct the Operator Identifier based N3IWF FQDN format based on a PLMN ID obtained via implementation specific means.\nWhen an N3IWF has been selected, the UE initiates an Emergency Registration. If the Emergency Registration fails, the UE shall select another PLMN supporting emergency services in non-3GPP access.\nIf the UE is attached to 5GC via an N3IWF that is located in the same country as the country in which the UE is currently located and the AMF has previously indicated support for emergency services over non-3GPP access as defined in clause 5.16.4.1, the UE reuses the existing N3IWF connection for emergency services. Otherwise, the UE terminates any existing N3IWF connection and performs PLMN and N3IWF or ePDG selection for emergency services.\nIf the UE is attached to EPC via an ePDG that has indicated support for the emergency services and is located in the same country as the country in which the UE is currently located, the UE reuses the existing ePDG connection for emergency services. Otherwise, the UE terminates the existing ePDG connection, if any, and performs PLMN and N3IWF or ePDG selection for emergency services.\nPLMN and N3IWF or ePDG selection for emergency services is performed as follows:\nIf the UE is equipped with a UICC:\n-\tThe UE determines whether it is located in the home country or a visited country;\n-\tIf the UE is located in the home country the UE selects the Home PLMN for emergency services and selects an N3IWF or ePDG as follows:\n-\tIf the Non-3GPP Access Node Selection Information for the HPLMN is available the UE selects first an N3IWF or ePDG based on the Non-3GPP Access Node type preference in the Non-3GPP Access Node Selection Information for the HPLMN. To select an N3IWF the UE uses the N3IWF identifier configuration (if available). If the N3IWF identifier configuration is not available, the UE constructs the FQDN format as indicated by the FQDN format in the Non-3GPP Access Node Selection Information for the HPLMN. To select an ePDG the UE selects the ePDG identified by the configured Emergency ePDG FQDN (if available). If the configured Emergency ePDG FQDN is not available, the UE constructs either the Tracking/Location Area Identity based Emergency ePDG FQDN or the Operator Identifier based Emergency ePDG FQDN as indicated by the FQDN format in the Non-3GPP Access Node Selection Information for the HPLMN.\n-\tIf the Non-3GPP Access Node Selection Information is not available, the UE shall first attempt to select an N3IWF following the procedure defined in clause 6.3.6.2 before attempting to select an ePDG. To select an ePDG the UE selects the ePDG identified by the configured Emergency ePDG FQDN (if available). If the configured Emergency ePDG FQDN is not available, the UE constructs the Operator Identifier based Emergency ePDG FQDN.\n-\tIf the UE is located in a visited country, the UE performs a DNS query using the Visited Country Emergency FQDN for N3IWF and using the Visited Country Emergency FQDN for ePDG, as specified in TS 23.003 [19] to determine which PLMNs in the visited country support emergency services in non-3GPP access.\n-\tIf the DNS responses contain one or more records, the UE selects a PLMN that supports emergency services in non-3GPP access for the UE. Each record in the DNS responses shall contain the identity of a PLMN in the visited country supporting emergency services in non-3GPP access via ePDG or N3IWF.\n-\tThe UE shall consider these PLMNs based on their priorities in the Non-3GPP Access Node Selection Information. If the UE cannot select a PLMN in the Non-3GPP Access Node Selection Information or if non-3GPP Access Node Selection Information is not available, the UE shall attempt to select any PLMN in the list of PLMNs returned in the DNS response.\n-\tOnce the UE has selected a PLMN the UE shall select an N3IWF or ePDG for the selected PLMN as follows:\n-\tIf the Non-3GPP Access Node Selection Information for the PLMN is available the UE selects first an N3IWF or ePDG based on the Non-3GPP Access Node type preference in the Non-3GPP Access Node Selection Information for the PLMN. To select an N3IWF the UE constructs the FQDN format as indicated by the FQDN format in the Non-3GPP Access Node Selection Information for the PLMN. To select an ePDG the UE constructs either the Tracking/Location Area Identity based Emergency ePDG FQDN or the Operator Identifier based Emergency ePDG FQDN as indicated by the FQDN format in the Non-3GPP Access Node Selection Information for the PLMN.\n-\tIf the Non-3GPP Access Node Selection Information is not available, the UE shall first attempt to select an N3IWF following the procedure defined in clause 6.3.6.2 before attempting to select an ePDG. To select an ePDG the UE constructs the Operator Identifier based Emergency ePDG FQDN.\n-\tIf the DNS response does not contain any record, or if the DNS response contains one or more records but the UE fails to select a PLMN that supports emergency services in non-3GPP access, or if the Emergency Registration procedure has failed for all PLMNs supporting emergency services in non-3GPP access, the UE notifies the user that emergency session cannot be established.\nIf the UE is not equipped with a UICC, the UE shall perform the emergency ePDG/N3IWF selection procedure above as if always in a visited country and without using the Non-3GPP Access Node Selection Information, i.e. the UE may construct the Operator Identifier FQDN for N3IWF or ePDG based on a PLMN ID obtained via implementation specific means.\nWhen a N3IWF has been selected, the UE initiates an Emergency Registration. If the Emergency Registration fails, the UE shall attempt to select an ePDG before selecting another PLMN supporting emergency services in non-3GPP access. When an ePDG has been selected, the UE initiates an Emergency Registration. If the Emergency Registration fails, the UE shall attempt to select a N3IWF before selecting another PLMN supporting emergency services in non-3GPP access.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.7\tPCF discovery and selection",
                            "text_content": "Clause 6.3.7.0 describes the underlying principles for PCF selection and discovery:\n-\tThere may be multiple and separately addressable PCFs in a PLMN.\n-\tThe PCF must be able to correlate the AF service session established over N5 or Rx with the associated PDU Session (Session binding) handled over N7.\n-\tIt shall be possible to deploy a network so that the PCF may serve only specific DN(s). For example, Policy Control may be enabled on a per DNN basis.\n-\tUnique identification of a PDU Session in the PCF shall be possible based on the (UE ID, DNN)-tuple, the (UE (IP or MAC) Address(es), DNN)-tuple and the (UE ID, UE (IP or MAC) Address(es), DNN).\nPCF discovery and selection functionality is implemented in AMF, SMF, SCP and PCF and follows the principles in clause 6.3.1. The AMF uses the PCF services for a UE and the SMF uses the PCF services for a PDU Session. PCF for a PDU Session uses the PCF services for a UE.\nWhen the NF service consumer performs discovery and selection for a UE, the following applies:\n-\tThe AMF may utilize the NRF to discover the candidate PCF instance(s) for a UE. In addition, PCF information may also be locally configured in the AMF. The AMF selects a PCF instance based on the available PCF instances obtained from the NRF or locally configured information in the AMF, depending on operator's policies.\nIn the non roaming case, the AMF selects a PCF instance for AM policy association and selects the same PCF instance for UE policy association. In the roaming case, the AMF selects a V-PCF instance for AM policy association and selects the same V-PCF instance for UE policy association.\nThe PCF for a PDU Session selects a (V-)PCF instance for UE policy association.\nThe following factors may be considered at PCF discovery and selection for Access and Mobility policies and UE policies:\n-\tSUPI; the AMF selects a PCF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI as input for PCF discovery.\n-\tS-NSSAI(s). In the roaming case, the AMF selects the V-PCF instance based on the S-NSSAI(s) of the VPLMN and selects the H-PCF instance based on the S-NSSAI(s) of the HPLMN.\n-\tPCF Set ID.\n-\tPCF Group ID of the UE's SUPI.\nNOTE 1:\tThe AMF can infer the PCF Group ID the UE's SUPI belongs to, based on the results of PCF discovery procedures with NRF. The AMF provides the PCF Group ID the SUPI belongs to to other PCF NF consumers as described in TS 23.502 [3].\n-\tDNN replacement capability of the PCF.\n-\tSlice replacement capability of the PCF.\n-\tPCF Selection Assistance Info and PCF ID(s) serving the established PDU Sessions/PDN Connections received from UDM. In case PCF Selection Assistance Info and PCF ID(s) are received from the UDM, the AMF selects the same PCF instance serving the combination of DNN and S-NSSAI as indicated by the PCF Selection Assistance Info, if multiple DNN, S-NSSAI combinations are provided, the AMF selects the DNN,S-NSSAI using local configuration. In case PCF ID(s) are not received, e.g. EPS interworking is not supported, the AMF selects the PCF instance by considering other above factors.\n-\tURSP delivery in EPS capability of the PCF.\nWhen the NF service consumer performs discovery and selection for a PDU Session, the following applies:\n-\tThe SMF may utilize the NRF to discover the candidate PCF instance(s) for a PDU Session. In addition, PCF information may also be locally configured in the SMF. The SMF selects a PCF instance based on the available PCF instances obtained from the NRF or locally configured information in the SMF, depending on operator's policies.\nThe following factors may be considered at PCF discovery and selection for a PDU session:\na)\tLocal operator policies.\nb)\tSelected Data Network Name (DNN).\nc)\tS-NSSAI of the PDU Session. In the LBO roaming case, the SMF selects the PCF instance based on the S-NSSAI of the VPLMN. In the home routed roaming case, the H-SMF selects the H-PCF instance based on the S-NSSAI of the HPLMN.\nd)\tSUPI; the SMF selects a PCF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI as input for PCF discovery.\ne)\tPCF selected by the AMF for the UE.\nf)\tMA PDU Session capability of the PCF, for an MA PDU session.\ng)\tThe PCF Group ID provided by the AMF to the SMF.\nh)\tPCF Set ID.\ni)\tSame PCF Selection Indication.\nj)\tURSP delivery in EPS capability of the PCF.\nIn the case of delegated discovery and selection in SCP, the SMF includes the factors b) - h), j), if available, in the first request.\nThe selected PCF instance for serving the UE and the selected PCF instance for serving a PDU session of this UE may be the same or may be different.\nIn the following scenarios, information about the PCF instance that has been selected (i.e. the PCF ID, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available)) may be forwarded to another NF. If the NF service consumer performs discovery and selection, this NF may use this PCF instance. If the NF service consumer performs delegated discovery and selection, this NF may include PCF ID, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available) in the request and the SCP may use this information to select the PCF instance (discovery may still be needed depending on what level of information is sent by the AMF, e.g. the address of the PCF instance may not be present):\nWhen NF service consumer performs discovery and selection, the following applies:\n-\tDuring AMF relocation, the target AMF may receive a PCF ID, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available) from the source AMF to enable the usage of the same PCF by the target AMF, and the target AMF may decide based on operator policy either to use the same PCF or select a new PCF.\n-\tThe AMF may, based on operator policies, forward the selected PCF to SMF instance(s) during the PDU Session Establishment procedure(s) to enable the usage of the same PCF for the AMF and the SMF instance(s). The SMF may decide based on operator policy either to use the same PCF or select a new PCF. If combination of the DNN and S-NSSAI of the PDU session matches one of the combination of the DNN and S-NSSAI included in the PCF Selection Assistance info received from UDM, the AMF shall forward Same PCF Selection Indication together with the selected PCF to SMF instance during the PDU Session Establishment procedure. In case that the Same PCF Selection Indication is received together with the PCF ID, the SMF shall select the same PCF instance for SM Policy Control.\n-\tIn the roaming case, the AMF may, based on operator policies, e.g. roaming agreement, select the H-PCF in addition to the V-PCF for a UE by performing the PCF discovery and selection as described above. The AMF sends the H-PCF ID of the selected H-PCF instance to the V-PCF during the policy association establishment procedure.\nWhen the SMF receives a a redirection indication with PCF ID from the PCF for the PDU session, the SMF shall terminate the current SM Policy Control association and reselects a PCF based on the received PCF ID. The SMF shall then establish an SM Policy Control association with the reselected PCF.\nIn the case of delegated discovery and selection in the SCP, the following applies:\n-\tThe selected PCF instance may include the PCF Id, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available) in the response to the AMF.\nNOTE 2:\tThe selected (V-)PCF instance can include the binding indication, including the (V-)PCF ID and possibly PCF Set ID in the response to the AMF as described in clause 6.3.1.0.\n-\tThe AMF first establishes an AM policy association; when forwarding the related request message the SCP discovers and selects a PCF instance. Unless binding information is provided in the response to that request the SCP adds the NF function producer ID it selected, i.e. PCF ID, into the response and the AMF uses the received PCF ID and available binding information as discovery and selection parameters for the request to establish the UE policy association towards the SCP. The SCP selects the (V-)PCF instance for UE policy association based on the received discovery and selection parameters.\n-\tDuring AMF relocation, the AMF may receive a PCF ID, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available) from the source AMF to enable the usage of the same PCF instance by the AMF. The AMF may decide based on operator policy either to use the old PCF instance or select another PCF instance. If the AMF decides to use the old PCF, the AMF includes the PCF ID PCF Set Id, and if PCF Set Id is not available, the PCF Group ID (if available) as received from the source AMF in the AM policy update request to the SCP.\n-\tThe AMF may, based on operator policies, forward the selected PCF ID, PCF Set Id and, if PCF Set Id is not available, the PCF Group ID (if available) to the SMF during the PDU Session Establishment procedure to enable the usage of the same PCF for the AMF and the SMF. The SMF may include that information in the request in discovery and selection parameters to the SCP. The SCP may decide based on operator policy either to use the indicated PCF instance or select another PCF instance.\n-\tIn the roaming case, the AMF performs discovery and selection of the H-PCF from NRF as described in this clause. The AMF may indicate the maximum number of H-PCF instances to be returned from NRF, i.e. H-PCF selection at NRF. The AMF uses the received V-PCF ID and available binding information received during the AM policy association procedure to send the UE policy association establishment request, which also includes the H-PCF ID, to the SCP. The SCP discovers and selects the V-PCF. The V-PCF sends an UE policy association establishment request towards the HPLMN, which includes the H-PCF ID as a discovery and selection parameter to SCP.\nAn authorized Application Function may, via the NEF, provide policy requirements that apply to multiple UE(s) (which, for example, belong to group of UE(s) defined by subscription or to any UE). Such policy requirements shall apply to any existing or future PDU Sessions that match the parameters in the AF request, and they may apply to multiple PCF instance(s).\nNOTE:\tApplication Function influence on traffic routing described in clause 5.6.7 is an example of such requirement.\nAfter relevant validation of the AF request (and possible parameter mapping), the NEF stores this request received from the AF into the selected UDR instance as the Data Subset of the Application data. The possible parameter mapping includes mapping UE (group) identifiers provided by the AF to identifiers used within the 5GC, e.g. from GPSI to SUPI and/or from External Group Identifier to Internal-Group Identifier. Parameter mapping may also include mapping from the identifier of the Application Function towards internal identifiers such as the DNN and/or the S-NSSAI.\nPCF(s) that need to receive AF requests that targets a DNN (and slice), and/or a group of UEs subscribe to receive notifications from the UDR about such AF request information. The PCF(s) can be configured (e.g. by OAM) to subscribe to receive notification of such AF request information from the UDR(s). The PCF(s) take(s) the received AF request information into account when making policy decisions for existing and future relevant PDU Sessions. In the case of existing PDU Sessions, the policy decision of the PCF instance(s) may trigger a PCC rule(s) change from the PCF to the SMF.\nThe PCF subscription to notifications of AF requests described above may take place during PDU Session Establishment or PDU Session Modification, when the PCF(s) receive request(s) from the SMF for policy information related to the DNN (and slice), and/or the Internal-Group Identifier of UEs. For the PCF(s) that have subscribed to such notifications, the UDR(s) notify the PCF(s) of any AF request update.\nThe NEF associates the AF request with information allowing to later modify or delete the AF request in the UDR; it associates the AF request with:\n-\tWhen the AF request targets PDU Sessions established by \"any UE\": the DNN, the slicing information target of the AF request,\n-\tWhen the request targets PDU Sessions established by UE(s) belonging to an Internal-Group: the DNN, the slicing information and the Internal-Group Identifier target of the application request.\n-\tThe AF transaction identifier in the AF request.\nBinding an AF request to the relevant PCF instance is described in TS 23.503 [45].\nBinding an AF request to the relevant PCF for a UE is described in TS 23.503 [45].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.8\tUDM discovery and selection",
                            "text_content": "The NF consumer or the SCP performs UDM discovery to discover a UDM instance that manages the user subscriptions.\nIf the NF consumer performs discovery and selection, the NF consumers shall utilize the NRF to discover the UDM instance(s) unless UDM information is available by other means, e.g. locally configured on NF consumers. The UDM selection function in NF consumers selects a UDM instance based on the available UDM instances (obtained from the NRF or locally configured).\nThe UDM selection functionality is applicable to both 3GPP access and non-3GPP access.\nThe UDM selection functionality in NF consumer or in SCP should consider one of the following factors:\n1.\tHome Network Identifier (e.g. MNC and MCC, realm) of SUCI/SUPI, along with the selected NID (provided by the NG-RAN) in the case of SNPN, UE's Routing Indicator and optionally Home Network Public Key identifier (e.g. in the case that Routing Indicator is not enough to provide SUPI range granularity).\nNOTE 1:\tThe UE provides the SUCI to the AMF, which contains the Routing Indicator and Home Network Public Key identifier as defined in TS 23.003 [19] during initial registration. The AMF provides the UE's Routing Indicator and optionally Home Network Public Key identifier to other NF consumers (of UDM) as described in TS 23.502 [3].\nNOTE 2:\tThe usage of Home Network Public Key identifier for UDM discovery is limited to the scenario where the NF consumers belong to the same PLMN as AUSF.\nNOTE 3:\tIn the case of SNPN and the UE provides an IMSI type SUCI to the AMF and the SUCI provided by UE or the SUPI derived from the SUCI is for an SNPN served by the AMF, the AMF uses the selected NID provided by the NG-RAN together with the selected PLMN ID (from IMSI) or the Routing Indicator provided by the UE within the SUCI for UDM selection. In the case of SNPN and the UE provides an NSI type SUCI to the AMF, the AMF uses the Home Network Identifier and Routing Indicator of SUCI/SUPI for selection of UDM.\nWhen the UE's Routing Indicator is set to its default value as defined in TS 23.003 [19], the UDM NF consumer can select any UDM instance within the home network of the SUCI/SUPI.\n2.\tUDM Group ID of the UE's SUPI.\nNOTE 4:\tThe AMF can infer the UDM Group ID the UE's SUPI belongs to, based on the results of UDM discovery procedures with NRF. The AMF provides the UDM Group ID the SUPI belongs to other UDM NF consumers as described in TS 23.502 [3].\n3.\tSUPI or Internal Group ID; the UDM NF consumer selects a UDM instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI or Internal Group ID as input for UDM discovery.\n4.\tGPSI or External Group ID; UDM NF consumers which manage network signalling not based on SUPI/SUCI (e.g. the NEF) select a UDM instance based on the GPSI or External Group ID range the UE's GPSI or External Group ID belongs to or based on the results of a discovery procedure with NRF using the UE's GPSI or External Group ID as input for UDM discovery.\nIn the case of delegated discovery and selection in SCP, NF consumer shall include one of these factors in the request towards SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.9\tUDR discovery and selection",
                            "text_content": "Multiple instances of UDR may be deployed, each one storing specific data or providing service to a specific set of NF consumers as described in clause 4.2.5. In segmented UDR deployment, different instances of UDR store the data for different Data Sets and Data Subsets or for different users. A UDR instance can also store application data that applies on any UE, i.e. all subscribers of the PLMN.\nIf the NF service consumer performs discovery and selection, the NF consumer shall utilize the NRF to discover the appropriate UDR instance(s) unless UDR instance information is available by other means, e.g. locally configured on NF consumer. The UDR selection function in NF consumers is applicable to both 3GPP access and non-3GPP access. The NF consumer or the SCP shall select a UDR instance that contains relevant information for the NF consumer, e.g. UDM/SCP selects a UDR instance that contains subscription data, while NEF/SCP (when used to access data for exposure) selects a UDR that contains data for exposure; or PCF/SCP selects a UDR that contains Policy Data and/or Application Data.\nThe UDR selection function in UDR NF consumers considers the Data Set Identifier of the data to be managed in UDR (see UDR service definition in clause 5.2.12 of TS 23.502 [3]). Additionally, the UDR selection function in UDR NF consumers should consider one of the following factors when available to the UDR NF consumer when selecting a UDR that stores the required Data Set(s) and Data Subset(s):\n1.\tUDR Group ID the UE's SUPI belongs to.\n2.\tSUPI; e.g. the UDR NF consumer selects a UDR instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI as input for UDR discovery.\n3.\tGPSI or External Group ID; e.g. UDR NF consumers select a UDR instance based on the GPSI or External Group ID range the UE's GPSI or External Group ID belongs to or based on the results of a discovery procedure with NRF using the UE's GPSI or External Group ID as input for UDR discovery.\n4.\tUDR capability to store application data that is applicable on any UE (i.e. all subscribers of the PLMN).\nIn the case of delegated discovery and selection, the NF consumer shall include the available factors in the request towards SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.10\tSMSF discovery and selection",
                            "text_content": "The SMSF selection function is supported by the AMF and is used to allocate an SMSF instance that shall manage the SMS.\nIf the \"SMS supported\" indication is included in the Registration Request by the UE, the AMF checks SMS subscription from the UDM for the UE on whether the SMS is allowed for the UE.\nIf the SMS is allowed and the UE Context stored in AMF includes an SMSF address, the AMF uses the SMSF address included in UE Context (according to Table 5.2.2.2.2-1 of TS 23.502 [3]).\nIf the SMS is allowed and the UE Context stored in AMF does not include an SMSF address, the AMF discovers and selects an SMSF to serve the UE.\nThe SMSF selection may be based on the following methods:\n-\tSMSF instance(s) address(es) preconfigured in the AMF (i.e. SMSF FQDN or IP addresses); or\n-\tSMSF information available in the serving PLMN if received from an old AMF or the UDM; or\n-\tThe AMF invokes Nnrf_NFDiscovery service operation from NRF to discover SMSF instance as described in clause 5.2.7.3.2 of TS 23.502 [3].\nFor roaming scenario, the AMF discovers and selects an SMSF in VPLMN.\nIf the NF consumer performs discovery and selection via NRF, the SMSF selection function in the NF consumer selects a SMSF instance based on the available SMSF instances obtained from the NRF.\nIn the case of delegated discovery and selection in SCP, the NF consumer shall include all available factors in the request towards SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.11\tCHF discovery and selection",
                            "text_content": "The CHF discovery and selection function is supported by the SMF, the AMF, the SMSF and the PCF. It is used by the SMF to select a CHF that manages the online charging or offline charging for a PDU Session of a subscriber. It is used by the AMF to select a CHF that manages the online charging or offline charging for 5G connection and mobility of a subscriber. It is used by the SMSF to select a CHF that manages the online charging or offline charging for the SMS over NAS transactions of a subscriber. It is used by the PCF to select a CHF that manages the spending limits for a subscriber and/or a PDU Session of a subscriber.\nFor the PCF to select the CHF, the address(es) of the CHF, including the Primary CHF address and the Secondary CHF address, may be:\n-\tstored in the UDR as part of the PDU Session policy control subscription information as defined in clause 6.2.1.3 of TS 23.503 [45].\n-\tstored in the UDR as part of the UE context policy control subscription information as defined in clause 6.2.1.3 of TS 23.503 [45].\n-\tstored in the UDR as part of the Access and Mobility policy control subscription information as defined in clause 6.2.1.3 of TS 23.503 [45].\n-\tlocally configured in the PCF based on operator policies.\n-\tdiscovered using NRF as described in in clause 6.1 of TS 32.290 [67].\nNOTE 1:\tThe operator can perform the above UDR provisioning or local configuration in a consistent manner such that the same CHF address is used for SM policy, AM policy and UE policy. If NRF discovery is used, it is up to the PCF logic (or SCP logic when working in Delegated Discovery mode) and operator configuration to guarantee the CHF address consistency.\nThe address(es) of the CHF shall be applicable for all services provided by the CHF.\nThe CHF address(es) that a stored in the UDR or configured in the PCF may be complemented by the associated CHF instance ID(s) and CHF set ID(s) (see clause 6.3.1.0) stored or configured in the same location.\nThe CHF address(es) retrieved from the UDR and possible associated CHF instance ID(s) and CHF set ID(s) take precendence over the locally configured CHF address(es) and possible associated CHF instance ID(s) and CHF set ID(s), and over the CHF address(es) discoverred by the NRF. If no CHF address(es) is received from the UDR, the PCF selects, based on operator policies, either the CHF addresse(es) provided by NRF, or the locally configured CHF address(es) and possible associated CHF instance ID(s) and CHF set ID(s).\nIf the PCF has a CHF set ID but no CHF instance ID associated to the CHF address(es) in the same location, the CHF instance within the CHF set may change. If the PCF is not able to reach the CHF address(es), it should query the NRF for other CHF instances within the CHF set.\nIf the PCF received a CHF set ID and a CHF instance ID associated to the CHF address(es) in the same location, the CHF service instance within the CHF may change. If an PCF is not able to reach the CHF address(es), it should query the NRF for other CHF service instances within the CHF.\nTo enable the SMF to select the same CHF that is selected by the PCF for a PDU Session, the PCF provides the selected CHF address(es) and, if available, the associated CHF instance ID(s) and/or CHF set ID(s) in the PDU Session related policy information to the SMF as described in Table 6.4-1 of TS 23.503 [45] and the SMF applies the CHF address and if available, the associated CHF instance ID(s) and/or CHF set ID(s) passed from the PCF as defined in clause 5.1.8 of TS 32.255 [68]. Otherwise, the SMF selection of the CHF as defined in clause 5.1.8 of TS 32.255 [68] applies.\nIf operator policies indicates the AMF should select the same CHF that is selected by the PCF for a UE, the PCF provides the selected CHF address(es) and, if available, the associated CHF instance ID(s) and/or CHF set ID(s) in the Access and mobility related policy information to the AMF as described in Table 6.5-1 of TS 23.503 [45] and the AMF may apply the CHF address and, if available, the associated CHF instance ID(s) and/or CHF set ID(s) passed from the PCF as defined in clause 5.1.3 of TS 32.256 [114]. Otherwise, the AMF selection of the CHF as defined in clause 5.1.3 of TS 32.256 [114] applies.\nHow the CHF is selected by the SMSF is defined in clause 5.4 of TS 32.274 [118].\nIf the NF consumer performs discovery and selection via NRF, the CHF selection function in NF consumers selects a CHF instance based on the available CHF instances obtained from the NRF.\nThe CHF selection functionality in NF consumer or in SCP should consider one of the following factors:\n1.\tCHF Group ID of the UE's SUPI.\nNOTE 2:\tThe NF Consumer can infer the CHF Group ID the UE's SUPI belongs to, based on the results of CHF discovery procedures with NRF.\n2.\tSUPI; the NF consumer selects a CHF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI as input for CHF discovery.\nIn the case of delegated discovery and selection in SCP, the NF consumer shall include all available factors in the request towards SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.12\tTrusted Non-3GPP Access Network selection",
                            "text_content": "Clause 6.3.12 specifies how a UE, which wants to establish connectivity via trusted non-3GPP access and is not operating in SNPN access mode, selects a PLMN and a trusted non-3GPP access network (TNAN) to connect to.\nNOTE:\tFor UE operating in SNPN access mode refer to clause 5.30.2.13.\nHow the UE decides to use trusted non-3GPP access is not specified in this document. As an example, a UE may decide to use trusted non-3GPP access for connecting to 5GC in a specific PLMN based on:\n-\tthe UE implementation-specific criteria; or\n-\tthe UE configuration, e.g. the UE may be configured to try first the trusted non-3GPP access procedures; or\n-\tthe UE capabilities, e.g. the UE may support only the trusted non-3GPP access procedures; or\n-\tthe advertised capabilities of the discovered non-3GPP access networks, e.g. one or more available non-3GPP access networks advertise support of trusted connectivity to 5GC in a specific PLMN.\nAn example deployment scenario is schematically illustrated in Figure 6.3.12.1-1 below. In this scenario, the UE has discovered five non-3GPP access networks, which are WLAN access networks. These WLANs advertise information about the PLMNs they interwork with, e.g. by using the ANQP protocol, as defined in the HS2.0 specification [85]. Each WLAN may support \"S2a connectivity\" and/or \"5G connectivity\" to one or more PLMNs. Before establishing connectivity via trusted non-3GPP access, the UE needs to select (a) a PLMN, (b) a non-3GPP access network that provide trusted connectivity this this PLMN, and (c) a connectivity type, i.e. either \"5G connectivity\" or \"S2a connectivity\".\nEach non-3GPP access network may advertise one or more of the following PLMN lists:\n1)\tA PLMN List-1, which includes PLMNs with which \"AAA connectivity\" is supported. A non-3GPP access network supports \"AAA connectivity\" with a PLMN when it deploys an AAA function that can connect with a 3GPP AAA Server/Proxy in this PLMN, via an STa interface (trusted WLAN to EPC), or via an SWa interface (untrusted WLAN to EPC); see TS 23.402 [43].\n2)\tA PLMN List-2, which includes PLMNs with which \"S2a connectivity\" is supported. A non-3GPP access network supports \"S2a connectivity\" with a PLMN when it deploys a TWAG function that can connect with a PGW in this PLMN, via an S2a interface; see clause 16 of TS 23.402 [43].\n3)\tA PLMN List-3, which includes PLMNs with which \"5G connectivity\" is supported. A non-3GPP access network supports \"5G connectivity\" with a PLMN when it deploys a TNGF function that can connect with an AMF function and an UPF function in this PLMN via N2 and N3 interfaces, respectively; see clause 4.2.8.\nWhen the UE wants to discover the PLMN List(s) supported by a non-3GPP access network and the non-3GPP access network supports ANQP, the UE shall send an ANQP query to the non-3GPP access network requesting \"3GPP Cellular Network\" information. If the non-3GPP access network supports interworking with one or more PLMNs, the response received by the UE includes a \"3GPP Cellular Network\" information element containing one or more of the above three PLMN Lists. The PLMN List-1 and the PLMN List-2 are specified in TS 23.402 [43] and indicate support of interworking with EPC in one or more PLMNs. The PLMN List-3 is a list used to indicate support of interworking with 5GC in one or more PLMNs. When the non-3GPP access network does not support ANQP, how the UE discovers the PLMN List(s) supported by the non-3GPP access network is not defined in the present specification.\nThe UE determines if a non-3GPP access network supports \"trusted connectivity\" to a specific PLMN by receiving the PLMN List-2 and the PLMN List-3 advertised by this access network. If this PLMN is not included in any of these lists, then the non-3GPP access network can only support connectivity to an ePDG or N3IWF in the PLMN (i.e. \"untrusted connectivity\").\nThe figure depicts a trusted Non-3GPP access network selection scenario, illustrating the various network elements and their roles in ensuring secure and reliable communication.\nFigure 6.3.12.1-1: Example deployment scenario for trusted Non-3GPP access network selection\nThe steps below specify the steps executed by the UE when the UE wants to select and connect to a PLMN over trusted non-3GPP access. Note that the UE executes these steps before connecting to a trusted non-3GPP access network. This is different from the untrusted non-3GPP access (see clause 6.3.6, \"N3IWF selection\"), where the UE first connects to a non-3GPP access network, it obtains IP configuration and then proceeds to PLMN selection and ePDG/N3IWF selection. In the case of trusted non-3GPP access, the UE uses 3GPP-based authentication for connecting to a non-3GPP access, so it must first select a PLMN and then attempt to connect to a non-3GPP access.\nStep 1:\tThe UE constructs a list of available PLMNs, with which trusted connectivity is supported. This list contains the PLMNs included in the PLMN List-2 and PLMN List-3, advertised by all discovered non-3GPP access networks. For each PLMN the supported type(s) of trusted connectivity is also included.\na.\tIn the example shown in Figure 6.3.12.1-1, the list of available PLMNs includes:\n-\tPLMN-a: \"S2a connectivity\", \"5G connectivity\"\n-\tPLMN-b: \"5G connectivity\"\n-\tPLMN-c: \"S2a connectivity\", \"5G connectivity\"\n-\tPLMN-d: \"S2a connectivity\"\nStep 2:\tThe UE selects a PLMN that is included in the list of available PLMNs, as follows:\na.\tIf the UE is connected to a PLMN via 3GPP access and this PLMN is included in the list of available PLMNs, the UE selects this PLMN. If this PLMN is not included in the list of available PLMNs, but it is included in the \"Non-3GPP access node selection information\" in the UE (see clause 6.3.6.1), the UE selects this PLMN and executes the combined ePDG/N3IWF selection procedure specified in clause 6.3.6.3.\nb.\tOtherwise (the UE is not connected to a PLMN via 3GPP access, or the UE is connected to a PLMN via 3GPP access but this PLMN is neither in the list of available PLMNs nor in the \"Non-3GPP access node selection information\"), the UE determines the country it is located in by using implementation specific means.\ni)\tIf the UE determines to be located in its home country, then:\n-\tThe UE selects the HPLMN, if included in the list of available PLMNs. Otherwise, the UE selects an E-HPLMN (Equivalent HPLMN), if an E-HPLMN is included in the list of available PLMNs. If the list of available PLMNs does not include the HPLMN and does not include an E-HPLMN, the UE stops the procedure and may attempt to connect via untrusted non-3GPP access (i.e. it may execute the N3IWF selection procedure specified in clause 6.3.6).\nii)\tIf the UE determines to be located in a visited country, then:\n-\tThe UE determines if it is mandatory to select a PLMN in the visited country, as follows:\n-\tIf the UE has IP connectivity (e.g. the UE is connected via 3GPP access), the UE sends a DNS query and receives a DNS response that indicates if a PLMN must be selected in the visited country. The DNS response includes also a lifetime that denotes how long the DNS response can be cached for. The FQDN in the DNS query shall be different from the Visited Country FQDN (see TS 23.003 [19]) that is used for ePDG/N3IWF selection. The DNS response shall not include a list of PLMNs that support trusted connectivity in the visited country, but shall only include an indication of whether a PLMN must be selected in the visited country or not.\n-\tIf the UE has no IP connectivity (e.g. the UE is not connected via 3GPP access), then the UE may use a cached DNS response that was received in the past, or may use local configuration that indicates which visited countries mandate a PLMN selection in the visited country.\n-\tIf the UE determines that it is not mandatory to select a PLMN in the visited country, and the HPLMN or an E-HPLMN is included in the list of available PLMNs, then the UE selects the HPLMN or an E-HPLMN, whichever is included in the list of available PLMNs.\n-\tOtherwise, the UE selects a PLMN in the visited country by considering, in priority order, the PLMNs, first, in the User Controlled PLMN Selector list and, next, in the Operator Controlled PLMN Selector list (see TS 23.122 [17]). The UE selects the highest priority PLMN in a PLMN Selector list that is also included in the list of available PLMNs;\n-\tIf the list of available PLMNs does not include a PLMN that is also included in a PLMN Selector list, the UE stops the procedure and may attempt to connect via untrusted non-3GPP access.\nc.\tIn the example shown in Figure 6.3.12.1-1, the UE may select PLMN-c, for which \"S2a connectivity\" and \"5G connectivity\" is supported.\nStep 3:\tThe UE selects the type of trusted connectivity (\"S2a connectivity\" or \"5G connectivity\") for connecting to the selected PLMN, as follows:\na.\tIf the list of available PLMNs indicates that both \"S2a connectivity\" and \"5G connectivity\" is supported for the selected PLMN, then the UE shall select \"5G connectivity\" because it is the preferred type of trusted access.\nb.\tOtherwise, if the list of available PLMNs indicates that only one type of trusted connectivity (either \"S2a connectivity\" or \"5G connectivity\") is supported for the selected PLMN, the UE selects this type of trusted connectivity.\nc.\tIn the example shown in Figure 6.3.12.1-1, the UE may select PLMN-c and \"5G connectivity\". There are two non-3GPP access networks that support \"5G connectivity\" to PLMN-c: the WLAN access network 2 and the WLAN access network 4.\nStep 4:\tFinally, the UE selects a non-3GPP access network to connect to, as follows:\na.\tThe UE puts the available non-3GPP access networks in priority order. For WLAN access, the UE constructs a prioritized list of WLAN access networks by using the WLANSP rules (if provided) and the procedure specified in clause 6.6.1.3 of TS 23.503 [45]. When the UE supports the selection of Trusted access supporting the network slices it desires to use and has received extended WLANSP rule as specified in clause 6.6.1.1 of TS 23.503 [45], the UE selects the non-3GPP access network with the SSID(s) which can access to the TNGF supporting the S-NSSAI needed by the UE. If the UE is not provided with WLANSP rules, the UE constructs the prioritized list of WLAN access networks by using an implementation specific procedure. For other types of non-3GPP access, the UE may use access specific information to construct this prioritized list.\nb.\tFrom the prioritized list of non-3GPP access networks, the UE selects the highest priority non-3GPP access network that supports the selected type of trusted connectivity to the selected PLMN.\nc.\tIn the example shown in Figure 6.3.12.1-1, the UE selects either the WLAN access network 2 or the WLAN access network 4, whichever has the highest priority in the prioritized list of non-3GPP access networks.\nd.\tOver the selected non-3GPP access network, the UE starts the 5GC registration procedure specified in clause 4.12a.2.2 of TS 23.502 [3].\ne.\tIf the AMF detects the UE is using a wrong TNGF, the AMF may trigger a UE policy update and reject the UE registration\nDuring the registration procedure the AMF may determine if the TNGF selected by the UE is suitable for the S-NSSAI(s) requested by the UE considering the UE subscription. If the AMF determines that a different TNGF should be selected as described in clause 4.12a.2.2 of TS 23.502 [3], the AMF:\n-\tmay, if the UE supports slice-based TNGF selection, triggers the UE Policy Association Establishment or UE Policy Association Update procedure to provide the UE with updated TNGF selection information as described in clause 6.15.2.1; when the AMF is informed by the PCF that the update of UE policy information on the UE is completed as described in clause 4.12a.2.2 of TS 23.502 [3], the AMF releases UE Policy Association if the UE is not registered over 3GPP access before proceeding to the Registration Reject over trusted non-3GPP access;\nNOTE 1:\tTo enable the V-PCF to provide the UE with Slice-specific TNGF selection information in the roaming case, the AMF provides the V-PCF with the Configured NSSAI for the serving PLMN during the UE Policy Association Establishment/Update procedure.\n-\tshall send a Registration Reject message to the UE. The AMF may include target TNAN information (SSID, TNGF ID) in the Registration Reject so that the UE can, if supported by the UE, use the target TNAN information to try again to register to 5GC if the UE wishes to send the same Requested NSSAI as during the previous Registration Request. The target TNAN information only applies to the one TNAN selection performed by the UE just after receiving the Registration Reject.\nThe AMF may determine the target TNAN based on the list of supported TAs and the corresponding list of supported slices for each TA obtained as defined in clause 5.15.8, and considering UE location.\nNOTE 2:\tThe operator is assumed to ensure that UEs that do not support slice-based TNGF selection always select a TNGF that supports at least one slice requested by the UE. This is to avoid unnecessary and potentially repetitive rejections of those UEs. To ensure this, the operator is assumed to provide identifiers of TNGFs that only support a subset of the slices configured in the network only to UEs that support slice-based TNGF selection.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.12a\tAccess Network selection for devices that do not support 5GC NAS over WLAN",
                            "text_content": "As specified in clause 4.2.8.5, devices that do not support 5GC NAS signalling over WLAN access (referred to as \"Non-5G-Capable over WLAN\" devices, or N5CW devices for short), may access 5GC in a PLMN or an SNPN via a trusted WLAN access network that supports a TWIF function. The following clause specifies (a) how a N5CW device selects a PLMN and (b) how it selects a trusted WLAN access network that can provide \"5G connectivity-without-NAS\" to the selected PLMN. This selection procedure is called access network selection.\nNOTE:\tFor N5CW device accessing an SNPN refer to clause 5.30.2.15.\nEach WLAN access network that provides \"5G connectivity-without-NAS\" advertises with ANQP a list of PLMNs with which \"5G connectivity-without-NAS\" is supported. This list is called PLMN List-4, and is different from the PLMN List-1, PLMN List-2 and PLMN List-3 defined in clause 6.3.12. A WLAN advertises the PLMN List-4, when the WLAN supports a TWIF function.\nThe steps executed by a N5CW device for access network selection are specified below and are very similar with the corresponding steps executed by a UE that supports NAS; see clause 6.3.12.2.\nStep 1:\tThe N5CW device constructs a list of available PLMNs. This list contains the PLMNs included in the PLMN List-4 advertised by all discovered WLAN access networks.\na.\tThe N5CW device discovers the PLMN List-4 advertised by all discovered WLAN access networks by sending an ANQP query to each discovered WLAN access network. The ANQP query shall request \"3GPP Cellular Network\" information. If a WLAN access network supports interworking with one or more PLMNs, the ANQP response received by the N5CW device includes a \"3GPP Cellular Network\" information element containing one or more of the following lists: PLMN List-1, PLMN List-2, PLMN List-3 and PLMN List-4. The PLMN List-1, PLMN List-2 and PLMN List-3 are defined in clause 6.3.12. The PLMN List-4 includes the PLMNs with which \"5G connectivity-without-NAS\" is supported.\nStep 2:\tThe N5CW device selects a PLMN that is included in the list of available PLMNs as follows.\na.\tIf the N5CW device is connected to a PLMN via 3GPP access and this PLMN is included in the list of available PLMNs, then the N5CW device selects this PLMN.\nb.\tOtherwise (the N5CW device is not connected to a PLMN via 3GPP access, or the N5CW device is connected to a PLMN via 3GPP access but this PLMN is not in the list of available PLMNs):\ni)\tIf the N5CW device determines to be located in its home country, then:\n-\tThe N5CW device selects the HPLMN if the N5CW device has a USIM or is pre-configured with an HPLMN, if the HPLMN is included in the list of available PLMNs. Otherwise, the N5CW device selects an E-HPLMN (Equivalent HPLMN), if an E-HPLMN is included in the list of available PLMNs. If the list of available PLMNs does not include the HPLMN and does not include an E-HPLMN, the N5CW device stops the access network selection procedure.\nii)\tIf the N5CW device determines to be located in its visited country, then:\n-\tThe N5CW device determines if it is mandatory to select a PLMN in the visited country, as follows:\n-\tIf the N5CW device has IP connectivity (e.g. it is connected via 3GPP access), the N5CW device sends a DNS query and receives a DNS response that indicates if a PLMN must be selected in the visited country. The DNS response includes a lifetime that denotes how long the DNS response can be cached.\n-\tIf the N5CW device has no IP connectivity (e.g. it is not connected via 3GPP access), then the N5CW device may use a cached DNS response that was received in the past, or may use local configuration that indicates which visited countries mandate a PLMN selection in the visited country.\n-\tIf the N5CW device determines that it is not mandatory to select a PLMN in the visited country, and the HPLMN or an E-HPLMN is included in the list of available PLMNs, then the N5CW device selects the HPLMN or an E-HPLMN, whichever is included in the list of available PLMNs.\n-\tOtherwise, the N5CW device selects a PLMN in the visited country as follows:\n-\tIf the N5CW device has a USIM, the UE selects a PLMN in the visited country by considering, in priority order, the PLMNs, first, in the User Controlled PLMN Selector list and, next, in the Operator Controlled PLMN Selector list (see TS 23.122 [17]).\n-\tIf the N5CW device does not have a USIM, the N5CW device selects the highest priority PLMN in a pre-configured list, which is also included in the list of available PLMNs.\n-\tIf the list of available PLMNs does not include a PLMN that is also included in the pre-configured list(s), the N5CW device either stops the access network selection procedure, or may select a PLMN based on its own implementation.\nStep 3:\tFinally, the N5CW device selects a WLAN access network (e.g. an SSID) to connect to, following the procedure specified in clause 6.6.1.3 of TS 23.503 [45], \"UE procedure for selecting a WLAN access based on WLANSP rules\", or any other implementation specific means.\nAfter the N5CW device completes the above access network selection procedure, the N5CW device initiates the \"Initial Registration and PDU Session Establishment\" procedure specified in clause 4.12b.2 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.12b\tAccess Network selection for 5G NSWO",
                            "text_content": "In addition to the PLMN lists specified in clause 6.3.12 and in clause 6.3.12a, a WLAN access network may also advertise the following PLMN list:\n-\tA PLMN List-5, which includes candidate PLMNs with which \"AAA connectivity to 5GC\" is supported. A WLAN access network supports \"AAA connectivity to 5GC\" in a candidate PLMN when it deploys an AAA function that can connect with a NSWOF in this PLMN or can connect with a NSWOF in another PLMN (i.e. HPLMN in roaming case) via AAA proxy. The NSWOF supports \"WLAN connection using 5G credentials without 5GS registration\", as defined in clause 4.2.15.\nIf the UE selects a PLMN that is neither UE's HPLMN nor EHPLMN through which the NSWO request should be sent towards the HPLMN, the UE shall use the decorated NAI format as specified in clause 4.2.15 and in TS 23.003 [19].\nFor access to SNPN or CH , a WLAN access network may also advertise the following SNPN list:\n-\tA SNPN List-5, which includes SNPNs with which \"AAA connectivity to 5GC\" is supported. The SNPNs are the candidate serving SNPNs that the WLAN access network can connect with. A WLAN access network supports \"AAA connectivity to 5GC\" in a SNPN when it deploys an AAA function that can connect with a NSWOF in this SNPN or can connect with a NSWOF or AAA server in a CH via AAA Proxy. The SNPN or CH supports \"WLAN connection using 5G credentials without 5GS registration\", as defined in clause 4.2.15.\nNOTE:\tThe selected SNPN within the SNPN List-5 is interpreted as serving SNPN when the SNPN does not correspond to UE's subscribed SNPN.\nWhen the UE wants to connect to a WLAN access network using the 5G NSWO procedure defined in TS 33.501 [29], Annex S, the UE may retrieve the PLMN List-5 or SNPN List-5 advertised by each discovered WLAN access network and may consider this list for selecting the WLAN access network to connect to. For example, if the UE identifies that the HPLMN or CH is included in the PLMN List-5 or SNPN List-5 advertised by a WLAN access network, the UE may select this WLAN access network to connect to using the 5G NSWO procedure.\nWhen the UE is configured by HPLMN or CH to use 5G NSWO for connecting to WLAN access networks using its 5G credentials (as defined in TS 33.501 [29]), the UE shall attempt to select a WLAN that supports 5G NSWO and shall only use the 5G NSWO procedure for connecting to the selected WLAN.\nA WLAN access network may also advertise a list of SNPNs which includes SNPNs with which \"AAA connectivity to 5GC\" is supported. A WLAN access network supports \"AAA connectivity to 5GC\" in an SNPN when it deploys an AAA function that can connect with a SNPN or CH using any of the architectures defined in clause 4.2.15. When the UE operating in SNPN access mode wants to connect to a WLAN access network using the 5G NSWO procedure defined in Annex S of TS 33.501 [29], the UE may retrieve the SNPNs with which \"AAA connectivity to 5GC\" is supported that are advertised by each discovered WLAN access network and may consider this information for selecting the WLAN access network to which it attempts to connect.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.13\tNWDAF discovery and selection",
                            "text_content": "Multiple instances of NWDAF may be deployed in a network.\nThe NF consumers shall utilize the NRF to discover NWDAF instance(s) unless NWDAF information is available by other means, e.g. locally configured on NF consumers. NF consumers may make an additional query to UDM, when supported, as detailed below. The NWDAF selection function in NF consumers selects an NWDAF instance based on the available NWDAF instances.\nThe NRF may return one or more candidate NWDAF instance(s) and each candidate NWDAF instance (based on its registered profile) supports the Analytics ID with a time that is less than or equal to the Supported Analytics Delay.\nThe following factors may be considered by the NF consumer for NWDAF selection:\n-\tS-NSSAI.\n-\tAnalytics ID(s).\n-\tSupported service(s), possibly with their associated Analytics IDs.\n-\tNWDAF Serving Area information, i.e. list of TAIs, for which the NWDAF can provide analytics, train ML models and provide trained ML models and/or data; for each item of this list, a weight may be defined in the NWDAF NF profile to indicate the priority of the NWDAF to cover the TA.\nNOTE 1:\tIf all services provided by one NWDAF do not support the same Analytics ID, the NWDAF registers the Analytics IDs of the services at the service level.\nNOTE 2:\tAnalytics ID(s) at service level take precedence over Analytics ID(s) at NF level.\nNOTE 3:\tFor discovery of NWDAF supporting Nnwdaf_AnalyticsSubscription or Nnwdaf_AnalyticsInfo services, the Analytics IDs at the NWDAF NF profile are used.\n-\t(only when DCCF is hosted by NWDAF):\n-\tNF type of the data source.\n-\tNF Set ID of the data source.\nNOTE 4:\tCan be used when the NWDAF determines that it needs to discover another NWDAF which is responsible for co-ordinating the collection of required data. The NWDAF does a new discovery for a target NWDAF via NRF using NF Set ID of the data source.\nNOTE 5:\tFor discovery of NWDAF supporting Nnwdaf_DataManagement service, at least the NWDAF Serving Area information from the NWDAF profile are used.\nNOTE 6:\tThe presence of NF type of data source or NF set ID of the data source denotes that the NWDAF can collect data from such NF Sets or NF Types.\n-\tSupported Analytics Delay of the requested Analytics ID(s) (see clause 6.2.6.2).\nIn the case of multiple instances of NWDAFs deployment, following factors may also be considered:\n-\tNWDAF Capabilities:\n-\tAnalytics aggregation capability.\n-\tAnalytics metadata provisioning capability.\n-\tAccuracy checking capability.\nApplicable when NF consumer cannot determine a suitable NWDAF instance based on NRF discovery response, and when NWDAF registration in UDM is supported, as defined in clause 5.2 of TS 23.288 [86]: NF consumers may query UDM (Nudm_UECM_Get service operation) for determining the ID of the NWDAF serving the UE. The following factors may be considered by NF consumers to select an NWDAF instance already serving a UE for an Analytics ID:\n-\tSUPI.\n-\tAnalytics ID(s).\nWhen selecting an NWDAF for ML model provisioning, the following additional factors may be considered by the NWDAF:\n-\tThe ML model Filter information parameters S-NSSAI(s) and Area(s) of Interest (see clause 5.2, TS 23.288 [86]) for the trained ML model(s) per Analytics ID(s) and ML Model Interoperability indicator per Analytics ID, if available.\nWhen selecting an NWDAF that supports Federated Learning, the following additional factors may be considered by the NWDAF:\n-\tTime Period of Interest: time interval [start…end], during which the Federated Learning will be performed.\n-\twhen selecting FL client NWDAF:\n-\tFL capability type as FL client NWDAF per Analytics ID.\n-\tNF type(s) of the data source(s) where data can be collected as input for local model training.\n-\tNF Set ID(s) of the data source(s) where data can be collected as input for local model training.\n-\tML Model Interoperability indicator.\n-\twhen selecting FL server NWDAF:\n-\tFL capability type as FL server NWDAF per Analytics ID.\n-\tThe ML model Filter information parameters S-NSSAI(s) and Area(s) of Interest (see clause 5.2 of TS 23.288 [86]) for the trained ML model(s) per Analytics ID(s), if available.\nWhen selecting a NWDAF for roaming case, the detailed mechanism is defined in clause 5.2 of TS 23.288 [86].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.14\tNEF Discovery",
                            "text_content": "The NF consumers may utilize the NRF to discover NEF instance(s) unless NEF information is available by other means, e.g. locally configured in NF consumers. The NRF provides NF profile(s) of NEF instance(s) to the NF consumers.\nThe IP address(es)/port(s) of the NEF or L-NEF may be locally configured in the AF, or the AF may discover the FQDN or IP address(es)/port(s) of the NEF/L-NEF by performing a DNS query using the External Identifier of an individual UE or using the External Group Identifier of a group of UEs or using EDNS Client Subnet, or, if the AF is trusted by the operator, the AF may utilize the NRF to discover the FQDN or IP address(es)/port(s) of the NEF or L-NEF.\nNOTE 1:\tWhen the AF discovers the FQDN or IP address(es)/port(s) of the NEF/L-NEF by performing a DNS query, the AF can add in its DNS request an EDNS Client Subnet option in order to help the DNS determine a local NEF directly. The use of a DNS query for the selection of a L-NEF is only supported for AF and not internal network functions.\nNOTE 2:\tThe EDNS Client Subnet may be derived by the AF based on factors that are considered for NEF selection. Whether and which factors are considered for NEF/L-NEF selection may depend on whether the AF performs an initial NEF discovery or a NEF discovery due to L-PSA relocation.\nNOTE 3:\tThe NEF discovery and selection procedures described in this clause are intended to be applied by NF consumers deployed within the operator's domain.\nNOTE 4:\tThe NEF supporting the capabilities can be configured in the AF or discovered by AF with the assistance of NRF.\nThe following factors may be considered for NEF selection:\n-\tS-NSSAI(s);\n-\tS-NSSAI and DNN corresponding to an untrusted AF;\n-\tEvent ID(s) supported by an AF (see clause 6.2.6, clause 6.2.2.3 of TS 23.288 [86] and clause 5.2.19 of TS 23.502 [3]);\n-\tAF Instance ID, Application Identifier;\n-\tExternal Identifier, External Group Identifier, or domain name;\n-\tA request for local NEF selection;\n-\tLocation (see locality in clause 6.1.6.2.2 of TS 29.510 [58]);\n-\t(for local NEF selection) List of supported TAI;\n-\t(for local NEF selection) List of supported DNAI;\n-\tCapability of NEF to support UAS NF functionality for UUAA procedures;\n-\tCapability of NEF to support Multi-member AF session with required QoS for a set of UEs identified by a list of UE addresses;\n-\tCapability of NEF to support member UE selection assistance functionality.\nLocal NEF instance(s) can be deployed close to UE access. For local NEF selection, the location of the local NEF instance (e.g. geographical location, data centre) may be used in conjunction with the location of L-PSA UPF or AF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.15\tUCMF Discovery and Selection",
                            "text_content": "The AMF, MME, NEF, AF, SCEF, SCS/AS may utilize the NRF to discover UCMF instance(s) unless UCMF information is available by other means, e.g. locally configured in UCMF services consumers.\nIn the case of delegated discovery and selection in SCP, the NF consumer shall forward the request towards SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.16\tSCP discovery and selection",
                            "text_content": "An NF is configured with its serving SCP(s).\nIn a deployment where several SCPs are deployed, a message may traverse several SCP instances until reaching its final destination. A SCP may discover and select a next hop SCP by querying the Nnrf_NFDiscovery Service of the NRF or it may be configured with next SCP in the message path.\nAn SCP may use the SCP profile parameters in clause 6.2.6.3 as discovery parameters in Nnrf_NFDiscovery. The parameter(s) to be used depend(s) on network deployment. The NRF returns a list SCP Profiles as per the provided discovery parameters.\nIf an SCP receives a Routing Binding Indication within a service or notification request and decides to forward that request to a next-hop SCP, it shall include the Routing Binding Indication in the forwarded request.\nNOTE:\tIt is up to SCP implementation, deployment specific configuration and operator policies as to how the SCP will use information retrieved from the NRF to resolve the optimal route to a producer.\nBased on SCP configuration, an SCP deciding to address a next-hop SCP for a service request may then delegate the NF (instance) and/or service (instance) selection to subsequent SCPs and provide discovery and selection parameters to the next-hop SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.17\tNSSAAF discovery and selection",
                            "text_content": "In the case of NF consumer based discovery and selection, the following applies:\n-\tThe NF consumer (e.g. AMF, AUSF) performs NSSAAF selection to select an NSSAAF Instance that supports authentication between the UE and the AAA-S associated with the HPLMN or in the Credentials Holder in the case of SNPN or in the DCS domain in the case of ON-SNPN. The NF consumer shall utilize the NRF to discover the NSSAAF instance(s) unless NSSAAF information is available by other means, e.g. locally configured on the NF consumer. The NSSAAF selection function in the NF consumer selects an NSSAAF instance based on the available NSSAAF instances (obtained from the NRF or locally configured in the NF consumer).\nIn the case of SNPN, NSSAAF selection is only applicable to 3GPP access. Otherwise, NSSAAF selection is applicable to both 3GPP access and non-3GPP access.\nThe NSSAAF selection function in NSSAAF NF consumers or in SCP should consider the following factor when it is available:\n1.\tHome Network Identifier (e.g. MNC and MCC, realm) of SUPI (by an NF consumer in the Serving network).\n2.\tS-NSSAI of the HPLMN.\n3.\tSUPI or Internal Group ID; the NSSAAF NF consumer selects a NSSAAF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI or Internal Group ID as input for NSSAAF discovery.\nAn HPLMN deploying NSSAAF instances supporting specific S-NSSAIs and/or sets of SUPIs (according to factors 2-3) shall also deploy NSSAAF instance(s) that can be selected using factor 1 if they need to interoperate with VPLMNs using only factor 1 for NSSAAF selection.\nIn the case of delegated discovery and selection in SCP, the NSSAAF NF consumer shall send all available factors to the SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.18\t5G-EIR discovery and selection",
                            "text_content": "A consumer NF of the 5G-EIR performs discovery of 5G-EIR using either configuration or NRF as specified in clause 6.3.1. The network is configured with the 5G-EIR to serve the PLMN of the NF consumer requesting the 5G-EIR service, i.e. no roaming interface is defined.\nThe 5G-EIR selection function in NF consumers is independent of Access Type.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.19\tDCCF discovery and selection",
                            "text_content": "Multiple instances of DCCF may be deployed in a network.\nThe NF consumers shall utilize the NRF to discover DCCF instance(s) unless DCCF information is available by other means, e.g. locally configured on NF consumers. The DCCF selection function in NF consumers selects a DCCF instance based on the available DCCF instances.\nThe following factors may be considered by the NF consumer for DCCF selection:\n-\tDCCF Serving Area information, i.e. list of TAIs for which the DCCF coordinates Data Sources.\n-\tS-NSSAI.\n-\tNF type of the data source.\n-\tNF Set ID of the data source.\nNOTE:\tNF Set ID can be used when the NF consumer is a DCCF when the DCCF determines that it needs to discover another DCCF which is responsible for co-ordinating the collection of required data. The DCCF discovers a target DCCF via NRF using NF Set ID of the data source.\n-\tDCCF relocation capability: Support for relocating the data collection subscription among DCCFs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.20\tADRF discovery and selection",
                            "text_content": "Multiple instances of ADRF may be deployed in a network.\nThe NF consumers shall utilize the NRF to discover ADRF instance(s) unless ADRF information is available by other means, e.g. locally configured on NF consumers. The ADRF selection function in NF consumers selects an ADRF instance based on the available ADRF instances.\nNOTE:\tWhen NF consumer is DCCF, the DCCF can have information available already from previous registrations of ADRFs. In this case, NRF discovery is not needed.\nThe following factors may be considered by the NF consumer for ADRF selection:\n-\tS-NSSAI.\n-\tML model storage capability.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.21\tMFAF discovery and selection",
                            "text_content": "Multiple instances of MFAF may be deployed in a network.\nThe MFAF selection function is supported by the DCCF. The DCCF shall utilize the NRF to discover MFAF instance(s) unless MFAF information is available by other means, e.g. locally configured on the DCCF. The MFAF selection function in the DCCF selects a MFAF instance based on the available MFAF instances.\nThe following factors may be considered by the DCCF for MFAF selection:\n-\tS-NSSAI;\n-\tNF Types of the Data Sources handled by the MFAF;\n-\tNF Set IDs of the Data Sources handled by the MFAF;\n-\tMFAF Serving Area information, i.e. list of TAIs for which the MFAF may receive data from Data Sources.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.22\tNSACF discovery and selection",
                            "text_content": "The NF consumers shall utilise the NRF to discover NSACF instance(s), including the NSACF acting as Primary NSACF role, unless NSACF information is available by other means, e.g. locally configured in NF consumers.\nThe NSACF selection function in the NSACF NF consumer selects an NSACF instance based on the available NSACF instances, which are obtained from the NRF or locally configured in the NSACF NF consumer.\nThe following factors may be considered by the NF consumer for NSACF discovery and selection:\n-\tS-NSSAI(s).\n-\tNSAC Service Area Identifier, or a reserved value \"Entire PLMN\" for discovering the NSACF acting as Primary NSACF or centralized NSAC role. The NSAC Service Area Identifier is configured at the consumer NF and NSACF (see clause 5.15.11.0). Each Service Area Identifier is a unique and unambiguous identifier and a NSACF registers with the NRF the NSAC Service Area Identifier(s) of the NSAC Service Area(s) it serves. \"Entire PLMN\" is indicated in roaming case to the NRF of HPLMN by the VPLMN NF consumer when the VPLMN NF consumer needs to discover the HPLMN NSACF, or in non roaming case to select a Primary NSACF.\n-\tNSACF service capabilities:\n-\tSupport monitoring and controlling the number of registered UEs per network slice for the network slice that is subject to NSAC.\n-\tSupport, for network slices that are subject to NSAC and configured to support EPS counting, monitoring and controlling the number of registered UEs with at least one PDU session per network slice, as defined in clause 5.15.11.5a.\n-\tSupport monitoring and controlling the number of established PDU Sessions per network slice for the network slice that is subject to NSAC.\n-\tPLMN ID information in the case of roaming to contact the HPLMN NSACF for inbound roamers.\nIn the case of delegated discovery and selection in SCP, the NSACF NF consumer shall send all available and applicable factors to the SCP.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.23\tEASDF discovery and selection",
                            "text_content": "Multiple instances of EASDF may be deployed in a network. NF consumers mentioned in this clause are SMF(s).\nThe NF consumers shall utilize the NRF to discover EASDF instance(s) unless EASDF information is available by other means, e.g. locally configured on the NF consumer. The EASDF selection function in NF consumers or SCP selects an EASDF instance based on the available EASDF instances.\nThe following factors may be considered by the NF consumer or SCP for EASDF selection:\n-\tS-NSSAI.\n-\tDNN.\n-\tthe N6 IP address of the EASDF.\nNOTE:\tThe IP address of the EASDF is not used for EASDF discovery. It can be used is to select an EASDF that is \"IP near\" to the PSA of the PDU Session.\n-\tThe N6 IP address of the PSA UPF.\n-\tLocation as per NF profile.\n-\tDNAI (if exist).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.24\tTSCTSF Discovery",
                            "text_content": "The NFs (e.g. NEF, AF and PCF) may utilize the NRF to discover TSCTSF instance(s) unless TSCTSF information is available by other means, e.g. locally configured in the requested NF.\nThe following factors may be considered for TSCTSF discovery and selection:\n-\tDNN and S-NSSAI. When the NF discovers the TSCTSF for a DNN/S-NSSAI, the NRF provides the NF with NF profile(s) of TSCTSF instance(s) belonging to single TSCTSF Set for a given DNN/S-NSSAI. For example, the same TSCTSF Set shall be selected by the PCF serving PDU Sessions for this DNN and S-NSSAI to notify the TSCTSF for a PDU Session that is potentially impacted by the (g)PTP time synchronization service.\n-\tGPSI or External Group Identifier. TSCTSF NF consumers (which manage network signalling not based on SUPI/SUCI (e.g. the NEF)) select a TSCTSF instance based on the GPSI or External Group ID range the UE's GPSI or External Group ID belongs to or based on the results of a discovery procedure with NRF using the UE's GPSI or External Group ID as input for TSCTSF discovery.\n-\tSUPI or Internal Group ID. TSCTSF NF consumers select a TSCTSF instance based on the SUPI range the UE's SUPI belongs to or based on the results of a discovery procedure with NRF using the UE's SUPI or Internal Group ID as input for TSCTSF discovery.\nIf the TSCTSF is locally configured in NFs, it shall be ensured that the same TSCTSF Set is configured in all NFs (e.g. NEF, AF and PCF) for the given DNN and S-NSSAI.\nNOTE:\tThus, it is assumed that there is only one TSCTSF Set for a given DNN/S-NSSAI in this Release of the specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.25\tAF Discovery and Selection",
                            "text_content": "The NF consumers (e.g. NWDAF) may utilize the NRF to discover AF instance(s) in the MNO domain, i.e. trusted AF(s), unless AF information is available by other means, e.g. locally configured in NF consumers. The NRF provides NF profile(s) of AF instance(s) to the NF consumers.\nThe following factors may be considered for AF discovery and selection:\n-\tOne or multiple combination(s) of the S-NSSAI and DNN corresponding to an AF.\n-\tSupported Application Id(s).\n-\tEvent ID(s) Supported by an AF.\n-\tInternal-Group Identifier.\nThe NF consumer (e.g. NWDAF) may select an AF instance, in the MNO domain, considering one or multiple combination(s) of the S-NSSAI and DNN corresponding to an AF and the EventID(s) supported by an AF to provide the input data required for generation of analytics. The NF consumer (e.g. NWDAF) may consider the supported Application Id(s), if the input data is required only for those applications. The NF consumer (e.g. NWDAF) may consider the Internal-Group Identifier supported by the AF if the input data is required for a particular group of UEs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.26\tNRF discovery and selection",
                            "text_content": "The following mechanisms may be used for discovery of NRF service instances and their endpoint addresses:\n-\tNF consumers or SCP may have all the NRF services instances and their endpoint addresses locally configured.\n-\tNF consumers or SCP may have the endpoint address of a NRF discovery service locally configured and utilize it to discover the NRF(s) and get the NF profile(s) of the NRF(s).\n-\tNF consumers (e.g. v-NRF) or SCP may have endpoint addresses of the NRF bootstrapping service and utilize it to discover the NRF service instances and their endpoint addresses. The NRF bootstrapping service is a version independent API, which may be especially useful over roaming interfaces.\n-\tThe NF consumer, e.g. AMF, may use the Nnssf_NSSelection service to get the endpoint address of a NRF discovery service for a certain slice.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tNetwork Function Services and descriptions",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tNetwork Function Service Framework",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.1.1\tGeneral",
                            "text_content": "Service Framework functionalities include e.g. service registration/de-registration, consumer authorization, service discovery, and inter service communication, which include selection and message passing. Four communication options are listed in Annex E and can all co-exist within one and the same network.\nAn NF service is one type of capability exposed by an NF (NF Service Producer) to other authorized NF (NF Service Consumer) through a service-based interface. A Network Function may expose one or more NF services. Following are criteria for specifying NF services:\n-\tNF services are derived from the system procedures that describe end-to-end functionality, where applicable (see TS 23.502 [3], Annex B drafting rules). Services may also be defined based on information flows from other 3GPP specifications.\n-\tSystem procedures can be described by a sequence of NF service invocations.\nNF services may communicate directly between NF Service consumers and NF Service Producers, or indirectly via an SCP. Direct and Indirect Communication are illustrated in Figure 7.1.1-1. For more information, see Annex E and clauses 6.3.1 and 7.1.2. Whether a NF Service Consumer (e.g. in the case of requests or subscriptions) or NF Service Producer (e.g. in the case of notifications) uses Direct Communication or Indirect Communication by using an SCP is based on the local configuration of the NF Service Consumer/NF Service Producer. An NF may not use SCP for all its communication based on the local configuration.\nNOTE:\tThe SCP can be deployed in a distributed manner.\nIn Direct Communication, the NF Service consumer performs discovery of the target NF Service producer by local configuration or via NRF. The NF Service consumer communicates with the target NF Service producer directly.\nIn Indirect Communication, the NF Service consumer communicates with the target NF Service producer via a SCP. The NF Service consumer may be configured to perform discovery of the target NF Service producer directly, or delegate the discovery of the target NF Service Producer to the SCP used for Indirect Communication. In the latter case, the SCP uses the parameters provided by NF Service consumer to perform discovery and/or selection of the target NF Service producer. The SCP address may be locally configured in NF Service consumer.\nThe figure depicts a network service intercommunication, showing the NF/NF service intercommunication. It illustrates the various communication paths and the interconnection between NF/NF services.\nFigure 7.1.1-1: NF/NF service inter communication\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.2\tNF Service Consumer - NF Service Producer interactions",
                            "text_content": "The end-to-end interaction between two Network Functions (Consumer and Producer) within this NF service framework follows two mechanisms, irrespective of whether Direct Communication or Indirect Communication is used:\n-\t\"Request-response\": A Control Plane NF_B (NF Service Producer) is requested by another Control Plane NF_A (NF Service Consumer) to provide a certain NF service, which either performs an action or provides information or both. NF_B provides an NF service based on the request by NF_A. In order to fulfil the request, NF_B may in turn consume NF services from other NFs. In Request-response mechanism, communication is one to one between two NFs (consumer and producer) and a one-time response from the producer to a request from the consumer is expected within a certain timeframe. The NF Service Producer may also add a Binding Indication (see clause 6.3.1.0) in the Response, which may be used by the NF Service Consumer to select suitable NF service producer instance(s) for subsequent requests. For indirect communication, the NF Service Consumer copies the Binding Indication into the Routing Binding indication, that is included in subsequent requests, to be used by the SCP to discover a suitable NF service producer instance(s).\nThe figure depicts a simplified representation of a \"Request-response\" NF Service, illustrating the flow of data between the sender and receiver. The sender sends a request to the NF Service, which then responds with a response. The figure includes various components such as the sender, receiver, and NF Service, as well as the request and response messages. The NF Service is depicted as a series of nodes connected by lines, representing the network topology. The figure is useful for understanding the structure and flow of NF Service requests and responses.\nFigure 7.1.2-1: \"Request-response\" NF Service illustration\n-\t\"Subscribe-Notify\": A Control Plane NF_A (NF Service Consumer) subscribes to NF Service offered by another Control Plane NF_B (NF Service Producer). Multiple Control Plane NFs may subscribe to the same Control Plane NF Service. NF_B notifies the results of this NF service to the interested NF(s) that subscribed to this NF service. The subscription request shall include the notification endpoint, i.e. a Notification Target Address and a Notification Correlation ID (e.g. the callback URL) of the NF Service Consumer to which the event notification from the NF Service Producer should be sent to.\nNOTE 1:\tThe notification endpoint can be a URL and contains both the Notification Target Address and the Notification Correlation ID.\nThe NF Service Consumer may add a Binding Indication (see clause 6.3.1.0) in the subscribe request, which may be used by the NF Service Producer to discover a suitable notification endpoint. For indirect communication, the NF Service Producer copies the Binding Indication into the Routing Binding Indication, that is included in the response, to be used by the SCP to discover a suitable notification target. The NF Service Producer may also add a Binding Indication (see clause 6.3.1.0) in the subscribe response, which may be used by the NF Service Consumer (or SCP) to select suitable NF service producer instance(s) or NF producer service instance. In addition, the subscription request may include notification request for periodic updates or notification triggered through certain events (e.g. the information requested gets changed, reaches certain threshold etc.). The subscription for notification can be done through one of the following ways:\n-\tExplicit subscription: A separate request/response exchange between the NF Service Consumer and the NF Service Producer; or\n-\tImplicit subscription: The subscription for notification is included as part of another NF service operation of the same NF Service; or\n-\tDefault notification endpoint: Registration of a notification endpoint for each type of notification the NF consumer is interested to receive, as a NF service parameter with the NRF during the NF and NF service Registration procedure as specified in clause 4.17.1 of TS 23.502 [3].\nThe NF Service Consumer may also add a Binding Indication (see clause 6.3.1.0) in the response to the notification request, which may be used by the NF Service Producer to discover a suitable notification endpoint. For indirect communication, the NF Service Producer copies the Binding Indication into the Routing Binding indication that is included in subsequent notification requests. The binding indication is then used by the SCP to discover a suitable notification target.\nThe figure depicts a simplified illustration of a \"Subscribe-Notify\" NF Service, which is a key component of NFV (Network Function Virtualization) in the telecommunications industry. The illustration shows a network service provider (NSP) subscribing to a service from a network service provider (NSP) and then notifying the NSP about the subscription. The figure includes various elements such as the subscriber, the service provider, the network, and the subscriber's network. The illustration is a simplified representation, and the actual implementation may vary depending on the specific NFV architecture and the specific service being subscribed to.\nFigure 7.1.2-2: \"Subscribe-Notify\" NF Service illustration 1\nA Control Plane NF_A may also subscribe to NF Service offered by Control Plane NF_B on behalf of Control Plane NF_C, i.e. it requests the NF Service Producer to send the event notification to another consumer(s). In this case, NF_A includes the notification endpoint, i.e. Notification Target Address) and a Notification Correlation ID, of the NF_C in the subscription request. NF_A may also additionally include the notification endpoint and a Notification Correlation ID of NF A associated with subscription change related Event ID(s), e.g. Subscription Correlation ID Change, in the subscription request, so that NF_A can receive the notification of the subscription change related event. The NF_A may add Binding Indication (see clause 6.3.1.0) in the subscribe request.\nThe figure depicts a simplified illustration of a \"Subscribe-Notify\" NF Service, which is a key component of NFV (Network Function Virtualization) in the telecommunications industry. The figure shows the subscriber (subscriber) and the service provider (service provider) involved in the service, with the subscriber subscribing to the service and the service provider providing the necessary information to the subscriber. The figure is a simplified representation, and the actual implementation may vary depending on the specific NFV architecture and the requirements of the service provider.\nFigure 7.1.2-3: \"Subscribe-Notify\" NF Service illustration 2\nRouting of the messages for the NF interaction mechanisms above may be direct, as shown in the figures 7.1.2-1 to 7.1.2-3, or indirect. In the case of Indirect Communication, an SCP is employed by the NF service consumer. The SCP routes messages between NF service consumers and NF service producers based on the Routing Binding Indication if available, and may do discovery and associated selection of the NF service producer on behalf of a NF service consumer. Figure 7.1.2-4 shows the principle for a request-response interaction and figure 7.1.2-5 shows an example of a subscribe-notify interaction.\nThe figure depicts a request-response communication scenario in an indirect communication network. It illustrates the use of a request message to initiate a response, with the response message being sent back to the sender. The figure shows the network structure, including the sender, receiver, and intermediate nodes. The request message is represented by a rectangular shape, while the response message is represented by a circular shape. The figure also includes a legend to help understand the different types of nodes and their functions.\nFigure 7.1.2-4: Request response using Indirect Communication\nThe figure depicts a schematic of a subscribe-notify system, illustrating the use of indirect communication to transmit data between two devices. The system uses a combination of wired and wireless communication methods, with the wireless communication being represented by a dotted line. The figure shows the steps involved in the process, including the setup of the network, the selection of the communication protocol, and the establishment of the connection. The use of a dedicated network interface card (NIC) ensures that the data is transmitted over a secure and reliable connection. The figure is a useful tool for understanding the principles of subscribe-notify systems and their implementation in a network.\nFigure 7.1.2-5: Subscribe-Notify using Indirect Communication\nNOTE:\tThe subscribe request and notify request can be routed by different SCPs.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.3\tNetwork Function Service discovery",
                            "text_content": "A Control Plane Network function (NF) within the 5G Core network may expose its capabilities as services via its service based interface, which can be re-used by Control Plane CN NFs.\nThe NF service discovery enables a CN NF or SCP to discover NF instance(s) that provide the expected NF service(s). The NF service discovery is implemented via the NF discovery functionality.\nFor more detail NF discovery refer to clause 6.3.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.4\tNetwork Function Service Authorization",
                            "text_content": "NF service authorization shall ensure the NF Service Consumer is authorized to access the NF service provided by the NF Service Provider, according to e.g. the policy of NF, the policy from the serving operator, the inter-operator agreement.\nService authorization information shall be configured as one of the components in NF profile of the NF Service Producer. It shall include the NF type (s) and NF realms/origins allowed to consume NF Service(s) of NF Service Producer.\nDue to roaming agreements and operator policies, a NF Service Consumer shall be authorised based on UE/subscriber/roaming information and NF type, the Service authorization may entail two steps:\n-\tCheck whether the NF Service Consumer is permitted to discover the requested NF Service Producer instance during the NF service discovery procedure. This is performed on a per NF granularity by NRF.\nNOTE 1:\tWhen NF discovery is performed based on local configuration, it is assumed that locally configured NFs are authorized.\n-\tCheck whether the NF Service Consumer is permitted to access the requested NF Service Producer for consuming the NF service, with a request type granularity. This is performed on a per UE, subscription or roaming agreements granularity. This type of NF Service authorization shall be embedded in the related NF service logic.\nNOTE 2:\tThe security of the connection between NF Service Consumer and NF Service Producer is specified in TS 33.501 [29].\nNOTE 3:\tIt is expected that an NF authorization framework exists in order to perform consumer NF authorization considering UE, subscription or roaming agreements granularity. This authorization is assumed to be performed without configuration of the NRF regarding UE, subscription or roaming information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.5\tNetwork Function and Network Function Service registration and de-registration",
                            "text_content": "For the NRF to properly maintain the information of available NF instances and their supported services, each NF instance informs the NRF of the list of NF services that it supports.\nNOTE:\tThe NF informs the appropriate NRF based on configuration.\nThe NF instance may make this information available to NRF when the NF instance becomes operative for the first time (registration operation) or upon individual NF service instance activation/de-activation within the NF instance (update operation) e.g. triggered after a scaling operation. The NF instance while registering the list of NF services it supports, for each NF service, may provide a notification endpoint information for each type of notification service that the NF service is prepared to consume, to the NRF during the NF instance registration. The NF instance may also update or delete the NF service related parameters (e.g. to delete the notification endpoint information). Alternatively, another authorised entity (such as an OA&M function) may inform the NRF on behalf of an NF instance triggered by an NF service instance lifecycle event (register or de-registration operation depending on instance instantiation, termination, activation, or de-activation). Registration with the NRF includes capacity and configuration information at time of instantiation.\nThe NF instance may also de-registers from the NRF when it is about to gracefully shut down or disconnect from the network in a controlled way. If an NF instance become unavailable or unreachable due to unplanned errors (e.g. NF crashes or there are network issues), an authorised entity shall de-register the NF instance with the NRF.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.2\tNetwork Function Services",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tGeneral",
                            "text_content": "In the context of this specification, an NF service is offering a capability to authorised consumers.\nNetwork Functions may offer different capabilities and thus, different NF services to distinct consumers. Each of the NF services offered by a Network Function shall be self-contained, reusable and use management schemes independently of other NF services offered by the same Network Function (e.g. for scaling, healing, etc).\nThe discovery of the NF instance and NF service instance is specified in clause 6.3.1.\nNOTE 1:\tThere can be dependencies between NF services within the same Network Function due to sharing some common resources, e.g. context data. This does not preclude that NF services offered by a single Network Function are managed independently of each other.\nThe figure depicts a network function and NF Service, illustrating the various components and their interactions within a 5G network. The network function is represented by the blue line, while the NF Service is depicted by the red line. The figure highlights the role of the base station (gNB) in providing the primary communication link, the user equipment (UE) for user-to-user communication, and the scatterers for user-to-ground communication. The figure also illustrates the use of beamforming techniques to mitigate interference and improve signal quality.\nFigure 7.2.1-1:\tNetwork Function and NF Service\nEach NF service shall be accessible by means of an interface. An interface may consist of one or several operations.\nThe figure depicts a network function, NF Service, and NF Service Operation, illustrating the various components and processes involved in network functions.\nFigure 7.2.1-2:\tNetwork Function, NF Service and NF Service Operation\nSystem procedures, as specified in TS 23.502 [3] can be built by invocation of a number of NF services. The following figure shows an illustrative example on how a procedure can be built; it is not expected that system procedures depict the details of the NF Services within each Network Function.\nThe figure depicts a system procedure and NF service diagram for a 5G network, illustrating the various procedures and services involved in network management and operation. The diagram includes key components such as the network control center (NCC), network management system (NMS), and network function virtualization (NFV). The figure also highlights the importance of network slicing and network slicing service (NSS) in managing and distributing network resources.\nFigure 7.2.1-3:\tSystem Procedures and NF Services\nNOTE 2:\tThe SCP can be used for indirect communication between NF/NF service instances. For simplicity the SCP is not shown in the procedure.\nThe following clauses provide for each NF the NF services it exposes through its service based interfaces.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tAMF Services",
                            "text_content": "The following NF services are specified for AMF:\nTable 7.2.2-1: NF Services provided by AMF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.2-1: NF Services provided by AMF",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.3\tSMF Services",
                            "text_content": "The following NF services are specified for SMF:\nTable 7.2.3-1: NF Services provided by SMF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.3-1: NF Services provided by SMF",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.4\tPCF Services",
                            "text_content": "The following NF services are specified for PCF:\nTable 7.2.4-1: NF Services provided by PCF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.4-1: NF Services provided by PCF",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.5\tUDM Services",
                            "text_content": "The following NF services are specified for UDM:\nTable 7.2.5-1: NF Services provided by UDM\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.5-1: NF Services provided by UDM",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.6\tNRF Services",
                            "text_content": "The following NF services are specified for NRF:\nTable 7.2.6-1: NF Services provided by NRF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.6-1: NF Services provided by NRF",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.7\tAUSF Services",
                            "text_content": "The following NF services are specified for AUSF:\nTable 7.2.7-1: NF Services provided by AUSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.7-1: NF Services provided by AUSF",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.8\tNEF Services",
                            "text_content": "The following NF services are specified for NEF:\nTable 7.2.8-1: NF Services provided by NEF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.8-1: NF Services provided by NEF",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.8A\tVoid",
                            "text_content": "\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.9\tSMSF Services",
                            "text_content": "The following NF services are specified for SMSF:\nTable 7.2.9-1: NF Services provided by SMSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.9-1: NF Services provided by SMSF",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.10\tUDR Services",
                            "text_content": "The following NF services are specified for UDR:\nTable 7.2.10-1: NF Services provided by UDR\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.10-1: NF Services provided by UDR",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.11\t5G-EIR Services",
                            "text_content": "The following NF services are specified for 5G-EIR:\nTable 7.2.11-1: NF Services provided by 5G-EIR\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.11-1: NF Services provided by 5G-EIR",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.12\tNWDAF Services",
                            "text_content": "The following NF services are specified for NWDAF:\nTable 7.2.12-1: NF Services provided by NWDAF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.12-1: NF Services provided by NWDAF",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.13\tUDSF Services",
                            "text_content": "The following NF services are specified for UDSF:\nTable 7.2.13-1: NF Services provided by UDSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.13-1: NF Services provided by UDSF",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.14\tNSSF Services",
                            "text_content": "The following NF services are specified for NSSF:\nTable 7.2.14-1: NF Services provided by NSSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.14-1: NF Services provided by NSSF",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.15\tBSF Services",
                            "text_content": "The following NF services are specified for BSF as described in TS 23.503 [45]:\nTable 7.2.15-1: NF Services provided by BSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.15-1: NF Services provided by BSF",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.16\tLMF Services",
                            "text_content": "The following NF services are specified for LMF:\nTable 7.2.16-1: NF Services provided by LMF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.16-1: NF Services provided by LMF",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.16A\tGMLC Services",
                            "text_content": "The following NF services are specified for GMLC:\nTable 7.2.16A-1: NF Services provided by GMLC\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.16A-1: NF Services provided by GMLC",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.17\tCHF Services",
                            "text_content": "The following NF services for spending limits and charging are specified for CHF.\nTable 7.2.17-1: NF Services provided by CHF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.17-1: NF Services provided by CHF",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.18\tUCMF Services",
                            "text_content": "The following NF services are specified for UCMF:\nTable 7.2.18-1: NF Services provided by UCMF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.18-1: NF Services provided by UCMF",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.19\tAF Services",
                            "text_content": "The following NF services are specified for AF:\nTable 7.2.19-1: NF Services provided by AF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.19-1: NF Services provided by AF",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.20\tNSSAAF Services",
                            "text_content": "The following NF services are specified for NSSAAF:\nTable 7.2.20 -1: NF Services provided by NSSAAF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.20 -1: NF Services provided by NSSAAF",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.21\tDCCF Services",
                            "text_content": "The following NF services are specified for DCCF:\nTable 7.2.21-1: NF Services provided by DCCF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.21-1: NF Services provided by DCCF",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.22\tMFAF Services",
                            "text_content": "The following NF services are specified for MFAF:\nTable 7.2.22-1: NF Services provided by MFAF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.22-1: NF Services provided by MFAF",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.23\tADRF Services",
                            "text_content": "The following NF services are specified for ADRF:\nTable 7.2.23-1: NF Services provided by ADRF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.23-1: NF Services provided by ADRF",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.24\t5G DDNMF Services",
                            "text_content": "The 5G DDNMF supports the N5g-ddnmf service defined in clause 7.1 of TS 23.304 [128].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.25\tEASDF Services",
                            "text_content": "The following NF services are specified for EASDF.\nTable 7.2.25-1: NF Services provided by EASDF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.25-1: NF Services provided by EASDF",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.26\tTSCTSF Services",
                            "text_content": "The following NF services are specified for TSCTSF.\nTable 7.2.26-1: NF Services provided by TSCTSF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.26-1: NF Services provided by TSCTSF",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.27\tNSACF Services",
                            "text_content": "The following NF services are specified for NSACF:\nTable 7.2.27-1: NF Services provided by NSACF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.27-1: NF Services provided by NSACF",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.28\tMB-SMF Services",
                            "text_content": "The following NF service is specified for MB-SMF.\nTable 7.2.28-1: NF Services provided by MB-SMF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.28-1: NF Services provided by MB-SMF",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "7.2.29\tUPF Services",
                            "text_content": "The following NF service is specified for UPF.\nTable 7.2.29-1: NF Services provided by UPF\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.2.29-1: NF Services provided by UPF",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "7.3\tExposure",
                    "description": "",
                    "summary": "",
                    "text_content": "Network exposure is described in clauses 5.20, 5.20d and in clause 4.15 of TS 23.502 [3].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "8\tControl and User Plane Protocol Stacks",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 8 specifies the overall protocol stacks between 5GS entities, e.g. between the UE and the 5GC Network Functions, between the 5G-AN and the 5GC Network Functions, or between the 5GC Network Functions.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tControl Plane Protocol Stacks",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tControl Plane Protocol Stacks between the 5G-AN and the 5G Core: N2",
                            "text_content": "NOTE 1:\tN2 maps to NG-C as defined in TS 38.413 [34].\nFollowing procedures are defined over N2:\n-\tProcedures related with N2 Interface Management and that are not related to an individual UE, such as for Configuration or Reset of the N2 interface. These procedures are intended to be applicable to any access but may correspond to messages that carry some information only on some access (such as information on the default Paging DRX used only for 3GPP access).\n-\tProcedures related with an individual UE:\n-\tProcedures related with NAS Transport. These procedures are intended to be applicable to any access but may correspond to messages that for UL NAS transport carry some access dependent information such as User Location Information (e.g. Cell-Id over 3GPP access or other kind of User Location Information for Non-3GPP access).\n-\tProcedures related with UE context management. These procedures are intended to be applicable to any access. The corresponding messages may carry:\n-\tsome information only on some access (such as Mobility Restriction List used only for 3GPP access).\n-\tsome information (related e.g. with N3 addressing and with QoS requirements) that is to be transparently forwarded by AMF between the 5G-AN and the SMF.\n-\tProcedures related with resources for PDU Sessions. These procedures are intended to be applicable to any access. They may correspond to messages that carry information (related e.g. with N3 addressing and with QoS requirements) that is to be transparently forwarded by AMF between the 5G-AN and the SMF.\n-\tProcedures related with Hand-Over management. These procedures are intended for 3GPP access only.\nThe Control Plane interface between the 5G-AN and the 5G Core supports:\n-\tThe connection of multiple different kinds of 5G-AN (e.g. 3GPP RAN, N3IWF for Un-trusted access to 5GC) to the 5GC via a unique Control Plane protocol: A single NGAP protocol is used for both the 3GPP access and non-3GPP access;\n-\tThere is a unique N2 termination point in AMF per access for a given UE regardless of the number (possibly zero) of PDU Sessions of the UE;\n-\tThe decoupling between AMF and other functions such as SMF that may need to control the services supported by 5G-AN(s) (e.g. control of the UP resources in the 5G-AN for a PDU Session). For this purpose, NGAP may support information that the AMF is just responsible to relay between the 5G-AN and the SMF. The information can be referred as N2 SM information in TS 23.502 [3] and this specification.\nNOTE 2:\tThe N2 SM information is exchanged between the SMF and the 5G-AN transparently to the AMF.\n\nLegend:\n-\tNG Application Protocol (NG-AP): Application Layer Protocol between the 5G-AN node and the AMF. NG-AP is defined in TS 38.413 [34].\n-\tStream Control Transmission Protocol (SCTP): This protocol guarantees delivery of signalling messages between AMF and 5G-AN node (N2). SCTP is defined in RFC 4960 [44].\n\nFigure 8.2.1.2-1: Control Plane between the 5G-AN and the AMF\n\nLegend:\n-\tN2 SM information: This is the subset of NG-AP information that the AMF transparently relays between the 5G-AN and the SMF, and is included in the NG-AP messages and the N11 related messages.\n\nFigure 8.2.1.3-1: Control Plane between the 5G-AN and the SMF\nNOTE 1:\tFrom the 5G-AN perspective, there is a single termination of N2 i.e. the AMF.\nNOTE 2:\tFor the protocol stack between the AMF and the SMF, see clause 8.2.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tControl Plane Protocol Stacks between the UE and the 5GC",
                            "text_content": "A single N1 NAS signalling connection is used for each access to which the UE is connected. The single N1 termination point is located in AMF. The single N1 NAS signalling connection is used for both Registration Management and Connection Management (RM/CM) and for SM-related messages and procedures for a UE.\nThe NAS protocol on N1 comprises a NAS-MM and a NAS-SM components.\nThere are multiple cases of protocols between the UE and a core network function (excluding the AMF) that need to be transported over N1 via NAS-MM protocol. Such cases include:\n-\tSession Management Signalling.\n-\tSMS.\n-\tUE Policy.\n-\tLCS.\nRM/CM NAS messages in NAS-MM and other types of NAS messages (e.g. SM), as well as the corresponding procedures, are decoupled.\nThe NAS-MM supports generic capabilities:\n-\tNAS procedures that terminate at the AMF. This includes:\n-\tHandles Registration Management and Connection Management state machines and procedures with the UE, including NAS transport; the AMF supports following capabilities:\n-\tDecide whether to accept the RM/CM part of N1 signalling during the RM/CM procedures without considering possibly combined other non NAS-MM messages (e.g. SM) in the same NAS signalling contents;\n-\tKnow if one NAS message should be routed to another NF (e.g. SMF), or locally processed with the NAS routing capabilities inside during the RM/CM procedures;\n-\tProvide a secure NAS signalling connection (integrity protection, ciphering) between the UE and the AMF, including for the transport of payload;\n-\tProvide access control if it applies;\n-\tIt is possible to transmit the other type of NAS message (e.g. NAS SM) together with an RM/CM NAS message by supporting NAS transport of different types of payload or messages that do not terminate at the AMF, i.e. NAS-SM, SMS, UE Policy and LCS between the UE and the AMF. This includes:\n-\tInformation about the Payload type;\n-\tAdditional Information for forwarding purposes\n-\tThe Payload (e.g. the SM message in the case of SM signalling);\n-\tThere is a Single NAS protocol that applies on both 3GPP and non-3GPP access. When an UE is served by a single AMF while the UE is connected over multiple (3GPP/Non 3GPP) accesses, there is a N1 NAS signalling connection per access.\nSecurity of the NAS messages is provided based on the security context established between the UE and the AMF.\nFigure 8.2.2.1-1 depicts NAS transport of SM signalling, SMS, UE Policy and LCS.\nThe figure depicts a NAS transport for SM, SMS, UE Policy, and LCS, illustrating the various transport layers and their respective roles in the network.\nFigure 8.2.2.1-1 NAS transport for SM, SMS, UE Policy and LCS\n\nLegend:\n-\tNAS-MM: The NAS protocol for MM functionality supports registration management functionality, connection management functionality and user plane connection activation and deactivation. It is also responsible of ciphering and integrity protection of NAS signalling. 5G NAS protocol is defined in TS 24.501 [47]\n-\t5G-AN Protocol layer: This set of protocols/layers depends on the 5G-AN. In the case of NG-RAN, the radio protocol between the UE and the NG-RAN node (eNodeB or gNodeB) is specified in TS 36.300 [30] and TS 38.300 [27]. In the case of non-3GPP access, see clause 8.2.4.\n\nFigure 8.2.2.2-1: Control Plane between the UE and the AMF\nThe NAS-SM supports the handling of Session Management between the UE and the SMF.\nThe SM signalling message is handled, i.e. created and processed, in the NAS-SM layer of UE and the SMF. The content of the SM signalling message is not interpreted by the AMF.\nThe NAS-MM layer handles the SM signalling is as follows:\n-\tFor transmission of SM signalling:\n-\tThe NAS-MM layer creates a NAS-MM message, including security header, indicating NAS transport of SM signalling, additional information for the receiving NAS-MM to derive how and where to forward the SM signalling message.\n-\tFor reception of SM signalling:\n-\tThe receiving NAS-MM processes the NAS-MM part of the message, i.e. performs integrity check, and interprets the additional information to derive how and where to derive the SM signalling message.\nThe SM message part shall include the PDU Session ID.\n\nLegend:\n-\tNAS-SM: The NAS protocol for SM functionality supports user plane PDU Session Establishment, modification and release. It is transferred via the AMF, and transparent to the AMF. 5G NAS protocol is defined in TS 24.501 [47]\n\nFigure 8.2.2.3-1: Control Plane protocol stack between the UE and the SMF\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.3\tControl Plane Protocol Stacks between the network functions in 5GC",
                            "text_content": "The control plane protocol(s) for the service-based interfaces listed in clause 4.2.6 is defined in the TS 29.500 [49]\nThe control plane protocol for SMF-UPF (i.e. N4 reference point) is defined in TS 29.244 [65].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.4\tControl Plane for untrusted non 3GPP Access",
                            "text_content": "The figure depicts a control plane before the signalling IPsec SA is established between an UE and a network interface controller (N3IWF). The diagram illustrates the network configuration, including the network interface controller (N3IWF), the network layer 3 (N3IWF), and the network layer 2 (N3IWF). The figure also shows the network layer 1 (N3IWF) and the network layer 0 (N3IWF). The figure is important for understanding the network configuration and the communication between the UE and the N3IWF.\nFigure 8.2.4-1: Control Plane before the signalling IPsec SA is established between UE and N3IWF\nThe figure depicts the control plane after the signalling IPsec SA (Security Association) is established between the UE (User Equipment) and the N3IWF (Network Interface WAN). The diagram illustrates the network's architecture, including the control plane, which is responsible for managing the network's security and performance. The figure also shows the IPsec SA, which is a key component in the network's security infrastructure.\nFigure 8.2.4-2: Control Plane after the signalling IPsec SA is established between UE and N3IWF\nLarge NAS messages may be fragmented by the \"inner IP\" layer or by TCP.\nThe figure depicts a control plane for establishing a user-plane via N3IWF (Network Virtualization and Interworking Framework). It illustrates the process of establishing a user-plane connection, with the control plane responsible for managing the network virtualization and interworking functions. The figure includes various components such as the network virtualization layer, interworking framework, and user plane interface (UI). The control plane ensures the efficient and secure establishment of user-plane connections, while the user plane interface provides a user-friendly interface for network management and control.\nFigure 8.2.4-3: Control Plane for establishment of user-plane via N3IWF\nIn the above figures 8.2.4-1, 8.2.4-2 and 8.2.4-3, the UDP protocol may be used between the UE and N3IWF to enable NAT traversal for IKEv2 and IPsec traffic.\nThe \"signalling IPsec SA\" is defined in clause 4.12.2 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.5\tControl Plane for trusted non-3GPP Access",
                            "text_content": "The figure depicts a control plane before the NWt connection is established between the UE and the TNGF. It shows the various components involved in the NWt process, including the NWt controller, the TNGF, and the UE. The figure illustrates the flow of data between the UE and the TNGF, highlighting the importance of proper communication and control in the NWt process.\nFigure 8.2.5-1: Control Plane before the NWt connection is established between UE and TNGF\nThe figure depicts the control plane after the NWt connection is established between the UE and the TNGF, illustrating the various components and their connections.\nFigure 8.2.5-2: Control Plane after the NWt connection is established between UE and TNGF\nLarge NAS messages may be fragmented by the \"inner IP\" layer or by TCP.\nThe figure depicts a control plane for establishing a user-plane via TNGF (Time-Nearest Neighbor Forwarding). It illustrates the process of selecting a TNGF (Time-Nearest Neighbor Forwarding) node, which is responsible for forwarding user data packets to the next hop. The figure shows the TNGF node's location and the path it takes to reach the destination. The control plane is crucial for ensuring efficient and reliable network performance, as it coordinates the forwarding of user data packets and manages the network topology.\nFigure 8.2.5-3: Control Plane for establishment of user-plane via TNGF\nIn the above figures 8.2.5-2 and 8.2.5-3, the UDP protocol may be used between the UE and TNGF to enable NAT traversal for IKEv2 and IPsec traffic.\nThe NWt connection is defined in clause 4.2.8.3 and in clause 4.12a.2.2 of TS 23.502 [3].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.6\tControl Plane for W-5GAN Access",
                            "text_content": "The control plane for W-5GAN is defined in clause 6 of TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.7\tControl Plane for Trusted WLAN Access for N5CW Device",
                            "text_content": "The figure depicts a control plane for a trusted WLAN access for a N5CW device, illustrating the various components and their roles in ensuring secure and reliable wireless communication.\nFigure 8.2.7-1: Control Plane for trusted WLAN access for N5CW device\nThe EAP protocol applies only for performing EAP-based access authentication procedure to connect to a trusted WLAN access network.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.3\tUser Plane Protocol Stacks",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.3.1\tUser Plane Protocol Stack for a PDU Session",
                            "text_content": "This clause illustrates the protocol stack for the User plane transport related with a PDU Session.\n\nLegend:\n-\tPDU layer: This layer corresponds to the PDU carried between the UE and the DN over the PDU Session. When the PDU Session Type is IPv4 or IPv6 or IPv4v6, it corresponds to IPv4 packets or IPv6 packets or both of them; When the PDU Session Type is Ethernet, it corresponds to Ethernet frames; etc.\n-\tGPRS Tunnelling Protocol for the user plane (GTP-U): This protocol supports tunnelling user data over N3 (i.e. between the 5G-AN node and the UPF) and N9 (i.e. between different UPFs of the 5GC) in the backbone network, details see TS 29.281 [75]. GTP shall encapsulate all end user PDUs. It provides encapsulation on a per PDU Session level. This layer carries also the marking associated with a QoS Flow defined in clause 5.7. This protocol is also used on N4 interface as defined in TS 29.244 [65].\n\nFigure 8.3.1-1: User Plane Protocol Stack\n-\t5G-AN protocol stack: This set of protocols/layers depends on the AN:\n-\tWhen the 5G-AN is a 3GPP NG-RAN, these protocols/layers are defined in TS 38.401 [42]. The radio protocol between the UE and the 5G-AN node (eNodeB or gNodeB) is specified in TS 36.300 [30] and TS 38.300 [27].\n-\tWhen the AN is an Untrusted non 3GPP access to 5GC the 5G-AN interfaces with the 5GC at a N3IWF defined in clause 4.3.2 and the 5G-AN protocol stack is defined in clause 8.3.2.\n-\tUDP/IP: These are the backbone network protocols.\nNOTE 1:\tThe number of UPF in the data path is not constrained by 3GPP specifications: there may be in the data path of a PDU Session 0, 1 or multiple UPF that do not support a PDU Session Anchor functionality for this PDU Session.\nNOTE 2:\tThe \"non PDU Session Anchor\" UPF depicted in the Figure 8.3.1-1 is optional.\nNOTE 3:\tThe N9 interface may be intra-PLMN or inter PLMN (in the case of Home Routed deployment).\nIf there is an UL CL (Uplink Classifier) or a Branching Point (both defined in clause 5.6.4) in the data path of a PDU Session, the UL CL or Branching Point acts as the non PDU Session Anchor UPF of Figure 8.3.1-1. In that case there are multiple N9 interfaces branching out of the UL CL / Branching Point each leading to different PDU Session anchors.\nNOTE 4:\tCo-location of the UL CL or Branching Point with a PDU Session Anchor is a deployment option.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.2\tUser Plane for untrusted non-3GPP Access",
                            "text_content": "The figure depicts a user plane via N3IWF, illustrating the path taken by a user's data packet as it traverses the network. The figure shows the user's data packet as it passes through various network elements, including the N3IWF, which is a key component in the network. The figure also highlights the importance of network slicing and the use of SDN to manage and optimize network resources.\nFigure 8.3.2-1: User Plane via N3IWF\nLarge GRE packets may be fragmented by the \"inner IP\" layer.\nDetails about the PDU Layer, the N3 stack and the N9 stack are included in clause 8.3.1. The UDP protocol may be used below the IPsec layer to enable NAT traversal.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.3\tUser Plane for trusted non-3GPP Access",
                            "text_content": "The figure depicts a user plane via TNGF, illustrating the path taken by a user's data packet as it traverses the network. The figure shows the user's data packet as it passes through various network elements, including the TNGF (Transmission Network Gateway), which is responsible for routing and forwarding the data packet. The figure also includes the TNGF's interface with the network, as well as the path taken by the data packet through the network.\nFigure 8.3.2-1: User Plane via TNGF\nLarge GRE packets may be fragmented by the \"inner IP\" layer.\nDetails about the PDU Layer, the N3 stack and the N9 stack are included in clause 8.3.1. The UDP protocol may be used below the IPsec layer to enable NAT traversal.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.4\tUser Plane for W-5GAN Access",
                            "text_content": "The user plane for W-5GAN is defined in clause 6 of TS 23.316 [84].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.5\tUser Plane for N19-based forwarding of a 5G VN group",
                            "text_content": "The figure depicts a user plane for N19-based forwarding in a 5G network, illustrating the various components and their interactions. Key elements include the base station (gNB), user equipment (UE), and scatterers. The diagram highlights beamforming techniques to mitigate interference, with redundancy paths shown in dashed lines to ensure failover reliability. The layered design aligns with SDN principles, emphasizing the importance of network virtualization and control plane abstraction.\nFigure 8.3.5-1: User Plane for N19-based forwarding\nDetails about the PDU Layer, PDU Session User Plane Protocol Stack are included in clause 8.3.1 and clause 8.3.2. The N19 is based on a shared User Plane tunnel connecting two PSA UPFs of a single 5G VN group.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.6\tUser Plane for Trusted WLAN Access for N5CW Device",
                            "text_content": "\nLegend:\n-\tTransport: this layer refers to the transport of PDUs between the N5CW device and TWIF (see clause 4.2.8.5.4).\nIn this Release of the specification, Trusted WLAN Access for N5CW Device only supports IP PDU Session type.\n\nFigure 8.2.8-1: User Plane for trusted WLAN access for N5CW device\nService-Based Interfaces and Reference Points are two different ways to model interactions between architectural entities. A Reference Point is a conceptual point at the conjunction of two non-overlapping functional groups (see TR 21.905 [1]). In figure A-1 the functional groups are equivalent to Network Functions.\nA reference point can be replaced by one or more service-based interfaces which provide equivalent functionality.\nThe figure depicts a simplified representation of a reference point in a network, where two Service-based Interfaces (SBI) are replaced by Service-based Interfaces (SBI) and Service-based Interfaces (SBI). This figure illustrates the concept of Service-based Interfaces, which are used to replace reference points in a network. The figure also shows the use of Service-based Interfaces to replace reference points in a network, demonstrating the concept of Service-based Interfaces.\nFigure A-1: Example show a Reference Point replaced by two Service based Interfaces\nThe figure depicts a simplified representation of a reference point in a network, where a single Service-based Interface (SBI) replaces the traditional Reference Point (RP). This simplification allows for a more efficient and scalable network architecture, as it reduces the number of network elements and simplifies the network topology.\nFigure A-2: Example showing a Reference Point replaced by a single Service based Interface\nReference points exist between two specific Network Functions. Even if the functionality is equal on two reference points between different Network Functions there has to be a different reference point name. Using the service-based interface representation it is immediately visible that it is the same service-based interface and that the functionality is equal on each interface.\nThe figure depicts a comparison between reference points and service-based interfaces in a network. It illustrates the concept of equal functionality on the interfaces, highlighting the importance of equal service quality for all users.\nFigure A-3: Reference Points vs. Service-based Interfaces representation of equal functionality on the interfaces\nA NF may expose one or more services through Service based interfaces.\nThe figure depicts a network function with multiple services, each represented by a distinct service label. The services are interconnected through a network, with each service having its own set of services and interfaces. This figure illustrates the network's architecture and the interconnection of services, highlighting the importance of network function virtualization and the need for network function chaining.\nFigure A-4: One or more Services exposed by one Network Function\nWhen interworking procedures with N26 are used and the UE performs idle mode mobility from 5GC to EPC the following mapping from 5G GUTI to EPS GUTI applies:\n-\t5G <MCC> maps to EPS <MCC>\n-\t5G <MNC> maps to EPS <MNC>\n-\t5G <AMF Region ID> and 5G <AMF Set ID> maps to EPS <MMEGI> and part of EPS <MMEC>\n-\t5G <AMF Pointer> map to part of EPS <MMEC>\n-\t5G <5G-TMSI> maps to EPS <M-TMSI>\nNOTE 1:\tThe mapping described above does not necessarily imply the same size for the 5G GUTI and EPS GUTI fields that are mapped. The size of 5G GUTI fields and other mapping details will be defined in TS 23.003 [19].\nNOTE 2:\tTo support interworking with the legacy EPC core network entity (i.e. when MME is not updated to support interworking with 5GS), it is assumed that the 5G <AMF Region ID> and EPS <MMEGI> is partitioned to avoid overlapping values in order to enable discovery of source node (i.e. MME or AMF) without ambiguity. Once the EPS in the PLMN has been updated to support interworking with 5GS, the full address space of the AMF Region ID can be used for 5GS.\n5G System Architecture allows any NF/NF Service to store and retrieve its unstructured data (e.g. UE contexts) into/from a Storage entity (e.g. UDSF) as stated in clause 4.2.5 in this release of the specification. This clause highlights some assumptions, principles regarding NF/NF services that use this Storage entity for storing unstructured data:\n1.\tIt is up to the Network Function implementation to determine whether the Storage entity is used as a Primary Storage (in which case the corresponding context stored within the NF/NF Service is deleted after storage in the Storage entity) or the Storage entity is used as a Secondary Storage (in which case the corresponding context within the NF/NF Service is stored).\n2.\tIt is up to the NF/NF Service implementation to determine the trigger (e.g. at the end of Registration procedure, Service Request procedure etc) for storing unstructured data (e.g. UE contexts) in the Storage entity but it is a good practice for NF/NF service to store stable state in the Storage entity.\n3.\tMultiple NF/NF service instances may require to access the same stored data in the Storage entity (e.g. UE context), around the same time, then the resolution the race condition is implementation specific.\n4.\tAll NFs within the same NF Set are assumed to have access to the same unstructured data stored within the Storage entity.\n5.\tAMF planned removal with UDSF (clause 5.21.2.2.1) and AMF auto-recovery (with UDSF option in clause 5.21.2.3) assume that a storage entity/UDSF is used either as a primary storage or secondary storage by the AMF for storing UE contexts.\n6.\tIt is up to implementation of the Storage entity to make sure that only NFs that are authorized for a certain data record can access this data record.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "D.1\tIntroduction",
            "description": "This annex provides guidance on how 5GS features and capabilities can be used to support various Non-Public Network deployment options.\nOverlay network: When UE is accessing SNPN service via NWu using user plane established in PLMN, SNPN is the overlay network. When UE is accessing PLMN services via NWu using user plane established in SNPN, PLMN is the overlay network.\nUnderlay network: When UE is accessing SNPN service via NWu using user plane established in PLMN, PLMN is the underlay network. When UE is accessing PLMN services via NWu using user plane established in SNPN, SNPN is the underlay network\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tSupport of Non-Public Network as a network slice of a PLMN",
            "description": "The PLMN operator can provide access to an NPN by using network slicing mechanisms.\nNOTE:\tAccess to PLMN services can be supported in addition to PNI-NPN services, e.g. based on different S-NSSAI/DNN for different services.\nThe following are some considerations in such a PNI-NPN case:\n1.\tThe UE has subscription and credentials for the PLMN;\n2.\tThe PLMN and NPN service provider have an agreement of where the NPN Network Slice is to be deployed (i.e. in which TAs of the PLMN and optionally including support for roaming PLMNs);\n3.\tThe PLMN subscription includes support for Subscribed S-NSSAI to be used for the NPN (see clause 5.15.3);\n4.\tThe PLMN operator can offer possibilities for the NPN service provider to manage the NPN Network Slice according to TS 28.533 [79].\n5.\tWhen the UE registers the first time to the PLMN, the PLMN can configure the UE with URSP including NSSP associating Applications to the NPN S-NSSAI (if the UE also is able to access other PLMN services);\n6.\tThe PLMN can configure the UE with Configured NSSAI for the Serving PLMN (see clause 5.15.4);\n7.\tThe PLMN and NPN can perform a Network Slice specific authentication and authorization using additional NPN credentials;\n8.\tThe UE follows the logic as defined for Network Slicing, see clause 5.15;\n9.\tThe network selection logic, access control etc are following the principles for PLMN selection; and\n10.\tThe PLMN may indicate to the UE that the NPN S-NSSAI is rejected for the RA when the UE moves out of the coverage of the NPN Network Slice. However, limiting the availability of the NPN S-NSSAI would imply that the NPN is not available outside of the area agreed for the NPN S-NSSAI, e.g. resulting in the NPN PDU Sessions being terminated when the UE moves out of the coverage of the NPN Network Slice. Similarly access to NPN DNNs would not be available via non-NPN cells.\n11.\tIn order to prevent access to NPNs for authorized UE(s) in the case of network congestion/overload and if a dedicated S-NSSAI has been allocated for an NPN, the Unified Access Control can be used using the operator-defined access categories with access category criteria type (as defined in TS 24.501 [47]) set to the S-NSSAI used for an NPN.\n12.\tIf NPN isolation is desired, it is assumed that a dedicated S-NSSAI is configured for the NPN and that the UE is configured to operate in Access Stratum Connection Establishment NSSAI Inclusion Mode a, b or c, see clause 5.15.9, such that NG-RAN receives Requested NSSAI from the UE and it can use the S-NSSAI for AMF selection.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.3\tSupport for access to PLMN services via Stand-alone Non-Public Network and access to Stand-alone Non Public Network services via PLMN",
            "description": "The figure depicts a simplified representation of a Stand-alone Non-Public Network (SNPN) access point (AP) in a 5G network. It illustrates the various components and their connections, including the access point itself, the radio access network (RAN), and the terrestrial network. The figure highlights the importance of network slicing and network slicing functions (NSF) in enabling efficient and flexible access to PLMN services.\nFigure D.3-1: Access to PLMN services via Stand-alone Non-Public Network\nNOTE 1:\tThe reference architecture in Figure D.3-1 and Figure D.3-2 only shows the network functions directly connected to the UPF or N3IWF and other parts of the architecture are same as defined in clause 4.2.\nIn order to obtain access to PLMN services when the UE is camping in NG-RAN of Stand-alone Non-Public Network, the UE obtains IP connectivity, discovers and establishes connectivity to an N3IWF in the PLMN.\nIn the Figure D.3-1, the N1 (for NPN) represents the reference point between UE and the AMF in Stand-alone Non-Public Network. The NWu (for PLMN) represents the reference point between the UE and the N3IWF in the PLMN for establishing secure tunnel between UE and the N3IWF over the Stand-alone Non-Public Network. N1 (for PLMN) represents the reference point between UE and the AMF in PLMN.\nThe figure depicts a simplified representation of a stand-alone non-public network (SPN) access point (AP) in a 5G network. It illustrates the various access points (APs) that can be used to provide non-public network services, such as voice, video, and data, to end-users. The figure shows the APs as small, rectangular structures with antennas, and the access points are connected to the core network via fiber-optic cables. The figure also includes a diagram of the network topology, showing the paths taken by the signals as they travel through the network.\nFigure D.3-2: Access to Stand-alone Non-Public Network services via PLMN\nIn order to obtain access to Non-Public Network services when the UE is camping in NG-RAN of a PLMN, the UE obtains IP connectivity, discovers and establishes connectivity to an N3IWF in the Stand-alone Non-Public Network.\nIn Figure D.3-2, the N1 (for PLMN) represents the reference point between UE and the AMF in the PLMN. The NWu (for NPN) represents the reference point between the UE and the N3IWF in the stand-alone Non-Public Network for establishing a secure tunnel between UE and the N3IWF over the PLMN. The N1 (for NPN) represents the reference point between UE and the AMF in NPN.\nWhen using the mechanism described above to access overlay network via underlay network, the overlay network can act as authorized 3rd party with AF to interact with NEF in the underlay network, to use the existing network exposure capabilities provided by the underlay network defined in clause 4.15 of TS 23.502 [3]. This interaction is subject of agreements between the overlay and the underlay network.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.4\tSupport for UE capable of simultaneously connecting to an SNPN and a PLMN",
            "description": "When a UE capable of simultaneously connecting to an SNPN and a PLMN and the UE is not set to operate in SNPN access mode for any of the Uu/Yt/NWu interfaces, the UE only performs PLMN selection procedures using the corresponding interface for connection to the PLMN.\nA UE supporting simultaneous connectivity to an SNPN and a PLMN applies the network selection as applicable for the access and network for SNPN and PLMN respectively. Whether the UE uses SNPN or PLMN for its services is implementation dependent.\nA UE supporting simultaneous connectivity to an SNPN and a PLMN applies the cell (re-)selection as applicable for the access and network for SNPN and PLMN respectively. Whether the UE uses SNPN or PLMN for its services is implementation dependent.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.5\tSupport for keeping UE in CM-CONNECTED state in overlay network when accessing services via NWu",
            "description": "When UE is accessing the overlay network via the underlay network as described in clause D.3, it is possible to keep the UE in CM-CONNECTED state in the overlay network:\n-\tUE maintains at least one PDU Session in underlay network, from where the N3IWF of the overlay network is reachable via the DN of the PDU Session in underlay network. In this case, the UE is considered as successfully connected to the non-3GPP access of the overlay network, thus UE always attempts to transit to CM-CONNECTED state from CM-IDLE, as described in NOTE 3 in clause 5.5.2.\n-\tIKEv2 liveness check procedure initiated either by UE or N3IWF as defined in clause 7.8 and clause 7.9 of TS 24.502 [48] can be utilized to ensure the signalling connection between UE and N3IWF is still valid when UE stays in CM-CONNECTED state. Adjusting the time interval of the liveness check to avoid the deletion of the IKEv2 SA due to inactivity, on both endpoints of the SA.\n-\tIf NAT is used, so as to avoid a timeout of the NAT entries between the UPF in the underlay network and the N3IWF in the overlay network, NAT-Traversal mechanisms described in RFC 7296 [60] and NAT-Keepalive described in RFC 3948 [138] are recommended.\n-\tAMF in overlay network keeps the UE in CM-CONNECTED state unless UE or N3IWF triggers the release.\n-\tThe NG-RAN node in the underlay network can use the existing information to decide an appropriate RRC state for the UE (e.g. whether release a UE to RRC_INACTIVE).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.6\tSupport for session/service continuity between SNPN and PLMN when using N3IWF",
            "description": "Depending on the UE's radio capability and implementation, the following existing mechanisms can be used to allow session/service continuity between SNPN and PLMN:\n-\tFor Single Radio UE which includes single Rx/Tx and dual Rx/single Tx UE, seamless service continuity is not supported in this release when the UE is moving between the 3GPP access networks of SNPN and PLMN because of the single radio limitation. But the PDU session continuity between SNPN and PLMN can be realized by utilizing the existing handover procedure between non-3GPP access and 3GPP access as defined in clause 4.9.2 of TS 23.502 [3], where one network is acting as non-3GPP access of the other network.\n-\tFor Dual Radio (Dual Rx/Dual Tx) UE, the service continuity can be achieved by utilizing the existing handover procedure between non-3GPP access and 3GPP access for PDU session on a single access and the existing user plane resource addition procedure for MA PDU session, where one network is acting as non-3GPP access of the other network\n-\tFor PDU session on a single access, UE can register to the same 5GC via both Uu and NWu interfaces from two networks when it is possible, by following the procedure defined in clause 4.2.2 of TS 23.502 [3] if the registration is via Uu, or in clause 4.12.2 of TS 23.502 [3] if the registration is via NWu. The registration via NWu utilizes the user plane which is established in another 5GC using another network's Uu interface. For example, if UE is moving out of its SNPN 3GPP access coverage and would like to continue its SNPN service in PLMN, UE can register to its SNPN 5GC via PLMN's 3GPP access network using NWu interface with SNPN's 5GC before moving out SNPN NG-RAN coverage. Upon mobility, the existing handover procedure between non-3GPP access and 3GPP access defined in clause 4.9.2 of TS 23.502 [3] can be utilized.\n-\tFor MA PDU session, if supported by UE and network, UE can register to the same 5GC via Uu and NWu interfaces and establish MA PDU session with ATSSS support to be anchored in the 5GC as defined in clause 4.22.2.2 of TS 23.502 [3], where one network is acting as non-3GPP access of the other network (Figure D.6-1 shows the example of UE with MA PDU session anchored in SNPN UPF when connected to SNPN via Uu and NWu interfaces). Upon mobility, UE can add/activate the user plane resource to the corresponding access type basing on the procedures defined in clause 4.22.7 of TS 23.502 [3].\nThe figure depicts a multi-radio UE (User Equipment) accessing to Stand-alone Non-Public Network (SNPN) services via Uu and NWu interfaces, utilizing the Multi-Access Point (MA PDU) session. The figure illustrates the ATSSS (Automatic Time and Signal Switching) support for dual radio UE, which enables seamless communication between the two radio interfaces.\nFigure D.6-1: MA PDU session with ATSSS support for dual radio UE accessing to Stand-alone Non-Public Network services via Uu and NWu interfaces\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.7\tGuidance for underlay network to support QoS differentiation for User Plane IPsec Child SA",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "D.7.1\tNetwork initiated QoS",
                    "description": "",
                    "summary": "",
                    "text_content": "When UE is accessing an overlay network via an underlay network as described in clause D.3, in order to ensure the underlay network to support the QoS required by the overlay network User Plane IPsec Child SA, the QoS differentiation mechanism based on network-initiated QoS modification as described in clause 5.30.2.7 and clause 5.30.2.8 can be used with the following considerations:\n-\tAn overlay network service can have specific QoS requirement that needs to be fulfilled by the underlay network, based on SLA between the two networks.\n-\tThe SLA covers selective services of the overlay network which require QoS support in underlay network. The rest of the overlay network traffic could be handled in best efforts basis by underlay network.\n-\tThe SLA between the overlay network and the underlay network includes a mapping between DSCP values of the User Plane IPsec Child SAs and the QoS requirement of the overlay network services. The QoS requirement includes the QoS parameters described in clause 5.7.2 that are necessary (e.g. 5QI, ARP, etc.) during the network-initiated QoS modification in underlay network. In order to facilitate the SLA, a guidance for details of the mapping between DSCP values of the User Plane IPSec Child SAs and QoS requirement of the overlay network services is described of TS 29.513 [133]. The SLA also includes the N3IWF IP address of the overlay network.\n-\tThe mapping agreed in SLA is configured at N3IWF of the overlay network and at the SMF/PCF of the underlay network. If a dedicated DNN/S-NSSAI is used in the underlay network for providing access to the N3IWF in the overlay network, the SMF/PCF in the underlay network can be configured to enable packet detection (based on N3IWF IP address and DSCP value) for PDU sessions associated with the dedicated DNN/S-NSSAI.\n-\tWhen UE establishes a PDU Session in underlay network, the PCF in the underlay network determines PCC rules based on UE subscription information and local configuration which takes into account the SLA described above and installs the PCC rules on the SMF which generates and installs PDR/URR on UPF. The PCC rules indicate N3IWF IP address and the DSCP values of the User Plane IPsec Child SAs of the overlay network which require QoS differentiation by the underlay network. So, the UPF in the underlay network can detect packets of the User Plane IPsec Child SAs corresponding to the overlay network services which require QoS support by the underlay network.\n-\tUE registers and establishes PDU Session in the overlay network via the User Plane connectivity established in the underlay network. When UE is accessing a specific service of overlay network, a QoS Flow can be created by the overlay network, then N3IWF creates dedicated User Plane IPsec Child SA for each overlay network QoS Flow that requires underlay network QoS support.\n-\tN3IWF uses the QoS profile and the Session-AMBR it receives from SMF in overlay network along with the mapping agreed in the SLA to derive a specific DSCP value for the User Plane IPsec Child SA. N3IWF assigns a specific DSCP value only to one User Plane IPsec Child SA for a UE at the same time. UE (for UL) and N3IWF (for DL) will set the DSCP marking in the outer IP header of the User Plane IPsec Child SA accordingly.\n-\tThe overlay network traffic between UE and N3IWF using the specific DSCP marking will be detected by the UPF in the underlay network, based on previous installed PDR/URR. The SMF/PCF in underlay network will be informed when the overlay network traffic is detected. Then the PCF installs new PCC rules on the SMF including the QoS parameters for handling of packets corresponding to the specific User Plane IPsec Child SA based on the N3IWF IP address and the DSCP value of the User Plane IPsec Child SA, and the SMF generates a QoS profile that triggers the PDU Session Modification procedure as described in clause 4.3.3 of TS 23.502 [3]. The QoS parameters are derived from the mapping agreed in SLA based on the detected DSCP value.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "D.7.2\tUE initiated QoS",
                    "description": "",
                    "summary": "",
                    "text_content": "When UE is accessing an overlay network via an underlay network as described in clause D.3, if UE-initiated QoS modification in clause 5.30.2.7 and clause 5.30.2.8 is used, the following principles can be considered to enable consistent QoS for User Plane IPsec Child SAs between the two networks:\n-\tUE registers and establishes PDU Session in the overlay network via the User Plane connectivity established in the underlay network. When UE is accessing a specific service of overlay network, a QoS Flow in overlay network can be created according to clause 4.3.3 of TS 23.502 [3]. UE receives the QoS Flow level QoS parameters (e.g. 5QI, GFBR, MFBR, as specified in TS 24.501 [47]) from SMF/PCF in overlay network for the QoS Flow which is created for the specific overlay network service.\n-\tN3IWF in overlay network creates dedicated User Plane IPsec Child SA for each overlay network QoS Flow that requires underlay network QoS support.\n-\tIn order to ensure the traffic of the overlay network service is handled with the desired QoS in underlay network, UE can request new QoS Flow for the PDU session in the underlay network, by PDU Session Modification procedure described in clause 4.3.3 of TS 23.502 [3]. The requested QoS can be derived from the QoS Flow level QoS parameters which the UE has received from the overlay network. The Packet Filter in the QoS rule of the request includes overlay network N3IWF IP address and SPI associated with the User Plane IPsec Child SA.\n-\tSMF in the underlay network notifies the PCF that the UE has initiated resource modification, after receiving the PDU Session Modification Request. PCF in the underlay network determines if the request can be authorized based on UE subscription and local policy which can take into account the SLA between overlay network and underlay network. If the request is authorized, PCF generates new PCC rule and installs on SMF in order to create new QoS Flow in underlay network using the QoS Flow level QoS parameters from the overlay network. The PDR/FAR generated refers to the N3IWF IP address and the SPI (provided by the UE in Traffic filter in PDU Session Modification request) to enable filtering and mapping of DL traffic towards the right PDU Session/QoS Flow within the underlay network.\n-\tIf SLA exists, it can include a mapping between the DSCP values of the User Plane IPsec Child SAs and the QoS requirement of the overlay network services. The SLA is configured at N3IWF in overlay network and at SMF/PCF in underlay network. N3IWF can provide DSCP value to UE for the User Plane IPsec Child SA at PDU Session Establishment (clause 4.12.5, step 4a and 4c of TS 23.502 [3]). UE can include the DSCP value as an addition in the Packet Filter by initiating the PDU Session Modification procedure in the underlay network. PCF in the underlay network performs QoS authorization of UE QoS request considering the UE subscription and local configuration which takes into account the mapping in the SLA. Details of the mapping between DSCP values of the User Plane IPSec Child SAs and QoS requirement of the overlay network services is described in TS 29.513 [133].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "E.1\tGeneral",
            "description": "This annex provides a high level description of the different communication models that NF and NF services can use to interact which each other. Table E.1-1 summarizes the communication models, their usage and how they relate to the usage of an SCP.\nTable E.1-1: Communication models for NF/NF services interaction summary\n\nModel A - Direct communication without NRF interaction: Neither NRF nor SCP are used. Consumers are configured with producers' \"NF profiles\" and directly communicate with a producer of their choice.\nModel B - Direct communication with NRF interaction: Consumers do discovery by querying the NRF. Based on the discovery result, the consumer does the selection. The consumer sends the request to the selected producer.\nModel C - Indirect communication without delegated discovery: Consumers do discovery by querying the NRF. Based on discovery result, the consumer does the selection of an NF Set or a specific NF instance of NF set. The consumer sends the request to the SCP containing the address of the selected service producer pointing to a NF service instance or a set of NF service instances. In the latter case, the SCP selects an NF Service instance. If possible, the SCP interacts with NRF to get selection parameters such as location, capacity, etc. The SCP routes the request to the selected NF service producer instance.\nModel D - Indirect communication with delegated discovery: Consumers do not do any discovery or selection. The consumer adds any necessary discovery and selection parameters required to find a suitable producer to the service request. The SCP uses the request address and the discovery and selection parameters in the request message to route the request to a suitable producer instance. The SCP can perform discovery with an NRF and obtain a discovery result.\nFigure E.1-1 depicts the different communication models.\nThe figure depicts various communication models for NF/NF services interaction, illustrating the various paths through which NF/NF services can be transmitted and received.\nFigure E.1-1: Communication models for NF/NF services interaction\nThis clause describes an approach to realize multiple user plane paths in the system based on a device having multiple UEs and specific network deployments.\nThe approach assumes a RAN deployment where redundant coverage by multiple gNBs (in the case of NR) is generally available. Upper layer protocols, such as the IEEE 802.1 TSN (Time Sensitive Networking), can make use of the multiple user plane paths.\nThe UEs belonging to the same terminal device request the establishment of PDU Sessions that use independent RAN and CN network resources using the mechanisms outlined below.\nThis deployment option has a number of preconditions:\n-\tThe redundancy framework uses separate gNBs to achieve user plane redundancy over the 3GPP system. It is however up to operator deployment and configuration whether separate gNBs are available and used. If separate gNBs are not available for a device, the redundancy framework may still be applied to provide user plane redundancy in the rest of the network as well as between the device and the gNB using multiple UEs.\n-\tTerminal devices integrate multiple UEs which can connect to different gNBs independently.\n-\tRAN coverage is redundant in the target area: it is possible to connect to multiple gNBs from the same location. To ensure that the two UEs connect to different gNBs, the gNBs need to operate such that the selection of gNBs can be distinct from each other (e.g. gNB frequency allocation allows the UE to connect to multiple gNBs).\n-\tThe core network UPF deployment is aligned with RAN deployment and supports redundant user plane paths.\n-\tThe underlying transport topology is aligned with the RAN and UPF deployment and supports redundant user plane paths.\n-\tThe physical network topology and geographical distribution of functions also supports the redundant user plane paths to the extent deemed necessary by the operator.\n-\tThe operation of the redundant user plane paths is made sufficiently independent, to the extent deemed necessary by the operator, e.g. independent power supplies.\nFigure F-1 illustrates the architecture view. UE1 and UE2 are connected to gNB1 and gNB2, respectively and UE1 sets up a PDU Session via gNB1 to UPF1, while UE2 sets up a PDU Session via gNB2 to UPF2. UPF1 and UPF2 connect to the same Data Network (DN), but the traffic via UPF1 and UPF2 might be routed via different user plane nodes within the DN. UPF1 and UPF2 are controlled by SMF1 and SMF2, respectively.\nThe figure depicts a network architecture with multiple User Equipment (UE) devices, each equipped with a dedicated radio frequency (RF) transceiver. The architecture is designed to ensure redundancy, with each UE having its own radio frequency (RF) transceiver and a separate radio frequency (RF) antenna. This redundancy is achieved through the use of multiple RF transceivers and antennas, which can be configured to transmit and receive signals independently. The figure also illustrates the use of redundant optical fiber links, which are used to transmit and receive data between the UE devices and the base station (gNB). The figure is a visual representation of the network's architecture, highlighting the importance of redundancy and the use of optical fiber links for data transmission.\nFigure F-1: Architecture with redundancy based on multiple UEs in the device\nThe approach comprises the following main components shown as example using NR in figure F-2.\n-\tgNB selection: The selection of different gNBs for the UEs in the same device is realized by the concept of UE Reliability Groups for the UEs and also for the cells of gNBs. By grouping the UEs in the device and cells of gNBs in the network into more than one reliability group and preferably selecting cells in the same reliability group as the UE, it is ensured that UEs in the same device can be assigned different gNBs for redundancy as illustrated in Figure F-2, where UE1 and the cells of gNB1 belong to reliability group A, and UE2 and the cells of gNB2 belong to reliability group B.\nThe figure depicts a reliability group-based redundancy concept in the Radio Access Network (RAN), illustrating how groups of base stations (gBSs) can be grouped together to provide redundancy in case of a single gBS failure. This concept is crucial for ensuring network reliability and resilience in the face of potential disruptions.\nFigure F-2: Reliability group-based redundancy concept in RAN\nFor determining the reliability grouping of a UE, one of the following methods or a combination of them can be used:\n-\tIt could be configured explicitly to the UE and sent in a Registration Request message to the network using an existing parameter (such as an S-NSSAI in the Requested NSSAI where the SST is URLLC; the Reliability Group can be decided by the SD part).\n-\tIt could also be derived from existing system parameters (e.g. SUPI, PEI, S-NSSAI, RFSP) based on operator configuration.\nThe Reliability Group of each UE is represented via existing parameters and sent from the AMF to the RAN when the RAN context is established, so each gNB has knowledge about the reliability group of the connected UEs.\nNOTE:\tAn example realisation can be as follows: the UE's Allowed NSSAI can be used as input to select the RFSP index value for the UE. The RAN node uses the RFSP for RRM purposes and can based on local configuration determine the UE's Reliability Group based on the S-NSSAI in Allowed NSSAI and/or S-NSSAI for the PDU Session(s).\nThe reliability group of the RAN (cells of gNBs) entities are pre-configured by the O&M system in RAN. It is possible for gNBs to learn the reliability group neighbouring cells as the Xn connectivity is set up, or the reliability group of neighbouring cells are also configured into the gNBs.\nIn the case of connected mode mobility, the serving gNB prioritizes candidate target cells that belong to different reliability group than the UE. It follows that normally the UE is handed over only to cells in the same reliability group. If cells in the same reliability group are not available (UE is out of the coverage of cells of its own reliability group or link quality is below a given threshold) the UE may be handed over to a cell in another reliability group as well.\nIf the UE connects to a cell whose reliability group is different from the UE's reliability group, the gNB initiates a handover to a cell in the appropriate reliability group whenever such a suitable cell is available.\nIn the case of an Idle UE, it is possible to use the existing cell (re-)selection priority mechanism, with a priori UE config using dedicated signalling (in the RRCConnectionRelease message during transition from connected to idle mode) to configure the UE to reselect the cells of the appropriate reliability group for camping in deployments where the cell reliability groups use different sets of frequencies.\n-\tUPF selection. UPF selection mechanisms as described in clause 6.3.3 can be used to select different UPFs for the UEs within the device. The selection may be based either on UE configuration or network configuration of different DNNs leading to the same DN, or different slices for the two UEs. It is possible to use the UE's Reliability Group, described above for gNB selection, as an input to the UPF selection. The proper operator configuration of the UPF selection can ensure that the path of the PDU Sessions of UE1 and UE2 are independent.\n-\tControl plane. The approach can optionally apply different control plane entities for the individual UEs within the device. This may be achieved by using:\n-\tdifferent DNNs for the individual UEs within the device to select different SMFs,\n-\tor applying different slices for the individual UEs within the device either based on UE configuration or network subscription, to select different AMFs and/or SMFs.\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table E.1-1: Communication models for NF/NF services interaction summary",
                    "table number": 53,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.1\tGeneral",
            "description": "This Annex provides deployment examples for the SCP but is not meant to be an exhaustive list of deployment options for the SCP. The first example G.1 is based on an SCP implement using (network wide) service mesh technology, while the second example builds on SCP and 5GC functions as independent deployment units.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.2\tAn SCP based on service mesh",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "G.2.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes an SCP deployment based on a distributed model in which SCP endpoints are co-located with 5GC functionality (e.g. an NF, an NF Service, a subset thereof such as a microservice implementing part of an NF/NF service or a superset thereof such as a group of NFs, NF Services or microservices). This example makes no assumptions as to the internal composition of each 5GC functionality (e.g. whether they are internally composed of multiple elements or whether such internal elements communicate with means other than the service mesh depicted in this example).\nIn this deployment example, Service Agent(s) implementing necessary peripheral tasks (e.g. an SCP endpoint) are co-located with 5GC functionality, as depicted in Figure G.2.1-1. In this example, Service Agents and 5GC functionality, although co-located, are separate components.\nThe figure depicts a deployment unit for 5G core network functionality, including co-located Service Agents (SAs) implementing peripheral tasks. The deployment unit is shown in Figure G.2.1-1, with the SAs and peripheral tasks highlighted in red. The figure illustrates the integration of 5G core network functionality with co-located Service Agents, highlighting the importance of co-location for efficient network operation.\nFigure G.2.1-1: Deployment unit: 5GC functionality and co-located Service Agent(s) implementing peripheral tasks\nIn this deployment example, an SCP Service Agent, i.e. a service communication proxy, is co-located in the same deployment unit with 5GC functionality and provides each deployed unit (e.g. a container-based VNFC) with indirect communication and delegated discovery.\nFigure G.2.1-2 shows an overview of this deployment scenario. For SBI-based interactions with other 5GC functionalities, a consumer (5GC functionality A) communicates through its Service Agent via SBI. Its Service Agent selects a target producer based on the request and routes the request to the producer's (5GC functionality B) Service Agent. What routing and selection policies a Service Agent applies for a given request is determined by routing and selection policies pushed by the service mesh controller. Information required by the service mesh controller is pushed by the Service Agents to the service mesh controller.\nIn this deployment, the SCP manages registration and discovery for communication within the service mesh and it interacts with an external NRF for service exposure and communication across service mesh boundaries. Operator-defined policies are additionally employed to generate the routing and selection policies to be used by the Service Agents.\nThis example depicts only SBI-based communication via a service mesh, but it does not preclude the simultaneous use of the service mesh for protocols other than SBI supported by the service mesh or that the depicted 5GC functionality additionally communicates via other means.\nThe figure depicts a service mesh co-location with 5G core functionality, illustrating the integration of the service mesh with the 5G core network. The service mesh is a key component in enabling the seamless integration of various services, such as network slicing, security, and application delivery, into the 5G core network. The figure shows the service mesh components, including the service orchestrator, service discovery, and service mesh gateway, all co-located with the 5G core functionality. This integration enables the efficient management and orchestration of services within the 5G core network, ensuring a seamless user experience and efficient network operations.\nFigure G.2.1-2: SCP Service mesh co-location with 5GC functionality\nFrom a 3GPP perspective, in this deployment example a deployment unit thus contains NF functionality and SCP functionality. Figure G.2.1-3 depicts the boundary between both 3GPP entities. In the depicted example, two NF Services part of the same NF and each exposing an SBI interface are deployed each in a container-based VNFC. A co-located Service Agent provides each NF Service with indirect communication and delegated discovery.\nThe figure depicts a detailed view of the NF-SCP boundary, highlighting its various components and their interconnections. The NF-SCP is a crucial component in the network, responsible for managing the flow of data between the source and destination nodes. The figure provides a comprehensive understanding of the NF-SCP's structure, including the various nodes, their connections, and the flow of data. This technical figure is essential for understanding the network's architecture and its role in data transmission.\nFigure G.2.1-3: Detail of the NF-SCP boundary\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.2.2\tCommunication across service mesh boundaries",
                    "description": "",
                    "summary": "",
                    "text_content": "It is a deployment where a single service mesh covers all functionality within a given deployment or not. In cases of communication across the boundaries of a service mesh, the service mesh routing the outbound message knows neither whether the selected producer is in a service mesh nor the internal topology of the potential service mesh where the producer resides.\nIn such a deployment, as shown in Figure G.2.2.-1, after producer selection is performed, routing policies on the outgoing service mesh are only aware of the next hop.\nGiven a request sent by A, A's Service Agent will perform producer selection based on the received request. If the selected producer endpoint (e.g. D) is determined to be outside of Service Mesh 1, A's Service Agent routes the request to the Egress Proxy. For a successful routing, the Egress Proxy needs to be able to determine the next hop of the request. In this case, this is the Ingress Proxy of Service Mesh 2. The Ingress Proxy of Service Mesh 2 is, based on the information in the received request and its routing policies, able to determine the route for the request. Subsequently, D receives the request. No topology information needs to be exchanged between Service Mesh 1 and Service Mesh 2 besides a general routing rule towards Service Mesh 2 (e.g. a FQDN prefix) and an Ingress Proxy destination for requests targeting endpoints in Service Mesh 2.\nThe figure depicts a message routing system in a service mesh, illustrating how messages are routed across different service boundaries. The system uses a message queue to store messages, and a service mesh to manage the routing of messages. The figure shows the different service boundaries, such as the application layer, the network layer, and the data plane, and how messages are routed between them. The figure also shows the different routing algorithms used in the system, such as round-robin and shortest-path routing, and the different types of messages, such as HTTP and HTTPS, that are routed through the system.\nFigure G.2.2-1: Message routing across service mesh boundaries\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "G.3\tAn SCP based on independent deployment units",
            "description": "This clause shows an overview of SCP deployment based on the 5GC functionality and SCP being deployed in independent deployment units.\nThe figure depicts independent deployment units for SCP and 5GC functionality, illustrating the separation of these two functionalities within a network.\nFigure G.3-1: Independent deployment units for SCP and 5GC functionality\nThe SCP deployment unit can internally make use of microservices, however these microservices are up to vendors implementation and can be for example SCP agents and SCP controller as used in this example. The SCP agents implement the http intermediaries between service consumers and service producers. The SCP agents are controlled by the SCP controller. Communication between SCP controller and SCP agents is via SCP internal interface (4) and up to vendors implementation.\nIn this model it is a deployment choice to co-locate SCP and other 5GC functions or not. The SCP interfaces (1), (2) and (3) are service based interfaces. SCP itself is not a service producer itself, however acting as http proxy it registers services on behave of the producers in NRF. Interface (2) represents same services as (1) however using SCP proxy addresses. Interface (3) is interfacing NRF e.g. for service registration on behalf of the 5GC functions or service discovery.\nThe figure depicts the functionality of 5G Core Network (5GC) and the various co-location choices for SCPs (Serving Cells Points). It highlights the importance of co-location for 5G networks, as it allows for efficient use of spectrum and reduces the need for additional infrastructure. The figure also illustrates the different types of co-location options, such as point-to-point, point-to-multipoint, and point-to-multipoint with SCPs, and their respective advantages and disadvantages.\nFigure G.3-2: 5GC functionality and SCP co-location choices\nFor SBI-based interactions with other 5GC functions, a consumer communicates through a SCP agent via SBI (1). SCP agent selects a target based on the request and routes the request to the target SCP agent (2). What routing and selection policies each SCP agent applies for a given request is determined by routing and selection policies determined by the SCP controller using for example information provided via NRF (3) or locally configured in the SCP controller. The routing and selection information is provided by the SCP controller to the SCP agents via SCP internal interface (4). Direct communication can coexist in the same deployment based on 3GPP specified mechanisms.\nThe figure depicts a 3-3 layout of a SCP deployment, illustrating the various components and their connections. The diagram includes a base station (BS), a user equipment (UE), and a scatterer, with a focus on the signal path and the use of beamforming techniques to mitigate interference.\nFigure G.3-3: Overview of SCP deployment\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.4\tAn SCP deployment example based on name-based routing",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "G.4.0\tGeneral Information",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause provides a deployment example for the SCP which is based on a name-based routing mechanism that provides IP over ICN capabilities such as those described in Xylomenos, George, et al. [G1].\nThe scenario describes an SCP offering based on an SBA-platform to interconnect 5GC Services (or a subset of the respective services). The Name-based Routing mechanism, described in this deployment example, is realized through a Path Computation Element which is the core part of the SCP. The 5GC Services are running as microservices on cloud/deployment units (clusters). A Service Router is the communication node (access node/gateway) between the SCP and the 5GC Services and resides as a single unit within a Service Deployment Cluster. The Service Router acts as communication proxy and it is responsible for mapping IP based messages onto ICN publication and subscriptions. The Service Router serves multiple 5GC Service Endpoints within that cluster. For direct communication the Service Router is not used.\n5GC Functionalities communicate with the Service Router using standardized 3GPP SBIs.\nThe Functionalities within the Service Deployment Cluster are containerized Service Functions.\nDepicted in Figure G.4-1, the Service Router act as SCP termination point and offer the SBI to the respective 5GC Service Functionalities. In this example, Service Routers and 5GC functionality, although co-located, are separate components within the Service Deployment Cluster. Multiple Functionalities can exist within the Service Deployment Cluster, all served by the respective Service Router when needed to communicate to other Service Functionalities within different clusters.\nThe figure depicts a deployment unit for 5G core network functionality, with co-located Service Agents (SAs) implementing peripheral tasks. The deployment unit includes a 5GC (5G Core Network) functionality, which is a key component of 5G networks, and co-located SAs, which are responsible for implementing peripheral tasks. The figure illustrates the integration of these components, highlighting the importance of co-location and the role of SAs in the 5G network.\nFigure G.4-1: Deployment unit: 5GC functionality and co-located Service Agent(s) implementing peripheral tasks\nIn Figure G.4-1, the two depicted 5GC Service Functionalities (realized as Network Function Service Instances) may communicate in two ways. However, before the communication can be established between two 5GC Functionalities, Service Registration and Service Discovery need to take place, as described in Figure G.4.1-1. Service Registration and Service Discovery are provided in a standardized manner using 3GPP Service Based Interfaces.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.4.1\tService Registration and Service Discovery",
                    "description": "",
                    "summary": "",
                    "text_content": "Service registration can be done in several ways. One option is that ready 5GC Service Functions may register themselves with their service profile via the Nnrf interface. The registration request is forwarded to the internal Registry as well as forwarded to the operator's NRF. The internal registration is used to store the address to identifier relationship and the Service Deployment Cluster location. The external registration (NRF) is used to expose the Service Functionality to Services outside the depicted SCP.\nService discovery entails Function A requesting a resolvable identifier for Functionality B. This resolve request is received by the Service Router which performs the task with the help of the SCP. After the resolve is done, the 5GC Functionalities may communicate either directly without any further interaction through the SCP, when the targeted address is resolved within the same Service Deployment Cluster; or via the Service Router when the Functionality resides outside of the originator's Service Deployment Cluster. The Service Router then acts as gateway towards the underlying SCP platform.\nThe figure depicts a schematic representation of the 5G Core Subscriber Plane (CSP) functionalities, including the registration of 5GC functionalities in the SCP. It illustrates the various components and their interconnections, highlighting the importance of proper registration and synchronization to ensure the smooth operation of the 5G network.\nFigure G.4.1-1: Registering 5GC Functionalities in the SCP\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.4.2\tOverview of Deployment Scenario",
                    "description": "",
                    "summary": "",
                    "text_content": "Figure G.4.2-1 shows an overview of this deployment scenario. For SBI-based interactions with other 5GC functionalities, a consumer entity (e.g. 5GC functionality B in the cluster on the left side) communicates through the cluster's Service Router with other entities in other clusters (e.g. 5GC Functionality D in the cluster on the right side). The target selection is performed through the platform's Discovery Service. From the client's perspective, the Service Router is the first and only contact point to the SCP. The platform resolves the requested Service identifier and aligns the results with the platform's policies. The Path Computation Element calculates a path between the consumer and the producer (e.g. the shortest path between the nodes).\nThe figure depicts a G.4.2-1 SCP interconnect, which is a type of network interconnect used in 5G networks. It connects multiple deployment clusters with external NRF (Network Radio Frequency) devices, facilitating efficient communication and data transfer.\nFigure G.4.2-1: (NbR-) SCP interconnects multiple deployment clusters with external NRF\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.4.3\tReferences",
                    "description": "",
                    "summary": "",
                    "text_content": "[G1]\tXylomenos, George, et al.: \"IP over ICN goes live\", 2018 European Conference on Networks and Communications (EuCNC). IEEE, 2018.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "H.1\tGeneral",
            "description": "This Annex provides guidelines on the use of certain specific IEEE parameters and protocol messages in the case of TSN as described in clause 5.27.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.2\tSignalling of ingress time for time synchronization",
            "description": "The ingress timestamp (TSi) of the PTP event (e.g. Sync) message is provided from the ingress TT (NW-TT/UPF or DS-TT/UE) to the egress TT, if supported in the PTP messages as described in clauses 5.27.1.2.2.1 and 5.27.1.2.2.2 using the Suffix field defined in clause 13.4 of IEEE Std 1588 [126]. The structure of the Suffix field follows the recommendation of clause 14.3 of IEEE Std 1588 [126], with an organizationId specific to 3GPP, an organizationSubType referring to an ingress timestamp, and data field that carries the ingress timestamp encoded as specified in clause 5.3.3 of IEEE Std 1588 [126]. TS 24.535 [117] specifies the coding of the ingress timestamp in the (g)PTP messages between a DS-TT and a NW-TT.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.3\tVoid",
            "description": "\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.4\tPath and Link delay measurements",
            "description": "The procedure described in this clause is applicable if DS-TT and NW-TT support operating as a boundary clock or as a time-aware system or as peer to peer Transparent Clock or end to end Transparent Clock, and when the PTP instance in 5GS is configured to operate as a time-aware system or as a Boundary Clock or as peer to peer Transparent Clock or as end to end Transparent Clock. Whether DS-TT/NW-TT support operating as a boundary clock or peer to peer Transparent Clock or end to end Transparent Clock or as a time-aware system (support of the IEEE Std 802.1AS [104] PTP profile) may be determined as described in clause K.2.1.\nPTP ports in DS-TT and NW-TT may support the following delay measurement mechanisms:\n-\tDelay request-response mechanism as described in clause 11.3 of IEEE Std 1588 [126];\n-\tPeer-to-peer delay mechanism as defined in clause 11.4 of IEEE Std 1588 [126];\n-\tCommon Mean Link Delay Service.\nDepending on the measurement mechanisms supported by DS-TT and NW-TT as well as the configured clock mode of 5GS, the PTP ports in DS-TT and NW-TT are configured as follows:\n-\tPTP ports configured to operate as a time-aware system according to IEEE Std 802.1AS [104] may be configured to use the peer-to-peer delay mechanism or Common Mean Link Delay Service;\n-\tPTP ports configured to operate as a Boundary Clock according to IEEE Std 1588 [126] may be configured to use the delay request-response mechanism, the peer-to-peer delay mechanism or Common Mean Link Delay Service.\n-\tPTP ports in 5GS configured to operate as a peer-to-peer Transparent Clock according to IEEE Std 1588 [126] shall use the peer-to-peer delay mechanism.\n-\tPTP ports in 5GS configured to operate as an end-to-end Transparent Clock according to IEEE Std 1588 [126] do not actively participate in path and link measurements mechanisms but shall calculate and add residence time and delay asymmetry information to PTP messages as defined in clause 10.2.2 of IEEE Std 1588 [126].\nIf DS-TT and NW-TT support operating as an end-to-end Transparent Clock, then the residence time for one-step operation as an end-to-end Transparent Clock for the path and link measurements is calculated as follows:\n-\tUpon reception of a PTP Delay_Req/Pdelay_Req/Pdely_Resp message from the upstream PTP instance, the ingress TT (i.e. NW-TT or DS-TT) makes an ingress timestamping (TSi) for the message.\n-\tThe ingress timestamp is conveyed to the egress TT via the PDU Session as described in clause H.2.\n-\tThe PTP port in the egress TT then creates egress timestamping (TSe) for the PTP message for external PTP network. The difference between TSi and TSe is considered as the calculated residence time spent within the 5G system for this PTP message expressed in 5GS time. If needed, the PTP port in the egress TT convert the calculated resident time in 5GS into the residence time expressed in PTP GM time e.g. by means of the factor as specified in Equation (6) of clause 12.2.2 of IEEE Std 1588 [126].\n-\tThe PTP port in the egress TT modifies the payload of the PTP Delay_Req/Pdelay_Req/Pdelay_Resp message that it sends towards the downstream PTP instance as follows:\n-\tAdds the calculated residence time to the correction field.\n-\tRemoves Suffix field that contains TSi.\nIf DS-TT and NW-TT support operating as an end-to-end Transparent Clock, then the residence time for two-step operation as an end-to-end Transparent Clock for the path and link measurements is calculated as follows:\n-\tUpon reception of a PTP Delay_Req/Pdelay_Req/Pdelay_Resp message from the upstream PTP instance, the ingress TT (i.e. NW-TT or DS-TT) makes an ingress timestamping (TSi) for the message.\n-\tIf the ingress TT receives a Pdelay_Resp message with the twoStepFlag set to FALSE, then the ingress TT modifies the twoStepFlag to TRUE and creates a PTP Pdelay_Resp_Follow_Up message.\n-\tThe ingress timestamp is conveyed to the egress TT via the PDU Session as described in clause H.2.\n-\tThe PTP port in the egress TT then creates egress timestamping (TSe) for the PTP message for external PTP network. The difference between TSi and TSe is considered as the calculated residence time spent within the 5G system for this PTP message expressed in 5GS time. If needed, the PTP port in the egress TT converts the calculated residence time in 5GS into the residence time expressed in PTP GM time, e.g. by means of the factor as specified in Equation (6) of clause 12.2.2 of IEEE Std 1588 [126]. The egress TT then stores the calculated residence time expressed in PTP GM time and removes Suffix field that contains TSi before sending the PTP Delay_Req/Pdelay_Req/Pdelay_Resp message towards the downstream PTP instance.\n-\tUpon reception of the PTP Delay_Resp message associated with the PTP Delay_Req, the egress TT for the PTP Delay_Req message (i.e. the ingress TT for the PTP Delay_Resp message) modifies the payload of the PTP Delay_Resp message that it sends towards the ingress TT of the PTP Delay_Req message (i.e. egress TT for the PTP Delay_Resp message) as follows:\n-\tAdds the (previously stored) calculated residence time to the correction field.\n-\tUpon reception (or local creation) of the PTP Pdelay_Resp_Follow_Up message associated with the previously received PTP Pdelay_Resp message, the ingress TT for the PTP Pdelay_Resp_Follow_Up message modifies the payload of the PTP Pdelay_Resp_Follow_Up message that it sends towards the egress TT for the PTP Pdelay_Resp_Follow_Up message as follows:\n-\tAdds the (previously stored) calculated residence time of the associated PTP Pdelay_Req message to the correction field.\n-\tUpon reception of the PTP Pdelay_Resp_Follow_Up message associated with the PTP Pdelay_Resp, the egress TT for PTP Pdelay_Resp_Follow_Up message modifies the payload of the PTP Pdelay_Resp_Follow_Up message that it sends towards the downstream PTP instance as follows:\n-\tAdds the (previously stored) calculated residence time of the associated PTP Pdelay_Resp messages to the correction field.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1\tDetermination of traffic pattern information",
            "description": "As described in clause 5.27.2, the calculation of the TSCAI relies upon mapping of information for the TSN stream(s) based upon certain IEEE standard information.\nAdditional traffic pattern parameters such as maximum burst size and maximum flow bitrate can be mapped to MDBV and GFBR.\nThe traffic pattern parameter determination based on PSFP (IEEE Std 802.1Q [98]), when available, is as follows:\n-\tPeriodicity of a TSN stream is set equal to StreamGateAdminCycleTime if there is only one StreamGateControlEntry with a StreamGateStatesValue set to Open in the StreamGateAdminControlList. If there is more than one StreamGateGateControlEntry with a StreamGateStatesValue set to Open in the StreamGateAdminControlList, then the Periodicity of the TSN Stream is set equal to sum of the timeIntervalValues from the first gate open instance to a next gate open instance in the StreamGateAdminControlList. For aggregated TSN streams with same periodicity and compatible Burst Arrival Times, the periodicity of the aggregated flow of these TSN Streams is set equal to StreamGateAdminCycleTime received from CNC for one of the TSN streams that are aggregated.\nNOTE 1:\tGiven that only TSN streams that have the same periodicity and compatible Burst Arrival Time can be aggregated, the StreamGateAdminCycleTime for those TSN streams is assumed to be the same.\n-\tBurst Arrival time of a TSN stream at the ingress port is determined based on the following conditions:\n-\tThe Burst Arrival Time of a TSN Stream should be set to StreamGateAdminBaseTime plus the sum of the timeIntervalValues for which the StreamGateStatesValue is Closed in the StreamGateAdminControlList until the first gate open time (i.e. until StreamGateStatesValue set to Open is found). If the StreamGateStatesValue is Open for the first timeIntervalValue, then the Burst Arrival time is set to StreamGateAdminBaseTime. For aggregated TSN streams, the arrival time is calculated similarly, but using the time interval to the first StreamGateStatesValue that is Open from the aggregated TSN streams.\n-\tBurst Size of a TSN stream at the ingress port (which is useful to map to MDBV) is determined based on the following conditions:\n-\tThe Burst Size may be determined from TSN Stream gate control operations in the StreamGateAdminControlList. If in the StreamGateAdminControlList, IntervalOctetMax is provided for a StreamGateControlEntry with an \"open\" StreamGateStatesValue, the Burst Size is set to the IntervalOctetMax for that control list entry. If IntervalOctetMax is not provided, the Burst Size is set to the timeIntervalValue (converted from ns to s) of the StreamGateControlEntry with an \"open\" StreamGateStatesValue multiplied by the port bitrate.\n-\tWhen multiple compatible TSN Streams are aggregated, the Burst Size is set to the sum of the Burst Sizes for each TSN stream as determined above.\n-\tMaximum Flow Bitrate of a TSN stream (which is useful to map to GBR) is determined as follows:\n-\tThe Maximum Flow Bitrate of a TSN Stream is equal to the summation of all timeIntervalValue (converted from ns to s) with StreamGateStatesValue = Open, multiplied by the bitrate of the corresponding port, and divided by StreamGateAdminCycleTime. For aggregated TSN streams, the same calculation is performed over the burst of aggregated streams (calculated using superposition, i.e. timeIntervalValue with StreamGateStatesValue = Open of every stream is summed up, as they are assumed to have same periodicity, compatible Burst arrival time, and same traffic class if they are to be aggregated.\nWhen CNC configures the PSFP information to the TSN AF, the TSN AF may use local information (e.g. local configuration) to map the PSFP information to an ingress port and/or egress port of the 5GS bridge.\nNOTE 2:\tAs an example, for the local configuration, the PSFP can use either the destination MAC address and VLAN identifier, or the source MAC address and VLAN identifier for stream identification. The TSN AF is pre-configured with either the MAC address of Ethernet hosts behind a given DS-TT port (identified by the DS-TT port MAC address), or the VLAN identifier used over a given DS-TT port, or both. When the TSN AF determines that one of the known Ethernet host's MAC address appears as a source or destination MAC address, it can identify that the ingress or egress port is the associated DS-TT port.\nAccording to clause 5.6.10.4 networks can provide link MTU size for UEs. A purpose of the link MTU size provisioning is to limit the size of the packets sent by the UE to avoid packet fragmentation in the backbone network between the UE and the UPF acting as PSA (and/or across the N6 reference point). Fragmentation within the backbone network creates a significant overhead. Therefore operators might desire to avoid it. This Annex presents an overhead calculation that can be used by operators to set the link MTU size provided by the network. A UE might not employ the provided link MTU size, e.g. when the MT and TE are separated, as discussed in clause 5.6.10.4. Therefore, providing an MTU size does not guarantee that there will be no packets larger than the provided value. However, if UEs follow the provided link MTU value operators will benefit from reduced transmission overhead within backbone networks.\nOne of the worst-case scenarios is when GTP packets, e.g. between a NG-RAN node and the 5GC, are transferred over IPSec tunnel in an IPv6 deployment. In that case the user packet first encapsulated in a GTP tunnel which results in the following overhead:\n-\tIPv6 header, which is 40 octets;\n-\tUDP overhead, which is 8 octets;\n-\tExtended GTP-U header, which is 16 octets.\nNOTE 1:\tThe sending of a Reflective QoS Indicator within a GTP-U header extension, or the use of Long PDCP PDU numbers at handover will further increase the GTP-U header size (see TS 29.281 [75] and TS 38.415 [116]).\nIn this scenario the GTP packet then further encapsulated into an IPSec tunnel. The actual IPSec tunnel overhead depends on the used encryption and integrity protection algorithms. TS 33.210 [115] mandates the support of AES-GMAC with a key length of 128 bits and the use of HMAC_SHA-1 for integrity protection. Therefore, the overhead with those algorithms is calculated as:\n-\tIPv6 header, which is 40 octets;\n-\tIPSec Security Parameter Index and Sequence Number overhead, which is 4+4 octets;\n-\tInitialization Vector for the encryption algorithm, which is 16 octets;\n-\tPadding to make the size of the encrypted payload a multiple of 16;\n-\tPadding Length and Next Header octets (2 octets);\n-\tIntegrity Check Value, which is 12 octets.\nIn order to make the user packet size as large as possible a padding of 0 octet is assumed. With this zero padding assumption the total overhead is 142 octets, which results a maximum user packet size of transport MTU minus 142 octets. Note that in the case of transport MTU=1500, this user packet size will result in a 1424 octets payload length to be ciphered, which is a multiple of 16, thus the assumption that no padding is needed is correct (see Figure J.1). Similar calculations can be done for networks with transport that supports larger MTU sizes.\nThe figure depicts an overhead calculation for a transport MTU of 1500 octets, illustrating the relationship between the transport MTU and the overhead required for efficient data transmission.\nFigure J-1: Overhead calculation for transport MTU=1500 octet\nThe link MTU value that can prevent fragmentation in the backbone network between the UE and the UPF acting as PSA depends on the actual deployment. Based on the above calculation a link MTU value of 1358 is small enough in most of the network deployments. However for network deployments where the transport uniformly supports for example ethernet jumbo frames, transport MTU<=9216 octets can provide a much larger UE MTU and hence more efficient transfer of user data. One example of when it can be ensured that all links support larger packet sizes, is when the UE uses a specific Network Slice with a limited coverage area.\nNote that using a link MTU value smaller than necessary would decrease the efficiency in the network. Moreover, a UE might also apply some tunnelling (e.g. VPN). It is desirable to use a link MTU size that assures at least MTU minus 220 octets within the UE tunnel to avoid the fragmentation of the user packets within the tunnel applied in the UE. In the case transport MTU is 1500 octets, this results a link MTU of 1280 octets (for the transport), which is the minimum MTU size in the case of IPv6.\nThe above methodology can be modified for calculation of the UE's link MTU when a UPF has MTU limits on the N6 reference point and is offering a PDU Session with Ethernet or Unstructured PDU Session type between the UPF and the UE.\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "K.1\tStandardized port and user plane node management information",
            "description": "Table K.1-1 and Table K.1-2 list standardized port management information and user plane node management information, respectively.\nTable K.1-1: Standardized port management information\n\nTable K.1-2: Standardized user plane node management information\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table K.1-1: Standardized port management information",
                    "table number": 54,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "Table K.1-2: Standardized user plane node management information",
                    "table number": 55,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "K.2\tPort and user plane node management information exchange for time synchronization",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "K.2.1\tCapability exchange",
                    "description": "",
                    "summary": "",
                    "text_content": "DS-TT and NW-TT indicate time synchronization information they support inside the Port management capabilities (see Table K.1-1).\nTSN AF and TSCTSF may determine the PTP functionalities supported by DS-TT and NW-TT by retrieving the following port management information or user plane node management information, respectively:\n-\tSupported PTP instance types;\n-\tSupported transport types;\n-\tSupported PTP delay mechanisms;\n-\tGrandmaster capability;\n-\tSupported PTP profiles;\n-\tNumber of supported PTP instances.\nNOTE:\tIf NW-TT or DS-TT do not indicate support for any of the PTP profiles and PTP instance types, then TSN AF or TSCTSF assume that the NW-TT or DS-TT only support acting as a PTP Relay instance with the gPTP GM connected on N6.\nIf DS-TT and NW-TT support the PTP Relay instance type as defined by IEEE 802.1AS [104] then DS-TT and NW-TT shall include the IEEE  802.1AS [104] PTP profile in the \"Supported PTP profiles\" in PMIC and UMIC, respectively.\nThe TSN AF or TSCTSF may retrieve the \"Number of supported PTP instances\" from NW-TT via UMIC and from DS-TT via PMIC.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "K.2.2\tPTP Instance configuration",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "K.2.2.1\tGeneral",
                            "text_content": "Based on input received from external applications (CNC in case of TSN AF or any AF in case of TSCTSF), TSN AF or TSCTSF may configure PTP instances (identified by PTP Instance ID) in a DS-TT or NW-TT by sending port management information (PMIC, see Table K.1-1) and user plane node management information (UMIC, see Table K.1-2) to DS-TT or NW-TT as described below:\n-\tuse PMIC \"PTP instance specification\" for configuring DS-TT(s) for PTP instance data sets common for all PTP ports (i.e. defaultDS and TimePropertiesDS), and PTP instance data sets specific for each PTP port (i.e. portDS data set);\n-\tuse UMIC \"PTP instance specification\" for configuring NW-TT for PTP instance data sets common for all PTP ports;\n-\tuse PMIC \"PTP instance specification\" for configuring NW-TT for PTP instance data sets specific for each PTP port;\n-\tuse UMIC \"Time synchronization information for DS-TT ports\" for configuring NW-TT for PTP instance data sets specific for each PTP port for the PTP ports in DS-TT(s).\nTSN AF or TSCTSF may also configure PTP instances for DS-TT ports in NW-TT by sending UMIC (see Table K.1-2) to NW-TT to enable NW-TT to operate as a grandmaster on behalf of DS-TT (see clause K.2.2.4 for more details).\nFor each PTP instance the TSN AF or TSCTSF may provide individual PTP configuration parameters or may provide a PTP profile ID to DS-TT or NW-TT. The DS-TT and NW-TT use the default values as defined in the corresponding PTP Profile, if individual PTP configuration parameters that are covered by the PTP profile are not provided.\nNOTE 1:\tEven if PTP profiles are used to configure DS-TT or NW-TT, individual PTP parameters can still be configured in addition, e.g. domain numbers, transport to use, etc.\nTo configure DS-TT and NW-TT to operate as a PTP relay instance, TSN AF or TSCTSF shall set the PTP profile (see Table K.1-1) to IEEE Std 802.1AS [104].\nDS-TT may operate as a PTP relay instance with the gPTP GM connected on N6 until the first PTP instance is configured in the DS-TT by TSN AF or TSCTSF.\nTo initialize a PTP instance in 5GS, TSN AF or TSCTSF creates a new PTP instance in NW-TT by assigning a new PTP Instance ID and indicating it to the NW-TT in \"PTP instance specification\" in UMIC and PMIC(s) for each NW-TT port that is part of the PTP instance. TSN AF or TSCTSF then retrieves the \"defaultDS.clockIdentity\" of the PTP instance in NW-TT via UMIC. NW-TT ensures that the clockIdentity in defaultDS in UMIC matches with the clockIdentity in the portDS.portIdentity in PMIC(s) for a particular PTP Instance ID.\nTo add a DS-TT port into an existent PTP instance in 5GS, the TSN AF or TSCTSF indicates the PTP Instance ID (to which the DS-TT port is being added) to the DS-TT in \"PTP instance specification\" in PMIC, and indicating the PTP Instance ID to the NW-TT in \"Time synchronization information for DS-TT ports\" in UMIC for the corresponding DS-TT port.\nFor a particular PTP instance in NW-TT, the same PTP Instance ID shall be used in \"PTP instance specification\" in PMIC, in \"PTP instance specification\" in UMIC, and in \"Time synchronization information for DS-TT ports\" in UMIC.\nNOTE 2:\tThe TSN AF or TSCTSF creates a PTP Instance in the NW-TT or DS-TT by using the \"Set parameter\" operation code as described in TS 24.539 [139]. The NW-TT or DS-TT determines that this \"Set parameter\" operation creates a new PTP Instance based on the PTP Instance ID that does not correspond to any of the configured PTP Instances in the \"PTP instance specification\" and \"Time synchronization information for DS-TT ports\" (for NW-TT) or in the \"PTP instance specification\" (for DS-TT).\nThe TSN AF or TSCTSF then initializes the PTP instance in the DS-TT by setting the applicable PTP instance data sets common for all PTP ports (i.e. defaultDS and TimePropertiesDS), (including\"defaultDS.clockIdentity\") via \"PTP instance specification\" in PMIC to the same value as retrieved from the NW-TT via \"PTP instance specification\" in UMIC. The TSN AF or TSCTSF also enables the PTP instance by setting the defaultDS.instanceEnable = TRUE to DS-TT via PMIC and to NW-TT via UMIC (if applicable). The TSN AF or TSCTSF can initialize any number of PTP instances:\na)\tamong the DS-TT(s) and NW-TT that are part of the same set of PTP instances in 5GS; up to the maximum number of supported PTP instances by the NW-TT or DS-TT that supports the lowest number of supported PTP instances; and\nb)\tin the NW-TT; up to the maximum number of supported PTP instances by the NW-TT.\nNOTE 3:\tHow the TSN AF or TSCTSF assign NW-TT port(s) of one NW-TT to different PTP instances is up to implementation.\nTo remove a DS-TT port from a PTP instance in 5GS, the TSN AF or TSCTSF deletes the PTP instance in DS-TT using PMIC and in NW-TT using UMIC as specified in TS 24.539 [139]. To remove a NW-TT port from a PTP instance in 5GS, the TSN AF or TSCTSF deletes the PTP instance in NW-TT using PMIC as specified in TS 24.539 [139]. If a PTP instance in 5GS is no more needed the TSN AF or TSCTSF may delete the PTP instance in NW-TT using UMIC as specified in TS 24.539 [139].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.2\tConfiguration for Sync and Announce reception timeouts",
                            "text_content": "The NW-TT shall be able to determine the timeout of the reception of (g)PTP Announce (when the 5GS operates as a time-aware system or Boundary Clock) and gPTP Sync messages (when the 5GS operates as time-aware system). To enable this, the TSCTSF or TSN AF shall configure the NW-TT for the following information via PMIC for each PTP port in NW-TT and \"Time synchronization information for each DS-TT port\" element in UMIC for each PTP port in DS-TT:\nportDS.announceReceiptTimeout (for time-aware system and Boundary Clock);\nportDS.syncReceiptTimeout (for time-aware system);\nportDS.logAnnounceInterval (for Boundary Clock).\nportDS.initialLogAnnounceInterval, portDS.useMgtSettableLogAnnounceInterval and portDS.mgtSettableLogAnnounceInterval (for time-aware system).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.3\tConfiguration for PTP port states",
                            "text_content": "The PTP port states may be determined by NW-TT either via:\n-\tMethod a), BMCA procedure.\n-\tMethod b), local configuration.\nWhen Method b) is used, the TSN AF or TSCTSF sets the defaultDS.externalPortConfigurationEnabled (per PTP instance) in UMIC to TRUE, and sets the value of externalPortConfigurationPortDS.desiredState (per PTP port) in UMIC for each DS-TT port and in PMIC for each NW-TT port for the (g)PTP domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.4\tConfiguration for PTP grandmaster function",
                            "text_content": "The following options may be supported (per DS-TT) for the 5GS to generate the Sync, Follow_Up and Announce messages for the Leader ports on the DS-TT:\na)\tNW-TT generates the Sync, Follow_Up and Announce messages on behalf of DS-TT (e.g. if DS-TT does not support this).\nb)\tDS-TT generates the Sync, Follow_Up and Announce messages in this DS-TT.\nTSN AF and TSCTSF may use the elements in port and user plane node management information container to determine the PTP grandmaster functionality supported by DS-TT and NW-TT and may configure the DS-TT and NW-TT ports to operate as in option a) or b) as follows:\n-\tThe \"PTP grandmaster capable\" element and the \"gPTP grandmaster capable\" element in PMIC are used to indicate the support for PTP or gPTP grandmaster capability, respectively, in each DS-TT. If the TSN AF or TSCTSF determines the DS-TT supports grandmaster capability (PTP or gPTP grandmaster capable is TRUE), then either option a) or b) can be used for the PTP instance(s) in the DS-TT. Otherwise, only option a) can be used for the PTP instance(s) in the DS-TT.\n-\tTo enable option a) for PTP ports in DS-TT, the TSN AF or TSCTSF sets the element \"Grandmaster on behalf of DS-TT enabled\" TRUE (per PTP instance per DS-TT) in UMIC for the respective DS-TT port, and the TSN AF or TSCTSF sets the element \"Grandmaster enabled\" FALSE (per PTP instance per DS-TT) in PMIC to the respective DS-TT port.\n-\tTo enable option b) for PTP ports in DS-TT, the TSN AF or TSCTSF sets the element \"Grandmaster on behalf of DS-TT enabled\" FALSE in UMIC (per PTP instance per DS-TT) for the respective port, and the TSN AF or TSCTSF sets the element \"Grandmaster enabled\" TRUE (per PTP instance per DS-TT) in PMIC to the respective DS-TT port.\n-\tTo enable either option a) or option b) for a PTP instance, the TSN AF or TSCTSF sets the element \"Grandmaster candidate enabled\" TRUE (per PTP instance) in UMIC.\n-\tWhen option b) is used for one or more PTP ports in DS-TT(s), the TSN AF or TSCTSF shall use the elements in defaultDS in PMIC for the respective DS-TT(s) and in UMIC for NW-TT to ensure that all PTP ports in the DS-TT(s) and NW-TT in particular PTP instance are distributing the same values of grandmasterPriority1, grandmasterClockQuality, grandmasterPriority2, grandmasterIdentity, and timeSource message fields in Announce messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.5\tConfiguration for Sync and Announce intervals",
                            "text_content": "The TSN AF or TSCTSF uses the values in portDS.logSyncInterval (for Boundary Clock) or portDS.initialLogSyncInterval, portDS.useMgtSettableLogSyncInterval and portDS.mgtSettableLogSyncInterval (for time-aware system) to configure the interval for the Sync messages (per PTP port) as described in IEEE Std 1588 [126] or IEEE Std 802.1AS [104], respectively. The TSCTSF or TSN AF configures those values as follows:\n-\tTSCTSF or TSN AF use PMIC to configure the values for the PTP ports in NW-TT.\n-\tTSCTSF or TSN AF use the \"Time synchronization information for each DS-TT port\" element in UMIC to configure the values for PTP ports in DS-TT(s) if NW-TT acts as GM on behalf of those DS-TTs.\n-\tTSCTSF or TSN AF use PMIC to configure the values for the PTP ports in DS-TT if the DS-TT is capable of acting as a GM.\nWhen the NW-TT generates the (g)PTP Sync messages on behalf of the DS-TT, the NW-TT uses the values in the element \"Time synchronization information for each DS-TT port\" in UMIC to determine the Sync interval for the PTP ports the respective DS-TT. When DS-TT generates the (g)PTP Sync messages, the DS-TT uses the values in PMIC to determine the Sync interval for the PTP ports in this DS-TT.\nThe TSN AF or TSCTSF uses the values in portDS.logAnnounceInterval (for Boundary Clock) or portDS.initialLogAnnounceInterval, portDS.useMgtSettableLogAnnounceInterval and portDS.mgtSettableLogAnnounceInterval (for time-aware system) to configure the interval for the Announce messages (per PTP port) as described in IEEE Std 1588 [126] and IEEE Std 802.1AS [104], respectively. The TSCTSF or TSN AF configures those values as follows:\n-\tTSCTSF or TSN AF use PMIC to configure the values for the PTP ports in NW-TT.\n-\tTSCTSF or TSN AF use the \"Time synchronization information for each DS-TT port\" element in UMIC to configure the values for PTP ports in DS-TT(s) if NW-TT acts as GM on behalf of those DS-TTs.\n-\tTSCTSF or TSN AF use PMIC to configure the values for the PTP ports in DS-TT if the DS-TT is capable of acting as a GM.\nWhen the NW-TT generates the (g)PTP Announce messages on behalf of the DS-TT, the NW-TT uses the values in the element \"Time synchronization information for each DS-TT port\" in UMIC to determine the Announce interval for the PTP ports the respective DS-TT. When DS-TT generates the (g)PTP Announce messages, the DS-TT uses the values in PMIC to determine the Announce interval for the PTP ports in this DS-TT.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "K.2.2.6\tConfiguration for transport protocols",
                            "text_content": "The procedure described in this clause is applicable when the PTP Profile that is used for the PTP instance in 5GS defines multiple permitted transport protocols.\nTSN AF or TSCTSF may use the element \"Supported transport types\" in port management information container (per DS-TT) to determine the supported transport types in the DS-TT. TSN AF or TSCTSF may use the element \"Supported transport types\" in UMIC (per NW-TT) to determine the supported transport types in the NW-TT.\nThe TSN AF or TSCTSF may use the element \"Transport type\" (per PTP instance) in PMIC to configure the transport protocol in use for the PTP instance in DS-TT. The TSN AF or TSCTSF may use the element \"Transport type\" (per PTP instance) in UMIC to configure the transport protocol in use for the PTP instance in NW-TT.\nThe PTP instance shall be configured to use one of the following transport protocols:\n1)\tEthernet as described in Annex E of IEEE Std 1588 [126]. The Ethertype as defined for PTP shall be used. The related Ethernet frames carry the PTP multicast Ethernet destination MAC address.\n2)\tUDP over IPv4 as described in Annex C of IEEE Std 1588 [126],\n3)\tUDP over IPv6 as described in Annex D of IEEE Std 1588 [126].\nOption 1 applies to Ethernet PDU Session type. Options 2 and 3 apply to IP PDU Session type or Ethernet PDU Session type with IP payload.\nThis annex applies when the SMF+PGW-C is enhanced to support UE accessing the network via GERAN/UTRAN over Gn/Gp interface. For this scenario, the SMF+PGW-C uses N7 interface to interact with PCF and the N40 interface to interact with CHF.\nNOTE 1:\tFor the interface with the serving node of the UE, the SMF+PGW-C is assumed to behave as the Control Plane of the PGW described in Annex D of TS 23.401 [26].\nSMF+PGW-C selection by SGSN is specified in Annex G of TS 23.502 [3].\nThe SMF+PGW-C interacting with PCF for GERAN/UTRAN access is specified in Annex G of TS 23.502 [3].\nThe functional description for SMF+PGW-C interacting with PCF to support GERAN/UTRAN access is specified in TS 23.503 [45].\nNOTE 2:\tSupport for IP address preservation upon mobility between 5GS and GERAN/UTRAN for PDN sessions established in EPC is described in clause 5.17.2.4. IP address preservation is not supported for direct mobility between 5GS and GERAN/UTRAN, nor for indirect mobility cases when the PDN session is established in 5GS or in GERAN/UTRAN.\nThe charging services on SMF+PGW-C interactions with CHF for GERAN/UTRAN access are specified in TS 32.255 [68].\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "M.1\tMapping of the parameters between 5GS and TSN UNI",
            "description": "Editor's note:\tThe information provided here is a guidance for better understanding of the function. Content of this Annex will be updated to a functional level detail once stage 3 work is stable.\nThe details of the parameters in the TSN UNI are specified in IEEE Std 802.1Q [98] and IEEE P802.1Qdj [146]. Stream identification is further specified in IEEE Std 802.1CB [83] and IEEE Std 802.1CBdb [178].\nThe SMF/CUC derives the End Station related information for the stream requirements towards the TN CNC for the QoS Flow as follows:\na)\tFor the Talker group:\n‐\tStreamID: can be generated by the SMF/CUC based on the End Station MAC address acting as Talker and a UniqueID. SUPI, PDU Session ID and QFI may be used to derive the UniqueID. The MAC address is either pre-configured at the SMF/CUC or provided by the AN-TL or CN-TL to the SMF/CUC (e.g. as part of the EndStationInterfaces information).\n-\tStreamRank: set to zero for ARP priority values 1-8; set to one for other ARP values.\n‐\tEndStationInterfaces: If the AN-TL and CN-TL are supported, the SMF/CUC receives the EndStationInterfaces (MacAddress, InterfaceName) from the AN-TL and CN-TL via TL-Container. If the AN-TL and CN-TL are not supported the SMF/CUC sets the information based on pre-configuration.\n-\tDataFrameSpecification (optional): When it is present it specifies how the TN can identify packets of the TN stream using Ethernet, IP and transport protocol header fields in order to apply the required TSN configuration.\nThe SMF/CUC may derive the DataFrameSpecification based on:\n-\tN3 tunnel end point addresses that are used for the QoS Flow. The SMF/CUC may instruct the UPF and NG-RAN to assign a separate N3 tunnel end point address for each QoS Flow that may carry TSC streams so that the TN can distinguish the QoS Flows based on the N3 tunnel destination IP addresses.\nNOTE 1:\tIPv6 can be used in the N3 tunnel end point addresses to provide sufficient address space in case separate N3 tunnel end point addresses are used for each QoS flow that can carry time sensitive streams.\n-\tMask-and-match stream identification parameters (IEEE 802.1CBdb [178] clause 9.1.6) (optional). The SMF/CUC may indicate mask-and-match configuration based on the TEID and QFI of the given QoS flow and the destination IP address to the TN CNC, when the deployment supports mask-and-match stream identification function as defined in clause 6.8 in IEEE Std 802.1CBdb [178]. This functionality can be used for example to check for the TEID and QFI in the GTP header and the destination IP address to distinguish the QoS Flows. This enables the TN CNC to configure the mask-and-match stream identification function in the transport network. This is an option that allows to use a single GTP-U tunnel as defined for non-TSN Transport networks.\nThe DataFrameSpecification or mask-and-match stream identification parameters may be provided to the AN-TL and CN-TL to configure stream identification. In that case, the AN-TL and CN-TL can perform the stream identification without relying on additional information from the upper layers of the AN or CN node.\nWhen AN-TL and CN-TL are not supported the TN CNC configures the edge bridge to perform the stream transformation based on the provided the DataFrameSpecification or mask-and-match parameters when applicable.\n‐\tTrafficSpecification elements:\n‐\tInterval: derived from the Periodicity of the traffic as indicated in the TSCAI.\n‐\tMaxFramesPerInterval: specifies the maximum number of frames that the Talker transmits in one Interval.\n‐\tMaxFrameSize: derived from the MDBV of the QoS Flow. If the PCF determines interworking with a TSN network deployed in the transport network is supported based on the DNN/S-NSSAI of the PDU Session, the PCF generates MDBV based on the Burst Size as described in clause 5.27.3 and the PCF transfers the MDBV to the SMF/CUC. The SMF/CUC sets MaxFrameSize based on the following formula: MDBV of the QoS Flow - the framing bits which is not used for transferring in 5GS, (e.g. CRC + the GTP-U tunnel overhead).\n-\tTransmissionSelection: specifies the algorithm that the Talker uses to transmit the Stream's traffic class. If no algorithm is known, the value zero (strict priority) is used.\n‐\tTSpecTimeAware group (optional, present only if the traffic in the QoS Flow is time-synchronized):\n‐\tEarliestTransmitOffset: the earliest offset within the Interval.\nFor uplink, EarliestTransmitOffset should be set based on the following formula:\nPacket arrival time at the Talker (UL) - M x Interval, where M is the largest integer for which the relation:\nPacket arrival time at the Talker (UL) > M x Interval duration.\nwould be true.\nPacket arrival time at the Talker (UL) should be: TSCAC BAT in UL direction (presented in TAI time and corrected for clock drifting as specified in the present specification) + UE-DS-TT Residence Time.\nFor downlink, EarliestTransmitOffset should be set based on the following formula:\nPacket arrival time at the Talker (DL) - M x Interval, where M is the largest integer for which the relation:\nPacket arrival time at the Talker (DL) > M x Interval duration.\nwould be true.\nPacket arrival time at the Talker (DL) should be TSCAC BAT in DL direction (presented in TAI time and corrected for clock drifting as specified in the present specification).\n‐\tLatestTransmitOffset: the last chance within an interval should leave enough time to transfer a packet with MaxFrameSize. Derived from the end of the interval, the time to transfer a packet with MaxFrameSize. The LatestTransmitOffset shall be set to the Buffer Capability when the value of LatestTransmitOffset subtracted by the packet arrival time at the Talker (either UL or DL respectively as described in EarliestTransmitOffset) exceeds the Buffer capability. The value of LatestTransmitOffset shall be larger or equal than EarliestTransmitOffset.\n‐\tJitter: derived in SMF/CUC based on local information on Jitter in AN-TL and CN-TL and respective stream and traffic interference. Annex U, clauses U.1.1, U.1.2, and U.1.3 of IEEE Std 802.1Q [98] provide some examples.\n‐\tUserToNetworkRequirements:\n‐\tNumSeamlessTrees: set to one (no redundancy) or other value (if redundancy is required).\n‐\tMaxLatency: set to CN PDB subtracted by maximum possible buffer duration in Talker. Maximum possible buffer duration is set to LatestTransmitOffset subtracted by EarliestTransmitOffset.\n-\tInterfaceCapabilities (optional): If the AN-TL and CN-TL are supported, the SMF/CUC collects InterfaceCapabilities from AN-TL and CN-TL via TL-Container. If the AN-TL and CN-TL are not supported, the SMF/CUC leaves the InterfaceCapabilities empty.\nb)\tFor the Listener group:\n-\tStream ID and Stream Rank: that were generated for the Talker of the TN stream are also used by the SMF/CUC for the Listener.\n-\tEndStationInterfaces: derived as with the corresponding information for the Talker group.\n-\tUserToNetworkRequirements:\n‐\tNumSeamlessTrees: set to one.\n‐\tMaxLatency: derived as with the corresponding information for the Talker group.\n-\tInterfaceCapabilities: derived as with the corresponding information for the Talker group.\nc)\tFor the Status group: The Status group contains the end station communication-configuration provided by TN CNC to the SMF/CUC:\n‐\tStream ID.\n‐\tStatusInfo.\n‐\tAccumulatedLatency: If the AccumulatedLatency is included from TN CNC to SMF/CUC for a stream in DL direction, the SMF/CUC may use the AccumulatedLatency to update the TSCAI BAT to the NG-RAN; the SMF sets the TSCAI Burst Arrival Time in downlink direction as the sum of the TSCAC BAT value in downlink direction and AccumulatedLatency and the buffer duration in Talker in CN-TL. The buffer duration in CN-TL is zero if TimeAwareOffset for the Talker group is not present, and TimeAwareOffset - EarliestTransmitOffset if the TimeAwareOffset is present for the Talker group.\n‐\tInterfaceConfiguration (optional):\n‐\tMAC Address (optional, present only if the respective InterfaceCapability contains a value for Active Destination MAC and VLAN Stream identification in CB-StreamIdenTypeList, and stream transformation is performed in AN-TL and CN-TL).\n‐\tVLAN Tag (optional, present only if the respective InterfaceCapability contains that it is VlanTagCapable and a value for Active Destination MAC and VLAN Stream identification in CB-StreamIdenTypeList, and the stream transformation is performed in AN-TL and CN-TL).\n‐\tIPv4/IPv6 Tuples (optional, but not supported in this release of the specification).\n‐\tTimeAwareOffset (optional, present only if the traffic is time-synchronized, AN-TL and CN-TL is supported, and TSpecTimeAware elements were provided in the stream requirements).\nIf the InterfaceConfiguration is included and if the AL-TL/CN-TL acting as Talker End Station support the Stream Transformation as described in IEEE Std 802.1Q [98], the SMF/CUC can instruct the UPF and NG-RAN to assign an individual TSN Transport address by providing the InterfaceConfiguration to the AN-TL/CN-TL via TL-Container. The Talker in AN-TL/CN-TL shall use the indicated InterfaceConfiguration, e.g. source MAC address, multicast destination MAC address, VLAN ID, as assigned by the TN CNC for the data stream in a QoS Flow. The TN can identify the streams based on the Stream Transformation that is applied in the AN-TL/CN-TL acting as Taker End Station. This allows to use a single GTP-U tunnel as defined for non-TSN Transport networks.\nIf the TimeAwareOffset is included from TN CNC to SMF/CUC, the SMF/CUC should send the TimeAwareOffset to the AN-TL (for streams in UL direction) or the CN-TL port (for streams in the DL direction). The AL-TL/CN-TL derive Gate Control information (i.e. AdminBaseTime, AdminCycleTime, AdminControlListLength, and AdminControlList) based on the TimeAwareOffset as defined in IEEE Std 802.1Q [98] at the AN-TL (for streams in UL direction) and the CN-TL port (for streams in the DL direction). The AN-TL or CN-TL acting as Talker buffers the data burst until the time indicated in the TimeAwareOffset is reached.\nIf the SMF/CUC receives a TimeAwareOffset from TN CNC for a downlink stream (i.e. for a Talker in the UPF/CN-TL), the SMF/CUC adds the received TimeAwareOffset value to the TSCAI BAT in the DL direction in the TSCAI and updates the NG-RAN for the new TSCAI.\n‐\tFailedInterfaces (optional) provides a list of one or more physical ports of failed end stations or bridges to locate the interfaces in the physical topology that caused the failure. It is up to implementation how the SMF reacts when it receives FailedInterfaces.\nNOTE 2:\tIt is assumed that the end station communication-configuration will contain at least the same information as defined for the status.\nNOTE 3:\tIf Jitter value needs to be considered, EarliestTransmitOffset for UL and DL and LatestTransmitOffset shall be Jitter corrected. How Jitter correction is carried out is up to implementation.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "M.2\tTL-Container Information",
            "description": "Table M.2-1: TL-Container Information\n\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table M.2-1: TL-Container Information",
                    "table number": 56,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.1\tGeneral",
            "description": "A Localized Service is a service, which is provided at specific/limited area and/or can be bounded in time. The service can be realized via applications (e.g. live or on-demand audio/video stream, electric game, IMS, etc.), or connectivity (e.g. UE to UE, UE to Data Network, etc.).\nA Localized Service provider is an application provider or network operator who make their services localized and that are offered to the end user via a network. A network providing Localized Services can be an SNPN or a PNI-NPN.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.2\tEnabling access to Localized Services",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "N.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "To enable a PNI-NPN or SNPN to provide access to Localized Services, the PNI-NPN or SNPN operator configures the network with information enabling the UEs to access the Localized Services using the PNI-NPN or SNPN according to any validity of the Localized Services, and the information is determined in agreement with the Localized Service Provider e.g.:\na.\tIdentification of each Localized Service, e.g. to be used in URSP rules.\nb.\tvalidity restriction for each Localized Service, e.g. the validity of time and/or location.\nc.\tservice parameters for each Localized Service, e.g. DNN, S-NSSAI and QoS requirements.\nd.\tservice authorization methods, e.g. NSSAA or Secondary authentication/authorization during PDU Session establishment.\nTo allow the UE to access the PNI-NPN providing access to Localized Services using credentials of the HPLMN, the PNI-NPN can be configured based on the Localized Service agreements between the PNI-NPN and the HPLMN, to allow primary authentication towards the HPLMN.\nTo allow the UE to access the SNPN providing access to Localized Services using credentials of the Credentials Holder, the SNPN can be configured based on Localized Service agreements between the SNPN and the Credentials Holder, to allow primary authentication towards the Credentials Holder.\nTo allow the UE to access the SNPN providing access to Localized Services when new credential is required, the SNPN can provide UE onboarding function as specified in clause 5.30.2.10 for the UE to obtain credential and necessary information to access the SNPN, or the UE can leverage existing credential and network connection to get access to a PVS via User Plane to obtain new credential.\nTo allow the UE to access the PNI-NPN providing access to the Localized Services where NSSAA or secondary authentication/authorization during PDU session establishment is required, the UE can obtain new credential using remote provisioning functionality as defined in clause 5.39.\nTo allow the UE to access the HPLMN or subscribed SNPN services while being registered in the PNI-NPN or SNPN, the PNI-NPN or SNPN can establish service agreements and configure inter-connect with the HPLMN or subscribed SNPN operator. If a PNI-NPN is providing access to the Localized Services, the existing roaming architecture with home-routed PDU Sessions are used. If an SNPN is providing access to the Localized Services, then the UE can access HPLMN or subscribed SNPN as described in Annex D, clauses D.3, D.6 and D.7.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.2.2\tConfiguration of network to provide access to Localized Services",
                    "description": "",
                    "summary": "",
                    "text_content": "For configuring the PNI-NPN or SNPN (e.g. creation of network slice/DNN for carrying Localized Service traffic), existing OAM mechanisms can be re-used as per TS 28.557 [148] clause 6.3.1, that provides a solution for NPN provisioning by a network slice of a PLMN and for exposure of management capability of PNI-NPN (clause 6.3.2). The attributes to support this management is further documented in TS 28.541 [149].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.2.3\tSession Management aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "For session management level information and interactions such as monitoring the PNI-NPN or SNPN performance, and enabling suitable QoS for UE in the PNI-NPN or SNPN for Localized Service, the following non-exhaustive options can be used:\n-\tCovered by the SLA between the PNI-NPN or SNPN operator and the Localized Service Provider.\n-\tReuse the existing network exposure procedures as specified in TS 23.502 [3] clause 4.15, where the Localized Service Provider is taking the AF role and utilizing the exposure capability provided by the PNI-NPN or SNPN.\n-\tEnable NEF/PCF in the PNI-NPN or SNPN providing access to the Localized Services (via AF of the Localized Service Provider) to receive and forward the validity conditions and QoS requirements of the Localized Services to the AMF/SMF by reusing the existing PCF initiated AM/SM policy association procedures described in TS 23.502 [3] clause 4.16.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "N.3\tSelection of network providing access to Localized Services",
            "description": "The UE selects an SNPN providing access for Localized Services as described in clause 5.30.2.4.2, clause 5.30.2.4.3 and in TS 23.122 [17].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.4\tEnabling the UE access to Localized Services",
            "description": "The access to a Localized Service is made available in a specific area and/or a specific period of time.\nAfter the UE has successfully registered to a PNI-NPN/SNPN providing access to the Localized Service, the UE can be configured with URSP rules using existing principles (see clause 6.6.2.2 of TS 23.503 [45]).\nThe URSP rules can include an association between the UE application and the DNN/S-NSSAI which is meant for a particular Localized Service. The URSP rules can also include \"Route Selection Validation Criteria\" as described in Table 6.6.2.1-3 of TS 23.503 [45], with the time/location defined for the particular Localized Service.\nThe existing LADN feature described in clause 5.6.5 can also be used for enabling the UE access to Localized Service which is defined by a LADN DNN. The S-NSSAI used for a Localized Service can be restricted to a specific area and time as described in clause 5.15.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.5\tSupport for leaving network that provides access to Localized Services",
            "description": "When Localized Services in a network are completed, all UEs that are registered with the network are expected to be transferred to other network or to other network resources (e.g. other cells) within the same network, potentially within a relatively short timeframe. The other network can be HPLMN, VPLMN or another SNPN.\nUE can stop using the network resources for Localized Services for numerous reasons, e.g. when one or more of the following conditions apply:\n-\tLocalized Services in a network are completed.\n-\tValidity conditions of network selection information are no longer met.\n-\tThe user decides to stop using the Localized Services before they are completed.\n-\tA policy decision is taken by the network, with the effect that the UE is deregistered before the Localized Services are completed.\nNOTE:\tThe list is not an exhaustive list and UE can stop using the network resources for Localized Services due to other reasons e.g. UE loses coverage, power off.\nWhen large number of UEs move to other network (i.e. HPLMN, VPLMN or another SNPN) or other network resources within a relatively short timeframe, the total signalling involved can cause signalling overload in the target network.\nExisting mechanisms for Control Plane Load Control, Congestion and Overload Control described in clause 5.19 and access control and barring described in clause 5.2.5 can be used to mitigate the signalling overload caused by returning UEs. For further enhancement of mitigation of signalling overload, additional mechanisms can be implemented to ensure spreading of the load that returning UEs cause. Such mechanisms are implementation-specific, but some guidelines that can be considered are described below:\n-\tThe time validity of the network selection information given to a UE can be set somewhat longer than the actual duration of the service, e.g. users will by themselves disable Localized Service and the UE then stops using the connectivity to access the Localized Service, thus causing the UE to be moved, e.g. by performing normal network selection.\n-\tThe time validity of the network selection information given to a UE can be different for each UE so that each UE performs network selection at a different time to distribute returning UEs.\n-\tWhen the AMF after end of Localized Services triggers deregistration of UEs, the deregistration requests can be sent at a certain rate in an adaptive and distributed manner, with the effect that the signalling load on both the source network and the target network is limited.\n-\tWhen the AMF after end of Localized Services triggers UE configuration update procedure, e.g. to remove S-NSSAI from the Allowed NSSAI (if dedicated S-NSSAI is used for the Localized Service), the requests can be sent at a certain rate, with the effect that the signalling load in the network is limited.\nWhen the NAS level congestion control is activated at AMF as specified in clause 5.19.7.2, to prevent a UE staying in an SNPN for accessing for Localized Services but not able to get services from the SNPN due to the congestion, additional mechanism can be implemented. Such mechanisms are implementation-specific but some guidelines that can be considered are described below:\n-\tthe AMF can determine whether to reject the UE with a proper cause without Mobility Management back-off timer to allow the UE to reselect another SNPN for Localized Services.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.6\tConfiguration of Credentials Holder for determining SNPN selection information",
            "description": "To enable the HPLMN or the subscribed SNPN acting as Credentials Holder to generate and provision UEs with SNPN selection information for discovery and selection of SNPNs providing Localized Services, based on Localized Service agreements between the Localized Service Provider or the SNPN providing Localized Services and the HPLMN or the subscribed SNPN acting as Credentials Holder, the Localized Service Provider or the SNPN providing access to Localized Services can provide configuration information for SNPN selection to the HPLMN or the subscribed SNPN acting as Credentials Holder. The configuration information for SNPN selection may contain at least one of the following parameters:\na.\tSNPN ID or GIN of the SNPN providing access to one or more Localized Services;\nb.\tIdentification of each Localized Service;\nc.\tvalidity information for each Localized Service, e.g. the validity time information or/and location assistance information; and/or\nd.\tList of UE IDs (e.g. GPSIs or External Group ID) identifying the UEs subscribed with a Localized Service.\nNOTE:\tHow HPLMN or subscribed SNPN obtains the information above as part of the Localized Service agreements is out of 3GPP scope.\nThe operator of the HPLMN or the subscribed SNPN acting as Credentials Holder then may use the information received from the SNPN providing Localized Services and/or Localized Service Provider to create or update the Credentials Holder controlled prioritized lists of preferred SNPNs/GINs for accessing Localized Services and provision the UEs using the Steering of Roaming procedure as defined in TS 23.122 [17].\n\nThis Annex provides deployment examples allowing a UE to simultaneously send data to different groups (i.e. IP or Ethernet multicast groups) with different QoS policy as in clause 6.13.2 of TS 22.261 [2].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "O.1\tA PDU Session with multiple QoS Flows for different groups",
            "description": "In case the UE Application sends individual copies of data to different receivers, 5GS allows UE to simultaneously send data to different groups with different QoS policy via the following:\n-\tIf different groups (IP or Ethernet multicast groups) are associated to the same DNN and S-NSSAI combination used for a 5G VN group, then different QoS Flows of a single PDU Session may be used to transfer the data copy sent to different groups.\nFigure O.1-1 shows a PDU Session with multiple QoS Flows for different groups as an example.\n-\tGroup1 (G1): a group of multicast address 1 with members UE1 and UE2 is associated with 5GVN.A group. The QoS for multicast address 1 is set to QoS1. For G1, its members, multicast address 1 and corresponding QoS1 are provisioned as part of the AF requested QoS information as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tGroup2 (G2): a group of multicast address 2 with members UE1 and UE3 is associated with 5GVN.A group. The QoS for multicast address 2 is set to QoS2. For G2, its members, multicast address 2 and corresponding QoS2 are provisioned as part of the AF requested QoS information as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tDuring establishment or modification procedure for PDU Sessions targeting to DNN and S-NSSAI for 5GVN.A group, or upon detection of the UE joining a multicast address, the SMF and PCF can jointly use the AF requested QoS information for 5GVN.A group to set up the QoS flow in respective member's PDU Session. As a result:\n-\tThere will have two QoS flows in UE1's PDU Session targeting to DNN and S-NSSAI for 5GVN.A group, one QoS flow (QoS Flow 1.1) is used to carry data destined to multicast address 1 with QoS1, the other one (QoS Flow 1.2) is used to carry data destined to multicast address 2 with QoS2.\n-\tThere will have one QoS flow (QoS Flow 2) in UE2's PDU Session targeting to DNN and S-NSSAI for 5GVN.A group, this QoS flow is used to carry data destined to multicast address 1 with QoS1.\n-\tThere will have one QoS flow (QoS Flow 3) in UE3's PDU Session targeting to DNN and S-NSSAI for 5GVN.A group, this QoS flow is used to carry data destined to multicast address 2 with QoS2.\n-\tUE1 sends data with multicast address 1 (MA.1) to a UPF via QoS Flow 1.1 of UE1's PDU session for 5GVN.A group. The UPF forwards the packet to UE2 as it is a member of multicast group represented by multicast address 1 via QoS Flow 2 of UE2's PDU Session for 5GVN.A group.\n-\tUE1 also sends the same data with multicast address 2 (MA.2) to the UPF via QoS Flow 1.2 of the same PDU Session for 5GVN.A group. The UPF forwards the packet to UE3 as it is a member of multicast group represented by multicast address 2 via QoS Flow 3 of UE3'sPDU Session for 5GVN.A group.\nThe figure depicts a PDU session with multiple QoS Flows for different groups, illustrating the various QoS levels and their corresponding flows. The PDU is a central device in a network, responsible for managing and routing data packets. The figure shows the different QoS levels, such as Low, Medium, and High, and their corresponding flows, which are essential for ensuring the quality of service (QoS) for different applications and services. The figure also highlights the importance of network management and the role of the PDU in managing the network traffic and ensuring the smooth functioning of the network.\nFigure O.1-1: A PDU Session with multiple QoS Flows for different groups\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "O.2\tMultiple PDU Sessions for different groups",
            "description": "In the case that the UE Application sends individual copies of data to different receivers, 5GS allows UE to simultaneously send data to different groups with different QoS policy via the following:\n-\tIf different groups (IP or Ethernet multicast groups) are associated to different DNN and S-NSSAI combinations used for different 5G VN groups, then different PDU Sessions are used to transfer the data copy sent to different groups. As a result, the UE sends the same data to different groups using the QoS Flow of the respective PDU Sessions.\nFigure O.2-1 shows multiple PDU sessions used for different groups as an example.\n-\tGroup1 (G1): a group of multicast address 1 with members UE1 and UE2 is associated with 5GVN.1 group. The QoS for multicast address 1 is set to QoS1. For G1, its members, multicast address 1 and corresponding QoS1 are provisioned as part of the AF requested QoS information as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tGroup2 (G2): a group of multicast address 2 with members UE1 and UE3 is associated with 5GVN.2 group. The QoS for multicast address 2 is set to QoS2. For G2, its members, multicast address 2 and corresponding QoS2 are provisioned as part of the AF requested QoS information as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tDuring establishment or modification procedure for PDU Sessions targeting to DNN and S-NSSAI for 5GVN.1 group, or upon detection of the UE joining a multicast address, the SMF and PCF can jointly use the AF requested QoS information for 5GVN.1 group to set up the QoS flow in respective member's PDU Session. During establishment or modification procedure for PDU Sessions targeting to DNN and S-NSSAI for 5GVN.2 group, or upon detection of the UE joining a multicast address, the SMF and PCF can jointly use the AF requested QoS information for 5GVN.2 group to set up the QoS flow in respective member's PDU Session. As a result:\n-\tThere will have two PDU Sessions for UE1: one PDU Session is targeting to DNN and S-NSSAI for 5GVN.1 group and there will have one QoS flow setup to carry data destined to multicast address 1 with QoS1; the other PDU Session is targeting to DNN and S-NSSAI for 5GVN.2 group and there will have one QoS flow setup to carry data destined to multicast address 2 with QoS2.\n-\tThere will have one PDU Session for UE2: this PDU Session is targeting to DNN and S-NSSAI for 5GVN.1 group and there will have one QoS flow setup to carry data destined to multicast address 1 with QoS1.\n-\tThere will have one PDU Session for UE3: this PDU Session is targeting to DNN and S-NSSAI for 5GVN.2 group and there will have one QoS flow setup to carry data destined to multicast address 2 with QoS2.\n-\tUE1 sends data with multicast address 1 (MA.1) to a UPF via the QoS Flow of UE1's PDU session for 5GVN.1 group. The UPF forwards the packet to UE2 as it is a member of multicast group represented by multicast address 1 via the QoS Flow of UE2's PDU Session for 5GVN.1 group.\n-\tUE1 also sends the same data with multicast address 2 (MA.2) to the UPF via the QoS Flow of UE1's PDU Session for 5GVN.2 group. The UPF forwards the packet to UE3 as it is a member of multicast group represented by multicast address 2 via the QoS Flow of UE3's PDU Session for 5GVN.2 group.\nThe figure depicts a network setup with multiple PDU (Physical Device Unit) sessions, each representing a different group of users. The sessions are organized in a hierarchical manner, with the top-level session representing the network's primary group, and the lower-level sessions representing secondary groups. This arrangement allows for efficient network management and ensures that users can access the resources they need, regardless of their position in the hierarchy.\nFigure O.2-1: Multiple PDU Sessions for different groups\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "O.3\tA PDU Session targeting a predefined group formed of multiple sub-groups",
            "description": "In the case when the UE Application uses IP or Ethernet multicast, 5GS allows UE to simultaneously send data to different groups with different QoS policy via the following:\n-\tUE establishes a PDU Session to a DNN and S-NSSAI, which can be a special DNN and S-NSSAI configured by the operator for e.g. an electrical system. The DNN and S-NSSAI is associated with a 5GVN group, which is defined as a combination of multiple sub-groups (IP or Ethernet multicast groups).\n-\tThe 5G VN group and each sub-group is associated with a separate multicast address and QoS, the QoS for a 5G VN group is set to refer to the QoS of the sub-group that has the strictest QoS requirements among all the sub-group groups. When a UE belongs to multiple groups, the QoS provisioning for the groups needs to be done in the order that enables the the strictest QoS profile to be selected for the UE. For each group, its members, multicast address, corresponding QoS information, associated DNN and S-NSSAI are provisioned as part of the AF requested QoS information as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tThe application sends traffic to a multicast address depending on which group(s) it wants to target. For example, an application sends traffic to the multicast address associated with the 5G VN group. This allows an application to send a single packet reaching multiple destinations and also multiple groups.\nFigure O.3-1 shows a PDU Session targeting a predefined group formed of multiple sub-groups as an example.\n-\tGroup1 (G1): a group of multicast address 1 with members UE1 and UE2 is associated with / mapped to 5GVN.1 group. The QoS for the group is set to QoS1. For G1, its members, multicast address 1, corresponding QoS1, DNN and S-NSSAI are provisioned as part of the AF requested QoS information for 5GVN.1 group as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tGroup2 (G2): a group of multicast address 2 with members UE1 and UE3 is associated with / mapped to 5GVN.2 group. The QoS for the group is set to QoS2. For G2, its members, multicast address 2 and corresponding QoS2, DNN and S-NSSAI are provisioned as part of the AF requested QoS information for 5GVN.2 group as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tGroupA (GA): a group of multicast address A with members UE1, UE2 and UE3 is associated with 5GVN.A group. G1 and G2 are combined to form the GA. The QoS for the 5GVN.A group is indicated to refer to the strictest QoS among other groups the UE belongs to. For GA, its members, multicast address A and corresponding QoS indication, DNN and S-NSSAI are provisioned as part of the AF requested QoS information for 5GVN.A group as described in clause 6.1.3.28 of TS 23.503 [45].\n-\tDuring establishment or modification procedure for PDU Sessions targeting to the DNN and S-NSSAI, or upon detection of the UE joining a multicast address, the SMF and PCF can jointly use the AF requested QoS information to set up the QoS flow in respective member's PDU Session. As a result:\n-\tThere will have two QoS flows in UE1's PDU Session targeting to DNN and S-NSSAI, one QoS flow is used to carry data destined to multicast address 1 with QoS1, the other one is used to carry data destined to multicast address 2 with QoS2. With the QoS indication for GA, the higher QoS between QoS1 of G1 and QoS2 of G2 is selected for UE1 since the UE1 belongs to both the G1 and G2, then the QoS flow with higher QoS requirements (QoS Flow 1) is also used to carry data destined to multicast address A.\n-\tThere will have one QoS flow in UE2's PDU Session targeting to DNN and S-NSSAI, this QoS flow (QoS Flow 2) is used to carry data destined to multicast address 1 with QoS1. With the QoS indication for GA, the QoS1 of G1 is selected for UE1 since the UE2 only belongs to G1, then the same QoS flow is also used to carry data destined to multicast address A.\n-\tThere will have one QoS flow in UE3's PDU Session targeting to DNN and S-NSSAI, this QoS flow (QoS Flow 3) is used to carry data destined to multicast address 2 with QoS2. With the QoS indication for GA, the QoS2 of G2 is selected for UE3 since the UE3 only belongs to G2, then the same QoS flow is also used to carry data destined to multicast address A.\n-\tUE1 sends data with multicast address A (MA.A) to a UPF via QoS Flow 1 of UE1's PDU Session for 5GVN.A group. The UPF forwards the packet to UE2 as it is a member of multicast group represented by multicast address A (MA.A) via the QoS Flow 2 of UE2's PDU Session and forwards the packet to UE3 as it is a member of the multicast group represented by multicast address A (MA.A) via the QoS Flow 3 of UE3's PDU Session.\nThe figure depicts a PDU session targeting a predefined group formed of multiple sub-groups, illustrating the hierarchical structure of a network.\nFigure O.3-1: A PDU Session targeting a predefined group formed of multiple sub-groups\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "P.1\tPIN Reference Architecture",
            "description": "Figure P.1-1 shows the logical PIN reference architecture.\nThe figure depicts a PIN reference architecture, which is a simplified representation of a physical layer network interface controller (PLNC) in a 5G network. It illustrates the various components and their connections, including the base station (BSC), user equipment (UE), and the physical layer (PHY) network. The figure highlights the importance of redundancy and failover mechanisms to ensure reliable communication in a 5G network.\nFigure P.1-1: PIN reference architecture\nA Personal IoT Network (PIN) in 5GC consists of one or more devices providing gateway/routing functionality known as the PIN Element with Gateway Capability (PEGC), and one or more devices providing PIN management functionality known as the PIN Element with Management Capability (PEMC) to manage the Personal IoT Network; and device(s) called the PIN Elements (PINE). A PINE can be a non-3GPP device.\nThe PIN service can also have an AF for PIN (see TS 23.542 [181]). The AF can be deployed by mobile operator or by an authorized third party. When the AF is deployed by third party, the interworking with 5GS is performed via the NEF.\nWith PIN-DN communication, the PEMC and PEGC communicates with the PIN Application Server at the application layer over the user plane. The PEGC and PEMC can communicate with each other via PIN direct communication using 3GPP access (e.g. PC5) or non-3GPP access (e.g. WiFi, BT) or via PIN indirect communication using a PDU Session in the 5GS.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "P.2\tSession management and traffic routing for PIN",
            "description": "The general session management principles as described in clause 5.6, the QoS model as defined in clause 5.7 and the User Plane management for 5GS as defined in clause 5.8 are applicable to PIN-DN communication and PIN-indirect communication.\nIf a PIN has multiple PEGC UEs, 5G VN group communication mechanisms can be used for PIN indirect communication (i.e. communication between PIN Elements belonging to the same PIN but served by different PEGC UEs). In this case a dedicated SMF set is used for managing the PIN related PDU Sessions from all the PEGCs of that PIN and the PDU session management principles for 5G VN-LAN-type services as specified in clause 5.29.3 are applicable. The user plane handling for 5G LAN-type services as specified in 5.29.4 are applicable with following differences:\n-\tFor PIN indirect communication N19-based traffic forwarding is not used i.e. the PIN traffic is forwarded using:\n-\tN6-based traffic forwarding method, where the UL/DL traffic for the PIN communication is forwarded to/from the DN;\n-\tlocal switching as depicted in Figure P.2-1 below, following the principles of local switching of traffic for 5G VN LAN-type service.\nThe figure depicts a local-switch based user plane architecture for a PIN (Point-to-Point Network) system. It illustrates the various components and their connections, including the local switch, the user plane, and the network interface controller (NIC). The figure highlights the importance of redundancy and failover mechanisms to ensure reliable communication.\nFigure P.2-1: Local-switch based user plane architecture for PIN\nNOTE:\tFigure P.2-1 does not show traffic from a PEMC.\nThe SMF configures the UPF(s) to apply N6-based traffic forwarding to route traffic between PDU Sessions of different PEGC UEs of a PIN as specified in clause 5.8.2.13. The SMF can apply local switching as specified in clause 5.8.2.13 in order to enable UPF locally forward uplink stream from one PDU session of one PEGC UE of a PIN as downlink stream of PDU session of one or more PEGC UE(s) of the same PIN. For local switching of PIN traffic between PIN related PDU sessions from different PEGC UEs of a single PIN, based on the DNN and S-NSSAI that is used for the PDU session related to PIN, the SMF provides a Network Instance to the UPF in FAR and/or PDR via N4 Session Establishment/Modification procedures.\n\nThe protocol and format of satellite coverage availability information to be provisioned to the UE via PDU session or SMS is not defined in this release of the specification, but this annex provides some examples on the information that constitutes input to the source of satellite coverage availability information e.g. external server and the output it provides to the UE. Satellite coverage availability information can be indicated to the UE by indications corresponding to whether or not coverage is available for a specific satellite RAT Type for a particular location and time, where:\n-\tThese indications can be Boolean \"True\" (e.g. coverage available) and \"False\" (coverage not available);\n-\tlocations can correspond to grid points in a fixed array (e.g. rectangular, hexagonal);\n-\tCoverage availability times may occur at fixed periodic intervals; and\n-\tCoverage availability information is per RAT Type. The information provisioned to the UE can include coverage information on only one PLMN or multiple PLMNs.\nIf Satellite coverage availability information indicates coverage is available then additional information on whether PLMN is allowed to operate in that location can be provided to the UE.\nIn order for the source of satellite coverage availability information to provide accurate information to the UE, a UE might indicate for example the following information to a source of satellite coverage availability information (e.g. an external server):\n-\tServing PLMN ID (if not already known or implied).\n-\tOne or more satellite RAT Types (where satellite coverage availability information is then expected for these one or more RAT Types).\n-\tList of supported satellite frequency bands (if not implied by the particular RAT Types).\n-\tPresent UE location (e.g. latitude and longitude) for a reference grid point (e.g. the most Southerly and then most Westerly grid point).\n-\tType of Array (e.g. rectangular or hexagonal).\n-\tMinimum elevation angle.\nBased on the above information provided by the UE, satellite coverage availability information could be delivered to the UE as a sequence of time durations for each grid point where each time duration includes an indication of coverage availability or unavailability one example of many alternatives as illustrated below for a particular grid point with N different durations:\nSatellite coverage availability information at a given grid point = <N> <Binary 0 or 1><Duration 1> <Binary 0 or 1><Duration 2> . . . . <Binary 0 or 1><Duration N>\nThe above would be concatenated for all of the grid points to produce the satellite coverage availability information.\nWhen SMS is used to deliver the satellite coverage availability information, the UE input and satellite coverage availability information output can be delivered in a series of concatenated SMS messages using possibly the same format.\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "",
                    "table number": 57,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        }
    ]
}