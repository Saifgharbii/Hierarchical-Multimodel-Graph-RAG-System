{
    "document_name": "33328-i10.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "Introduction",
            "description": "With Common IMS it has become possible to use IMS over a wide variety of access networks. These access networks provide security of varying strengths, or, in some cases, no security at all. It is therefore desirable to have a standard for IMS media plane security, which provides uniform protection of IMS media against eavesdropping and undetected modification across access networks. Furthermore, media transport in the core network, although generally less vulnerable than in the access network, may also be realised in varying ways with different guarantees of protection. It is therefore also desirable to have a standard for IMS media plane security, which guarantees protection of IMS media against eavesdropping and undetected modification in an end-to-end (e2e) fashion between two terminal devices.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document presents IMS media plane security for RTP and MSRP based media, IMS data channels (i.e., SCTP over DTLS) as well as security for BFCP as used in IMS conferencing. The security mechanisms are designed to meet the following three main objectives:\n1)\tto provide security for media usable across all access networks\n2)\tto provide an end-to-end (e2e) media security solution for RTP and data channel-based media to satisfy major user categories\n3)\tto provide end-to-end (e2e) media security for important user groups like enterprises, National Security and Public Safety (NSPS) organizations and different government authorities who may have weaker trust in the inherent IMS security and/or may desire to provide their own key management service.\n\nThe media plane security for RTP based media is based on the well-established protocol SRTP. Key management solutions for SRTP are defined in this specification.\nThe media plane security for MSRP, used in session-based messaging, is based on TLS. TLS is also used to protect BFCP. Key management solutions for MSRP and BFCP security are defined in the present document. The media plane security for IMS data channels, i.e., SCTP over DTLS, is based on DTLS.\nTwo normative Annexes to the present document address IMS media plane security for immediate messaging and conferencing, respectively. The media plane security for session-based messaging is addressed in the main body of this specification.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.002: \"Network architecture\".\n[3]\t3GPP TS 23.228: \"IP Multimedia (IM) Subsystem\".\n[4]\t3GPP TS 33.203: \"3G Security; Access security for IP-based services\".\n[5]\t3GPP TS 33.210: \"3G Security; Network domain security; IP network layer security\".\n[6]\t3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic bootstrapping architecture\".\n[7]\tIETF RFC 1035: \"DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION\".\n[8]\tIETF RFC 2616: \"Hypertext Transfer Protocol -- HTTP/1.1\".\n[9]\tIETF RFC 3711: \"The Secure Real-time Transport Protocol (SP)\".\n[10]\tIETF RFC 3550:  \"P: A Transport Protocol for Real-Time Applications\".\n[11]\tIETF RFC 3830: \"MIKEY: Multimedia Internet KEYing\".\n[12]\tIETF RFC 4567: \"Key Management Extensions for Session Description Protocol (SDP) and Real Time Streaming Protocol (SP)\".\n[13]\tIETF RFC 4568: \"Session Description Protocol (SDP) Security Descriptions for Media Streams\".\n[14]\tIETF RFC 6043: \"MIKEY-TICKET: Ticket-Based Modes of Key Distribution in Multimedia Internet KEYing (MIKEY)\".\n[15]\tIETF RFC 4771: \"Integrity Transform Carrying Roll-Over Counter for the Secure Real-time Transport Protocol (SP)\".\n[16]\tOtway, D. and Rees, O. 1987: \"Efficient and timely mutual authentication.\" SIGOPS Oper. Syst. Rev. 21, 1 (Jan. 1987), 8-10.\n[17]\tVoid\n[18]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP)\".\n[19]\t3GPP TS 24.109: \"Bootstrapping interface (Ub) and network application function interface (Ua); Protocol details\".\n[20]\t3GPP TS 29.162: \"Interworking between the IM CN subsystem and IP networks \".\n[21]\tIETF RFC 4975: \"The Message Session Relay Protocol (MSRP)\".\n[22]\t3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[23]\tVoid\n[24]\tIETF RFC 6714: \"Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP)”.\n[25]\t3GPP TS 24.147: \"Conferencing using the IP Multimedia (IM), Core Network (CN) subsystem\".\n[26]\tIETF RFC 4575: \"A Session Initiation Protocol (SIP) Event Package for \".\n[27]\tGSM Association, Rich Communication Suite 5.1 Advanced Communications Services and Client Specification, Version 1.0, August 2012.\n[28]\t3GPP TS 24.247: \"Messaging service using the IP Multimedia (IM) Core Network (CN) subsystem; Stage 3\".\n[29]\tIETF RFC 5365: \"Multiple-Recipient MESSAGE Requests in the Session Initiation Protocol (SIP)\".\n[30]\tVoid\n[31]\tIETF RFC 5652: \"Cryptographic Message Syntax (CMS)\".\n[32]\tIETF RFC 5083: \" Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type\".\n[33]\tIETF RFC 3565: \"Use of the Advanced Encryption Standard (AES) Encryption Algorithm in Cryptographic Message Syntax (CMS)\".\n[34]\tITU-T recommendation T.38 (09/2010): \"Procedures for real-time Group 3 facsimile communication over IP networks\".\n[35]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia telephony; Media handling and interaction\".\n[36]\tIETF RFC 6347: \"Datagram Transport Layer Security Version 1.2\".\n[37]\tIETF RFC 7325:\"UDP Transport Layer (UDPTL) over Datagram Transport Layer Security (DTLS)\".\n[38]\tVoid\n[39]\tIETF RFC 8826: \"Security Considerations for WebRTC\".\n[40]\tIETF RFC 5763: \"Framework for Establishing a Secure Real-time Transport Protocol (SRTP) Security Context Using Datagram Transport Layer Security (DTLS)\".\n[41]\tIETF RFC 5764: \"Datagram Transport Layer Security (DTLS) Extension to Establish Keys for the Secure Real-time Transport Protocol (SRTP)\".\n[42]\tIETF RFC 8832: \" WebRTC Data Channel Establishment Protocol\".\n[43]\tIETF RFC 8851: \"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification\".\n[44]\tIETF RFC 8855: \"The Binary Floor Control Protocol (BFCP)\".\n[45]\tIETF RFC 8866: \"SDP: Session Description Protocol\".\n[46]\tIETF RFC 7714: \"AES-GCM Authenticated Encryption in the Secure Real-time Transport Protocol (SRTP)\".\n[47]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".\n[48]\tIETF RFC 8841: \"Session Description Protocol (SDP) Offer/Answer Procedures for Stream Control Transmission Protocol (SCTP) over Datagram Transport Layer Security (DTLS) Transport\".\n[49]\tIETF RFC 8842: \"Session Description Protocol (SDP) Offer/Answer Considerations for Datagram Transport Layer Security (DTLS) and Transport Layer Security (TLS)\".\n[50]\tIETF RFC 8831: \"WebRTC Data Channels\".\n[51]\tIETF RFC 8864 : \"Negotiation Data Channels Using the Session Description Protocol (SDP)\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nEnd-to-access edge security: This term refers to media protection extending between an IMS UE and the first IMS core network node in the media path without being terminated by any intermediary.\nEnd-to-end security: This term refers to media protection extending between two IMS UEs without being terminated by any intermediary.\nIMS User Equipment: User equipment used for IMS media communications over access networks. Use of such equipment for IMS media communications over any 3GPP access network shall require presence of a UICC.\nKMS User Identity: A KMS user identity is derived from a user's public SIP-URI and it is the NAI-part of the SIP URI.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tSymbols",
                    "description": "",
                    "summary": "",
                    "text_content": "Void\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.3\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nBFCP\tBinary Floor Control Protocol\nDCSF\tData Channel Signalling Function\nMF\tMedia Function\nDTLS\tDatagram Transport Layer Security\nDTLS-SRTP\tDTLS Extension to Establish Keys for SRTP\ne2ae\tEnd-to-access edge\ne2e\tEnd-to-end\ne2DCe\tEnd-to-Data-Channel edge\nGW\tGateway\nIMS-ALG\tIMS Application Level Gateway\nIMS AS\tIMS Application Server\nIMS UE\tIMS User Equipment\nKMS\tKey Management Service\nMIKEY\tMultimedia Internet KEYing\nMSRP\tMessage Session Relay Protocol\nNAF\tNetwork Application Function\nRTP\tReal-time Transport Protocol\nSRTP\tSecure Real-time Transport Protocol\nTEK\tTraffic Encryption Key\nTGK\tTEK Generation Key\nTLS\tTransport Layer Security\nWebRTC\tWeb Real-Time Communication\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tIMS media plane security overview",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.1.1\tGeneral",
                            "text_content": "IMS media plane security for RTP is composed of several more or less independent key management solutions. DTLS-SRTP is for e2ae media protection. SDES, is for e2ae and for e2e media protection. These solutions relies on the security of the SIP infrastructure and in particular on SIP signalling security.\nThe KMS solution is for e2e protection and aims for high security, independent of the signalling and transport network. It is based on use of a Key Management Service (KMS) and a ticket concept. The security offered is anchored in the KMS including the functionality used for user authentication and key generation towards the KMS.\nIrrespectively of key management solution used, SRTP [9] is used as the security protocol to protect RTP based traffic. Specifically, the key(s) provided by this specification are used as the so called SRTP master key.\nTLS is used to protect MSRP based traffic. Key management for e2ae protection of MSRP relies on exchanging certificates and transmission of the fingerprints of these certificates over SDP. E2e protection can be achieved through the same KMS and ticket concept that is used for RTP traffic. The established key is used to setup a TLS-PSK tunnel between the two parties.\nIMS media plane security also includes the security of IMS Data Channels (TS 23.228 [3]), which in turn includes two types of architectures, e2DCe (end to Data Channel edge) and e2e. DTLS is used to protect the IMS Data Channel type of traffic. The e2DCe is defined as the path from the IMS UE to the Data Channel Media Function (MF). The IMS Data Channel e2e is defined as the path from an IMS UE to another IMS UE or from an IMS UE to an IMS Data Channel Application server.\nEditor´s Note: \tUsing the certificate fingerprint mechanism to provide e2e protection is ffs\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.1.2\tOverview of key management solutions for IMS media plane security",
                            "text_content": "SDES (Session Description Protocol Security Descriptions for Media Streams, cf. RFC 4568 [13]), is a simple key management protocol for media streams, which are to be secured by means of SRTP [9]. SDES defines a Session Description Protocol (SDP) RFC 8866 [45] cryptographic attribute for unicast media streams. The attribute describes a cryptographic key and other parameters that serve to configure security for a unicast media stream in either a single message or a roundtrip exchange. The attribute can be used with a variety of SDP media transports, and RFC 4568 [13] defines how to use it for the SRTP unicast media streams. The SDP crypto attribute requires the services of a data security protocol to secure the SDP message. For the use of SDES in IMS, the SIP signalling security mechanisms defined for IMS shall be used, for more details cf. clause 5.5.\nSDES basically works as follows: when an offerer A and an answerer B establish a SIP session they exchange cryptographic keys for protection of the ensuing exchange of media with SRTP. A includes the key, by which the media sent from A to B is protected, in a SIP message to B, and B responds with a SIP message including a second key, by which the media sent from B to A is protected.\nIn this specification, SDES is used for two modes of operation: e2ae mode and e2e mode. For the e2ae mode, SDES is run between an IMS UE and a SIP edge proxy, i.e. a P-CSCF (IMS-ALG). In the originating network, he P-CSCF (IMS-ALG) evaluates and subsequently deletes SDES cryptographic attributes that are passed to it from the IMS UE in SIP messages, and creates SDES cryptographic attributes and passes them to the IMS UE in SIP messages. This is done similarly in the terminating network. The resulting SRTP session is then established between the IMS UE and the media node controlled by the P-CSCF (IMS-ALG), i.e. the IMS Access Gateway (GW). This means that, for the e2ae mode, media is protected only over the access part of the network. The purpose of the e2ae mode is to provide access protection, i.e. guarantee protection of IMS media against eavesdropping and undetected modification in a uniform manner across heterogeneous access networks with various strengths of link layer protection. Access protection on the originating side is provided independently of access protection on the terminating side.\nFor the e2e mode, SDES is run between two IMS UEs, and the resulting SRTP session is then established between the two IMS UEs. This e2e media plane security solution should be suitable for anyone for whom the security level, with which SIP signalling messages are protected, is sufficient.\nWhen used in e2e mode SDES has minor requirements on the network infrastructure. When used in e2aemode, the requirements on the network infrastructure can be seen from clause 4.2.2.\nWordings like “e2e security using SDES” as used in the following refer to security for RTP based media, as SDES does only apply to protecting RTP.\nThe KMS based solution is an e2e security solution which protects media from one IMS UE all the way to another IMS UE not allowing any network entity access to plaintext media.  It is designed to rely on a well defined and limited set of entities that have to be trusted, simplifying the task of evaluation and assessment of offered security level.\nThis solution is based on use of a KMS and a \"ticket\" concept. A high level and simplified description of the solution is as follows: The initiator of a call requests keys and a ticket from the KMS. The ticket contains the keys in a protected format. The initiator then sends the ticket to the recipient. The recipient presents the ticket to the KMS and the KMS returns the keys on which the media security shall be based. All these message exchanges are authenticated and sensitive parts are encrypted. The solution is based on MIKEY-TICKET [14].\nUsers served by different KMS's may establish connections with media plane security enabled, provided that the operators of the KMS's have a cooperation agreement and that the operators have established a secure and authenticated channel for message exchange between the KMS's.\nThe KMS based solution allows implementation of per user policies regarding use of secure connections in general and key handling in particular. System specific policies can easily be defined and enforced by the KMS. Access to the KMS is granted based on user authentication and authorization. User authentication may be based on GBA [6] with the KMS taking the role of a NAF.\nThe KMS based solution specified here also solves the so called forking problem as it includes a mechanism which gives each individual recipient end-point in a forking scenario a unique key. These end-point unique keys cannot be recreated by any other end-point (except for the initiator) and in particular not any other end-point to which the call was forked. At the same time the solution offers SIP security independent mutual identity verification of caller and answering user.\nThis KMS based solution includes three features aiming to off-load the KMS from receiving ticket requests. The first feature is that tickets may be reused. This means that a user may request a ticket for another user and then for a specified time period use this ticket to protect calls to the other user. The second feature is that it is possible to generate tickets that can be used to establish secure connections to any user in a defined set of users. Such tickets are called group tickets. The third feature is that, if allowed by the local policy, the initiator may create tickets by itself, without contacting the KMS. This feature is supported by MIKEY-TICKET [14] and mimics the signalling flows of the Otway-Rees protocol [16].\nNote that use of tickets combining these three features may significantly reduce the number of ticket requests that the KMS has to handle. Note also that the use of tickets carrying keys will allow a design of the KMS with no requirements to hold per user state.\nKey management solution for e2ae protection of MSRP, DTLS-SRTP, WebRTC data channel based media are based on the cipher suites and session keys negotiated via the TLS/DTLS handshake between the UE and the IMS Access Gateway (GW). The TLS/DTLS record protocol secures the actual media. Mutual authentication during the TLS/DTLS handshake is achieved using certificates, with the certificate fingerprints being transmitted using the SDP fingerprint attribute in the SDP offer-answer exchange between the UE and the P-CSCF (IMS ALG).\nThis approach is specified in RFC 4975 [21]. \"TCP/TLS/MSRP\" is used as the protocol identifier in the m-line of the SDP, and the \"a=fingerprint\" attribute is used to provide the fingerprint of the certificate. The same approach is specified in RFC 8841 [48] and RFC 8842 [49], where \"UDP/DTLS/SCTP\" is used as the protocol identifier in the m-line of the SDP, \"a=fingerprint\" attribute is used to provide the fingerprint of the certificate, and \"a=tls-id\" provides the DTLS instance identification to handle DTLS restart scenarios.\nTLS/DTLS profile considerations discussed in annex M of this specification shall be followed to support IMS media plane security.\nThe key management solution for e2DCe protection of IMS data channel-based media is based on the cipher suites and session keys negotiated via the DTLS handshake between the UE and MF/MRF. The DTLS record protocol secures the actual media. Mutual authentication during the DTLS handshake is achieved using certificates, with the certificate fingerprints being transmitted using the SDP fingerprint attribute in the SDP offer-answer exchange between the UE and the MF/MRF via the P-CSCF, S-CSCF, IMS AS.\nThis approach is specified in RFC 8841 [48] and RFC 8842 [49], where \"UDP/DTLS/SCTP\" is used as the protocol identifier in the m-line of the SDP, \"a=fingerprint\" attribute is used to provide the fingerprint of the certificate, and \"a=tls-id\" provides the DTLS instance identification to handle DTLS restart scenarios.\nDTLS profile considerations discussed in annex M of this specification shall be followed to support IMS media plane security.\nThe key management solution for e2e protection of IMS data channel-based media is based on the cipher suites and session keys negotiated via the DTLS handshake between the UE and the peer. This peer can be either the peer UE or a WebRTC-enabled network server. The DTLS record protocol secures the actual media. Mutual authentication during the DTLS handshake is achieved using certificates, with the certificate fingerprints being transmitted using the SDP fingerprint attribute in the SDP offer-answer exchange between the UE and the P-CSCF (DCSF, IMS AS).\nThis approach is specified in RFC 8841 [48] and RFC 8842 [49], where \"UDP/DTLS/SCTP\" is used as the protocol identifier in the m-line of the SDP, \"a=fingerprint\" attribute is used to provide the fingerprint of the certificate, and \"a=tls-id\" provides the DTLS instance identification to handle DTLS restart scenarios.\nDTLS profile considerations discussed in annex M of this specification shall be followed to support IMS media plane security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.2\tIMS media plane security architecture",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.2.1\tGeneral",
                            "text_content": "This clause describes the impact of IMS media plane security on the IMS architecture.  Five cases need to be distinguished. The IMS UEs are impacted in all five cases. The network impact varies with the cases.\n1. \tE2ae security: here the P-CSCF (IMS-ALG), the IMS Access GW, and the Iq interface between them are impacted.\n2. \tE2e security using SDES: minor impact on the network infrastructure (see TS 29.162 [20] for details).\n3.\tE2e security using KMS: here, the network infrastructure needs to be enhanced with a Key Management Server, which, in turn, relies on a GBA [6] infrastructure, or an infrastructure to provide corresponding services, to be in place. Otherwise, there is minor impact on the network infrastructure (see TS 29.162 [20] for details).\n4.\tE2DCe IMS Data Channel media plane security: The P-CSCF as well as other network functions such as S-CSCF, IMS AS, and the related interfaces Mw, ISC, DC2 are impacted. The IMS Data Channel media plane security is established between the UE and MF/MRF.\n5.\tE2e IMS Data Channel media plane security: The IMS Data Channel media plane security is established between two UEs or between a UE and a Data Channel Application Server.\nA pre-requisite for support of e2e security is that media packets are forwarded transparently by any nodes present in the media path (SRTP packets in case of secure RTP, TLS packets in case of secure MSRP, and DTLS packets carrying SCTP in case of IMS Data Channel). This implies that transcoding of RTP streams is no longer possible.\nThese prerequisites apply irrespective of whether the SRTP session was established by means of SDES or KMS.\nNOTE:\tThe lawful interception architecture is outside the scope of this TS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.2\tE2ae security",
                            "text_content": "For e2ae security, the P-CSCF (IMS-ALG) shall always include the IMS Access GW in the media path even if the involvement of the IMS Access GW would otherwise not be needed, e.g. if traffic was to be routed only between two terminals in the same IMS domain.\nThe P-CSCF (IMS-ALG) needs to be enhanced to be able to terminate the key management protocol (DTLS-SRTP or SDES for SRTP and TLS for MSRP), as well as handle indications, which are specific to e2ae security and are inserted in SIP messages. The IMS Access GW needs to be enhanced to be able to terminate SRTP streams, TLS protecting MSRP, and DTLS protecting SCTP. The Iq interface between P-CSCF (IMS-ALG) and IMS Access GW needs to be enhanced to be able to transport parameters related to the management of SRTP and TLS/DTLS cryptographic contexts. There is no impact on other parts of the network infrastructure. This is depicted in Figure 1. Details can be found in clauses 6.2.1.3, 7.2.1 and 7.3.1.\nThe figure depicts the IMS signalling and media plane entities relevant to e2ae security, illustrating the various components and their interactions.\nFigure 4.2.2-1: IMS signalling and media plane entities relevant to e2ae security\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.3\tE2e security using SDES",
                            "text_content": "When used in e2e mode SDES has minor requirements on the network infrastructure, see clause 4.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.4\tE2e security using KMS",
                            "text_content": "The objective of the KMS based solution is to establish e2e media plane security between IMS UE's.\nA simple network model of the entities involved in the key management for the KMS based solution is shown in Figure 2. The architecture follows the Generic Bootstrapping Architecture (GBA) [6].  GBA is used for KMS user authentication and establishment of a shared key for protection of message exchanges over Ua.\nNOTE: \tInstead of GBA other systems offering corresponding services can be used. The used system has to provide user authentication, a shared security association between KMS and IMS UE and an identity for the security association which can be used to reference the security association. The security association can also define the user associated KMS user identities (see 6.2.3.2). The system can be based on any type of user credentials deemed to be secure enough for the intended application relying on the media plane security.\nThe IMS UE's may be served by different KMS's, e.g. when they belong to different IMS operator domains. Therefore, a new reference point, Zk, for message exchange between two KMS's is introduced. Zk is used when one KMS gets a request to resolve a ticket which only can be resolved by another KMS. The end-points using Zk shall be mutually authenticated and messages shall be integrity and confidentiality protected.\nThe media plane interface and the SIP signalling interface (Gm) is not shown in the reference model as these interfaces are in principle not changed. The required new functionality is implemented by modifications in SIP/SDP.\n\nThe figure depicts a reference model for key management in a KMS-based solution, illustrating the various components and their interactions. Key elements include the KMS server, KMS client, and KMS key management service. The diagram highlights the key management process, including key generation, key distribution, and key rotation. Key management is crucial for ensuring the security and integrity of key data, and this model provides a clear and concise representation of the process.\nFigure4.2.4-1 : Reference model for key management for the KMS based solution\nFurther information on entities and reference points in the reference model is given in the following list:\n-\tFor HSS definitions refer to [2].\n-\tFor GBA and BSF definitions including the Zh, Zn and Ub reference points refer to TS 33.220 [6].\n-\tFor how to secure Zh and Zn also refer to TS 33.220 [6].\n-\tThe KMS acts as a NAF when GBA is used for user authentication and establishment of a key shared between the KMS and an IMS UE.\n-\tReference point Ua uses HTTP [8] for transport of MIKEY-TICKET [14] messages. The procedures are defined in Annex A.\n-\tProtocol details for reference points Ua and Ub are provided in TS 24.109 [19].\n-\tReference point Zk also uses HTTP [8] for transport of MIKEY-TICKET [14] messages. The procedures are according to Annex A with the restriction that Request-URI only can contain \"requesttype\" equal to \"ticketresolve”. Network domain Security [5] shall be used for authentication of endpoints and protection of messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.5\tE2DCe security",
                            "text_content": "For e2DCe security, and for IMS Data Channels that terminate in the MF/MRF, the IMS Access GW is not needed in the media path for security purposes.\nThe interface between IMS AS and the Data Channel Media Function (DC2) or MRF (Mr’/Cr) needs to be able to transport parameters related to the management of DTLS cryptographic contexts. There is no impact on other parts of the network infrastructure. This is depicted in Figure 4.2.5-1. Details can be found in clauses 6.2.4, 7.2.4 and 7.3.3.\nThe figure depicts the IMS signalling and media plane entities relevant to e2DCe security, illustrating the various components and their interconnections.\nFigure 4.2.5-1: IMS signalling and media plane entities relevant to e2DCe security\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.2.6\tE2e security for IMS Data Channels",
                            "text_content": "The end-2-end IMS Data Channel media plane security is established between two UEs or between a UE and a Data Channel Application Server. Details can be found in clauses 6.2.5, 7.2.5 and 7.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "5\tIMS media plane security features",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The support for IMS media plane security mechanisms and procedures is optional in IMS UEs and its support in the IMS core network is also optional. The support of IMS data channel media is optional. If IMS data channel media is supported, DTLS shall be supported and the following clauses related to IMS data channel media apply..\nFor the protection of real-time traffic, an IMS UE may support DTLS-SRTP based media plane security mechanism, SDES based media plane security mechanisms, and/or KMS based media plane security mechanism. DTLS-SRTP is only used for e2ae. When an IMS UE supports SDES media plane security mechanisms it shall support procedures for e2ae IMS media plane security and it may support e2e IMS media plane security.\nFor e2ae protection of MSRP, an IMS UE may support the TLS based media plane security mechanism as defined in section 4.1.2.3\nFor e2DCe IMS Data Channel media plane security, an IMS UE shall support the DTLS-based media plane security mechanism for IMS data channel as defined in clause 4.1.2.4.\nFor e2e protection of MSRP, an IMS UE may support the KMS based media plane security mechanism.\nFor e2e IMS Data Channel media plane security, an IMS UE shall support the DTLS-based media plane security mechanism as defined in clause 4.1.2.5.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tMedia integrity protection",
                    "description": "",
                    "summary": "",
                    "text_content": "The support for IMS media integrity protection is mandatory in an IMS UE supporting IMS media plane security and mandatory in IMS core network elements (i.e., IMS Access Gateway) supporting DTLS-SRTP based, SDES based and/or TLS (MSRP) e2ae IMS media plane security.\nThe support for IMS media integrity protection is mandatory in an IMS UE supporting IMS media plane security and mandatory in IMS core network elements (i.e., Data Channel Media Function) supporting e2DCe IMS Data Channel media plane security.\nThe support for IMS media integrity protection is mandatory in an IMS UE and in IMS network elements, supporting e2e IMS Data Channel media plane security.\nThe use of IMS media integrity protection for RTP is optional, except that RTCP shall be integrity protected using SRTCP, in accordance with RFC 3711 [9].\nThe use of IMS media integrity protection for MSRP is optional.\nThe use of IMS media integrity protection for IMS data channel is recommended.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3\tMedia confidentiality protection",
                    "description": "",
                    "summary": "",
                    "text_content": "The support for IMS media confidentiality protection is mandatory in an IMS UE supporting  media plane security and mandatory in IMS core network elements (i.e., IMS Access Gateway) supporting e2ae IMS media plane security.\nThe support for IMS media confidentiality protection is mandatory in an IMS UE supporting IMS data channel media and mandatory in IMS core network elements (i.e., Data Channel Media Function) supporting e2DCe IMS Data Channel media plane security.\nThe support for IMS media confidentiality protection is mandatory in an IMS UE supporting IMS data channel media and mandatory in IMS core network elements supporting e2e IMS Data Channel media plane security.\nWhen IMS media plane security is used, SRTP transforms with null encryption should not be used.\nWhen TLS/DTLS is used for IMS media plane security TLS/DTLS profile considerations discussed in annex M of this specification shall be followed.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.4\tAuthentication and authorization",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.4.1\tAuthentication and authorization for e2ae protection",
                            "text_content": "E2ae security implies that no other IMS core network nodes, apart from P-CSCF (IMS-ALG) and IMS Access GW will terminate IMS media security.\nThe IMS UE and the P-CSCF (IMS-ALG) rely on SIP signalling security to authenticate each other. This is consistent with the fact that the security of the use of SDES and the TLS based solutions entirely rely on SIP signalling security, cf. clause 5.5.\nThe P-CSCF (IMS-ALG) on the terminating side tells the IMS UE by an explicit indication, cf. clause 7.3.1, that e2ae security is provided, i.e. that the IMS UE shares the media keys with the P-CSCF (IMS-ALG) and not with some other entity. For the originating side see Note 3 in clause 7.2.1. Provided the IMS UE trusts SIP signalling security it can rely on this explicit indication for the following reasons: the IMS UE knows from registration that the P-CSCF (IMS-ALG) is capable of e2ae security, and that such a P-CSCF (IMS-ALG) will remove any such indication if inserted by another party, cf. clauses 7.2.1 and 7.3.1.\nIn the SDES solution the IMS UE and the IMS Access GW authenticate each other by means of implicit key authentication: the IMS UE believes that only the IMS Access GW can have the media keys to protect the media because it trusts the P-CSCF (IMS-ALG) to give the keys only to the IMS Access GW. Similarly, the IMS Access GW trusts the P-CSCF (IMS-ALG) that the keys are shared only with this IMS UE.\nIn the DTLS-SRTP and TLS/DTLS solution, mutual authentication between the IMS UE and the IMS Access GW relies on secure transport of certificate fingerprints using SIP signalling integrity protection. If the fingerprints of the certificates used for the TLS/DTLS handshake match the fingerprints transmitted via SIP signalling, then the TLS/DTLS endpoints can be sure that TLS/DTLS is really established between the nodes that exchanged the SIP signalling.\nThe IMS UE implicitly authorizes the P-CSCF (IMS-ALG) and the IMS Access GW to perform e2ae security by indicating support for e2ae security during the registration in line with the IMS UE’s policy, cf. clause 7.1.\nConversely, an IMS UE is always authorized to participate in e2ae security if the network policy allows e2ae security, cf. clause 7.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.2\tAuthentication and authorization for e2e protection using SDES",
                            "text_content": "The originating IMS UE and the terminating IMS UE rely on SIP signalling security to authenticate each other. This is consistent with the fact that the security of the use of SDES entirely relies on SIP signalling security, cf. clause 5.5.\nIn particular, under the assumption of secure SIP signalling, the originating IMS UE can be assured that the media key it sent reaches only the intended recipient of the SIP messages, except in forking or re-targeting situations where also the endpoints to which the call is forked or re-targeted will see the media key sent by the originating IMS UE. The terminating IMS UE gets different degrees of assurance about the identity of the originating IMS UE it shares a key with, depending on whether the originating IMS UE resides in the same trust domain or not. If it does then the network can assert the sender’s identity to the terminating IMS UE, otherwise there will be no such assurance.\nFurthermore, if both the originating and the terminating IMS UE are in IMS they know from the absence of indications relating to e2ae security that no IMS network node terminates IMS media security. If one of the UEs is outside the IMS there will be no such assurance.\nThe originating and the terminating IMS UE implicitly authorize each other to engage in e2e security by sending SDES crypto attributes to each other. Also, in case the originating IMS user chooses anonymity for a session, the terminating IMS UE will not learn the originating user’s identity, and vice versa, in case the terminating IMS user chooses anonymity for a session, the originating IMS UE will not learn the terminating user’s identity.\nIn forking and re-targeting scenarios, when the IMS user that finally terminates the session chooses anonymity, the originating IMS user may have no indication to which terminating IMS user the session has been established or even whether the call has been forked or re-targeted at all.\nNOTE: An IMS UE can apply certain policies to enhance security in forking and re-targeting scenarios. For example, an IMS UE receiving an answer to an INVITE can check the P-Asserted-Identity field to verify whether the answering user is the called one, and if this is not the case, cancel the current session (and possibly establish a new session directly with the answering user, using new keys). Moreover, an IMS UE can alert the user in case the user has triggered the establishment of a media session using e2e security but the identity of the answering party is not asserted to the IMS UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.3\tAuthentication and authorization for e2e protection using KMS",
                            "text_content": "User authentication and authorization shall be performed as described in Clause 6.2.3.\nThe KMS can perform policy control regarding e.g. who is allowed to set up connections with secured media to whom. Other ticket features defined in MIKEY-TICKET [14] such as reuse of tickets, forking key generation and terminating side authentication can also be controlled by the KMS.\nAuthorization of ticket requests to the KMS is based on an authenticated user identity carried in the request message.  The user may request a specific type of ticket but the KMS can control the actual settings in the issued ticket.\nWhen the terminating side requests the KMS to resolve a ticket and return the keys to be used, the KMS checks that the terminating user is authorized to resolve the ticket. This authorization is based on information about allowed recipients carried in the ticket and the authenticated identity of the requesting user carried in the request message.\nWhen user authentication is based on GBA, the IMS UE uses its GBA B-TID [6] as authenticated identifier. The NAF-key identified by the B-TID is used for protection of the message exchange.\nMutual authentication between initiating and terminating users is achieved based on trust in the KMS. The terminating side will be assured of the initiating IMS UE identity as its KMS UID, defined in clause 6.2.3.2, will be included in the ticket and ticket integrity will be verified by the KMS and reported back to the requestor. The initiator will get assurance about the identity of the terminating user when receiving the TRANSFER_RESP message. The response message will include a KMS UID representing the entity requesting the KMS to resolve the ticket. The response message is authenticated with a key guaranteeing the authenticity of the KMS UID.\nAs the KMS based solution only provides e2e security there is no need for control and policing regarding the scope of media protection.\nIf there is a need in the network to detect that KMS based security solution is used it can be done by inspecting the SDP parts of the SIP signalling, in particular the SDP attribute a=key-mgmt which if present indicates use of MIKEY-TICKET [14] and implicitly then use of the KMS based IMS media plane security functionality.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.4\tAuthentication and authorization for e2DCe protection",
                            "text_content": "E2DCe security implies that the UE and Data Channel Media Function/MRF terminate IMS Data Channel media security.\nIn the DTLS solutions for IMS data channels, mutual authentication between the IMS UE and the Data Channel Media Function/MRF relies on secure transport of certificate fingerprints using SIP signalling integrity protection. If the fingerprints of the certificates used for the DTLS handshake match the fingerprints transmitted via SIP signalling, then the DTLS endpoints can be sure that DTLS is really established between the nodes that exchanged the SIP signalling.\nThe IMS UE implicitly authorizes the P-CSCF (IMS-ALG) and the Data Channel Media Function/MRF to perform e2DCe security by indicating support for e2DCe security during the registration in line with the IMS UE’s policy, cf. clause 7.1.\nConversely, an IMS UE is always authorized to participate in e2DCe security if the network policy allows e2DCe security, cf. clause 7.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.4.5\tAuthentication and authorization for e2e protection using DTLS",
                            "text_content": "E2e security implies that no IMS core network nodes will terminate IMS media security.\nIn the DTLS solution for IMS data channels, mutual authentication between the originating and terminating IMS UE as well as the originating UE and terminating IMS Data Channel Application Server, relies on secure transport of certificate fingerprints using SIP signalling integrity protection. If the fingerprints of the certificates used for the DTLS handshake match the fingerprints transmitted via SIP signalling, then the DTLS endpoints can be sure that DTLS is really established between the nodes that exchanged the SIP signalling.\nAn IMS UE is always authorized to participate in e2e security if the network policy allows e2e security using DTLS.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.5\tSecurity properties of key management, distribution and derivation",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.5.1\tGeneral security properties for protection using SDES",
                            "text_content": "SDES requires SIP messages carrying SDES crypto attributes to be secured as SDES provides no security mechanism of its own. Under the assumption that the protocol for securing media, SRTP, is secure the use of SDES provides the same level of security for IMS media where media protection is applied as provided for SIP signalling. In other words, the user may place the same degree of trust in media security as in signalling security.\nIn IMS, SIP messages are secured in a hop-by-hop fashion. Several alternatives are available for securing SIP messages between the IMS UE and the P-CSCF (IMS-ALG). In particular, IPsec and TLS, as defined in TS 33.203 [4] are specified in 3GPP.  Within the IMS core network, security is provided by IPsec or TLS, cf. clause 6.2.\nOutside the IMS, at least hop-by-hop TLS as in RFC 3261 is likely to be supported. IMS has no control over how non-IMS SIP providers secure the interfaces between their SIP proxies. This makes SDES appear less secure in a non-IMS environment. On the other hand, service level agreements may give sufficient assurance here.\nOn the SIP proxies, the keys transported with SDES become visible in plaintext. Therefore, compromise of these proxies will allow not only signalling security, but also media security, to be compromised. However, it should be noted that, even if media security was not applied at all, the proxies would need to be protected anyway to secure SIP signalling for its own sake as SIP signalling security is an important requirement for operators and users. Therefore, the SIP proxies may be assumed to be trusted for this purpose anyhow.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.2\tAdditional security properties for e2ae protection using SDES",
                            "text_content": "For the e2ae case, there are additional security properties.\nThe trust in all SIP proxies in the signalling path is required for SDES. However, assuming that strong SIP signalling security, e.g. TLS or IPsec, is used between IMS UE and P-CSCF (IMS-ALG), this difference plays no role for the case of e2ae protection as explained below.\nBy definition of e2ae protection, the media keys need to be available in the P-CSCF (IMS-ALG) and IMS Access GW in the clear, irrespective of the key management scheme used. And by the assumption of strong SIP signalling security and the fact that there is no SIP proxy between the IMS UE and the P-CSCF (IMS-ALG), no attacker can obtain the media keys by eavesdropping on the interface between the IMS UE and the P-CSCF (IMS-ALG) nor any intermediate SIP proxy, again irrespective of the key management scheme used. Therefore, the attacks relating to compromised intermediate signalling nodes that may apply to the use of SDES for e2e security do not apply to the use of SDES for e2ae security.\nWhen SDES is used for e2ae protection then, in addition to SIP signalling security, also the Iq interface for signalling between the P-CSCF (IMS-ALG), and the media node terminating SRTP towards the UE, i.e. the IMS Access GW, needs to be secured, cf. clause 6.2.1.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.3\tSecurity properties for e2e protection using KMS",
                            "text_content": "Key management, distribution and derivation shall be performed as described in Clause 6.2.3.  It is performed in accordance with MIKEY-TICKET [14].  In particular the key derivation functions of MIKEY in RFC 3830 [11] are reused.\nMIKEY-TICKET [14] extends the concepts from MIKEY in RFC 3830 [11] to cover ticket based key management. The basic exchanges between a user and the KMS used in this specification are security-wise modelled after MIKEY PSK and exhibit the same security properties. These exchanges are performed over HTTP [8] and the security is based on the message security offered by MIKEY-TICKET [14].\nThe ticket transfer exchange is also modelled after MIKEY PSK but instead of directly using shared keys for message protection and protection of TGKs/TEKs, these keys are carried in the ticket and made available to the users from the KMS. Assuming that the KMS is secure this will render this exchange the same security properties as MIKEY PSK.\nAccess to KMS is a single source of failure in the system and depending on service requirements, back-up solutions should be considered. It would be possible to replicate the KMS functionality and e.g. use multiple addresses for access.\nThe KMS and the BSF are critical components in the system and their availability should be protected. Measures to protect against denial of service attacks should be installed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.4\tSecurity properties for e2ae protection using TLS/DTLS",
                            "text_content": "Based on secure mutual authentication leveraged by the integrity protection of the SIP signalling messages (cf. clause 5.4.1), TLS/DTLS provides secure derivation of session keys to protect the media.\nSimilarly as for e2ae protection using SDES, in addition to SIP signalling security, also the Iq interface for signalling between the P-CSCF (IMS-ALG), and the media node terminating MSRP/TLS towards the UE, i.e. the IMS Access GW, needs to be secured, cf. clause 6.2.1.3.\nprofile considerations discussed in annex M of this specification shall be followed to support IMS media plane security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.5\tSecurity properties for e2ae protection using DTLS-SRTP",
                            "text_content": "Based on secure mutual authentication leveraged by the integrity protection of the SIP signalling messages (see clause 5.4.1), DTLS provides secure derivation of session keys to protect the media.\nSimilarly as for e2ae protection using SDES, in addition to SIP signalling security, also the Iq interface for signalling between the P-CSCF (IMS-ALG), and the media node terminating SRTP towards the UE, i.e. the IMS Access GW, needs to be secured, see clause 6.2.1.3.\nDTLS profile considerations discussed in annex M of this specification may be followed to support IMS media plane security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.6\tSecurity properties for e2DCe protection using DTLS",
                            "text_content": "Based on secure mutual authentication leveraged by the integrity protection of the SIP signalling messages (see clause 5.4.4), DTLS provides secure derivation of session keys to protect the media.\nIn addition to SIP signalling security, also the Mw, ISC interfaces for signalling between the P-CSCF (IMS-ALG), and the media node terminating the IMS Data Channel towards the UE, i.e. the MF/MRF, needs to be secured. Also, the DC2 or Mr’/Cr interface for signalling between the IMS AS and the Data Channel Media Function or MRF, respectively, needs to be secured, see clause 6.2.4.\nDTLS profile considerations discussed in annex M of this specification may be followed to support IMS media plane security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tSecurity mechanisms",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tMedia security mechanisms",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.1.1\tMedia security mechanisms for real-time traffic",
                            "text_content": "In this specification, protection for real-time traffic means protection for IMS traffic using the Real-Time Transport Protocol (RTP) or the RTP Control Protocol (RTCP), cf. RFC 3550 [10].\nThe integrity and confidentiality protection for IMS traffic using RTP shall be achieved by using the Secure Real-Time Transport Protocol (SRTP),  RFC 3711 [9]. The integrity and confidentiality protection for IMS traffic using RTCP shall be achieved by using the Secure RTCP protocol (SRTCP), RFC 3711 [9].\nA compliant implementation shall support the default transforms and key derivation functions defined in SRTP [9] Additional transforms and key derivation functions may be supported. Annex C and Annex O provide further profiling of SRTP for compliant implementations.\nKey management mechanisms for SRTP and SRTCP, as used in this specification, are described in clause 6.2.  The key management mechanisms shall provide SRTP master key(s) and master salt(s).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.2\tMedia security mechanisms for session based messaging (MSRP)",
                            "text_content": "In this specification, protection for session based messaging means protection for IMS traffic using the Message Session Relay Protocol (MSRP) as defined in RFC 4975 [21] and RFC 6714 [24].\nThe integrity and confidentiality protection for IMS traffic using MSRP is achieved by TLS protection.\nKey management mechanisms for MSRP, as used in this specification, are described in clause 6.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.1.3\tMedia security mechanisms for IMS data channels",
                            "text_content": "In this specification, integrity and confidentiality protection for IMS data channels means protection for IMS traffic using UDP, protected by DTLS, carrying SCTP streams, as defined by RFC 8831 [50], RFC 8841 [48], and RFC 8842 [49].\nKey management mechanisms for IMS data channel, as used in this specification, are described in clause 6.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.2\tKey management mechanisms for media protection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.1\tKey management mechanisms for e2ae protection",
                            "text_content": "The P-CSCF (IMS-ALG) shall handle signalling related to e2ae protection. In particular, the P-CSCF (IMS-ALG) shall terminate the key management protocol and communicate the agreed security context parameters to the IMS Access GW over the Iq interface.\nThe IMS Access GW shall terminate the protocol for media confidentiality and integrity protection towards the UE as requested by the P-CSCF (IMS-ALG). The IMS Access GW shall send unprotected packets to and receive unprotected packets from the network, unless other protection mechanisms have been configured to be used in the direction towards the network according to the policies of the operator.\nFor IMS real-time traffic, the IMS Access GW shall send SRTP and SRTCP packets to and receive SRTP and SRTCP packets from the UE as requested by the P-CSCF (IMS-ALG). The IMS Access GW shall send RTP and RTCP packets to and receive RTP and RTCP packets from the network.\nFor IMS session based messaging traffic, the IMS Access GW shall send TLS protected MSRP packets to and accept TLS protected MSRP packets from the served UE as requested by the P-CSCF (IMS-ALG). The IMS Access GW shall send MSRP packets to and accept MSRP packets from the network – whether these packets are specifically protected by TLS is up to the policies of the operator.\nNOTE: \tFrom the IMS access gateway in the direction towards the network, plain TCP may be used on the next hops, assuming that the interfaces are protected e.g. using IPsec or physical protection. Optionally, TLS may be used. The IMS access gateway relays between the TLS connection towards the originating IMS UE and the connection in the direction towards the terminating IMS UE. Usage of TLS from the IMS access gateway towards the network is not covered by this specification.\nFor the definition of the IMS Access GW cf. TS 23.228 [3].\nThe key management protocol for e2ae protection for real-time traffic shall be the DTLS-SRTP as defined in [41] or SDP Security Descriptions (SDES) as defined in [13]. If an IMS UE supports e2ae protection of RTP based media, it shall support SDES, and may support the DTLS-SRTP.\nThe secure use of the SDP crypto attribute defined in DTLS-SRTP and SDES requires the services of a data security protocol to secure the SDP message. For the use of SDES in IMS, these security services are provided by the SIP signalling security mechanisms applied between the UE and the P-CSCF (IMS-ALG) as defined in TS 33.203 [4]. SIP messages between the UE and the P-CSCF (IMS-ALG) shall be confidentiality-protected either by the confidentiality mechanisms of IPsec or TLS as defined in TS 33.203 [4], or by confidentiality provided by the underlying access network.\nThe key management mechanism for e2ae protection of MSRP traffic shall be based on certificates and the transmission of certificate fingerprints as defined in RFC 4975 [21].\nFor each RTP media stream to be set-up, the P-CSCF (IMS-ALG) shall send the parameters contained in two specific DTLS-SRTP protection profiles or SDES crypto attributes, cf. RFC 4568 [13], over the Iq interface to the IMS Access GW. On the originating side of the session, these are the DTLS-SRTP protection profile or SDES crypto attribute selected by the P-CSCF (IMS-ALG) from the ones received from the IMS UE in the SDP Offer and the DTLS-SRTP protection profile or SDES crypto attribute generated and inserted by the P-CSCF (IMS-ALG) in the SDP Answer sent to IMS UE, cf. clause 7.2.1. On the terminating side of the session, these are the DTLS-SRTP protection profile or SDES crypto attribute selected by the UE from the ones generated and inserted by the P-CSCF (IMS-ALG) in the SDP Offer sent to IMS UE and the DTLS-SRTP protection profile or SDES crypto attribute received from the IMS UE in the SDP Answer, cf. clause 7.3.1. The P-CSCF (IMS-ALG) shall send the parameters contained in an DTLS-SRTP protection profile or SDES crypto attribute over Iq in such a way that the IMS Access GW is able to uniquely associate the SDES crypto attribute with a media stream.\nThe IMS Access GW shall, upon reception of an DTLS-SRTP protection profile or SDES crypto attribute, establish an SRTP security context (as described in RFC 4568 [13] and RFC 3711 [9]) and be prepared to convert RTP packets to SRTP packets and vice versa, using the corresponding SRTP security contexts, and send the packets to the UE or receive them from the UE, as described in clause 7.\nThe confidentiality of the keys sent over the Iq interface is required. The Iq interface shall be protected by NDS/IP [5]. If cryptographic protection is applied to the Iq interface then encryption shall be used.\nNOTE: \tIf the P-CSCF (IMS-ALG) and IMS Access GW are located in the same security domain then cryptographic protection is not mandated by NDS/IP. From TS 33.210 [5]: \"The Zb-interface is located between SEGs and NEs and between NEs within the same security domain. The Zb-interface is optional for implementation.\"\nFor each MSRP media stream to be set-up with e2ae security the P-CSCF (IMS-ALG) shall send the certificate fingerprint received from the IMS UE over the Iq interface to the IMS Access GW in a way that the IMS Access GW is able to uniquely associate the fingerprint with a media stream.\nVice versa, for each MSRP  media stream to be set-up with e2ae security IMS Access GW shall send the fingerprint of its certificate over the Iq interface to the P-CSCF (IMS-ALG) in a way that the P-CSCF (IMS-ALG)  is able to uniquely associate the fingerprint with a media stream.\nFor protection of session-based messaging traffic, the IMS Access GW shall, upon reception of a certificate fingerprint, use the certificate fingerprint (as described in RFC 4975 [21]) to verify the establishment of the TLS/DTLS session to belong to the served user. When the TLS/DTLS session has been established, the IMS Access GW shall be prepared to convert unprotected MSRP packets to protected MSRP packets and vice versa and send the packets to the UE or receive them from the UE, as described in clause 7.\nThe integrity of the fingerprints sent over the Iq interface is required. The Iq interface shall be protected by NDS/IP [5]. If cryptographic protection is applied to the Iq interface then integrity protection shall be used. (See also NOTE in 6.2.1.3.1.)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tKey management mechanisms for e2e protection using SDES",
                            "text_content": "SDP Security Descriptions (SDES) as defined in [13] may be used for key management for e2e protection for real-time traffic.\nThe secure use of the SDP crypto attribute defined in SDES requires the services of a data security protocol to secure the SDP message. For the use of SDES in IMS, these security services are provided by the SIP signalling security mechanisms applied between the UE and the P-CSCF as defined in TS 33.203 [4] and between IMS core network elements as defined in TS 33.210 [5] and, for the optional use of TLS, in TS 33.203 [4]. SIP messages between the UE and the P-CSCF shall be confidentiality-protected either by the confidentiality mechanisms of IPsec or TLS as defined in TS 33.203 [4], or by confidentiality provided by the underlying access network. SIP messages between IMS core network elements shall be confidentiality-protected by the confidentiality mechanisms of IPsec or TLS as defined in TS 33.210 [5] and TS 33.203 [4] respectively, or by confidentiality provided by the underlying core network.\nNOTE: \te2e protection using the key management mechanism described above may also be achieved between an IMS UE and a non-IMS SIP terminal. It is true also for this case that the services of a data security protocol to secure the SDP message are required. However, the means to provide such services in a non-IMS network are outside the scope of this specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tKey management mechanisms for e2e protection using KMS",
                            "text_content": "The KMS based security mechanism may be used for e2e protection of both real-time traffic and session based messaging (MSRP),\nThe key management mechanisms are defined by MIKEY-TICKET [14] and the profiling of tickets and procedures as given in this specification. Annex D specifies the default implementation of KMS based IMS media plane security and use of GBA for user authentication and establishment of a shared key between KMS and IMS UE.\nMIKEY-TICKET [14] contains up to three message exchanges. The first exchange is called Ticket Request and is between the initiating user and the KMS. The second exchange is called Ticket Transfer and is between initiating and terminating users. The third exchange is called Ticket Resolve and is between the terminating user and the KMS. The exchanges and the messages in the exchanges are illustrated in Figure 3. In MIKEY-TICKET [14] the three parties involved in the message exchanges are called Initiator, KMS and Responder, respectively.\nDepending on the KMS policy, some message exchanges may be omitted. For example, if the KMS policy indicates that the initiator generates the ticket without the assistance of KMS (MIKEY-TICKET mode 3, cf. [14]), the Ticket Request message exchange, i.e. the REQUEST_INIT and REQUEST_RESP messages will be omitted.\nThe figure depicts the MIKEY-TICKET message exchanges in a 5G network, illustrating the various stages of the message transmission process. The figure shows the sender, receiver, and intermediate nodes involved in the message exchange, highlighting the importance of network slicing and network slicing technologies in 5G networks.\nFigure 3: MIKEY-TICKET message exchanges\nUsers of the KMS based security solution shall have at least one public SIP-URI formatted identity. The NAI part (username@domain) of this identity is used for user identification and authentication in the key management system. This identity is called the KMS UID.\nKMS UIDs are used to identify the user to which a ticket is issued and the allowed recipients of the ticket, i.e. the (set of) user(s) which are allowed to resolve the ticket and receive the associated keys. This information is included in the ticket.\nUser groups for key management purposes can be defined by wild-carding of KMS user identities. The character ? (question mark) is used as the wild card character and matches zero or more occurrences of arbitrary characters. A string formatted as a KMS UID and which includes at least one occurrence of the wild card character is called a KMS user group identity. The KMS user group identity ?.department@company.example thus defines the group of users that have a KMS user identity matching the wild-carded string and the group would include e.g. user1.department@company.example and user2.department@company.example. Another example is the group of all users which would be designated as ?@? or just ?. By appropriate assignment of public IMS UIDs varying group structures can be implemented.\nThe use of the KMS based security solution is at the users' discretion; its use may be controlled by a local policy in the IMS UE and the functionality may be access protected by e.g. a password. The local policy may also control if and when reusable tickets are allowed, if and when group tickets shall be requested and which group a ticket shall be issued for.  Furthermore, it may define under which conditions a received ticket shall be accepted. The local policy in the IMS UE should be in agreement with the global policy applied by the KMS.\nLocal policies may also control how and when warning messages are issued to the user.\nThe ticket format used in KMS based IMS media plane security is according to the base ticket format in MIKEY-TICKET [14] with the profiling defined in Annex D.\nMIKEY-TICKET [14] defines a Ticket Type value (2) for 3GPP usage. Subtypes and versions of this ticket type are defined by 3GPP and shall be specified in this specification, clause 6.2.3.4.2.\nTable 1: Allocation of ticket subtype and versions values\n\nWhen the KMS receives a REQUEST_INIT or RESOLVE_INIT request, the KMS needs to verify that the user issuing the request is authorized to do so. This verification is based on authentication of the requesting user’s KMS UID.\nWhen GBA is used, the user issuing the request is identified according to GBA procedures by the GBA B-TID carried in the request message to the KMS. The KMS uses the B-TID to request the the NAF-Key used to protect the request and USS information containing a list of all IMPUs, which are associated with the user.  The KMS then uses the list of IMPUs to derive all KMS UIDs associated with the requesting user. The KMS verifies that the KMS UID carried in the request is one of the derived identities. For RESOLVE_INIT, the KMS verifies that among the derived KMS UIDs, there is at least one (may not be the one carried in the request) matching the allowed recipient(s) identity in the ticket.\nIf a caller requests a ticket based on the identity of the expected responder, the call will most likely fail if the IMS network decides to divert the call to another destination. To handle call diversion it is recommended to set the allowed recipient in tickets to the wildcarded identity ?@?. This doesn’t affect the security of the solution since keys returned by the KMS are always forked based on the resolver’s identity.\nWhen an alternative system for KMS user authentication and key establishment is used it shall provide authentication of the requesting user’s KMS UID.\nIn IMS media plane security MIKEY-TICKET shall use key forking (see MIKEY-TICKET [14]) for authentication of terminating users. Key forking will provide authentication of terminating user identity. The TRANSFER_RESP message shall contain a KMS UID associated with the terminating user. The response message is authenticated with a key guaranteeing the authenticity of the KMS user identity.\nReusable tickets are allowed and their use is controlled by KMS and IMS UE local policies.\nA ticket can be issued as a reusable ticket. That a ticket is reusable has two meanings. For the user that requested the ticket, it means that the user can use the same ticket for setting up multiple calls with the intended recipient, usually within a specified time period. For the ticket recipient, it means that the ticket identity and the associated keys can be stored so that the recipient does not have to request keys from the KMS each time the ticket is received. It is however not required that reusable tickets are stored. Local policy may e.g. for capacity limited devices determine not to store such tickets. It is always allowed to resolve the ticket at the time the ticket is received.\nTickets that are not reusable shall be resolved when received at the terminating side.\nUsers served by different KMSs (KMS_I, KMS_R) may establish connections that provide e2e security provided that the KMSs cooperate and that there is a trust relation between them. The KMSs shall be mutually authenticated and the signalling between them shall be integrity and confidentiality protected. If KMS_R cannot resolve a ticket, but has a trust relation with KMS_I that can resolve the ticket, KMS_R initiates a new ticket resolve exchange with KMS_I. The response message from KMS_I is then re-encoded by KMS_R and forwarded to the responder as described in Annex B.  The message exchange shall be done as described in Section 10 of [14]. The exchanges and the messages in the exchanges are illustrated in Figure 4. Note that this introduces a hop-by-hop trust chain as only KMS_R authenticates the user (responder) and KMS_I will have to trust KMS_R.\nThe figure depicts the MIKEY-TICKET message exchanges between KMSs in a network. MIKEY-TICKET is a protocol used for secure communication between two KMSs, ensuring data integrity and confidentiality. The figure illustrates the message exchange process, including the use of encryption and authentication methods.\nFigure 4: MIKEY-TICKET message exchanges between KMSs\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 1: Allocation of ticket subtype and versions values",
                                    "table number": 1,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "6.2.4\tKey management mechanisms for e2DCe protection",
                            "text_content": "For IMS Data Channel traffic terminated by the MF/MRF, the MF/MRF shall send DTLS-protected SCTP packets to and accept DTLS-protected SCTP packets from the served UE as requested by the IMS AS via the P-CSCF.\nFor the definition of the Data Channel Media Function/MRF cf. TS 23.228 [3].\nThe key management mechanism for e2DCe protection of IMS data channel traffic shall be based on certificates and the transmission of certificate fingerprints as defined in RFC 8841 [48] and RFC 8842 [49].\nFor each IMS data channel media stream to be set-up with e2DCe security the P-CSCF shall send the certificate fingerprint received from the IMS UE over the Mw interface to the S-CSCF in a way that the S-CSCF is able to uniquely associate the fingerprint with a media stream. For IMS data channel media streams to be set-up with e2DCe security, the S-CSCF and IMS AS shall send the certificate fingerprint received from the IMS UE over the DC2 or Mr’/Cr or DC2 interface, respectively, to the MF/MRF in a way that the MF/MRF is able to uniquely associate the fingerprint with a media stream.\nFor each IMS data channel media stream to be set-up with e2DCe security the MF/MRF shall send the fingerprint of its certificate over the Mr’/Cr or DC2 interface to the S-CSCF in a way that the S-CSCF is able to uniquely associate the fingerprint with a media stream. For each IMS data channel media stream to be set-up with e2DCe security S-CSCF shall send the fingerprint of the MF/MRF certificate over the Mw interface to the P-CSCF in a way that the P-CSCF  is able to uniquely associate the fingerprint with a media stream.\nFor protection of session-based messaging traffic and IMS data channel traffic, the MF/MRF shall, upon reception of a certificate fingerprint, use the certificate fingerprint (as described in RFC 8841 [48]) to verify the establishment of the DTLS session to belong to the served user. When the DTLS session has been established, the MF/MRF shall be prepared to convert unprotected SCTP packets to protected SCTP packets and vice versa and send the packets to the UE or receive them from the UE, as described in clause 7.\nThe integrity of the fingerprints sent over the Mw and Mr’/Cr or DC2 interfaces is required. The Mw and Mr’/Cr or DC2 interfaces shall be protected by NDS/IP [5]. If cryptographic protection is applied to the Mw and Mr’/Cr or DC2 interfaces then integrity protection shall be used.\nNOTE: \tIf the P-CSCF (IMS-ALG), S-CSCF and MF/MRF are located in the same security domain then cryptographic protection is not mandated by NDS/IP. From TS 33.210 [5]: \"The Zb-interface is located between SEGs and NEs and between NEs within the same security domain. The Zb-interface is optional for implementation.\"\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tSecurity association set-up procedures for media protection",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tIMS UE registration procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.1.1\tIndication of support for e2ae security for RTP based media",
                            "text_content": "The IMS UE performs an IMS registration according to 3GPP TS 23.228 [3], with modifications as described in the following. When performing the registration, an IMS UE supporting the mechanisms required for e2ae protection according to this specification shall include an indication \"e2ae-security supported by UE\" in the initial REGISTER message unless the IMS UE’s policy dictates otherwise.\nWhen receiving indication \"e2ae-security supported by UE\" in the initial REGISTER message from the IMS UE the P-CSCF (IMS-ALG) shall store it.\nWhen the P-CSCF (IMS-ALG) is capable of supporting the mechanisms required for e2ae protection according to this specification, and the network policy is to prefer e2ae protection for this registration, the P-CSCF (IMS-ALG) shall include an indication \"e2ae-security supported by network\" in a message to the IMS UE during registration. The IMS UE shall store this indication for use with originating session set-up procedures.\nNOTE 1: \tThe names \"e2ae-security supported by UE\" and \"e2ae-security supported by network\" of the above indications are just placeholders for the purposes of this specification. Their syntax is defined in the corresponding stage 3 specification. These names refer to the RTP case only. Separate names for MSRP and BFCP are introduced from Rel-12 onwards, cf. clause 7.1.2 and Annex G of the present document.\nNOTE 2: \tThe network policy regarding e2ae protection could differ e.g. depending on the type of access network. Therefore, the policy may depend on the registration. This does not imply that the network policy depends on the individual subscription.\nWhen an IMS UE initiates a session and both the IMS UE and the P-CSCF (IMS-ALG) have indicated support of e2ae security for RTP, then the IMS UE shall secure all RTP media streams, either e2ae or e2e. When a P-CSCF (IMS-ALG) on the terminating side receives an INVITE for an RTP stream and the P-CSCF (IMS-ALG) and the terminating IMS UE have indicated support of e2ae security for RTP, the P-CSCF (IMS-ALG) shall secure all unprotected RTP streams towards the terminating IMS UE. A request for e2ae security from an IMS UE is only allowed if both the IMS UE and P-CSCF (IMS-ALG) have indicated support of e2ae security. On the terminating side, the P-CSCF (IMS-ALG) is only allowed to initiate e2ae security if both IMS UE and P-CSCF (IMS-ALG) have indicated support of e2ae security.\nNOTE 3:\tA session may contain a mixture of protected (e2ae and/or e2e) and unprotected media streams/sessions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.2\tIndication of support for e2ae security for MSRP",
                            "text_content": "Support for e2ae security for MSRP is indicated during registration in the same way as for RTP based media, cf. clause 7.1.1. It is done independently from the indication of support for e2ae security for RTP based media, and uses its own indications\" e2ae- security for MSRP supported by the UE\" and\" e2ae-security for MSRP supported by the network\" (the syntax is to be defined in the corresponding stage 3 specification).\nNOTE1:\tThe policies of the IMS UE and the network concerning the use of e2ae security for MSRP are independent from the policies concerning the use of e2ae security for RTP based media.\nNOTE2:\tFor compatibility with RCS 5.1, t he indication of support for e2ae security during registration is not a necessary prerequisite for the use of e2ae security, but it helps to avoid certain error cases, cf. Clause 7.2.1 and Clause 7.3.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.1.3\tIndication of support for e2DCe security for IMS data channel",
                            "text_content": "Support for e2DCe security for IMS data channel is indicated during registration in the same way as for RTP based media, cf. clause 7.1.1. It is done independently from the indication of support for e2ae security for other media and uses its own indications \"e2DCe-security for IMS data channel supported by the UE\" and \"e2DCe-security for IMS data channel supported by the network\" (the syntax is to be defined in the corresponding stage 3 specification).\nNOTE:\tThe policies of the IMS UE and the network concerning the use of e2DCe security for IMS data channel are independent from the policies concerning the use of e2ae security.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.2\tIMS UE originating procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tIMS UE originating procedures for e2ae",
                            "text_content": "Figure 7.2.1-1 shows the originating session set-up procedures for one or more media stream(s) using e2ae security.\nNOTE:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nThe figure depicts the call flow for an e2e (end-to-end) call in a 5G network, illustrating the various stages of the call from the origin to the destination. The flow includes the following components:\n\n1. **Originating Call**: The call originates from the user's device, typically a smartphone or a mobile device.\n2. **Call Routing**: The call is routed through various network elements, such as the base station (gNB), the mobile network (MNO), and the network edge (NE).\n3. **Call Switching**: The call is switched between different network elements, such as the gNB, the MNO, and the NE.\n4. **Call Reassembly**: The call is reassembled at the destination, typically a mobile device or a fixed network (FNO).\n5. **Call End**: The call ends at the destination, typically a fixed network (FNO).\n\nThe figure provides a visual representation of the call flow, highlighting the importance of network elements and their interactions in the 5G network.\nFigure 7.2.1-1: Originating call flow for e2ae case\nThe IMS UE A performs an IMS originating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. If both IMS UE and network indicated support for e2ae security for RTP based traffic during registration, then the IMS UE shall request e2ae security for RTP media streams to be established as described in this clause, unless the IMS UE initiates a procedure for e2e security for a RTP media stream. If both IMS UE and network indicated support for e2ae security for MSRP during registration, then the IMS UE shall request e2ae security for MSRP media streams to be established as described in this clause, unless the IMS UE initiates a procedure for e2e security for an MSRP media stream.\nThe originating procedures for establishing media streams with e2e security are described in clauses 7.2.2 (for RTP only) and 7.2.3 of this specification. The IMS UE may learn of a preference for e2e security for a particular session or media stream by explicit user action via the user interface or by the security policy implemented on the IMS UE.\nThe procedure in the above figure for requesting e2ae security for a media stream is now described step-by-step.\n1.\tIMS UE A sends an SDP Offer for a media stream containing cryptographic information, together with an indication \"e2ae-security requested by UE\", to the P-CSCF (IMS-ALG).\nFor e2ae protection of RTP using SDES, the cryptographic information contained in the SDP Offer consists of one or more SDES crypto attributes, each of these containing at least one master key K11, and other security context parameters chosen by IMS UE A in accordance with RFC 4568 [13]. The optional key lifetime field shall be omitted. For e2ae protection of DTLS-SRTP, the SDP Offer contains a setup attribute controlling DTLS roles and a fingerprint computed from UE A certificate, in accordance with RFC 5763 [40].\n\nNOTE 1: \tThe omission of the key lifetime field is, according to RFC 4568 [13], a way to implicitly signal the default values for the key lifetime as defined in RFC 3711 [9]. The default values are 2^48 SRTP packets and 2^31 SRTCP packets\nFor e2ae protection of MSRP the cryptographic information contained in the SDP Offer consists of the fingerprint of the certificate of IMS UE A in accordance to RFC 4975 [21]. For e2ae protection of WebRTC data channel the cryptographic information contained in the SDP Offer consists of the fingerprint of the certificate of IMS UE and the TLS ID identifier, in accordance with RFC 8841 [48].\n2.\tFor each media stream that uses transport \" RTP/SAVP \", \"RTP/SAVPF\", \"TCP/TLS/MSRP\", or \"UDP/DTLS/SCTP\", the P-CSCF (IMS-ALG) checks for the presence of the indication \"e2ae-security requested by UE\".\nIf the indication is present and the P-CSCF (IMS-ALG) indicated support of e2ae-security for the respective protocol (RTP, and/or MSRP, and/or WebRTC data channel) during registration, the P-CSCF (IMS-ALG) allocates the required resources, includes the IMS Access GW in the media path and proceeds as specified in this clause. If the indication is not present for an SRTP media stream the P-CSCF (IMS-ALG) proceeds for this media stream as described in clause 7.2.2 or clause 7.2.3 of the present specification.\nIf the indication is not present for an MSRP media stream offered with transport \"TCP/TLS/MSRP\", the P-CSCF (IMS-ALG) should proceed for this media stream as described in clause 7.2.3 of the present specification or in TS 23.228 [3] and skip the further steps in the present subclause. If compatibility with RCS 5.1 [27] is desired, a P-CSCF may, based on local policy, allocate the required resources, include the IMS Access GW in the media path and proceed as specified in this clause.\nNOTE 1a: \tAccording to the above, an operator can choose to terminate TLS in the IMS Access GW according to the following steps for all media streams that are signalled in SIP INVITE messages with transport TCP/TLS/MSRP and a certificate fingerprint attribute, even if the UE did not indicate support for e2ae security during registration and did not indicate usage of e2ae security for the respective media streams in the INVITE. This can lead to session failures for pre-Rel-12 IMS UEs or non-IMS UEs due to a mismatch of security parameters sent by the network and expected by the UE, but on the other hand, it will ensure compatibility with RCS 5.1 [27], which specifies that TLS for MSRP is always terminated in the network. It is therefore advantageous that IMS UEs compliant to the present specification use indications if they want to establish e2ae security for MSRP rather than relying on the network to terminate TLS even if no indication is present.\nNOTE 2: \tThe inclusion of the IMS Access GW in the media path is required for the purposes of e2ae security even if it was not required otherwise.\nNOTE 2a: If an indication for e2ae security for a media stream is present in an SDP offer but the support for e2ae security for the respective protocol was not successfully established during registration then this is an error case.\n3.\tThe P-CSCF (IMS-ALG) modifies the SDP offer before sending it towards the S-CSCF.\nFor e2ae protection of RTP using SDES, the P-CSCF (IMS-ALG) changes the transport from SRTP to RTP in the SDP Offer, selects one SDES crypto attribute and removes all received SDES crypto attributes and the indication \"e2ae-security requested by UE\" from the SDP Offer\nFor e2ae protection of MSRP, the P-CSCF (IMS-ALG) shall change the transport from \"TCP/TLS/MSRP\" to \"TCP/MSRP\" in the SDP Offer (cf., however, NOTE 4), stores the received fingerprint of the IMS UE A certificate and removes it as well as the indication \"e2ae-security requested by UE\" from the description of the media stream in the SDP Offer if present.\nThe P-CSCF (IMS-ALG) then sends the changed SDP offer towards the S-CSCF.\n4.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer to the terminating network.\n5.\tThe S-CSCF receives the SDP Answer from the terminating network.\n6.\tThe S-CSCF forwards the SDP Answer to the P-CSCF (IMS-ALG).\n7.\t The P-CSCF (IMS-ALG) and the IMS Access GW exchangethe cryptographic information.\nFor e2ae protection of RTP using SDES this requires that the P-CSCF (IMS-ALG) creates one SDES crypto attribute, containing at least one master key K12, and other security context parameters chosen by the P-CSCF (IMS-ALG) in accordance with RFC 4568 [13], for protecting the RTP media stream towards IMS UE A between the IMS Access GW and IMS UE A. The P-CSCF (IMS-ALG) communicates the parameters contained in the SDES crypto attribute selected in step 3 as well as those in the SDES crypto attribute created in step 7 to the IMS Access GW. The P-CSCF (IMS-ALG) instructs the IMS Access GW to check integrity / decrypt the media stream arriving from IMS UE A using K11 (and possibly further master keys), to integrity protect / encrypt the media stream arriving from the terminating network using K12 (and possibly further master keys), and to set the key lifetime to the default values as defined in RFC 3711 [9].\nFor e2ae protection of MSRP the cryptographic information communicated by the P-CSCF (IMS-ALG) to the IMS Access GW consists of the fingerprint of the UE´s certificate in accordance to RFC 4975 [21]. The P-CSCF (IMS-ALG) instructs the IMS Access GW to verify during the subsequent TLS handshake with the IMS UE (see step 9) that the fingerprint of the certificate passed by the IMS UE during this TLS handshake matches the fingerprint passed by the P-CSCF (IMS-ALG) to the IMS Access GW. In turn, the IMS Access GW communicates the fingerprint of the certificate it is going to use for setting up protection for this media stream to the P-CSCF (IMS-ALG).\nThe P-CSCF (IMS-ALG) modifies the SDP Answer before sending it to the IMS UE A.\nFor e2ae protection of RTP, the P-CSCF (IMS-ALG) shall change the transport from RTP to SRTP in the SDP Answer and includes the SDES crypto attribute created in step 7. The optional key lifetime field shall be omitted.\nFor e2ae protection of MSRP, the P-CSCF (IMS-ALG) shall set the transport to \"TCP/TLS/MSRP\" , remove any fingerprint attributes in the SDP Answer, if present, and include the fingerprint of the IMS Access GW´s certificate in accordance to RFC 4975 [21].\nThe P-CSCF (IMA-ALG) then sends the updated SDP Answer to IMS UE A. After receiving this message, IMS UE A completes the media security setup.\nNOTE 3:\tThe IMS UE can deduce that e2ae security is used from two facts: first, that the P-CSCF (IMS-ALG) indicated its support for e2ae security during registration, and second, that the IMS UE requested e2ae-security in the SDP Offer.\n9.\tIn case of RTP, when the full session setup has been completed, and media can be sent, the protected media stream is sent between IMS UE A and the IMS Access GW. IMS UE A integrity protects / encrypts and checks integrity / decrypts the media stream sent to and received from the network. The IMS Access GW checks integrity / decrypts the media stream arriving from IMS UE A before passing it on towards the terminating network. The IMS Access GW integrity protects / encrypts the media stream arriving from the terminating network before passing it on to IMS UE A.\nIn case of MSRP, when the full session setup has been completed, the TCP and TLS connection shall be established between the IMS UE and the IMS Access GW. When subsequently media are sent from or to the IMS UE, the IMS Access GW performs the required TLS specific cryptographic operations on the media.\nNOTE 4:\tIn case cryptographic protection is also used in the core network, the IMS Access GW will also perform the necessary functions for this additional cryptographic protection. A network may have for example the policy to use TLS for MSRP also inside the core network. In this case, when e2ae security is used, TLS has to be established also from the IMS Access GW towards the core network. This may require enhancements to the procedure described above but is outside of the scope of this specification.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tIMS UE originating procedures for e2e using SDES",
                            "text_content": "Figure 7.2.2-1 shows the originating call set-up procedures for one RTP media stream using SDES based e2e security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nNOTE 2:\tE2e protected RTP sessions and/or media streams are set-up without IMS-ALG support, which means that such sessions can be set-up in networks not providing the IMS-ALG functionality in the P-CSCF.\n\nThe figure depicts the originating call flow for an e2e case using SDES (Service Delivery Environment). It illustrates the flow of calls from the originating network to the destination network, including the use of SDES for call routing and signaling. The figure shows the various components involved in the call flow, such as the originating network, the destination network, and the SDES, which are essential for ensuring reliable and efficient communication.\nFigure 7.2.2-1: Originating call flow for e2e case using SDES\nThe IMS UE performs an IMS originating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. The IMS UE may learn of a preference for e2e-security for a particular RTP media stream/session using a particular key management protocol by explicit user action via the user interface or by the security policy implemented on the IMS UE.\nNOTE 3: \tThe procedure described here is the same as for legacy UEs not fully conforming to this specification, which can also use SDES to establish e2e security.\nThe procedure in the above figure is now described step-by-step.\n1.\tIMS UE A sends an SDP Offer for an SRTP stream containing one or more SDES crypto attributes to the P-CSCF. Each of these SDES crypto attributes contains at least one master key K1, and other security context parameters chosen by IMS UE A in accordance with RFC 4568 [13]. IMS UE A does not include any indication regarding the required security scope, i.e. e2e security or e2ae security.\n2.\tIf the P-CSCF supports e2ae security, the P-CSCF (IMS-ALG) checks for the presence of the indication \"e2ae-security requested by UE\". As the indication is not present, the P-CSCF forwards the SDP offer towards the S-CSCF. If an indication is present the P-CSCF proceeds as described in clause 7.2.1 of this specification.\n3.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer to the terminating network.\n4.\tThe S-CSCF receives the SDP Answer from the terminating network containing one SDES crypto attribute with at least one master key K2, and other security context parameters chosen by IMS UE B in accordance with RFC 4568 [13].\n5.\tThe S-CSCF forwards the SDP Answer to the P-CSCF.\n6.\tThe P-CSCF forwards the SDP Answer to IMS UE A. After receiving this message IMS UE A completes the media security setup.\n7.\tWhen the full session setup has been completed, and media can be sent, the protected RTP media stream is sent between IMS UE A and IMS UE B. IMS UE A integrity protects / encr ypts the media stream sent towards IMS UE B using key K1 (and possibly further master keys) from the crypto attribute selected by IMS UE B and checks integrity / decrypts the media stream arriving from IMS UE B using key K2 (and possibly further master keys).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\tIMS UE originating procedures for e2e using KMS",
                            "text_content": "Figure 7.2.3-1 shows the originating call set-up procedures for one RTP or one MSRP session using KMS based security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nNOTE 2:\tE2e protected RTP or MSRP sessions are set-up without IMS-ALG support, which means that such sessions can be set-up in networks not providing the IMS-ALG functionality in the P-CSCF.\nThe figure depicts the call flow for an e2e case using KMS, illustrating the steps involved in initiating a call between two endpoints. The flow starts with the originator initiating the call, followed by the destination endpoint, and finally the call is completed by the terminating endpoint. The figure provides a visual representation of the call flow, allowing for easy understanding of the process.\nFigure 7.2.3-1: Originating call flow for e2e case using KMS\nThe IMS UE performs an IMS originating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. The IMS UE may learn of a preference for e2e-security for a particular session using a particular key management protocol by explicit user action via the user interface or by the security policy implemented on the IMS UE. KMS interactions are described in clause 6.2.3.1. Details of the KMS based key management are given in Annex B.\nThe procedure in the above figure is now described step-by-step.\n1.\tDepending on KMS and local policy, the IMS UE A will either interact with the KMS to obtain keys and a MIKEY-TICKET Ticket usable for IMS UE B, or it will create the ticket by itself. In the latter case, MIKEY-TICKET [14] mode 3 is used, and IMS UE A will then perform all key and ticket generation functions otherwise performed by the KMS. The ticket is protected with a key, e.g. a NAF-key that the IMS UE shares with the KMS.\n2.\tIMS UE A sends an SDP offer for an RTP or MSRP session containing a MIKEY-TICKET offer for IMS UE B to the P-CSCF.\n3.\tIf the P-CSCF supports e2ae security, the P-CSCF (IMS-ALG) checks for the presence of the indication \"e2ae-security requested by UE\". As the indication is not present, the P-CSCF forwards the SDP offer towards the S-CSCF.\n4.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP offer to the terminating network.\n5.\tThe S-CSCF receives the SDP answer from the terminating network containing a MIKEY-TICKET response.\n6.\tThe S-CSCF forwards the SDP answer to the P-CSCF.\n7.\tThe P-CSCF forwards the SDP answer to IMS UE A. After receiving this message the IMS UE A checks that the responder is authorized before completing the media security setup.\n8.\tIMS UE-A derives the media session keys and initiates the media plane security. For an RTP session this means sending and receiving SRT(C)P streams and for an MSRP session this means setting up a TLS-PSK tunnel to protect the MSRP messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.4\tIMS UE originating procedures for e2DCe",
                            "text_content": "Figure 7.2.4-1 shows the originating session set-up procedures for one or more media stream(s) using e2DCe security.\nThe figure depicts the call flow for e2DCe, a 4G/5G enhanced mobile broadband (eMBB) service, using the DCMF/MRF case. It illustrates the various steps involved in the call setup, including the initiation of the call, the routing of the call to the appropriate network, and the termination of the call. The figure also shows the use of DCMF/MRF technology to improve call quality and reduce latency.\nFigure 7.2.4-1: Originating call flow for e2DCe using DCMF/MRF case\nThe IMS UE A performs an IMS originating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. If both IMS UE and network indicated support for e2DCe security for IMS data channel during registration, then the IMS UE shall request e2DCe security for IMS data channel media streams to be established as described in this clause, unless the IMS UE initiates a procedure for e2e security for an IMS data channel media stream.\nThe originating procedures for establishing IMS data channels with e2e security are described in clause 7.2.5 of this specification. The IMS UE may learn of a preference for e2e security for a particular session or media stream by explicit user action via the user interface or by the security policy implemented on the IMS UE.\nThe procedure in the above figure for requesting e2DCe security for a media stream is now described step-by-step.\n1.\tIMS UE A sends an SDP Offer for a media stream containing cryptographic information, together with an indication \"e2DCe-security for IMS data channel requested by UE\", to the IMS AS via the P-CSCF .\nFor e2DCe protection of IMS data channel the cryptographic information contained in the SDP Offer consists of the fingerprint of the certificate of IMS UE and the tls-id attribute, in accordance with RFC 8841 [48].\n2.\tFor each media stream that uses transport \"UDP/DTLS/SCTP\", the P-CSCF (IMS-ALG) checks for the presence of the indication \"e2DCe-security for IMS data channel requested by UE\".\nIf the indication is present and the P-CSCF (IMS-ALG) indicated support of e2DCe-security for IMS data channel during registration, the P-CSCF (IMS-ALG) allocates the required resources, includes the IMS Access GW and Data Channel Media Function/MRF in the media path and proceeds as specified in this clause. If the indication is not present for an IMS data channel media stream, the P-CSCF (IMS-ALG) proceeds for this media stream as described in clause 7.2.5 of the present specification.\nNOTE 1: \tThe inclusion of the IMS Access GW and Data Channel Media Function /MRF in the media path is needed for the purposes of e2DCe security even if it was not needed otherwise.\nNOTE 2:\tIf an indication for e2DCe security for a media stream is present in an SDP offer but the support for e2DCe security for the respective protocol was not successfully established during registration then this is an error case.\n3.\tThe IMS AS sends the SDP offer towards the S-CSCF.\n4.\tFor e2DCe protection of IMS Data Channel, the S-CSCF stores the received fingerprint of the IMS UE A certificate, performs the required procedures according to TS 23.228 [3], and forwards the SDP Offer to the terminating network.\n5.\tThe S-CSCF receives the SDP Answer from the terminating network.\n6.\tThe S-CSCF sends the SDP answer towards the IMS AS.\n7.\tThe IMS AS and the Data Channel Media Function/MRF exchange the cryptographic information.\nFor e2DCe protection of IMS Data Channel the cryptographic information communicated by the IMS AS to the Data Channel Media Function/MRF consists of the fingerprint of the UE's certificate and tls-id in accordance with RFC 8841 [48]. The IMS AS instructs the Data Channel Media Function/MRF to verify during the subsequent DTLS handshake with the IMS UE (see step 10) that the fingerprint of the certificate passed by the IMS UE during this DTLS handshake matches the fingerprint passed by the IMS AS to the Data Channel Media Function/MRF. In turn, the Data Channel Media Function/MRF communicates the fingerprint of the certificate it is going to use for setting up protection for this media stream to the IMS AS.\n8.\tThe S-CSCF forwards the SDP Answer to the P-CSCF (IMS-ALG).\n9.\tThe P-CSCF (IMS-ALG) sends the SDP Answer to the IMS UE A. After receiving this message, IMS UE A completes the media security setup.\nNOTE 3:\tThe IMS UE can deduce that e2DCe security is used from two facts: first, that the P-CSCF (IMS-ALG) indicated its support for e2DCe security during registration, and second, that the IMS UE requested e2DCe-security in the SDP Offer.\n10.\tIn case of IMS data channel, when the full session setup has been completed, the DTLS connection shall be established between the IMS UE and the Data Channel Media Function/MRF. When subsequently media are sent from or to the IMS UE, the UE and the Data Channel Media Function/MRF perform the required DTLS specific cryptographic operations on the media.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.5\tIMS UE originating procedures for e2e using TLS/DTLS certificate / fingerprint",
                            "text_content": "Figure 7.2.5-1 shows the originating call set-up procedures for one IMS data channel media stream using DTLS-based e2e security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nNOTE 2:\tE2e protected IMS data channel sessions and/or media streams are set up without IMS-ALG support, which means that such sessions can be set up in networks not providing the IMS-ALG functionality in the P-CSCF.\nThe figure depicts the flow of an originating call in a 5-1 e2e case, illustrating the use of certificate and fingerprint authentication methods.`\nFigure 7.2.5-1: Originating call flow for e2e case using certificate / fingerprint\nThe IMS UE performs an IMS originating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. The IMS UE may learn of a preference for e2e-security for a particular IMS data channel media stream/session using a particular key management protocol by explicit user action via the user interface or by the security policy implemented on the IMS UE.\nThe procedure in the above figure is now described step-by-step.\n1.\tIMS UE A sends an SDP Offer for an IMS data channel stream containing fingerprint, tls-id, and setup attributes to the P-CSCF, according to RFC 8841 [48]. IMS UE A does not include any indication regarding the required security scope, i.e., e2DCe security, or e2ae security.\n2.\tIf the P-CSCF supports e2ae security and/or e2DCe security, the P-CSCF (IMS-ALG) checks for the presence of the indications \"e2ae-security requested by UE\" and \"e2DCe-security for IMS data channel requested by UE\". As neither one of the indications is present, the P-CSCF forwards the SDP offer towards the S-CSCF. If an indication is present the P-CSCF proceeds as described in clauses 7.2.1 or 7.2.4 of the present document, respectively.\n3.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer to the terminating network.\n4.\tThe S-CSCF receives the SDP Answer from the terminating network containing fingerprint, tls-id, and setup attributes chosen by IMS UE B in accordance with RFC 8841 [48].\n5.\tThe S-CSCF forwards the SDP Answer to the P-CSCF.\n6.\tThe P-CSCF forwards the SDP Answer to IMS UE A. After receiving this message, IMS UE A completes the media security setup by either initiating DTLS handshake (if setup attribute of the SDP Answer indicated that UE A is DTLS client) or waiting for the peer to initiate DTLS handshake (if setup attribute of SDP Answer indicated that UE A is DTLS server), in accordance with RFC 8841 [48].\n7.\tWhen the full session setup has been completed, and media can be sent, the protected IMS data channel media stream is sent between IMS UE A and IMS UE B. IMS UE A integrity protects / encrypts the media stream sent towards IMS UE B using the previously exchanged keys from DTLS handshake and checks integrity / decrypts the media stream arriving from IMS UE B using the previously exchanged keys from DTLS handshake.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3\tUE terminating procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3.1\tUE terminating procedures for e2ae",
                            "text_content": "Figure 7.3.1-1 shows the terminating session set-up procedures for one or more media stream using e2ae security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\n\nThe figure depicts a flow diagram for terminating call flow in an e2e (end-to-end) call scenario. It illustrates the steps taken by the call flow, including the initiation of the call, the routing of the call to the appropriate network, and the termination of the call. The flow is represented by arrows, with the initiation of the call at the top, the routing to the network at the bottom, and the termination at the bottom. The figure provides a visual representation of the complex process involved in terminating an e2e call, highlighting the importance of proper routing and call management in ensuring a smooth and efficient communication experience.\nFigure 7.3.1.-1: Terminating call flow for e2ae case\nThe IMS UE performs an IMS terminating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. If both IMS UE and network indicated support for e2ae-security for RTP based traffic during registration and the P-CSCF (IMS-ALG) receives an SDP Offer for an RTP media stream using transport \"RTP/AVP\" or \"RTP/AVPF\" (i.e. no SRTP) from the S-CSCF, then the P-CSCF (IMS-ALG) shall establish e2ae-security for the RTP media stream as described in this clause. If both IMS UE and network indicated support for e2ae-security for MSRP during registration and the P-CSCF (IMS-ALG) receives an SDP Offer for an MSRP media stream using transport \"TCP/MSRP\" (i.e. no TLS) from the S-CSCF, then the P-CSCF (IMS-ALG) shall establish e2ae-security for the MSRP media stream as described in this clause.\nNOTE 2: \tThe P-CSCF (IMS-ALG) will not establish e2ae security for RTP based media if the SDP offer received from the S-CSCF indicates that e2e security is being offered, cf. clauses 7.3.2 and 7.3.3 for the establishment of e2e security on the terminating side.\nThe procedure in the above figure is now described step-by-step.\n1.\tThe S-CSCF in the terminating network receives an SDP Offer for an RTP media stream with transport \"RTP/AVP\" or \"RTP/AVPF\" or an MSRP stream with transport \"TCP/MSRP\" from the originating network.\n2.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer for the media stream to the P-CSCF (IMS-ALG).\n3.\tThe P-CSCF (IMS-ALG) checks the media streams in the SDP Offer.\nFor each RTP media stream offered with transport \"RTP/AVP\" or \"RTP/AVPF\", if ,both the IMS UE and the P-CSCF (IMS-ALG) indicated support of e2ae-security during registration the P-CSCF (IMS-ALG) proceeds for this media stream as described in the present clause and allocates the required resources and includes the IMS Access GW in the media path. For each RTP media stream offered with transport \"RTP/AVP\" or \"RTP/AVPF\" where this is not the case the P-CSCF (IMS-ALG) continues as described for a call without IMS media plane security.\nFor each RTP media stream offered with transport \"RTP/SAVP\" or \"RTP/SAVPF\", the P-CSCF (IMS-ALG) proceeds as described in clause 7.3.2 or 7.3.3.\nFor each MSRP media stream offered with transport \"TCP/MSRP\",\n-\tif both the IMS UE and P-CSCF (IMS-ALG) indicated support for e2ae-security for MSRP during registration, the P-CSCF (IMS-ALG) proceeds for this media stream  as described in this clause and allocates the required resources, includes the IMS Access GW in the media path for establishing the TLS/DTLS towards the IMS UE and retrieves from the IMS Access GW the fingerprint of the certificate the IMS Access GW is going to use for setting up security for this media stream\n-\tif not both the IMS UE and P-CSCF (IMS-ALG) indicated support for e2ae-security for MSRP during registration, the P-CSCF (IMS-ALG) should continue as described for media streams without IMS media plane security. If compatibility with RCS 5.1 [27] is desired, a P-CSCF may, based on local policy, proceed for this media stream as described in the preceding paragraph.\nFor each MSRP media stream offered with transport \"TCP/TLS/MSRP\" the P-CSCF (IMS-ALG) should proceed as specified in clause 7.3.3 of the present specification or in TS 23.228 [3] or may, depending on its local policy, terminate TLS and proceed as specified in this clause.\nNOTE 2a: \tAccording to the above, an operator can choose to set up e2ae security for terminating MSRP media streams according to the following steps for all MSRP media streams that would otherwise not be protected by TLS, even if the UE did not indicate support for e2ae security during registration. This can lead to session failures for pre-Rel-12 IMS UEs or non-IMS UEs that do not support MSRP over TLS with self-signed certificates and the exchange of certificate fingerprints, but on the other hand, it will ensure compatibility with RCS 5.1 [27], which recommends to always use e2ae security for MSRP on the terminating leg. Furthermore, an operator can choose to always terminate TLS when offered from the originating side, but this again can lead to session failures due to a mismatch of security parameters sent by the network and expected by the UE..\n\nNOTE 3: \tThe inclusion of the IMS Access GW in the media path is required for the purposes of e2ae security even if it was not required otherwise.\n4.\tThe P-CSCF (IMS-ALG) modifies the SDP Offer before sending it to the IMS UE B.\nFor e2ae protection of RTP the P-CSCF (IMS-ALG) changes the transport from RTP to SRTP in the SDP Offer, includes one or more SDES crypto attributes, as well as an indication that e2ae security is offered by the network. Each of these SDES crypto attributes contains at least one master key K21, and other security context parameters chosen by the P-CSCF (IMS-ALG) in accordance with RFC 4568 [13]. The optional key lifetime field shall be omitted.\nFor e2ae protection of an MSRP media stream the P-CSCF (IMS-ALG) sets the transport to \"TCP/TLS/MSRP\" in the SDP Offer, removes any fingerprint attributes for this media stream and include the fingerprint of the IMS Access GW´s certificate in accordance to RFC 4975 [21] as well as an indication that e2ae security is offered by the network.\nThe P-CSCF (IMS-ALG) then sends the updated SDP Offer to IMS UE B.\n5.\tIMS UE B replies with an SDP Answer for a secured media stream.\nFor e2ae protection of SRTP, the IMS UE B includes in the SDP Answer one of the received SDES crypto attributes containing at least one master key K22, and other security context parameters chosen by IMS UE B in accordance with RFC 4568 [13]. The optional key lifetime field shall be omitted.\nFor e2ae protection of MSRP, the IMS UE B includes in the SDP Answer the fingerprint of the UE´s certificate in accordance to RFC 4975 [21].\n6.\tThe P-CSCF (IMS-ALG) communicates the cryptographic information contained in the SDP Answer to the IMS Access GW.\nFor e2ae protection of RTP, this includes the parameters contained in the SDES crypto attribute selected by IMS UE B in step 5 as well as those in the SDES crypto attribute sent by IMS UE B in step 5 to the  P-CSCF (IMS-ALG). The P-CSCF (IMS-ALG) instructs the IMS Access GW to check integrity / decrypt the media stream arriving from IMS UE B using K22 (and possibly further master keys), to integrity protect / encrypt the media stream arriving from the originating network using K21 (and possibly further master keys), and to set the key lifetime to the default values as defined in RFC 3711 [9].\nFor e2ae protection of MSRP, the cryptographic information communicated to the IMS Access GW consists on the fingerprint of the IMS UE B certificate in accordance to RFC 4975 [21 The P-CSCF (IMS-ALG) instructs the IMS Access GW to verify during the subsequent TLS handshake with the IMS UE (see step 9) that the fingerprint of the certificate passed by the IMS UE during this TLS handshake matches the fingerprint passed by the P-CSCF (IMS-ALG) to the IMS Access GW.].\n7.\tThe P-CSCF (IMS-ALG) modifies the SDP Answer before sending it to the S-CSCF.\nFor e2ae protection of SRTP, the P-CSCF (IMS-ALG) changes the transport from SRTP to RTP in the SDP Answer and removes the SDES crypto attribute.\nFor e2ae protection of MSRP, the P-CSCF (IMS-ALG) changes the transport from \"TCP/TLS/MSRP\" to “TCP/MSRP” in the SDP Answe r (cf., however, NOTE 4) . Further, it removes the fingerprint of the IMS UE B certificate.\nThe P-CSCF (IMS-ALG)  then sends the SDP Answer to the S-CSCF.\n8.\tThe S-CSCF forwards the SDP Answer towards the originating network.\n9.\tIn case of RTP, when the full session setup has been completed, and media can be sent, the protected media streams are sent between the IMS UE B and IMS Access GW. IMS UE B integrity protects / encrypts and integrity check / decrypts the media streams sent to and received from the network. The IMS Access GW integrity checks / decrypts the media stream arriving from IMS UE B before passing it on towards the originating network. The IMS Access GW integrity protects / encrypts the media stream arriving from the originating network before passing it on to IMS UE B.\nA P-CSCF (IMS-ALG) supporting e2ae-security shall remove any indication \"e2ae-security offered by network\" if inserted in a SIP message by another party.\nIn case of MSRP, when the full session setup has been completed, the TCP and TLS connection shall be established between the IMS UE and the IMS Access GW. When subsequently media are sent from or to the IMS UE, the IMS Access GW performs the required TLS specific cryptographic operations on the media.\nNOTE 4:\tA network may have the policy to use TLS for MSRP also inside the core network. So TLS from the direction of the core network may be terminated at the IMS Access GW. This may require enhancements to the procedure described above but is outside of the scope of this specification.\nNOTE 5:\t It is left to stage 3 specifications whether the IMS UE takes the role of TLS client or TLS server. These alternatives are equivalent from a security point of view.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.2\tIMS UE terminating procedures for e2e using SDES",
                            "text_content": "Figure 7.3.2-1 shows the terminating call set-up procedures for one RTP media stream using e2e security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nNOTE 2:\tE2e protected RTP sessions and/or media streams are set-up without IMS-ALG support, which means that such sessions can be set-up in networks not providing the IMS-ALG functionality in the P-CSCF.\n\nThe figure depicts a terminating call flow for an e2e case using SDES (Session Description and Encapsulation), illustrating the flow of data between the source and destination devices. The flow includes the initiation of a call, the initiation of a session, the initiation of a session description, the initiation of a session encapsulation, the initiation of a session termination, and the initiation of a session termination description. The flow is depicted in a flowchart format, with arrows indicating the direction of the flow.\nFigure 7.3.2-1: Terminating call flow for e2e case using SDES\nThe IMS UE performs an IMS terminating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following.\nNOTE 3: \tThe procedure described here is the same as for legacy UEs not fully conforming to this specification, which may also use SDES to establish e2e security.\nThe procedure in the above figure is now described step-by-step.\n1.\tThe S-CSCF in the terminating network receives an SDP Offer for an SRTP media stream including one or more SDES crypto attributes from the originating network. Each of these SDES crypto attributes contains at least one master key K1, and other security context parameters chosen by IMS UE A in accordance with RFC 4568 [13].\n2.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer for the SRTP media stream to the P-CSCF.\n3.\tThe P-CSCF forwards the SDP Offer for the SRTP media stream to IMS UE B.\n4.\tIMS UE B selects one of the received SDES crypto attributes, and then replies with an SDP Answer for an SRTP media stream, including one SDES crypto attribute with at least one master key K2, and other security context parameters chosen by IMS UE B in accordance with RFC 4568 [13].\n5.\tThe P-CSCF forwards the SDP Answer to the S-CSCF.\n6.\tThe S-CSCF forwards the SDP Answer towards the originating network.\n7.\tWhen the full session setup has been completed, and media can be sent, the protected RTP media stream is sent between IMS UE A and IMS UE B. IMS UE B integrity protects / encrypts the RTP media stream sent towards IMS UE A using key K2 (and possibly further master keys) and checks integrity / decrypts the RTP media stream arriving from IMS UE A using key K1 (and possibly further master keys) from the crypto attribute selected by IMS UE B.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.3\tIMS UE terminating procedures for e2e using KMS",
                            "text_content": "Figure 7.3.3-1 shows the terminating call set-up procedures for one RTP or one MSRP session using KMS based security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nNOTE 2:\tE2e protected RTP or MSRP sessions are set-up without IMS-ALG support, which means that such sessions can be set-up in networks not providing the IMS-ALG functionality in the P-CSCF.\n\n\n\nFigure 7.3.3-1: Terminating call flow for e2e case using KMS\nAn IMS terminating session set-up according to 3GPP TS 23.228 [3] is performed, with modifications as described in the following. KMS interactions are described in clause 6.2.3.1. Details of the KMS based key management are given in Annex B.\nThe procedure in the above figure is now described step-by-step.\n1.\tThe S-CSCF in the terminating network receives an SDP offer for an RTP or MSRP session containing a MIKEY-TICKET offer.\n2.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP offer to the P-CSCF.\n3.\tThe P-CSCF forwards the SDP offer to IMS UE B.\n4.\tIMS UE B checks if it is authorized to resolve the ticket and if that is the case IMS UE B interacts with the KMS to resolve the ticket and receive keys.\n5.\tIMS UE B replies with an SDP answer for an RTP or MSRP session, including a MIKEY-TICKET response.\n6.\tThe P-CSCF forwards the SDP answer to the S-CSCF.\n7.\tThe S-CSCF forwards the SDP answer towards the originating network.\nIMS UE-B derives the media session keys and initiates the media plane security.  For an RTP session this means sending and receiving SRT(C)P streams and for an MSRP session this means setting up a TLS-PSK tunnel to protect the MSRP messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.4\tUE terminating procedures for e2DCe",
                            "text_content": "Figure 7.3.4-1 shows the terminating session set-up procedures for one or more media streams using e2DCe security.\nNOTE 1:\tThe procedures shown in the figure apply to users located in their home service area. The same concepts apply to roaming users.\nThe figure depicts a terminating call flow for an e2DCe (Enhanced 2-way Dedicated Circuit) using DCMF/MRF (Differential Circuit Modulation/Multiple Resource Flow) case. It illustrates the flow of data between the source and destination devices, including the use of DCMF/MRF to ensure reliable communication.\nFigure 7.3.4-1: Terminating call flow for e2DCe using DCMF/MRF case\nThe IMS UE performs an IMS terminating session set-up according to 3GPP TS 23.228 [3], with modifications as described in the following. If both IMS UE and network indicated support for e2DCe-security for IMS data channel media streams during registration and the P-CSCF receives an SDP Offer for an IMS data channel media stream using \"UDP/DTLS/SCTP\" transport from the S-CSCF, then the P-CSCF (IMS-ALG) shall establish e2DCe-security for the IMS data channel media stream as described in this clause.\nNOTE 2: \tThe P-CSCF (IMS-ALG) will not establish e2DCe security for IMS data channel media if the SDP offer received from the S-CSCF indicates that e2e security is being offered, cf. clauses 7.3.2, 7.3.3, and 7.3.5 for the establishment of e2e security on the terminating side.\nThe procedure in the above figure is now described step-by-step.\n1.\tThe S-CSCF in the terminating network receives an SDP Offer for an IMS data channel stream with transport \"UDP/DTLS/SCTP\" from the originating network.\n2.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer for the media stream to the IMS AS.\n3.\tThe IMS-AS checks the media streams in the SDP Offer.\nFor each IMS data channel media stream offered with transport \"UDP/DTLS/SCTP\",\n-\tif both the IMS UE and P-CSCF (IMS-ALG) indicated support for e2DCe-security for IMS data channel during registration, the IMS-AS and S-CSCF proceeds for the respective media stream as described in this clause and allocates the required resources, includes the Media Function/MRF in the media path for establishing the DTLS towards the IMS UE and retrieves from the Media Function/MRF the fingerprint, tls-id, and setup role of the certificate the Media Function/MRF is going to use for setting up security for this media stream\n-\tif not both the IMS UE and P-CSCF (IMS-ALG) indicated support for e2DCe-security for IMS data channel during registration, the IMS-AS should continue using e2e security, as described in clause 7.3.5 of the present specification.\nNOTE 3: \tThe inclusion of the Media Function/MRF in the media path is required for the purposes of e2DCe security even if it was not required otherwise.\nThe IMS-AS modifies the SDP Offer before sending the SDP Offer back to S-CSCF.\nFor e2DCe protection of an IMS data channel media stream, the IMS-AS keeps the transport as \"UDP/DTLS/SCTP\" in the SDP Offer, conveys the fingerprint, tls-id, and setup attribute information of the MF/MRF in accordance with RFC 8841 [48] as well as an indication that e2DCe security is offered by the network to UE.\nThe IMS-AS then sends the updated SDP Offer to S-CSCF.\n4.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and forwards the SDP Offer for the media stream to the P-CSCF(IMS-ALG).\n5.\tThe P-CSCF (IMS-ALG) forwards the SDP Offer to the IMS UE B.\n\n\n6.\tIMS UE B replies with an SDP Answer for a secured media stream.\nFor e2DCe protection of IMS Data Channel, the IMS UE B includes in the SDP Answer the fingerprint of the UE´s certificate, tls-id, and setup attributes in accordance with RFC 8841 [48].\n7.\tThe P-CSCF sends the SDP Answer to the S-CSCF.\n8.\tThe S-CSCF performs the required procedures according to TS 23.228 [3] and sends the SDP Answer to the IMS AS.\n9.\tThe IMS-AS communicates the cryptographic information contained in the SDP Answer to the Media Function/MRF, performs the required procedures according to TS 23.228 [3] and sends the SDP Answer to the S-CSCF.\nFor e2DCe protection of IMS Data Channel, the cryptographic information communicated to the Media Function/MRF consists of the fingerprint of the IMS UE B's certificate, tls-id, and setup attributes in accordance with RFC 8841 [48]. The S-CSCF instructs the Media Function/MRF to verify during the subsequent DTLS handshake with the IMS UE (see step 9) that the fingerprint of the certificate passed by the IMS UE during this DTLS handshake matches the fingerprint passed by the S-CSCF to the Media Function/MRF.\n10.\tThe S-CSCF forwards the SDP Answer towards the originating network.\n11.\tIn case of IMS Data Channel, when the full session setup has been completed, the DTLS connection shall be established between the IMS UE and the Data Channel Media Function/MRF. When subsequently media are sent from or to the IMS UE, the Data Channel Media Function/MRF performs the required DTLS specific cryptographic operations on the media.\nNOTE 4:\t It is left to stage 3 specifications whether the IMS UE takes the role of DTLS client or DTLS server. These alternatives are equivalent from a security point of view.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.5\tIMS UE terminating procedures for e2e using TLS/DTLS certificate / fingerprint",
                            "text_content": "The IMS UE terminating procedures for e2e using TLS/DTLS certificate fingerprints are expected to be similar to the corresponding originating procedures.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.4\tSession update procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "When session update is performed, and there is a need for updating the media security context (e.g., re-keying), new security context shall be included. If the media security context does not need to be updated (e.g., the session update is due to media on hold), the previously sent security context shall be included in accordance to the offer answer procedures (see also TS 24.229 [18]).This means in particular that when an unchanged security context is received there shall be no re-initialization of the media plane protection.\nMedia security context update is not used with e2ae security.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.5\tHandling of emergency calls",
                    "description": "",
                    "summary": "",
                    "text_content": "E2ae security procedures according to clause 7.2.1 shall be applied to an emergency call set-up if and only if the registration procedure according to clause 7.1 has shown that both, IMS UE and network, support e2ae security. E2e security shall not be applied to emergency calls.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "A.1\tGeneral aspects",
            "description": "This annex specifies the HTTP based key management procedures between the KMS and the UE. It defines the following HTTP based procedures:\n-\tKMS Ticket Request\n-\tKMS Ticket Resolve\nThe KMS Ticket Resolve procedure shall also be used between KMSs when one KMS gets a request to resolve a ticket that can only be resolved by another KMS.\nThe Ua security protocol identifier used for GBA NAF-Key generation shall be as defined in TS 33.220 [6].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.2 \tKey management procedures",
            "description": "The IMS UE shall send the requests to the KMS in the message-body of a HTTP POST request. The Request-URI shall indicate the type of the message. Upon successful request, KMS shall return indication of success.\nThe IMS UE populates the HTTP POST request as follows:\n-\tthe HTTP version shall be 1.1 which is specified in RFC 2616 [8];\n-\tthe Request-URI shall contain an URI parameter \"requesttype\" that shall be set to \"ticketrequest” or \"ticketresolve”, i.e. Request-URI takes the form of \"/keymanagement?requesttype=ticketrequest\";\n-\tthe header field Host shall contain the full KMS URI (e.g. kms.operator.example:1234);\n-\tthe header field Content-Type shall be the MIME type of the payload, i.e. \"application/mikey\". The MIME type is specified in RFC 3830 [11];\n-\tthe message-body shall contain a base64 encoded MIKEY-TICKET message. Either a REQUEST_INIT or a RESOLVE_INIT message corresponding to the requesttype parameter in the Request-URI. The MIKEY-TICKET messages are specified in [14].\n-\tthe IMS UE may add additional URI parameters to the Request-URI;\n-\tthe IMS UE may add additional header fields;\nThe IMS UE sends the HTTP POST to the KMS. The KMS checks that the HTTP POST is valid, and extracts the request for further processing.\nPOST /keymanagement?requesttype=ticketrequest HTTP/1.1\nHost: :1234\nContent-Type: application/mikey\nContent-Length: 127\nUser-Agent: KMSAgent; Release-9 3gpp-gba\nFrom: alice@operator.example\nDate: Fri, 31 Dec 1999 23:59:59 GMT\n\nMgj4hyruihyu8568dfg543...\nAfter processing, the KMS shall return the HTTP 200 OK to the IMS UE.\nThe KMS shall populate HTTP response as follows:\n-\tthe status code shall be 200 OK;\n-\tthe header field Content-Type shall be the MIME type of the payload, i.e. \"application/mikey\". The MIME type is specified in RFC 3830 [11];\n-\tthe message-body shall contain a base64 encoded MIKEY-TICKET message. Either a REQUEST_RESP or a RESOLVE_RESP message corresponding to the MIKEY-TICKET message in the HTTP POST, or a Error message specifying the error that occurred. The MIKEY-TICKET response messages are specified in [14] and the Error message is specified in RFC 3830 [11].\n-\tthe KMS may add additional header fields;\nThe KMS shall send the HTTP response to the IMS UE. The IMS UE shall check that the HTTP response is valid.\nHTTP/1.1 200 OK\nDate: Fri, 31 Dec 1999 23:59:59 GMT\nContent-Type: application/mikey\nContent-Length: 235\n\nMgj4hyruihyu8568dfg543...\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.3 \tError situations",
            "description": "The HTTP procedures may not be successful for multiple reasons. The error cases are indicated by using 4xx and 5xx HTTP Status Codes as defined in RFC 2616 [8]. The 4xx status code indicates that the IMS UE seems to have erred, and the 5xx status code indicates that the KMS is aware that it has erred.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.1\tUE originating procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.1.1\tPreconditions",
                    "description": "",
                    "summary": "",
                    "text_content": "The following preconditions are assumed:\n-\tThe IMS UE is configured with the address to the KMS, which it shall use for ticket requests. \nThe KMS address is in the form of a Fully Qualified Domain Name as defined in IETF RFC 1035 [7]\n-\tThe IMS UE is configured with GBA protocol identifier to use for MIKEY-TICKET [14] message exchange.\n-\tThe IMS UE has performed a GBA bootstrap and holds a valid B-TID and Ks.\n-\tThe IMS UE has derived the NAF-key for the KMS, which it shall use for ticket request\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.1.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "The originating call set-up procedure is described in clause 7.2.3. Interactions with the KMS are described in clause 6.2.3.1.\nThe detailed originating procedures are described in the following steps\n1.\tThe initiator evaluates the local policy held in the IMS UE for calling the intended user. If the local policy determines that a fresh ticket generated by the KMS should be used then the processing continues at step 3. If the local policy determines that the IMS UE shall generate a fresh ticket then the IMS UE generates the ticket and the processing continues at step 10.\nWhen an IMS UE generates a ticket the NAF-Key shall be used as ticket protection key (TPK), see Annex D.4.\n2. \tThe initiator searches its local store of reusable tickets. If a reusable ticket is found having the intended recipient as an allowed recipient, and which also fulfils all other required ticket properties, then this ticket shall be reused. Next processing step is step 10.\n3.\tThe initiator prepares a REQUEST_INIT_PSK message as described in MIKEY-TICKET [14]. The payloads are generated according to the local policy for ticket requests.  The IDRpsk payload is populated with the B-TID and the NAF-key is used as the pre-shared key for protection of the message.\n4. \tThe message is sent to the KMS over HTTP, as defined in Annex A.\n5. \tThe KMS receives the message. The KMS processes the message as defined in MIKEY-TICKET [14].  The KMS retrieves the B-TID and request the NAF-Key and related USS information from the BSF containing a list of all IMPUs associated with the requestor. Based on the NAF-Key, the KMS verifies the authenticity of the message. If the verification fails, the KMS returns an appropriate error message.\n6.\tThe KMS verifies that one of the IMPUs in the received USS matches, after transformation into a KMS UID format, the KMS UID is included in the ticket request as the identity of the initiator. If there is no match the processing is terminated and an appropriate error message is returned.\n7.\tThe KMS checks the requested ticket policy against its policy for the requesting user and requested allowed recipients. The KMS modifies the requested policy as needed or if that is not possible or allowed, it terminates processing and sends and appropriate error message.\n8.\tThe KMS generates the REQUEST_RESP message according to MIKEY-TICKET [14] and sends it as a response over HTTP, see Annex A, to the initiator.\n9. \tThe initiator receives the REQUEST_RESP message and checks the response according to MIKEY-TICKET [14]. The initiator also checks if the policy has been changed and if so, verifies that it still fulfils the requirements for the call. If the ticket is a reusable ticket then it is stored in the local store of reusable tickets together with the corresponding keys retrieved from the REQUEST_RESP message.\n10. The initiator generates the TRANSFER_INIT message according to MIKEY-TICKET [14].  The identities of the initiator and the responder in the message shall be the KMS UIDs derived from the URI's in the To: and From: fields in the INVITE.\nIn the RTP case, the number of Crypto Sessions included in the TRANSFER_INIT message should match the number of RTP streams (both incoming and outgoing) as described in RFC 4567 [12]. The protocol type in the Crypto Session shall be set to SRTP.\nIn the MSRP case, a single Crypto Session is included in the TRANSFER_INIT message as described in Annex X.3. The protocol type in the Crypto Session shall be set to TLS.\n\nThe initiator prepares the media security offer in the SDP part of the INVITE according to local policies and this specification. It inserts the TRANSFER_INIT message according to RFC 4567 [12]\n11. The initiator receives the TRANSFER-RESP message in the SDP part of a 200 OK or an 18x provisional response. It verifies the message according to MIKEY-TICKET [14] and then verifies that the authenticated identity of the recipient corresponds to the policy for the call. Depending on local policy different types of user warnings may be generated if the returned identity differs from what is expected.\n12. The initiator derives the media session keys and initiates the media plane security.  For an RTP session this means sending and receiving SRT(C)P streams and for an MSRP session this means setting up a TLS-PSK tunnel to protect the MSRP messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.2\tUE terminating procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The terminating call set-up procedure is described in clause 7.3.3. Interactions with the KMS are described in clause 6.2.3.1.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.2\tProcedures for the case with one KMS domain",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.2.2.1\tPreconditions",
                            "text_content": "The following preconditions are assumed:\n-\tThe IMS UE is configured with the address to the KMS it shall use for ticket resolve. The KMS address is in the form of a Fully Qualified Domain Name as defined in IETF RFC 1035 [7].\n-\tThe IMS UE is configured with GBA protocol identifier to use for MIKEY-TICKET [14] message exchange.\n-\tThe IMS UE has performed a GBA bootstrap and holds a valid B-TID and Ks.\n-\tThe IMS UE has derived the NAF-key for the KMS it shall use for ticket resolve.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.2.2\tProcedures",
                            "text_content": "The detailed terminating procedures for the case when both initiator and responder have trust relations with a common KMS are described in the following steps\n1.\tThe responder receives the TRANSFER_INIT message and makes an initial verification of the message by verifying that payloads are in accordance with the responders receive policy. In particular, the responder checks that the identity of the issuer of the ticket corresponds to the sender of the TRANSFER_INIT. As the keys used to protect the message are based on the content of the ticket no check of the authenticity of the message can be made. \n\nIf the ticket is marked as reusable, and the Ticket Resolve exchange is not indicated as mandatory, the responder searches his local store of reusable tickets. If a match is found the next processing step is step 10.\n2. \tThe responder prepares a RESOLVE_INIT_PSK message as described in MIKEY-TICKET [14]. The payloads are generated according to the local policy for ticket resolve requests.  The IDRpsk payload is populated with the B-TID and the NAF-key is used as the pre-shared key for protection of the message.\n3.\tThe message is sent to the KMS over HTTP, as defined in Annex A.\n4. The KMS receives the message. The KMS processes the message as defined in MIKEY-TICKET [14].  The KMS retrieves the B-TID and request the NAF-Key and related USS information from the BSF. The USS contains a list of all IMPUs associated with the requestor. Based on the NAF-Key, the KMS verifies the authenticity of the message. If the verification fails, the KMS returns an appropriate error message.\n5.\tThe KMS verifies that one of the IMPUs in the received USS matches, after transformation into a KMS UID format, a legitimate recipient according to the ticket (policy). If there is no match the processing is terminated and an appropriate error message is returned.\n6.\tThe KMS checks the received ticket policy against its policy for the requesting user and initiator and if there is a usage conflict the processing is terminated and an appropriate error message is returned.\n7.\tThe KMS generates the RESOLVE_RESP message according to MIKEY-TICKET [14] and sends it as a response over HTTP, as defined in Annex A, to the responder.\n8. \tThe responder receives the RESOLVE_RESP message and checks it according to MIKEY-TICKET [14]. If the ticket was a reusable ticket then it is stored in the local store of reusable tickets together with the corresponding keys retrieved from the RESOLVE_RESP message.\n9. \tThe responder generates the TRANSFER_RESP message according to MIKEY-TICKET [14].  The responder prepares the media security response in the SDP part of the 200 OK or 18x provisional answer according to local policies and this specification. It inserts the TRANSFER_RESP message according to RFC 4567 [12]\n10. The responder derives the media session keys and initiates the media plane security. For an RTP session this means sending and receiving SRT(C)P streams and for an MSRP session this means setting up a TLS-PSK tunnel to protect the MSRP messages.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "B.2.3\tProcedures for the case with two KMS domains",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.2.3.1\tPreconditions",
                            "text_content": "The following preconditions are assumed:\n-\tThe IMS UE is configured with the address to the KMS, KMS_R, it shall use for ticket resolve. The KMS address is in the form of a Fully Qualified Domain Name as defined in IETF RFC 1035 [7].\n-\tThe IMS UE is configured with GBA protocol identifier to use for MIKEY-TICKET [14] message exchange.\n-\tThe IMS UE has performed a GBA bootstrap and holds a valid B-TID and Ks.\n-\tThe IMS UE has derived the NAF-key for the KMS it shall use for ticket resolve.\n-\tThe ticket is issued by another KMS, KMS_I, with which KMS_R has a trust relation. Message origin authentication, and integrity and confidentiality protection between KMS_R and KMS_I  is based on NDS/IP [5], see 4.2.4. Confidentiality protection is mandated (over Za) because keys are transported in the clear over Zk.  Confidentiality protection may be achieved by cryptographic or other means\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "B.2.3.2\tProcedures",
                            "text_content": "The detailed terminating procedures for the case when the initiator has a trust relation with different KMSs are described in the following steps\n1-5. \tThe steps 1 to 5 are identical to steps 1–5 in clause B.2.2.2.2 with KMS replaced by KMS_R\n6. \tKMS_R prepares a new RESOLVE_INIT_PSK message as described in MIKEY-TICKET [14]. If the IDRr payload in the received RESOLV_INIT_PSK message matched a legitimate recipient (step 5) it is reused in the new RESPOLVE_INIT_PSK, otherwise KMS_R inserts a matching KMS UID as IDRr. The TICKET payload is reused.  The message is not integrity protected.\n7\tThe message is sent to KMS_I over HTTP, as defined in ANNEX A.\nNOTE: \tThe address of KMS which can resolve the ticket  is included in the Ticket.Policy Payload, subpayload IDRkms, cf. MIKEY-TICKET [14].\n8.\tKMS_I verifies the message and that it comes from a trusted source (based on the NDS/IP protection).\n9.\tKMS_I checks the received ticket policy against its policy for the requesting user and initiator and if there is a usage conflict the processing is terminated and an appropriate error message is returned.\n10.\tKMS_I generates a RESOLVE_RESP message and sends it as a response over HTTP to KMS_R. The  RESOLVE_RESP message itself  is not protected, i.e. there is no integrity protection and the KEMAC is not enciphered.\n11. \tKMS_R receives the RESOLVE_RESP message and checks its integrity and source (based on the NDS/IP protection).\n12. \tKMS_R prepares a new protected RESOLVE_RESP reusing the payloads from KMS_I. The KEMAC is  enciphered and the message is integrity protected. KMS_R sends the message to the responder over HTTP according to Annex A\n13-14. The steps 13 and 14 are identical to steps 9 and 10 in clause B.2.2.2.2.\nAn IMS UE and IMS core network entity capable of supporting IMS media plane security (SDES and/or KMS based)\n-\tShall support all mandatory features defined in RFC 3711 [9] except that it does not have to support key derivation rates different from zero (KDR <> 0).\n-\tMay support RFC 4771, \"Integrity Transform Carrying Roll-Over Counter for the Secure Real-time Transport Protocol (SRTP)\" [15] for SDES based media plane security. RFC 4771 shall be supported and used for KMS based media plane security RFC 4771 defines functionality that is essential to simplify late entry in group communications and broadcasting sessions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "D.1\tScope",
            "description": "The profiling given in this Annex is with respect to MIKEY-TICKET [14]. The profiling is for the default implementation of KMS based IMS media plane security using GBA for user authentication and establishment of a shared key between KMS and IMS UE.\nThe profiling is based on what is needed to support SRTP as defined in RFC 3711 [9] and enhancements in terms of new SRTP transforms using 256 bit keys.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tGeneral",
            "description": "A KMS based IMS media plane security default implementation:\n-\tShall support MIKEY-TICKET Mode 1 and Mode 3 (cf. clause 4.1.1 in [14]).\n-\tDoes not have to support REQUEST_INIT_PK and RESOLVE_INIT_PK, i.e. it does not have to support public key based exchanges.\n-\tShall use the recommended payload order for all messages in the exchanges.\n-\tShall not add any extra payloads.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2A\tKeys,  and algorithms",
            "description": "A KMS based IMS media plane security default implementation:\n-\tShall support use of keys of length 128 and 256 bit.\n-\tShall support use of  of length 128 and 256 bit.\n-\tShall support the PRF-HMAC-SHA-256 in all HDR and TP payloads.\n-\tMay support PRFs MIKEY-1 in all HDR and TP payloads.\n-\tShall for KEMAC protection support AES-CM-128 and AES-CM-256 encryption algorithms and the NULL authentication algorithm.\n-\tShall support HMAC-SHA-256-256 as authentication algorithm in V payloads.\n-\tMay support HMAC-SHA-1-160 as authentication algorithm in V payloads.\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.3\tExchanges",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "D.3.1\tTicket Request",
                    "description": "",
                    "summary": "",
                    "text_content": "A KMS based IMS media plane security default implementation:\n-\tShall support timestamp of type NTP-UTC-32 and COUNTER.\n-\tShall populate payloads in REQUEST_INIT_PSK as defined here:\n-\tIDRi: shall contain the Initiator’s KMS user identity.\n-\tIDRkms: optional, URI for target KMS.\n-\tTP: shall specify (IDRr), i.e. the intended recipients of the requested ticket. IDRapp shall be set to\"IMS-MEDIASEC\". In order to be able to handle call diversion (CDIV) scenarios, it is recommended to use the wildcarded identity ?@?.\n-\tIDRpsk: B-TID.\n-\tShall populate payloads in REQUEST_RESP_PSK as defined here:\n-\tIDRkms: optional, URI for responding KMS.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "D.3.2\tTicket Transfer",
                    "description": "",
                    "summary": "",
                    "text_content": "A KMS based IMS media plane security default implementation:\n-\tShall support timestamp of type NTP-UTC-32.\n-\tShall use CSB ID map type of type GENERIC-ID.\n-\tShall populate payloads in TRANSFER_INIT as defined here:\n-\tIDRi: shall be present. Contains initiator's KMS UID.\n-\tIDRr: shall be present. Contains KMS UID or KMS group identity.\n-\tShall populate payloads in TRANSFER_RESP as defined here:\n-\tRANDRr: shall be present.\n-\tRANDRkms: shall be present (used in key forking).\n-\tIDRr: shall be present (used in key forking).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "D.3.3\tTicket Resolve",
                    "description": "",
                    "summary": "",
                    "text_content": "A KMS based IMS media plane security default implementation:\n-\tShall support timestamp of type NTP-UTC-32 and COUNTER.\n-\tShall populate payloads in RESOLVE_INIT_PSK as defined here:\n-\tIDRr:  shall contain the Responder’s KMS UID.\n-\tIDRkms: optional, URI.\n-\tIDRpsk: shall contain B-TID.\n-\tShall populate payloads in RESOLVE_RESP_PSK as defined here:\n-\tIDRkms: optional, URI.\n-\tRANDRkms: shall be present (used in key forking).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "D.4\tProfiling of tickets",
            "description": "The default ticket for KMS based IMS media plane security\n-\tShall support use of keys of length 128 and 256 bit.\n-\tShall support use of  of length 128 and 256 bit.\n-\tShall for KEMAC protection support AES-CM-128 and AES-CM-256 as encryption algorithm and the NULL Authentication algorithm.\n-\tShall support HMAC-SHA-256-256 as authentication algorithm in V payloads.\n-\tMay support HMAC-SHA-1-160 as authentication algorithm in V payloads.\n-\tShall support timestamps of type NTP-UTC-32.\nThe TP payload (section 6.10 in [14]) in the default ticket for KMS based IMS media plane security shall be populated as defined here:\n-\tHas ticket type value 2 (defined in MIKEY-TICKET).\n-\tHas subtype value 0 (zero) and version value 0 (zero).\n-\tE flag shall have value 1 due to forking.\n-\tF flag shall have value 1 due to forking.\n-\tG flag shall have value 1.\n-\tH flag shall have value 1.\n-\tI flag shall have value 1 prescribing forking.\n-\tL flag shall have value 0.\n-\tM flag shall have value 0.\n-\tN flag shall have value 1 prescribing that no extensions are used.\n-\tO flag shall have value 1 prescribing that no extensions are used.\n-\tAll sub-payloads specified shall be present.\nThe ticket data of the Ticket payload (Appendix A in [14]) in the default ticket for KMS based IMS media plane security shall be populated as defined here:\n-\tTHDR: the first 48bits of the THDR Data shall contain a globally unique identifier of the issuing KMS.\n-\tIDRpsk: shall contain B-TID if the ticket is generated by the initiator. If the KMS generates the ticket it is implementation specific.\nThe present Annex contains a complete list of parameters that may be contained in an SDES crypto attribute, according to RFC 4568.\nThe following short-hand notation is used:\n-\t“mandatory / optional to support / use” means: “This parameter shall / may be supported / used in implementations conforming to 3GPP specifications.”\nThe default use is that the sender omits the parameters that are optional to use.\nCRYPTOGRAPHIC ALGORITHMS\ncryptosuite: mandatory to support and use\nIn addition to mandating the support and use of the parameter “cryptosuite” in an SDES crypto attribute, the  cryptosuite “AES_CM_128_HMAC_SHA1_80”, as defined in RFC 4568, is mandatory to support.\n\n\"KEY PARAMETERS\" (ONE OR MORE TIMES):\nkey: mandatory to support and use\nsalt: mandatory to support and use\nkey lifetime: optional to support and use for e2e security, shall not be used for e2ae security (cf. clauses 7.2.1 and 7.3.1 of this specification).\nMaster Key Index (MKI): optional to support, mandatory to use if more than one set of key parameters is contained in the crypto attribute, otherwise optional to use. If only one master key is used, an MKI is not recommended to be used.\nNOTE: It is not guaranteed that implementations support more than one master key per crypto attribute. If only one master key is used, an MKI has no function as it adds to the SRT(C)P packet overhead.\nLength of MKI field: optional to support, mandatory to support if MKI is supported, mandatory to use if MKI is used.\n\n\"SESSION PARAMETERS\"\nkey derivation rate: optional to support and use\nUNENCRYPTED_SRTP: mandatory to support and optional to use\nUNENCRYPTED_SRTCP: mandatory to support and optional to use\nUNAUTHENTICATED_SRTP: mandatory to support and optional to use\n\nNOTE:\tThe flags “UNENCRYPTED_SRTP” and “UNENCRYPTED_SRTCP” may be useful when regulations do not permit encryption, but authentication is still desired. The flag “UNAUTHENTICATED_SRTP” may be useful to reduce the packet size for e.g. voice traffic where integrity protection may not be needed, cf. the situation on 3GPP radio interfaces over which user data are not integrity-protected.\nforward error correction order: not applicable\nkey parameters for the FEC stream: optional to support and use\nwindow size hint: optional to support and use\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.1\tVoid",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2\tSecurity for immediate messaging based on SIP signalling security",
            "description": "Security for immediate messaging based on IMS signalling security shall be provided by the SIP signalling protection mechanisms specified in TS 33.203 [4].\nNOTE1: The usage of the \"P-Asserted-Identity\" header provides secure identification of the sender of a message by the receiver, unless the sender has chosen to hide its identity, in which case the receiver will not learn the sender’s identity.\nNOTE2: SIP messages between the UE and the P-CSCF (IMS-ALG) can be confidentiality-protected either by the confidentiality mechanisms of IPsec or TLS as defined in TS 33.203 [4], or by confidentiality provided by the underlying access network, according to clause 6.2.1.2 of the present specification. The IMS UE is aware of the established protection mechanism, but the P-CSCF takes the final decision.\nNOTE3: The IMS UE can be aware of the protection mechanism for immediate messaging on the first hop only, and there is no way for the IMS UE to ensure the use of protection mechanisms on further hops. Moreover, nodes in the IMS core (in particular the P- and S-CSCF) will have access to the cleartext message content.\nNOTE4: Application servers may be used for storing instant messages for a user that is currently not registered or for distributing instant messages to multiple recipients. In this solution, such application servers have access to the message content and need to be trusted.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.3\tSecurity for immediate messaging based on MIKEY-TICKET",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.3.1\tUE sends a SIP MESSAGE",
                    "description": "",
                    "summary": "",
                    "text_content": "A UE prepares a protected SIP message as described in TS 24.247 [28], with the difference that S/MIME is applied for content protection. Here S/MIME refers to the pre-shared-key variant of S/MIME defined in Annex I of this TS, and not the RFC 8551 [43] definition of S/MIME. This variant of S/MIME encrypts and authenticates the MIME content using a symmetric key that is transported inside a TRANSFER_INIT message. An example of a protected MESSAGE is shown below.\nMESSAGE sip:user2@domain.com SIP/2.0\nVia: SIP/2.0/TCP user1pc.domain.com;branch=z9hG4bK776sgdkse\nMax-Forwards: 70\nFrom: \nTo: \nCall-ID: \nCSeq: 1 MESSAGE\nContent-Type: multipart/mixed;boundary=\"boundary1\" \nContent-Length: <length>\n--boundary1\nContent-Type: application/mikey\nContent-Transfer-Encoding: base64\n\n<Base64 encoded TRANSFER_INIT message>\n--boundary1\nContent-Type: application/pkcs7-mime;\n    smime-type=auth-enveloped-data;\n    name=smime.p7m\nContent-Transfer-Encoding: base64\nContent-Disposition: attachment; filename=smime.p7m\n\n***********************************************************\n* Content-Type: text/plain                                *\n*                                                         *\n* All your base are belong to us.                         *\n***********************************************************\n\nThe UE needs to ensure that the TICKET inside the TRANSFER_INIT is resolvable by all the intended recipients. Typically, the intended recipient is the URI indicated in the To header field of the request. This is true when:\n-\tThe message is sent to another user using an IMPU in the To header field. The UEs registered under that IMPU are the intended recipients of the content.\n-\tThe message is sent to a list server using a PSI (Public Service Identity) in the To header field. The PSI is the intended recipient even though it is not the final recipient. This is because the list server hosting the PSI needs to be able to re-encrypt the content before forwarding it (it is assumed that neither the sending UE nor the KMS knows the members of the list). From the KMS perspective the PSI is seen as one of the list server’s identities.\nThe only case when the URI in the To header field is not the intended recipient of the content is when:\n-\tThe message is sent to a list server and a URI list is included in the message body. The URIs in the URI list are the intended recipients of the content but not necessarily the list server. Since the sending UE knows the identities of the final recipients the list server does not have to re-encrypt the content before forwarding it. If the list server is not included as an intended recipient, the URI list needs to be sent un-protected or protected separately using an additional S/MIME entity.\nFor efficiency reasons the sender may want to re-use a TICKET in several SIP MESSAGEs sent to the same or different users. This is possible as long as all recipients were listed as authorized resolvers in the ticket request. It is important to be aware though that specifying a very wide group of resolvers may impact security.\nProof-of-origin (or non-repudiation) can be provided by the sender by adding the extension payload described in Annex D to the TRANSFER_INIT message. The extension payload contains a copy of the MAC calculated over the MIME entity and since the origin of the TRANSFER_INIT message is guaranteed, the origin of the MIME entity is guaranteed as well. The downside of providing proof-of-origin is that that the receiver has to do a ticket resolve against the KMS for every message that it receives.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.2\tUE receives a SIP MESSAGE",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon receipt of a protected SIP MESSAGE, the UE extracts the key in the TRANSFER_INIT and hands both the key and the protected content over to S/MIME. S/MIME in turn uses the key to verify the integrity and decrypt the content. The UE also checks if the sender identity reported back by S/MIME matches the identity contained in the From header field. In case the identities differ, the S/MIME identity takes precedence and needs to be displayed to the user. As described above, this may happen when a list server re-encrypts the content but leaves the From header field intact. The same thing happens when a list server adds its own protected content to a forwarded message (for example the identities of the other recipients). Otherwise, the handling is as described in TS 24.247 [28].\nDeferred delivery with MIKEY-TICKET can be accommodated by using a replay cache for TRANSFER_INIT messages which does not enforce any message age restriction (this is not required either by MIKEY [11]), The replay cache would accept a new entry as long as the cache is not full or if the entry is more recent than the oldest entry (determined from the message timestamp). If the cache is full and the oldest entry is older, the oldest entry is deleted and the new entry is inserted. Furthermore, the size of the cache needs to be adjusted according to the expected message intensity and the offline time (i.e. the period during which the UE is unreachable). The AS can also reduce the likelihood that a valid message gets rejected by delivering all the deferred messages in order, starting with the oldest one. However, even with the increased cache size, in case of high volume of messages or extended offline time the UE may run out of memory and has to start dropping messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.3\tList server forwards a SIP MESSAGE to multiple recipients using a PSI",
                    "description": "",
                    "summary": "",
                    "text_content": "A protected SIP MESSAGE that includes a PSI in the request URI is forwarded by the list server to all the entries in the associated URI list as specified in TS 24.247 [28]. The only difference is that the protected content in the incoming message needs to be re-encrypted before it is copied to the outgoing message. When the list server decrypts the content it needs to verify that the sender identity reported by S/MIME matches the identity in the To header field of the incoming message. Provided the verification is successful, the list server re-encrypts the content and sets the MIKEY-TICKET in the TRANSFER_INIT to be resolvable by all the entries in the predefined URI list. The re-encrypted content is then copied to all of the outgoing messages.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.4\tList server forwards a SIP MESSAGE to multiple recipients using a URI-list",
                    "description": "",
                    "summary": "",
                    "text_content": "A protected SIP MESSAGE with a URI-list included in the multipart body is forwarded by the list server to all the entries in the list as specified TS 24.247 [28]. There is no need to re-encrypt the protected content since the TICKET inside the TRANSFER_INIT is resolvable by the final recipients. Note that the list server forwards both the S/MIME content and the TRANSFER_INIT message.\nIf the list server includes a URI-list in the outgoing SIP message, as described in RFC 5365 [29], it should be protected using S/MIME. It is recommended to encrypt the URI-list once and copy it to all the outgoing messages by using a TICKET that is resolvable by all the recipients.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "G.1\tGeneral aspects",
            "description": "A conference server may send and receive cryptographically protected media streams to and from participants as specified in clauses G.2 and G.3. In doing so, the conference server shall use individual keys per participant (and per media stream).\nNOTE: This means the conference server does not use group keys. This way, a participant is only able to decrypt media sent to him during his presence in the conference (but not media sent out by the media server to other participants, e.g. before the participant joined or after he left the conference).\nOnce the conference URI has been created, the participants (including the conference creator himself) join the conference using one of the methods specified in TS 24.147 [25]:\n-\tThe participant sends a SIP INVITE directly to the conference URI (how the participant learns of the SIP URI is out of scope)\n-\tThe conference creator or conference focus sends a SIP REFER to participant which triggers the participant to send a SIP INVITE to the conference URI\n-\tThe conference creator instructs the conference focus (either via SIP REFER or via the external interface) to send a SIP INVITE to the participant\nRegardless of the method chosen the end result is always that a SIP INVITE is sent from the participant to the conference URI or vice versa. From a media security perspective, this situation is no different from a point-to-point call between two UEs.\nThe conference creator or a conference participant may subscribe to the conference event package as described in RFC 4575 [26] using the stored conference URI. Whenever there is a change to the conference state the subscription service will notify the subscribers by sending a NOTIFY request.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.2\tSecurity for conferencing based on SIP signalling security",
            "description": "Two cases are considered in this subclause: e2ae security between UE and IMS Access GW and e2e security between UE and conference server.\ne2ae security:\nWhen participating in conferences, IMS UEs may use e2ae security for RTP based traffic and/or for MSRP, as specified in the main body of the present document, and/or for BFCP, as specified in the following.\nFor BFCP that may be used in conferences, e2ae security shall be supported in the same way as for MSRP, as specified in the main body of the present document. The only differences are:\n1) e2ae security for BFCP uses individual indications \"e2ae-security for BFCP supported by the UE\" and \"e2ae-security for BFCP supported by the network\" during registration (the syntax is to be defined in the corresponding stage 3 specification); compare clause 7.1.2 .\n2) In the SDP, security for a BFCP media stream is specified by using the transport “TCP/TLS/BFCP”,\nNOTE 1: Application of e2ae security for RTP, MSRP and/or BFCP is not visible to the conference server, which has therefore no assurance on how the communication is secured over the access networks. The conference server itself is assumed to be an MRF that is part of the IMS core network. Protection of the interfaces of the conference server to other entities of the IMS core can therefore rely on the security provided inside the IMS core (e.g. by means of IPsec).\ne2e security:\nThe conference server may support e2e security using SDES for RTP based media between IMS UE and conference server as specified in clauses 7.2.2 and 7.3.2 of the present document. Usage of this type of security by the conference server, i.e. accepting it when offered in incoming SDP offers (dial-in case) and offering it in outgoing SDP offers (dial-out case) is subject to the policies of the conference server.\nNOTE 2: e2e security between IMS UE and conference server does not imply e2e security between two IMS UEs.\nIt is outside the scope of the solution in the present clause whether the conference server supports TLS for MSRP according to RFC 4975 [21] and/or for BFCP according to RFC 8855 [44].\nNOTE 3: The conference server can request TLS for MSRP and/or for BFCP in SDP offers it sends in outgoing SDP offers (dial-out case) and accept and perform TLS when it is specified in incoming SDP offers (dial-in case). This depends on the policies of the conference server. If the conference server is configured not to use TLS, then MSRP and/or BFCP can still be protected by TLS over the access network between an IMS Access GW and a participant according to clause 7 and/ or the present clause of the present document, if the participant and the network have negotiated using this protection over the access network.\nNOTE 4: When the conference server uses SRTP/SDES for RTP based media, it has no assurance where this protection is terminated and how the communication is secured on the subsequent hops.\nBy means of the “P-Asserted-Identity” header, the conference server has assurance about the identity of the participants. A conference server may reject users trying to dial-in anonymously. In the dial-out case, by means of re-targeting an INVITE by the conference server may be answered by a user different from the invited user. The conference server may cancel the invitation of a participant if this participant’s identity is not revealed, or if the participant is not allowed to join the conference according to the conference policies.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.3\tSecurity for conferencing based on MIKEY-TICKET",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "G.3.1\tConference creation and policy control",
                    "description": "",
                    "summary": "",
                    "text_content": "The KMS based conferencing solution relies on an external interface between the conference creator and the AS/MRFC for creating and managing conferences. The interface should enable the conference creator to create new conference URIs, set and update the list of authorized conference participants, and change other conference settings. It may also be possible to allow other conference participants to change the conference policy. The interface is not considered part of IMS and will not be standardized. It would typically be implemented as a web page or as a specific application on the UE.\nThe figure depicts a conference creation and policy control system, illustrating the external interface used for communication. The system includes a central server, a user interface, and a set of APIs for communication. The figure shows the user interface, which allows users to create conferences, specify the desired policies, and control the system's operations. The APIs provide the necessary communication channels for the system to function.\nFigure Y1: Conference creation and policy control via external interface\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.3.2\tUser joining a secure conference",
                    "description": "",
                    "summary": "",
                    "text_content": "RTP and MSRP traffic shall be protected using MIKEY-TICKET in the same way as specified in Clause 7.2.3 and 7.3.3. The only difference being that one of the UEs is replaced by the conference focus. BFCP traffic shall be protected in the same way as MSRP traffic, i.e. using a TLS tunnel established with MIKEY-TICKET. In the SDP, security for BFCP is specified by using the transport “TCP/TLS/BFCP”.\nThe conference focus shall verify that the UE identity (KMS UID) specified in the MIKEY-TICKET exchange is authorized to join the conference.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "G.3.3\tSubscribing to conference event package",
                    "description": "",
                    "summary": "",
                    "text_content": "Upon receipt of a SUBSCRIBE request, the conference notification service shall verify that the sender is an authorized conference participant and, provided the verification is successful, establish the subscription to the conference state information. The state information carried in NOTIFY requests shall be confidentiality and integrity protected using the pre-shared key variant of S/MIME as described in Annex I.\nNOTE: \tS/MIME offers only limited protection to the conference state information. An attacker will still be able to delay, re-order or delete state information carried in the NOTIFYrequests. This could for example lead to a situation where conference participants incorrectly believe that a certain user has not yet joined the conference.\n\nAlthough MIKEY-TICKET [14] only specifies how to establish key data and algorithm settings for the SRTP protocol, it can easily be extended to carry the security parameters needed for setting up almost any kind of security protocol. This Annex describes how MIKEY-TICKET is used to establish a PSK to be used in a TLS-PSK handshake.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "H.1\tThe TLS Prot Type",
            "description": "A Crypto Session (CS) in MIKEY-TICKET defines a security association for a specific security protocol, and contains all the required security parameters, such as key data and algorithm settings. Each CS is represented by an entry in the CS ID map info field of the HDR payload. Such an entry has the following format (assuming the GENERIC-ID map type is used):\n0                   1                   2                   3\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n!     CS ID     !   Prot type   !S!     #P      ! Ps (OPTIONAL) ~\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n!      Session Data Length      !    Session Data (OPTIONAL)    ~\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n!  SPI Length   !                SPI (OPTIONAL)                 ~\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\nCS ID (8 bits): defines the CS ID to be used for the crypto session\nProt Type (8 bits): defines the security protocol to be used for the crypto session. Shall be set to TLS.\nS (1 bit): flag that MAY be used by the Session Data. This flag is not used for the Prot Type TLS. The value needs to be set to '0', but shall be ignored by the receiver.\n#P (7 bits): indicates the number of security policies provided for the crypto session. For the Prot Type TLS, this value shall be set to 0. No security policy is required since negotiation of parameters is included in the TLS handshake.\nPs (variable length): lists the policies for the crypto session. Since #P=0 for the Prot Type TLS, this field is omitted.\nSession Data Length (16 bits): the length of Session Data (in bytes). For the Prot Type TLS, the length shall be set to 0 as no additional session data is required.\nSession Data (variable length): contains session data for the crypto session. Since length is 0 for the Prot Type TLS, this field is omitted.\nSPI Length (8 bits): the length of SPI (in bytes). For the Prot Type TLS, the length can be set arbtrarily.\nSPI (variable length): the SPI corresponding to the session key to be used for the crypto session. The SPI identifies a specific TGK/GTGK that is used to derive the TEK for the crypto session (the SPI could also identify a TEK directly).\nEditor’s note:  Setting #P=0 in both the init and response message is not allowed according to RFC 6043. There are two possible ways to get around this problem. Either we ignore the restriction in RFC 6043 (which really doesn't matter) or we specify a dummy Security Policy for TLS which does not contain any values.\nEditor’s note:  The Prot Type TLS must be registered with IANA and the value is therefore TBD.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.2\tEstablishing a TLS connection",
            "description": "A CS with Prot Type TLS contains the necessary parameters to perform a TLS-PSK handshake and establish a TLS connection over a reliable transport association (such as a TCP connection).  It is assumed that the transport association can be used to identify the CS (e.g. a TCP connection maps to a certain m line in the SDP which in turn maps to a CS). The parameters that need to be input to the TLS implementation are the following:\nTLS client/server role: the role of each peer is negotiated by means outside of MIKEY-TICKET (e.g. as part of the establishment of the transport association in SDP). Typically, the client (server) in the transport protocol assumes the role of client (server) in the TLS protocol.\nThe TLS ciphersuites shall be of type TLS_PSK and TLS shall be profiled as specified in TS 33.310 Annex E [AA] with the exception that ciphersuites using Diffie-Hellman shall not be used.\nPSK identity: this value is not used. The PSK identity is set to the empty string by the client and is ignored by the server.\nPSK identity hint: this value is not used. The identity hint is an optional value provided by the server in the server hello message.\nPSK: The PSK is the TEK associated with the CS. The SPI in the CS points to a TGK or GTGK from which the TEK is derived using the CS ID (and some other parameters). The SPI could also point to a TEK directly.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.3\tUsage with SDP",
            "description": "The TLS CS defined above can be used to establish a TLS connection using the PSK-TLS ciphersuite. The only piece missing is to show how an m-line using a protocol of the form X/TLS/Y (e.g., TCP/TLS/MSRP or TCP/TLS/BFCP) is mapped to such a CS.\nRFC 4567 [12] describes how the key-mgmt attribute is used to perform a MIKEY-TICKET exchange in SDP and how an m-line can be mapped to set of SRTP CSs (one for each SSRC). If the key-mgmt attribute is used at session level then the MIKEY-TICKET exchange contains CSs for all the m-lines in the SDP and the mapping is based on the order of the m-lines. If the key-mgmt attribute is used at the media level then the CSB only contains the CSs for that m-line. Mixing of session and media level attributes is allowed by RFC 4567 [12] but the expected behaviour is not well defined. Another restriction is that the offerer needs to know how many SSRCs that the answerer will use for a particular m-line.\nThe mapping between an X/TLS/Y m-line and a TLS CS is done in the same way as the mapping between and SRTP m-line and a set of SRTP CSs. The only difference is that there is exactly one CS per m-line.\nSecure/Multipurpose Internet Mail Extensions (S/MIME), defined in IETF RFC 5751 [30], is a standard for encryption and signing of MIME encoded data. S/MIME uses Cryptographic Message Syntax (CMS), defined in IETF RFC 5652 [31], to cryptographically protect MIME entities. Unfortunately, S/MIME was designed for public key cryptography and does not specify how a MIME entity can be encrypted and authenticated using a pre-shared key. However, extending S/MIME to support symmetric crypto is not a major issue since CMS already defines the necessary message constructs and algorithms.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1\tThe smime-type parameter",
            "description": "S/MIME defines the application/pkcs7-mime media type that is used to carry different types of CMS content types. Information about the applied security and the CMS content type (EnvelopedData, SignedData, CompressedData) can be indicated via the optional \"smime-type\" parameter. To add support for pre-shared key MIME protection an additional smime-type parameter is defined:\nTable I.1: smime-type (addition)\n\nEditor’s note: Whether we can continue using the MIME type application/pkcs7-mime when the new smime-type parameter is introduced is FFS. It might be necessary to register a new MIME type application/X with IANA (in the vendor tree where vendor is 3GPP). The new MIME type would have the same semantics as application/pkcs7-mime but would also include the smime-type auth-enveloped-data.\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table I.1: smime-type (addition)",
                    "table number": 2,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.2\tThe Auth-Enveloped S/MIME type",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "AuthEnvelopedData is a CMS type defined in IETF RFC 5083 [32] and is intended to be used with authenticated encryption modes, such as AES-CCM and AES-GCM. These algorithms allow arbitrary data to be both authenticated and encrypted using a single key. IMS clients compliant with this this specification shall support the authenticated encryption algorithms in Table I.2.\nTable I.2: Authenticated encryption algorithms\nThe content-authenticated-encryption key is generated at random and is sent alongside the protected data in the RecipientInfo field of AuthEnvelopedData. The format of this field varies depending on the key management technique. IMS clients implementing this specificiation shall support the KEKRecipientInfo type where the content-authenticated-encryption key is encrypted using a previously distributed symmetric key. Table I.3 shows the key encryption algorithms that the IMS client shall support (see RFC 3565 [33]).\nTable I.3: Key encryption algorithms\nThe data to protect (a MIME entity) shall be prepared as in standard S/MIME before it is passed on to CMS for encryption and authentication. The encrypted data shall be included in the EncryptedContent field and the ContentType shall be set to id-data (i.e., the plaintext is treated as arbitrary octet data by CMS).\n",
                    "tables": [
                        {
                            "description": "Table I.2: Authenticated encryption algorithms",
                            "table number": 3,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table I.3: Key encryption algorithms",
                            "table number": 4,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.2.2\tCreating an Auth-Enveloped message",
                    "description": "",
                    "summary": "",
                    "text_content": "This Clause describes how a MIME entity is protected using the auth-envoloped S/MIME type. With the exception of the second step, the process is identical to the creation of an Enveloped-Only message in S/MIME [43].\na)\tThe MIME entity to be protected is prepared according to Section 3.1 in S/MIME [43].\nb)\tThe MIME entity and other required data is processed into a CMS object of type AuthEnvelopedData.  The key for the desired content-authenticated-encryption algorithm is generated at random and is sent encrypted in a KEKRecipientInfo. The previously distributed key encryption key is identified via a KEK identifier.\nc)\tThe AuthEnvelopedData object is wrapped in a CMS ContentInfo object.\nd)\tThe ContentInfo object is inserted into an application/pkcs7-mime MIME entity.\nThe smime-type parameter for auth-enveloped messages is \"auth-enveloped-data\".  The file extension for this type of message is \".p7m\". An example message is shown below.\nContent-Type: application/pkcs7-mime;\n    smime-type=auth-enveloped-data;\n    name=smime.p7m\nContent-Transfer-Encoding: base64\nContent-Disposition: attachment; filename=smime.p7m\n***********************************************************\n* Content-Type: text/plain                                *\n*                                                         *\n* All your base are belong to us.                         *\n***********************************************************\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "I.3\tTransferring KEK using MIKEY-TICKET",
            "description": "MIKEY-TICKET shall be used to transfer the S/MIME key encryption key (KEK) to the remote recipient. The KEK shall be included in a TRANSFER_INIT message which in turn shall be added to the SIP message using the application/mikey media type.\nThe KEK (which corresponds to a TEK in MIKEY-TICKET) is identified by its SPI and shall be derived from the TGK carried inside the TICKET payload of the TRANSFER_INIT message.\nIn order to ensure that the receiver has access to the KEK when the S/MIME message is processed, it is recommended to send the TRANSFER_INIT message and S/MIME message in the same SIP message. As shown in the example below, this can be appomplished by using the multipart/mixed media type and including the TRANSFER_INIT message at the top.\nContent-Type: multipart/mixed;boundary=\"boundary1\" \nContent-Length: <length>\n\n--boundary1\nContent-Type: application/mikey\nContent-Transfer-Encoding: base64\n\n<Base64 encoded TRANSFER_INIT message>\n--boundary1--\nContent-Type: application/pkcs7-mime;\n    smime-type=auth-enveloped-data;\n    name=smime.p7m\nContent-Transfer-Encoding: base64\nContent-Disposition: attachment; filename=smime.p7m\n***********************************************************\n* Content-Type: text/plain                                *\n*                                                         *\n* All your base are belong to us.                         *\n***********************************************************\nBy default a KEK shall only be used once. This together with the fact that TRANSFER_INIT messages are replayed protected imply that the S/MIME message is replayed protected as well. Other types of security policies are outside the scope of this document.\nOptionally, proof-of-origin (or non-repudiation) can be achieved by adding the extension payload defined in Annex X to the TRANSFER_INIT message and including a copy of the MAC value calculated over the MIME entity. Since the origin of the TRANSFER_INIT message can be guaranteed (Initiator Data in the TICKET payload is authenticated with a key known only to the sender and the KMS), the origin of the MIME entity can be guaranteed as well. The downside of providing non-repudiation is that the receiver has to do a ticket resolve against the KMS for every message that it receives (there is no point of caching the results of a ticket resolve since the TICKET payload always changes).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.4\tMIKEY-TICKET profile for pre-shared key MIME protection",
            "description": "The MIKEY-TICKET profile for pre-shared key MIME protection is the same as the profile for IMS Media Plane security (see Annex D) except for a few minor differences. These differences are explained below.\nThe Ticket Request exchange is unchanged except that IDRapp in the Ticket Policy (TP) payload shall be set to the string \"PSK/MIME\".\nThe Ticket Transfer exchange is half-roundtrip and consists only of the TRANSFER_INIT message. This message is constructed as in IMS Media Plane security, except for the following changes:\n-\tThe HDR payload shall contain a single Crypto Session (CS) of type PSK/MIME. A CS of this type has no associated Security Policy (#P=0) and no Session Data. The CS SPI field shall be set to the SPI of the TGK carried in the TICKET (see below). Furthermore, as no answer is expected, the V flag in the HDR payload shall be set to 0.\nThe extension payload defined in Annex X needs to be included if proof-of-origin is required for the MIME entity. The value of the extension payload is the MAC calculated in the authenticated encryption algorithm. Note that proof-of-origin requires that Initiator Data is included in the TICKET payload which in turn requires that forking is enabled (I flag in the Ticket Policy is set to 1).\nThe Ticket Resolve exchange is unchanged\nTickets are generated in the same way as in the IMS Media Plane security profile except for the changes indicated below.\n-\tThe F flag shall be set to 0 indicating that TRANSFER_RESP should not be sent\n-\tThe G shall be set to 0 indicating that the Responder should not generate RANDRr\n-\tThe I shall be set to 0 (no-forking) unless proof-of-origin is required for the MIME entity\n-\tThe KEMAC payload in the TICKET shall contain a single TGK with the SPI field set to the value of S/MIME key encryption key identifier.  No salt or key validity period shall be included.\nEditor’s note: No Security Policy is required for a CS of type PSK/MIME since all the algorithms, key lengths, etc are specified by S/MIME. However, it is currently unclear if it is allowed to omit the Security Policy payload (#P=0) from a TRANSFER_INIT message.\nEditor’s note: Proof-of-origin requires that Initiator Data is included in the TICKET payload which in turn requires that forking is enabled. However, forking was originally intended to be used in the cases where the responder is able to send a TRANSFER_RESPONSE, and the MIKEY-TICKET was written with this in mind. It might be therefore be necessary to add some text explaining why forking still works.\nEditor’s Note: This Annex was added to enable other clauses to refer to it. It will be filled with text later.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "J.1\tIANA assignments",
            "description": "This clause defines several new values for the namespace Prot Type defined in IETF RFC 3830 [11]. IANA is requested to record the assignments in Table X to the namespace Prot Type in the MIKEY payload registry. The Prot Types can be used by any MIKEY mode.\nTable J: Prot Type (Additions)\n\nTLS: This Prot Type provides a pre-shared key (TEK) to be used in pre-shared key ciphersuites for (D)TLS as specified in Annex H.\nPSK S/MIME: This Prot Type provides a pre-shared key (TEK) to be used to protect MIME content as specified in Annex I.\nApplication Specific: This Prot Type provides pre-shared key(s) to be used in an application specific security protocol. Security policies (SP payloads) shall not be associated with the Crypto Session (CS).\nEditor’s note:  The values TBD1, TBD2, and TBD3 will later be replaced with values assigned by IANA.\nThis clause specifies a new MIKEY General Extension Payload to provide proof-of-origin for an arbitrary message. It is intended to be used together with the pre-shared key MIME protection defined in Annex I where the MAC of the MIME entity is copied to a TRANSFER_INIT message. Since the origin of the TRANSFER_INIT message is guaranteed, the origin of the MIME entity will be guaranteed as well (the receiver compares the MAC value of the MIME entity to the MAC value in the extension payload).\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table J: Prot Type (Additions)",
                    "table number": 5,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "K.1\tPayload format",
            "description": "The 3GPP IMS MSG PROOF-OF-ORIGIN Type (Type TBD) formats the MIKEY General Extension payload as follows:\n0                   1                   2                   3\n0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n! Next Payload !      Type     !            Length            !\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n!      3GPP IMS MSG PROOF-OF-ORIGIN Data(variable length)     ~\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\n\n-\tNext Payload and Length are defined in Section 6.15 of MIKEY [11]\n-\tType (8 bits) identifies the type of the General Extension Payload (see Section 6.15 of MIKEY [11]).  This Annex adds a new type.  It specifies the use of Type TBD for 3GPP IMS MSG PROOF-OF-ORIGIN.\n-\t3GPP IMS MSG PROOF-OF-ORIGIN Data (variable length): contains the data whose origin needs to be asserted. The interpretation of the data is application/context specific (data could for example be the hash of a much longer message, where the hash algorithm is defined by the application/context)\nEditor’s note: The 3GPP IMS MSG PROOF-OF-ORIGIN type must be registered with IANA\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.1\tIntroduction",
            "description": "The transmission of fax over IP networks is specified in the ITU-T recommendation T.38 [34] and uses either TCP or UDP for transport. T.38 allows transmission of fax over IP networks in real time and allows interworking with the legacy PSTN T.30 fax protocol. For the TCP transport, IFP (Internet Fax Protocol) is encapsulated in TPKT. For the UDP transport, IFP data is encapsulated in either UDPTL (UDP Transport Layer) or RTP.  The purpose of UDPTL and RTP is to provide sequence numbering and packet redundancy (to cope with packet loss).\nUDPTL (UDP Transport Layer) is the predominant means for transporting T.38. For IMS, a profile of T.38 fax is specified in Annex L of TS 26.114 [35]. This profile only supports UDPTL/UDP transport. The packet structure for UDPTL based T.38 fax is shown in Figure L-1.\n\nThe figure depicts the packet structure for a T.38 fax transmission, illustrating the data and control information that is transmitted over the network. The figure shows the header, payload, and control information, which are essential for the successful transmission of the fax message.\nFigure L–1: Packet structure for UDPTL based T.38 fax transmission [34]\nA T.38 fax call is established in SIP/SDP similar to how an audio or messaging session is established. Figure L-2 shows how the SDP media line is constructed in case of UDPTL/UDP transport.\n\nm=image 49170 udptl t38\na=...\nFigure L-2: Example SDP offer forT.38 fax transmission using UDPTL/UDP transport \n(non-relevant parts of the SDP offer have been excluded)\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.2\tUse cases",
            "description": "As fax has a special legal status in many countries and enjoys continuing support, specification of secure fax is important. As most faxes are still connected to PSTN, the primary use case is seen as a fax call between an IMS UE and a PSTN/CS fax terminal. In order to support this use case media protection needs to start at the IMS UE and be terminated before or at the PSTN GW. Fax calls between two IMS UEs is another possibility but is not as common, and in this case there exist other alternatives like attaching the fax in an email or instant message using ITU-T recommendation T.37.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.3\te2ae security for T.38 fax using DTLS",
            "description": "T.38 fax using UDPTL/UDP transport shall be secured e2ae between IMS UE and IMS-AGW by usage of DTLS (IETF  RFC  6347  [36]). DTLS shall be profiled as defined in Annex M of the present document. The transport protocol identifier \"UDP/TLS/UDPTL\" and the usage of UDPTL over DTLS are defined in IETF RFC 7345 [37].\nThe solution leverages IMS control plane security by using self-signed certificates and exchanging the certificate fingerprints via SIP/SDP. Usage of the \"P-Asserted-Identity\" header provides secure identification of the other endpoint. The solution is almost identical to MSRP e2ae security specified in this document, but uses DTLS instead of TLS for confidentiality and integrity protection.\nSupport for e2ae security for T.38 shall be indicated during registration in the same way as specified for RTP and MSRP based media. The indication shall be be done independently from the indication of support for e2ae security for RTP or MSRP based media, and shall use its own indications \"e2ae-security for T.38 supported by the UE\" and \"e2ae-security for T.38 supported by the network\" (the syntax is to be defined in the corresponding stage 3 specification).\nThe originating IMS UE shall set the transport identifier to \"UDP/TLS/UDPTL\" and include the SDP fingerprint attribute in the SDP offer. Moreover, the IMS UE adds an SDP attribute \"e2ae-security requested by UE\" indicating the request for e2ae security to the description of the T.38 fax call. The network shall insert the IMS access gateway into the media path and properly terminate DTLS, using its own certificate (the fingerprint of this certificate is returned to the originating IMS UE in the SDP answer). From the IMS access gateway in the direction towards the terminating IMS UE, plain UDP may be used on the next hops, assuming that the interfaces are protected.\n\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "M.1\tGeneral",
            "description": "shall be supported as specified in annex E of 3GPP TS 33.310 [22] with the additions/modifications outlined below Since DTLS is based on TLS and functions more or less in an identical way, the same option shall be applied to both DTLS and TLS. In the rare cases where there is a difference, this will be pointed out. .\ncipher suites without encryption should not be used;\nPre-shared keys shall not be used for e2ae media security. E2ae media security shall be based on the cipher suites and session keys negotiated via the  handshake.\nEditor's note:  TLS certificate profile and validation is missing. A starting point is TS 33.203, O.5.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.1\tGeneral",
            "description": "This annex describes the additional IMS media plane security features that are necessary to support WebRTC IMS Clients access to IMS as well as IMS data channels.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "N.2\tMedia security for RTP",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "N.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "According to IETF RFC 8826  [39], all RTP traffic generated or received by a WebRTC client shall be protected with SRTP, using DTLS-SRTP [40, 41] as the key management protocol. This means that if a WebRTC IMS Client is supposed to be able to communicate with existing IMS endpoints (e.g. IMS UE or PSTN GW), DTLS-SRTP and SRTP shall be terminated at an intermediate node.\nThis clause describes the additional procedures and interface extensions required to support end-to-access-edge (e2ae) security for RTP using DTLS-SRTP and SRTP.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.2.2\te2ae security for RTP using DTLS-SRTP",
                    "description": "",
                    "summary": "",
                    "text_content": "E2ae protection of RTP using DTLS-SRTP is similar to e2ae protection of MSRP using TLS/TCP and the session establishment procedures are therefore largely the same. In both cases certificate fingerprints need to be exchanged over SDP and the media has to be anchored in IMS by inserting a gateway on the media path. Similarly as for e2ae protection using SDES and TLS, the signalling path between the WebRTC IMS Client and the eP-CSCF needs to be secured.\nFigure N.2.2-1 shows the originating procedure for e2ae protection of RTP using DTLS-SRTP. The terminating procedure is similar and is not shown here. Note that no assumption is made on the interface between the WebRTC IMS client and the eP-CSCF except that it is SDP based and integrity protected.\nSince only e2ae security is supported at the moment, the WebRTC IMS Client is required to include the indication \"e2ae-security requested by UE\" in every offer it creates.\nIt is assumed that the eP-CSCF is aware of the fact the IMS UE is a WebRTC IMS Client and automatically applies e2ae security for terminating calls.  Therefore, unlike the existing e2ae security for RTP and MSRP, there is no need for the IMS UE to explicitly indicate support of e2ae security during registration.\nNOTE: Void\nThe DTLS-SRTP profile to use is described in Annex O of this document.\nThe figure depicts the E2AE (Enhanced E2AE) protection mechanism for RTP (Real-Time Transport Protocol) based on DTLS-SRTP (Data Transfer Layer Security-SRTP) in a network. It illustrates the use of E2AE to enhance the security of RTP by providing a layer of protection against eavesdropping attacks. The figure shows the network architecture, including the use of E2AE, the DTLS-SRTP protocol, and the RTP protocol.\nFigure N.2.2-1: E2ae protection of RTP based on DTLS-SRTP\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "N.3\tMedia security for WebRTC and IMS data channels",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "N.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes how end-to-access-edge (e2ae) and end-to-end (e2e) security is achieved for WebRTC Data Channels (see IETF RFC 8831 [50], IETF RFC 8841 [48], and IETF RFC 8864 [51]). In addition the end-to-DC-edge (e2DCe) security is specified. The end-to-DC-edge (e2DCe) is defined to be the path between the UE and MF.\nWebRTC-compatible browsers use SCTP over DTLS as transport protocol for peer-to-peer data. A WebRTC Data Channel is defined as two unidirectional SCTP streams, one in each direction, which are managed together as a single entity (see IETF RFC 8831 [50]). The application protocol which runs on top of the WebRTC Data Channel is not specified and the JavaScript is free to implement any protocol it requires.\nThe application protocols that a WebRTC IMS Client may need to support are MSRP, BFCP, T.140, and T.38. A DCMTSI IMS Client [35] also supports the unspecified application protocol approach used by WebRTC Data Channel with, for example, a related web page and JavaScript handling the needed transmission and protocol format actions.\nFigure N.3.1-1 shows the common protocol stack and the required protocol translation for a WebRTC IMS Client, where the WebRTC Data Channel stack is not used in IMS core network or towards the peer. The transport protocol that the IMS-AGW applies on the remote side (marked X in the figure) depends on the application protocol. For MSRP and BFCP X=TCP, for T.140 X=RTP/UDP, and for T.38 X=UDPTL/UDP. In general, the IMS-AGW will forward the application protocol messages transparently. The only exception is MSRP messages which contain IP address information and therefore needs to be re-written by the IMS-AGW. This can however be avoided if both endpoint support the MSRP CEMA extension [24].\nT.140 (real-time text) and T.38 (fax) are included here for sake of completeness. These are legacy protocols and are not expected to be commonly used.\nEditor’s Note: The final list of supported application protocols (e.g., MSRP, BFCP, T.140, and T.38) is to be decided by CT groups.\nThe figure depicts a protocol stack for WebRTC IMS Client (WIC) Data Channels, illustrating the various data channels used for communication between the client and the server. The stack includes the WebRTC protocol, which is used for real-time communication, and the IMS protocol, which is used for inter-media messaging. The figure shows the data channels for audio, video, and text, as well as the signaling and control channels. The layout of the data channels is shown in a layered structure, with each channel represented by a separate layer. The figure also includes a legend to help understand the different types of data channels and their respective functions.\nFigure N.3.1-1: Protocol stack for WebRTC IMS Client (WIC) Data Channels\nFigures N.3.1-2 and N.3.1-3 are based on TS 23.228 [3] and show two examples of the protocol stack used by DCMTSI [35] Clients. Figure N3.1-2 shows a protocol stack for the HTTP proxy configuration mode for the Bootstrap Data Channel or Application Data Channel in case MF is anchoring DTLS.\n\nThe figure depicts a protocol stack for IMS (Integrated Multimedia Services) data channels, specifically TS 23.228[3], which is used for the transmission of multimedia data. The stack includes various components such as the IMS protocol, data channel, and control channel. The figure provides a visual representation of the data flow and control flow in the IMS protocol, allowing for a better understanding of the system's architecture.\nFigure N.3.1-2: Protocol stack for IMS bootstrap data channels (TS 23.228[3])\nFigure N.3.1-3 shows protocol stack for the UDP proxy configuration mode for the Application Data Channel case, providing a Person2Application/Application2Person/Person2Person Data Channel Application.\nThe figure depicts a protocol stack for an IMS application data channel without MF (TS 23.228[3]), illustrating the various components and their interactions.\nFigure N.3.1-3: Protocol stack for P2P/P2A/A2P IMS application data channels without MF (TS 23.228[3])\n\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.3.2\te2ae security for WebRTC data channels",
                    "description": "",
                    "summary": "",
                    "text_content": "E2ae security for WebRTC Data Channels for a WebRTC IMS Client (WIC) is achieved in the same way as e2ae security for MSRP over TLS/TCP.  In both cases certificate fingerprints need to be exchanged over SDP and the media has to be anchored in IMS by inserting a gateway on the media path. To ensure the integrity of the certificate fingerprint the signalling path is assumed to be protected.\nFigure N.3.2-1 shows the originating procedure for e2ae protection of WebRTC Data Channels. The terminating procedure is similar and is not shown here. Note that no assumptions are made on the interface between the WebRTC IMS Client and eP-CSCF except that it is SDP-based and integrity protected.\nSince only e2ae security is supported at the moment for WebRTC IMS Client (WIC), the WebRTC IMS Client is required to include the indication \"e2ae-security requested by UE\" in every offer it creates.\nIt is assumed that the eP-CSCF is aware of the fact the IMS UE is a WebRTC IMS Client and automatically applies e2ae security for terminating calls. The P-CSCF is aware of a DCMTSI client, based on the IMS data channel media feature tag used by the DCMTSI client during registration. Therefore, unlike the existing e2ae security for MSRP over TLS/TCP, there is no need for the IMS UE to indicate support of e2ae security during registration.\nThe figure depicts the E2AE (Enhanced E2AE) protection of WebRTC Data Channels, which is a crucial component in ensuring the security of real-time communication applications. The figure illustrates the various layers of protection, including the E2AE layer, the E2AE layer, and the E2AE layer, which are crucial for safeguarding the data channels. The E2AE layer is responsible for ensuring that the data channels are protected from eavesdropping and other potential threats, while the E2AE layer is responsible for ensuring that the data channels are protected from unauthorized access. The E2AE layer is also responsible for ensuring that the data channels are protected from other potential threats, such as denial-of-service attacks. The E2AE layer is also responsible for ensuring that the data channels are protected from other potential threats, such as denial-of-service attacks. The E2AE layer is also responsible for ensuring that the data channels are protected from other potential threats, such as denial-of-service attacks. The E2AE layer is also responsible for ensuring that the data channels are protected from other potential threats, such as denial-of-service attacks. The E2AE layer is also responsible for ensuring that the data channels are protected from\nFigure N.3.2-1: E2ae protection of WebRTC Data Channels\nNOTE 1:\tThe method for negotiating the application protocol (e.g. MSRP) and configuring the WebRTC Data Channel (e.g. setting stream identifiers, choosing between reliable or unrealiable transmission, etc) is defined in the corresponding stage 3 specification, e.g., based on IETF RFC 8832 [42] or IETF RFC 8864 [51].\nNOTE 2:\tFrom a security perspective, it is safe to multiplex several WebRTC Data Channels (e.g. one for MSRP and one for BFCP) on top of a single SCTP association and DTLS connection.  However, there may be other, non-security related reasons that prevent this option.\nNOTE 3:\tIMS Data Channel (DCMTSI) clients use a=dcmap lines from IETF RFC 8864 [51] in SDP, in addition to the SDP lines indicated above, while WebRTC clients do not. See also Figure N.3.4-1.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.3.3\te2DCe security for IMS data channels",
                    "description": "",
                    "summary": "",
                    "text_content": "For DCMTSI clients using IMS data channel media, e2DCe security is achieved by anchoring DTLS in Data Channel Media Function (MF) while IMS Access GW is anchoring UDP but transparently letting through layers above UDP, to avoid unnecessary DTLS decryption/encryption operations, but otherwise handling certificates and fingerprints as above. See Figure N.3.1-2.\nFor IMS data channel (DCMTSI) clients, both e2DCe and e2e security shall be supported for IMS data channels and e2DCe security support may be included in SDP offers and answers.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "N.3.4\te2e security for IMS data channels",
                    "description": "",
                    "summary": "",
                    "text_content": "E2e security for IMS Data Channels for DCMTSI clients is achieved in a similar way as for e2DCe security. See clause N.3.3. In both cases, certificate fingerprints need to be exchanged over SDP between the peers and certificates are exchanged through DTLS handshake in-band on the media path. The media may be anchored in IMS by inserting a gateway on the media path. To ensure the integrity of the certificate fingerprint, the signalling path is assumed to be protected.\nThe figure depicts the E2 E 1-portation of IMS data channels, illustrating the various data paths and their respective attenuation levels.\nFigure N.3.4-1: E2E protection of IMS Data Channels\nNOTE:\tSDP is not exchanged between the S-CSCF and the DC Application Server. The DC3 and DC4 interfaces are not specified in TS 23.228[3].\nThe present Annex contains a list of parameters that may be contained in the use_srtp extension in the DTLS extended client hello, according to RFC 5764 [41]. The rest of the DTLS profile is as defined in Annex M of this document.\nSRTP Protection Profiles:\nThe SRTP protection profile \"AES_CM_128_HMAC_SHA1_80\", as defined in RFC 5763 [40] and the SRTP protection profile \"SRTP_AEAD_AES_128_GCM\",as defined in RFC 7714 [46] are mandatory to support. Support of other protection profiles is optional.\nSRTP Master Key Identifier (MKI):\nOptional to use and support. Since a DTLS-SRTP handshake results in single SRTP master key, an endpoint has at most one active master key at any point in time. MKI signalling is therefore typically not required (the major exception would be if the peers perform frequent re-keying) and is not recommended.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "P.1\tSecurity aspects of SBA in IMS media control interface",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "P.1.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the security features that are necessary to support SBA in IMS media control interface.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "P.1.2\tProtection at the network or transport layer",
                    "description": "",
                    "summary": "",
                    "text_content": "All service based network functions in IMS media control interface shall support protection at the network or transport layer as specified in clause 13 of TS 33.501 [47.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "P.1.3\tAuthentication and authorization",
                    "description": "",
                    "summary": "",
                    "text_content": "All service based network functions in IMS media control interface and NRF shall support authentication and authorization as specified in clause 13 of TS 33.501 [47.\nNOTE:\tIt is assumed that slice related aspects are not applicable in IMS.\n\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 6,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 7,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}