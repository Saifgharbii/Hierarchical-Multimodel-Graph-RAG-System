{
    "document_name": "24379-i50.docx",
    "content": [
        {
            "title": "Foreword",
            "description": "This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "1\tScope",
            "description": "The present document specifies the session control protocols needed to support Mission Critical Push To Talk (MCPTT). The present document specifies both on-network and off-network protocols.\nMission critical communication services are services that require preferential handling compared to normal telecommunication services, e.g. in support of police or fire brigade.\nThe MCPTT service can be used for public safety applications and also for general commercial applications (e.g., utility companies and railways).\nThe present document is applicable to User Equipment (UE) supporting the MCPTT client functionality, and to application servers supporting the MCPTT server functionality.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "2\tReferences",
            "description": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 22.179: \"Mission Critical Push To Talk (MCPTT) over LTE; Stage 1\".\n[3]\t3GPP TS 23.379: \"Functional architecture and information flows to support mission critical communication services; Stage 2\".\n[4]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[5]\t3GPP TS 24.380: \"Mission Critical Push To Talk (MCPTT) floor control Protocol specification\".\n[6]\tIETF RFC 3841 (August 2004): \"Caller Preferences for the Session Initiation Protocol (SIP)\".\n[7]\tIETF RFC 4028 (April 2005): \"Session Timers in the Session Initiation Protocol (SIP)\".\n[8]\tVoid .\n[9]\tIETF RFC 6050 (November 2010): \"A Session Initiation Protocol (SIP) Extension for the Identification of Services\".\n[10]\tIETF RFC 3550 (July 2003): \"RTP: A Transport Protocol for Real-Time Applications\".\n[11]\tVoid.\n[12]\tIETF RFC 4566 (July 2006): \"Session Description Protocol\".\n[13]\tIETF RFC 3605 (October 2003): \"Real Time Control Protocol (RTCP) attribute in Session Description Protocol (SDP)\".\n[14]\tIETF RFC 3325 (November 2002): \"Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks\".\n[15]\tIETF RFC 5626 (October 2009): \"Managing Client-Initiated Connections in the Session Initiation Protocol (SIP)\".\n[16]\tIETF RFC 3840 (August 2004): \"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)\".\n[17]\tVoid.\n[18]\tIETF RFC 5373 (November 2008): \"Requesting Answering Modes for the Session Initiation Protocol (SIP)\".\n[19]\tVoid.\n[20]\tIETF RFC 5366 (October 2008): \"Conference Establishment Using Request-Contained Lists in the Session Initiation Protocol (SIP)\".\n[21]\tIETF RFC 2046 (November 1996): \"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types\".\n[22]\tIETF RFC 4488 (May 2006): \"Suppression of Session Initiation Protocol (SIP) REFER Method Implicit Subscription\".\n[23]\tIETF RFC 4538 (June 2006): \"Request Authorization through Dialog Identification in the Session Initiation Protocol (SIP)\".\n[24]\tIETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".\n[25]\tIETF RFC 3515 (April 2003): \"The Session Initiation Protocol (SIP) Refer Method\".\n[26]\tIETF RFC 6665 (July 2012): \"SIP-Specific Event Notification\".\n[27]\tIETF RFC 7647 (September 2015): \"Clarifications for the use of REFER with RFC 6665\".\n[28]\t3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to Proximity-services (ProSe) Function Protocol aspects; Stage 3\".\n[29]\tIETF RFC 4412 (February 2006): \"Communications Resource Priority for the Session Initiation Protocol (SIP)\".\n[30]\tIETF RFC 4575 (August 2006): \"A Session Initiation Protocol (SIP) Event Package for Conference State\".\n[31]\t3GPP TS 24.481: \"Mission Critical Services (MCS) group management Protocol specification\".\n[32]\tIETF RFC 4483 (May 2006): \"A Mechanism for Content Indirection in Session Initiation Protocol (SIP) Messages.\n[33]\tIETF RFC 3428 (December 2002): \"Session Initiation Protocol (SIP) Extension for Instant Messaging\".\n[34]\tIETF RFC 4964 (October 2007): \"The P-Answer-State Header Extension to the Session Initiation Protocol for the Open Mobile Alliance Push-to-talk over Cellular\".\n[35]\tIETF RFC 7614 (August 2015): \"Explicit Subscriptions for the REFER Method\".\n[36]\tIETF RFC 5318 (December 2008): \"The Session Initiation Protocol (SIP) P-Refused-URI-List Private-Header (P-Header)\".\n[37]\tIETF RFC 3903 (October 2004): \"Session Initiation Protocol (SIP) Extension for Event State Publication\".\n[38]\tIETF RFC 5368 (October 2008): \"Referring to Multiple Resources in the Session Initiation Protocol (SIP)\".\n[39]\tIETF RFC 5761 (April 2010): \"Multiplexing RTP Data and Control Packets on a Single Port\".\n[40]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[41]\t3GPP TS 23.203: \"Policy and charging control architecture\".\n[42]\t3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE); MB2 Reference Point; Stage 3\".\n[43]\t3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3\".\n[44]\tIETF RFC 3264 (June 2002): \"An Offer/Answer Model with the Session Description Protocol (SDP)\".\n[45]\t3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object (MO)\".\n[46]\tVoid.\n[47]\tIETF RFC 4567 (July 2006): \"Key Management Extensions for Session Description Protocol (SDP) and Real Time Streaming Protocol (RTSP)\".\n[48]\tIETF RFC 8101 (March 2017): \"IANA Registration of New Session Initiation Protocol (SIP) Resource-Priority Namespace for Mission Critical Push To Talk service\".\n[49]\t3GPP TS 24.482: \"Mission Critical Services (MCS) identity management Protocol specification.\n[50]\t3GPP TS 24.484: \"Mission Critical Services (MCS) configuration management Protocol specification\".\n[51]\tIETF RFC 3856 (August 2004): \"A Presence Event Package for the Session Initiation Protocol (SIP)\".\n[52]\tIETF RFC 3863 (August 2004): \"Presence Information Data Format (PIDF)\".\n[53]\tIETF RFC 7519 (May 2015): \"JSON Web Token (JWT)\".\n[54]\t3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".\n[55]\tIETF RFC 4354 (January 2006): \"A Session Initiation Protocol (SIP) Event Package and Data Format for Various Settings in Support for the Push-to-Talk over Cellular (PoC) Service\".\n[56]\t3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General aspects\".\n[57]\t3GPP TS 23.468: \"Group Communication System Enablers for LTE (GCSE_LTE); Stage 2\".\n[58]\t3GPP TS 24.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage 3\".\n[59]\t3GPP TS 29.199-9: \"Open Service Access (OSA); Parlay X Web Services; Part 9: Terminal location\".\n[60]\tW3C: \"XML Encryption Syntax and Processing Version 1.1\", .\n[61]\tW3C: \"XML Signature Syntax and Processing (Second Edition)\", .\n[62]\tIETF RFC 2392 (August 1998): \"Content-ID and Message-ID Uniform Resource Locators\".\n[63]\tIETF RFC 4661 (September 2006): \"An Extensible Markup Language (XML)-Based Format for Event Notification Filtering\".\n[64]\tIETF RFC 6086 (January 2011): \"Session Initiation Protocol (SIP) INFO Method and Package Framework\".\n[65]\tIETF RFC 3891 (September 2004): \"The Session Initiation Protocol (SIP) Replaces Header\".\n[66]\t3GPP TS 24.216: \"Communication continuity managed object\".\n[67]\tIETF RFC 4122 (July 2005): \"A Universally Unique IDentifier (UUID) URN Namespace\".\n[68]\tIETF RFC 2045 (November 1996): \"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies\".\n[69]\t3GPP TS 26.179: \"Mission Critical Push To Talk (MCPTT) Codecs and media handling\".\n[70]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[71]\tIETF RFC 4648 (October 2006): \"The Base16, Base32, and Base64 Data Encodings\".\n[72]\tIETF RFC 5627 (October 2009): \"Obtaining and Using Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".\n[73]\t3GPP TS 29.283: \"Diameter Data Management Applications\".\n[74]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[75]\tIETF RFC 6509 (February 2012): \"MIKEY-SAKKE: Sakai-Kasahara Key Encryption in Multimedia Internet KEYing (MIKEY)\".\n[76]\t3GPP TS 22.280: \"Mission Critical Services Common Requirements (MCCoRe); Stage 1\".\n[77]\tIETF RFC 7462 (March 2015): \"URNs for the Alert-Info Header Field of the Session Initiation Protocol (SIP)\".\n[78]\t3GPP TS 33.180: \"Security of the mission critical service\".\n[79]\t3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".\n[80]\tIETF RFC 5795 (March 2010): \"The Robust Header Compression (ROHC) Framework\".\n[81]\tIETF RFC 3095 (July 2001): \"RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP, and uncompressed\".\n[82]\t3GPP TS 23.280: \"Technical Specification Group Services and System Aspects; Common functional architecture to support mission critical services; Stage 2\".\n[83]\tIETF RFC 5288 (August 2008): \"AES Galois Counter Mode (GCM) Cipher Suites for TLS\".\n[84]\t3GPP TS 24.281: \"Mission Critical Video (MCVideo) signalling control; Protocol specification\".\n[85]\t3GPP TS 24.282: \"Mission Critical Data (MCData) signalling control; Protocol specification\".\n[86]\tIETF RFC 5576 (June 2009): \"Source-Specific Media Attributes in the Session Description Protocol (SDP)\".\n[87]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[88]\t3GPP TS 29.379: \"Mission Critical Push To Talk (MCPTT) call control interworking with Land Mobile Radio (LMR) systems; Stage-3\".\n[89]\tIETF RFC 8445 (July 2018): \"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal\".\n[90]\tIETF RFC 8839 (January 2021): \"Session Description Protocol (SDP) Offer/Answer Procedures for Interactive Connectivity Establishment (ICE)\".\n[91]\t3GPP TS 23.247: \"Architectural enhancements for 5G multicast-broadcast services; Stage 2\".\n[92]\t3GPP TS 23.289: \"Mission Critical services over 5G System; Stage 2\".\n[93]\tIETF RFC 6809 (November 2012): \"Mechanism to Indicate Support of Features and Capabilities in the Session Initiation Protocol (SIP)\".\n[94]\t3GPP TS 24.554: \" Proximity-services (ProSe) in 5G System (5GS) protocol aspects; Stage 3\".\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "3\tDefinitions, symbols and abbreviations",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "3.1\tDefinitions",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nAn MCPTT user is affiliated to an MCPTT group: The MCPTT user has expressed interest in an MCPTT group it is a member of, and both the MCPTT server serving the MCPTT user and the MCPTT server owning the MCPTT group have authorized the MCPTT user's interest in the MCPTT group communication.\nAn MCPTT user is affiliated to an MCPTT group at an MCPTT client: The MCPTT user is affiliated to the MCPTT group, the MCPTT client has a registered IP address for an IMPU related to the MCPTT ID, and the MCPTT server serving the MCPTT user has authorised the MCPTT user's interest in the MCPTT group at the MCPTT client.\nAffiliation status: Applies for an MCPTT user to an MCPTT group and has one of the following states:\na)\tthe \"not-affiliated\" state indicating that the MCPTT user is not interested in the MCPTT group and the MCPTT user is not affiliated to the MCPTT group;\nb)\tthe \"affiliating\" state indicating that the MCPTT user is interested in the MCPTT group but the MCPTT user is not affiliated to the MCPTT group yet;\nc)\tthe \"affiliated\" state indicating that the MCPTT user is affiliated to the MCPTT group and there was no indication that MCPTT user is no longer interested in the MCPTT group; and\nd)\tthe \"deaffiliating\" state indicating that the MCPTT user is no longer interested in the MCPTT group but the MCPTT user is still affiliated to the MCPTT group.\nAmbient listening call: a call type allowing an authorized MCPTT user to cause an MCPTT client to initiate a communication which results in no indication on the MCPTT UE that it is transmitting. Ambient listening can be initiated by an authorized MCPTT user who wants to be listened to by another authorized MCPTT user or can be initiated by an authorized MCPTT user who wants to listen to another MCPTT user.\nAmbient listening client role: the role of an MCPTT client in an ambient listening call, which can be that of:\na)\tthe \"listening MCPTT user\"; or\nb)\tthe \"listened-to MCPTT user\".\nAmbient listening type: the type of an ambient listening call from the perspective of the relationship of the initiator of the call to the user being listened to. The two types of ambient listening call are:\na)\t\"remote-init\", indicating that the listening MCPTT user initiated the call; and\nb)\t\"local-init\", indicating that the listened-to MCPTT user initiated the call.\nFirst-to-answer call: A call initiated by one user towards a list of other users with the intention to establish an MCPTT private call or MCPTT emergency private call, with one of the users in the list of users.\nGroup document: when the group is not a regroup based on a preconfigured regroup, the term \"group document\" used within the present document refers to the group document for that group within the GMS as specified in 3GPP TS 24.481 [31]; when the group is a regroup based on a preconfigured group, the term \"group document\" used within the present document refers to the group document for the preconfigured group as specified in 3GPP TS 24.481 [31] restricted to the users or groups included in the regroup stored by the MCPTT server at the time of the regroup creation, see clause 16.\nGroup identity: An MCPTT group identity or a temporary MCPTT group identity.\nIn-progress emergency private call state: the state of two participants when an MCPTT emergency private call is in progress.\nIn-progress imminent peril group state: the state of a group when an MCPTT imminent peril group call is in progress.\nListening MCPTT user: the MCPTT user in an ambient listening call receiving the media transmission from the listened-to MCPTT user;\nListened-to MCPTT user: the MCPTT user in an ambient listening call who is being listened to, may or may not be aware of being listened to depending on ambient listening type of the call.\nMCPTT client ID: is a globally unique identification of a specific MCPTT client instance. MCPTT client ID is a UUID URN as specified in IETF RFC 4122 [67].\nMCPTT emergency alert state: MCPTT client internal perspective of the state of an MCPTT emergency alert.\nMCPTT emergency group state: MCPTT client internal perspective of the in-progress emergency state of an MCPTT group maintained by the controlling MCPTT function.\nMCPTT emergency group call state: MCPTT client internal perspective of the state of an MCPTT emergency group call.\nMCPTT emergency private call: MCPTT emergency call between two MCPTT users that is initiated as a private call or a first-to-answer call with emergency indication, or without emergency indication when the MCPTT emergency state is already set,\nMCPTT emergency private call state: MCPTT client internal perspective of the state of an MCPTT emergency private call.\nMCPTT emergency private priority state: MCPTT client internal perspective of the in-progress emergency private call state of the two participants of an MCPTT emergency private call maintained by the controlling MCPTT function.\nMCPTT imminent peril group call state: MCPTT client internal perspective of the state of an MCPTT imminent peril group call.\nMCPTT imminent peril group state: MCPTT client internal perspective of the state of an MCPTT imminent peril group.\nMCPTT private call: MCPTT call between two MCPTT users that is initiated as a private call or a first-to-answer call.\nMCPTT private emergency alert state: MCPTT client internal perspective of the state of an MCPTT private emergency alert targeted to an MCPTT user.\nMCPTT speech: Conversational audio media used in mission critical push to talk systems as defined by 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3].\nMedia-floor control entity: A media control resource shared by participants in an MCPTT session, controlled by a state machine to ensure that only one participant can access the media resource at the same time.\nN2: The maximum number of simultaneous affiliations to MCPTT groups that the MCPTT user may have. The value of N2 is specified in the <MaxAffiliationsN2> element of the <Common> element of the MCPTT user profile and corresponds to the parameter Nc2 specified in 3GPP TS 22.280 [76].\nPrivate call: A call initiated by one user towards one other user with the intention to establish an MCPTT private call or MCPTT emergency private call.\nPrivate Call Call-Back: A mechanism for a requesting MCPTT client to request a targeted MCPTT client to initiate an MCPTT private call with the requesting MCPTT client (at earliest convenience).\nRemote change of an MCPTT user's selected group: A mechanism allowing an authorised user to remotely change the selected group of another MCPTT user.\nTemporary MCPTT group identity: A group identity representing a temporary grouping of MCPTT group identities formed by the group regrouping operation as specified in 3GPP TS 24.481 [31].\nTrusted mutual aid: A business relationship whereby the Partner MCPTT system is willing to share the details of the members of an MCPTT group that it owns with the Primary MCPTT system.\nUntrusted mutual aid: A business relationship whereby the Partner MCPTT system is not willing to share the details of the members of an MCPTT group that it owns with the Primary MCPTT system.\nUser Requested Application Priority: The requested priority as defined in 3GPP TS 23.280 [82]. How the server determines the priority for the requested communication based on requested priority and in combination with other factors is up to MCPTT server implementation.\nFunctional alias status: Applies for the status of a functional alias for an MCTT user and has one of the following states:\na)\tthe \"not-activated\" state indicating that the MCPTT user has not activated the functional alias;\nb)\tthe \"activating\" state indicating that the MCPTT user is interested in using the functional alias but the functional alias is not yet activated for the MCPTT user;\nc)\tthe \"activated\" state indicating that the MCPTT user has activated the functional alias;\nd)\tthe \"deactivating\" state indicating that the MCPTT user is no longer interested in using the functional alias but the functional alias is still activated for the MCPTT user; and\ne)\tthe \"take-over-possible\" state indicating that the MCPTT user interested in the functional alias is allowed to take-over the functional alias although the functional alias is already activated and used by another MCPTT user.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 22.179 [2] apply:\nIn-progress emergency\nMCPTT emergency alert\nMCPTT emergency group call\nMCPTT emergency state\nPartner MCPTT system\nPrimary MCPTT system\nFor the purpose of the present document, the following terms and definitions given in 3GPP TS 24.380 [5] apply:\nMBMS subchannel\nFor the purpose of the present document, the following terms and definitions given in 3GPP TS 23.379 [3] apply:\nPre-selected MCPTT user profile\nSelected MCPTT user profile\nFor the purpose of the present document, the following terms and definitions given in 3GPP TS 33.180 [78] apply:\nClient Server Key (CSK)\nMulticast Floor Control Key (MKFC)\nMulticast Signalling Key (MuSiK)\nMulticast Signalling Key Identifier (MuSiK-ID)\nMBMS subchannel control key (MSCCK)\nMBMS subchannel control key identifier (MSCCK-ID)\nPrivate Call Key (PCK)\nSignalling Protection Key (SPK)\nXML Protection Key (XPK)\nFor the purpose of the present document, the following terms and definitions given in 3GPP TS 22.280 [76] apply:\nFunctional alias\nFor the purposes of the present document, the following terms related to a MCPTT gateway UE function apply\nMCPTT gateway UE:  A functional entity that enables simultaneous access to the MCPTT system for multiple MCPTT clients.\nMCPTT gateway client: A client that enables the authorized binding with one or more MCPTT GW UEs in order to be able to handle MCPTT services.\nMCPTT gateway UE server: A server on an MCTT gateway UE that controls authorized binding with multiple MCPTT gateway clients.\nMCPTT gateway UE function: Functional block as part of the MCPTT server that authorises and manages the association between MCPTT client and MCPTT gateway UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "3.2\tAbbreviations",
                    "description": "",
                    "summary": "",
                    "text_content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\nCID\tContext ID\nCSK\tClient-Server Key\nECGI\tE-UTRAN Cell Global Identification\nIPEG\tIn-Progress Emergency Group\nIPEPC\tIn-Progress Emergency Private Call\nIPIG\tIn-Progress Imminent peril Group\nMBMS\tMultimedia Broadcast and Multicast Service\nMBS\tMulticast/Broadcast Service\nMBSFN\tMultimedia Broadcast multicast service Single Frequency Network\nMCPTT\tMission Critical Push To Talk\nMCPTT group ID\tMCPTT group Identity\nMC\tMission Critical\nMCS\tMission Critical Service\nMEA\tMCPTT Emergency Alert\nMEG\tMCPTT Emergency Group\nMEGC\tMCPTT Emergency Group Call\nMEPC\tMCPTT Emergency Private Call\nMEPP\tMCPTT Emergency Private Priority\nMES\tMCPTT Emergency State\nMIME\tMultipurpose Internet Mail Extensions\nMIG\tMCPTT Imminent peril Group\nMIGC\tMCPTT Imminent peril Group Call\nMONP\tMCPTT Off-Network Protocol\nMPEA\tMCPTT Private Emergency Alert\nNAT\tNetwork Address Translation\nPCC\tPolicy and Charging Control\nPCCB\tPrivate Call Call-Back\nPLMN\tPublic Land Mobile Network\nPPPP\tProSe Per-Packet Priority\nPQI\tPC5 5QI\nQCI\tQoS Class Identifier\nROHC\tRobust Header Compression\nRTP\tReal-time Transport Protocol\nSAI\tService Area Identifier\nSDP\tSession Description Protocol\nSIP\tSession Initiation Protocol\nSPK\tSignalling Protection Key\nSSRC\tSynchronization SouRCe\nTGI\tTemporary MCPTT Group Identity\nTMGI\tTemporary Mobile Group Identity\nUE\tUser Equipment\nURI\tUniform Resource Identifier\nXPK\tXML Protection Key\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "4\tGeneral",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "4.1\tMCPTT overview",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCPTT service supports communication between several users (i.e., group call), where each user has the ability to gain access to the permission to talk in an arbitrated manner. The MCPTT service also supports private calls between two users. Group calls and private calls can be provided on-network and off-network. In this release of the present document, support is only allowed for MCPTT speech communications.\nThe present document provides the call control protocol enhancements to support the MCPTT architectural procedures specified in 3GPP TS 23.379 [3].\nFor on-network calls, the present document makes use of the existing IMS procedures specified in 3GPP TS 24.229 [4], and provides new IMS application procedures specific for MCPTT. For on-network group calls, the procedures in the present document allow the use of unicast or multicast bearers. Multicast bearers are only supported in EPS.\nThe on-network procedures in this document allow an MCPTT user to:\n-\tinitiate a new MCPTT group call;\n-\tjoin an MCPTT group call that has already been established; and\n-\tleave an established MCPTT group call and then rejoin the same MCPTT group call if still established.\nFor off-network calls in EPS, the present document utilises the procedures for ProSe direct discovery for public safety; the procedures for one-to-one ProSe direct communication for Public Safety and the procedures for one-to-many ProSe direct communication for Public Safety, as specified in 3GPP TS 24.334 [28]. The present document specifies the MCPTT Off-Network Protocol (MONP) and the MONP application procedures.\nFor on-network and off-network calls, the present document provides support for MCPTT emergency calls, MCPTT imminent-peril calls and MCPTT emergency alerts.\nNOTE:\tMCPTT emergency calls do not utilise emergency bearers. Instead the EPS bearer priority of a normal bearer is adjusted.\nThe MCPTT procedures provided by the present document refer to:\n-\tthe floor-control procedures defined in 3GPP TS 24.380 [5];\n-\tthe group management procedures defined in 3GPP TS 24.481 [31];\n-\tthe identity management procedures defined in 3GPP TS 24.482 [49];\n-\tthe security procedures defined in 3GPP TS 33.180 [78]; and\n-\tthe PS-PS access transfer procedures procedures defined in 3GPP TS 24.237 [58].\nThe MCPTT procedures provided by the present document access the configuration parameters provided by 3GPP TS 24.483 [45] and 3GPP TS 24.484 [50].\nCodecs and media handling for MCPTT are specified in 3GPP TS 26.179 [69];\nThe following procedures are provided within this document:\n-\tcommon procedures are specified in clause 6;\n-\tprocedures for registration in the IM CN subsystem and service authorisation are specified in clause 7;\n-\tprocedures for pre-established session establishment, modification and release are specified in clause 8;\n-\tprocedures for affiliation are specified in clause 9;\n-\tprocedures for management of functional alias in clause 9A;\n-\tprocedures for on-network and off-network group call are specified in clause 10;\n-\tprocedures for on-network and off-network private call are specified in clause 11;\n-\tprocedures for on-network and off-network emergency alert are specified in clause 12;\n-\tlocation procedures are specified in clause 13;\n-\tMBMS transmission usage procedures are specified in clause 14;\n-\tMCPTT service continuity procedures are specified in clause 14A; and\n-\tMBS transmission usage procedures are specified in clause 14B.\nThe MCPTT UE primarily obtains access to the MCPTT service via E-UTRAN or NG-RAN, using the procedures defined in 3GPP TS 24.301 [70] and 3GPP TS 24.501 [87].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.2\tURI and address assignments",
                    "description": "",
                    "summary": "",
                    "text_content": "In order to support MCPTT, the following URI and address assignments are assumed:\n1)\tthe participating MCPTT function is configured to be reachable using:\na)\tpublic service identities identifying pre-established sessions on the MCPTT server serving the MCPTT user;\nb)\tthe MBMS public service identity of the participating MCPTT function; and\nc)\tthe public service identity of the participating MCPTT function serving the MCPTT user.\nNOTE:\tFor b) and c) above, the PSI values are configured with the same URI. However for the purpose of readability the names of the PSIs mentioned in b) and c) are used in the present document.\nThe MCPTT client should use the <Server-URI> element of the <MCPTT-Service-Details> element of the <anyExt> element of the <on-network> element in the MCS UE initial configuration document, as defined in reference 3GPP TS 24.484 [50] as public service identity of the participating function of the MCPTT client.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.3\tMCPTT speech",
                    "description": "",
                    "summary": "",
                    "text_content": "A session that contains MCPTT speech is either a full-duplex session or a half-duplex session with an SDP media component containing an audio media type with a codec suitable for conversational speech that exists between an MCPTT client and an MCPTT server.\nIf the MCPTT speech session is a half-duplex session, it additionally contains a media component that describes the characteristics of the media-floor control entity.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.4\tWarning Header Field",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.4.1\tGeneral",
                            "text_content": "The MCPTT server can include a free text string in a SIP response to a SIP request. When the MCPTT server includes a text string in a response to a SIP INVITE request the text string is included in a Warning header field as specified in IETF RFC 3261 [24]. The MCPTT server includes the Warning code set to 399 (miscellaneous warning) and includes the host name set to the host name of the MCPTT server.\nEXAMPLE: Warning: 399 \"100 User not authorised to make group calls\"\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.4.2\tWarning texts",
                            "text_content": "The text string included in a Warning header field consists of an explanatory text preceded by a 3-digit text code, according to the following format in Table 4.4.2-1.\nTable 4.4.2-1 ABNF for the Warning text\n\nwarn-text      =/  DQUOTE mcptt-warn-code SP mcptt-warn-text DQUOTE\nmcptt-warn-code = DIGIT DIGIT DIGIT\nmcptt-warn-text = *( qdtext | quoted-pair )\n\n\nTable 4.4.2-2 defines the warning texts that are defined for the Warning header field when a Warning header field is included in a response to a SIP INVITE request as specified in clause 4.4.1.\n\nTable 4.4.2-2: Warning texts defined for the Warning header field\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 4.4.2-2: Warning texts defined for the Warning header field",
                                    "table number": 3,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "4.5\tMCPTT session identity",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCPTT session identity is a SIP URI, which identifies the MCPTT session between:\n-\tthe MCPTT client and the participating MCPTT function;\n-\tthe participating MCPTT function and the controlling MCPTT function\n-\tthe controlling MCPTT function and the non-controlling MCPTT function; and\n-\tthe non-controlling MCPTT function and the participating MCPTT function.\nThe MCPTT session identity shall be a GRUU as defined in IETF RFC 5627 [72] assigned by the MCPTT server as per 3GPP TS 24.229 [4].\nThe MCPTT session identity identifies the MCPTT session in such a way that e.g.:\n-\tthe MCPTT user is able to subscribe to the participant information of the ongoing MCPTT session;\n-\tthe MCPTT user is able to rejoin an ongoing MCPTT session; and\n-\tthe IM CN subsystem is able to route an initial SIP request to the controlling MCPTT function.\nThe controlling MCPTT function allocates a unique MCPTT session identity hosted at the controlling MCPTT function for the MCPTT session at the time of session establishment.\nThe non-controlling MCPTT function allocates a unique MCPTT session identity hosted at the non-controlling MCPTT function for the MCPTT session at the time of session establishment.\nWhen protection of sensitive application data is required by the MCPTT operator, the MCPTT session identity cannot contain identity information that is classed as sensitive such as the MCPTT ID or the MCPTT Group ID, as specified in clause 4.8.\nThe controlling MCPTT function and non-controlling MCPTT function send the MCPTT session identity towards the MCPTT client during MCPTT session establishment by including it in the Contact header field of the final SIP response to a session initiation request.\nThe participating MCPTT function allocates a unique MCPTT session identity hosted at the participating MCPTT function for the MCPTT session when it receives a MCPTT session identity in the Contact header field of a SIP request or a SIP response from the controlling MCPTT function or non-controlling MCPTT function and includes it in the Contact header field of the SIP request or SIP response sent towards the MCPTT client. The participating MCPTT function maintains a mapping of the MCPTT session identities it sends to the MCPTT client to the corresponding MCPTT session identities received from the controlling MCPTT function.\nThe MCPTT client can cache the MCPTT session identity until a time when it is no longer needed.\nThe MCPTT session identity is also used in floor control requests and responses as specified in 3GPP TS 24.380 [5].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.6\tMCPTT priority calls and alerts",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.6.1\tMCPTT emergency group calls",
                            "text_content": "MCPTT emergency group calls as defined by 3GPP TS 23.379 [3] are supported by the procedures in this specification. The following MCPTT emergency group call functionalities are described:\n-\tMCPTT emergency group call origination;\n-\tupgrade of an MCPTT group call to an MCPTT emergency group call; and\n-\tin-progress group emergency cancel.\nNOTE 1:\tIn-progress group emergency cancel means the cancellation of the in-progress emergency state of the group, which is managed by the controlling MCPTT function.\nThe above functionalities are supported using both MCPTT prearranged group calls and MCPTT chat group calls.\nKey aspects of MCPTT emergency group calls include:\n-\tadjusted EPS bearer priority for all participants whether or not they themselves are in an emergency condition (i.e. have their MCPTT emergency state set). For unicast bearers this is achieved by using the Resource-Priority header field as specified in IETF RFC 4412 [29] with namespaces defined for use by MCPTT specified in IETF RFC 8101 [48], and for MBMS bearers this is achieved by having the participating MCPTT function adjust the ARP (priority, PVI, PCI) and executing the Modify MBMS Bearer Procedure per 3GPP TS 29.468 [42];\n-\tpre-emptive floor control priority over MCPTT users in MCPTT emergency group calls who themselves do not have their MCPTT emergency state set;\n-\trestoration of normal EPS bearer priority to the call participants when the in-progress emergency group state is cancelled;\n-\trestoration of normal floor control priority participants when the in-progress emergency group state is cancelled;\n-\trequires the MCPTT user to be authorised to either originate or cancel an MCPTT emergency group call;\n-\trequests to originate MCPTT emergency group calls may also include an indication of an MCPTT emergency alert; and\n-\trequests to cancel MCPTT emergency group calls may also include an indication of cancelling a previously issued MCPTT emergency alert.\nThere are a number of states that are key in managing these aspects of MCPTT emergency group calls, which include:\n-\tMCPTT emergency state: as defined in 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3], indicates that the MCPTT user is in a life-threatening situation. Managed by the MCPTT user of the device or an authorised MCPTT user. While the MCPTT emergency state is set on the client, all calls originated by the client will be MCPTT emergency calls, assuming the MCPTT user is authorised for MCPTT emergency calls on them.\n-\tin-progress emergency group state: as defined in 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3], indicates whether or not there is an MCPTT emergency group call ongoing on the specified group. This state is managed by the controlling MCPTT function. All group calls originated on this MCPTT group when in an in-progress emergency state are MCPTT emergency group calls until this state is cancelled, whether or not the originator is themselves in an MCPTT emergency state.\n-\tMCPTT emergency group (MEG) state: this is an internal state managed by the MCPTT client which tracks the in-progress emergency state of the group as defined in 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3] and managed by the controlling MCPTT function. Ideally, the MCPTT client would not need to track the in-progress emergency group state, but doing so enables the MCPTT client to request MCPTT emergency-level priority earlier than otherwise possible. For example, if the MCPTT user wishes to join an MCPTT emergency group call and is not in MCPTT emergency state itself, the MCPTT client should have emergency level priority. If it has knowledge of the in-progress emergency state of the group, it can request priority by including a Resource-Priority header field set to the MCPTT namespace specified in IETF RFC 8101 [48], and appropriate priority level in the SIP INVITE request (or SIP re-INVITE request).\n-\tMCPTT emergency group call (MEGC) state: this is an internal state managed by the MCPTT client which in conjunction with the MCPTT emergency alert state aids in managing the MCPTT emergency state and related actions.\n-\tMCPTT emergency alert (MEA) state: this is also an internal state of the MCPTT client which in conjunction with the MCPTT emergency group call state aids in managing the MCPTT emergency state and related actions.\nNOTE 2:\tThe above states and their transitions are described in Annex G.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.2\tMCPTT emergency private calls",
                            "text_content": "MCPTT emergency private calls as defined by 3GPP TS 23.379 [3] are supported by the procedures in this specification. The following MCPTT emergency private call functionalities are specified in the present document:\n-\tMCPTT emergency private call origination with optional MCPTT emergency alert initiation;\n-\tupgrade of an MCPTT private call to an MCPTT emergency private; and\n-\tcancellation of the MCPTT emergency private call priority.\nKey aspects of MCPTT emergency private calls include:\n-\tadjusted EPS bearer priority for both participants whether or not they are both in an emergency condition (i.e. both have their MCPTT emergency state set). This is achieved by using the Resource-Priority header field as specified in IETF RFC 4412 [29] with namespaces defined for use by MCPTT specified in IETF RFC 8101 [48];\n-\tthe initiator of the MCPTT emergency private call can override the other MCPTT user in the MCPTT emergency private call unless that user also has their MCPTT emergency state set;\n-\trestoration of normal EPS bearer priority to the call according to system policy (e.g., configured time limit for the emergency priority of an MCPTT emergency private call or cancellation of the emergency condition of the private call);\n-\trestoration of normal floor control priority participants when the emergency elevated priority is cancelled;\n-\trequires the MCPTT user to be authorised to either originate or cancel an MCPTT emergency private call;\n-\trequires the targeted MCPTT user to be authorised to receive an MCPTT emergency private call;\n-\trequests to originate MCPTT emergency private calls may also include an indication of an MCPTT emergency alert; and\n-\tthe originator of the MCPTT emergency private call can request that the call use either manaual or automatic commencement mode.\nThere are a number of states that are key in managing these aspects of MCPTT emergency private calls, which include:\n-\tMCPTT emergency state (MES): as defined in 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3], indicates that the MCPTT user is in a life-threatening situation. Managed by the MCPTT user of the device or an authorised MCPTT user. While the MCPTT emergency state is set on the client, all MCPTT group and private calls originated by the client will be MCPTT emergency calls, assuming the MCPTT user is authorised for MCPTT emergency calls on them.\n-\tMCPTT private emergency alert (MPEA) state: this is an internal state of the MCPTT client which in conjunction with the MCPTT emergency private call state aids in managing the MCPTT emergency state and related actions.\n-\tMCPTT emergency private call (MEPC) state: this is an internal state managed by the MCPTT client which in conjunction with the MCPTT emergency alert state aids in managing the MCPTT emergency state and related actions.\n-\tIn-progress emergency private call (IPEPC) state: indicates whether or not there is an MCPTT emergency private call in-progress for the two participants. This state is managed by the controlling MCPTT function. All private calls originated between these two participants when in an in-progress emergency private call state are MCPTT emergency private calls until this state is cancelled, whether or not the originator is in an MCPTT emergency state.\n-\tMCPTT emergency private priority (MEPP) state: this is an internal state managed by the MCPTT client which tracks the in-progress emergency private call state of the private call managed by the controlling MCPTT function. Ideally, the MCPTT client would not need to track the in-progress emergency private priority state, but doing so enables the MCPTT client to request MCPTT emergency-level priority earlier than otherwise possible. For example, if the MCPTT user wishes to join an MCPTT emergency private call and is not in the MCPTT emergency state, the MCPTT client should have emergency level priority. If it has knowledge of the in-progress emergency private priority state of the private call (i.e., the two participants), it can request priority by including a Resource-Priority header field set to the MCPTT namespace specified in IETF RFC 8101 [48], and appropriate priority level in the SIP INVITE request (or SIP re-INVITE request).\nNOTE:\tThe above states and their transitions are described in Annex G.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.3\tMCPTT emergency alerts",
                            "text_content": "MCPTT emergency alerts as defined by 3GPP TS 23.379 [3] are supported by the procedures in this specification. The following MCPTT emergency group call functionalities are specified in the present document:\n-\tMCPTT emergency alert origination; and\n-\tMCPTT emergency alert cancellation.\nMCPTT emergency alerts are supported procedurally by two general mechanisms. One mechanism is embedded within the MCPTT emergency call (both emergency private call and emergency group call using both prearranged and chat session models) signalling procedures documented in clause 10 and clause 11 of this specification. The other mechanism utilizes SIP MESSAGE requests and is documented in clause 12.\nMCPTT emergency alerts can be initiated or cancelled as options in the following signalling procedures documented in clause 10 and clause 11:\n-\tMCPTT emergency group call initiation;\n-\tMCPTT group call upgraded to MCPTT emergency call;\n-\tMCPTT emergency group call cancellation (i.e., in-progress emergency state of the group set to false);\n-\tMCPTT emergency private call initiation; and\n-\tMCPTT private call upgrade to MCPTT emergency private call.\nMCPTT emergency alerts can also be initiated or cancelled as described in the procedures of clause 12 which include:\n-\tMCPTT emergency alert initiation; and\n-\tMCPTT emergency alert cancellation (with optional cancelling of the in-progress emergency state of a group).\nWhen MCPTT emergency alerts are initiated as an option in initiating or upgrading to an MCPTT emergency group call or are initiated using SIP MESSAGE requests, they are targeted to an MCPTT group, and, if not already affiliated, will result in the initiator being implicitly affiliated to the MCPTT group. When initiated as an option in initiating or upgrading to an MCPTT emergency private call, an MCPTT emergency alert is targeted to an individual MCPTT user, not to an MCPTT group.\nKey aspects of MCPTT emergency alerts include:\n-\tMCPTT emergency (MES) state: the MCPTT client's MCPTT emergency state as described in clause G.1 is set upon initiation of an MCPTT emergency alert. While the MCPTT emergency state is set, assuming the MCPTT user has the needed authorisations, if the user initiates a private call and is authorised to do so, the MCPTT private call will be an MCPTT emergency private call. Similarly, assuming the needed authorisations, any subsequent MCPTT group call initiated by an MCPTT user with the MCPTT emergency state set will be an MCPTT emergency group call.\n-\tMCPTT emergency alert (MEA) state: the MCPTT client maintains the internal MCPTT emergency alert state (MEA) which aids in the management of the MCPTT emergency state as described in clause G.5.\n-\tMCPTT private emergency alert (MPEA) state: the MCPTT client maintains the MCPTT private emergency alert state of an MCPTT emergency alert targeted to an MCPTT user which aids in the management of the MCPTT emergency state.\n-\tIn-progress emergency group (IPEG) state : MCPTT emergency alert initiation or cancellation in and of itself does not impact the in-progress emergency state of the targeted group, which is maintained by the controlling MCPTT function, nor does it impact the priority of the EPS bearers. However, in setting the MCPTT emergency state, assuming an MCPTT user is authorised to make MCPTT emergency calls on the targeted group, any subsequent MCPTT group call the MCPTT user initiates on the group will cause the in-progress emergency state of the group to be set as described in clause G.2 and will result in upgraded priority of the EPS bearers used in the MCPTT emergency call.\n-\tAuthorisations for emergency alerts: MCPTT users need to be authorised to initiate MCPTT emergency alerts and additionally need to be authorised to cancel MCPTT emergency alerts. The parameters related to these authorisations are specified in 3GPP TS 24.483 [45] and 3GPP TS 24.484 [50].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.6.4\tMCPTT imminent peril group call",
                            "text_content": "MCPTT imminent peril group calls as defined by 3GPP TS 23.379 [3] are supported by the procedures in this specification. The following MCPTT imminent peril group calls functionalities are specified in the present document:\n-\tMCPTT imminent peril group calls origination;\n-\tupgrade of an MCPTT group call to an MCPTT imminent peril group call;\n-\tupgrade from an MCPTT imminent peril group call to an MCPTT emergency group call; and\n-\tcancellation of the in-progress imminent peril state of the group.\nKey aspects of MCPTT imminent peril include:\n-\tadjusted EPS bearer priority for all participants when the in-progress imminent peril state of the group is set whether or not they themselves initiated an imminent peril group call. For unicast bearers this is achieved by using the Resource-Priority header field as specified in IETF RFC 4412 [29] with namespaces defined for use by MCPTT specified in IETF RFC 8101 [48], and for MBMS bearers this is achieved by having the participating MCPTT function adjust the ARP (priority, PVI, PCI) and executing the Modify MBMS Bearer Procedure per 3GPP TS 29.468 [42];\n-\trestoration of normal EPS bearer priority to the call when the in-progress imminent peril group state is cancelled; and\n-\trequires the MCPTT user to be authorised to either originate or cancel an MCPTT imminent peril group call.\nRelationship to other MCPTT priority group call types:\n-\tA normal MCPTT group call can be upgraded to an MCPTT imminent peril group call;\n-\tAn MCPTT imminent peril group call can be upgraded to an MCPTT emergency group call;\n-\tWhen either an MCPTT imminent peril group call or an MCPTT emergency group call (i.e., their respective \"in-progress\" states) the group call returns to the priority designated for normal group calls, i.e., their is no direct transition from an MCPTT emergency group call to an MCPTT imminent peril group call;\n-\tMCPTT imminent peril functionality is only applicable to MCPTT group calls, not MCPTT private calls; and\n-\tMCPTT imminent peril group calls have no associated alert capabilities such as the MCPTT emergency alert capability which is associated with MCPTT emergency group calls.\nThere are a number of states that are key in managing these aspects of MCPTT imminent peril group calls, which include:\n-\tMCPTT imminent peril group (MIG) state: this is an internal state of the MCPTT client which in conjunction with the MCPTT imminent peril group call state aids the client in managing the use of the Resource-Priority header field and related actions.\n-\tMCPTT imminent peril group call (MIGC) state: this is an internal state managed by the MCPTT client which in conjunction with the MCPTT imminent peril group state aids the client in managing the use of the Resource-Priority header field and related actions.\n-\tIn-progress imminent peril group (IPIG) state: this a state of the MCPTT group which is managed by the controlling MCPTT function. While an MCPTT group is in an in-progress imminent peril group state, all participants in group calls using this group will receive elevated priority.\nThe above states and their transitions are described in Annex G.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.7\tCommunication security",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "4.7.1\tMedia security",
                            "text_content": "If a mission critical organisation requires MCPTT users to communicate using end-to-end security, a security context needs to be established between the initiator of the call and the recipient(s) of the call, prior to the establishment of media, or floor control signalling. This provides assurance to MCPTT users that no unauthorised access to communications is taking place within the MCPTT network. An MCPTT key management server (KMS) manages the security domain. For any end-point to use or access end-to-end secure communications, it needs to be provisioned with keying material associated to its identity by the KMS as specified in 3GPP TS 33.180 [78].\nFor group calls, the security context is set up at the time of creation of the group or temporary group. The group management server creates group call keying material associated with the group and distributes it to all members of the group or temporary group, in advance of the initiation of a group call as specified in 3GPP TS 24.481 [31] and 3GPP TS 33.180 [78]. The establishment of a security context for group calls has no impact on this specification.\nFor private calls, the security context is initiated at call setup. An end-to-end security context is established that is unique to the pair of users involved in the call. The procedure involves transferral of an encapsulated private call key (PCK) and private call key id (PCK-ID) from the initiator to the terminator. The PCK is encrypted using the terminator's MCPTT ID and domain-specific material provided from the terminating user's KMS. The domain-specific key material of the terminator's KMS is identified by a KMS URI stored in the terminating user profile. The domain-specific key material for all KMSs is downloaded in advance from the initiator's home KMS as described in 3GPP TS 33.180 [78]. The PCK and PCK-ID are distributed within a MIKEY payload within the SDP offer of the private call request. This payload is called a MIKEY-SAKKE I_MESSAGE, as defined in IETF RFC 6509 [75], which ensures the confidentiality, integrity and authenticity of the payload. The encoding of the MIKEY payload in the SDP offer is described in IETF RFC 4567 [47] using an \"a=key-mgmt\" attribute. The payload is signed using a key associated to the identity of the initiating user. At the terminating side, the signature is validated. If valid, the UE extracts and decrypts the encapsulated PCK. The MCPTT UE also extracts the PCK-ID. This process is described in 3GPP TS 33.180 [78]. With the PCK successfully shared between the two MCPTT UEs, the UEs are able to use SRTP/SRTCP to create an end-to-end secure session.\nFor first-to-answer calls, the security context is initiated at call setup. An end-to-end security context is established that is unique to the pair of users involved in the call. The procedure involves transferral of an encapsulated private call key (PCK) and private call key id (PCK-ID) from the terminator to the initiator. The PCK is encrypted using the originator's MCPTT ID and domain-specific material provided from the originating user's KMS. The domain-specific key material of the originator's KMS is identified by a KMS URI stored in the originator's user profile. The domain-specific key material for all KMSs is downloaded in advance from the terminator's home KMS as described in 3GPP TS 33.180 [78]. The PCK and PCK-ID are distributed within a MIKEY payload within the SDP answer of the first-to-answer call response. This payload is called a MIKEY-SAKKE I_MESSAGE, as defined in IETF RFC 6509 [75], which ensures the confidentiality, integrity and authenticity of the payload. The encoding of the MIKEY payload included in the SDP answer using an \"a=key-mgmt\" attribute is described in IETF RFC 4567 [47]. The payload is signed using a key associated to the identity of the terminating user. At the originating side, the signature is validated. If valid, the UE extracts and decrypts the encapsulated PCK. The MCPTT UE also extracts the PCK-ID. This process is described in 3GPP TS 33.180 [78]. With the PCK successfully shared between the two MCPTT UEs, the UEs are able to use SRTP/SRTCP to create an end-to-end secure session.\nEnd-to-end security is independent of the transmission path and hence is applicable to both on and off-network communications. With a security context established, the group call key and private call key can be used to encrypt media between the end-points as described in 3GPP TS 24.380 [5] clause 13.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "4.7.2\tSignalling security",
                            "text_content": "Signalling security is established between the participating MCPTT function and the MCPTT client. This allows the following signalling to be integrity and confidentiality protected through the communication path between them:\n-\tSignalling plane control (unicast only): Sensitive application data (as described in clause 4.8)\n-\tUser plane control over unicast: Floor control messages\n-\tUser plane control over multicast: Floor control messages and MBMS subchannel control messages\nNOTE 1:\tAccording to 3GPP TS 24.380 [5], currently the multicast floor control messages are Floor Idle and Floor Taken and the multicast MBMS subchannel control messages are Map Group To Bearer and Unmap Group To Bearer.\nFor unicast signalling between the participating MCPTT function and the MCPTT client, the signalling can be protected using the Client-Server Key (CSK), identified by a Client-Server Key Identifier (CSK-ID). The CSK and CSK-ID are initially uploaded from the MCPTT client to the MCPTT server within a MIKEY MIME payload within a SIP REGISTER message for service authorisation or a SIP PUBLISH message for service authorisation, as specified in clause 9.2.1.3 of 3GPP TS 33.180 [78]. The CSK is confidentiality and integrity protected to the public service identity identifying the participating MCPTT function serving the MCPTT user and signed by the MCPTT ID of the MCPTT user.\nThe CSK and CSK-ID can also be updated by the participating MCPTT function. The procedure involves the participating MCPTT function generating a new CSK and CSK-ID and distributing the new key to the MCPTT client using a CSK 'key download' SIP MESSAGE, as specified in clause 9.2.1.4 of 3GPP TS 33.180 [78]. The message contains a MIKEY MIME payload containing the CSK and CSK-ID. The CSK is confidentiality and integrity protected to the public service identity identifying the participating MCPTT function serving the MCPTT user and signed by the MCPTT ID of the MCPTT user. The client only uses a single CSK at any one time and discards the previously established CSK on receiving a new CSK.\nIn case of multicast, the protection of MBMS subchannel control messages on the general purpose MBMS subchannels can be done with MSCCKs (each identified by a corresponding MSCCK-ID), distributed during MBMS bearer announcement. Each general purpose MBMS subchannel is associated with an MSCCK and a corresponding MSCCK-ID. There can be multiple general purpose MBMS subchannels deployed, each associated with its own MSCCK and corresponding MSCCK-ID. The (MSCCK-ID, MSCCK) pair is provided for each general purpose MBMS subchannel separately.\nThe protection of floor control messages sent over MBMS subchannels can be done with Multicast Signalling Keys (MuSiK), (each identified by a corresponding (MuSiK-ID)), distributed via MuSiK download messages. The MSCCK and MuSiKs can be distributed independently of each other and in any order and can also be used independently. Signalling supports initial keying, as well as repeated re-keying and un-keying for both MSCCK and MuSiKs.\nNOTE 2:\tWhen an MCPTT client interworks with a participating MCPTT function compliant only to Release 13 of the present document, the floor control messages can be protected using the MKFC and MKFC-ID as specified in 3GPP TS 24.380 [5].\nThe MuSiK download message contains an embedded MIME payload which is the MIKEY payload containing the MuSiK and MuSiK-ID, as well as an embedded XML payload potentially containing an explicit list of MCPTT group ids to which the key applies. Both payloads are protected as described in 3GPP TS 33.180 [78], as they are transferred between the participating MCPTT function and the MCPTT client. Within the XML payload, the list of MCPTT group ids is protected as application sensitive data (see clause 4.8). Within the MIKEY payload, the MuSiK is encrypted using the MCPTT ID of the served MCPTT client. The payload is signed using a key associated to the identity of the participating MCPTT function. To distribute MuSiK, the participating MCPTT function uses the I_MESSAGE format from clause 5.2.4 of 3GPP TS 33.180 [78], which includes associated parameters. The participating function sets the Status associated parameter to values defined in clause E.6.9 of 3GPP TS 33.180 [78], namely \"Not-revoked\" when keying or rekeying and \"Revoked\" when unkeying, respectively. Upon receipt, the MCPTT client validates the signature and, if valid, the MCPTT client first examines the Status attribute and either marks the associated security functions as \"not in use\" or stores the MuSiK and the MuSiK-ID, and then replies with a success code; otherwise, the MCPTT client can reply with a failure code. if a success code is not received from the MCPTT client in response to the MuSiK download message, the participating MCPTT function starts using only unicast floor control signalling to the respective MCPTT client for the listed groups.\nFor MBMS subchannel control messages sent over the general purpose MBMS subchannel of an MBMS bearer, the MSCCK can be used. The security context is initiated when the MBMS bearer is announced to the MCPTT clients. The procedure involves the participating MCPTT function creating an MBMS subchannel control key (MSCCK) and a  corresponding key identifier (MSCCK-ID) associated with the MBMS bearer when the MBMS bearer is activated, and then transferring the MSCCK and the MSCCK-ID associated with the MBMS bearer to served MCPTT clients using SIP signalling. The MSCCK is encrypted using the MCPTT ID of the served MCPTT client and domain-specific material provided from the KMS. The MSCCK and the MSCCK-ID associated with the MBMS bearer are distributed within a MIKEY payload within the SDP describing the general purpose MBMS subchannel of the MBMS bearer. This payload is called a MIKEY-SAKKE I_MESSAGE, as defined in IETF RFC 6509 [75], which ensures the confidentiality, integrity and authenticity of the payload. The encoding of the MIKEY payload in the SDP is described in IETF RFC 4567 [47] using an \"a=key-mgmt\" attribute. The payload is signed using a key associated to the identity of the participating MCPTT function. To distribute MSCCK, the participating MCPTT function uses the I_MESSAGE format from clause 5.2.4 of 3GPP TS 33.180 [78], which includes associated parameters. The participating function sets the Status associated parameter to values defined in clause E.6.9 of 3GPP TS 33.180 [78], namely \"Not-revoked\" when keying or rekeying and \"Revoked\" when unkeying, respectively. Upon receipt, the MCPTT client validates the signature and, if the signature is found valid and the I_MESSAGE contains a Status attribute, the MCPTT client first examines the Status attribute and either marks the associated security functions as \"not in use\" or extracts and stores the encapsulated MSCCK and the corresponding MSCCK-ID. The decrypted key is used as described in 3GPP TS 33.180 [78]. With the MSCCK successfully shared between the participating MCPTT function and the served UEs, the participating MCPTT function is able to securely send MBMS subchannel control messages to the MCPTT clients.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "4.8\tProtection of sensitive application data",
                    "description": "",
                    "summary": "",
                    "text_content": "In certain deployments, for example, in the case that the MCPTT operator uses the underlying SIP core infrastructure from the carrier operator, the MCPTT operator can prevent certain sensitive application data from being visible in the clear to the SIP layer. The following data are classed as sensitive application data:\n-\tMCPTT ID;\n-\tMCPTT group ID;\n-\tuser location information;\n-\temergency, alert and imminent-peril indicators;\n-\taccess token (containing the MCPTT ID);\n-\tMCPTT client ID; and\n-\tfunctional alias.\nThe above data is transported as XML content in SIP messages. in XML elements or XML attributes.\nData is transported in attributes in the following circumstances in the procedures in the present document:\n-\tan MCPTT ID, an MCPTT Group ID, and an MCPTT client ID in an XML document published in SIP PUBLISH request for affiliation according to IETF RFC 3856 [51];\n-\tan MCPTT ID or an MCPTT Group ID in XML document notified in a SIP NOTIFY request for affiliation according to IETF RFC 3856 [51];\n-\tan MCPTT ID and functional alias in an XML document published in SIP PUBLISH request for functional alias management according to IETF RFC 3856 [51];\n-\tan MCPTT ID and functional alias in an XML document notified in a SIP NOTIFY request for functional alias management according to IETF RFC 3856 [51];\n-\tan MCPTT ID in application/resource-lists+xml document included in an SIP INVITE request setting up a private call according to IETF RFC 5366 [20];\n-\tan MCPTT ID in application/resource-lists+xml document included in an SIP INVITE request setting up a group call to a temporary group involving a non-controlling function that works in \"Trusted Mode\" according to IETF RFC 5366 [20], whereby the participants are returned to the controlling function in a MIME body of a SIP 403 (Forbidden) with the P-Refused-URI-List header field according to IETF RFC 5318 [36];\n-\tan MCPTT ID in XML document provided in SIP NOTIFY request of a conference event package according to IETF RFC 4575 [30]; and\n-\tan MCPTT ID or MCPTT Group ID in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml document according to IETF RFC 5366 [20], included in a SIP REFER request when using a pre-established session (the application/resource-lists+xml MIME body is pointed to by a Cid-URL as specified in IETF RFC 2392 [62] contained in the Refer-To header field of the SIP REFER request);\n-\tan MCPTT ID in XML document provided in SIP INFO request according to IETF RFC 6086 [64], after receiving the SIP ACK for a SIP 200 (OK) with the Warning header field set with the Warning text \"111 group call proceeded without all required group members\".\n3GPP TS 33.180 [78] describes a method to provide confidentiality protection of sensitive application data in elements by using XML encryption (i.e. xmlenc) and in attributes by using an attribute confidentiality protection scheme described in clause 6.6.2.3 of the present document. Integrity protection can also be provided by using XML signatures (i.e. xmlsig).\nProtection of the data relies on a shared XML protection key (XPK) used to encrypt and sign data:\n-\tbetween the MCPTT client and the MCPTT server, the XPK is a client-server key (CSK); and\n-\tbetween MCPTT servers and between MCPTT domains, the XPK is a signalling protection key (SPK).\nThe CSK (XPK) and a key-id CSK-ID (XPK-ID) are generated from keying material provided by the key management server. Identity based public key encryption based on MIKEY-SAKKE is used to transport the CSK between SIP end-points. The encrypted CSK is transported from the MCPTT client to the MCPTT server when the MCPTT client performs service authorisation as described in clause 7 and is also used during service authorisation to protect the access token.\nThe SPK (XPK) and a key-id SPK-ID (XPK-ID) are directly provisioned in the MCPTT servers.\nConfiguration in the MCPTT client and MCPTT server is used to determine whether one or both of confidentiality protection and integrity protection are required.\nThe following four examples give a brief overview of the how confidentiality and integrity protection is applied to application data in this specification.\nEXAMPLE 1:\tPseudo code showing how confidentiality protection is represented in the procedures in the document for sensitive data sent by the originating client.\nIF configuration is set for confidentiality protection of sensitive data\nTHEN\nEncrypt data element using the CSK (XPK) by following TS 33.180;\nInclude in an <EncryptedData> element of the XML MIME body according to TS 33.180:\n(1) the encryption method;\n(2) the key-id (XPK-ID);\n(3) the cipher data;\nEncrypt URIs in attribute using the CSK (XPK) by following clause 6.6.2.3;\nELSE\ninclude application data into XML MIME body in clear text;\nENDIF;\n\nEXAMPLE 2:\tPseudo code showing how integrity protection is represented in the procedures in the present document for data sent by the originating client.\nIF configuration is set for integrity protection of application data\nTHEN\nUse a method to hash the content as specified in TS 33.180;\nGenerate a signature for the hashed content using the CSK (XPK) as specified in TS 33.180;\nInclude within a <Signature> XML element of the XML MIME body according to TS 33.180:\n(1) a cannonicalisation method to be applied to the signed information;\n(2) the signature method used for generating the signature;\n(3) a reference to the content to be signed;\n(4) the hashing method used;\n(5) the hashed content;\n(6) the key-id (XPK-ID);\n(7) the signature value;\nENDIF;\n\nEXAMPLE 3:\tPseudo code showing how confidentiality protection is represented in the procedures in the present document at the server side when receiving encrypted content.\nIF configuration is set for confidentiality protection of sensitive data\nTHEN\nCheck that the XML content contains the <EncryptedData> element;\nCheck that the XML document contains a URI with the domain name for MCPTT confidentiality protection;\nReturn an error if the <EncryptedData> element or domain name for MCPTT confidentiality protection are not found;\nOtherwise:\n(1) obtain the CSK (XPK) using the CSK-ID (XPK-ID) in the received XML body;\n(2) for encrypted data in elements, decrypt the data elements using the CSK as specified in TS 33.180 as required;\n(3) for encrypted URIs in attributes, decrypt the URIs using the CSK as specified in clause 6.6.2.3;\nENDIF;\n\nEXAMPLE 4:\tPseudo code showing how integrity protection is represented in the procedures in the present document at the server side when receiving signed content.\nIF configuration is set for integrity protection of application data\nTHEN\nCheck that the XML content contains the <Signature> element;\nReturn an error if the <Signature> element is not found;\nOtherwise:\n(1) obtain the CSK (XPK) using the CSK-ID (XPK-ID) in the received XML body;\n(2) verify the signature of the content using the CSK;\nReturn an error if the validation of the signature fails;\nIF validation of the signature passes\nTHEN\ndecrypt any data found in <EncryptedData> elements;\ndecrypt any encrypted URIs found in attributes;\nENDIF;\nENDIF;\n\nThe content can be re-encrypted and signed again using the SPK between MCPTT servers.\nThe following examples show the difference between normal and encrypted data content. In this example consider the MCPTT client initiating a prearranged group session.\nEXAMPLE 5:\tapplication/vnd.3gpp.mcpttinfo+xml MIME body represented with data elements in the clear:\nContent-Type: application/vnd.3gpp.mcptt-info+xml\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</session-type>\n<mcptt-request-uri type=\"Normal\">\n<mcpttURI>sip:group123@mcpttoperator1.com></mcpttURI>\n</mcptt-request-uri>\n</mcptt-Params>\n</mcptt-info>\n\nEXAMPLE 6:\tapplication/vnd.3gpp.mcpttinfo+xml MIME body represented with the <mcptt-request-uri> encrypted:\nContent-Type: application/vnd.3gpp.mcptt-info+xml\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</session-type>\n<mcptt-request-uri type=\"Encrypted\">\n<EncryptedData xmlns='http://www.w3.org/2001/04/xmlenc#'\nType='http://www.w3.org/2001/04/xmlenc#Content'>\n<EncryptionMethod Algorithm=\"\"/>\n<ds:KeyInfo>\n<ds:KeyName>base64XpkId</KeyName>\n</ds:KeyInfo>\n<CipherData>\n<CipherValue>A23B45C5657689090</CipherValue>\n</CipherData>\n</EncryptedData>\n</mcptt-request-uri>\n</mcptt-Params>\n</mcptt-info>\n\nEXAMPLE 7:\tapplication/pidf+xml MIME body represented with clear URIs in attributes:\nContent-Type: application/pidf+xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<presence entity=\"sip:somebody@mcptt.org\">\n<tuple id=\"acD4rhU87bK\">\n<status>\n<affiliation group=\"sip:thegroup@mcptt.org\"/>\n</status>\n</tuple>\n</presence>\n\nEXAMPLE 8:\tapplication/pidf+xml MIME body represented with encrypted URIs in attributes:\nContent-Type: application/pidf+xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<presence entity=\"sip:c4Hrt45XG8IohRFT67vfdr3V;iv=45RtfVgHY23k8Ihy;xpk-id=b7UJv9;alg=128-aes-gcm@mc1-encryption.3gppnetwork.org\">\n<tuple id=\"acD4rhU87bK\">\n<status>\n<affiliation group=\"sip:98yudFG45tx_89TYGedb4ujF ;iv=FGD567kjhfH7d4-D;key-id=eV9kl7;alg=128-aes-gcm@mc1-encryption.3gppnetwork.org\"/>\n</status>\n</tuple>\n</presence>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.9\tPre-established session",
                    "description": "",
                    "summary": "",
                    "text_content": "When establishing a pre-established session, the MCPTT client negotiates the media parameters, including establishing IP addresses and ports using interactive connectivity establishment (ICE) as specified in IETF RFC 8445 [89] and IETF RFC 8839 [90] with the participating MCPTT function, prior to using the pre-established session for establishing MCPTT calls with other MCPTT users. The procedures for establishing, modifying and releasing a pre-established session are defined in clause 8.\nThe pre-established session can later be used in MCPTT calls. This avoids the need to negotiate media parameters (including evaluating ICE candidates) and reserving bearer resources during the MCPTT call establishment that results in delayed MCPTT call establishment.\nThe use of pre-established session on the origination side is compatible with the use of on demand session on the termination side. The use of pre-established session on the termination side is compatible with the use of on demand session on the origination side.\nThe MCPTT client procedures for:\n-\tleaving an MCPTT call using a pre-established session that was initiated by the MCPTT client are defined in clause 6.2.4.2;\n-\treleasing a MCPTT call using a pre-established session that was initiated by the MCPTT client are defined in clause 6.2.5.2;\n-\testablishing a pre-arranged group call using a pre-established session are defined in clause 10.1.1.2.2;\n-\trejoining a pre-arranged group call using a pre-established session are defined in clause 10.1.1.2.4.2;\n-\tjoining a chat MCPTT group call using a pre-established session are defined in clause 10.1.2.2.2;\n-\testablishing a private call using a pre-established session are defined in clause 11.1.1.2.2; and\n-\treleasing a private call using a pre-established session are defined in clause 11.1.3.1.2.\nThe participating MCPTT function procedures for:\n-\testablishing a MCPTT session using automatic commencement mode are defined in clause 6.3.2.2.5.3;\n-\testablishing a MCPTT session using manual commencement mode are defined in clause 6.3.2.2.6.3;\n-\treleasing a MCPTT call using a pre-established session are defined in clause 6.3.2.2.8.2;\n-\testablishing a pre-arranged group call using a pre-established session are defined in clause 10.1.1.3.1.2;\n-\treleasing a pre-arranged group call using a pre-established session are defined in clause 10.1.1.3.3.2;\n-\trejoining a pre-arranged group call using a pre-established session are defined in clause 10.1.1.3.5.2;\n-\testablishing a MCPTT group call using a pre-established session are defined in clause 10.1.2.3.2;\n-\toriginating a private call from a MCPTT client using a pre-established session are defined in clause 11.1.1.3.1.2;\n-\testablishing a private call to a MCPTT client using a pre-established session are defined in clause 11.1.1.3.2;\n-\treleasing a private call initiated by the served MCPTT client using a pre-established session are defined in clause 11.1.3.2.1.2; and\n-\treleasing a private call initiated by the remote MCPTT client using a pre-established session are defined in clause 11.1.3.2.2.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.10\tMCPTT client ID",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCPTT client assigns the MCPTT client ID when the MCPTT client is used for the first time. The MCPTT client generates the MCPTT client ID as specified in clause 4.2 of IETF RFC 4122 [67].\nThe MCPTT client preserves the MCPTT client ID:\n-\twhile the MCPTT client is SIP registered as specified in 3GPP TS 24.229 [4];\n-\twhile the MCPTT client is not SIP registered as specified in 3GPP TS 24.229 [4] and the UE serving the MCPTT client is switched on;\n-\twhile the UE serving the MCPTT client is switched off; and\n-\twhile the UE serving the MCPTT client is power-cycled.\nNOTE:\tMCPTT client ID is not preserved when the UE is reset to factory settings.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.11\tOff-network MCPTT",
                    "description": "",
                    "summary": "",
                    "text_content": "Off-network services are available for the user if the value of \"/<x>/<x>/OffNetwork/Authorised\" leaf node present in user profile as specified in 3GPP TS 24.483 [45] is set to \"true\".\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "4.12\tBroadcast Group Calls",
                    "description": "",
                    "summary": "",
                    "text_content": "A broadcast group call is a group call where the initiating MCPTT user expects no response from the other MCPTT users, so that when the user's transmission is complete, so is the call. The functionality in the present release of the specification for broadcast group calls is not compliant to the requirements for user-broadcast group and group-broadcast group calls as specified in 3GPP TS 22.179 [2], 3GPP TS 22.280 [76] and 3GPP TS 23.379 [3]. In the present release of the specification, a broadcast group call can be initiated by an MCPTT user on any MCPTT group that the MCPTT user is part of.\nNOTE 1:\tConfiguration related to the authorisation to create a user-broadcast group or a group-broadcast exists in the user profile document as specified in 3GPP TS 24.484 [50], but is not used by any procedures in 3GPP TS 24.481 [31] in the current release, as the ability for an authorised user to create user-broadcast groups and group-broadcast groups is not provided in the current release.\nNOTE 2:\tConfiguration related to broadcast group hierarchies can be found in the group document as specified in 3GPP TS 24.481 [31] and in the service configuration document as specified in 3GPP TS 24.484 [50]. However, this configuration is not used by any procedures in 3GPP TS 24.380 [5] in the current release.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "5\tFunctional entities",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "5.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause associates the functional entities with the MCPTT roles described in the stage 2 architecture document (see 3GPP TS 23.379 [3]).\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.2\tMCPTT client",
                    "description": "",
                    "summary": "",
                    "text_content": "To be compliant with the procedures in the present document, an MCPTT client shall:\n-\tact as the user agent for all MCPTT application transactions (e.g. initiation of a group call); and\n-\tsupport handling of the MCPTT client ID as described in clause 4.10.\nTo be compliant with the on-network procedures in the present document, an MCPTT client shall:\n-\tsupport the MCPTT client on-network procedures defined in 3GPP TS 23.379 [3];\n-\tsupport the GCS UE procedures defined in 3GPP TS 23.468 [57] for unicast delivery, MBMS delivery and service continuity;\n-\tsupport 5G multicast-broadcast services defined in 3GPP TS 23.247 [91];\n-\tact as a SIP UA as defined in 3GPP TS 24.229 [4];\n-\tgenerate SDP offer and SDP answer in accordance with 3GPP TS 24.229 [4] and clause 6.2;\n-\tact as a floor participant responsible for floor requests and implement the on-network procedures for floor requests as specified in 3GPP TS 24.380 [5];\n-\tfor registration and service authorisation, implement the procedures specified in clause 7.2;\n-\tfor pre-established sessions, implement the procedures specified in clause 8.2.1, clause 8.3.1, clause 8.4.1, and the procedures specified in 3GPP TS 24.380 [5];\n-\tfor affiliation, implement the procedures specified in clause 9.2;\n-\tfor functional alias management, implement the procedures specified in clause 9A.2;\n-\tfor group call functionality (including broadcast, emergency and imminent peril), implement the MCPTT client procedures specified in clause 10.1; and\n-\tfor private call functionality (including emergency), implement the MCPTT client procedures specified in clause 11.1;\n-\tfor emergency alert, implement the procedures specified in clause 12.1;\n-\tfor location reporting, implement the procedures specified in clause 13.3;\n-\tfor MBMS transmission usage, implement the procedures in clause 14.3; and\n-\tfor MBS transmission usage, implement the procedures in clause 14B.3.\nTo be compliant with the off-network procedures in the present document, an MCPTT client shall:\n-\tsupport the off-network procedures defined in 3GPP TS 23.379 [3];\n-\tsupport the MCPTT off-network protocol (MONP) defined in clause 15;\n-\tact as a floor participant for floor requests and implement the off-network procedures for floor requests as specified in 3GPP TS 24.380 [5];\n-\tact as a floor control server providing distributed floor control and implement the off-network procedures for floor control as specified in 3GPP TS 24.380 [5];\n-\timplement the procedures for ProSe direct discovery for public safety use as specified in 3GPP TS 24.334 [28];\n-\timplement the procedures for one-to-one ProSe direct communication for Public Safety use as specified in 3GPP TS 24.334 [28];\n-\timplement the procedures for one-to-many ProSe direct communication for Public Safety use as specified in 3GPP TS 24.334 [28];\n-\tfor group call functionality (including emergency and imminent peril), implement the MCPTT client procedures specified in clause 10.2;\n-\tfor broadcast group call functionality implement the procedures specified in clause 10.3; and\n-\tfor private call functionality (including emergency), implement the MCPTT client procedures specified in clause 11.2.\nTo be compliant with the service continuity procedures in the present document, an MCPTT client shall:\n-\timplement the registration requirements for service continuity as specified in clause 7.2.1; and\n-\timplement the procedures specified in clause 14A.\nTo be compliant with the on-network and off-network procedures in the present document requiring end-to-end private call security key distribution, an MCPTT client shall support the procedures specified in 3GPP TS 33.180 [78].\nTo be compliant with the procedures for confidentiality protection of XML elements in the present document, the MCPTT client shall implement the procedures specified in clause 6.6.2.\nTo be compliant with the procedures for integrity protection of XML MIME bodies in the present document, the MCPTT client shall implement the procedures specified in clause 6.6.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.3\tMCPTT server",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.3.1\tGeneral",
                            "text_content": "An MCPTT server can perform the controlling role for group calls and private calls as defined in 3GPP TS 23.379 [3].\nAn MCPTT server can perform the participating role for group calls and private calls as defined in 3GPP TS 23.379 [3].\nAn MCPTT server can perform a non-controlling role for temporary group calls involving groups from multiple MCPTT systems as specified in 3GPP TS 23.379 [3].\nAn MCPTT server can perform a non-controlling role for temporary group calls involving groups only from the primary MCPTT system.\nAn MCPTT server performing the participating role can serve an originating MCPTT user.\nAn MCPTT server performing the participating role can serve a terminating MCPTT user.\nThe same MCPTT server can perform the participating role and controlling role for the same group session.\nThe same MCPTT server can perform the participating role and non-controlling role for the same group session.\nWhen referring to the procedures in the present document for the MCPTT server acting in a participating role for the served user, the term, \"participating MCPTT function\" is used.\nWhen referring to the procedures in the present document for the MCPTT server acting in a controlling role for the served user, the term \"controlling MCPTT function\" is used.\nWhen referring to the procedures in the present document for the MCPTT server acting in a non-controlling role for a group call, the term \"non-controlling MCPTT function of an MCPTT group\" is used.\nTo be compliant with the procedures in the present document, an MCPTT server shall:\n-\tsupport the MCPTT server procedures defined in 3GPP TS 23.379 [3];\n-\timplement the role of an AS performing 3rd party call control acting as a routing B2BUA as defined in 3GPP TS 24.229 [4];\n-\tsupport the GCS AS procedures defined in 3GPP TS 23.468 [57] for unicast delivery, MBMS delivery and service continuity;\n-\tsupport 5G multicast-broadcast services defined in 3GPP TS 23.247 [91];\n-\tgenerate SDP offer and SDP answer in accordance with 3GPP TS 24.229 [4] and clause 6.3;\n-\timplement the role of a centralised floor control server and implement the on-network procedures for floor control as specified in 3GPP TS 24.380 [5];\n-\tfor registration and service authorisation, implement the procedures specified in clause 7.3;\n-\tfor pre-established sessions, implement the procedures specified in clause 8.2.2, clause 8.3.2, clause 8.4.2 and the procedures specified in 3GPP TS 24.380 [5];\n-\tfor affiliation, implement the procedures specified in clause 9.2.2;\n-\tfor functional alias management, implement the procedures specified in clause 9A.2.2;\n-\tfor group call functionality (including broadcast, emergency and imminent peril), implement the MCPTT server procedures specified in clause 10.1;\n-\tfor private call functionality (including emergency), implement the MCPTT server procedures specified in clause 11.1;\n-\tfor priority sharing, implement the MCPTT server procedures in clause 6.7; and\n-\tfor MBMS transmission usage, implement the procedures in clause 14.2; and\n-\tfor MBS transmission usage, implement the procedures in clause 14B.2.\nTo be compliant with the procedures in the present document requiring the distribution of private call keying material between MCPTT clients as specified in 3GPP TS 33.180 [78], an MCPTT server shall ensure that the keying material is copied from incoming SIP messages into the outgoing SIP messages.\nTo be compliant with the procedures for confidentiality protection of XML elements in the present document, the MCPTT server shall implement the procedures specified in clause 6.6.2.\nTo be compliant with the procedures for integrity protection of XML MIME bodies in the present document, the MCPTT server shall implement the procedures specified in clause 6.6.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.2\tFunctional connectivity models",
                            "text_content": "The following figures give an overview of the connectivity between the different functions of the MCPTT server as described in clause 5.3.1.\nNOTE:\tSeparate boxes are shown for each of the functions of the MCPTT server. In each MCPTT system, these functions can be physically combined into one MCPTT server or can be implemented on more than one MCPTT server. For example, there could be an instantiation of an MCPTT server that only serves as a controlling MCPTT function, but not as a participating MCPTT function for any MCPTT clients. When an MCPTT server supports more than one function, then sending requests from one function to another does not incur a traversal of the underlying IMS SIP core network.\nFigure 5.3.2-1 shows the basic functions of the MCPTT server when operating within the primary MCPTT system.\nThe figure depicts the primary MCPTT server in the primary MCPTT system, which is responsible for managing the network's traffic and ensuring efficient communication. It includes various functions such as traffic management, network control, and security. The server is designed to handle a large number of connections and ensure smooth operation of the network.\nFigure 5.3.2-1: Functions of the MCPTT server in the primary MCPTT system\nFigure 5.3.2-2 shows the use of the non-controlling MCPTT function of an MCPTT group within the primary MCPTT system. This can occur due to group re-grouping of groups within the same MCPTT system, where the MCPTT server(s) of one or more of the constituent groups are not controlled by the same controlling MCPTT function as that of the temporary group. The non-controlling MCPTT function of an MCPTT group either provide the identities of the users of the group to the controlling MCPTT function, or the non-controlling MCPTT function of an MCPTT group can invite the users of the group on behalf of the controlling MCPTT function.\nThe non-controlling function operates in the primary MCPTT system, as depicted in Figure 5.3.2-2. This function is responsible for managing the control and communication between the primary and secondary control loops. It ensures the proper functioning of the system by monitoring and adjusting the control parameters to maintain the desired system state.\nFigure 5.3.2-2: The non-controlling function operating in the primary MCPTT system\nFigure 5.3.2-3 shows the roles of the MCPTT server in a mutual aid relationship between a primary MCPTT system and a partner MCPTT system. Here, the controlling MCPTT function is in the primary MCPTT system and the called user is homed in a partner MCPTT system.\nThe figure depicts a mutual aid relationship between the primary MCPTT system and a partner MCPTT system, with the controlling MCPTT function in the primary MCPTT system. The system is designed to ensure redundancy and failover reliability, with redundant paths shown in dashed lines. The layered design aligns with SDN principles.\nFigure 5.3.2-3: Mutual aid relationship between the primary MCPTT system and a partner MCPTT system with the controlling MCPTT function in the primary MCPTT system\nFigure 5.3.2-4 shows the roles of the MCPTT server in a mutual aid relationship between a primary MCPTT system and a partner MCPTT system. Here, the controlling MCPTT function is in the partner MCPTT system.\nThe figure depicts a mutual aid relationship between the primary MCPTT system and a partner MCPTT system, with the controlling MCPTT function in the partner MCPTT system. The primary MCPTT system is responsible for managing the primary network, while the partner MCPTT system is responsible for managing the secondary network. The figure illustrates the communication between the two systems, showing the flow of data and the coordination of their functions.\nFigure 5.3.2-4: Mutual aid relationship between the primary MCPTT system and a partner MCPTT system with the controlling MCPTT function in the partner MCPTT system\nFigure 5.3.2-5 shows the roles of the MCPTT server in a mutual aid relationship between a primary MCPTT system and a partner MCPTT with the use of a non-controlling MCPTT function of an MCPTT group within the partner MCPTT system. This can occur due to group re-grouping where the MCPTT server(s) of one or more of the constituent groups are homed on the partner system. If the primary MCPTT system and partner MCPTT system operate in a trusted mutual aid relationship, then the non-controlling MCPTT function of an MCPTT group can provide the identities of the users of the group to the controlling MCPTT function. If the primary MCPTT system and partner MCPTT system operate in an untrusted mutual aid relationship, then the non-controlling MCPTT function of an MCPTT group invites the users of the group on behalf of the controlling MCPTT function.\nThe figure depicts a mutual aid relationship between the primary MCPTT system and a partner MCPTT system, illustrating the use of a non-controlling MCPTT function of an MCPTT group in the partner MCPTT system. This relationship is crucial for ensuring the reliability and efficiency of the system.\nFigure 5.3.2-5: Mutual aid relationship between the primary MCPTT system and a partner MCPTT system involving the use of a non-controlling MCPTT function of an MCPTT group in the partner MCPTT system\nFigure 5.3.2-6 illustrates a functional connectivity model involving multiple partner systems where the partner system that owns the group does not home any of the group members.\nThe figure depicts a mutual aid relationship between the primary MCPTT system and more than one partner MCPTT system, illustrating the coordination and collaboration between these systems to ensure efficient and reliable communication.\nFigure 5.3.2-6: : Mutual aid relationship between the primary MCPTT system and more than one partner MCPTT system\nOther functional connectivity models can exist.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.3\tFailure case",
                            "text_content": "When initiating a failure response to any received request, depending on operator policy, the MCPTT server may insert a SIP Response-Source header field with an \"fe\" header field parameter constructed with the URN namespace \"urn:3gpp:fe\", the fe-id part of the URN set to \"as\" and the \"role\" header field parameter set to \"pf-mcptt-server\", \"cf-mcptt-server\" or \"ncf-mcptt-server\" depending on the current role endorsed by the MCPTT server and in accordance with clause 7.2.17 of 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.4\tManagement of MBMS bearers",
                            "text_content": "When providing services over MBMS, an MCPTT server acting in the participating MCPTT function role shall:\n-\tallocate TMGIs and activate MBMS bearers in MBMS service areas to be used for MCPTT media and media control distribution via multicast, per 3GPP TS 23.468 [57] and 3GPP TS 29.468 [42];\n-\tdeactivate MBMS bearers and deallocate TMGIs when no longer necessary, per 3GPP TS 23.468 [57] and 3GPP TS 29.468 [42];\n-\thandle MBMS bearers related notifications per 3GPP TS 23.468 [57] and 3GPP TS 29.468 [42]; and\n-\tadjust the priority / pre-emption characteristics of MBMS bearers, as appropriate, in response to relevant events (e.g. emergency or imminent peril call), using procedures specified in per 3GPP TS 23.468 [57] and 3GPP TS 29.468 [42].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.3.5\tManagement of MBS sessions",
                            "text_content": "When providing services over MBS, an MCPTT server acting in the participating MCPTT function role shall:\n-\tcreate MBS sessions in MBS service areas to be used for MCPTT media and media control distribution via multicast and broadcast, per 3GPP TS 23.247 [91];\n-\tdelete the MBS sessions when no longer necessary, per 3GPP TS 23.247 [91];\n-\tupdate the MBS sessions to be used for updating the MBS service areas and/or MBS Service Information, per 3GPP TS 23.247 [91].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.4\tMCPTT UE-to-network relay",
                    "description": "",
                    "summary": "",
                    "text_content": "To be compliant with the procedures in the present document for service continuity, an MCPTT UE- to-network relay shall support the ProSe UE-to-network relay procedures as specified in 3GPP TS 24.334 [28] and 3GPP TS 23.379 [3].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "5.5\tMCPTT gateway server",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.5.1\tGeneral",
                            "text_content": "To allow interconnection between MCPTT system in different trust domains, MC Gateway Servers can be optionally added on the path between controlling and participating MCPTT functions.\nAn MCPTT gateway server acts as a SIP and HTTP proxy for signalling with a partner MCPTT system in a different trust domain.\nAn MCPTT gateway server acts as an application and security gateway with a partner MCPTT system in a different trust domain.\nAn MCPTT gateway server provides topology hiding to the partner MCPTT system in a different trust domain.\nAn MCPTT gateway server enforces local policies and local security.\nAn MCPTT gateway server can be an exit point from its MCPTT system to a partner MCPTT system in a different trust domain, an entry point to its MCPTT system from a partner MCPTT system in a different trust domain, or both.\nAn MCPTT gateway server is transparent to MCPTT controlling and participating servers. When required for interconnection, MC gateway servers URIs are known and used by MCPTT servers in place of the PSIs of the interconnected MCPTT server. The MCPTT server does not need to know if it finally addresses directly an MCPTT controlling function or an intermediate MCPTT gateway server.\nTo be compliant with the procedures in the present document, an MCPTT gateway server shall:\n-\tsupport the MC gateway server procedures defined in 3GPP TS 23.280 [82] and 3GPP TS 23.379 [3]; and\n-\tsupport the MC gateway server procedures defined in 3GPP TS 33.180 [78];\n-\timplement the procedures specified in clause 6.8\nTo be compliant with the procedures for confidentiality protection in the present document, the MCPTT gateway server shall implement the procedures specified in clause 6.6.2, acting on behalf of the MCPTT server when sending or receiving confidentiality protected content to or from an MCPTT server in another trust domain.\nTo be compliant with the procedures for integrity protection of XML MIME bodies in the present document, the MCPTT gateway server shall implement the procedures specified in clause 6.6.3, acting on behalf of the MCPTT server when sending or receiving integrity protected content to or from an MCPTT server in another trust domain.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.5.2\tFunctional connectivity models",
                            "text_content": "The following figures give an overview of the connectivity between the different functions of the MCPTT server in different trust domains when MCPTT gateway servers are used.\nFigure 5.5.2-1 shows the roles of the MCPTT servers in a non trusted relationship between a primary MCPTT system and a partner MCPTT system. Here, the originating participating MCPTT function and the controlling MCPTT function are in the primary MCPTT system and a terminating participating MCPTT function is in a partner MCPTT system.\nThe figure depicts a non-trusted relationship between the primary MCPTT system and a partner MCPTT system, with a terminating participating MCPTT function in the partner MCPTT system. This relationship is crucial for ensuring the security and integrity of the system.\nFigure 5.5.2-1: Non trusted relationship between the primary MCPTT system and a partner MCPTT system with a terminating participating MCPTT function in the partner MCPTT system\nFigure 5.5.2-2 shows the roles of the MCPTT servers in a non trusted relationship between a primary MCPTT system and a partner MCPTT system. Here, the originating participating MCPTT function is in the primary MCPTT system and the controlling MCPTT function and a terminating participating MCPTT function are in a partner MCPTT system.\nThe figure depicts a non-trusted relationship between the primary MCPTT system and a partner MCPTT system with a controlling MCPTT function in the partner MCPTT system. The figure illustrates the communication paths and the control mechanisms involved in the system.\nFigure 5.5.2-2: Non trusted relationship between the primary MCPTT system and a partner MCPTT system with a controlling MCPTT function in the partner MCPTT system\nOther functional connectivity models for non trusted relationship exist, based on the same principle of use of MCPTT gateway servers, e.g. with non-controlling MCPTT functions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "5.6\tMCPTT gateway UE",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "5.6.1\tGeneral",
                            "text_content": "An MCPTT gateway UE enables MCPTT service access for a MCPTT user utilizing non-3GPP device connected to the MCPTT gateway UE via non-3GPP access network.\nNOTE:\t3GPP device unable to use 3GPP access is considered a non-3GPP device in this context.\nAn MCPTT gateway UE provides the following MCPTT gateway functions:\n-\tAuthentication and authorization of the MC gateway clients;\n-\tRelay of signaling between an MCPTT client in the non-3GPP device and MCPTT servers; and\n-\tMedia plane including floor control forwarding between an MCPTT client in the non-3GPP device and MCPTT servers.\nThe MCPTT server shall authorize the MCPTT gateway UE to provide MCPTT gateway functions.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "5.6.2\tFunctional connectivity models",
                            "text_content": "The following figures give an overview of the connectivity between the different functional entities when using a MCPTT gateway. One MCPTT gateway client can only interact with one MCPTT gateway UE server at the same time.\nNOTE:\tMC Gateway clients for other service types (e.g. MCVideo or MCData) can interact the MC gateway UE supporting the corresponding service types. MC gateway UEs for different service types can be deployed in the same UE.\nFigure 5.6.2-1 shows the scenario when the MCPTT client resides in the MCPTT gateway UE. How the non-3GPP device interacts with the MCPTT client over a non-3GPP access technology is not part of the current specification.\nThe figure depicts a network setup with a non-3GPP device, a MCPTT gateway UE, and a MCPTT server. The MCPTT server is connected to the MCPTT client located in the MCPTT gateway UE. This setup illustrates the relationship between the non-3GPP device, the MCPTT gateway UE, and the MCPTT server, highlighting the communication between these devices and the MCPTT server.\nFigure 5.6.2-1: Relationship between non-3GPP device, MCPTT gateway UE and the MCPTT server with the MCPTT client located in the MCPTT gateway UE\nFigure 5.6.2-2 shows the scenario when the MCPTT client resides in the non-3GPP device that uses a non-3GPP access technology to access the MCPTT service. In this case the MCPTT gateway UE will relay the signaling between the MCPTT client and the participating MCPTT server as well as forward the media plane.\n\nThe figure depicts a network setup with a non-3GPP device, a MCPTT gateway UE, and a MCPTT server. The MCPTT server is connected to the MCPTT client located in the non-3GPP device. The relationship between the non-3GPP device, the MCPTT gateway UE, and the MCPTT server is shown in the figure, illustrating the communication between these devices.\nFigure 5.6.2-2: Relationship between non-3GPP device, MCPTT gateway UE and the MCPTT server with the MCPTT client located in the non-3GPP device\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "6\tCommon procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "6.1\tIntroduction",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the common procedures for each functional entity as specified.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.2\tMCPTT client procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.2.0\tDistinction of requests at the MCPTT client",
                            "text_content": "The MCPTT client needs to distinguish between the following SIP MESSAGE requests:\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\" and including an XML body containing a Location root element containing a Configuration element. Such requests are known as \"SIP MESSAGE request for location report configuration\" in the present document;\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\" and including an XML body containing a Location root element containing a Request element. Such requests are known as \"SIP MESSAGE request for location report request\" in the present document;\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"private-call-call-back-request\". Such requests are known as \"SIP MESSAGE request for private call call-back request for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"private-call-call-back-cancel-request\". Such requests are known as \"SIP MESSAGE request for private call call-back cancel request for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <response-type> element set to a value of \"private-call-call-back-response\". Such requests are known as \"SIP MESSAGE request for private call call-back response for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <response-type> element set to a value of \"private-call-call-back-cancel-response\". Such requests are known as \"SIP MESSAGE request for private call call-back cancel response for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"group-selection-change-request\". Such requests are known as \"SIP MESSAGE request for group selection change request for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <response-type> element set to a value of \"group-selection-change-response\". Such requests are known as \"SIP MESSAGE request for group selection change response for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"remotely-initiated-group-call-request\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call request for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <response-type> element set to a value of \"remotely-initiated-group-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call response for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"remotely-initiated-private-call-request\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call request for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <response-type> element set to a value of \"remotely-initiated-private-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call response for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/mikey\" and a CSB-ID containing a CSK-ID. Such requests are known as \"SIP MESSAGE request for CSK download for terminating client\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcptt-info> root element containing the <mcptt-Params> element and an <emergency-alert-area-ind> element. Such requests are known as \"SIP MESSAGE request for notification of entry into or exit from an emergency alert area\";\n-\tSIP MESSAGE requests routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcptt-info> root element containing the <mcptt-Params> element and an <group-geo-area-ind> element. Such requests are known as \"SIP MESSAGE request for notification of entry into or exit from a group geographic area\";\n-\tSIP MESSAGE requests routed to the MCPTT client with the Request-URI set to a public user identity of the MCPTT user that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body and a <regroup-action> element set to \"create\". Such requests are known as \"SIP MESSAGE request to the MCPTT client to request creation of a regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the MCPTT client with the Request-URI set to a public user identity of the MCPTT user that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body and a <regroup-action> element set to \"remove\". Such requests are known as \"SIP MESSAGE request to the MCPTT client to request removal of a regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE request routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"transfer-private-call-request\". Such requests are known as \"SIP MESSAGE request for transfer private call request for terminating client\";\n-\tSIP MESSAGE request routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <responset-type> element set to a value of \"transfer-private-call-response\". Such requests are known as \"SIP MESSAGE request for transfer private call response for terminating client\";\n-\tSIP MESSAGE request routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <request-type> element set to a value of \"forward-private-call-request\". Such requests are known as \"SIP MESSAGE request for forwarding private call request for terminating client\"; and\n-\tSIP MESSAGE request routed to the MCPTT client containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element containing the <mcptt-Params> element and an <anyExt> element containing the <responset-type> element set to a value of \"forward-private-call-response\". Such requests are known as \"SIP MESSAGE request for forwarding private call response for terminating client\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.1\tSDP offer generation",
                            "text_content": "The SDP offer shall contain one SDP media-level clause for MCPTT speech according to 3GPP TS 24.229 [4] and, may contain one SDP media-level section for a media plane control messages according to 3GPP TS 24.380 [5].\nWhen composing an SDP offer according to 3GPP TS 24.229 [4] the MCPTT client:\n1)\tshall set the IP address of the MCPTT client for the offered MCPTT speech media stream and, if media plane control messages shall be used, for the offered media plane control channel;\nNOTE 1:\tIf the MCPTT client is behind a NAT the IP address and port included in the SDP offer can be a different IP address and port than the actual IP address and port of the MCPTT client depending on the NAT traversal method used by the SIP/IP Core.\n2)\tshall include an \"m=audio\" media-level section for the MCPTT media stream consisting of:\na)\tthe port number for the media stream selected, with the following clarification:\ni)\tif the MCPTT client is requesting an upgrade (resp. downgrade) of an already established session to (resp. from) emergency or imminent peril and if multiplexing of media streams was used, the MCPTT client should select a different port number not to impact the resource priority used for the other multiplexed media streams;\nb)\tthe codec(s) and media parameters and attributes with the following clarification:\ni)\tif the MCPTT client is initiating a call to a group identity;\nii)\tif the <preferred-voice-encodings> element is present in the group document retrieved by the group management client as specified in 3GPP TS 24.481 [31] containing an <encoding> element with a \"name\" attribute; and\niii)\tif the MCPTT client supports the encoding name indicated in the value of the \"name\" attribute;\nthen the MCPTT client:\ni)\tshall insert the value of the \"name\" attribute in the <encoding name> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12];\nc)\tif the SDP offer is for an ambient listening call:\ni)\tif this is a remotely initiated ambient listening call, include an \"a=recvonly\" attribute; or\nii)\tif this is a locally initiated ambient listening call, include an \"a=sendonly\" attribute;\nd)\t\"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4]; and\ne)\tif the MCPTT client is initiating a call with implicit floor request:\ni)\tmay include an \"a=ssrc\" attribute as specified in IETF RFC 5576 [86] where the MCPTT client may indicate to the MCPTT server which RTP SSRC it would like to use in the subsequent RTP media flow if the implicit floor request is granted;\nNOTE 2:\tThe actual RTP SSRC that the client will have to use if the implicit floor request is granted will be received either in the mc-ssrc attribute of the SDP answer in the case of an implicit floor grant, or in the corresponding information element of the floor granted message in the case of an explicit floor grant. The client will use the RTP SSRC received from the MCPTT server regardless of this optional a=ssrc attribute.\n3)\tif media plane control messages shall be used during the session, shall include an \"m=application\" media-level section as specified in 3GPP TS 24.380 [5] clause 4.3, consisting of:\na)\tthe port number for the media plane control channel selected as specified in 3GPP TS 24.380 [5], ], with the following clarification:\ni)\tif the MCPTT client is requesting an upgrade (resp. downgrade) of an already established session to (resp. from) emergency or imminent peril and if multiplexing of media plane control channels was used, the MCPTT client should select a different port number not to impact the resource priority used for the other multiplexed media plane control channels;\nb)\tan mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14, with the RTCP SSRC that the MCPTT client has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the participating MCPTT function in the floor control messages sent to the MCPTT client for this session; and\nNOTE 3:\tThe MCPTT client will receive in the SDP answer the RTP SSRC it will have to use in the floor control message it will send to the participating MCPTT function in this session.\nc)\tany other necessary 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14; and\nNOTE 4:\tThe same media plane control channel is used for transport of messages associated with floor control, pre-established session call control and MBMS bearer management.\n4)\tif end-to-end security is required for a private call and the SDP offer is not for establishing a pre-established session, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF RFC 4567 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.2\tSDP answer generation",
                            "text_content": "When the MCPTT client receives an initial SDP offer for an MCPTT session, the MCPTT client shall process the SDP offer and shall compose an SDP answer according to 3GPP TS 24.229 [4].\nWhen composing an SDP answer, the MCPTT client:\n1)\tshall accept the MCPTT speech media stream in the SDP offer;\n2)\tshall set the IP address of the MCPTT client for the accepted MCPTT speech media stream and, if included in the SDP offer, for the accepted media-floor control entity;\nNOTE 1:\tIf the MCPTT client is behind a NAT the IP address and port included in the SDP answer can be a different IP address and port than the actual IP address and port of the MCPTT client depending on the NAT traversal method used by the SIP/IP Core.\n3)\tshall include an \"m=audio\" media-level section for the accepted MCPTT speech media stream consisting of:\na)\tthe port number for the media stream with the following clarification:\ni)\tif the MCPTT client is responding to an upgrade (resp. downgrade) of an already established session to (resp. from) emergency or imminent peril and if multiplexing of media streams was used, the MCPTT client should select a different port number not to impact the resource priority used for the other multiplexed media streams;\nb)\tmedia-level attributes as specified in 3GPP TS 24.229 [4];\nc)\tif the \"a=recvonly\" attribute is present in the SDP offer, include an \"a=sendonly\" attribute;\nd)\tif the \"a=sendonly\" attribute is present in the SDP offer, include an \"a=recvonly\" attribute; and\ne)\t\"i=\" field set to \"speech\" according to 3GPP TS 24.229 [4];\n4)\tif included in the SDP offer, shall include an \"m=application\" media-level section of the offered media-floor control entity as specified in 3GPP TS 24.380 [5] clause 4.3, consisting of:\na)\tthe port number for the media plane control channel selected as specified in 3GPP TS 24.380 [5], with the following clarification:\ni)\tif the MCPTT client is requesting an upgrade (resp. downgrade) of an already established session to (resp. from) emergency or imminent peril and if multiplexing of media plane control channels was used, the MCPTT client should select a different port number not to impact the resource priority used for the other multiplexed media plane control channels; and\nb)\tan mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14, with the RTCP SSRC that the MCPTT client has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the participating MCPTT function in the floor control messages sent to the MCPTT client for this session; and\nNOTE 2:\tThe MCPTT client has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the participating MCPTT function in this session.\nc)\tany other necessary 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14; and\n5)\tif end-to-end security is required for a first-to-answer call, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP answer as specified in 3GPP TS 33.180 [78].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.3\tCommencement modes",
                            "text_content": "When performing the automatic commencement mode procedures, the MCPTT client:\n1)\tshall accept the SIP INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall include the option tag \"timer\" in a Require header field of the SIP 200 (OK) response;\n3)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP 200 (OK) response;\n4)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP 200 (OK) response;\n5)\tshall include the Session-Expires header field in the SIP 200 (OK) response and start the SIP session timer according to IETF RFC 4028 [7]. The \"refresher\" parameter in the Session-Expires header field shall be set to \"uas\";\n6)\tshall, if the incoming SIP INVITE request contains a Replaces header field, include in the SDP answer in the SIP 200 (OK) response to the SDP offer the parameters used for the pre-established session identified by the contents of the Replaces header field;\n7)\tshall, if the incoming SIP INVITE request does not contain a Replaces header field, include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2;\nNOTE:\tIn the case of a new emergency call where the terminating client is using a pre-established session, the SIP INVITE request containing a Replaces header is used to replace the pre-established session.\n7a)\tshall, if the incoming SIP INVITE request contains a <transfer-announced-ind> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body, set the value of the <replaces-header-value> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the following value: The Call-ID header field, and the value of the from-tag header field parameter set to the value contained in the incoming SIP INVITE request. The value of the to-tag is the one set by the MCPTT client in the 200 (OK) response. Together they represent a dialog identifier;\n8)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4];\n9)\tshall, if the incoming SIP INVITE request contains a Replaces header field, release the pre-established session identified by the contents of the Replaces header field; and\n10)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.2.\nWhen NAT traversal is supported by the MCPTT client and when the MCPTT client is behind a NAT, generation of SIP responses is done as specified in this clause and as specified in IETF RFC 5626 [15].\nWhen performing the automatic commencement mode procedures, the MCPTT client shall follow the procedures in clause 6.2.3.1.1.\nWhen performing the manual commencement mode procedures:\n1)\tif the MCPTT user declines the MCPTT session invitation the MCPTT client shall send a SIP 480 (Temporarily Unavailable) response towards the MCPTT server with the warning text set to: \"110 user declined the call invitation\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause; and\n2)\tif the MCPTT user requests to forward the MCPTT private call based on manual user input, the MCPTT client shall send a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" in a Warning header field as specified in clause 4.4 and follow the procedures as specified in clause 11.1.9.2.1, and not continue with the rest of the steps in this clause.\nThe MCPTT client:\n1)\tshall accept the SIP INVITE request and generate a SIP 180 (Ringing) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall include the option tag \"timer\" in a Require header field of the SIP 180 (Ringing) response;\n3)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP 180 (Ringing) response;\n4)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP 180 (Ringing) response; and\n5)\tshall send the SIP 180 (Ringing) response to the MCPTT server.\nWhen sending the SIP 200 (OK) response to the incoming SIP INVITE request, the MCPTT client shall follow the procedures in clause 6.2.3.1.1.\nWhen NAT traversal is supported by the MCPTT client and when the MCPTT client is behind a NAT, generation of SIP responses is done as specified in this clause and as specified in IETF RFC 5626 [15].\nWhen performing the manual commencement mode procedures:\n1)\tthe terminating MCPTT client may automatically generate a SIP 183 (Session Progress) in accordance with 3GPP TS 24.229 [4], prior to the MCPTT user's acknowledgement; and\n2)\tif the MCPTT user declines the MCPTT session invitation the MCPTT client shall send a SIP 480 (Temporarily Unavailable) response towards the MCPTT server with the warning text set to: \"110 user declined the call invitation\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause.\nWhen generating a SIP 183 (Session Progress) response, the MCPTT client:\n1)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag; and\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\nWhen sending the SIP 200 (OK) response to the incoming SIP INVITE request, the MCPTT client shall follow the procedures in clause 6.2.3.1.2.\nWhen NAT traversal is supported by the MCPTT client and when the MCPTT client is behind a NAT, generation of SIP responses is done as specified in this clause and as specified in IETF RFC 5626 [15].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.4\tLeaving an MCPTT session initiated by MCPTT client",
                            "text_content": "Upon receiving a request from an MCPTT user to leave an MCPTT session established using on-demand session signalling, the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4];\n3)\tshall set the Request-URI to the MCPTT session identity to leave; and\n4)\tshall send a SIP BYE request towards MCPTT server according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request, the MCPTT client shall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving a request from an MCPTT user to leave an MCPTT session within a pre-established session, the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tshall generate an initial SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27];\n3)\tshall set the Request-URI of the SIP REFER request to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n4)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\n5)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22];\n6)\tshall set the Refer-To header field of the SIP REFER request to the MCPTT session identity to leave;\n7)\tshall include the \"method\" SIP URI parameter with the value \"BYE\" in the URI in the Refer-To header field;\n8)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session; and\n9)\tshall send the SIP REFER request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client shall interact with media plane as specified in 3GPP TS 24.380 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.5\tReleasing an MCPTT session initiated by MCPTT client",
                            "text_content": "When the MCPTT client wants to release an MCPTT session using on-demand session signalling, the MCPTT client:\n1)\tif the session is in the process of being established, shall send a SIP CANCEL request according to 3GPP TS 24.229 [4] and skip the rest of the steps;\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n3)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4];\n4)\tshall set the Request-URI to the MCPTT session identity to release; and\n5)\tshall send a SIP BYE request towards MCPTT server according to 3GPP TS 24.229 [4].\nWhen the MCPTT client wants to release an MCPTT call using a pre-established session, the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tshall generate an initial SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27];\n3)\tshall set the Request-URI of the SIP REFER request to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n4)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\n5)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22];\n6)\tshall set the Refer-To header field of the SIP REFER request to the MCPTT session identity to release;\n7)\tshall include the \"method\" SIP URI parameter with the value \"BYE\" in the URI in the Refer-To header field;\n8)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session; and\n9)\tshall send the SIP REFER request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 2xx response to the SIP REFER request, the MCPTT client shall interact with media plane as specified in 3GPP TS 24.380 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.6\tReceiving an MCPTT session release request",
                            "text_content": "Upon receiving a SIP BYE request, the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n2)\tshall send SIP 200 (OK) response towards MCPTT server according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.7\tVoid",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.8\tPriority call conditions",
                            "text_content": "The clauses of the parent clause contain common procedures to be used for MCPTT emergency group calls and MCPTT imminent peril group calls.\nThis clause is referenced from other procedures.\nWhen the MCPTT emergency state is set and the MCPTT user is authorised to initiate an MCPTT emergency group call on the targeted MCPTT group as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\n1)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request or SIP REFER request, an <emergency-ind> element set to \"true\";\n2)\tif the MCPTT emergency group call state is set to \"MEGC 1: emergency-gc-capable\", shall set the MCPTT emergency group call state to \"MEGC 2: emergency-call-requested\";\n3)\tif the MCPTT user has also requested an MCPTT emergency alert to be sent and this is an authorised request for MCPTT emergency alert as determined by the procedures of clause 6.2.8.1.6, and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall:\na)\tset the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to \"true\" and set the MCPTT emergency alert state to \"MEA 2: emergency-alert-confirm-pending\"; and\nb)\tinclude in the SIP INVITE request the specific location information for MCPTT emergency alert as specified in clause 6.2.9.1;\n4)\tif the MCPTT user has not requested an MCPTT emergency alert to be sent and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to \"false\"; and\n5)\tif the MCPTT client emergency group state of the group is set to a value other than \"MEG 2: in-progress\" set the MCPTT client emergency group state of the MCPTT group to \"MEG 4: confirm-pending\".\nNOTE 1:\tThis is the case of an MCPTT user already being in the MCPTT emergency state it initiated previously while originating an MCPTT emergency group call or MCPTT emergency alert. All group calls the MCPTT user originates while in MCPTT emergency state will be MCPTT emergency group calls.\nWhen the MCPTT emergency state is clear and the MCPTT emergency group call state is set to \"MEGC 1: emergency-gc-capable\" and the the MCPTT user is  authorised to initiate an MCPTT emergency group call on the targetted MCPTT group as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\n1)\tshall set the MCPTT emergency state;\n2)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request or SIP REFER request an <emergency-ind> element set to \"true\" and set the MCPTT emergency group call state to \"MEGC 2: emergency-call-requested\" state;\n3)\tif the MCPTT user has also requested an MCPTT emergency alert to be sent and this is an authorised request for MCPTT emergency alert as determined by the procedures of clause 6.2.8.1.6, shall:\na)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body the <alert-ind> element set to \"true\" and set the MCPTT emergency alert state to \"MEA 2: emergency-alert-confirm-pending\"; and\nb)\tinclude in the SIP INVITE request the specific location information for MCPTT emergency alert as specified in clause 6.2.9.1;\n4)\tif the MCPTT user has not requested an MCPTT emergency alert to be sent, shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to \"false\"; and\n5)\tif the MCPTT client emergency group state of the group is set to a value other than \"MEG 2: in-progress\" shall set the MCPTT client emergency group state of the MCPTT group to \"MEG 4: confirm-pending\".\nNOTE 2:\tThis is the case of an initial MCPTT emergency group call and optionally an MCPTT emergency alert being sent. As the MCPTT emergency state is not sent, there is no MCPTT emergency alert outstanding.\nNOTE 3:\tAn MCPTT group call originated by an affiliated member of an MCPTT group which is in an in-progress emergency state (as tracked on the MCPTT client by the MCPTT client emergency group state) but is not in an MCPTT emergency state of their own will also be an MCPTT emergency group call. The <emergency-ind> and <alert-ind> elements of the application/vnd.3gpp.mcptt-info+xml MIME body do not need to be included in this case and hence no action needs to be taken in this clause.\nThis clause is referenced from other procedures.\nIf the MCPTT emergency group call state is set to either \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\" and this is an authorised request for an MCPTT emergency group call as determined by the procedures of clause 6.2.8.1.8, or the MCPTT client emergency group state of the group is set to \"MEG 2: in-progress\", the MCPTT client shall include in the SIP INVITE request or SIP REFER request a Resource-Priority header field populated with the values for an MCPTT emergency group call as specified in clause 6.2.8.1.15.\nNOTE:\tThe MCPTT client ideally would not need to maintain knowledge of the in-progress emergency state of the group (as tracked on the MCPTT client by the MCPTT client emergency group state) but can use this knowledge to provide a Resource-Priority header field set to emergency level priority, which starts the infrastructure priority adjustment process sooner than otherwise would be the case.\nIf this is an authorised request to cancel the MCPTT emergency group call as determined by the procedures of clause 6.2.8.1.7, and the MCPTT client emergency group state of the group is \"no-emergency\" or \"cancel-pending\", the MCPTT client shall include in the SIP INVITE request or SIP REFER request a Resource-Priority header field populated with the values for a normal MCPTT group call as specified in clause 6.2.8.1.15.\nThis clause is referenced from other procedures.\nIf the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-granted\" and the MCPTT emergency alert state is set to \"MEA 1: no-alert\", the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given below.\nNOTE 1:\tThis procedure assumes that the calling procedure has verified that the MCPTT user has made an authorised request for cancelling MCPTT in-progress emergency group state of the group.\nThe MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall clear the MCPTT emergency state; and\n3)\tshall set MCPTT emergency group state of the MCPTT group to \"MEG 3: cancel-pending\"\nNOTE 2:\tThis is the case of an MCPTT user who has initiated an MCPTT emergency group call and wants to cancel it.\nIf the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-granted\" and the MCPTT emergency alert state is set to a value other than \"MEA 1: no-alert\" and the MCPTT user has indicated only the MCPTT emergency group call should be cancelled, the MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\"; and\n2)\tshall set the MCPTT emergency group state of the MCPTT group to \"MEG 3: cancel-pending\".\nNOTE 3:\tThis is the case of an MCPTT user has initiated both an MCPTT emergency group call and an MCPTT emergency alert and wishes to only cancel the MCPTT emergency group call. This leaves the MCPTT emergency state set.\nIf the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-granted\" and the MCPTT emergency alert state is set to a value other than \"MEA 1: no-alert\" and the MCPTT user has indicated that the MCPTT emergency alert on the MCPTT group should be cancelled in addition to the MCPTT emergency group call, the MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall if this is an authorised request to cancel an MCPTT emergency alert as determined by the procedures of clause 6.2.8.1.6:\na)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to \"false\";\nb)\tset the MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-pending\"; and\nc)\tclear the MCPTT emergency state;\n3)\tshould, if this is not an authorised request to cancel an MCPTT emergency alert as determined by the procedures of clause 6.2.8.1.6, indicate to the MCPTT user that they are not authorised to cancel the MCPTT emergency alert; and\n4)\tshall set the MCPTT emergency group state of the MCPTT group to \"MEG 3: cancel-pending\".\nNOTE 4:\tThis is the case of an MCPTT user that has initiated both an MCPTT emergency group call and an MCPTT emergency alert and wishes to cancel both.\nIn the procedures in this clause, a priority group call refers to an MCPTT emergency group call or an MCPTT imminent peril group call.\nOn receiving a SIP 2xx response to a SIP request for a priority group call, the MCPTT client:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\":\na)\tshall set the MCPTT client emergency group state of the group to \"MEG 2: in-progress\" if it was not already set;\nb)\tif the MCPTT emergency alert state is set to \"MEA 2: emergency-alert-confirm-pending\" and the SIP 2xx response to the SIP request for a priority group call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated;\nc)\tshall set the MCPTT emergency group call state to \"MEGC 3: emergency-call-granted\"; and\nd)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-capable\" and the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; or\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\" and the SIP 2xx response to the SIP request for an imminent peril group call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\":\na)\tset the MCPTT imminent peril group call state to \"MIGC 3: imminent-peril-call-granted\"; and\nb)\tset the MCPTT imminent peril group state to \"MIG 2: in-progress\".\nIn the procedures in this clause, a priority group call refers to an MCPTT emergency group call or an MCPTT imminent peril group call.\nUpon receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to a SIP request for a priority group call the MCPTT client:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\":\na)\tshall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-capable\";\nb)\tif the MCPTT client emergency group state of the group is \"MEG 4: confirm-pending\" shall set the MCPTT client emergency group state of the group to \"MEG 1: no-emergency\"; and\nc)\tif the sent SIP request for a priority group call contained an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\", shall set the MCPTT emergency alert state to \"MEA 1: \"no-alert\"; and\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\":\na)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nb)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\".\nIf the MCPTT client receives a request from the MCPTT user to send an MCPTT emergency alert and:\n1)\tif the <allow-activate-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\n2)\tif the \"entry-info\" attribute of the <entry> element of the <EmergencyAlert> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of:\na)\t\"DedicatedGroup\", and if the <uri-entry> element of the <entry> element of the <EmergencyAlert> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) contains the MCPTT group identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\t\"UseCurrentlySelectedGroup\" and the <allow-MCPTT-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the <list-service> element of the group document identified by the MCPTT group identity targeted for the emergency alert is set to a value of \"true\" as specified in 3GPP TS 24.481 [31];\nthen the MCPTT emergency alert request shall be considered to be an authorised request for an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request for an MCPTT emergency alert.\nIf the MCPTT client receives a request from the MCPTT user to cancel an MCPTT emergency alert to an MCPTT group, and if the <allow-cancel-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency alert cancellation request shall be considered to be an authorised request to cancel an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request to cancel an MCPTT emergency alert.\nWhen the MCPTT client receives a request from the MCPTT user to cancel the in-progress emergency state of a group the MCPTT client, determines, based on local policy (e.g if the requester is dispatcher or initiator of the MCPTT emergency group call etc), whether to send the emergency group state cancel request or not.\nWhen the MCPTT client receives a request from the MCPTT user to originate an MCPTT emergency group call the MCPTT client shall check the following:\n1)\tif the <allow-emergency-group-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\" and\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and if the <uri-entry> element of the <entry> element of the <MCPTTGroupInitiation> element contains the identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\";\nthen the MCPTT emergency group call request shall be considered to be an authorised request for an MCPTT emergency group call;\nIn all other cases, the request to originate an MCPTT emergency group call shall be considered to be an unauthorised request to originate an MCPTT emergency group call.\nWhen the MCPTT client receives a request from the MCPTT user to originate an MCPTT imminent peril group call the MCPTT client shall check the following:\n1\tif the <allow-imminent-peril-call> element of <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\" and:\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and if the <MCPTTGroupInitiation> element contains the identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\";\nthen the MCPTT imminent peril group call request shall be considered to be an authorised request for an MCPTT imminent peril group call;\nIn all other cases, the request to originate an MCPTT imminent peril group call shall be considered to be an unauthorised request to originate an MCPTT imminent peril group call.\nThis clause is referenced from other procedures.\nWhen the MCPTT client receives a request from the MCPTT user to originate an MCPTT imminent peril group call, and this is an authorised request for an MCPTT imminent peril group call as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\n1)\tif the MCPTT client imminent peril group state is set to \"MIGC 1: imminent-peril-gc-capable\" and the in-progress emergency state of the group is set to a value of \"false\":\na)\tshall include in the SIP request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in Annex F.1 with the <imminentperil-ind> element set to \"true\" and set the MCPTT emergency group call state to \"MIGC 2: imminent-peril-call-requested\" state; and\nb)\tif the MCPTT client imminent peril group state of the group is set to a value other than \"MIG 2: in-progress\" shall set the MCPTT client emergency group state of the MCPTT group to \"MIG 4: confirm-pending\".\nNOTE:\tAn MCPTT group call originated by an affiliated member of an MCPTT group which is in an in-progress imminent peril state (as tracked on the MCPTT client by the MCPTT client imminent peril group state) will also have the priority associated with MCPTT imminent peril group calls. The <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info MIME body does not need to be included in this case, nor do any state changes result and hence no action needs to be taken in this clause.\nWhen the MCPTT client receives a request from the MCPTT user to cancel an MCPTT imminent peril group call the MCPTT client shall:\n1)\tif the <allow-cancel-imminent-peril> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\" the MCPTT imminent peril call cancellation request shall be considered to be an authorised request to cancel the MCPTT imminent peril group call; or\n2)\tif the <allow-cancel-imminent-peril> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\" the MCPTT imminent peril call cancellation request shall be considered to be an unauthorised request to cancel the MCPTT imminent peril group call.\nThis clause is referenced from other procedures.\nIf the MCPTT imminent peril group call state is set to \"MIGC 3: imminent-peril-call-granted\" or the MCPTT imminent peril group state of the MCPTT group is set to \"MIG 2: in-progress\", the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given below.\nNOTE 1:\tThis procedure assumes that the calling procedure has verified that the MCPTT user has made an authorised request for cancelling the in-progress imminent peril group state of the group.\nThe MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <imminentperil-ind> element set to \"false\"; and\n2)\tshall set MCPTT imminent peril group state of the MCPTT group to \"MIG 3: cancel-pending\".\nNOTE 2:\tThis is the case of an MCPTT user who has initiated an MCPTT imminent peril group call and wants to cancel it, or another authorised member of the group who wishes to cancel the in-progress imminent peril state of the group.\nThis clause is referenced from other procedures.\nWhen the MCPTT imminent peril group call state is set \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\" and the MCPTT user is authorised to initiate an MCPTT imminent peril group call on the targeted MCPTT group as determined by the procedures of clause 6.2.8.1.8, or the MCPTT client imminent peril state of the group is set to \"MIG 2: in-progress\", the MCPTT client:\n1)\tshall include in the SIP INVITE request or SIP REFER request a Resource-Priority header field populated with the values for an MCPTT imminent peril group call as specified in clause 6.2.8.1.15.\nNOTE:\tThe MCPTT client ideally would not need to maintain knowledge of the in-progress imminent peril state of the group (as tracked on the MCPTT client by the MCPTT client imminent peril group state) but can use this knowledge to provide a Resource-Priority header field set to imminent peril level priority, which starts the infrastructure priority adjustment process sooner than otherwise would be the case.\nWhen the MCPTT imminent peril group call state is set to \"MIGC 1: imminent-peril-gc-capable\" and the MCPTT user is authorised to cancel MCPTT imminent peril group calls as determined by the procedures of clause 6.2.8.1.10, or the MCPTT client imminent peril group state of the group is \"MIG 1: no-imminent-peril\" or \"MIG 3: cancel-pending\", the MCPTT client:\n1)\tshall include in the SIP INVITE request or SIP REFER request a Resource-Priority header field populated with the values for a normal MCPTT group call as specified in clause 6.2.8.1.15.\nThis clause is referenced from other procedures.\nUpon receiving a SIP INFO request within the dialog of the SIP request for a priority group call:\n-\twith the Info-Package header field containing the g.3gpp.mcptt-info package name;\n-\twith the application/vnd.3gpp.mcptt-info+xml MIME body associated with the info package according to IETF RFC 6086 [64]; and\n-\twith one or more of the <alert-ind>, <imminentperil-ind> and <emergency-ind> elements set in the application/vnd.3gpp.mcptt-info+xml MIME body;\nthe MCPTT client:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request as specified in 3GPP TS 24.229 [4];\n2)\tif the MCPTT emergency group call state is set to \"MEGC 3: emergency-call-granted\":\na)\tif the MCPTT emergency alert state is set to \"MEA 2: emergency-alert-confirm-pending\":\ni)\tif the <alert-ind> element is set to a value of \"false\", shall set the MCPTT emergency alert state to \"MEA 1: no-alert\"; and\nii)\tif the <alert-ind> element is set to a value of \"true\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\";\n3)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\":\na)\tif the <imminentperil-ind> element is set to a value of \"false\" and an <emergency-ind> element is set to a value of \"true\", shall:\ni)\tset the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\";\nii)\tset the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-capable\"; and\niii)\tset the MCPTT client emergency group state of the group to \"MEG 2: in-progress\"; and\nNOTE 1:\tThis is the case of an MCPTT client attempting to make an imminent peril group call when the group is in an in-progress emergency group state. The MCPTT client will then receive a notification that the imminent peril call request was denied, however they will be participating at the emergency level priority of the group. This could occur for example when an MCPTT client requests an imminent peril call to a group that they are not currently affiliated with.\nNOTE 2:\tthe MCPTT client emergency group state above is the MCPTT client's view of the in-progress emergency state of the group.\n4)\tif the SIP request for a priority group call sent by the MCPTT client did not contain an <originated-by> element and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\":\na)\tif the <alert-ind> element contained in the SIP INFO request is set to a value of \"true\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\nb)\tif the <alert-ind> element contained in the SIP INFO request is set to a value of \"false\", shall set the MCPTT emergency alert state to \"MEA 1: no-alert\".\nThis clause is referenced from other procedures.\nUpon receiving an authorised request to cancel an in-progress emergency group state of a group as determined by the procedures of clause 6.2.8.1.7 from an MCPTT user, the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given below.\nThe MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall set MCPTT emergency group state of the MCPTT group to \"MEG 3: cancel-pending\"; and\n3)\tif the MCPTT user has indicated that an MCPTT emergency alert on the MCPTT group originated by another MCPTT user should be cancelled and this is an authorised request for an MCPTT emergency alert cancellation as determined by the procedures of clause 6.2.8.1.6:\na)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set a value of \"false\"; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <originated-by> element set to the MCPTT ID of the MCPTT user who originated the MCPTT emergency alert.\nNOTE:\tWhen an MCPTT emergency alert is cancelled by a MCPTT user other than its originator, the <originated-by> element is needed to identify which MCPTT emergency alert is being cancelled, as more than one MCPTT user could have originated emergency alerts to the same group.\nThis clause is referenced from other procedures.\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for an MCPTT emergency group call or MCPTT emergency private call the MCPTT client:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <emergency-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <emergency-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]).\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for an MCPTT imminent peril group call the MCPTT client:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <imminent-peril-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <imminent-peril-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]).\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for a normal MCPTT group or private call the MCPTT client:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <normal-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <normal-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]).\nNOTE:\tThe \"normal\" Resource-Priority header field value is needed to return to a normal priority value from a priority value adjusted for an MCPTT emergency group or private call or an MCPTT imminent peril group call. The \"normal\" priority received from the EPS by use of the \"normal\" Resource-Priority header field value is expected to be the same as the \"normal\" priority received from the EPS when initiating a call with no Resource-Priority header field included.\nThis clause is referenced from other procedures.\nUpon receipt of a SIP re-INVITE request within the pre-established session targeted by the sent SIP REFER request, and if the sent SIP REFER request was a request for an MCPTT emergency group call or an MCPTT imminent peril group call, the MCPTT client:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\":\na) if there is no <emergency-ind> element or an <emergency-ind> element set to a value of \"true\" contained in the application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP re-INVITE request, and if no <imminentperil-ind> element is included:\ni)\tshall set the MCPTT client emergency group state of the group to \"MEG 2: in-progress\" if it was not already set; and\nii)\tshall set the MCPTT emergency group call state to \"MEGC 3: emergency-call-granted\"; and\nb)\tif the MCPTT emergency alert state is set to \"MEA 2: emergency-alert-confirm-pending\":\ni)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"true\" or does not contain an <alert-ind> element, shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; or\nii)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"false\", shall set the MCPTT emergency alert state to \"MEA 1: no-alert\"; and\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested:\na)\tif the sip re-INVITE request contains an <imminentperil-ind> element set to a value of \"true\" or does not contain an <imminentperil-ind> element, shall:\ni)\tset the MCPTT imminent peril group call state to \"MIGC 3: imminent-peril-call-granted\"; and\nii)\tset the MCPTT imminent peril group state to \"MIG 2: in-progress\"; or\nb)\tif the SIP re-INVITE request contains <imminentperil-ind> element set to a value of \"false\" and an <emergency-ind> element set to a value of \"true\", shall set the MCPTT client emergency group state of the group to \"MEG 2: in-progress\".\nNOTE:\tThis is the case of an MCPTT client attempting to make an imminent peril group call when the group is in an in-progress emergency group state. The MCPTT client will then receive a notification that the imminent peril call request was denied, however they will be participating at the emergency level priority of the group. This could occur for example when an MCPTT client requests an imminent peril call to a group that they are not currently affiliated with.\nThis clause is referenced from other procedures.\nUpon receiving a request to release the MCPTT emergency group call or an MCPTT imminent peril group call in an MCPTT group session is in-progress or is in the process of being established:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\":\na)\tshall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-capable\";\nb)\tif the MCPTT client emergency group state of the group is \"MEG 3: confirm-pending\" shall set the MCPTT client emergency group state of the group to \"MEG 1: no-emergency\"; and\nc)\tif the MCPTT emergency alert state is set to \"MEA 2: emergency-alert-confirm-pending\" shall set the MCPTT emergency alert state to \"MEA 1: \"no-alert\"; and\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\":\na)\tif the MCPTT imminent peril group call state of the group is \"MIG 3: confirm-pending\", shall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nb)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-capable\".\nNOTE:\tThe above conditions can be applied upon a call being released within a pre-established by the procedures specified in clause 9.2.2 in 3GPP TS 24.380 [5].\nThis clause is referenced from other procedures.\nUpon receiving a request to release the MCPTT session when an MCPTT emergency private call is in-progress or is in the process of being established:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-call-requested\":\na)\tshall set the MCPTT emergency private call state to \"MEPC 1: emergency-pc-capable\";\nb)\tif the MCPTT emergency private priority state of the private call is \"MEPP 3: confirm-pending\" shall set the MCPTT emergency private priority state of the private call to \"MEPP 1: no-emergency\"; and\nc)\tif the MCPTT private emergency alert state is set to \"MPEA 2: emergency-alert-confirm-pending shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\".\nNOTE:\tThe above conditions can be applied upon a call being released within a pre-established by the procedures specified in clause 9.2.2 of 3GPP TS 24.380 [5].\nNOTE:\tThis clause is referenced from other procedures.\nWhen the MCPTT user initiates a broadcast group call, the MCPTT client:\n1)\tin the case of the prearranged group call is initiated on-demand, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body the <broadcast-ind> element set to \"true\" as defined in clause F.1; and\n2)\tin the case the prearranged group call is initiated using a pre-established session, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the hname \"body\" parameter in the headers portion of the SIP URI in the Refer-To header field the <broadcast-ind> element set to \"true\" as defined in clause F.1.\nIf the MCPTT client receives a request from the MCPTT user to originate an MCPTT emergency private call and:\n1)\tif the <allow-emergency-private-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTPrivateRecipient> element of the <EmergencyCall> element contained within the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UsePreConfigured\" and if the <uri-entry> element of the <entry> element of the <MCPTTPrivateRecipient> element contains the MCPTT ID of the MCPTT user targeted by the calling MCPTT user; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTPrivateRecipient> element of the <EmergencyCall> element contained within the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"LocallyDetermined\";\nthen the MCPTT client shall consider the MCPTT emergency private call request to be an authorised request for an MCPTT emergency private call. In all other cases the MCPTT client shall consider the MCPTT emergency private call request to be an unauthorised request for an MCPTT emergency private call.\nIf the MCPTT client receives a request from the MCPTT user to cancel an MCPTT emergency private call and if the <allow-cancel-private-emergency-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency private call cancellation request shall be considered to be an authorised request for an MCPTT emergency private call cancellation.\nIn all other cases, the MCPTT emergency private call cancellation request shall be considered to be an unauthorised request for an MCPTT emergency private call cancellation.\nIf the MCPTT client receives a request from the MCPTT user to send an MCPTT emergency alert to an MCPTT user and:\n1)\tif the <allow-activate-emergency-alert> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user as specified in 3GPP TS 24.484 [50] is set to a value of \"true\"; and\n2)\tif the \"entry-info\" attribute of the <entry> element of the <PrivateEmergencyAlert> element contained within the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of:\na)\t\"UsePreConfigured\", and if the <uri-entry> element of the <entry> element of the <PrivateEmergencyAlert> element of the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) contains the MCPTT ID of the targeted MCPTT user; or\nb)\t\"LocallyDetermined\";\nthen the MCPTT emergency alert request shall be considered to be an authorised request for an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request for an MCPTT emergency alert.\nIf the MCPTT client receives a request from the MCPTT user to cancel an MCPTT emergency alert to an MCPTT user, and if the <allow-cancel-emergency-alert> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user as specified in 3GPP TS 24.484 [50] is set to a value of \"true\", then the MCPTT emergency alert cancellation request shall be considered to be an authorised request to cancel an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request to cancel an MCPTT emergency alert.\nThis clause is referenced from other procedures.\nWhen the MCPTT emergency private call state is set to \"MEPC 1: emergency-pc-capable\" and this is an authorised request for an MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.1, the MCPTT client:\n1)\tshall set the MCPTT emergency state if not already set;\n2)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP request an <emergency-ind> element set to \"true\" and set the MCPTT emergency private call state to \"MEPC 2: emergency-pc-requested\";\n3)\tif the MCPTT user has also requested an MCPTT emergency alert to be sent and this is an authorised request for MCPTT emergency alert as determined by the procedures of clause 6.2.8.3.1.3, shall:\na)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body the <alert-ind> element set to \"true\" and set the MCPTT private emergency alert state to \"MPEA 2: emergency-alert-confirm-pending\"; and\nb)\tinclude in the SIP request the specific location information for MCPTT emergency alert as specified in clause 6.2.9.1;\n4)\tif the MCPTT user has not requested an MCPTT emergency alert to be sent, shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to \"false\"; and\n5)\tif the MCPTT emergency private priority state of this private call is set to a value other than \"MEPP 2: in-progress\" shall set the MCPTT emergency private priority state to \"MEPP 3: confirm-pending\".\nThis clause is referenced from other procedures.\nIf the MCPTT emergency private call state is set to either \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\" and this is an authorised request for an MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.1, or the MCPTT emergency private priority state of the call is set to \"MEPP 2: in-progress\", the MCPTT client shall include in the SIP request a Resource-Priority header field populated with the values for an MCPTT emergency private call as specified in clause 6.2.8.1.15.\nNOTE:\tThe MCPTT client ideally would not need to maintain knowledge of the in-progress emergency state of the call (as tracked on the MCPTT client by the MCPTT client emergency private state) but can use this knowledge to provide a Resource-Priority header field set to emergency level priority, which starts the infrastructure priority adjustment process sooner than otherwise would be the case.\nIf this is an authorised request to cancel the MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.2, or the MCPTT emergency private priority state of the private call is \"MEPP 1: no-emergency\" or \"MEPP 3: cancel-pending\", the MCPTT client shall include in the SIP request a Resource-Priority header field populated with the values for a normal MCPTT private call as specified in clause 6.2.8.1.15.\nThis clause is referenced from other procedures.\nOn receiving a SIP 2xx response to a SIP request for an MCPTT emergency private call and if the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", the MCPTT client:\n1)\tshall set the MCPTT emergency private priority state of the call to \"MEPP 2: in-progress\" if it was not already set;\n2)\tshall set the MCPTT emergency private call state to \"MEPC 3: emergency-pc-granted\"; and\n3)\tif the MCPTT private emergency alert state is set to \"MPEA 2: emergency-alert-confirm-pending\" and the SIP 2xx response to the SIP request for a priority private call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall set the MCPTT private emergency alert state to \"MPEA 3: emergency-alert-initiated\".\nUpon receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to a SIP request for an MCPTT emergency private call and if the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", the MCPTT client:\n1)\tshall set the MCPTT emergency private call state to \"MEPC 1: emergency-pc-capable\";\n2)\tif the MCPTT emergency private priority state of the private call is \"MEPP 3: confirm-pending\" shall set the MCPTT emergency private priority state of the private call to \"MEPP 1: no-emergency\"; and\n3)\tif the sent SIP request for an MCPTT emergency private call contained an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\".\nThis clause is referenced from other procedures.\nWhen the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-granted\" and the MCPTT emergency alert state is set to \"MPEA 1: no-alert\", the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given below.\nNOTE 1:\tThis procedure assumes that the MCPTT client in the calling procedure has verified that the MCPTT user has made an authorised request for cancelling MCPTT the in-progress emergency private call state of the call.\nThe MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall clear the MCPTT emergency state; and\n3)\tshall set MCPTT emergency private priority state of the MCPTT emergency private call to \"MEPP 3: cancel-pending\".\nNOTE 2:\tThis is the case of an MCPTT user who has initiated an MCPTT emergency private call and wants to cancel it.\nWhen the MCPTT emergency private call state is set to \"MEPPC 3: emergency-pc-granted\" and the MCPTT emergency alert state is set to a value other than \"MPEA 1: no-alert\" and the MCPTT user has indicated only the MCPTT emergency private call should be cancelled, the MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\"; and\n2)\tshall set the MCPTT emergency private priority state of the MCPTT emergency private call to \"MEPP 3: cancel-pending\";\nNOTE 3:\tThis is the case of an MCPTT user has initiated both an MCPTT emergency private call and an MCPTT emergency alert and wishes to only cancel the MCPTT emergency private call. This leaves the MCPTT emergency state set.\nWhen the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-granted\" and the MCPTT emergency alert state is set to a value other than \"MPEA 1: no-alert\" and the MCPTT user has indicated that the MCPTT emergency alert on the MCPTT private call should be cancelled in addition to the MCPTT emergency private call, the MCPTT client:\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in annex F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall, if this is an authorised request to cancel an MCPTT emergency alert as determined by the procedures of clause 6.2.8.3.1.3:\na)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to \"false\"; and\nb)\tset the MCPTT private emergency alert state to \"MPEA 4: emergency-alert-cancel-pending\";\n3)\tif this is not an authorised request to cancel an MCPTT emergency alert as determined by the procedures of clause 6.2.8.3.1.3, should indicate to the MCPTT user they are not authorised to cancel the MCPTT emergency alert;\n4)\tshall set the MCPTT emergency private priority state of the MCPTT emergency private call to \"MEPP 3: cancel-pending\"; and\n5)\tshall clear the MCPTT emergency state.\nNOTE 4:\tThis is the case of an MCPTT user that has initiated both an MCPTT emergency private call and an MCPTT emergency alert and wishes to cancel both.\nThis clause is referenced from other procedures.\nUpon receiving a SIP INFO request within the dialog of the SIP request for a priority private call:\n-\twith the Info-Package header field containing the g.3gpp.mcptt-info package name;\n-\twith the application/vnd.3gpp.mcptt-info+xml MIME body associated with the info package according to IETF RFC 6086 [64]; and\n-\twith one or more of the <alert-ind>, <imminentperil-ind> and <emergency-ind> elements set in the application/vnd.3gpp.mcptt-info+xml MIME body;\nthe MCPTT client:\n1)\tif the MCPTT private emergency alert state is set to \"MPEA 2: emergency-alert-confirm-pending\":\na)\tif the <alert-ind> element is set to a value of \"false\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\"; and\nb)\tif the <alert-ind> element set to a value of \"true\", shall set the MCPTT private emergency alert state to \"MPEA 3: emergency-alert-initiated\"; and\n2)\tif the MCPTT private emergency alert state is set to \"MPEA 4: Emergency-alert-cancel-pending\":\na)\tif the <alert-ind> element is set to a value of \"true\", shall set the MCPTT private emergency alert state to \"MPEA 3: emergency-alert-initiated\"; and\nb)\tif the <alert-ind> element is set to a value of \"false\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\".\nThis clause is referenced from other procedures.\nUpon receiving a request to cancel the MCPTT emergency private call state from an MCPTT user other than the originator of the MCPTT emergency private call, the MCPTT client shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given below.\nThe MCPTT client:\nNOTE 1: This procedure assumes that the calling procedure has verified that the MCPTT user has made an authorised request for cancelling the MCPTT emergency private call state of the call.\n1)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in clause F.1 with the <emergency-ind> element set to \"false\";\n2)\tshall set the MCPTT emergency private priority state of the MCPTT emergency private call to \"MEPP 3: cancel-pending\"; and\n3)\tif the MCPTT user has indicated that an MCPTT emergency alert associated with the MCPTT emergency private call originated by another MCPTT user should be cancelled and this is an authorised request for an MCPTT emergency alert cancellation as determined by the procedures of clause 6.2.8.3.1.3:\na)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to a value of \"false\"; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <originated-by> element set to the MCPTT ID of the MCPTT user who originated the MCPTT emergency alert.\nNOTE 2:\tWhen an MCPTT emergency alert is cancelled by a MCPTT user other than its originator, the <originated-by> element is needed to identify which MCPTT emergency alert is being cancelled, as conceivably each participant in the MCPTT emergency private call could have originated an MCPTT emergency alert.\nIf the MCPTT client needs to retrieve a KMS URI associated to an identified MCPTT ID for on network operation, the MCPTT client:\n1)\tshall search for the <entry> element of the <PrivateCallURI> element of the <PrivateCallList> element entry of the <Common> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) containing the identified MCPTT ID;\na)\tif the identified MCPTT ID is found and if the <entry> element of the <PrivateCallKMSURI> element of the <anyExt> element of the <PrivateCallList> element entry identified is not empty, shall retrieve the KMS URI contained therein; or\nb)\tif the identified MCPTT ID is not found or the <entry> element of the <PrivateCallKMSURI> element is empty, shall retrieve the <kms> element of the <App-Server-Info> element of the <on-network> element of the MCPTT UE initial configuration document (see the MCPTT UE initial configuration document in 3GPP TS 24.484 [50]) and consider that to be the KMS URI associated with the MCPTT ID.\nIf the MCPTT client needs to retrieve a KMS URI associated to an identified MCPTT ID for off network operation, the MCPTT client:\n1)\tshall search for /<x>/<x>/Common/PrivateCall/UserList/<x>/Entry/MCPTTID leaf node containing the identified MCPTT ID (see the MCPTT user profile MO in 3GPP TS 24.483 [45]);\na)\tif the identified MCPTT ID is found:\ni)\tshall retrieve the /<x>/<x>/Common/PrivateCall/UserList/<x>/Entry/PrivateCallKMSURI leaf node (see the MCPTT user profile MO in 3GPP TS 24.483 [45]); and\nii)\tif the PrivateCallKMSURI leaf node in the same /<x>/<x>/Common/PrivateCall/UserList/<x>/Entry/ interior node as the MCPTTID leaf node containing the identified MCPTT ID is not empty, shall consider its value to be the KMS URI associated with the MCPTT ID; and\nb)\tif the identified MCPTT ID is not found or if the /<x>/<x>/Common/PrivateCall/UserList/<x>/Entry/PrivateCallKMSURI leaf node is empty:\ni)\tshall retrieve /<x>/OnNetwork/AppServerInfo/KMS leaf node (see the MCPTT UE initial configuration document in 3GPP TS 24.483 [45]); and\nii)\tshall consider the value of the /<x>/OnNetwork/AppServerInfo/KMS leaf node to be the KMS URI associated with the MCPTT ID.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.9\tLocation information",
                            "text_content": "This procedure is initiated by the MCPTT client when it is including location report information:\n1)\tas part of a SIP request containing an MCPTT emergency alert; or\n2)\tas part of a SIP request for a specified location trigger.\nThe MCPTT client:\n1)\tif location information is being included as part of a SIP request for a specified location trigger criteria as configured in a <TriggeringCriteria> element and <EmergencyTriggeringCriteria> element contained in a <Configuration> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3 as received in a SIP MESSAGE request by the procedures of clause 13.3.2:\na)\tshall include in the SIP request the specific location information as specified by the procedures of clause 13.3.4.2; and\nb)\tshall skip the rest of the steps;\n2)\tif location information is being included as part of a SIP request containing an MCPTT emergency alert:\na)\tshall include an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3 with a <Report> element included in the <location-info> root element;\nb)\tshall set the <ReportType> element of the <Report> element to a value of \"Emergency\";\nc)\tif the MCPTT client has been configured with an <EmergencyLocationInformation> element contained in a <Configuration> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3 and received in a SIP MESSAGE request by the procedures of clause 13.3.2;\ni)\tshall populate the <CurrentLocation> element of  the <Report> element as indicated by the <EmergencyLocationInformation> element contained in the <Configuration> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3 and previously received by the procedures of clause 13.3.2; and\nii)\tshall skip the rest of the steps; and\nd)\tif the MCPTT client has not been configured with an <EmergencyLocationInformation> element contained in a <Configuration> element contained in an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3 and received in a SIP MESSAGE request by the procedures of clause 13.3.2:\ni)\tshall include in the <CurrentLocation> element of  the <Report> element of the application/vnd.3gpp.mcptt-location-info+xml MIME body a <CurrentCoordinate> element populated as specified in Annex F.3.3.\nNOTE:\tAccording to local policy, additional location information elements specified in Annex F.3.3 can be included in the <CurrentLocation> element in the event that no <EmergencyLocationInformation> element was previously received.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.2.10\tSupport for multiplexing",
                            "text_content": "If multiplexing is supported the SSRC of the RTCP header is used to enable multiplexing of media plane control channels for different communications over the same IP address and port. The SSRCs to be used in the RTCP messages over the media plane control channel for one communication are allocated at session establishment by each receiving entity.\nIf multiplexing is supported the SSRC of the RTP header is used to enable multiplexing of media streams for different communications over the same IP address and port. The SSRCs to be used in the RTP messages over the media stream for one communication are allocated in floor control server and exchange with the floor control protocol.\nThe floor control server shall generate globally unique SSRC to avoid collision of SSRC.\nNOTE:\tIf SSRC collision is detected by the MCPTT client, it will not be possible to determine the source of the media streams during one transmission (i.e. one talk burst) for a MCPTT client. It is up to the MCPTT client implementation on how to handle such SSRC collision.\nBefore the useage of multiplexing, the MCPTT client, the participating MCPTT function, the controlling MCPTT function and the non-controlling MCPTT function shall determine that both endpoints of a session support multiplexing.\nThe participating MCPTT function may determine the MCPTT client's support of multiplexing from the <multiplex-support> element of the MCPTT client poc-settings.\nThe MCPTT client, the participating MCPTT function, the controlling MCPTT function and the non-controlling MCPTT function may determine the support for multiplexing of another entity based on the presence of \"mc_floor_ssrc\" fmtp attribute in the SDP offere/answer, according to 3GPP TS 24.380 [5], sub clause 14.4. The participating MCPTT function, the controlling MCPTT function and the non-controlling MCPTT function may determine the support for multiplexing in another MCPTT server function based on local configuration, which is outside the scope of the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.3\tMCPTT server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.3.1\tDistinction of requests sent to the MCPTT server",
                            "text_content": "The MCPTT server needs to distinguish between the following initial SIP INVITE requests for originations and terminations:\n-\tSIP INVITE requests routed to the participating MCPTT function with the Request-URI set to a public service identity of the participating MCPTT function that identifies the pre-established session set-up. Such requests are known as \"SIP INVITE request for establishing a pre-established session\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the participating MCPTT function and the Request-URI is set to a public service identity of the participating MCPTT function that does not identify the pre-established session set-up. Such requests are known as \"SIP INVITE request for originating participating MCPTT function\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the participating MCPTT function and the Request-URI contains a PSI of the terminating participating MCPTT function. Such requests are known as \"SIP INVITE request for terminating participating MCPTT function\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the controlling MCPTT function, the Request-URI is set to a public service identity for MCPTT private call and the Contact header field does not contain the isfocus media feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP INVITE request for controlling MCPTT function of a private call\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the controlling MCPTT function, the Request-URI is set to a public service identity serving an MCPTT group and the Contact header field does not contain the isfocus media feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the non-controlling MCPTT function of an MCPTT group, the Request-URI is set to a public service identity serving an MCPTT group and the Contact header field contains the isfocus media feature tag specified in IETF RFC 3840 [16]; Such requests are known as \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the non-controlling MCPTT function of an MCPTT group, the Request-URI is set to a public service identity serving an MCPTT group and the Contact header field does not contain the isfocus media feature tag specified in IETF RFC 3840 [16]; Such requests are known as \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" in the procedures in the present document;\n-\tSIP INVITE requests routed to the controlling MCPTT function, the Request-URI is set to a public service identity for first-to-answer call and the Contact header field does not contain the isfocus media feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP INVITE request for controlling MCPTT function of a first-to-answer call\" in the procedures in the present document; and\n-\tSIP INVITE requests routed to the controlling MCPTT function, the Request-URI is set to a public service identity for MCPTT ambient listening call and the Contact header field does not contain the isfocus media feature tag specified in IETF RFC 3840 [16]. Such requests are known as \"SIP INVITE request for controlling MCPTT function of an ambient listening call\" in the procedures in the present document.\nThe MCPTT server needs to distinguish between the following initial SIP REFER request for originations and terminations:\n-\tSIP REFER requests routed to the participating MCPTT function with the Request-URI set to a public service identity identifying the pre-established session on the participating MCPTT function. Such requests are known as \"SIP REFER request for a pre-established session\" in the procedures in the present document.\nThe MCPTT server needs to distinguish between the following SIP MESSAGE request for originations and terminations:\n-\tSIP MESSAGE requests routed to the participating MCPTT function with the Request-URI set to the MBMS public service identity of the participating MCPTT function. Such requests are known as \"SIP MESSAGE request for an MBMS listening status update\" in the procedures in the present document;\n-\tSIP MESSAGE request routed to the participating MCPTT function containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\" and including an XML body containing a Location root element containing a Report element. Such requests are known as \"SIP MESSAGE request for location reporting\" in the present document;\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing a <mcptt-Params> element containing an <emergency-ind> element or an <alert-ind> element. Such requests are known as \"SIP MESSAGE request for emergency notification for originating participating MCPTT function\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the terminating participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing a <mcptt-Params> element containing an <emergency-ind> element or an <alert-ind> element. Such requests are known as \"SIP MESSAGE request for emergency notification for terminating participating MCPTT function\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing a <mcptt-Params> element containing an <emergency-ind> element or an <alert-ind> element. Such requests are known as \"SIP MESSAGE request for emergency notification for controlling MCPTT function\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"private-call-call-back-request\" or \"private-call-call-back-cancel-request\", or with the <response-type> element set to a value of \"private-call-call-back-response\" or \"private-call-call-back-cancel-response\". Such requests are known as \"SIP MESSAGE request for private call call-back for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"private-call-call-back-request\" or \"private-call-call-back-cancel-request\", or with the <response-type> element set to a value of \"private-call-call-back-response\" or \"private-call-call-back-cancel-response\". Such requests are known as \"SIP MESSAGE request for private call call-back for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"private-call-call-back-request\". Such requests are known as \"SIP MESSAGE request for private call call-back request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"private-call-call-back-cancel-request\". Such requests are known as \"SIP MESSAGE request for private call call-back cancel request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"private-call-call-back-response\" or \"private-call-call-back-cancel-response\". Such requests are known as \"SIP MESSAGE request for private call call-back responses for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"group-selection-change-request\" or with the <response-type> element set to a value of \"group-selection-change-response\". Such requests are known as \"SIP MESSAGE request for group-selection-change for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"group-selection-change-request\" or with the <response-type> element set to a value of \"group-selection-change -response\". Such requests are known as \"SIP MESSAGE request for group-selection-change for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"group-selection-change-request\". Such requests are known as \"SIP MESSAGE request for group selection change request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"group-selection-change-response\". Such requests are known as \"SIP MESSAGE request for group selection change response for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-group-call-request\" or with the <response-type> element set to a value of \"remotely-initiated-group-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-group-call-request\" or with the <response-type> element set to a value of \"remotely-initiated-group-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-group-call-request\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"remotely-initiated-group-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated group call response for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-private-call-request\" or with the <response-type> element set to a value of \"remotely-initiated-private-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-private-call-request\" or with the <response-type> element set to a value of \"remotely-initiated-private-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"remotely-initiated-private-call-request\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"remotely-initiated-private-call-response\". Such requests are known as \"SIP MESSAGE request for remotely initiated private call response for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function and the Request-URI is set to a public service identity of the originating participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <groups-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a group regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function and the Request-URI is set to a public service identity of the originating participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <users-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a user regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function and the Request-URI is set to a public service identity of the originating participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body and a <regroup-action> element set to \"remove\". Such requests are known as \"SIP MESSAGE request to the originating participating MCPTT function to remove a regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function and the Request-URI is set to a public service identity of the participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <groups-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the terminating participating MCPTT function to create a group regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function and the Request-URI is set to a public service identity of the terminating participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\"and a non-empty <users-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the terminating participating MCPTT function to create a user regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function and the Request-URI is set to a public service identity of the terminating participating MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-info+xml MIME body and a <regroup-action> element set to \"remove\". Such requests are known as \"SIP MESSAGE request to the terminating participating MCPTT function to remove a regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the controlling MCPTT function and the Request-URI is set to a public service identity of the controlling MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <groups-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the controlling MCPTT function to request creation of a group regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the controlling MCPTT function and the Request-URI is set to a public service identity of the controlling MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <users-for-regroup> element. Such requests are known as \"SIP MESSAGE request to the controlling MCPTT function to request creation of a user regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the controlling MCPTT function and the Request-URI is set to a public service identity of the controlling MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup +xml MIME body and a <regroup-action> element set to \"remove\". Such requests are known as \"SIP MESSAGE request to the controlling MCPTT function to remove a regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to a non-controlling MCPTT function and the Request-URI is set to a public service identity of the non-controlling MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body, a <regroup-action> element set to \"create\", and a non-empty <groups-for-regroup> element. Such requests are known as \"SIP MESSAGE request to a non-controlling MCPTT function to request creation of a group regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the non-controlling MCPTT function and the Request-URI is set to a public service identity of the non-controlling MCPTT function that contains a <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body and a <regroup-action> element set to \"remove\". Such requests are known as \"SIP MESSAGE request to the non-controlling MCPTT function to remove a group regroup using preconfigured group\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"transfer-private-call-request\" or with the <response-type> element set to a value of \"transfer-private-call-response\". Such requests are known as \"SIP MESSAGE request for transfer private call for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"transfer-private-call-request\" or with the <response-type> element set to a value of \"transfer-private-call-response\". Such requests are known as \"SIP MESSAGE request for transfer private call for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"transfer-private-call-request\". Such requests are known as \"SIP MESSAGE request for transfer private call request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing a <mcpttinfo> root element with a <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"transfer-private-call-response\". Such requests are known as \"SIP MESSAGE request for transfer private call response for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing an <mcpttinfo> root element with an <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"forward-private-call-request\" or with the <response-type> element set to a value of \"forward-private-call-response\". Such requests are known as \"SIP MESSAGE request for forwarding private call for originating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing an <mcpttinfo> root element with an <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"forward-private-call-request\" or with the <response-type> element set to a value of \"forward-private-call-response\". Such requests are known as \"SIP MESSAGE request for forwarding private call for terminating participating MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing an <mcpttinfo> root element with an <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"forward-private-call-request\". Such requests are known as \"SIP MESSAGE request for forwarding private call request for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the controlling MCPTT function with the Request-URI set to the public service identity of the controlling MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and includes an XML body containing an <mcpttinfo> root element with an <mcptt-Params> element containing an <anyExt> element with the <response-type> element set to a value of \"forward-private-call-response\". Such requests are known as \"SIP MESSAGE request for forwarding private call response for controlling MCPTT function\";\n-\tSIP MESSAGE requests routed to the originating participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"fa-group-binding-req\". Such requests are known as \"SIP MESSAGE request for binding of a functional alias with the MCPTT group(s) for the MCPTT user for originating participating MCPTT function\" in the procedures in the present document;\n-\tSIP MESSAGE requests routed to the controlling participating MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function and containing a Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and including an XML body containing a <mcpttinfo> root element containing a <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"fa-group-binding-req\". Such requests are known as \"SIP MESSAGE request for binding of a functional alias with the MCPTT group(s) for the MCPTT user for controlling MCPTT function\" in the procedures in the present document;\n-\tSIP MESSAGE requests which is routed to the primary MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function in the primary MCPTT system and includes an application/vnd.3gpp.mcvideo-info+xml MIME body with the <mcvideo-Params> element containing an <mcvideo-request-uri> element, a <partner-mcvideo-id> element, and a <selected-user-profile-index> element. Such requests are known as \"SIP MESSAGE request for migration service authorization request\" in the procedures in the present document; and\n-\tSIP MESSAGE requests which is routed to the partner MCPTT function with the Request-URI set to the public service identity of the participating MCPTT function in the partner MCPTT system and includes an application/vnd.3gpp.mcvideo-info+xml MIME body with the <mcvideo-Params> element containing an <mcptt-request-uri> element, a <partner-mcptt-id> element, and a <migration-auth-result> element. Such requests are known as \"SIP MESSAGE request for migration service authorization response\" in the procedures in the present document.\nThe MCPTT server needs to distinguish between the following SIP SUBSCRIBE request for originations and terminations:\n-\tSIP SUBSCRIBE requests routed to the participating MCPTT function with the Request-URI set to the MCPTT session identity identifying the participating MCPTT function and the Event header field set to \"conference\". Such requests are known as \"SIP SUBSCRIBE request for conference event status subscription in the participating function\" in the procedures in the present document;\n-\tSIP SUBSCRIBE requests routed to the controlling MCPTT function with the Request-URI set to the MCPTT session identity identifying the controlling MCPTT function and containing an Event header field set to \"conference\". Such requests are known as \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" in the procedures in the present document; and\n-\tSIP SUBSCRIBE requests routed to the non-controlling MCPTT function with the Request-URI set to the MCPTT session identity identifying the non-controlling MCPTT function and containing an Event header field set to \"conference\". Such requests are known as \"SIP SUBSCRIBE request for conference event status subscription in the non-controlling MCPTT function\" in the procedures in the present document.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.2\tParticipating MCPTT Function",
                            "text_content": "This clause is referenced from other clauses.\nThe SDP offer is generated based on the received SDP offer. The SDP offer generated by the participating MCPTT function:\n1)\tshall contain only one SDP media-level section for MCPTT speech as contained in the received SDP offer; and\n2)\tshall contain one SDP media-level section for media plane control messages, if present in the received SDP offer.\nWhen composing the SDP offer according to 3GPP TS 24.229 [4], the participating MCPTT function:\n1)\tshall replace the IP address and port number for the offered media stream in the received SDP offer with the IP address and port number of the participating MCPTT function, if required;\nNOTE 1:\tRequirements can exist for the participating MCPTT function to be always included in the path of the offered media stream, for example: for the support of features such as MBMS, lawful interception and recording. Other examples can exist.\n2)\tshall replace the IP address and port number for the offered media plane control channel, if any, in the received SDP offer with the IP address and port number of the participating MCPTT function;\n3)\tshall replace the mc_floor_ssrc 'fmtp' attribute for the offered media plane control channel, if any, in the received SDP offer with the RTCP SSRC that the participating MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the answerer (i.e. MCPTT client or controlling MCPTT function) in the floor control messages sent to the participating MCPTT function for this session; and\nNOTE 2:\tThe participating MCPTT function will receive in the SDP answer the RTP SSRC it will have to use in the floor control message it will send to the answerer in this session.\nNOTE 3:\tIf the participating MCPTT function and the controlling MCPTT function or the participating MCPTT function and the non-controlling MCPTT function are in the same MCPTT server, and the participating MCPTT function does not have a dedicated IP address or a dedicated port number for media plane control channel or media stream, the replacement of the IP address or the port number is omitted.\n4)\tshall contain an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value, if present in the received SDP offer.\nThis clause is referenced from other clauses.\nWhen composing an SDP offer according to 3GPP TS 24.229 [4], the participating MCPTT function:\n1)\tshall use the IP address of the participating MCPTT function for MCPTT speech from the SDP negotiated during the pre-established session establishment;\n2)\tshall use the IP address of the participating MCPTT function for the offered media plane control channel from the SDP negotiated during the pre-established session establishment, if present in the received SDP offer;\n3)\tshall contain only one SDP media-level section for MCPTT speech obtained from the SDP negotiated during the pre-established session establishment consisting of:\na)\tthe port number for the MCPTT speech; and\nb)\tthe codec(s), media parameters and attributes as in the SDP negotiated during the pre-established session establishment;\n4)\tshall include the media-level section of the offered media plane control channel from the SDP negotiated during the pre-established session establishment, if any media plane control channel is offered consisting of:\na)\tthe media plane control channel parameters as in the SDP negotiated during the pre-established session establishment;\nb)\tthe port number for the selected media plane control channel selected as specified in 3GPP TS 24.229 [4]; and\nc)\tthe mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14 for the selected media plane control channel with the RTCP SSRC that the participating MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the answerer in the floor control messages sent to the participating MCPTT function for this session; and\nNOTE:\tThe participating MCPTT function will receive in the SDP answer the RTP SSRC it will have to use in the floor control message it will send to the answerer in this session.\n5)\tshall contain an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value if present in the received SDP offer.\nWhen composing the SDP answer according to 3GPP TS 24.229 [4], the participating MCPTT function:\n1)\tshall replace the IP address and port number in the received SDP answer with the IP address and port number of the participating MCPTT function, for the accepted media stream in the received SDP offer, if required;\nNOTE 1:\tRequirements can exist for the participating MCPTT function to be always included in the path of the offered media stream, for example: for the support of features such as MBMS, lawful interception and recording. Other examples can exist.\n2)\tshall replace the IP address and port number in the received SDP answer with the IP address and port number of the participating MCPTT function, for the accepted media plane control channel, if present in the received SDP offer; and\n3)\tshall replace the mc_floor_ssrc 'fmtp' attribute for the accepted media plane control channel, if present in the received SDP answer with the RTCP SSRC that the participating MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the offerer (i.e. MCPTT client or controlling MCPTT function) in the floor control messages sent to the participating MCPTT function for this session.\nNOTE 2:\tThe participating MCPTT function has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the offerer in this session.\nNOTE 3:\tIf the participating MCPTT function and the controlling MCPTT function or the participating MCPTT function and the non-controlling MCPTT function are in the same MCPTT server, and the participating MCPTT function does not have a dedicated IP address or a dedicated port number for media plane control channel or media stream, the replacement of the IP address or the port number is omitted.\nWhen composing the SDP answer according to 3GPP TS 24.229 [4], the participating MCPTT function:\n1.\tshall set the IP address and port number to those of the participating MCPTT function for each accepted media stream from the list contained in the received SDP offer and for each accepted media stream in the received SDP offer;\n2.\tshall set the IP address,and port number to those of the participating MCPTT function, for the accepted media plane control channel, if present in the received SDP offer; and\n3)\tshall set the mc_floor_ssrc 'fmtp' attribute for the accepted media plane control channel, if present in the received SDP offer, with the RTCP SSRC that the participating MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the offerer in the floor control messages sent to participating MCPTT function for this session.\nNOTE:\tThe participating MCPTT function has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the offerer in this session.\nThis clause is referenced from other procedures.\nWhen generating an initial SIP INVITE request according to 3GPP TS 24.229 [4], on receipt of an incoming SIP INVITE request, the participating MCPTT function:\n1)\tshall include in the SIP INVITE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] if included in the incoming SIP INVITE request;\n2)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n3)\tshall include the option tag \"timer\" in the Supported header field;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the originating participating MCPTT function;\n5)\tshall include the g.3gpp.mcptt media feature tag into the Contact header field of the outgoing SIP INVITE request;\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request;\n7)\tif the incoming SIP INVITE request contained an application/resource-lists+xml MIME body, shall copy the application/resource-lists+xml MIME body, according to rules and procedures of IETF RFC 5366 [20];\n8)\tif the incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request to the outgoing SIP INVITE request; and\n9)\tif, according to clause 6.4, the SIP INVITE request is regarded as being not received with an implicit floor request, then:\na)\tif the incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nshall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the SIP INVITE request into the outgoing SIP INVITE.\nThis clause is referenced from other procedures.\nWhen generating an initial SIP INVITE request according to 3GPP TS 24.229 [4], on receipt of an incoming SIP REFER request, the participating MCPTT function:\n1)\tshall include in the SIP INVITE request all header fields included in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field in the incoming SIP REFER request;\n2)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n3)\tshall include the option tag \"timer\" in the Supported header field;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the participating MCPTT function;\n5)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" into the Contact header field of the outgoing SIP INVITE request;\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request;\n7)\tshall include in the SIP INVITE request the option tag \"tdialog\" in a Supported header field according to the rules and procedures of IETF RFC 4538 [23];\n8)\tshall include in the SIP INVITE request an SDP offer as specified in clause 6.3.2.1.1.2 based upon:\na)\tthe SDP negotiated during the pre-established session establishment and any subsequent pre-established session modification; and\nb)\tthe SDP offer (if any) included in the hname \"body\" parameter in the headers portion of the SIP URI contained in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists MIME body, referenced by the \"cid\" URL in the Refer-To header field in the incoming SIP REFER request for a pre-established session;\n9)\tshall determine if the SIP REFER request is regarded as being received with an implicit floor request;\na)\tif according to clause 6.4, the SIP REFER request is regarded as being received with an implicit floor request, the participating MCPTT function shall include the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer of the SIP INVITE request; and\nb)\tif, according to clause 6.4, the SIP REFER request is regarded as being not received with an implicit floor request, the participating MCPTT function shall not include the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer of the SIP INVITE request;\n10)\tshall determine if the SIP REFER request is regarded as being received with an implicit request to grant the floor to the terminating MCPTT client;\na)\tif according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the terminating MCPTT client, the participating MCPTT function shall include the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer of the SIP INVITE request; and\nb)\tif, according to clause 6.4, the SIP REFER request is regarded as being not received with an implicit request to grant the floor to the terminating MCPTT client, the participating MCPTT function shall not include the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer of the SIP INVITE request;\n11)\tshall copy the application/vnd.3gpp.mcptt-info+xml MIME body from the hname \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field of the SIP REFER request, to the outgoing SIP INVITE request;\n11A)\tif the application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP INVITE request contains a <functional-alias-URI> element, shall check the status of the functional alias. If the status is not active, then the participating MCPTT function shall remove the <functional-alias-URI> element from the application/vnd.3gpp.mcptt-info+xml MIME body;\n12)\tshall include the <mcptt-calling-user-id> element set to the MCPTT ID of the calling user in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request;\n13)\tif the incoming SIP REFER request contained an application/resource-lists+xml MIME body in the hname \"body\" parameter in the headers portion of the SIP URI contained in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field, shall copy the application/resources-lists+xml MIME body in the hname \"body\" parameter in the headers portion of the SIP URI to the SIP INVITE request; and\n14)\tif, according to clause 6.4, the SIP REFER request is regarded as being not received with an implicit floor request, then:\na)\tif the incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nshall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the SIP REFER request into the outgoing SIP INVITE.\nNOTE:\tThis clause is referenced from other procedures\nWhen sending SIP provisional responses other than the SIP 100 (Trying) response, the participating MCPTT function shall generate a SIP provisional response according to 3GPP TS 24.229 [4] and:\n1)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\nc)\tthe isfocus media feature tag; and\nd)\tan MCPTT session identity mapped to the MCPTT session identity if provided in the Contact header field of the incoming provisional response;\n2)\tshall include the \"norefersub\" option tag in a Supported header field in accordance with 3GPP TS 24.229 [4];\n3)\tmay include a Resource-Share header field in accordance with clause 5.7.1.20.2 in 3GPP TS 24.229 [4]; and\n4)\tif the incoming SIP provisional response contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing SIP provisional response.\nThis clause is referenced from other procedures.\nWhen sending SIP 200 (OK) responses, the participating MCPTT function shall generate a SIP 200 (OK) response according to 3GPP TS 24.229 [4] and:\n1)\tshall include the option tag \"timer\" in a Require header field;\n2)\tshall include the Session-Expires header field according to rules and procedures of IETF RFC 4028 [7], \"UAS Behavior\". If the \"refresher\" parameter is not included in the received request, the \"refresher\" parameter in the Session-Expires header field shall be set to \"uac\";\n3)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\nc)\tthe isfocus media feature tag;\n4)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23];\n5)\tshall include the option tag \"norefersub\" in a Supported header field according to rules and procedures of IETF RFC 4488 [22];\n6)\tmay include a Resource-Share header field in accordance with clause 5.7.1.20.2 in 3GPP TS 24.229 [4]; and\n7)\tif the incoming SIP 200 (OK) response contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing SIP 200 (OK) response.\nUpon receiving a SIP BYE request from the MCPTT client, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5];\n2)\tshall generate a SIP BYE request as specified in 3GPP TS 24.229 [4];\n3)\tshall set the Request-URI to the MCPTT session identity as included in the received SIP BYE request;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP BYE request set to the public service identity of the participating MCPTT function;\n5)\tif the received SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body into the outgoing SIP BYE request; and\n6)\tshall send the SIP BYE request toward the controlling MCPTT function, according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the terminating MCPTT function shall forward a SIP 200 (OK) response to the MCPTT client and shall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the controlling MCPTT function.\nUpon receiving a SIP REFER request with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field from the MCPTT client, the participating MCPTT function:\n1)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\n2)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID shall reject the SIP REFER request with a SIP 403 (Forbidden) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif the SIP REFER request contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\n4)\tshall generate a SIP 200 (OK) response to the SIP REFER request, and in the SIP 200 (OK) response:\na)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22]; and\nb)\tshall check the presence of the Refer-Sub header field of the SIP REFER request and if it is present and set to the value \"false\" shall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\nNOTE:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n5)\tshall send the SIP 200 (OK) response to the SIP REFER request towards MCPTT client according to 3GPP TS 24.229 [4];\n6)\tshall generate a SIP BYE request, and in the SIP BYE request:\na)\tshall set the Request-URI to the MCPTT session identity which was included at the Refer-To header field of the received REFER request; and\nb)\tshall include a P-Asserted-Identity header field in the outgoing SIP BYE request set to the public service identity of the participating MCPTT function; and\n7)\tshall send the SIP BYE request toward the controlling MCPTT function according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the participating MCPTT function shall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the controlling MCPTT function.\nThe clauses of the parent clause contain common procedures to be used for MCPTT emergency group calls and MCPTT imminent peril group calls.\nWhen the participating MCPTT function receives a request from the MCPTT client to originate an MCPTT emergency group call and needs to determine if the request is an authorised request for an MCPTT emergency call, the participating MCPTT function shall check the following:\n1)\tif the <allow-emergency-group-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\" and:\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and if the <uri-entry> element of the <entry> element of the <MCPTTGroupInitiation> element contains the identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\";\nthen the participating MCPTT function shall consider the MCPTT emergency group call request to be an authorised request for an MCPTT emergency group call;\nIn all other cases, the participating MCPTT function shall consider the request to originate an MCPTT emergency group call to be an unauthorised request to originate an MCPTT emergency group call.\nWhen the participating MCPTT function receives a request from the MCPTT client to originate an MCPTT imminent peril group call and needs to determine if the request is an authorised request for an MCPTT imminent peril group call the participating MCPTT function shall check the following:\n1)\tif the <allow-imminent-peril-call> element of <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\na)\tif the \"entry-info\" attribute of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and if the <uri-entry> element of the <entry> element of the <MCPTTGroupInitiation> element contains the identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\";\nthen the participating MCPTT function shall consider the MCPTT imminent peril group call request to be an authorised request for an MCPTT emergency group call;\nIn all other cases, the participating MCPTT function shall consider the request to originate an MCPTT imminent peril group call to be an unauthorised request to originate an MCPTT imminent peril call.\nIf the participating MCPTT function receives a SIP request from the MCPTT client including a request for an MCPTT emergency alert and:\n1)\tif the <allow-activate-emergency-alert> element of the <actions> element of the <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\n2)\tif the \"entry-info\" attribute of the <entry> element of the <EmergencyAlert> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of:\na)\t\"DedicatedGroup\", and if the <uri-entry> element of the <entry> element of the <EmergencyAlert> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) contains the MCPTT group identity of the MCPTT group targeted by the calling MCPTT user; or\nb)\t\"UseCurrentlySelectedGroup\" and the <allow-MCPTT-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the <list-service> element of the group document identified by the MCPTT group identity targeted for the emergency alert is set to a value of \"true\" as specified in 3GPP TS 24.481 [31].\nthen the MCPTT emergency alert request shall be considered to be an authorised request for an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request for an MCPTT emergency alert.\nIf the participating MCPTT function receives a SIP request from the MCPTT client including a request to cancel an MCPTT emergency alert to an MCPTT group, and if the <allow-cancel-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency alert cancellation request shall be considered to be an authorised request to cancel an MCPTT emergency alert. In all other cases, it shall be considered to be an unauthorised request to cancel an MCPTT emergency alert.\nThis clause is referenced from other procedures.\nTo validate the combinations of <emergency-ind>, <imminentperil-ind> and <alert-ind> which are received in SIP requests, the participating MCPTT function shall follow the procedures specified in clause 6.3.3.1.17.\nThis clause is referenced from other procedures.\nThe participating MCPTT function shall follow the procedures specified in clause 6.3.3.1.19 with the clarification that references in that procedure to the controlling MCPTT function should be replaced with references to the participating MCPTT function.\nThis clause is referenced from other procedures.\nUpon receipt of a SIP 2xx response which does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\" to a SIP INVITE request sent to the controlling MCPTT function which contained a Resource-Priority header field populated for an MCPTT emergency group call or MCPTT imminent peril group call as specified in clause 6.3.2.1.8.4, the participating MCPTT function:\n1)\tshall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer based upon the previously negotiated SDP for the pre-established session;\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall skip the remaining steps.\nNOTE 1:\tThis is the case where the MCPTT client's previously sent SIP REFER request was either 1) a request for an MCPTT emergency group call or MCPTT imminent peril group call or 2), was not a request for an MCPTT emergency group call or MCPTT imminent peril group call but targeted an MCPTT group which is in an in-progress emergency group state or in-progress imminent peril group state. In either case no SIP INFO pending warning was expected or received.\nUpon receipt of a SIP 2xx response from the controlling MCPTT function to a request for an MCPTT emergency call or MCPTT imminent peril call, that contains a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", the participating MCPTT function shall wait for the receipt of a SIP INFO request from the controlling MCPTT function.\nUpon receipt of a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency call or MCPTT imminent peril call, the participating MCPTT function:\n1)\tshall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer based upon the previously negotiated SDP for the pre-established session;\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in shall include a Resource-Priority header field with the contents set as in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body containing:\na)\tan <emergency-ind> element if included in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INFO request, set to the value of the <emergency-ind> in the SIP INFO request;\nb)\tan <alert-ind> element if included in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INFO request, set to the value of the <alert-ind> in the SIP INFO request; and\nc)\tan <imminentperil-ind> element if included in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INFO request, set to the value of the <imminentperil-ind> in the SIP INFO request.\nNOTE 2:\tThis is the case where the MCPTT client's previously sent SIP REFER request was a request for an MCPTT emergency group call or an MCPTT imminent peril group call and a SIP INFO request was received in the dialog with the controlling MCPTT function for the MCPTT emergency group call or MCPTT imminent peril group call.\nThis clause is referenced from other procedures.\nUpon receipt of a SIP 2xx response which does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\" to a SIP-INVITE request sent to the controlling MCPTT function which contained a Resource-Priority header field populated for an MCPTT emergency private call as specified in clause 6.3.2.1.8.4, the participating MCPTT function:\n1)\tshall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer:\na)\tbased upon the previously negotiated SDP for the pre-established session; and\nb)\tif the received SIP 2xx response was in response to a request for a first-to-answer call and the SDP answer contained an a=key-mgmt attribute, shall include the a=key-mgmt attribute and its value in the SDP offer as specified in IETF RFC 4567 [47];\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall skip the remaining steps.\nNOTE 1:\tThis is the case where the MCPTT client's previously sent SIP REFER request was either 1) a request for an MCPTT emergency private call or 2), was not a request for an MCPTT emergency private call but MCPTT emergency private priority state was already set to \"in-progress\". In either case no SIP INFO pending warning was expected or received.\nUpon receipt of a SIP 2xx response from the controlling MCPTT function to a request for an MCPTT emergency private call, that contains a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", the participating MCPTT function shall wait for the receipt of a SIP INFO request from the controlling MCPTT function.\nUpon receipt of a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency private call, the participating MCPTT function :\n1)\tshall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] to be sent within the SIP dialog of the pre-established session;\n2)\tshall include in the SIP re-INVITE request an SDP offer:\na)\tbased upon the previously negotiated SDP for the pre-established session; and\nb)\tif the received SIP 2xx response was in response to a request for a first-to-answer call and the SDP answer contained an a=key-mgmt attribute, shall include the a=key-mgmt attribute and its value in the SDP offer as specified in IETF RFC 4567 [47];\n3)\tshall include in the SIP re-INVITE request a Resource-Priority header field with the contents set as in the Resource-Priority header field included in the SIP INVITE request sent to the controlling MCPTT function; and\n4)\tshall include in the SIP re-INVITE request an application/vnd.3gpp.mcptt-info+xml MIME body containing:\na)\tan <alert-ind> element if included in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INFO request, set to the value of the <alert-ind> in the SIP INFO request.\nNOTE 2:\tThis is the case where the MCPTT client's previously sent SIP REFER request was a request for an MCPTT emergency private call and a SIP INFO request was received in the dialog with the controlling MCPTT function for the MCPTT emergency private call.\nThis clause is referenced from other procedures.\nUpon receipt of a SIP 2xx response to a SIP INVITE request for a first-to-answer call which contains an SDP answer including an a=key-mgmt attribute, the participating MCPTT function:\n1)\tshall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] to be sent within the SIP dialog of the pre-established session; and\n2)\tshall include in the SIP re-INVITE request an SDP offer:\na)\tbased upon the previously negotiated SDP for the pre-established session; and\nb)\tcontaining the a=key-mgmt attribute and value as received in the SDP answer in the SDP offer as specified in IETF RFC 4567 [47].\nThis clause is referenced from other procedures.\nWhen generating a SIP re-INVITE request according to 3GPP TS 24.229 [4] on receipt of an incoming SIP re-INVITE request, the participating MCPTT function:\n1)\tif the incoming SIP re-INVITE request contained an application/resource-lists MIME body with the MCPTT ID of the invited MCPTT user, shall copy the application/resource-lists MIME body, according to rules and procedures of IETF RFC 5366 [20];\n2)\tif the incoming SIP re-INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\tif the incoming SIP re-INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body.\nThis clause is referenced from other procedures.\nThe participating MCPTT function shall generate a SIP INVITE request according to rules and procedures of 3GPP TS 24.229 [4].\nThe participating MCPTT function:\n1)\tshall determine the public service identity of the non-controlling MCPTT function associated with the group identity of the constituent group contained in the <associated-group-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request. If the participating MCPTT function is unable to identify the non-controlling MCPTT function for the on demand prearranged group call, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 1:\tThe public service identity can identify the non-controlling MCPTT function in the local MCPTT system or in an interconnected MCPTT system.\nNOTE 2:\tIf the non-controlling MCPTT function is in an interconnected MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the interconnected MCPTT system from the local MCPTT system.\nNOTE 3:\tIf the non-controlling MCPTT function is in an interconnected MCPTT system in a different trust domain, then the local MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the local MCPTT system to the interconnected MCPTT system\nNOTE 4:\tHow the participating MCPTT function determines the public service identity of the non-controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the interconnected MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the local MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall set the Request-URI of the generated SIP INVITE request to the public service identity determines in step 1;\n3)\tshall include in the SIP INVITE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] if included in the original incoming SIP INVITE or SIP REFER request from the MCPTT client;\n4)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n5)\tshall include the option tag \"timer\" in the Supported header field;\n6)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the participating MCPTT function;\n7)\tshall include the g.3gpp.mcptt media feature tag into the Contact header field of the outgoing SIP INVITE request;\n8)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the outgoing SIP INVITE request;\n9)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request;\n10)\tif a SIP INVITE request was received from the client containing an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body of the original incoming SIP INVITE request to the outgoing SIP INVITE request;\n11)\tif a SIP REFER request was received from the client with a \"cid\" URL pointing to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body and the SIP URI contains an hname \"body\" parameter in the headers portion of the SIP URI containing an application/vnd.3gpp.mcptt-info MIME body, shall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP REFER request to the outgoing SIP INVITE request; and\n12)\tshall set the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the MCPTT ID of the calling user that was determined when the participating MCPTT function received the SIP INVITE request or SIP REFER request from the client.\nThe participating MCPTT function shall follow the procedures in clause 6.3.2.1.1.\nThe participating MCPTT function shall follow the procedures in clause 6.3.2.1.2.1.\nWhen composing an SDP answer according to 3GPP TS 24.229 [4], the participating MCPTT function:\n1)\tshall set the IP address of the participating MCPTT function for the accepted MCPTT speech media stream from the received SDP offer, which was also negotiated during the pre-established session establishment;\n2)\tshall set the IP address of the participating MCPTT function for the accepted media-floor control entity from the received SDP offer, which was also negotiated during the pre-established session establishment, if present in the received SDP offer;\n3)\tshall include the media-level section for the accepted MCPTT speech media stream from the received SDP offer, which was also negotiated in pre-established session establishment, consisting of:\na)\tthe port number for MCPTT speech; and\nb)\tthe codec(s) and media parameters selected by the participating MCPTT function from the received SDP offer; and\n4)\tshall include for the media plane control channel, that is offered in the SDP offer from the controlling MCPTT function and accepted in the SDP answer by MCPTT client, the media-level section of each offered media plane control channel consisting of:\na)\tthe media plane control channel parameters contained in the received SDP offer, restricted to media plane control channel parameters negotiated during the pre-established session establishment;\nb)\tthe port number for selected media plane control channel selected as specified in 3GPP TS 24.229 [4]; and\nc)\tan mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14 for the accepted media plane control channel, with the RTCP SSRC that the participating MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the offerer in the floor control messages sent to participating MCPTT function for this session.\nNOTE:\tThe participating MCPTT function has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the offerer in this session.\nThe participating MCPTT function shall generate an initial SIP INVITE request according to 3GPP TS 24.229 [4] and:\n1)\tshall include in the SIP INVITE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] if included in the incoming SIP INVITE request;\n2)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n3)\tshall include the option tag \"timer\" in the Supported header field;\n4)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\nc)\tthe isfocus media feature tag;\nd)\tan MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the incoming SIP INVITE request; and\ne)\tany other uri-parameter provided in the Contact header field of the incoming SIP INVITE request;\n5)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23];\n6)\tshall include the option tag \"norefersub\" in a Supported header field according to rules and procedures of IETF RFC 4488 [22];\n7)\tmay include a Resource-Share header field in accordance with clause 5.7.1.20.3 in 3GPP TS 24.229 [4]; and\n8)\tif the incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing SIP INVITE request.\nThis clause is referenced from other procedures.\nWhen sending a SIP provisional response other than the SIP 100 (Trying) response to the SIP INVITE request, the participating MCPTT function shall generate a SIP provisional response according to 3GPP TS 24.229 [4] and:\n1)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag; and\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2)\tif the outgoing SIP provisional response is to be sent in response to the receipt of a SIP provisional response and the response contains an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing SIP provisional response; and\n3)\tif the incoming SIP INVITE request included the Supported header field with the value \"100rel\" and according to local policy, may include the Require header field with the value \"100rel\".\nThis clause is referenced from other procedures.\nWhen sending SIP 200 (OK) responses, the participating MCPTT function shall generate a SIP 200 (OK) response according to 3GPP TS 24.229 [4] and:\n1)\tshall include the option tag \"timer\" in a Require header field;\n2)\tshall include the Session-Expires header field according to rules and procedures of IETF RFC 4028 [7], \"UAS Behavior\". If no \"refresher\" parameter was included in the SIP INVITE request, the \"refresher\" parameter in the Session-Expires header field shall be set to \"uas\";\n3)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\nc)\tan MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP INVITE request from the controlling MCPTT function;\n4)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23]; and\n5)\tif the incoming SIP response contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing SIP 200 (OK) response.\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" that requires automatic commencement mode:\n1)\tif:\na)\tthe invited MCPTT client has one or more pre-established sessions without an associated MCPTT call;\nb)\tthe media-level section for the offered MCPTT speech media stream is the same as the media-level section for MCPTT speech media stream in an existing pre-established session; and\nc)\tthe media-level section of the offered media-floor control entity is the same as the media-level section for media-floor control entity in an existing pre-established session;\nthen the participating MCPTT function shall perform the actions specified in clause 6.3.2.2.5.3; or\n2)\totherwise the participating MCPTT function shall perform the actions specified in clause 6.3.2.2.5.2.\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" for an on-demand session that requires automatic commencement mode the participating MCPTT function:\n1)\tif:\na)\tthe incoming SIP INVITE request contained a Priv-Answer-Mode header field set to the value of \"Auto\";\nb)\tno Answer-Mode header field or Priv-Answer-Mode header field were received in the incoming SIP INVITE request and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\"; or\nc)\tthe incoming SIP INVITE request contained an Answer-Mode header field set to \"Auto\" and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\";\nthen:\na)\tshall generate a SIP 183 (Session Progress) response to the \"SIP INVITE request for terminating participating MCPTT function\" as specified in clause 6.3.2.2.4.1;\nb)\tif the received SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <ambient-listening-type> element set to a value of \"remote-init\" shall include in the SIP 183 (Session Progress) response an alert-info header field set to a value of \"<>\" according to IETF RFC 3261 [24] and as updated by IETF RFC 7462 [77]; and\nNOTE:\tThe SIP 183 (session Progress) response can be sent reliably or unreliably depending on the content of the received SIP INVITE request. Regardless of if the SIP 183 (Session Progress) response is sent reliably or unreliably, SDP is not included in the SIP 183 (Session Progress) response.\nc)\tshall set the P-Answer-State header field to \"Unconfirmed\" in the SIP 183 (Session Progress) response;\n2)\tshall include a P-Asserted-Identity header field in the SIP 183 (Session Progress) response set to the public service identity of the participating MCPTT function;\n3)\tshall generate a SIP INVITE request as specified in clause 6.3.2.2.3;\n4)\tshall set the Request-URI to the public user identity associated to the MCPTT ID of the MCPTT user to be invited;\n5)\tshall perform the procedures specified in clause 6.3.2.2.9 to include any MIME bodies in the received SIP INVITE request, into the outgoing SIP INVITE request;\n6)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the participating MCPTT function;\n7)\tif the Priv-Answer-Mode header field is present in the incoming SIP INVITE request with a value of \"Auto\", shall include a Priv-Answer-Mode header field with the value \"Auto\" in the outgoing SIP INVITE request. Otherwise, if the Answer-Mode header field is present in the incoming SIP INVITE request, the participating MCPTT function shall include an Answer-Mode header field with the value \"Auto\" in the outgoing SIP INVITE request;\n8)\tif no Answer-Mode header field or Priv-Answer-Mode header field were received in the incoming SIP INVITE request and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\", shall set the Answer-Mode header field to \"Auto\" in the outgoing SIP INVITE request;\n9)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received \"SIP INVITE request for terminating participating MCPTT function\" as specified in clause 6.3.2.2.1;\n10)\tif the received SIP INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field; and\n11)\tshall send the SIP INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nIf the SIP 183 (Session Progress) response was sent reliably, then upon receiving a SIP PRACK request, the participating MCPTT function shall generate a SIP 200 (OK) response to the SIP PRACK request and forward the SIP 200 (OK) response, according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP INVITE request sent to the MCPTT client, the participating MCPTT function:\n1)\tif the SIP 183 (Session Progress) was sent unreliably, shall send the SIP 200 (OK) response immediately; and\n2)\tif the SIP 183 (Session Progress) was sent reliably and,\na)\tif the SIP PRACK request to the SIP 183 (Session Progress) response has been received by the participating MCPTT function and the SIP 200 (OK) response to the SIP PRACK request has been sent, shall send the SIP 200 (OK) response immediately;\nb)\tif the SIP PRACK request to the SIP 183 (Session Progress) response has not yet been received, then upon receipt of the SIP PRACK request, the participating MCPTT function shall generate a SIP 200 (OK) response to the SIP PRACK request and forward the SIP 200 (OK) response, according to 3GPP TS 24.229 [4], before sending the SIP 200 (OK) response to the \"SIP INVITE request for terminating participating MCPTT function\".\nWhen the participating MCPTT function sends the SIP 200 (OK) response to the \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n3A)\tif the SIP 183 (Session Progress) was sent with the P-Answer-State header field set to \"Unconfirmed\", shall set the P-Answer-State header field to \"Confirmed\" in the outgoing SIP 200 (OK) response;\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n5)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nThe participating MCPTT function shall forward any other SIP response that does not contain SDP along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nNOTE 1:\tThis clause is referenced from other procedures.\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" for a pre-established session that requires automatic commencement mode the participating MCPTT function:\n1)\tif the received SIP INVITE request contains:\na)\tan application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\" or with the <imminentperil-ind> element set to a value of \"true\"; or\nb)\ta Priv-Answer-Mode header field;\nshall perform the procedures of clause 6.3.2.2.5.2 with the following clarifications:\na)\tinclude in the outgoing SIP INVITE request a Replaces header field populated with the call-id, to-tag and from-tag of the targeted pre-established session as specified in IETF RFC 3891 [65];\nb)\tinclude in the SDP offer the current media parameters used by the targeted pre-established session identified by the Replaces header field; and\nc)\tif the SIP core supports resource sharing, include in the outgoing SIP INVITE request a Resource-Share header field as specified in 3GPP TS 24.229 [4] with:\ni)\tthe value \"media-sharing\";\nii)\tan \"origin\" header field parameter set to \"session-receiver\";\niii)\ta \"timestamp\" header field parameter; and\niv)\ta \"rules\" header field parameter with one resource sharing rule per media stream in the same order the corresponding m-line appears in the SDP. Each resource sharing rule is constructed as follows:\n-\ta \"new-sharing-key\" part containing the same key as that included when the media bearer for the pre-established session was established; and\n-\ta \"directionality\" part indicating the direction of the pre-established media bearer;\nand shall skip the remaining steps of this clause;\n2)\tshall generate a SIP 200 (OK) response to the \"SIP INVITE request for terminating participating MCPTT function\" as described in the clause 6.3.2.2.4.2;\n3)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.2.2.2 based on the SDP negotiated during the pre-established session establishment and SDP offer received in the \"SIP INVITE request for terminating participating MCPTT function\";\n4)\tshall set the P-Answer-State header field to \"Unconfirmed\" in the SIP 200 (OK) response;\n5)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT functionshall include a P-Asserted-Identity header field set to the;\n6)\tshall send the SIP 200 (OK) response to the SIP INVITE request according to 3GPP TS 24.229 [4]; and\n7)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 9.\nNOTE 2:\tReceived SIP INVITE requests handled by the present clause in steps 2) through 7) will result in the terminating client not receiving data normally contained in an application/ vnd.3gpp.mcptt-info+xml MIME body. This includes but is not limited to call type indicators such as XML elements <broadcast-ind> or <associated-group>.\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" that requires manual commencement mode:\n1)\tif:\na)\tthe invited MCPTT client has one or more pre-established sessions without an associated MCPTT call;\nb)\tthe media-level section for the offered MCPTT speech media stream is the same as the media-level section for MCPTT speech media stream in the existing pre-established session; and\nc)\tthe media-level section of the offered media-floor control entity is the same as the media-level section for media-floor control entity in the existing pre-established session;\nthen the participating MCPTT function shall perform the actions specified in clause 6.3.2.2.6.3; or\n2)\totherwise the participating MCPTT function shall perform the actions specified in clause 6.3.2.2.6.2.\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" for an on-demand session that requires manual commencement mode the participating MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.2.2.3;\n2)\tshall set the Request-URI to the public user identity associated to the MCPTT ID of the MCPTT user to be invited;\n3)\tshall perform the procedures specified in clause 6.3.2.2.9 to include any MIME bodies in the received SIP INVITE request;\n4)\tif the Answer-Mode header field is present in the incoming SIP INVITE request, participating MCPTT function, shall include an Answer-Mode header field with the value \"Manual\";\n5)\tif no Answer-Mode header field was received in the incoming SIP INVITE request and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4 is set to \"manual-answer\", shall set the Answer-Mode header field to \"Manual\" in the outgoing SIP INVITE request;\n6)\tif the Priv-Answer-Mode header field is present in the incoming SIP INVITE request, the participating MCPTT function shall include a Priv-Answer-Mode header field with the value \"Manual\";\n7)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the participating MCPTT function;\n8)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received \"SIP INVITE request for terminating participating MCPTT function\" as specified in clause 6.3.2.2.1;\n9)\tif the received SIP INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field; and\n10)\tshall send the SIP INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 180 (Ringing) response to the above SIP INVITE request, the participating MCPTT function:\nNOTE 1:\tA SIP 180 (Ringing) response is received from a terminating MCPTT client in the case of a private call or first-to-answer call.\n1)\tshall generate a SIP 180 (Ringing) response as specified in clause 6.3.2.2.4.1;\n2)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function; and\n3)\tshall forward the SIP 180 (Ringing) response according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response to the above SIP INVITE request, the participating MCPTT function:\nNOTE 2:\tA SIP 183 (Session Progress) response can be received from a terminating MCPTT client in the case of a group call.\n1)\tshall generate a SIP 183 (Session Progress) response as specified in clause 6.3.2.2.4.1;\n2)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function;\n3)\tvoid; and\n4)\tshall forward the SIP 183 (Session Progress) response according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP INVITE request sent to the MCPTT client, the participating MCPTT function:\nWhen the participating MCPTT function sends the SIP 200 (OK) response the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.4; and\n5)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nThe participating MCPTT function shall forward any other SIP response that does not contain SDP along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nWhen receiving a \"SIP INVITE request for terminating participating MCPTT function\" for a pre-established session that requires manual commencement mode the participating MCPTT function:\n1)\tif:\na)\tthe received SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\" or with the <imminentperil-ind> element set to a value of \"true\"; or\nb)\tif the Priv-Answer-Mode header field is present in the incoming SIP INVITE request;\nthen:\na)\tshall perform the procedures of clause 6.3.2.2.6.2 with the following clarifications:\ni)\tinclude in the outgoing SIP INVITE request a SIP Replaces header field populated with the call-id, to-tag and from-tag of the targeted pre-established session as specified in IETF RFC 3891 [65];\nii)\tinclude in the SDP offer the current media parameters used by the targeted pre-established session identified by the Replaces header field; and\niii)\tif the SIP core supports resource sharing, include in the outgoing SIP INVITE request a Resource-Share header field as specified in 3GPP TS 24.229 [4] with:\nA)\tthe value \"media-sharing\";\nB)\tan \"origin\" header field parameter set to \"session-receiver\";\nC)\ta \"timestamp\" header field parameter; and\nD)\ta \"rules\" header field parameter with one resource sharing rule per media stream in the same order the corresponding m-line appears in the SDP. Each resource sharing rule is constructed as follows:\n-\ta \"new-sharing-key\" part containing the same key as that included when the media bearer for the pre-established session was established; and\n-\ta \"directionality\" part indicating the direction of the pre-established media bearer; and\nb)\tshall skip the remaining steps;\n2)\tshall generate a SIP re-INVITE request as described in clause 6.3.2.2.3;\nNOTE 1:\tA SIP re-INVITE request cannot include an Answer-Mode header field as specified in IETF RFC 5373 [18] so Manual Answer is implied with a SIP re-INVITE request within the existing SIP dialog of the pre-established session.\n3)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming \"SIP INVITE request for terminating participating MCPTT function\" to the outgoing SIP re-INVITE request;\n4)\tshall include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request as specified in the clause 6.3.2.2.1; and\n5)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4];\nUpon receiving a SIP 180 (Ringing) response to the above SIP re-INVITE request, the participating MCPTT function:\nNOTE 2:\tA SIP 180 (Ringing) response is received from a terminating MCPTT client in the case of a private call.\n1)\tshall generate a SIP 180 (Ringing) response as specified in clause 6.3.2.2.4.1;\n2)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function; and\n3)\tshall forward the SIP 180 (Ringing) response according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response to the above SIP re-INVITE request, the participating MCPTT function:\nNOTE 3:\tA SIP 183 (Session Progress) response can be received from a terminating MCPTT client in the case of a group call.\n1)\tshall generate a SIP 183 (Session Progress) response as specified in clause 6.3.2.2.4.1;\n2)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function;\n3)\tvoid; and\n4)\tshall forward the SIP 183 (Session Progress) response according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request, the participating MCPTT function:\n1)\tif the received SDP answer includes changes in codecs or media formats, shall interact with the media plane as specified in 3GPP TS 24.380 [5] for updating the media plane with the newly negotiated codecs and media parameters from the received SDP answer;\n2)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n4)\tshall include in the SIP 200 (OK) response, an SDP answer based on the SDP answer in the received SIP 200 (OK) response, as specified in clause 6.3.2.2.2.1;\n5)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 4:\tThe participating MCPTT function sends a MCPC Connect message, in order to give MCPTT session identity to the terminating MCPTT client.\n6)\tshall send the SIP 200 (OK) response to the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5] for releasing media plane resource associated with the SIP session with the controlling MCPTT function;\n2)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4];\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP BYE request set to the public service identity of the participating MCPTT function;\n4)\tif the received SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body into the outgoing SIP BYE request; and\n5)\tshall send the SIP BYE request to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the participating MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP BYE request received from the controlling MCPTT function according to 3GPP TS 24.229 [4]; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the MCPTT client.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in clause 9.3 in 3GPP TS 24.380 [5] for disconnecting the media plane resources towards the controlling MCPTT function;\n2)\tshall send a SIP 200 (OK) response to the controlling MCPTT function;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for disconnecting media plane resources towards the MCPTT client from the media plane resources towards the controlling MCPTT function; and\n4)\tshall maintain the pre-established session towards the MCPTT client.\nThis clause is referenced from other procedures.\nIf the incoming SIP request contains an application/vnd.3gpp.mcptt-info+xml MIME body, the participating MCPTT function:\n1)\tif not already copied:\na)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP request; and\nb)\tif an <MKFC-GKTP> element was included in the application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP request, the <MKFC-GKTP> element shall not be copied into the application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP request.\nIf the received SIP request contains an application/vnd.3gpp.location-info+xml MIME body as specified in Annex F.3:\n1)\tif not already copied, shall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml MIME body received in the SIP request into an application/vnd.3gpp.mcptt-location-info+xml MIME body included in the outgoing SIP request.\nIf the received SIP request contains an application/resource-lists+xml MIME body:\n1)\tif not already copied, shall copy the contents of the application/resource-lists+xml MIME body received in the SIP request into an application/resource-lists+xml MIME body included in the outgoing SIP request.\nThis clause is referenced from other procedures.\nThe participating MCPTT function shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4] and:\n1)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23];\n2)\tmay include a Resource-Share header field in accordance with clause 5.7.1.20.3 in 3GPP TS 24.229 [4];\n3)\tshall perform the procedures specified in clause 6.3.2.2.9 to copy any MIME bodies in the received SIP (re-)INVITE request to the outgoing SIP re-INVITE request; and\n4)\tif the received SIP (re-)INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field.\nThis clause is referenced from other procedures.\nThe participating MCPTT function shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\n1)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\n2)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public user identity associated to the MCPTT ID of the terminating MCPTT user;\n3)\tshall populate the outgoing SIP MESSAGE request MIME bodies as specified in clause 6.3.2.2.9; and\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function.\nThis clause describes the procedures for generating a SIP MESSAGE request to notify an MCPTT client that it has entered a pre-defined emergency alert area or exited from a pre-defined emergency alert area. The procedure is initiated by the participating MCPTT function when the participating MCPTT function determines that the MCPTT client has entered a pre-defined emergency alert area or exited from a pre-defined emergency alert area.\nNOTE:\tThe participating MCPTT function can use additional implementation-specific selection criteria to decide the recipients of the notification, i.e., whether and when an entry/exit notification is sent. The additional criteria can be the activated functional alias, ongoing emergency or conditions related to position such as speed, heading etc. The determination of the specific region is left to implementation.\nThe participating MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall set the Request-URI to the public user identity associated to the MCPTT ID of the targeted MCPTT user;\n5)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function;\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n7)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-request-uri> element set to the value of the MCPTT ID of the targeted MCPTT user;\n8)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <emergency-alert-area-ind> element:\na)\tset to a value of \"true\", if the MCPTT client has entered a pre-defined emergency alert area; or\nb)\tset to a value of \"false\", if the MCPTT client has exited from a pre-defined emergency alert area; and\n9)\tshall send the SIP MESSAGE request towards the MCPTT client according to the rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP MESSAGE request, if the <emergency-alert-area-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP MESSAGE request was:\n1)\tset to a value of \"true\", shall record that the MCPTT client has received the notification that it has entered the pre-defined emergency alert area; and\n2)\tset to a value of \"false\", shall record that the MCPTT client has received the notification that it has exited the pre-defined emergency alert area.\nThis clause describes the procedures for generating a SIP MESSAGE request to notify an MCPTT client that it has entered a pre-defined group geographic area or exited from a pre-defined group geographic area requiring affiliation to or de-affiliation from a group. The procedure is initiated by the participating MCPTT function when the participating MCPTT function determines that the MCPTT client has entered a pre-defined group geographic area or exited from a pre-defined group geographic area.\nNOTE:\tThe participating MCPTT function can use additional implementation-specific selection criteria to decide the recipients of the notification, i.e., whether and when an entry/exit notification is sent. The additional criteria can be the activated functional alias, ongoing emergency or conditions related to position such as speed, heading etc. The determination of the specific region is left to implementation.\nThe participating MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall set the Request-URI to the public user identity associated to the MCPTT ID of the targeted MCPTT user;\n5)\tshall include a P-Asserted-Identity header field set to the public service identity of the participating MCPTT function;\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n7)\tvoid;\n8)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tan <mcptt-request-uri> element set to the value of the MCPTT ID of the targeted MCPTT user;\nb)\tan <associated-group-id> element set to the MCPTT group ID of the group for which a pre-defined group geographic area has been entered or exited; and\nc)\ta <group-geo-area-ind> element:\ni)\tset to a value of \"true\", if the MCPTT client has entered a pre-defined group geographic area; or\nii)\tset to a value of \"false\", if the MCPTT client has exited from a pre-defined group geographic area; and\n9)\tshall send the SIP MESSAGE request towards the MCPTT client according to the rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP MESSAGE request, if the <group-geo-area-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP MESSAGE request was:\n1)\tset to a value of \"true\", shall record that the MCPTT client has received the notification that it has entered the pre-defined group geographic area; and\n2)\tset to a value of \"false\", shall record that the MCPTT client has received the notification that it has exited the pre-defined group geographic area.\nWhen the terminating participating MCPTT function receives a SIP INVITE request to initiate a private call:\nIf:\n1)\tthe <allow-call-forwarding> element exists in the MCPTT user profile document, and the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\n2)\tthe <call-forwarding-on> element exists in the MCPTT user profile document, and  the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\n3)\tthe <call-forwarding-condition> element exists and has a value of \"no-answer\" as specified in 3GPP TS 24.484 [50] set;\nthen:\n1)\tthe terminating participating MCPTT function shall start timer TNP1 (call forwarding no answer timer) with a timer value as described in clause B.2.2, prior to sending out a SIP INVITE request inviting the called MCPTT user to a private call.\nWhen the terminating participating MCPTT function receives a SIP 200 (OK) response to the SIP INVITE request, from the called MCPTT user before expiry of TNP1 (call forwarding no answer timer), then the terminating participating MCPTT function shall stop timer TNP1 (call forwarding no answer timer) and forward the SIP 200 (OK) response to the controlling MCPTT function.\nAfter expiry of timer TNP1 (call forwarding no answer timer) the terminating participating MCPTT function:\n1)\tif the received SIP INVITE request contained a <forwarding-other-list> element with one or more <entry> elements shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"174 maximum number of allowed forwardings exceeded\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\n2)\tshall generate and send a SIP CANCEL request to the called MCPTT user, according to IETF RFC 3261 [24], to cancel the SIP request for which the no answer timer has been expired;\n3)\tshall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" in a Warning header field as specified in clause 4.4;\n4)\tshall generate a SIP MESSAGE request as described in clause 6.3.2.6 to trigger the call forwarding of a private call and shall include in the application/vnd.3gpp.mcptt-info+xml MIME body;\na)\ta <forwarding-reason> element set to a value of \"no-answer\"; and\n5)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the terminating participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\nThis clause is referenced from other procedures.\nThis clause describes the procedures for generating a SIP MESSAGE request for call forwarding of a private call.\nThe terminating participating MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tan <anyExt> element containing:\nA)\tthe <request-type> element set to a value of \"forward-private-call-request\";\nB)\tif the <forward-to-functional-alias> element of the <ruleset> element is present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function with the value \"true\", then the <call-to-functional-alias-ind> element set to \"true\"; otherwise, the <call-to-functional-alias-ind> element set to \"false\";\nNOTE 1:\tFor a call forwarding to an MCPTT ID the value of the <forwarding-target-orig-id> is the MCPTT ID of the target user, while for call forwarding to a functional alias the value is the functional alias of the target user.\nC)\tthe <forwarding-target-orig-id> element set to the value of <call-forwarding-target> element in the MCPTT user profile document in 3GPP TS 24.484 [50];\nD)\t the <forwarded-by-mcptt-id> element set to the MCPTT ID present in the <mcptt-request-uri> received in the SIP application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request; and\nE)\ta <forwarded-by-functional-alias> element set to the <called-functional-alias-URI> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request, if present;\nd)\tshall insert in the SIP MESSAGE request an application/resource-lists+xml MIME body with the MCPTT ID of the forwarded-calling-client user, according to the rules and procedures of IETF RFC 5366 [20];\n2)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function associated with the call forwarding service for the forwarded-calling-client user;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the private call service for the calling user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n3)\tshall include a P-Asserted-Identity header field set to the public service identity of participating MCPTT function;\n4)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n5)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6]; and\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.3\tControlling MCPTT function",
                            "text_content": "The SDP offer is generated based on the received SDP offer. The SDP offer generated by the controlling MCPTT function:\n1)\twhen initiating a new MCPTT session the SDP offer;\na)\tshall contain only one SDP media-level section for MCPTT speech media stream as contained in the received SDP offer; and\nb)\tshall contain one SDP media-level section for media plane control messages, if present in the received SDP offer; and\n2)\twhen adding a new MCPTT user to an existing MCPTT Session, the SDP offer shall contain the media stream currently used in the MCPTT session.\nWhen composing the SDP offer according to 3GPP TS 24.229 [4], the controlling MCPTT function:\n1)\tshall replace the IP address and port number for the offered media stream in the received SDP offer with the IP address and port number of the controlling MCPTT function;\n2)\tfor the MCPTT speech media stream, shall include all media-level attributes from the received SDP offer;\n3)\tshall replace the IP address and port number for the offered media plane control channel, if any, in the received SDP offer with the IP address and port number of the controlling MCPTT function;\n4)\tshall include an mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14 for the selected media plane control channel with the RTCP SSRC that the controlling MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the answerer in the floor control messages sent to the controlling MCPTT function for this session; and\nNOTE:\tThe controlling MCPTT function will receive in the SDP answer the RTP SSRC it will have to use in the floor control message it will send to the answerer in this session.\n5)\tfor the offered media plane control channel, shall include any other necessary 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14.\nThis clause is referenced from other procedures.\nThe controlling MCPTT function shall generate an initial SIP INVITE request according to 3GPP TS 24.229 [4].\nThe controlling MCPTT function:\n1)\tshall include in the Contact header field an MCPTT session identity for the MCPTT session with the g.3gpp.mcptt media feature tag, the isfocus media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" according to IETF RFC 3840 [16];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n5)\tvoid ;\n6)\tshould include the Session-Expires header field according to rules and procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted;\n7)\tshall include the Supported header field set to \"timer\";\n8)\tif the received SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body containing an <ambient-listening-type> element and:\na)\tif the Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was included in the received SIP INVITE request with a value of \"Auto\" or if no Priv-Answer-Mode header field was received in the received SIP INVITE request; or\nb)\ta Priv-Answer-Mode header field was received containing a value other than \"Auto\";\nshall include a Priv-Answer-Mode header field set to a value of \"Auto\" in the outgoing SIP INVITE request;\n9)\tif the received SIP INVITE request contained a Priv-Answer-Mode header field and did not contain an application/vnd.3gpp.mcptt-info+xml MIME body containing an <ambient-listening-type> element, shall include an unmodified Priv-Answer-Mode header field;\n10)\tif the received SIP INVITE request did not contain an application/vnd.3gpp.mcptt-info+xml MIME body containing an <ambient-listening-type> element and did not contain a Priv-Answer-Mode header field, shall include an unmodified Answer-Mode header field if present in the incoming SIP INVITE request; and\n11)\tif the incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing INVITE request.\nOn receipt of the SIP 200 (OK) response to the initial outgoing SIP INVITE request the controlling MCPTT function:\n1)\tshall start the SIP session timer according to rules and procedures of IETF RFC 4028 [7]; and\n2)\tshall cache SIP feature tags, if received in the Contact header field, and if the specific feature tags are supported.\nWhen a participant needs to be removed from the MCPTT session, the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for the MCPTT session release;\n2)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4]; and\n3)\tshall send the SIP BYE request to the MCPTT clients according to3GPP TS 24.229 [4].\nIf timer TNG3 (group call timer) has not expired, then when the last MCPTT client is removed from the MCPTT session, the controlling MCPTT function shall stop timer TNG3 (group call timer).\nWhen the MCPTT group session needs to be released, the controlling MCPTT function shall send SIP BYE requests as described in this clause, to all participants of the group session.\nUpon receiving a SIP 200 (OK) response to a SIP BYE request the controlling MCPTT function shall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the MCPTT clients.\nThis clause is referenced from other procedures.\nThe controlling MCPTT function shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4].\nThe controlling MCPTT function:\n1)\tshall include an SDP offer with the media parameters as currently established with the terminating MCPTT client according to 3GPP TS 24.229 [4];\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-calling-user-id> element set to the MCPTT ID of the initiating MCPTT user;\n3)\tif the in-progress emergency group state of the group is set to a value of \"true\" the controlling MCPTT function:\na)\tshall include a Resource-Priority header field with the namespace populated with the values for an MCPTT emergency group call as specified in clause 6.3.3.1.19;\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body the <emergency-ind> element set to a value of \"true\";\nc)\tif the <alert-ind> element is set to \"true\" in the received SIP re-INVITE request and MCPTT emergency alerts are authorised for this group and MCPTT user as determined by the procedures of clause 6.3.3.1.13.1, shall populate the application/vnd.3gpp.mcptt-info+xml MIME body and application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause 6.3.3.1.12. Otherwise, shall set the <alert-ind> element to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nd)\tif the in-progress imminent peril state of the group is set to a value of \"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <imminentperil-ind> element set to a value of \"false\"; and\nNOTE:\tIf the imminent peril state of the group is true at this point, the controlling function will be setting it to false as part of the calling procedure. This is in effect an upgrade of an MCPTT imminent peril group call to an MCPTT emergency group call.\n4)\tif the in-progress emergency group state of the group is set to a value of \"false\":\na)\tshall include a Resource-Priority header field populated with the values for a normal MCPTT group call as specified in clause 6.3.3.1.19; and\nb)\tif the received SIP re-INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and this is an authorised request to cancel an MCPTT emergency group call as determined by the procedures of clause 6.3.3.1.13.4:\ni)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\"; and\nii)\tif the received SIP re-INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\" and this is an authorised request to cancel an MCPTT emergency alert as determined by the procedures of clause 6.3.3.1.15, shall:\nA)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to a value of \"false\"; and\nB)\tif the received SIP request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the received <originated-by> element to an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP re-INVITE request.\nThis clause is referenced from other procedures.\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT session associated with an MCPTT emergency group call or MCPTT imminent peril group call. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 10.1.2.4.1.1.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\n2)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated with the MCPTT ID of the targeted MCPTT user;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element populated as follows:\na)\tthe <mcptt-request-uri> element set to the value of the MCPTT ID of the targeted MCPTT user;\nb)\tthe <mcptt-calling-user-id> element set to the value of the MCPTT ID of the calling MCPTT user; and\nc)\tthe <mcptt-calling-group-id> element set to the value of the MCPTT group ID of the emergency group call.\n4)\tshall include in the P-Asserted-Identity header field the public service identity of the controlling MCPTT function;\n5)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1; and\n6)\tif the in-progress emergency group state of the group is set to a value of \"true\" the controlling MCPTT function:\na)\tshall include a Resource-Priority header field populated with the values for an MCPTT emergency group call as specified in clause 6.3.3.1.19;\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <emergency-ind> element set to a value of \"true\";\nc)\tif the <alert-ind> element is set to \"true\" in the received SIP INVITE request and the requesting MCPTT user and MCPTT group are authorised for the initiation of MCPTT emergency alerts as determined by the procedures of clause 6.3.3.1.13.1, shall populate the application/vnd.3gpp.mcptt-info+xml MIME body and the application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause 6.3.3.1.12. Otherwise, shall set the <alert-ind> element to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nd)\tif the in-progress imminent peril state of the group is set to a value of \"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <imminentperil-ind> element set to a value of \"false\";\nNOTE 6:\tIf the imminent peril state of the group is true at this point, the controlling function will set it to false as part of the calling procedure.\n7)\tif the in-progress emergency state of the group is set to a value of \"false\" and the in-progress imminent peril state of the group is set to a value of \"true\", the controlling MCPTT function:\na)\tshall include a Resource-Priority header field populated with the values for an MCPTT imminent peril group call as specified in clause 6.3.3.1.19; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\".\nThis clause is referenced from other procedures.\nThis clause describes the procedures for updating an MCPTT session associated with an MCPTT emergency group call or MCPTT imminent peril group call when the received SIP INVITE request did not include a correctly populated Resource-Priority header field. The procedure is initiated by the controlling MCPTT function for the purpose of providing the correct Resource-Priority header field.\n1)\tshall generate a SIP 183 (Session Progress) response according to 3GPP TS 24.229 [4] with the clarifications provided specified in clause 6.3.3.2.3.1;\n2)\tshall include the option tag \"100rel\" in a Require header field in the SIP 183 (Session Progress) response;\n3)\tshall include in the SIP 183 (Session Progress) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1; and\n4)\tshall send the SIP 183 (Session Progress) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP PRACK request to the SIP 183 (Session Progress) response the controlling MCPTT function:\n1)\tshall send the SIP 200 (OK) response to the SIP PRACK request according to 3GPP TS 24.229 [4].\n2)\tshall generate a SIP UPDATE request according to 3GPP TS 24.229 [4] with the following clarifications:\n3)\tshall include in the SIP UPDATE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1;\n4)\tif the in-progress emergency group state of the group is set to a value of \"true\" the controlling MCPTT function shall include a Resource-Priority header field populated for an MCPTT emergency group call as specified in clause 6.3.3.1.19; and\nNOTE 1:\tThis is the case when the sending MCPTT client did not send a Resource-Priority header field populated appropriately to receive emergency-level priority. In this case, the Resource-Priority header field is populated appropriately to provide emergency-level priority.\n5)\tif the in-progress emergency group state of the group is set to a value of \"false\" the controlling MCPTT function:\na)\tif the in-progress imminent peril state of the group is set to a value of \"false\", shall include a Resource-Priority header field populated for a normal priority MCPTT group call as specified in clause 6.3.3.1.19; and\nb)\tif the in-progress imminent peril state of the group is set to a value of \"true\", shall include a Resource-Priority header field populated for an MCPTT imminent peril group call as specified in clause 6.3.3.1.19.\nNOTE 2:\tThis is the case when the sending MCPTT client incorrectly populated a Resource-Priority header field for emergency-level or imminent peril-level priority and the controlling MCPTT function re-populates it as appropriate to an imminent peril level priority or normal priority level.\nThis clause is referenced from other procedures.\nThis clause describes the procedures for generating a SIP re-INVITE request to be sent by the controlling MCPTT function.\nThe controlling MCPTT function:\n1)\tshall generate an SIP re-INVITE request according to 3GPP TS 24.229 [4]; and\n2)\tshall include an SDP offer with the media parameters as currently established with the terminating MCPTT client according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.1.1.\nThis clause is referenced from other procedures.\nThis clause describes the procedures for generating a SIP re-INVITE request to cancel the in-progress emergency state of an MCPTT group. The procedure is initiated by the controlling MCPTT function when it determines the cancellation of the in-progress emergency state of an MCPTT group is required.\nThe controlling MCPTT function:\n1)\tshall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.1.9;\n2)\tshall include a Resource-Priority header field populated with the values for a normal MCPTT group call as specified in clause 6.3.3.1.19; and\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\".\nThis clause is referenced from other procedures.\nThis clause describes the procedures for generating a SIP MESSAGE request to notify affiliated but not participating members of an MCPTT group of the change of status of the in-progress emergency state, imminent peril state or emergency alert status of an MCPTT group. The procedure is initiated by the controlling MCPTT function when there has been a change of in-progress imminent peril, in-progress emergency or the emergency alert status of an MCPTT group.\nThe controlling MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall set the Request-URI to the public service identity of the terminating participating function associated with the MCPTT ID of the targeted MCPTT user;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall include a P-Asserted-Identity header field set to the public service identity of controlling MCPTT function;\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n7)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-request-uri> element set to the value of the MCPTT ID of the targeted MCPTT user; and\n8)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <mcptt-calling-group-id> element set to the MCPTT group ID of the MCPTT group on which the MCPTT emergency call, imminent peril call or the emergency alert state has changed.\nThis clause is referenced from other procedures.\nThis clause describes the procedures for populating the application/vnd.3gpp.mcptt-info+xml and application/vnd.3gpp.mcptt-location-info+xml MIME bodies for an MCPTT emergency alert. The procedure is initiated by the controlling MCPTT function when it has received a SIP request initiating an MCPTT emergency alert and generates a message containing the MCPTT emergency alert information required by 3GPP TS 23.379 [3].\nThe controlling MCPTT function:\n1)\tshall include, if not already present, an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1, and set the <alert-ind> element to a value of \"true\";\n2)\tshall determine the value of the MCPTT user's Mission Critical Organization from the <MissionCriticalOrganization> element, of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\n3)\tshall include in the <mcpttinfo> element containing the <mcptt-Params> element containing an <mc-org> element set to the value of the MCPTT user's Mission Critical Organization; and\n4)\tshall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml MIME body in the received SIP request into an application/vnd.3gpp.mcptt-location-info+xml MIME body included in the outgoing SIP request.\nIf the controlling MCPTT function has received a SIP request targeted to an MCPTT group with the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\", the controlling MCPTT function shall check the following conditions:\n1)\tif the <allow-activate-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\na)\tif the \"entry-info\" attribute of the <entry> element of the <EmergencyAlert> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and:\ni)\tif the MCPTT group identity targeted for the emergency alert is contained in the <uri-entry> element of the <entry> element of the <EmergencyAlert> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nii)\tif the <allow-MCPTT-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the <list-service> element of the group document identified by the MCPTT group identity is set to a value of \"true\" as specified in 3GPP TS 24.481 [31]; or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <EmergencyAlert> element contained within the <MCPTT-group-call> element of the MCPTT user profile (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\" and the <allow-MCPTT-emergency-alert> element of the <actions> element of a <rule> element of the <ruleset> element of the <list-service> element of the group document identified by the MCPTT group identity targeted for the emergency alert is set to a value of \"true\" as specified in 3GPP TS 24.481 [31].\nthen the MCPTT emergency alert request shall be considered to be an authorised request for an MCPTT emergency alert targeted to a MCPTT group. In all other cases, the MCPTT emergency alert request shall be considered to be an unauthorised request for an MCPTT emergency alert targeted to an MCPTT group.\nIf the controlling MCPTT function has received a SIP request targeted to an MCPTT user with the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\", the controlling MCPTT function shall check the following conditions:\n1)\tif the <allow-activate-emergency-alert> element of the <actions> element of the <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\na)\tif the \"entry-info\" attribute of the <entry> element of the <PrivateEmergencyAlert> element contained within the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UsePreConfigured\" and the MCPTT ID of the MCPTT user targeted for the call is contained in the <uri-entry> element of the <entry> element of the <PrivateEmergencyAlert> element contained within the <OnNetwork> element (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <PrivateEmergencyAlert> element contained within the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"LocallyDetermined\";\nthen the MCPTT emergency alert request shall be considered to be an authorised request for an MCPTT emergency alert targeted to an MCPTT user. In all other cases, it shall be considered to be an unauthorised request for an MCPTT emergency alert targeted to an MCPTT user.\nIf the controlling MCPTT function has received a SIP request for an MCPTT group call with the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and:\n1)\tif the <allow-emergency-group-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\" and:\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and:\ni)\tif the <uri-entry> element of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) contains the identity of the MCPTT group targeted by the calling MCPTT user; and\nii)\tif the <allow-MCPTT-emergency-call> element of the <list-service> element of the group document identified by the targeted MCPTT group identity is set to a value of \"true\" as specified in 3GPP TS 24.481 [31];\nthen the controlling MCPTT function shall consider the MCPTT emergency group call request to be an authorised request for an MCPTT emergency group call and skip the remaining steps; or;\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element of the <EmergencyCall> element contained within the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\" and if the <allow-MCPTT-emergency-call> element of the <list-service> element of the group document identified by the targeted MCPTT group identity is set to a value of \"true\" as specified in 3GPP TS 24.481 [31];\nthen the controlling MCPTT function shall consider the MCPTT emergency group call request to be an authorised request for an MCPTT emergency group call and skip the remaining steps; or\n2)\tif the controlling MCPTT function does not consider the MCPTT emergency group call request to be an authorised request for an MCPTT emergency group call by step 1) above, then the controlling MCPTT function shall consider the MCPTT emergency group call request to be an unauthorised request for an MCPTT emergency group call.\nIf the controlling MCPTT function has received a SIP request for an MCPTT private call with the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and:\n1)\tif the <allow-emergency-private-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\na)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTPrivateRecipient> element of the <EmergencyCall> element contained within the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UsePreConfigured\" and if the MCPTT ID targeted for the call is contained in the <uri-entry> element of the <entry> element of the <MCPTTPrivateRecipient> element of the <EmergencyCall> element contained within the <PrivateCall> element (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\nb)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTPrivateRecipient> element of the <EmergencyCall> element contained within the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"LocallyDetermined\";\nthen the controlling MCPTT function shall consider the MCPTT emergency private call request to be an authorised request for an MCPTT emergency private call and skip step 2) below; or\n2)\tif the controlling MCPTT function does not consider the MCPTT emergency private call request to be an authorised request for an MCPTT emergency private call by step 1) above, then the controlling MCPTT function shall consider the MCPTT emergency private call request to be an unauthorised request for an MCPTT emergency private call.\nIf the controlling MCPTT function has received a SIP request with the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\" and:\n1)\tif the <allow-cancel-emergency-alert> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency alert cancellation request shall be considered to be an authorised request for an MCPTT emergency alert cancellation; and\n2)\tif the <allow-cancel-emergency-alert> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\", then the MCPTT emergency alert cancellation request shall be considered to be an unauthorised request for an MCPTT emergency alert cancellation.\nIf the controlling MCPTT function has received a SIP request for an MCPTT group call with the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\", the controlling MCPTT function determines, based on local policy (e.g if the requester is dispatcher or not, initiator of the MCPTT emergency group call, if other participants exist in the MCPTT session who are in emergency state etc), whether the emergency group state cancel request is authorised or not.\nIf the controlling MCPTT function has received a SIP request for an MCPTT private call with the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\" and:\n1)\tif the <allow-cancel-private-emergency-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency private call cancellation request shall be considered to be an authorised request for an MCPTT emergency private call cancellation; and\n2)\tif the <allow-cancel-private-emergency-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\" or not present, then the MCPTT emergency private call cancellation request shall be considered to be an unauthorised request for an MCPTT emergency private call cancellation.\nEditor's Note: [MCProtoc17, CR 0654] Whether the controlling MCPTT function examines the <allow-cancel-private-emergency-call> element or uses local policy to determine whether the calling user is authorised to cancel a private emergency call is FFS.\nIf the controlling MCPTT function has received a SIP request with the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and:\n1)\tif the <allow-imminent-peril-call> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value other than  \"true\" the request for initiating an MCPTT imminent peril call shall be considered to be an unauthorised request for an MCPTT imminent peril call and skip the remaining steps;\n2)\tif the <allow-imminent-peril-call> element of the <list-service> element of the group document identified by the targeted MCPTT group identity is set to a value other than \"true\" as specified in 3GPP TS 24.481 [31], the request for initiating an MCPTT imminent peril call shall be considered to be an unauthorised request for an MCPTT imminent peril call and skip the remaining steps;\n3)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"DedicatedGroup\" and if the MCPTT group identity targeted for the call is contained in the <uri-entry> element of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\n4)\tif the \"entry-info\" attribute of the <entry> element of the <MCPTTGroupInitiation> element contained within the <ImminentPerilCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"UseCurrentlySelectedGroup\".\nthen the MCPTT imminent peril call request shall be considered to be an authorised request for an MCPTT imminent peril call. In all other cases, it shall be considered to be an unauthorised request for an MCPTT imminent peril call.\nIf the controlling MCPTT function has received a SIP request with the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"false\" and:\n1)\tif the <allow-cancel-imminent-peril> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then the MCPTT emergency call cancellation request shall be considered to be an authorised request for an MCPTT imminent peril call cancellation; and\n2)\tif the <allow-cancel-imminent-peril> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\" or not present, then the MCPTT emergency call cancellation request shall be considered to be an unauthorised request for an MCPTT imminent peril call cancellation.\nIf the controlling MCPTT function has received a SIP request with the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is set to \"true\" and this is an unauthorised request for an MCPTT emergency call as determined by the procedures of clause 6.3.3.1.13.2, the controlling MCPTT function shall:\n1)\tinclude in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"false\" and the <alert-ind> element set to a value of \"false\".\nThis clause is referenced from other procedures.\nThe controlling MCPTT function shall generate a SIP re-INVITE request according to 3GPP TS 24.229 [4].\nThe controlling MCPTT function:\n1)\tshall include in the Contact header field an MCPTT session identity for the MCPTT session with the g.3gpp.mcptt media feature tag and the isfocus media feature tag according to IETF RFC 3840 [16];\n2)\tshall include an SDP offer with the media parameters as currently established with the terminating MCPTT client according to 3GPP TS 24.229 [4];\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-calling-user-id> element set to the MCPTT ID of the initiating MCPTT user;\n4)\tif the in-progress imminent peril state of the group is set to a value of \"true\" the controlling MCPTT function:\na)\tshall include a Resource-Priority header field populated with the values for an MCPTT imminent peril group call as specified in clause 6.3.3.1.19; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <imminentperil-ind> element set to a value of \"true\"; and\n5)\tif the in-progress imminent peril state of the group is set to a value of \"false\":\na)\tshall include a Resource-Priority header field populated with the values for a normal MCPTT group call as specified in clause 6.3.3.1.19; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <emergency-ind> element set to a value of \"false\" and the <imminentperil-ind> element set to a value of \"false\".\nUpon expiry of timer TNG2 (in-progress emergency group call timer) for an MCPTT group, the controlling MCPTT function:\n1)\tshall set the in-progress emergency state of the group to a value of \"false\";\n2)\tshall, if an MCPTT group call or MCPTT group session is in progress on the indicated group, for each of the participating members:\na)\tgenerate a SIP re-INVITE request as specified in clause 6.3.3.1.10; and\nb)\tsend the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4]; and\n3)\tshall for each affiliated but non-participating member of the group:\na)\tgenerate a SIP MESSAGE request according to clause 6.3.3.1.11 and include in the application/vnd.3gpp.mcptt-info+xml MIME body an <emergency-ind> element set to a value of \"false\";\nb)\tshall include in the P-Asserted-Identity header field the public service identity of the controlling MCPTT function;\nc)\tinclude the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9]; and\nd)\tsend the SIP MESSAGE request towards the MCPTT client according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to a re-SIP INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5].\nThis clause is referenced from other procedures. This procedure validates the combinations of <emergency-ind>, <imminentperil-ind> and <alert-ind> in the application/vnd.3gpp.mcptt-info+xml MIME body included in:\n1)\ta SIP INVITE request or SIP re-INVITE request; or\n2)\tthe body \"URI\" header field of the SIP URI included in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body which is pointed to by a \"cid\" URL located in the Refer-To header of a SIP REFER request;\nUpon receiving a SIP request as specified above with the <emergency-ind> element set to a value of \"true\", the controlling MCPTT function shall only consider the following as valid combinations:\n1)\t<imminentperil-ind> not included and <alert-ind> included.\nUpon receiving a SIP request as specified above with the <emergency-ind> element set to a value of \"false\", the controlling MCPTT function shall only consider the following as valid combinations:\n1)\t<imminentperil-ind> not included and <alert-ind> not included; or\n2)\t<imminentperil-ind> not included and <alert-ind> included.\nUpon receiving a SIP request as specified above with the <imminentperil-ind> element included the controlling MCPTT function shall only consider the request as valid if both the <emergency-ind> and <alert-ind> are not included.\nIf the combination of the <emergency-ind>, <imminentperil-ind> or <alert-ind> indicators is invalid, the controlling MCPTT function shall send a SIP 403 (Forbidden) response with the warning text set to \"150 invalid combinations of data received in MIME body\" in a Warning header field as specified in clause 4.4.\nThis clause is referenced from other procedures and describes how the controlling MCPTT function generates a SIP INFO request due to the receipt of a SIP request for a priority call.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INFO request according to rules and procedures of 3GPP TS 24.229 [4] and IETF RFC 6086 [64];\n2)\tshall include the Info-Package header field set to g.3gpp.mcptt-info in the SIP INFO request;\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INFO request and:\na)\tif the received SIP request contained application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall set the <emergency-ind> element to a value of \"true\" and the <alert-ind> element to a value of \"false\";\nb)\tif the received SIP request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\" and if this is an unauthorised request for an MCPTT emergency alert cancellation, shall set <alert-ind> element to a value of \"true\"; and\nc)\tif the received SIP request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\", this is an authorised request for an MCPTT imminent peril group call and the in-progress emergency state of the group is set to a value of \"true\", shall set the <imminentperil-ind> element to a value of \"false\" and the <emergency-ind> element set to a value of \"true\"; and\n4)\tshall send the SIP INFO request towards the inviting MCPTT client in the dialog created by the SIP request from the inviting MCPTT client, as specified in 3GPP TS 24.229 [4].\nThis clause is referenced from other procedures.\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for an MCPTT emergency group call or MCPTT emergency private call the controlling MCPTT function:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <emergency-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <emergency-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]).\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for an MCPTT imminent peril group call the controlling MCPTT function:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <imminent-peril-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <imminent-peril-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50])\nWhen determining the Resource-Priority header field namespace and priority values as specified in IETF RFC 8101 [48] for a normal MCPTT group or private call the controlling MCPTT function:\n1)\tshall retrieve the value of the <resource-priority-namespace> element contained in the <normal-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]); and\n2)\tshall retrieve the value of the <resource-priority-priority> element contained in the <normal-resource-priority> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]).\nNOTE:\tThe \"normal\" Resource-Priority header field value is needed to return to a normal priority value from a priority value adjusted for an MCPTT emergency group or private call or an MCPTT imminent peril group call. The \"normal\" priority received from the EPS by use of the \"normal\" Resource-Priority header field value is expected to be the same as the \"normal\" priority received from the EPS when initiating a call with no Resource-Priority header field included.\nThis clause is referenced from other procedures.\nThis clause describes the procedures for generating a SIP MESSAGE request to notify the originator of an emergency alert or emergency cancellation that the request was successfully received.\nThe controlling MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall set the Request-URI to the public service identity of the terminating participating function associated with the MCPTT ID of the targeted MCPTT user;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall include a P-Asserted-Identity header field set to the public service identity of controlling MCPTT function; and\n6)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-request-uri> element set to the value of the MCPTT ID of the targeted MCPTT user.\nWhen composing the SDP answer according to 3GPP TS 24.229 [4], the controlling MCPTT function:\n1)\tfor the accepted media stream in the received SDP offer:\na)\tshall replace the IP address and port number in the received SDP offer with the IP address and port number of the controlling MCPTT function; and\nEditor’s Note:\tText needs to be added for the case of a private call without floor control : the controlling MCPTT function assigns unique RTP SSRCs to be used by each participant and include the SSRC to be used in the sent media stream in an mc-ssrc fmtp attribute and the SSRC to expect in the received media stream in an a=ssrc attribute.\n2)\tfor the accepted media plane control channel, if present in the received SDP offer:\na)\tshall replace the IP address and port number in the received SDP offer with the IP address and port number of the controlling MCPTT function;\nb)\tshall include an mc_floor_ssrc 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14 for the selected media plane control channel with the RTCP SSRC that the controlling MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the offerer in the floor control messages sent to the controlling MCPTT function for this session; and\nNOTE:\tThe controlling MCPTT function has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the offerer in this session.\nc)\tshall include any other necessary 'fmtp' attributes a specified in 3GPP TS 24.380 clause 14.\nOn receipt of an initial SIP INVITE request the controlling MCPTT function shall cache SIP feature tags, if received in the Contact header field and if the specific feature tags are supported.\nWhen sending SIP provisional responses with the exception of the SIP 100 (Trying) response to the SIP INVITE request the controlling MCPTT function:\n1)\tshall generate the SIP provisional response;\n2)\tshall include a P-Asserted-Identity header field with the public service identity of the controlling MCPTT function;\n3)\tshall include an MCPTT session identity in the Contact header field; and\n4)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\nc)\tthe isfocus media feature tag.\nWhen sending a SIP 200 (OK) response to the initial SIP INVITE request, the controlling MCPTT function:\n1)\tshall generate the SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall include the Session-Expires header field and start supervising the SIP session according to rules and procedures of IETF RFC 4028 [7], \"UAS Behavior\". The \"refresher\" parameter in the Session-Expires header field shall be set to \"uac\";\n3)\tshall include the option tag \"timer\" in a Require header field;\n4)\tshall include a P-Asserted-Identity header field with the public service identity of the controlling MCPTT function;\n5)\tshall include a SIP URI for the MCPTT session identity in the Contact header field identifying the MCPTT session at the controlling MCPTT function;\n6) shall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\nc)\tthe isfocus media feature tag;\n7)\tshall include Warning header field(s) received in incoming responses to the SIP INVITE request;\n8)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23];\n9)\tshall include the \"norefersub\" option tag in a Supported header field according to IETF RFC 4488 [22];\n10) shall include the \"explicitsub\" and \"nosub\" option tags in a Supported header field according to IETF RFC 7614 [35]; and\n11)\tvoid\n12)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving a SIP BYE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing the media plane resource associated with the SIP session towards the MCPTT client;\nNOTE:\tThe non-controlling MCPTT function is also regarded as a MCPTT client in a temporary MCPTT group session.\n2)\tshall generate a SIP 200 (OK) response and send the SIP response towards the MCPTT client according to 3GPP TS 24.229 [4];\n3)\tshall check the MCPTT session release policy as specified in clause 6.3.8.1 and clause 6.3.8.2 whether the MCPTT session needs to be released for each participant of the MCPTT session;\n4)\tif release of the MCPTT session is required:\na)\tshall perform the procedures as specified in the clause 6.3.3.1.5 with the clarification that if the received SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body, copy the application/vnd.3gpp.mcptt-info+xml MIME body into the outgoing SIP BYE request; and\n5)\tif a release of the MCPTT session is not required, shall send a SIP NOTIFY request to all remaining MCPTT clients in the MCPTT session with a subscription to the conference event package as specified in clause 10.1.3.4.2.\nUpon receiving a SIP 200 (OK) response to the SIP BYE request the controlling MCPTT function shall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the MCPTT participant.\nWhen the controlling MCPTT function receives a SIP INVITE request to initiate a group session and there are members of the group document retrieved from the group management server that are affiliated and are marked as <on-network-required> as specified in 3GPP TS 24.481 [31], then the controlling MCPTT function shall start timer TNG1 (acknowledged call setup timer) with a timer value as described in Annex B.2.1, prior to sending out SIP INVITE requests inviting group members to the group session.\nWhen the controlling MCPTT function receives all SIP 200 (OK) responses to the SIP INVITE requests, from all affiliated and <on-network-required> members then the controlling MCPTT function shall stop timer TNG1 (acknowledged call setup timer) and if the local counter of the number of SIP 200 (OK) responses received from invited members is greater than or equal to the value of the <on-network-minimum-number-to-start> element of the group document, the controlling MCPTT function shall send a SIP 200 (OK) response to the initiating MCPTT client.\nNOTE 1:\tMCPTT clients that are affiliated but are not <on-network-required> members that have not yet responded will be considered as joining an ongoing session when the controlling MCPTT function receives SIP 200 (OK) responses from these MCPTT clients.\nAfter expiry of timer TNG1 (acknowledged call setup timer) and the local counter of the number of SIP 200 (OK) responses received from invited members is less than the value of the <on-network-minimum-number-to-start> element of the group document, then the controlling MCPTT function shall wait until further responses have been received from invited clients and the value of the local counter of the number of SIP 200 (OK) responses received from invited members is equal to the <on-network-minimum-number-to-start>, before continuing with the timer TNG1 expiry procedures in this clause.\nAfter expiry of timer TNG1 (acknowledged call setup timer) and the local counter of the number of SIP 200 (OK) responses received from invited members is greater or equal to the value of the <on-network-minimum-number-to-start> element of the group document, the controlling MCPTT function shall execute the steps described below:\n1)\tif the <on-network-action-upon-expiration-of-timeout-for-acknowledgement-of-required-members> element configured in the group document for the action on expiry of the timer is set to \"proceed\" indicating that the controlling MCPTT function should proceed with the setup of the group call, then the controlling MCPTT function:\na)\tshall perform the following actions:\ni)\tgenerate a SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.2 before continuing with the rest of the steps;\nii)\tinclude in the SIP 200 (OK) response the warning text set to \"111 group call proceeded without all required group members\" in a Warning header field as specified in clause 4.4;\niii)\tinclude in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\niv)\tinteract with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 2:\tResulting media plane processing is completed before the next step is performed.\nv)\tsend a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4];\nb)\twhen a SIP 200 (OK) response to a SIP INVITE request is received from an invited MCPTT client the controlling MCPTT function may send an in-dialog SIP MESSAGE request to the MCPTT client that originated the group session with the text \"group call proceeded without all required group members\";\nc)\twhen the controlling MCPTT function receives a SIP BYE request from an invited MCPTT client, shall take the actions specified in clause 6.3.3.2.4 and may send an in-dialog SIP MESSAGE request to the MCPTT client that originated the group session with the text \"group call proceeded without all required group members\"; and\nd)\tshall generate a notification package as specified in clause 6.3.3.4 and send a SIP NOTIFY request according to 3GPP TS 24.229 [4] to the MCPTT clients which have subscribed to the conference event package; and\n2)\tif the <on-network-action-upon-expiration-of-timeout-for-acknowledgement-of-required-members> element configured in the group document for the action on expiry of the timer is set to \"abandon\" indicating that the controlling MCPTT function should abandon the setup of the group call, then the controlling MCPTT function shall:\na)\tsend a SIP 480 (Temporarily Unavailable) response to the MCPTT client that originated the group session with the warning text set to \"112 group call abandoned due to required group members not part of the group session\" in a Warning header field as specified in clause 4.4;\nb)\tfor each confirmed dialog at the controlling MCPTT function, send a SIP BYE request towards the MCPTT clients invited to the group session in accordance with 3GPP TS 24.229 [4] and interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nc)\tfor each non-confirmed dialog at the controlling MCPTT function, send a SIP CANCEL request towards the MCPTT clients invited to the group session in accordance with 3GPP TS 24.229 [4].\nIf the controlling MCPTT function receives a final SIP 4xx, 5xx or 6xx response from an affiliated and <on-network-required> group member prior to expiry of timer TNG1 (acknowledged call setup timer) and based on policy, the controlling MCPTT function decides not to continue with the establishment of the group call without the affiliated and <on-network-required> group member, then the controlling MCPTT function:\nNOTE 3:\tIt is expected that this action is taken if the policy is to abandon the call on expiry of timer TNG1 (acknowledged call setup timer).\n1)\tshall stop timer TNG1 (acknowledged call setup timer); and\n2)\tshall forward the final SIP 4xx, 5xx or 6xx response towards the inviting MCPTT client with the warning text set to \"112 group call abandoned due to required group member not part of the group session\" in a Warning header field as specified in clause 4.4.\nIf:\n1)\tthe controlling MCPTT function receives a final SIP 4xx, 5xx or 6xx response from an affiliated and <on-network-required> group member prior to expiry of timer TNG1 (acknowledged call setup timer);\n2)\tthe local counter of the number of SIP 200 (OK) responses received from invited members is greater than or equal to the value of the <on-network-minimum-number-to-start> element of the group document; and\n3)\tbased on policy, the controlling MCPTT function decides to continue with the establishment of the group call without the affiliated and <on-network-required> group member;\nthen the controlling MCPTT function:\nNOTE 4:\tIt is expected that this action is taken if the policy is to proceed with the call on expiry of timer TNG1 (acknowledged call setup timer).\n1)\tif all other invited clients have not yet responded, shall continue running timer TNG1 (acknowledged call setup timer); and\n2)\tif all other invited clients have responded with SIP 200 (OK) responses, shall\na)\tstop timer TNG1 (acknowledged call setup timer);\nb)\tgenerate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.2 before continuing with the rest of the steps;\nc)\tinclude in the SIP 200 (OK) response the warning text set to \"111 group call proceeded without all required group members\" in a Warning header field as specified in clause 4.4;\nd)\tinclude in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\ne)\tinteract with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 5:\tResulting media plane processing is completed before the next step is performed.\nf)\tsend a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP ACK to the above SIP 200 (OK) response and\n1)\tthe SIP 200 (OK) response contained the warning text set to \"111 group call proceeded without all required group members\" in a Warning header field and\n2)\tthe user profile of MCPTT client that originated the group session contains the element <allow-to-receive-non-acknowledged-users-information> and is set to a value of \"true\",\nthen the controlling MCPTT function may:\n1)\tgenerate a SIP INFO request according to rules and procedures of 3GPP TS 24229  [4] and IETF RFC 6086  [64];\n2)\tinclude the Info-Package header field set to g.3gpp.mcptt-info in the SIP INFO request;\n3)\tinclude an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with a <non-acknowledged-user> element containing the MCPTT ID of each of the invited members that have not sent a SIP 200 (OK) response; and\n4)\tsend the SIP INFO request towards the inviting MCPTT client in the dialog created by the SIP request from the inviting MCPTT client, as specified in 3GPP TS 24.229 [4].\nThe controlling MCPTT function shall generate a SIP NOTIFY request according to 3GPP TS 24.229 [4] with the clarification in this clause.\nIn the SIP NOTIFY request, the controlling MCPTT function:\n1)\tshall set the P-Asserted-Identity header field to the public service identity of the controlling MCPTT function;\n2)\tshall include an Event header field set to \"conference\";\n3)\tshall include an Expires header field set to 3600 seconds according to IETF RFC 4575 [30], as default value;\n4)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9]; and\n5)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-calling-group-id> set to the value of the MCPTT group ID;\nb)\tif the target is a MCPTT user, the value of <mcptt-request-uri> element set to the value of MCPTT ID of the targeted MCPTT user; and\nc)\tif the target is the non-controlling MCPTT function, the value of <mcptt-request-uri> element set to the constituent MCPTT group ID.\nIn the SIP NOTIFY request, the controlling MCPTT function shall include an application/conference-info+xml MIME body according to IETF RFC 4575 [30] with the following limitations:\n1)\tthe controlling MCPTT function shall include the MCPTT group ID of the MCPTT group in the \"entity\" attribute of the <conference-info> element;\n2)\tfor each participant in the MCPTT session with the exception of non-controlling MCPTT functions, the controlling MCPTT function shall include a <user> element. The <user> element shall:\nNOTE:\tNon-controlling MCPTT functions will appear as a participant in temporary group sessions.\na)\tinclude the \"entity\" attribute. The \"entity\" attribute:\ni)\tshall for the MCPTT client, which initiated, joined or rejoined an MCPTT session, include the MCPTT ID of the MCPTT user which originates SIP INVITE request; and\nii)\tshall for an invited MCPTT client include the MCPTT ID of the invited MCPTT user in case of a prearranged group call or chat group call;\nb)\tshall include a single <endpoint> element. The <endpoint> element:\ni)\tshall include the \"entity\" attribute;\nii)\tshall include the <status> element indicating the status of the MCPTT session according to IETF RFC 4575 [30]; and\niii)\tmay include one <functional-alias> element indicating the functional alias bound by the MCPTT user with the MCPTT group for which the notification is being sent as defined in the XML schema of clause 10.1.3.6.1; and\nNOTE 1:\tThe functional alias binding by the MCPTT user with the MCPTT group is done through either using an explicit procedure or as a part of call setup procedure.\nc)\tmay include <roles> element.\nNOTE 2:\tThe usage of <roles> is only applicable for human consumption.\nWhen the controlling MCPTT function receives a SIP INVITE request to initiate a group session, then after an MCPTT session identity has been allocated for the group session and if the <on-network-maximum-duration> element is present in the group document as specified in 3GPP TS 24.481 [31], the controlling MCPTT function: shall start timer TNG3 (group call timer) with the value obtained from the <on-network-maximum-duration> element of the group document as specified in 3GPP TS 24.481 [31].\nIf the <on-network-maximum-duration> element is not present in the group document as specified in 3GPP TS 24.481 [31], then the controlling MCPTT function shall not start timer TNG3 (group call timer).\nNOTE 1:\tThe configuration of <on-network-maximum-duration> element in 3GPP TS 24.481 [31] is mandated for a pre-arranged group and is optional for a chat group.\nWhen merging two or more active group calls into a temporary group call, the controlling MCPTT function(s) hosting the active group calls shall stop timer TNG3 (group call timer) for each group call, and the controlling MCPTT function hosting the temporary group call shall start timer TNG3 (group call timer) for the temporary group call.\nNOTE 2:\tIf the MCPTT server(s) hosting the independent active group calls are different to the MCPTT server that will host the temporary group call, then the MCPTT server(s) hosting the independent active group calls become non-controlling MCPTT function(s) of an MCPTT group, for the temporary group call.\nWhen splitting a temporary group call into independent group calls, the controlling MCPTT function hosting the temporary group call shall stop timer TNG3 (group call timer) and the controlling MCPTT function(s) hosting the independent group calls shall start TNG3 (group call timer) for each group call.\nWhen the last MCPTT client leaves the MCPTT session, the controlling MCPTT function shall stop timer TNG3 (group call timer).\nOn expiry of timer (group call timer), the controlling MCPTT function shall release the MCPTT session by following the procedures in clause 6.3.3.1.5;\nIf the controlling MCPTT function starts timer TNG2 (in-progress emergency group call timer), it shall not start timer TNG3 (group call timer).\nIf timer TNG3 (group call timer) is running and the MCPTT group call is upgraded to an MCPTT emergency group call, then the controlling MCPTT function shall stop timer TNG3 (group call timer) and shall start timer TNG2 (in-progress emergency group call timer) with the value obtained from the <group-time-limit> element of the <emergency-call> element of the <on-network> element of the service configuration document as specified in 3GPP TS 24.484 [50].If timer TNG2 (in-progress emergency group call timer) is running and the MCPTT emergency group call is cancelled, then the controlling MCPTT function shall stop timer TNG2 (in-progress emergency group call timer) and shall start timer TNG3 (group call timer) with the value obtained from the <on-network-maximum-duration> element of the group document as specified in 3GPP TS 24.481 [31].\nIf timer TNG2 (in-progress emergency group call timer) is running and subsequently expires, then the controlling MCPTT function shall start timer TNG3 (group call timer) with the value obtained from the <on-network-maximum-duration> element of the group document as specified in 3GPP TS 24.481 [31].\nNOTE:\tThe above conditions for starting timer TNG2 (in-progress emergency group call timer) and timer TNG3 (group call timer) also apply in the case that these timers are re-started. For example: the case where the timer TNG3 was initially running, the MCPTT group call is upgraded to an MCPTT emergency group call and then the MCPTT emergency group call is cancelled.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.4\tNon-controlling MCPTT function of an MCPTT group",
                            "text_content": "The SDP offer is generated based on the received SDP offer. The SDP offer generated by the non-controlling MCPTT function of an MCPTT group:\n1)\tshall include only one SDP media-level section for MCPTT speech as contained in the received SDP offer; and\n2)\tshall include one SDP media-level section for media plane control messages, if present in the received SDP offer.\nWhen composing the SDP offer according to 3GPP TS 24.229 [4], the non-controlling MCPTT function of an MCPTT group:\n1)\tshall replace the IP address and port number for the offered media stream in the received SDP offer with the IP address and port number of the non-controlling MCPTT function;\n2)\tshall include all media-level attributes from the received SDP offer;\n3)\tshall replace the IP address and port number for the offered media plane control channel, if any, in the received SDP offer with the IP address and port number of the non-controlling MCPTT function; and\n4)\tshall replace the mc_floor_ssrc 'fmtp' attribute for the offered media plane control channel, if any, in the received SDP offer with the RTCP SSRC that the non-controlling MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the answerer in the floor control messages sent to the non-controlling MCPTT function for this session; and\nNOTE:\tThe non-controlling MCPTT function will receive in the SDP answer the RTP SSRC it will have to use in the floor control message it will send to the answerer in this session.\n5)\tshall include any other necessary 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14.\nThis clause is referenced from other procedures.\nThe non-controlling MCPTT function of an MCPTT group shall generate initial SIP INVITE requests according to 3GPP TS 24.229 [4].\nFor each SIP INVITE request, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate a new MCPTT session identity for the MCPTT session with the invited MCPTT client and include it in the Contact header field together with the g.3gpp.mcptt media feature tag, the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\", and the isfocus media feature tag according to IETF RFC 3840 [16];\n2)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n5)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT ID of the MCPTT user to be invited;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the non-controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the MCPTT ID of the MCPTT user to be invited or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tshall copy the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request to the outgoing SIP INVITE request;\n6a)\tshall update the application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-calling-group-id> element set to the TGI or to the identity of the group regroup based on a preconfigured group;\n6b)\tshall update the application/vnd.3gpp.mcptt-info+xml MIME body with an <associated-group-id> element set to the identity of the constituent group;\n7)\tshall update the application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-request-uri> element set to the MCPTT ID of the invited MCPTT user;\n8)\tshall include the public service identity of the non-controlling MCPTT function in the P-Asserted-Identity header field;\n9)\tvoid;\n10) should include the Session-Expires header field according to rules and procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted;\n11)\tshall include the Supported header field set to \"timer\";\n12)\tvoid.\n13)\tshall include an unmodified Answer-Mode header field, if present in the incoming SIP INVITE request;and\n14)\tvoid.\nThis clause is referenced from other procedures.\nThe non-controlling MCPTT function shall generate a SIP INFO request according to rules and procedures of 3GPP TS 24.229 [4] and IETF RFC 6086 [64].\nThe non-controlling MCPTT function:\n1)\tshall include the Info-Package header field set to g.3gpp.mcptt-floor-request;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-request-uri> set to the temporary MCPTT group ID and the <mcptt-calling-group-id> element with the constituent MCPTT group ID;\n3)\tshall include an application/vnd.3gpp.mcptt-floor-request+xml MIME body with the Content-Disposition header field set to \"Info-Package\". For each current speaker the application/vnd.3gpp.mcptt-floor-request+xml MIME body shall be populated as follows:\na)\tthe <floor-type> element set to \"general\" or \"dual\" as described in clause F.5.3;\nb)\tthe SSRC of the MCPTT client with the permission to send media in the <ssrc> element;\nc)\tthe actual floor priority in the <floor-priority> element;\nd)\tthe MCPTT ID of the MCPTT user with the permission to send media in the <user-id> element;\ne)\tthe queueing capability in the <queueing-capability> element of the <track-info> element;\nf)\tthe participant type in the <participant-type> in the <track-info> element;\ng)\tone or more <floor-participant-reference> elements in the <track-info> element in the same order as the would appear in the Track Info field as specified in 3GPP TS 24.380 [5] clause 8.2.3.13; and\nh)\tif available, additional information in the <floor-indicator> element; and\n4)\tif:\na)\tthe non-controlling MCPTT function has location information (see clause 13.2.4) for the MCPTT client; and\nb)\tthe location information for the MCPTT client either has not been sent to the controlling MCPTT function or has changed since last sent to the MCPTT controlling function; and\nc)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element.\nThis clause is referenced from other procedures.\nThe non-controlling MCPTT function shall generate a SIP INVITE request according to rules and procedures of 3GPP TS 24.229 [4].\nThe non-controlling MCPTT function:\n1)\tshall include in the Contact header field the g.3gpp.mcptt media feature tag, the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\", and the isfocus media feature tag according to IETF RFC 3840 [16];\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n3)\tshall set the Request-URI to the public service identity of the controlling MCPTT function based on the <mcptt-request-uri> element received in the \"SIP INVITE request from participating MCPT function for non-controlling MCPTT function of an MCPTT group\";\nNOTE 1:\tThe public service identity can identify the controlling MCPTT function in the local MCPTT system or in an interconnected MCPTT system.\nNOTE 2:\tIf the controlling MCPTT function is in an interconnected MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the interconnected MCPTT system from the local MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in an interconnected MCPTT system in a different trust domain, then the local MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the local MCPTT system to the interconnected MCPTT system\nNOTE 4:\tHow the non-controlling MCPTT function determines the public service identity of the controlling MCPTT function based on the <mcptt-request-uri> element received in the \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" or of the MCPTT gateway server in the interconnected MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the local MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n4)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with:\na)\tthe <session-type> element set to \"prearranged\" or \"chat\" depending on the type of the group identified by the TGI or of the group regroup based on a preconfigured group;\nb)\tthe <mcptt-request-uri> element set to the TGI or to the identity of the group regroup based on a preconfigured group received in the <mcptt-request-uri> element of the received SIP INVITE;\nc)\tthe <mcptt-calling-group-id> element set to the identity of the constituent group received in the <associated-group-id> element of the received SIP INVITE;\nd)\tthe <mcptt-calling-user-id> element set to the identity of the calling user received in the <mcptt-calling-user-id> element of the received SIP INVITE; and\ne)\tthe <required> element set to \"true\", if the group document retrieved from the group management server contains <on-network-required> group members as specified in 3GPP TS 24.481 [31];\n5)\tshall include the public service identity of the non-controlling MCPTT function in the P-Asserted-Identity header field;\n6)\tshould include the Session-Expires header field according to rules and procedures of IETF RFC 4028 [7]. The refresher parameter shall be omitted; and\n7)\tshall include the Supported header field set to \"timer\".\nWhen composing the SDP answer according to 3GPP TS 24.229 [4], the non-controlling MCPTT function of an MCPTT group:\n1)\tfor the accepted media stream in the received SDP offer:\na)\tshall replace the IP address and port number in the received SDP offer with the IP address and port number of the non-controlling MCPTT function; and\n2)\tfor the accepted media plane control channel, if present in the received SDP offer:\na)\tshall replace the IP address and port number in the received SDP offer with the IP address and port number of the non-controlling MCPTT function; and\nb)\tshall replace the mc_floor_ssrc 'fmtp' attribute in the received SDP offer with the RTCP SSRC that the non-controlling MCPTT function has selected as specified in 3GPP TS 24.380 [5] clause 4.3 and shall be used by the offerer in the floor control messages sent to the non-controlling MCPTT function for this session; and\nNOTE:\tThe non-controlling MCPTT function has received in the SDP offer the RTP SSRC it will have to use in the floor control message it will send to the offerer in this session.\nc)\tshall include any other necessary 'fmtp' attribute as specified in 3GPP TS 24.380 [5] clause 14.\nWhen sending a SIP 183 (Session Progress) the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate a SIP 183 (Session Progress) response according to 3GPP TS 24.229 [4];\n2)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag; and\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tshall include the public service identity of the non-controlling MCPTT function in the P-Asserted-Identity header field; and\n4)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23];\nWhen sending a SIP 200 (OK) response, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate the SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall include the Session-Expires header field and start supervising the SIP session according to rules and procedures of IETF RFC 4028 [7], \"UAS Behavior\". The \"refresher\" parameter in the Session-Expires header field shall be set to \"uac\";\n3)\tshall include the option tag \"timer\" in a Require header field;\n4)\tshall include the public service identity of the non-controlling MCPTT function in the P-Asserted-Identity header field;\n5) shall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag; and\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n6)\tif allowed by local policy and if Warning header field(s) were received in incoming responses to SIP INVITE requests that were sent as a result of following the procedures of clause 6.3.4.1.2, shall include those Warning header field(s);\n7)\tshall include the option tag \"tdialog\" in a Supported header field according to rules and procedures of IETF RFC 4538 [23]; and\n8)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-called-party-id> element set to the constituent MCPTT group ID and the <floor-state> element set to the state of the floor.\nThe non-controlling MCPTT function shall generate a SIP NOTIFY request according to 3GPP TS 24.229 [4] with the clarification in this clause.\nIn the SIP NOTIFY request, the non-controlling MCPTT function:\n1)\tshall set the P-Asserted-Identity header field to the public service identity of the non-controlling MCPTT function;\n2)\tshall include an Event header field set to \"conference\";\n3)\tshall include an Expires header field set to 3600 seconds according to IETF RFC 4575 [30], as default value;\n4)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9]; and\n5)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-calling-group-id> set to the value of the constituent MCPTT group ID;\nb)\tif the target is a MCPTT user, the value of <mcptt-request-uri> element set to the MCPTT ID of the targeted MCPTT user; and\nc)\tif the target is the controlling MCPTT function the value of <mcptt-request-uri> element set to the temporary MCPTT group ID.\nIn the SIP NOTIFY request, the non-controlling MCPTT function shall include application/conference-info+xml MIME body according to IETF RFC 4575 [30] as specified in clause 6.3.3.4 with the following exceptions:\n1)\tthe non-controlling MCPTT function shall not regard the controlling MCPTT function as a participant and not include the controlling MCPTT function in a <user> element; and\nNOTE:\tThe controlling MCPTT function initiated the temporary group call and will appear as a participant in the group session.\n2)\tthe non-controlling MCPTT function shall include stored conference status information received in SIP NOTIFY requests from the controlling MCPTT function in clause 10.1.3.5.3 and status information about own participants.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.5\tRetrieving and processing a group document",
                            "text_content": "This clause describes how an MCPTT server accesses a group document from a group management server. The MCPTT server which accesses a group document performs the role of a controlling MCPTT function or performs the role of a non-controlling MCPTT function of an MCPTT group when accessing a group document. In such cases, for a group call:\n-\tthe controlling MCPTT function and group management server are both located in the primary MCPTT system;\n-\tthe controlling MCPTT function and group management server are both located in a partner MCPTT system;\n-\tthe controlling MCPTT function is located in the primary MCPTT system and accesses a group management server in the primary MCPTT system and a non-controlling MCPTT function of an MCPTT group is located in a partner MCPTT system and accesses a group management server in the partner MCPTT system; or\n-\tthe controlling MCPTT function and non-controlling MCPTT function(s) of an MCPTT group are located in the primary MCPTT system and access group management servers in the primary MCPTT system.\nWhen the MCPTT server receives a SIP INVITE request that requires it to access a group document, it uses an MCPTT group ID or a temporary MCPTT group identity (TGI) which was created by the group regrouping operation as specified in 3GPP TS 24.481 [31].\nThe MCPTT server can cache the group document associated with an MCPTT group or temporary group, and can subscribe to be notified of changes to the group document associated with an MCPTT group or temporary group as specified in 3GPP TS 24.481 [31].\nNOTE 1:\tDuring the group regrouping operation as specified in 3GPP TS 24.481 [31], the controlling MCPTT function is notified of the constituent MCPTT group identities associated with the TGI.\nIf the group data associated with an MCPTT group ID or TGI cached in the MCPTT server is removed, the MCPTT server re-subscribes for changes in the group information associated with the MCPTT group ID or TGI.\nNOTE 2:\tRe-subscription can occur prior to the receipt of an SIP INVITE request containing an MCPTT group ID or TGI of a group document which is no longer cached on the MCPTT server.\nNOTE 1:\tIn this clause, \"MCPTT server\" can refer to either the controlling MCPTT function of an MCPTT group or the non-controlling MCPTT function of an MCPTT group.\nWhen the group document is retrieved for the controlling MCPTT function procedures or for the non-controlling MCPTT function terminating procedures (clauses 10.1.1.5.2), the requested group identity refers to the group identity in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request.\nWhen the group document is retrieved for the non-controlling MCPTT function to initiate a temporary group session (clause 10.1.1.5.5), the requested group identity refers to the group identity of the constituent group contained in the <associated-group-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request.\nUpon receipt of a SIP INVITE request:\n1)\tif the MCPTT server is not yet subscribed to the group document for the requested group, the MCPTT server shall subscribe to the \"xcap-diff\" event-package for the group document of this group identity as specified in 3GPP TS 24.481 [31];\nNOTE 2:\tThe requested group identity is either an MCPTT group ID or a temporary MCPTT group identity (TGI).\nNOTE 3:\tAs a group document can potentially have a large content, the controlling MCPTT function of an MCPTT group can subscribe to the group document indicating support of content-indirection as defined in IETF RFC 4483 [32], by following the procedures in 3GPP TS 24.481 [31].\n2)\tupon receipt of a SIP 404 (Not Found) response as a result of attempting to subscribe to the \"xcap-diff\" event-package for the group document of the requested group as specified in 3GPP TS 24.481 [31], the MCPTT server shall send the SIP 404 (Not Found) response with the warning text set to \"113 group document does not exist\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\n3)\tupon receipt of any other SIP 4xx, SIP 5xx or SIP 6xx response as a result of attempting to subscribe to the \"xcap-diff\" event-package for the group document of the requested group identity as specified in 3GPP TS 24.481 [31], the MCPTT server shall send the SIP final response with the warning text set to \"114 unable to retrieve group document\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n4)\tupon receipt of a notification from the group management server containing the group document for the requested group identity, or if the group document is already cached:\na)\tif the MCPTT server is a non-controlling function of an MCPTT group, then the MCPTT server shall exit this clause; and\nb)\tif the MCPTT server is a controlling function of an MCPTT group, then the MCPTT server shall determine if the group document is for a TGI or an MCPTT group ID as follows:\ni)\tif the group document includes an <on-network-temporary> element, then the group document is associated with a TGI;\nii)\tif the group document does not include an <on-network-temporary> element or an <on-network-regrouped> element, then the group document is associated with an MCPTT group ID that has not been regrouped; and\niii)\tif the group document does not include an <on-network-temporary> element but includes an <on-network-regrouped> element, then the group document is associated with an MCPTT group ID that has been regrouped;\n5)\tif the requested group identity is an MCPTT group ID that has not been re-grouped, then:\na)\tif the <on-network-disabled> element is present in the group document, shall send a SIP 403 (Forbidden) response with the warning text set to \"115 group is disabled\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nb)\tif the <list> element of the <list-service> element does not contain an entry matching the MCPTT ID of the user in the SIP INVITE request, shall send a SIP 403 (Forbidden) response with the warning text set to \"116 user is not part of the MCPTT group\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nc)\tif the <on-network-invite-members> element is set to \"true\" and if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element containing a value not set to \"prearranged\", shall return a SIP 404 (Not Found) response with the warning text set to \"117 the group identity indicated in the request is a prearranged group\" as specified in clause 4.4 \"Warning header field\" and shall not continue with the rest of the steps; and\nd)\tif the <on-network-invite-members> element is set to \"false\" and if the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element containing a value not set to \"chat\" shall return a SIP 404 (Not Found) response with the warning text set to \"118 the group identity indicated in the request is a chat group\" as specified in clause 4.4 \"Warning header field\" and shall not continue with the rest of the steps; and\n6)\tif the requested group identity is an MCPTT group ID that has been regrouped then the MCPTT server:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"148 group is regrouped\" as specified in clause 4.4 \"Warning header field\" and shall not continue with the rest of the steps.\n\nThe following conditions shall be met for the controlling MCPTT function to allow an MCPTT user to join an existing group session:\n1)\tan <entry> element exists in the <list> element of the group document for the MCPTT user;\n2)\ta <rule> exists in the group document with:\na)\tthe <is-list-member> element of the <conditions> element present and with the <join-handling> element of the corresponding <actions> element set to \"true\"; or\nb)\tthe <identity> element of the <conditions> element containing an entry matching the MCPTT ID in the SIP INVITE request, with the <join-handling> element of the <actions> element set to \"true\"; and\n3)\tif the <supported-services> element is present, it contains:\na)\ta <service> element containing an \"enabler\" attribute which is set to the MCPTT ICSI; and\nb)\tif a <group-media> element is present, an entry set to \"MCPTT speech\".\nIf all of the above conditions are not met, then the MCPTT user shall not be authorised to join the group session.\nWhen the non-controlling MCPTT function of an MCPTT group receives a request to intiate a group session for the calling MCPTT user, if:\n1)\tone of the following conditions is met:\na)\tthe <on-network-regrouped> element in the <list-service> element is present in the group document associated with the MCPTT group ID identified in the <associated-group-id> element of the incoming SIP INVITE and if the MCPTT group ID indicated in the <mcptt-request-uri> element of the incoming INVITE request is the same as the MCPTT group ID in the \"temporary-MCPTT-group-ID\" attribute of the <on-network-regrouped> element; or\nb)\taccording to the information stored per procedures of clause 16, the group identified in the <mcptt-request-uri> of the incoming SIP INVITE is a group regroup based on a preconfigured group and if the group identified in the <associated-group-id> of the incoming SIP INVITE is a constituent group of that group regroup based on a preconfigured group according;\nNOTE 1:\tIn this step 1), the non-controlling MCPTT function checks the consistency of the constituent group with the called group regroup.\n2)\tan <entry> element set to the MCPTT IDof the calling MCPTT user exists in the <list> element of the group document associated with the MCPTT group ID identified in the <associated-group-id> element of the incoming SIP INVITE;\nNOTE 2:\tIn this step 2), the non-controlling MCPTT function checks that the calling MCPTT user is a member of the constituent group.\n3)\ta <rule> exists in the group document with:\na)\tthe <is-list-member> element of the <conditions> element present and with the <allow-initiate-conference> element of the corresponding <actions> element set to \"true\"; or\nb)\tthe <identity> element of the <conditions> element containing an entry matching the MCPTT ID of the calling MCPTT user identified in the <mcptt-calling-user-id> element of the SIP INVITE request, with the <allow-initiate-conference> element of the <actions> element is set to \"true\"; and\n4)\tthe <supported-services> element exists in the group document with:\na)\ta <service> element containing an \"enabler\" attribute which is set to the MCPTT ICSI; and\nb)\ta <group-media> element containing an entry set to \"MCPTT speech\".\nNOTE 3:\tIn these steps 3) and 4) the non-controlling MCPTT function checks that the calling MCPTT user is allowed to initiate the group call per the rules in the group document, and that the group is supporting MCPTT services.\nthen the calling MCPTT user shall be authorised by the non-controlling MCPTT function to initiate the group session. Otherwise, the calling MCPTT user shall not be authorised by the non-controlling MCPTT function to initiate the group session.\nWhen the controlling MCPTT function of an MCPTT group receives a request to intiate a group session for the calling MCPTT user, if:\nNOTE 4:\tThe check that the MCPTT group has not been regrouped (is not a constituent group) is done in the parent procedure and in clause 6.3.5.2.\n1)\tthe MCPTT group ID identified in the <mcptt-request-uri> element of the incoming SIP INVITE is a temporary group or a group regroup based on preconfigured group, then the calling MCPTT user shall be authorised by the controlling MCPTT function to initiate the group session and the rest of the steps in this clause shall be skipped;\nNOTE 5:\tThe consistency of the constituent group with the called regroup has been checked at the non-controlling MCPTT function.\nNOTE 6:\tThe check that the requesting user is authorised to initiate the group call has been done at the non-controlling MCPTT function of the constituent group.\n2)\tone of the following conditions is met:\na)\tan <entry> element set to the MCPTT ID of the calling MCPTT user exists in the <list> element of the group document associated with the MCPTT group ID identified in the <mcptt-request-uri> element of the incoming SIP INVITE; or\nb)\tthe group is a user regroup based on a preconfigured group and the MCPTT ID contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request is included in the list of users that was stored during successful processing of the creation of the user regroup per clause 16;\nNOTE 7:\tIn this step 2), the controlling MCPTT function checks that the calling MCPTT user is a member of the normal group (i.e., not a constituent group nor a regroup) or a user regroup.\n3)\ta <rule> exists in the group document with:\na)\tthe <is-list-member> element of the <conditions> element present and with the <allow-initiate-conference> element of the corresponding <actions> element set to \"true\"; or\nb)\tthe <identity> element of the <conditions> element containing an entry matching the MCPTT ID of the calling MCPTT user identified in the <mcptt-calling-user-id> element of the SIP INVITE request, with the <allow-initiate-conference> element of the <actions> element is set to \"true\"; and\n4)\tthe <supported-services> element exists in the group document with:\na)\ta <service> element containing an \"enabler\" attribute which is set to the MCPTT ICSI; and\nb)\ta <group-media> element containing an entry set to \"MCPTT speech\".\nNOTE 8:\tIn these steps 3) and 4), the controlling MCPTT function checks that the calling MCPTT user is allowed to initiate the group call per the rules in the group document, and that the group is supporting MCPTT services.\nthen the calling MCPTT user shall be authorised by the controlling MCPTT function to initiate the group session. Otherwise, the calling MCPTT user shall not be authorised by the controlling MCPTT function to initiate the group session.\nThe MCPTT server shall only invite affiliated group members to a group session.\nIf the group is not a regroup based on a preconfigured group, the MCPTT server determines the affiliated members from the entries contained in the <list> element of the group document by following the procedures specified in clause 6.3.6.\nIf the group is a regroup based on a preconfigured group, the MCPTT server determines the affiliated members from the list of users that was stored during successful processing of the creation of the regroup per clause 16 by following the procedures specified in clause 6.3.6.\nNOTE 1:\tThe term \"affiliated group members\" used above also includes those members that are implicitly affiliated by the controlling MCPTT function.\nIf the number of members of the MCPTT group exceeds the value contained in the <on-network-max-participant-count> element the MCPTT server shall invite only <on-network-max-participant-count> members from the list, but shall prioritise inviting those group members to the group session that have an <entry> element in the <list> element with a <on-network-required> element present.\nNOTE 2:\tThe <on-network-max-participant-count> element indicates the maximum number of participants allowed in the group session. The <on-network-required> element is used to determine which group members need to acknowledge the group call before audio transmission can proceed.\nNOTE 3:\tOther requirements for how the controlling MCPTT function selects which of the <on-network-max-participant-count> members to invite is outside the scope of this specification.\nNOTE 4:\tIt is assumed that validation checks are performed at the group management server to ensure that the <on-network-max-participant-count> cannot be less than the number of <on-network-required> users.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.6\tAffiliation check",
                            "text_content": "The MCPTT server checks if an MCPTT user is affiliated to an MCPTT group at an MCPTT client by following the procedures specified below:\n1.\tthe MCPTT server shall find the applicable MCPTT group information entry as an MCPTT group information entry of the list of MCPTT group information entries described in clause 9.2.2.3.2, such that the MCPTT group ID of the MCPTT group information entry is equal to the MCPTT group identity of the MCPTT group. If the applicable MCPTT group information entry cannot be found, then the MCPTT server shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the MCPTT server shall not continue with rest of the steps;\n2.\tthe MCPTT server shall find the applicable MCPTT user information entry as an MCPTT user information entry of the list of MCPTT user information entries of the applicable MCPTT group information entry, such that the MCPTT ID of the MCPTT user information entry is equal to the MCPTT ID of the MCPTT user. If the applicable MCPTT user information entry cannot be found, then the MCPTT server shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the MCPTT server shall not continue with rest of the steps;\n3.\tif the MCPTT client ID of the MCPTT client cannot be found in the list of MCPTT client information entries of the applicable MCPTT user information entry, then the MCPTT server shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the MCPTT server shall not continue with rest of the steps;\nNOTE:\tthe MCPTT client ID of the originating MCPTT client can be found in the <mcptt-client-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of a SIP INVITE request, SIP REFER request or SIP MESSAGE request originated by the MCPTT client.\n4.\tif the expiration time of the applicable MCPTT user information entry has been reached, then the MCPTT server shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the MCPTT server shall not continue with rest of the steps; and\n5.\tthe MCPTT server shall determine that the MCPTT user is affiliated to the MCPTT group at the MCPTT client.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.7\tError handling",
                            "text_content": "Upon receiving a request that includes the Request-URI set to a public service identity that is not allocated in the participating or the controlling MCPTT function, the participating or the controlling MCPTT function shall return a SIP 404 (Not Found) response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.3.8\tSession release policy",
                            "text_content": "If:\n1)\tthe call is a pre-arranged group call and if the controlling MCPTT function receives an indication from the media plane that the T4 (Inactivity) timer specified in 3GPP TS 24.380 [5] expired;\n2)\tthere are only one or no participants in the MCPTT session;\n3)\tthe call is a pre-arranged group call and if it is according to local policy, the initiator of the group call leaves the MCPTT session;\n4)\tthe minimum number of affiliated MCPTT group members is not present;\n5)\ttimer TNG3 (group call timer) expires; or\n6)\tthe call is a broadcast group call and if the controlling MCPTT function receives an indication from the media plane that the T4 (Inactivity) timer specified in 3GPP TS 24.380 [5] expired;\nthe controlling MCPTT function shall release the MCPTT session for the group call.\nIf:\n1)\tthe controlling MCPTT function receives an indication from the media plane that the T4 (Inactivity) timer specified in 3GPP TS 24.380 [5] expired;\n2)\tthe MCPTT session has lasted longer than the maximum of duration of private call; or\n3)\tthere are only one or no participants in the MCPTT session;\nthe controlling MCPTT function shall release the MCPTT session for a private call.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.4\tImplicit floor request",
                    "description": "",
                    "summary": "",
                    "text_content": "An initial SIP INVITE request fulfilling the following criteria shall be regarded by the MCPTT server as an implicit floor request by the originating MCPTT client when the MCPTT client:\n1)\tinitiates an MCPTT speech session or initiates a pre-established session that is not used for a remotely initiated MCPTT ambient listening call; and\n2)\tincludes the \"mc_implicit_request\" 'fmtp' attribute in the associated UDP stream for the floor control in the SDP offer/answer as specified in 3GPP TS 24.380 [5] clause 12.\nAn initial SIP INVITE request fulfilling the following criteria shall be regarded by the MCPTT server as an implicit request to grant the floor to the terminating MCPTT client when the originating MCPTT client:\n1)\tinitiates a remotely initiated MCPTT ambient listening call; and\n2)\tincludes the \"mc_implicit_request\" 'fmtp' attribute in the associated UDP stream for the floor control in the SDP offer/answer as specified in 3GPP TS 24.380 [5] clause 12.\nA SIP re-INVITE request fulfilling the following criteria shall be regarded by the MCPTT server as an implicit floor request when the MCPTT client:\n1)\tperforms an upgrade of:\na)\tan MCPTT group call to an emergency MCPTT group call;\nb)\tan MCPTT private call to an emergency MCPTT private call; or\nc)\tan MCPTT group call to an imminent peril MCPTT group call; and\n2)\tincludes the \"mc_implicit_request\" 'fmtp' attribute in the associated UDP stream for the floor control in the SDP offer/answer as specified in 3GPP TS 24.380 [5] clause 12.\nIn all other cases the SIP (re-)INVITE request shall be regarded as received without an implicit floor request.\nWhen using a pre-established session the MCPTT server shall regard the SIP REFER request as an implicit floor request:\n1)\tif the pre-established session was established with an implicit floor request and if an SDP offer is not included in a \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field;\n2)\tif the pre-established session was established with an implicit floor request, an SDP offer is included in a \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field, and this SDP includes the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer; or\n3)\tif the pre-established session was established without an implicit floor request and the SDP offer in a \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field includes the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer.\nIn all other cases the SIP REFER request shall be regarded as received without an implicit floor request.\nWhen using a pre-established session the MCPTT server shall regard the SIP REFER request as an implicit request to grant the floor to the terminating MCPTT client:\n1)\tif the pre-established session was established with an SDP offer included in a \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists MIME+xml body, referenced by the \"cid\" URL in the Refer-To header field, and this SDP includes the \"mc_implicit_request\" media level attribute in the associated UDP stream for the floor control in the SDP offer; and\n2)\tthe pre-established session is being used for a remotely initiated ambient listening call.\nIn all other cases the SIP REFER request shall be regarded as received without an implicit request to grant the floor to the terminating MCPTT client.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.5\tHandling of MIME bodies in a SIP message",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCPTT client and the MCPTT server shall support several MIME bodies in SIP request and SIP responses.\nWhen the MCPTT client or the MCPTT server sends a SIP message and the SIP message contains more than one MIME body, the MCPTT client or the MCPTT server:\n1)\tshall, as specified in IETF RFC 2046 [21], include one Content-Type header field with the value set to multipart/mixed and with a boundary delimiter parameter set to any chosen value;\n2)\tfor each MIME body:\na)\tshall insert the boundary delimiter;\nb)\tshall insert the Content-Type header field with the MIME type of the MIME body; and\nc)\tshall insert the content of the MIME body;\n3)\tshall insert a final boundary delimiter; and\n4)\tif an SDP offer or an SDP answer is one of the MIME bodies, shall insert the application/sdp MIME body as the first MIME body.\nNOTE:\tThe reason for inserting the application/sdp MIME body as the first body is that if a functional entity in the underlying SIP core does not understand multiple MIME bodies, the functional entity will ignore all MIME bodies with the exception of the first MIME body. The order of multiple MCPTT application MIME bodies in a SIP message is irrelevant.\nWhen the MCPTT client or the MCPTT server sends a SIP message and the SIP message contains only one MIME body, the MCPTT client or the MCPTT server:\n1)\tshall include a Content-Type header field set to the MIME type of the MIME body; and\n2)\tshall insert the content of the MIME body.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.6\tConfidentiality and Integrity Protection",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.6.1\tGeneral",
                            "text_content": "The procedures in clauses 6.6 apply in general to all procedures described in clause 9, clause 10, clause 11 and clause 12 with the exception that the confidentiality and integrity protection procedures for the registration and service authorisation procedures are described in clause 7.\nWhenever the MCPTT UE includes XML elements or attributes pertaining to the data specified in clause 4.8 in SIP requests or SIP responses, the MCPTT UE shall perform the procedures in clause 6.6.2.3.1.\nWhenever the MCPTT server includes XML elements or attributes pertaining to the data specified in clause 4.8 in SIP requests or SIP responses, the MCPTT server shall perform the procedures in clause 6.6.2.3.2, with the exception that when the MCPTT server receives a SIP request with XML elements or attributes in an MIME body that need to be copied from the incoming SIP request to an outgoing SIP request without modification, the MCPTT server shall perform the procedures specified in clause 6.6.2.5.\nNOTE:\tThe procedures in clause 6.6.2.3.1 and clause 6.6.2.3.2 first determine (by referring to configuration) if confidentiality protection is enabled and then call the necessary procedures to encrypt the contents of the XML elements if confidentiality protection is enabled.\nThe functional entity shall perform the procedures in the clause just prior to sending a SIP request or SIP response.\n1)\tThe MCPTT UE shall perform the procedures in clause 6.6.3.3.1; and\n2)\tThe MCPTT server shall perform the procedures in clause 6.6.3.3.2.\nNOTE:\tThe procedures in clause 6.6.3.3.1 and clause 6.6.3.3.2 first determine if integrity protection of XML MIME bodies is required and then calls the necessary procedures to integrity protect each XML MIME body if integrity protection is required. Each XML MIME body has its own signature.\nWhenever the functional entity (i.e. MCPTT UE or MCPTT server) receives a SIP request or a SIP response, the functional entity shall perform the following procedures before performing any other procedures.\n1)\tThe functional entity shall determine if integrity protection has been applied to an XML MIME body by following the procedures in clause 6.6.3.4.1 and if integrity protection has been applied:\na)\tshall use the keying information described in clause 6.6.3.2 and the procedures described in clause 6.6.3.4.2 to verify the integrity of the XML MIME body; and\nb)\tif the integrity protection checks fail shall not perform any further procedures in this clause;\n2)\tThe functional entity shall determine whether confidentiality protection has been applied to XML elements in XML MIME bodies in a SIP request or SIP response, pertaining to the data specified in clause 4.8, by following the procedures in clause 6.6.2.4.1, and if confidentiality protection has been applied:\na)\tshall use the keying information described in clause 6.6.2.2 along with the procedures described in clause 6.6.2.4.2 to decrypt the received values; and\nb)\tif any decryption procedures fail, shall not perform any further procedures in this clause.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.2\tConfidentiality Protection",
                            "text_content": "In general, confidentiality protection is applied to specific XML elements and attributes in XML MIME bodies in SIP requests and responses as specified in clause 4.8. However in the case of SIP REFER requests used for pre-established sessions, confidentiality protection is required for:\nthe targeted MCPTT ID or MCPTT Group ID in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body that is pointed to by a \"cid\" URL located in the Refer-To header field of the SIP REFER request; and\n-\tsensitive XML data included in MIME bodies which are placed in the hname \"body\" parameter in the headers portion of the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body.\nConfiguration for applying confidentiality protection is not selective to a specific XML element or attribute of the data described in clause 4.8. If configuration for confidentiality protection is turned on, then all XML elements and attributes described in clause 4.8 are confidentiality protected. If configuration for confidentiality protection is turned off, then no XML content in SIP requests and SIP responses are confidentiality protected.\nConfidentiality protection uses an XPK to encrypt the data which (depending on who is the sender and who is the receiver of the encrypted information) can be a CSK or an SPK as specified in clause 4.8. An XPK-ID (CSK-ID/SPK-ID) is used to key the XPK (CSK/SPK). It is assumed that before the procedures in this clause are called, the CSK/CSK-ID and/or SPK/SPK-ID are available on the sender and recipient of the encrypted content as described in clause 4.8.\nThe procedures in clause 6.6.2.3 and clause 6.6.2.4 are used with a XPK equal to the CSK and a XPK-ID equal to the CSK-ID in the following circumstances as described in 3GPP TS 33.180 [78]:\n1)\tMCPTT client sends confidentiality protected content to an MCPTT server; and\n2)\tMCPTT server sends confidentiality protected content to an MCPTT client.\nThe procedure in clause 6.6.2.3 and clause 6.6.2.4 are used with a XPK equal to the SPK and a XPK-ID equal to the SPK-ID in the following circumstances as described in 3GPP TS 33.180 [78]:\n1)\tMCPTT server sends confidentiality protected content to an MCPTT server in the same domain; and\n2)\tMCPTT server sends confidentiality protected content to an MCPTT server in another domain.\nIf the <confidentiality-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"true\" or no <confidentiality-protection> element is present in the Service Configuration document, then sending confidentiality protected content from the MCPTT client to the MCPTT server is enabled, and the MCPTT client:\n1)\tshall use the appropriate keying information specified in clause 6.6.2.2;\n2)\tshall perform the procedures in clause 6.6.2.3.3 to confidentiality protect XML elements containing the content described in clause 4.8; and\n3)\tshall perform the procedures in clause 6.6.2.3.4 to confidentiality protect URIs in XML attributes for URIs described in clause 4.8.\nIf the <confidentiality-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending confidentiality protected content from the MCPTT client to the MCPTT server is disabled, and content is included in XML elements and attributes without encryption.\nIf the <confidentiality-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"true\" or no <confidentiality-protection> element is present in the Service Configuration document, then sending confidentiality protected content from the MCPTT server to the MCPTT client is enabled. If the <allow-signalling-protection> element of the <protection-between-mcptt-servers> element is set to \"true\" in the Service Configuration document as specified in 3GPP TS 24.484 [50] or no <allow-signalling-protection> element is present in the Service Configuration document, then sending confidentiality protected content between MCPTT servers is enabled.\nWhen sending confidentiality protected content, the MCPTT server:\n1)\tshall use the appropriate keying information specified in clause 6.6.2.2;\n2)\tshall perform the procedures in clause 6.6.2.3.3 to confidentiality protect XML elements containing the content described in clause 4.8, and\n3)\tshall perform the procedures in clause 6.6.2.3.4 to confidentiality protect URIs in XML attributes for URIs described in clause 4.8.\nIf the <confidentiality-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending confidentiality protected content from the MCPTT server to the MCPTT client is disabled, and then content is included in XML elements and attributes without encryption.\nIf the <allow-signalling-protection> element of the <protection-between-mcptt-servers> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending confidentiality protected content between MCPTT servers is disabled, and content is included in XML elements and attributes without encryption.\nThe following procedures shall be performed by an MCPTT client or an MCPTT server:\n1)\tperform encryption as specified in W3C: \"XML Encryption Syntax and Processing Version 1.1\", https://www.w3.org/TR/xmlenc-core1/ [60] clause 4.3, using the \"AES-128-GCM algorithm HMAC\" as the encryption algorithm and the XPK as the key; and\n2)\tfollow the semantic for the element of the MIME body as described in Annex F of the present document, to include the encrypted content in the MIME body ensuring that the necessary XML elements required for confidentiality protection are included as specified in 3GPP TS 33.180 [78].\nThe following procedures shall be performed by an MCPTT client or an MCPTT server:\n1)\tperform encryption as specified in IETF RFC 5288 [83], using the \"AES-128-GCM algorithm HMAC\" as the encryption algorithm and the XPK as the key, with a 96 bit randomly selected IV; and\n2)\treplace the URI to be protected in the attribute by a URI constructed as follows:\na)\tthe URI schema is \"\";\nb) the first part of the userinfo part is the base64 encoded result of the encryption of the original attribute value;\nc)\tthe string \";iv=\" is appended to the result of step b);\nd)\tthe base64 encoding of the IV (section 5 of IETF RFC 4648 [71]) is appended to the result of step c);\ne)\tthe string \";key-id=\" is appended to the result of step d);\nf)\tthe base64 encoding of the XPK-ID according to 3GPP 33.180 [78] is appended to the result of step e);\ng)\tthe string \";alg=128-aes-gcm\" is appended to the result of step f); and\nh)\tthe string \"@\" followed by the domain name for MCPTT confidentiality protection as specified in 3GPP TS 23.203 [41] is appended to the result of step g).\nThe following procedure is used by the MCPTT client or MCPTT server to determine if an XML element is confidentiality protected.\n1)\tif an XML element contains the <EncryptedData> XML element, then the content of the XML element is confidentiality protected; and\n2)\tif an XML element does not contain the <EncryptedData> XML element, then the content of the XML element is.not confidentiality protected.\nThe following procedure is used by the MCPTT client or MCPTT server to determine if a URI in the XML attribute is confidentiality protected.\n1)\tif an XML attribute is a URI with the domain name for MCPTT confidentiality protection as specified in the 3GPP TS 23.003 [40], then the URI is confidentiality protected; and\n2)\tif an XML attribute is a URI without the domain name for MCPTT confidentiality protection as specified in the 3GPP TS 23.003 [40], then the URI is not confidentiality protected.\nThe following procedure shall be performed by an MCPTT client or an MCPTT server to decrypt an individual XML element that has a type of \"encrypted\" within an XML MIME body:\n1)\tif the <EncryptedData> XML element or any of its sub-elements as described in 3GPP TS 33.180 [78] are not present in the MIME body then send a SIP 403 (Forbidden) response with the warning text set to \"140 unable to decrypt XML content\" in a Warning header field as specified in clause 4.4, and exit this procedure. Otherwise continue with the rest of the steps;\n2)\tperform decryption on the <EncryptedData> element as specified in W3C: \"XML Encryption Syntax and Processing Version 1.1\", https://www.w3.org/TR/xmlenc-core1/ [60] clause 4.4 to decrypt the contents of the <CipherValue> element contained within the <CipherData> element;\n3)\tif the decryption procedure fails, then send a SIP 403 (Forbidden) response with the warning text set to \"140 unable to decrypt XML content\" in a Warning header field as specified in clause 4.4. Otherwise continue with the rest of the steps; and\n4)\treturn success of this procedure together with the decrypted XML element.\nThe following procedure shall be performed by an MCPTT client or an MCPTT server to decrypt a URI in an attribute in a XML document:\n1)\tthe value between \";iv=\" and the next \";\" provides the base64 encoded value of the 96 bit IV and the value between \";=key-id\" and the next \";\" defines the key which has been used for encryption, i.e. \"CSK\" or \"SPK\"; and\n2)\tthe original URI is obtained by decrypting the base64 encoded string between the \"\" URI prefix and the next \";\" using the \"AES-128-GCM algorithm HMAC\" as the decryption algorithm with IV and key as determined in step 1). This value replaces the encrypted URI as the value of the XML attribute.\nThe following procedure is executed when an MCPTT server receives a SIP request containing XML MIME bodies, where the content needs to be copied from the incoming SIP request to the outgoing SIP request.\nThe MCPTT server:\n1)\tshall copy the XML elements from the XML MIME body of the incoming SIP request that do not contain a <EncryptedData> XML element, to the same XML body in the outgoing SIP request;\n2)\tfor each encrypted XML element in the XML MIME body of the incoming SIP request as determined by clause 6.6.2.4.1:\na)\tshall use the keying information described in clause 6.6.2.2 to decrypt the content within the XML element by following the procedures specified in clause 6.6.2.4.2, and shall continue with the steps below if the encrypted XML element was successfully decrypted;\nb)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.2, then for each decrypted XML element:\ni)\tshall re-encrypt the content within the XML element using the keying information described in clause 6.6.2.2 and by following the procedures specified in clause 6.6.2.3.3; and\nii)\tshall include the re-encrypted content into the same XML MIME body of the outgoing SIP request; and\nc)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.2, shall include the decrypted content in the same XML MIME body of the outgoing SIP request.\n3)\tfor each encrypted XML URI attribute in the XML MIME body of the incoming SIP request as determined by clause 6.6.2.4.1:\na)\tshall use the keying information described in clause 6.6.2.2 to decrypt the URI value of the XML attribute by following the procedures specified in clause 6.6.2.4.3, and shall continue with the steps below if the encrypted XML attribute value was successfully decrypted;\nb)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.2, then for each decrypted XML element:\ni)\tshall re-encrypt the URI value of the XML attribute using the keying information described in clause 6.6.2.2 and by following the procedures specified in clause 6.6.2.3.4; and\nii)\tshall include the re-encrypted attribute value into the same XML MIME body of the outgoing SIP request; and\nc)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.2, shall include the decrypted value in the same XML MIME body of the outgoing SIP request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.6.3\tIntegrity Protection of XML documents",
                            "text_content": "Integrity protection can be applied to a whole XML MIME body. When integrity protection is enabled, all XML MIME bodies transported in SIP requests and responses are integrity protected. The following XML MIME bodies used in the present specification in SIP signalling can be integrity protected:\n-\tapplication/vnd.3gpp.mcptt-info+xml;\n-\tapplication/poc-settings+xml;\n-\tapplication/resources-list+xml;\n-\tapplication/vnd.3gpp.mcptt-mbms-usage-info+xml;\n-\tapplication/vnd.3gpp.mcptt-mbs-usage-info+xml;\n-\tapplication/vnd.3gpp.mcptt-location-info+xml;\n-\tapplication/vnd.3gpp.mcptt-affiliation-command+xml;\n-\tapplication/vnd.3gpp.mcptt-floor-request+xml;\n-\tapplication/conference-info+xml;\n-\tapplication/pidf+xml; and\n-\tapplication/xcap-diff+xml.\nIf integrity protection is enabled, and one or more of the XML MIME bodies complying to the types listed above are included in a SIP request or SIP response, then a MIME body of type application/vnd.3gpp.mcptt-signed+xml is included in the SIP request or SIP response containing one or more signatures pointing to those XML MIME bodies as illustrated in Figure 6.6.3.3-1.\nIn order to integrity protect the XML MIME bodies listed above in this clause in SIP requests and SIP responses, the MCPTT client and MCPTT server shall for each MIME body, include the Content-ID header field as specified in IETF RFC 2045 [68] containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62].\nThe figure depicts the integrity protection of XML MIME bodies in SIP requests and SIP responses, highlighting the use of XML-based security protocols to ensure the integrity of the data being transmitted.\nFigure 6.6.3.1-1: Integrity Protection of XML MIME bodies in SIP requests and SIP responses\nEach MIME body that is integrity protected is assigned a unique signature.\nWhen integrity protecting the XML content in SIP REFER request used for pre-established sessions, the application/vnd.3gpp.mcptt-signed+xml MIME type can appear twice in the SIP REFER request as illustrated in Figure 6.6.3.1-2.\nThe figure depicts the integrity protection of XML MIME bodies in SIP REFER requests, highlighting the use of a checksum to ensure the integrity of the data.\nFigure 6.6.3.1-2: Integrity Protection of XML MIME bodies in SIP REFER requests\n-\tan application/vnd.3gpp.mcptt-signed+xml MIME body is included in the SIP REFER request with a signature pointing to the application/resource-lists+xml MIME body; and\nNOTE 1:\tSensitive XML content placed in the application/resource-lists+xml MIME body can be encrypted.\n-\tan application/vnd.3gpp.mcptt-signed+xml MIME is included in the hname \"body\" parameter in the headers portion of the SIP URI in the \"uri\" attribute of the <entry> element of the application/resource-lists+xml MIME body in the SIP REFER request, containing signatures pointing to the XML MIME bodies included in the hname \"body\" parameter in the headers portion of the SIP URI.\nNOTE 2:\tSensitive XML content placed in the hname \"body\" parameter in the headers portion of the SIP URI can be encrypted.\nConfiguration for applying integrity protection is not selective to a specific MIME body. If configuration for integrity protection is turned on, then all XML MIME bodies in SIP requests and responses are integrity protected. If configuration for integrity protection is turned off, then no XML MIME bodies in SIP requests and SIP responses are integrity protected.\nIntegrity protection uses an XPK to sign the data which (depending on who is the sender and who is the receiver of the signed information) can be a CSK or an SPK as specified in clause 4.8. An XPK-ID (CSK-ID/SPK-ID) is used to key the XPK (CSK/SPK). It is assumed that before the procedures in clause 6.6.3.3 and clause 6.6.3.4 are called, the CSK/CSK-ID and/or SPK/SPK-ID are available on the sender and recipient of the integrity protected content, as described in clause 4.8.\nThe procedures in clause 6.6.3.3 and clause 6.6.3.4 shall be used with a XPK equal to the CSK and a XPK-ID equal to the CSK-ID in the following circumstances as described in 3GPP TS 33.180 [78]:\n1)\tMCPTT client sends integrity protected content to an MCPTT server; and\n2)\tMCPTT server sends integrity protected content to an MCPTT client.\nThe procedure in clause 6.6.3.3 and clause 6.6.3.4 shall be used with a XPK equal to the SPK and a XPK-ID equal to the SPK-ID in the following circumstances as described in 3GPP TS 33.180 [78]:\n1)\tMCPTT server sends integrity protected content to an MCPTT server in the same domain; and\n2)\tMCPTT server sends integrity protected content to an MCPTT server in another domain.\nIf the <integrity-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"true\" or no <integrity-protection> element is present in the Service Configuration document, then sending integrity protected content from the MCPTT client to the MCPTT server is enabled, and the MCPTT client shall use the appropriate keying information specified in clause 6.6.3.2 and shall perform the procedures in clause 6.6.3.3.3 to integrity protect XML MIME bodies.\nNOTE:\tEach XML MIME body is integrity protected separately.\nIf the <integrity-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending integrity protected content from the MCPTT client to the MCPTT server is disabled, and all XML MIME bodies are sent without integrity protection.\nIf the <integrity-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"true\", or no <integrity-protection> element is present in the Service Configuration document, then sending integrity protected content from the MCPTT server to the MCPTT client is enabled. If the <allow-signalling-protection> element of the <protection-between-mcptt-servers> element is set to \"true\" in the Service Configuration document as specified in 3GPP TS 24.484 [50] or no <allow-signalling-protection> element is present in the Service Configuration document, then sending integrity protected content between MCPTT servers is enabled.\nWhen sending integrity protected content, the MCPTT server shall use the appropriate keying information specified in clause 6.6.3.2 and shall perform the procedures in clause 6.6.3.3.3 to integrity protect XML MIME bodies.\nNOTE:\tEach XML MIME body is integrity protected separately.\nIf the <integrity-protection> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending integrity protected content from the MCPTT server to the MCPTT client is disabled, and all XML MIME bodies are sent without integrity protection.\nIf the <allow-signalling-protection> element of the <protection-between-mcptt-servers> element in the Service Configuration document as specified in 3GPP TS 24.484 [50] is set to \"false\", then sending integrity protected content between MCPTT servers is disabled, and content is included in XML elements without encryption.\nThe following procedure shall be performed by the MCPTT client and MCPTT server to integrity protect the XML bodies defined by the MIME types listed in clause 6.6.3.1:\n1)\tinclude a Content-Type header field set to \"application/vnd.3gpp.mcptt-signed+xml\";\n2)\tfor each of the MIME types defined in clause 6.6.3.1 where the content defined by these MIME types is to be integrity protected:\na)\tperform reference generation as specified in W3C: \"XML Signature Syntax and Processing (Second Edition)\",  [61] clause 3.1.1 using the SHA256 algorithm to produce a hash of the MIME body and continue with the procedures below if reference generation is successful;\nb)\tperform signature generation as specified in W3C: \"XML Signature Syntax and Processing (Second Edition)\",  [61] clause 3.1.2 using the HMAC-SHA256 signature method and the XPK as the key and continue with the procedures below if signature generation is successful; and\n3)\tfollow the schema defined in Annex F.6.2 and the semantic described in Annex F.6.3 to create the application/vnd.3gpp.mcptt-signed+xml MIME body containing signatures referring to the XML MIME bodies included in the SIP request or SIP response.\nThe following procedure is used by the MCPTT client or MCPTT server to determine if an XML MIME body is integrity protected.\n1)\tif the <Signature> XML element is not present in the XML MIME body, then the content is not integrity protected; and\n2)\tif the <Signature> XML element is present in the XML MIME body, then the content is integrity protected.\nThe following procedure is used by the MCPTT client or MCPTT server to verify the integrity of an XML MIME body:\n1)\tif the required sub-elements of the <Signature> as described in 3GPP TS 33.180 [78] are not present in the MIME body and if not present, are not known to the sender and recipient by other means, then the integrity protection procedure fails and exit this procedure. Otherwise continue with the rest of the steps;\n2)\tperform reference validation on the <Reference> element as specified in W3C: \"XML Signature Syntax and Processing (Second Edition)\",  [61] clause 3.2.1;\n3)\tif reference validation fails, then send a SIP 403 (Forbidden) response towards the functional entity with the warning text set to: \"139 integrity protection check failed\" in a Warning header field as specified in clause 4.4, and do not continue with the rest of the steps in this clause;\n4)\tobtain the XPK using the XPK-ID in the received XML body and use it to perform signature validation of the value of the <SignatureValue> element as specified in W3C: \"XML Signature Syntax and Processing (Second Edition)\", http://www.w3.org/TR/xmldsig-core [61] clause 3.2.2;\n5)\tif signature validation fails, then send a SIP 403 (Forbidden) response towards the functional entity with the warning text set to: \"139 integrity protection check failed\" in a Warning header field as specified in clause 4.4, and do not continue with the rest of the steps in this clause; and\n6)\treturn success of the integrity protection of the XML document passes the integrity protection procedure.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "6.7\tPriority sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "The participating MCPTT function shall enable or disable priority sharing as specified in 3GPP TS 24.229 [4].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "6.8\tProcedures at the MCPTT gateway",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "6.8.1\tGeneral",
                            "text_content": "As described in clause 5.5, the MCPTT gateway servers are inserted in the path between MCPTT functions that reside in MCPTT systems from different trust domains.\nThis clause specifies the behavior of an MCPTT gateway server that acts as an exit point from an MCPTT system or as an entry point in an MCPTT system.\nLocal policies enforcement covers a wide variety of actions that are left to implementation. An example of local policies enforcement is given in clause 6.8.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.2\tMCPTT gateway server acting as an exit point from an MCPTT system",
                            "text_content": "When acting as an exit point from a local MCPTT system to an interconnected MCPTT system, the MCPTT gateway server receives SIP requests and SIP responses intended for the controlling, non-controlling or participating function in the interconnected MCPTT system.\nWhen receiving an outgoing SIP message, the MCPTT gateway server acting as an exit point:\n1)\tshall identify the MCPTT system identity of the interconnected MCPTT system from the Request-URI of the outgoing SIP messages or other information elements from the outgoing SIP message;\n2)\tmay enforce local policy, and if local policy enforcement results in rejecting a SIP request (e.g. not having a mutual aid relationship), the MCPTT gateway shall reject the request by sending back a SIP 403 (Forbidden) response including a warning text \"179 service not authorized with the interconnected system\", and the MCPTT gateway server shall not continue with the rest of the steps;\n3)\tmay replace in the outgoing SIP message any addressing information linked to the local MCPTT system topology with its own addressing information. This includes:\na)\tthe P-Asserted-Identity header field may be set to the MCPTT gateway server's own URI; and\nb)\tthe Request-URI may be set to the public service identity of the targeted function in the interconnected MCPTT system, or to the URI of the MCPTT gateway server that acts as an entry point in the interconnected MCPTT system; and\nNOTE:\tHow the MCPTT gateway server determines the public service identity of the targeted MCPTT function in the interconnected MCPTT system or the URI of the MCPTT gateway server in the interconnected MCPTT system is out of the scope of the present document.\n4)\tshall forward the outgoing SIP message according to 3GPP TS 24.229 [4]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.3\tMCPTT gateway server acting as an entry point in an MCPTT system",
                            "text_content": "When acting as an entry point in an MCPTT system from an interconnected MCPTT system, the MCPTT gateway receives SIP requests and SIP responses intended for the controlling, non-controlling or participating function in the local MCPTT system.\nWhen receiving an incoming SIP message, the MCPTT gateway server acting as an entry point:\n1)\tshall identify the MCPTT system identity of the interconnected MCPTT system from the P-Asserted-Identity header field of the incoming SIP messages;\n2)\tmay enforce local policy, and if local policy enforcement results in rejecting a SIP request (e.g. not having a mutual aid relationship), the MCPTT gateway shall reject the request by sending back a SIP 403 (Forbidden) response including a warning text \"180 service not authorized by the interconnected system\", and the MCPTT gateway server shall not continue with the rest of the steps;\n3)\tshould replace in the incoming SIP message its own addressing information with the addressing information of the targeted MCPTT function in the local MCPTT system:\na)\tthe Request-URI should be set to the public service identity of the targeted MCPTT function in the local MCPTT system; and\nNOTE:\tHow the MCPTT gateway server determines the public service identity of the targeted MCPTT function in the local MCPTT system is out of the scope of the present document.\n4)\tshall forward the incoming SIP message according to 3GPP TS 24.229 [4]\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "6.8.4\tLocal policies enforcement",
                            "text_content": "Below is one example of local policy enforcement that can be handled by an MCPTT gateway server.\nIf an MCPTT gateway server acting as an exit point receives a SIP request or a SIP response that contains sensitive information that cannot be exposed to the targeted partner system based on local policies but does not prevent the service from being delivered (e.g. a functional alias), the MCPTT gateway server can remove that information from the outgoing SIP message before forwarding it.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "7\tRegistration and service authorisation",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the procedures for SIP registration and MCPTT service authorization for the MCPTT client and the MCPTT service. The MCPTT UE can use SIP REGISTER or SIP PUBLISH for MCPTT service settings to perform service authorization for MCPTT. The decision which method to use is based on implementation and on availability of an access-token received as outcome of the user authentication procedure as described in 3GPP TS 24.482 [49].\nIf another MC service client (e.g. MCVideo, MCData) is operating at the same time on the same MC UE as the MCPTT client, then the MCPTT client shares the same SIP registration as the other MC service clients. The SIP REGISTER procedures in this clause are combined with the SIP REGISTER procedures for the other operating MC service clients to create a single SIP REGISTER request. If other MC service clients are already operating when the MCPTT client registers, then a re-registration is performed containing the parameters for the other operating MC services.\nAlthough the access-token can be the same for the MCPTT service as for other MC services when performing service authorization for MCPTT along with other MC services using SIP REGISTER multipart MIME bodies for each MC service are included in the SIP REGISTER request. The MCPTT server can therefore receive multipart MIME bodies in the SIP REGISTER request. Multiple contact addresses (one per MC service client) can be included in a SIP REGISTER request provided they all contain the same IP address and port number (see 3GPP TS 24.229 [4] for further details of including multiple contact addresses in a single SIP REGISTER request).\nIf the MCPTT client logs off from the MCPTT service but other MC service clients are to remain registered the MC UE performs a re-registration as specified in 3GPP TS 24.229 [4] without the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP REGISTER request but with the parameters for the remaining operating MC service clients.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7.2\tMCPTT client procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.2.1\tSIP REGISTER request for service authorisation",
                            "text_content": "When the MCPTT client performs SIP registration for service authorisation the MCPTT client shall perform the registration procedures as specified in 3GPP TS 24.229 [4].\nThe MCPTT client shall include the following media feature tags in the Contact header field of the SIP REGISTER request:\n1)\tthe g.3gpp.mcptt media feature tag; and\n2)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\".\nNOTE 1:\tIf the MCPTT client logs off from the MCPTT service but the MCPTT UE remains registered the MCPTT UE performs a re-registration as specified in 3GPP TS 24.229 [4] without both the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP REGISTER request.\nIf the MCPTT client supports MCPTT service continuity, then the MCPTT client shall follow the IMS registration procedures for PS to PS service continuity as specified in clause 6.2.2 of 3GPP TS 24.237 [58].\nIf the MCPTT client, upon performing SIP registration:\n1)\thas successfully finished the user authentication procedure as described in 3GPP TS 24.482 [49];\n2)\thas available an access-token;\n3)\tbased on implementation decides to use SIP REGISTER for service authorization;\n4)\tconfidentiality protection is disabled as specified in clause 6.6.2.3.1; and\n5)\tintegrity protection is disabled as specified in clause 6.6.3.3.1;\nthen the MCPTT client shall include in the SIP REGISTER request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in Annex F.1 with:\n1)\tthe <mcptt-access-token> element set to the value of the access token received during the user authentication procedures; and\n2)\tthe <mcptt-client-id> element set to the value of the MCPTT client ID of the originating MCPTT client.\nNOTE 2:\tThe access-token contains the MCPTT ID of the user.\nIf the MCPTT client, upon performing SIP registration:\n1)\thas successfully finished the user authentication procedure as described in 3GPP TS 24.482 [49];\n2)\thas an available access-token;\n3)\tbased on implementation decides to use SIP REGISTER for service authorization; and\n4)\teither confidentiality protection is enabled as specified in clause 6.6.2.3.1 or integrity protection is enabled as specified in clause 6.6.3.3.1;\nthen the MCPTT client:\n1)\tshall include an application/mikey MIME body with the CSK as MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78] in the body of the SIP REGISTER request;\n2)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.1, shall include in the body of the SIP REGISTER request, an application/vnd.3gpp.mcptt-info+xml MIME body with the following clarifications:\na)\tshall encrypt the received access-token using the client server key (CSK) and include the <mcptt-access-token> element set to the encrypted access-token, as specified in clause 6.6.2.3.3; and\nb)\tshall encrypt the MCPTT client ID of the originating MCPTT client and include the <mcptt-client-id> element set to the encrypted MCPTT client ID;\n3)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.1, shall include an application/vnd.3gpp.mcptt-info+xml MIME body as defined in Annex F.1 with:\na)\tthe <mcptt-access-token> element set to the value of the access token received during the user authentication procedures; and\nb)\tthe <mcptt-client-id> element set to the value of the MCPTT client ID of the originating MCPTT client; and\n4)\tif integrity protection is enabled as specified in clause 6.6.3.3.1, shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.6.3.3.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.1AA\tSIP REGISTER request without service authorisation",
                            "text_content": "When the MCPTT client performs SIP registration without service authorisation the MCPTT client shall perform the registration procedures as specified in 3GPP TS 24.229 [4].\nThe MCPTT client shall include the following media feature tags in the Contact header field of the SIP REGISTER request:\n1)\tthe g.3gpp.mcptt media feature tag; and\n2)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\".\nNOTE:\tIf the MCPTT client logs off from the MCPTT service but the MCPTT UE remains registered the MCPTT UE performs a re-registration as specified in 3GPP TS 24.229 [4] without both the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP REGISTER request.\nIf the MCPTT client supports MCPTT service continuity, then the MCPTT client shall follow the IMS registration procedures for PS to PS service continuity as specified in clause 6.2.2 of 3GPP TS 24.237 [58].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.1A\tCommon SIP PUBLISH procedure",
                            "text_content": "This procedure is only referenced from other procedures.\nWhen populating the SIP PUBLISH request, the MCPTT client shall:\n1)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n3)\tshall set the Event header field to the \"poc-settings\" value; and\n4)\tshall set the Expires header field according to IETF RFC 3903 [37], to 4294967295, if the MCPTT user is not removing the MCPTT service settings, otherwise to remove the MCPTT service settings the MCPTT client shall set the Expires header field to zero.\nNOTE 1:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\nNOTE 2:\tThe expiration timer of the MCPTT client service settings is only applicable for the MCPTT client service settings from the MCPTT client that matches the Instance Identifier URN. The expiration timer of MCPTT user service settings is also updated in the MCPTT server if expiration timer of MCPTT client service settings is updated in the MCPTT server.\nNOTE 3:\tRemoving the MCPTT service settings by setting the Expires header field to zero, logs off the MCPTT client from the MCPTT service.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.2\tSIP PUBLISH request for service authorisation and MCPTT service settings",
                            "text_content": "If based on implementation the MCPTT client decides to use SIP PUBLISH for MCPTT server settings to also perform service authorization and\n1)\thas successfully finished the user authentication procedure as described in 3GPP TS 24.482 [49]; and\n2)\thas available an access-token;\nthen the MCPTT client:\n1)\tshall perform the procedures in clause 7.2.1A;\n2)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.1 and integrity protection is disabled, shall include in the body of the SIP PUBLISH request, an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with the <mcptt-access-token> element set to the value of the access token received during the user authentication procedures;\n3)\tif either confidentiality protection is enabled as specified in clause 6.6.2.3.1 or integrity protection is enabled as specified in clause 6.6.3.3.1 shall include an application/mikey MIME body with the CSK as MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78] in the body of the SIP PUBLISH request;\n4)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.1, shall include in the body of the SIP PUBLISH request an application/vnd.3gpp.mcptt-info+xml MIME body with:\na)\tthe <mcptt-access-token> element set to the received access-token encrypted using the CSK, as specified in clause 6.6.2.3.3; and\nb)\tthe <mcptt-client-id> element set to the encrypted MCPTT client ID of the originating MCPTT client, as specified in clause 6.6.2.3.3;\n5)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.1, shall include in the body of the SIP PUBLISH request, an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with:\na)\tthe <mcptt-access-token> element set to the value of the access token received during the user authentication procedures in the body of the SIP PUBLISH request; and\nb)\tthe <mcptt-client-id> element set to the value of the MCPTT client ID of the originating MCPTT client;\n6)\tshall include an application/poc-settings+xml MIME body containing:\na)\tthe Answer-Mode Indication setting in the <am-settings> element of the poc-settings event package set to the current answer mode setting (\"auto-answer\" or \"manual-answer\") of the MCPTT client according to IETF RFC 4354 [55];\nb)\tthe <selected-user-profile-index> element as defined in clause 7.4.1.2.2 set to the value contained in the \"user-profile-index\" attribute of the selected MCPTT user profile as defined in 3GPP TS 24.484 [50]; and\nc)\tthe <multiplex-support> element as defined in clause 7.4.1.2.2; and\n7)\tif integrity protection is enabled as specified in clause 6.6.3.3.1, shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-info+xml MIME body and application/poc-settings+xml MIME body by following the procedures in clause 6.6.3.3.3.\nThe MCPTT client shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP PUBLISH request, the MCPTT client:\n1)\tmay notify the MCPTT user of the successful MCPTT service authorisation and service settings.\nUpon receiving a SIP 3xx, SIP 4xx, or SIP 5xx response to the above SIP PUBLISH request, the MCPTT client:\n1)\tshould notify the MCPTT user of the unsuccessful MCPTT service authorisation and service setting, possibly taking into account Warning header information for the failure reason; and\n2)\tshall consider that the MCPTT client is not authorised.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.3\tSending SIP PUBLISH for MCPTT service settings only",
                            "text_content": "To set, update, remove or refresh the MCPTT service settings, the MCPTT client shall generate a SIP PUBLISH request according 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 4354 [55]. In the SIP PUBLISH request, the MCPTT client:\n1)\tshall perform the procedures in clause 7.2.1A;\n2)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.1, shall include in the body of the SIP PUBLISH request, an application/vnd.3gpp.mcptt-info+xml MIME body with:\na)\tthe <mcptt-request-uri> element set to the targeted MCPTT ID encrypted using the CSK, as specified in clause 6.6.2.3.3; and\nb)\tthe <mcptt-client-id> element set to the encrypted MCPTT client ID of the originating MCPTT client, as specified in clause 6.6.2.3.3;\n3)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.1, shall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with:\na)\tthe <mcptt-request-uri> set to the cleartext targeted MCPTT ID; and\nb)\tthe <mcptt-client-id> element set to the value of the MCPTT client ID of the originating MCPTT client;\n4)\tshall include an application/poc-settings+xml MIME body containing:\na)\tthe Answer-Mode Indication setting in the <am-settings> element of the poc-settings event package set to the current answer mode setting (\"auto-answer\" or \"manual-answer\") of the MCPTT client according to IETF RFC 4354 [55];\nb)\tthe <selected-user-profile-index> element as defined in clause 7.4.1.2.2 set to the value contained in the \"user-profile-index\" attribute of the selected MCPTT user profile as defined in 3GPP TS 24.484 [50]; and\nc)\tthe <multiplex-support> element as defined in clause 7.4.1.2.2; and\n5)\tif integrity protection is enabled as specified in clause 6.6.3.3.1, shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-info+xml MIME body and application/poc-settings+xml MIME body by following the procedures in clause 6.6.3.3.3.\nThe MCPTT client shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nUpon receiving the SIP 200 (OK) response to the SIP PUBLISH request the MCPTT client may indicate to the MCPTT User the successful communication of the MCPTT service settings to the MCPTT server.\nUpon receiving a SIP 3xx, SIP 4xx, or SIP 5xx response to the above SIP PUBLISH request, the MCPTT client:\n1)\tshould notify the MCPTT user of the unsuccessful communication of the MCPTT service settings to the MCPTT server, possibly taking into account Warning header information for the failure reason; and\n2)\tshall consider that the MCPTT service settings attempted in the SIP PUBLISH request has not been successful.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.4\tDetermination of MCPTT service settings",
                            "text_content": "In order to discover MCPTT service settings of another MCPTT client of the same MCPTT user or to verify the currently active MCPTT service settings of this MCPTT client, the MCPTT client shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26], and IETF RFC 4354 [55].\nIn the SIP SUBSCRIBE request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT ID of the MCPTT user;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tshall set the Event header field to the 'poc-settings' value;\n5)\tshall include an Accept header field containing the \"application/poc-settings+xml\" MIME type;\n6)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295; and\nNOTE 1:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n7)\tif the MCPTT client wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero.\nIn order to re-subscribe or de-subscribe, the MCPTT client shall generate and send an in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26], IETF RFC 4354 [55]. In the SIP SUBSCRIBE request, the MCPTT client with the following clarifications:\n1)\tshall set the Event header field to the 'poc-settings' value;\n2)\tshall include an Accept header field containing the \"application/poc-settings+xml\" MIME type;\n3)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295; and\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n4)\tif the MCPTT client wants to de-subscribe, shall set the Expires header field according to IETF RFC 6665 [26], to zero.\nUpon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26] and IETF RFC 4354 [55], that contains an application/poc-settings+xml MIME body the MCPTT client shall cache:\n1)\tthe <am-settings> element of the poc-settings+xml MIME body for each MCPTT client identified by the \"id\" attribute according to IETF RFC 4354 [55] as the current Answer-mode indication of that MPCTT client; and\n2)\tthe <selected-user-profile-index> element of the poc-settings+xml MIME body for each MCPTT client identified by the \"id\" attribute according to IETF RFC 4354 [55] as the active MCPTT service user profile of that MCPTT client.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.2.5\tReceiving a CSK key download message",
                            "text_content": "When the MCPTT client receives a SIP MESSAGE request containing:\n1)\ta P-Asserted-Service header field containing the \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n2)\tan application/mikey MIME body;\nThen, if the key identifier within the CSB-ID of the MIKEY payload is a CSK-ID (4 most-significant bits have the value '2'), the MCPTT client:\n1)\tshall follow the security procedures in clause 9.2.1 of 3GPP TS 33.180 [78] to extract the CSK. The client:\na)\tif the initiator field (IDRi) has type 'URI' (identity hiding is not used), the client:\ni)\tshall extract the initiator URI from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the initiator URI deviates from the public service identity of the participating MCPTT function serving the MCPTT user, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nii)\tshall convert the initiator URI to a UID as described in 3GPP TS 33.180 [78];\nb)\tif the initiator field (IDRi) has type 'UID' (identity hiding in use), the client:\nii)\tshall convert the public service identity of participating MCPTT function serving the MCPTT user to a UID as described in 3GPP TS 33.180 [78];\ni)\tshall compare the generated UID with the UID in the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the two initiator UIDs deviate from each other, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nc)\tshall use the UID to validate the signature of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif authentication verification of the I_MESSAGE fails, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\ne)\tshall extract and decrypt the encapsulated CSK using the participating MCPTT function's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nf)\tshall extract the CSK-ID, from the payload as specified in 3GPP TS 33.180 [78];\n2)\tUpon successful extraction, the client shall replace the existing CSK and CSK-ID associated with the participating MCPTT function, with the extracted CSK and CSK-ID in the 'key download' message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.3\tMCPTT server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.3.1\tGeneral",
                            "text_content": "The MCPTT server obtains information that it needs to implement service authorization specific requirements from:\na)\tany received third-party SIP REGISTER request (e.g. including information contained in the body of the third-party SIP REGISTER request) as specified in 3GPP TS 24.229 [4]. The body will carry the SIP REGISTER request as sent by the MCPTT client and may contain information needed for service authorization; or\nb)\tany received SIP PUBLISH request for MCPTT server settings containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters. The body of the SIP PUBLISH request will contain information needed for service authorization.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.1A\tConfidentiality and Integrity Protection",
                            "text_content": "When the MCPTT server receives a SIP REGISTER request sent from the MCPTT client contained within a message/sip MIME body of a received third-party SIP REGISTER request or a SIP PUBLISH request, it first determines whether XML MIME bodies included in the request are integrity protected. If XML MIME bodies are integrity protected the MCPTT server validates the signature of each of the XML MIME bodies. If the integrity protection check(s) pass or the XML MIME bodies are not integrity protected, the MCPTT server then determines whether the content in specific XML elements is confidentiality protected. If XML content is confidentiality protected, the MCPTT server decrypts the protected content.\nUpon receiving:\n-\ta SIP REGISTER request containing an application/vnd.3gpp.mcptt-info+xml MIME body within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client; or\n-\ta SIP PUBLISH request containing an application/vnd.3gpp.mcptt-info+xml MIME body and an application/poc-settings+xml MIME body;\nthe MCPTT server:\n1)\tshall determine if integrity protection has been applied to XML MIME bodies in the SIP request by following the procedures in clause 6.6.3.4.1 for each XML MIME body;\n2)\tif integrity protection has been applied, shall use the keying data described in clause 6.6.3.2 and the procedures described in clause 6.6.3.4.2 to verify the integrity of each of the XML MIME bodies; and\n3)\tif all integrity protection checks succeed, shall continue with the remaining steps of this clause.\nUpon receiving:\n-\ta SIP REGISTER request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-access-token> element and an <mcptt-client-id> element within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client; or\n-\ta SIP PUBLISH request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-access-token> element and an <mcptt-client-id> element, and an application/poc-settings+xml MIME body;\nthe MCPTT server:\n1)\tshall determine if confidentiality protection has been applied to the <mcptt-access-token> element and the <mcptt-client-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body, by following the procedures in clause 6.6.2.4.1;\n2)\tif confidentiality protection has been applied to the <mcptt-access-token> element and <mcptt-client-id> element:\na)\tshall use the keying information received in the MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78], along with the procedures described in clause 6.6.2.4.2 to:\ni)\tdecrypt the received access token in the <mcptt-access-token> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tdecrypt the received MCPTT client ID in the <mcptt-client-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tif the decryption procedure succeeds, shall identify the MCPTT ID and the MCPTT client ID from the decrypted values; and\nc)\tif the decryption procedure fails, shall determine that confidentiality protection has not been successful;\n3)\tif confidentiality protection has been applied to only one of the <mcptt-access-token> element or the <mcptt-client-id> element:\na)\tshall determine that confidentiality protection has not been successful;\n4)\tif confidentiality protection has not been applied:\na)\tshall identify the MCPTT ID from <mcptt-access-token> element received in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nb)\tshall identify the MCPTT client ID from the <mcptt-client-id> element received in the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receiving a SIP PUBLISH request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-request-uri> element, an <mcptt-client-id> element, and an application/poc-settings+xml MIME body, the MCPTT server:\n1)\tshall determine if confidentiality protection has been applied to the <mcptt-request-uri> element and the <mcptt-client-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.6.2.4.1;\n2)\tif confidentiality protection has been applied to the <mcptt-request-uri> element and the <mcptt-client-id> element:\na)\tshall use the keying information described in clause 6.6.2.2 along with the procedures described in clause 6.6.2.4.2 to:\ni)\tdecrypt the received encrypted MCPTT ID in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tdecrypt the received encrypted MCPTT client ID in the <mcptt-client-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tif all decryption procedures succeed, shall identify the MCPTT ID and MCPTT client ID from the decrypted values; and\nc)\tif the decryption procedure fails, shall determine that confidentiality protection has not been successful;\n3)\tif confidentiality protection has been applied to only one of the <mcptt-request-uri> element or <mcptt-client-id> element:\na)\tshall determine that confidentiality protection has not been successful;\n4)\tif confidentiality protection has not been applied:\na)\tshall identify the MCPTT ID from the contents of the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nb)\tshall identify the MCPTT client ID from the <mcptt-client-id> element received in the application/vnd.3gpp.mcptt-info+xml MIME body.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.2\tSIP REGISTER request for service authorisation",
                            "text_content": "The MCPTT server shall support obtaining service authorization specific information from the SIP REGISTER request sent from the MCPTT client and included in the body of a third-party SIP REGISTER request.\nNOTE 1:\t3GPP TS 24.229 [4] defines how based on initial filter criteria the SIP REGISTER request sent from the UE is included in the body of the third-party SIP REGISTER request.\nUpon receiving a third party SIP REGISTER request with a message/sip MIME body containing the SIP REGISTER request sent from the MCPTT client containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-access-token> element and an <mcptt-client-id> element within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client, the MCPTT server:\n1)\tshall identify the IMS public user identity from the third-party SIP REGISTER request;\n2)\tshall identify the MCPTT ID from the SIP REGISTER request sent from the MCPTT client and included in the message/sip MIME body of the third-party SIP REGISTER request by following the procedures in clause 7.3.1A;\n2a)\tshall check if the number of maximum simultaneous authorizations supported for the MCPTT user is specified in the <user-max-simultaneous-authorizations> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT user profile (see the MCPTT user profile configuration document in 3GPP TS 24.484 [50]), and if present, shall check whether it has been reached. If reached, the MCPTT server shall not continue with the rest of the steps in this clause;\n2b)\tif the <user-max-simultaneous-authorizations> element of the <anyExt> element is not present in the <OnNetwork> element of the MCPTT user profile (see the MCPTT user profile configuration document in 3GPP TS 24.484 [50]), shall check if the number of maximum simultaneous authorizations supported for any MCPTT user as specified in the <max-simultaneous-authorizations> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) has been reached. If reached, the MCPTT server shall not continue with the rest of the steps in this clause;\n3)\tshall perform service authorization for the identified MCPTT ID as described in 3GPP TS 33.180 [78];\n4)\tif service authorization was successful, shall bind the MCPTT ID and the MCPTT client ID to the IMS public user identity;\n4a)\tif service authorization was successful and if the service authorization request was from an MCPTT user who is previously MCPTT service authorized on another MCPTT client (as determined by a comparison of the received MCPTT client ID with the MCPTT client ID of existing bindings), keep the current bindings and create a new binding between the MCPTT ID and the IMS public user identity;\nNOTE 2:\tThe MCPTT server will store the binding of the MCPTT ID, MCPTT client ID, IMS public user identity and an identifier addressing the MCPTT server in an external database.\n5)\tif a Resource-Share header field with the value \"supported\" is contained in the \"message/sip\" MIME body of the third-party REGISTER request, shall bind the MCPTT ID and the MCPTT client ID to the identity of the MCPTT UE contained in the \"+g.3gpp.registration-token\" header field parameter in the Contact header field of the incoming third-party REGISTER request; and\n6)\tif more than one binding exists for the MCPTT ID, shall include in the SIP 200 (OK) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with an <multiple-devices-ind> element set to the value \"true\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.3\tSIP PUBLISH request for service authorisation and service settings",
                            "text_content": "The MCPTT server shall support obtaining service authorization specific information from a SIP PUBLISH request for MCPTT server settings.\nUpon receiving a SIP PUBLISH request containing:\n1)\tan Event header field set to the \"poc-settings\" value;\n2)\tan application/poc-settings+xml MIME body; and\n3)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an <mcptt-access-token> element and an <mcptt-client-id> element;\nthe MCPTT server:\n1)\tshall identify the IMS public user identity from the P-Asserted-Identity header field;\n2)\tshall perform the procedures in clause 7.3.1A;\n3)\tif the procedures in clause 7.3.1A were not successful shall send a SIP 403 (Forbidden) response towards the MCPTT client with the warning text set to: \"140 unable to decrypt XML content\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n3a)\tshall check if the number of maximum simultaneous authorizations supported for the MCPTT user is specified in the <user-max-simultaneous-authorizations> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT user profile (see the MCPTT user profile configuration document in 3GPP TS 24.484 [50]) and, if present, shall check whether it has been reached. If reached, the MCPTT server shall send a SIP 486 (Busy Here) response towards the MCPTT client with the warning text set to: \"164 maximum number of service authorizations reached\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps in this clause;\n3b)\tif the <user-max-simultaneous-authorizations> element of the <anyExt> element is not present in the <OnNetwork> element of the MCPTT user profile (see the MCPTT user profile configuration document in 3GPP TS 24.484 [50]), shall check if the number of maximum simultaneous authorizations supported for any MCPTT user as specified in the <max-simultaneous-authorizations> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) has been reached. If reached, the MCPTT server shall send a SIP 486 (Busy Here) response towards the MCPTT client with the warning text set to: \"164 maximum number of service authorizations reached\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps in this clause;\n4)\tshall perform service authorization for the identified MCPTT ID as described in 3GPP TS 33.180 [78];\n5)\tif service authorization was successful:\na)\tshall bind the MCPTT ID and MCPTT client ID to the IMS public user identity;\nb)\tif the service authorization request was from an MCPTT user who is previously MCPTT service authorized on another MCPTT client (as determined by a comparison of the received MCPTT client ID with the MCPTT client ID of existing bindings), keep the current bindings and create a new binding between the MCPTT ID, MCPTT client ID and the IMS public user identity; and\nc)\tif a Resource-Share header field with the value \"supported\" was included in the \"message/sip\" MIME body of the third-party REGISTER request, shall bind the MCPTT ID to the identity of the MCPTT UE contained in the \"+g.3gpp.registration-token\" header field parameter in the Contact header field of the third-party REGISTER request that contained this IMS public user identity;\nNOTE 1:\tThe MCPTT server will store the binding MCPTT ID, MCPTT client ID, IMS public user identity and an identifier addressing the MCPTT server in an external database.\n6)\tif service authorization was not successful, shall send a SIP 403 (Forbidden) response towards the MCPTT client with the warning text set to: \"101 service authorisation failed\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n7)\tshall process the SIP PUBLISH request according to rules and procedures of IETF RFC 3903 [37] and if processing of the SIP request was not successful, do not continue with the rest of the steps;\n8)\tshall cache the received MCPTT service settings until the MCPTT service settings expiration timer expires;\n9)\tshall send a SIP 200 (OK) response according 3GPP TS 24.229 [4] with:\na)\tif more than one binding exists for the MCPTT ID, an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with a <multiple-devices-ind> element set to the value \"true\";\n10)\tshall use the Answer-Mode Indication setting in the <am-settings> element of the poc-settings event package as the current Answer-Mode Indication of the MCPTT client.\n10a)\tIf the <multiplex-support> element is present and set to true the MCPTT server shall use this as an indication that the MCPTT client supports multiplexing of media plane control channels and media streams. Absence of the <multiplex-support> element or if the <multiplex-support element is set to false shall be used as an indication that the MCPTT client does not support multiplexing of media plane control channels and media streams.\nNOTE 2:\tThe MCPTT server uses the information about support of multiplexing received from the served MCPTT clients to determine when and where to use multiplexing of media plane control channels and/or media streams.\n11)\tshall download the MCPTT user profile from the MCPTT  user database as defined in 3GPP TS 29.283 [73], if not already stored at the MCPTT server, and use the <selected-user-profile-index> element of the poc-settings event package, if included, to identify the active MCPTT user profile for the MCPTT client;\nNOTE 3:\tIf the <selected-user-profile-index> element of the poc-settings event package is included, then only that MCPTT user profile is needed to be downloaded from the MCPTT user database.\n12)\tif there is no <selected-user-profile-index> element included in the poc-settings event package, then, if multiple MCPTT user profiles are stored at the MCPTT server or downloaded for the MCPTT user from the MCPTT user database, shall determine the pre-selected MCPTT user profile to be used as the active MCPTT user profile by identifying the MCPTT user profile (see the MCPTT user profile document in 3GPP TS 24.484 [50]) in the collection of MCPTT user profiles that contains a <Pre-selected-indication> element; and\nNOTE 4:\tIf only one MCPTT user profile is stored at the MCPTT server or only one MCPTT user profile is downloaded from the MCPTT user database, then, by default, this MCPTT user profile is the pre-selected MCPTT user profile.\n13)\tif an <ImplicitAffiliations> element is contained in the <OnNetwork> element of the MCPTT user profile document with one or more <entry> elements containing an MCPTT group ID (see the MCPTT user profile document in 3GPP TS 24.484 [50]) for the served MCPTT ID, shall perform implicit affiliation as specified in clause 9.2.2.2.15.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.4\tReceiving SIP PUBLISH request for MCPTT service settings only",
                            "text_content": "Upon receiving a SIP PUBLISH request containing:\n1)\tan Event header field set to the \"poc-settings\" value;\n2)\tan application/poc-settings+xml MIME body; and\n3)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an <mcptt-request-uri> element and an <mcptt-client-id> element;\nThe MCPTT server:\n1)\tshall identify the IMS public user identity from the P-Asserted-Identity header field;\n2)\tshall perform the procedures in clause 7.3.1A;\n3)\tif the procedures in clause 7.3.1A were not successful, shall send a SIP 403 (Forbidden) response towards the MCPTT client with the warning text set to: \"140 unable to decrypt XML content\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n4)\tshall verify that a binding between the IMS public user identity in the Request-URI and the MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml exists at the MCPTT server;\n5)\tif a binding exists between the IMS public user identity and the MCPTT ID in the request and the validity period of the binding has not expired shall download the MCPTT user profile from the MCPTT user database as defined in 3GPP TS 29.283 [73] if not already stored at the MCPTT server;\n6)\tif a binding does not exist between the IMS public user identity and the MCPTT ID in the request or the binding exists, but the validity period of the binding has expired, shall reject the SIP PUBLISH request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n7)\tshall process the SIP PUBLISH request according to rules and procedures of IETF RFC 3903 [37] and if processing of the SIP request was not successful, do not continue with the rest of the steps;\n8)\tshall cache the received MCPTT service settings until the MCPTT service settings expiration timer expires;\n9)\tshall send a SIP 200 (OK) response according 3GPP TS 24.229 [4];\n10)\tshall use the Answer-Mode Indication setting in the <am-settings> element of the poc-settings event package as the current Answer-Mode Indication of the MCPTT client.\n10a)\tIf the <multiplex-support> element is present and set to true the MCPTT server shall use this as an indication that the MCPTT client supports multiplexing of media plane control channels and media streams. Absence of the <multiplex-support> element or if the <multiplex-support element is set to false shall be used as an indication that the MCPTT client does not support multiplexing of media plane control channels and media streams.\nNOTE 1:\tThe MCPTT server uses the information about support of multiplexing received from the served MCPTT clients to determine when and where to use multiplexing of media plane control channels and/or media streams.\n11)\tshall download the MCPTT user profile from the MCPTT user database as defined in 3GPP TS 29.283 [73] if not already stored at the MCPTT server and use the <selected-user-profile-index> element of the poc-settings event package if included to identify the active MCPTT user profile for the MCPTT client;\nNOTE 2:\tIf the <selected-user-profile-index> element of the poc-settings event package is included then only that MCPTT user profile is needed to be downloaded from the MCPTT user database.\n12)\tif there is no <selected-user-profile-index> element included in the poc-settings event package then if multiple MCPTT user profiles are stored at the MCPTT server or downloaded for the MCPTT user from the MCPTT user database, shall determine the pre-selected MCPTT user profile to be used as the active MCPTT user profile by identifying the MCPTT user profile (see the MCPTT user profile document in 3GPP TS 24.484 [50]) in the collection of MCPTT user profiles that contains a <Pre-selected-indication> element; and\nNOTE 3:\tIf only one MCPTT user profile is stored at the MCPTT server or only one MCPTT user profile is downloaded from the MCPTT user database, then by default this MCPTT user profile is the pre-selected MCPTT user profile.\n13)\tif an <ImplicitAffiliations> element is contained in the <OnNetwork> element of the MCPTT user profile document with one or more <entry> elements containing an MCPTT group ID (see the MCPTT user profile document in 3GPP TS 24.484 [50]) for the served MCPTT ID, shall perform implicit affiliation as specified in clause 9.2.2.2.15.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.5\tReceiving SIP PUBLISH request with \"Expires=0\"",
                            "text_content": "Upon receiving a SIP PUBLISH request containing:\n1)\tan Event header field set to the \"poc-settings\" value; and\n2)\tan Expires header field set to 0;\nthe MCPTT server:\n1)\tshall identify the IMS public user identity from the P-Asserted-Identity header field;\n2)\tshall process the SIP PUBLISH request according to rules and procedures of IETF RFC 3903 [37] and if processing of the SIP request was successful, continue with the rest of the steps;\n3)\tshall remove the MCPTT service settings;\nNOTE:\tRemoval of MCPTT service settings includes removal of all group affiliations.\n4)\tshall remove the binding between the MCPTT ID and public user identity; and\n5)\tshall send a SIP 200 (OK) response according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.6\tSubscription to and notification of MCPTT service settings",
                            "text_content": "Upon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity identifying the participating MCPTT function of the served MCPTT user;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n3)\tthe Event header field of the SIP SUBSCRIBE request contains the 'poc-settings' event type.\nthe MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tif the Request-URI of the SIP SUBSCRIBE request contains the public service identity identifying the participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tif the originating MCPTT ID is different than the served MCPTT ID, shall send a 403 (Forbidden) response and shall not continue with the rest of the steps; and\n4)\tshall generate a 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26] and IETF RFC 4354 [55].\nFor the duration of the subscription, the MCPTT server shall notify subscriber about changes of the MCPTT service settings of the subscribed MCPTT user, as described in clause 7.3.6.2.\nIn order to notify the subscriber about changes of the MCPTT service settings of the subscribed MCPTT client of the subscribed MCPTT user, the MCPTT server:\n1)\tshall generate an application/poc-settings+xml MIME body containing:\na)\tthe <am-settings> element of the poc-settings event package set to the current answer mode setting of the MCPTT client according to IETF RFC 4354 [55]; and\nb)\tthe <selected-user-profile-index> element as defined in clause 7.4.1.2.2 identifying the active MCPTT user profile; and\n2)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26] and IETF RFC 4354 [55] with the constructed application/poc-settings+xml MIME body.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7.3.7\tSending a CSK key download message",
                            "text_content": "If confidentiality protection is enabled as specified in clause 6.6.2.3.1, and if the participating MCPTT function received a Client Server Key (CSK) within a SIP REGISTER request for service authorisation or SIP PUBLISH request for service authorisation, the participating MCPTT function may decide to update the CSK. In this case, the participating MCPTT function shall perform a key download procedure for the CSK. The participating MCPTT function:\n1)\tshall generate an SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall set the Request-URI to the URI received in the To header field in a third-party SIP REGISTER request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall include an application/mikey MIME body containing the CSK-ID and the CSK encrypted within a MIKEY message to the MC client as specified in clause 9.2.1 of 3GPP TS 33.180 [78] in the body of the SIP MESSAGE request;\n6)\tshall send the SIP MESSAGE request towards the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7.4\tCoding",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7.4.1\tExtension of MIME types",
                            "text_content": "The parent clause of this clause defines extensions of MIME type defined in other documents.\nThe parent clause of this clause describes extension of the application/poc-settings+xml MIME body specified in IETF RFC 4354 [55]. The extension is used to indicate the selected MCS user profile at an MC client.\nThe application/poc-settings+xml MIME body indicating the selected MCS user profile at an MC client is constructed according to IETF RFC 4354 [55] and:\n1)\tcontains a <poc-settings> root element according to IETF RFC 4354 [55];\n2)\tcontains one or more <entity> child element according to IETF RFC 4354 [55] of the <poc-settings> element;\n3)\tcontains one <selected-user-profile-index> child element defined in the XML schema defined in table 7.4.1.2.2-2, of the <entity> element; and\nNOTE:\tThe <selected-user-profile-index> element is validated by the <xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <entity> element.\n4)\tcontains zero or one <multiplex-support> child element defined in the XML schema defined in table 7.4.1.2.2-2, of the <entity> element.\nThe application/poc-settings+xml MIME body refers to namespaces using prefixes specified in table 7.4.1.2.2-1.\nTable 7.4.1.2.2-1: Assignment of prefixes to namespace names in the application/poc-settings+xml MIME body\n\nTable 7.4.1.2.2-2: XML schema with elements and attributes extending the application/poc-settings+xml MIME body\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:mcsSettings:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:mcs10Set=\"urn:3gpp:mcsSettings:1.0\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n\n<!-- MCS specific \"entity\" child elements -->\n<xs:element name=\"selected-user-profile-index\" type=\"mcs10Set:selected-user-profile-indexType\"/>\n<xs:element name=\"multiplex-support\" type=\"xs:boolean\" minOccurs=\"0\" maxOccurs=\"1\"/>\n\n<xs:complexType name=\"selected-user-profile-indexType\">\n<xs:sequence>\n<xs:element name=\"user-profile-index\" type=\"xs:nonNegativeInteger\"/>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n</xs:schema>\n\nAn example application/poc-settings+xml MIME body showing the MC service settings for two MC clients as might be included in the body of a SIP NOTIFY request is shown in table 7.4.1.2.2-3.\nTable 7.4.1.2.2-3: Example application/poc-settings+xml MIME body showing the MC service settings for two MC clients as might be included in the body of a SIP NOTIFY request\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<poc-settings xmlns=\"urn:oma:params:xml:ns:poc:poc-settings\">\n<entity id=\"urn:uuuid:do39s8zksn2d98x\">\n<am-settings>\n<answer-mode>automatic</answer-mode>\n</am-settings>\n<selected-user-profile-index>\n<user-profile-index>1</user-profile-index>\n</selected-user-profile-index>\n<multiplex-support>true</multiplex-support>\n</entity>\n<entity id=\"urn:uuuid:ksn2d98xdo39s8z\">\n<am-settings>\n<answer-mode>manual</answer-mode>\n</am-settings>\n<selected-user-profile-index>\n<user-profile-index>2</user-profile-index>\n</selected-user-profile-index>\n<multiplex-support>true</multiplex-support>\n</entity>\n</poc-settings>\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 7.4.1.2.2-1: Assignment of prefixes to namespace names in the application/poc-settings+xml MIME body",
                                    "table number": 4,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "7A\tMigration service authorization",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "7A.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the migration service authorization procedure for the MCPTT client. The MCPTT UE uses SIP REGISTER to perform authorization for migration.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "7A.2\tMCPTT client procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7A.2.1\tSIP REGISTER request for migration service authorization",
                            "text_content": "When the MCPTT client performs SIP registration for migration service authorization, the MCPTT client shall perform the registration procedures as specified in 3GPP TS 24.229 [4].\nThe MCPTT client shall include the following media feature tags in the Contact header field of the SIP REGISTER request:\n1)\tthe g.3gpp.mcptt media feature tag; and\n2)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\".\nIf the MCPTT client supports MCPTT service continuity, then the MCPTT client shall follow the IMS registration procedures for PS to PS service continuity as specified in clause 6.2.2 of 3GPP TS 24.237 [58].\nIf the MCPTT client, upon performing SIP registration:\n1)\thas successfully finished the user authentication procedure as described in 3GPP TS 24.482 [49];\n2)\thas available an access token from the partner IdM server;\n4)\tconfidentiality protection is disabled as specified in clause 6.6.2.3.1; and\n5)\tintegrity protection is disabled as specified in clause 6.6.3.3.1;\nthen the MCPTT client shall include in the SIP REGISTER request an application/vnd.3gpp.mcptt-info+xml MIME body as defined in annex F.1 with:\n1)\tthe <mcptt-access-token> element set to the value of the access token received from the partner IdM server;\nNOTE:\tThe access token contains the MCPTT ID of the user in the partner MCPTT system.\n2)\tthe <mcptt-request-uri> element set to the value of the MCPTT ID of the user in the primary MCPTT system; and\n3)\tthe <selected-user-profile-index> element as defined in clause 7.4.1.2.2 set to the value contained in the \"user-profile-index\" attribute of the MCPTT user profile selected according to clause 4.2.2.1.2.3 of 3GPP TS 24.484 [50].\nIf the MCPTT client, upon performing SIP registration:\n1)\thas successfully finished the user authentication procedure as described in 3GPP TS 24.482 [49];\n2)\thas an available access token; and\n3)\teither confidentiality protection is enabled as specified in clause 6.6.2.3.1 or integrity protection is enabled as specified in clause 6.6.3.3.1;\nthen the MCPTT client:\n1)\tshall include an application/mikey MIME body with the CSK as MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78] in the body of the SIP REGISTER request;\n2)\tif confidentiality protection is enabled as specified in clause 6.6.2.3.1, shall include in the body of the SIP REGISTER request, an application/vnd.3gpp.mcptt-info+xml MIME body with the following clarifications:\na)\tshall encrypt the received access-token using the client server key (CSK) and include the <mcptt-access-token> element set to the encrypted access-token, as specified in clause 6.6.2.3.3;\nb)\tshall encrypt the MCPTT ID of the user in the primary MCPTT system and include the <mcptt-request-uri> element set to the encrypted MCPTT ID; and\nc)\tshall encrypt the value contained in the \"user-profile-index\" attribute of the MCPTT user profile selected according to clause 4.2.2.1.2.3 of 3GPP TS 24.484 [50] and include the <selected-user-profile-index> element set to the encrypted value;\n3)\tif confidentiality protection is disabled as specified in clause 6.6.2.3.1, shall include an application/vnd.3gpp.mcptt-info+xml MIME body as defined in Annex F.1 with:\na)\tthe <mcptt-access-token> element set to the access token received from the partner IdM server;\nb)\tthe <mcptt-request-uri> element set to the MCPTT ID of the user in the primary MCPTT system; and\nc)\tthe <selected-user-profile-index> element set to the value contained in the \"user-profile-index\" attribute of the MCPTT user profile selected according to clause 4.2.2.1.2.3 of 3GPP TS 24.484 [50]; and\n4)\tif integrity protection is enabled as specified in clause 6.6.3.3.1, shall use the CSK to integrity protect the application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.6.3.3.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.2.2\tReceiving a CSK key download message",
                            "text_content": "When the MCPTT client receives a SIP MESSAGE request containing:\n1)\ta P-Asserted-Service header field containing the \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n2)\tan application/mikey MIME body;\nThen, if the key identifier within the CSB-ID of the MIKEY payload is a CSK-ID (4 most-significant bits have the value '2'), the MCPTT client:\n1)\tshall follow the security procedures in clause 9.2.1 of 3GPP TS 33.180 [78] to extract the CSK. The client:\na)\tif the initiator field (IDRi) has type 'URI' (identity hiding is not used), the client:\ni)\tshall extract the initiator URI from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the initiator URI deviates from the public service identity of the participating MCPTT function serving the MCPTT user, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nii)\tshall convert the initiator URI to a UID as described in 3GPP TS 33.180 [78];\nb)\tif the initiator field (IDRi) has type 'UID' (identity hiding in use), the client:\nii)\tshall convert the public service identity of participating MCPTT function serving the MCPTT user to a UID as described in 3GPP TS 33.180 [78];\ni)\tshall compare the generated UID with the UID in the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the two initiator UIDs deviate from each other, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nc)\tshall use the UID to validate the signature of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif authentication verification of the I_MESSAGE fails, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\ne)\tshall extract and decrypt the encapsulated CSK using the participating MCPTT function's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nf)\tshall extract the CSK-ID, from the payload as specified in 3GPP TS 33.180 [78];\n2)\tUpon successful extraction, the client shall replace the existing CSK and CSK-ID associated with the participating MCPTT function, with the extracted CSK and CSK-ID in the 'key download' message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7A.3\tPartner MCPTT server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7A.3.1\tGeneral",
                            "text_content": "In order to perform initial authorization to verify whether the MCPTT user is permitted to migrate to the partner MCPTT system, the partner MCPTT server obtains information from any received third-party SIP REGISTER request (e.g., including information contained in the body of the third-party SIP REGISTER request) as specified in 3GPP TS 24.229 [4]. The body will carry the SIP REGISTER request as sent by the MCPTT client and may contain information needed for initial authorization.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.3.2\tConfidentiality and integrity protection",
                            "text_content": "When the partner MCPTT server receives a SIP REGISTER request sent from the MCPTT client contained within a message/sip MIME body of a received third-party SIP REGISTER request, it first determines whether XML MIME bodies included in the request are integrity protected. If XML MIME bodies are integrity protected the MCPTT server validates the signature of each of the XML MIME bodies. If the integrity protection check(s) pass or the XML MIME bodies are not integrity protected, the partner MCPTT server then determines whether the content in specific XML elements is confidentiality protected. If XML content is confidentiality protected, the partner MCPTT server decrypts the protected content.\nUpon receiving a SIP REGISTER request containing an application/vnd.3gpp.mcptt-info+xml MIME body within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client, the MCPTT server:\n1)\tshall determine if integrity protection has been applied to XML MIME bodies in the SIP request by following the procedures in clause 6.6.3.4.1 for each XML MIME body;\n2)\tif integrity protection has been applied, shall use the keying data described in clause 6.6.3.2 and the procedures described in clause 6.6.3.4.2 to verify the integrity of each of the XML MIME bodies; and\n3)\tif all integrity protection checks succeed, shall continue with the remaining steps of this clause.\nUpon receiving a SIP REGISTER request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-access-token> element, an <mcptt-request-uri> element, and a <selected-user-profile-index> element  within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client, the MCPTT server:\n1)\tshall determine if confidentiality protection has been applied to the <mcptt-access-token> element, the <mcptt-request-uri> element, and the <selected-user-profile-index> element in the application/vnd.3gpp.mcptt-info+xml MIME body, by following the procedures in clause 6.6.2.4.1;\n2)\tif confidentiality protection has been applied to the <mcptt-access-token> element, the <mcptt-request-uri> element, and the <selected-user-profile-index> element:\na)\tshall use the keying information received in the MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [78], along with the procedures described in clause 6.6.2.4.2 to:\ni)\tdecrypt the received access token in the <mcptt-access-token> element in the application/vnd.3gpp.mcptt-info+xml MIME body;\nii)\tdecrypt the received MCPTT ID of the user in the primary MCPTT system in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\niii)\tdecrypt the received selected user profile index in the <selected-user-profile-index> element in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tif the decryption procedure succeeds, shall identify the MCPTT ID of the user in the partner MCPTT system, the MCPTT ID of the user in the primary MCPTT system, and the selected user profile index from the decrypted values; and\nc)\tif the decryption procedure fails, shall determine that confidentiality protection has not been successful;\n3)\tif confidentiality protection has been applied to only one or two of the <mcptt-access-token> element, the <mcptt-request-uri> element, and the <selected-user-profile-index> element:\na)\tshall determine that confidentiality protection has not been successful; and\n4)\tif confidentiality protection has not been applied:\na)\tshall identify the MCPTT ID of the user in the partner MCPTT system from <mcptt-access-token> element received in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tshall identify the MCPTT ID of the user in the primary MCPTT system from the <mcptt-request-uri> element received in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nc)\tshall identify the selected user profile index from the <selected-user-profile-index> element received in the application/vnd.3gpp.mcptt-info+xml MIME body.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.3.3\tSIP REGISTER request for initial authorization",
                            "text_content": "The partner MCPTT server shall support obtaining migration service authorization specific information from the SIP REGISTER request sent from the MCPTT client and included in the body of a third-party SIP REGISTER request.\nNOTE 1:\t3GPP TS 24.229 [4] defines how based on initial filter criteria the SIP REGISTER request sent from the UE is included in the body of the third-party SIP REGISTER request.\nUpon receiving a third party SIP REGISTER request with a message/sip MIME body containing the SIP REGISTER request sent from the MCPTT client containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-access-token> element, an <mcptt-request-uri> element, and a <selected-user-profile-index> within a message/sip MIME body of the SIP REGISTER request sent from the MCPTT client, the MCPTT server:\n1)\tshall perform initial authorization to verify whether the MCPTT user is permitted to migrate to the partner MCPTT system; and\nNOTE 2:\tThe criteria for the initial authorization is outside the scope of the present document.\n2)\tif the initial authorization was successful:\na)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall set the Request-URI to the public service identity identifying the primary participating MCPTT function serving the MCPTT user;\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> element set to the MCPTT ID of the user in the primary MCPTT system;\nii)\tthe <partner-mcptt-id> element set to the MCPTT ID of the user in the partner MCPTT system; and\niii)\tthe <selected-user-profile-index> element set to the selected user profile index; and\nd)\tshall send the SIP MESSAGE request towards the partner MCPTT gateway according to the rules and procedures of 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.3.4\tSending a CSK key download message",
                            "text_content": "If confidentiality protection is enabled as specified in clause 6.6.2.3.1, and if the participating MCPTT function received a Client Server Key (CSK) within a SIP REGISTER request for migration service authorization, the participating MCPTT function may decide to update the CSK. In this case, the participating MCPTT function shall perform a key download procedure for the CSK. The participating MCPTT function:\n1)\tshall generate an SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall set the Request-URI to the URI received in the To header field in a third-party SIP REGISTER request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall include an application/mikey MIME body containing the CSK-ID and the CSK encrypted within a MIKEY message to the MC client as specified in clause 9.2.1 of 3GPP TS 33.180 [78] in the body of the SIP MESSAGE request;\n6)\tshall send the SIP MESSAGE request towards the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.3.5\tSIP MESSAGE request for migration service authorization response",
                            "text_content": "The partner MCPTT server shall support obtaining migration service authorization specific information from a SIP MESSAGE request sent from the partner MCPTT gateway server containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-Params> element containing:\n1)\tthe <mcptt-request-uri> element set to the MCPTT ID of the user in the primary MCPTT system;\n2)\tthe <partner-mcptt-id> element set to the MCPTT ID of the user in the partner MCPTT system; and\n3)\tthe <migration-auth-result> element.\nUpon receiving a SIP MESSAGE request from the partner MCPTT gateway server, if the <migration-auth-result> is set to \"true\", the partner MCPTT server shall:\n1)\tstore the mapping between the MCPTT IDs of the user in the primary MCPTT system and the partner MCPTT system; and\n2)\tgenerate and send a SIP 200 OK response to the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7A.4\tPartner MCPTT gateway server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7A.4.1\tSIP MESSAGE from the partner MCPTT server",
                            "text_content": "The partner MCPTT gateway server shall operate as specified in clause 6.8.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.4.2\tSIP MESSAGE request from the primary MCPTT gateway server",
                            "text_content": "The partner MCPTT gateway server shall operate as specified in clause 6.8.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7A.5\tPrimary MCPTT gateway server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7A.5.1\tSIP MESSAGE from the partner MCPTT gateway",
                            "text_content": "The primary MCPTT gateway server shall operate as specified in clause 6.8.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "7A.5.2\tSIP MESSAGE request from the primary MCPTT server",
                            "text_content": "The partner MCPTT gateway server shall operate as specified in clause 6.8.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "7A.6\tPrimary MCPTT server procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "7A.6.1\tSIP MESSAGE request for migration service authorization request",
                            "text_content": "The primary MCPTT server shall support obtaining migration service authorization specific information from a SIP MESSAGE request sent from the primary MCPTT gateway server containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-Params> element containing:\n-\tthe <mcptt-request-uri> element set to the MCPTT ID of the user in the primary MCPTT system;\n-\tthe <partner-mcptt-id> element set to the MCPTT ID of the user in the partner MCPTT system; and\n-\tthe <selected-user-profile-index> element set to the selected user profile index.\nUpon receiving a SIP MESSAGE request from the primary MCPTT gateway server, the primary MCPTT server shall:\n1)\tperform an authorization check to verify whether the user identified by the <mcptt-request-uri> element is permitted to migrate to the partner MCPTT system whose identity can be derived using the <partner-mcptt-id> element, the <selected-user-profile-index> element, and the MCPTT user profile configuration document for the user; and\n2)\tif the migration is permitted:\na)\tmark the user identified by the <mcptt-request-uri> element as having migrated;\nb)\tstore the partner MCPTT system ID derived according to bullet 1) above;\nc)\tstore the mapping between the MCPTT IDs of the user in the primary MCPTT system and the partner MCPTT system;\nd)\tgenerate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\ne)\tset the Request-URI in the SIP MESSAGE request to the public service identity identifying the participating MCPTT function serving the MCPTT user in the partner MCPTT system;\nf)\tinclude, in the SIP MESSAGE request, an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> element set to the MCPTT ID of the user in the primary MCPTT system;\nii)\tthe <partner-mcptt-id> element set to the MCPTT ID of the user in the partner MCPTT system; and\niii)\tthe <migration-auth-result> element set to \"true\"; and\ng)\tsend the SIP MESSAGE request towards the primary MCPTT gateway according to the rules and procedures of 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "8\tPre-established session",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "8.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "The MCPTT client may establish one or more pre-established sessions to the participating MCPTT function at any time after SIP registration and setting the service settings as defined in clause 7.2.2 or clause 7.2.3.\nThe MCPTT client may use the pre-established session for originating MCPTT calls after pre-established session establishment.\nThe participating MCPTT function may use the pre-established session for terminating MCPTT calls after pre-established session establishment.\nThe MCPTT client may initiate the modification of the media parameters of a pre-established session as defined in clause 8.3.1.1.\nThe participating MCPTT function may initiate the modification of the media parameters of a pre-established session as defined in clause 8.3.2.2.\nThe MCPTT client may initiate the release of a pre-established session as defined in clause 8.4.1.1.\nThe participating MCPTT function may initiate the release of a pre-established session as defined in clause 8.4.2.2.\nThe use of a pre-established session requires the use of resource sharing as specified in 3GPP TS 29.214 [79] and 3GPP TS 24.229 [4] by the participating MCPTT function. The participating MCPTT function use of resource sharing is defined in clause 8.1A.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.1A\tParticipating MCPTT function use of resource sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "The participating MCPTT function utilises resource sharing either:\n1)\tvia the SIP core as specified in 3GPP TS 24.229 [4]; or\n2)\tby directly interfacing to PCC to control resource sharing via the Rx reference point as specified in 3GPP TS 29.214 [79].\nIf resource sharing is supported then the participating MCPTT function shall allow the use of pre-established sessions by the MCPTT client.\nThe participating MCPTT function can determine that the SIP core supports resource sharing from the received third-party SIP REGISTER request if the Resource-Share header field with the value \"supported\" is contained in the \"message/sip\" MIME body of the third-party SIP REGISTER request as specified in 3GPP TS 24.229 [4].\nWhen using resource sharing the participating MCPTT function uses the \"+g.3gpp.registration-token\" header field parameter in the Contact header field of the third-party REGISTER request to identify the MCPTT UE that is registering and to identify whether resource sharing and pre-established sessions can be used with a specific MCPTT UE.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "8.2\tSession establishment",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.2.1\tMCPTT client procedures",
                            "text_content": "When the MCPTT client initiates a pre-established session the MCPTT client shall:\n1)\tgather ICE candidates according to IETF RFC 8445 [89]; and\nNOTE 1:\tICE candidates are only gathered on interfaces that the MCPTT UE uses to obtain MCPTT service.\n2)\tgenerate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the participating MCPTT function serving the MCPTT user;\n2)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n3)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.mcptt along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall include the \"timer\" option tag in the Supported header field;\n8)\tshould include the Session-Expires header field according to IETF RFC 4028 [7] and should not include the \"refresher\" header field. The \"refresher\" header field parameter shall be set to \"uac\" if included;\n9)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1, and include ICE candidates in the SDP offer as per IETF RFC 8839 [90]; and\n10)\tshall send the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 2xx response to the SIP INVITE request the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nNOTE 2:\tIf ICE candidate evaluation results in candidate pairs other than the default candidate pair being selected a further offer answer exchange using the procedures in clause 8.3 will be needed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.2.2\tParticipating MCPTT function procedures",
                            "text_content": "Upon receipt of a \"SIP INVITE request for establishing a pre-established session\" the participating MCPTT function:\n1)\tshall check whether the public service identity is allocated and perform the actions specified in clause 6.3.7.1 if it is not allocated. Otherwise, continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the MCPTT user establishing the pre-established session and perform actions to verify the MCPTT ID of the MCPTT client and authorise the request according to local policy, and if not authorised, the participating MCPTT function shall return a SIP 403 (Forbidden) response with the warning text set to \"100 function not allowed due to <detailed reason>\" as specified in clause 4.4. Otherwise, continue with the rest of the steps;\n3)\tshall determine whether resource sharing is supported (see clause 8.1A);\n4)\tif resource sharing is supported by the SIP core, determine that there is a binding between the  MCPTT ID of the MCPTT user establishing the pre-established session and the MCPTT UE identified by the \"+g.3gpp.registration-token\" header field parameter in the Contact header field of the third-party REGISTER request (see clause 8.1A) and that this UE identity matches the identity in the \"+g.3gpp.registration-token\" header field parameter in the Feature-Caps header field in the \"SIP INVITE request for establishing a pre-established session\";\n5)\tif resource sharing is not supported or if there is no binding between the MCPTT ID of the MCPTT user and the identity of the MCPTT UE identified by the \"+g.3gpp.registration-token\" header field parameter in the Feature-Caps header field, then the participating MCPTT function shall return a SIP 403 (Forbidden) response with the warning text set to \"100 function not allowed due to pre-established session not supported\" as specified in clause 4.4 and not continue with the rest of the steps;\n6)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the SIP INVITE request shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n7)\tshall verify that the media resources are available to support the media parameters and if not shall reject the request with a SIP 500 (Server Internal Error) response, and shall not continue with the rest of the steps;\n8)\tshall allocate a URI to be used to identify the pre-established session;\n9)\tshall generate a SIP 200 (OK) response to the SIP INVITE request according to clause 6.3.2.1.5.2; and\na)\tshall include a Contact header field containing the URI that identifies the pre-established session;\nb)\tshall include the public service identity of the participating MCPTT function in the P-Asserted-Identity header field;\nc)\tshall include a Supported header field containing the \"norefersub\" option tag;\nd)\tshall if the SIP core supports resource sharing, include a Resource-Share header field answer as specified in 3GPP TS 24.229 [4] with:\nA)\tthe value \"media-sharing\";\nB)\tan \"origin\" header field parameter set to \"session-initiator\";\nC)\ta \"timestamp\" header field parameter; and\nD)\ta \"rules\" header field parameter with one resource sharing rule per media stream in the same order the corresponding m-line appears in the SDP. Each resource sharing rule is constructed as follows:\n-\ta \"new-sharing-key\" part; and\n-\ta \"directionality\" part indicating the direction of the pre-established media stream; and\ne)\tshall include an SDP answer as specified in 3GPP TS 24.229 [4] with the clarifications in clause 6.3.2.1.2.2 and include ICE candidates in the SDP answer as per IETF RFC 8839 [90];\n10)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\nNOTE 1:\tResulting media plane processing is completed before the next step is performed.\n11)\tshall send the SIP 200 (OK) response towards the MCPTT client according to the rules and procedures of the 3GPP TS 24.229 [4]; and\n12)\tshall evaluate the ICE candidates according to IETF RFC 8445 [89].\nNOTE 2:\tIf ICE candidate evaluation results in candidate pairs other than the default candidate pair being selected a further offer answer exchange using the procedures in clause 8.3 will be needed.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.3\tSession modification",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.3.1\tMCPTT client procedures",
                            "text_content": "When the MCPTT client needs to modify the pre-established session outside of an MCPTT call, the MCPTT client:\n1)\tshall generate a SIP UPDATE request or a SIP re-INVITE request according to 3GPP TS 24.229 [4];\n2)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1, and include ICE candidates in the SDP offer as per IETF RFC 8839 [90], if required; and\n3)\tshall send the SIP request towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nOn receipt of the SIP 200 (OK) response the MCPTT client:\n1)\tshall interact with media plane as specified in 3GPP TS 24.380 [5], if there is change in media parameters or codecs in the received SDP answer, compared to those in the previously agreed SDP; and\n2)\tshall interact with media plane as specified in 3GPP TS 24.380 [5], if there is a media stream, that is currently used in the pre-established session, marked as rejected in the received SDP answer.\nNOTE:\tThe MCPTT client keeps resources for previously agreed media stream, media parameters and codecs until it receives a SIP 200 (OK) response.\nUpon receiving a SIP UPDATE request or a SIP re-INVITE request to modify an existing pre-established session without an associated MCPTT call, the MCPTT client:\n1)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec is acceptable by the MCPTT client and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps; and\n2)\tshall generate a SIP 200 (OK) response as follows:\na)\tshall include an SDP answer according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2, and include ICE candidates in the SDP answer as per IETF RFC 8839 [90], if required.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.3.2\tParticipating MCPTT function procedures",
                            "text_content": "Upon receiving a SIP UPDATE request or a SIP re-INVITE request to modify an existing pre-established session without associated MCPTT call, the participating MCPTT function:\n1)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec is acceptable by the participating MCPTT function and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps; and\n2)\tshall generate a SIP 200 (OK) response as follows:\na)\tinclude an SDP answer according to 3GPP TS 24.229 [4] based on the received SDP offer with the clarifications given in the 6.3.2.1.2.2, and include ICE candidates in the SDP answer as per IETF RFC 8839 [90], if required; and\nb)\tinclude a Contact header field containing the URI that identifies the pre-established session and send a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4].\nWhen the participating MCPTT function needs to modify the pre-established session outside of an MCPTT call, the participating MCPTT function:\n1)\tshall generate a SIP UPDATE request or a SIP re-INVITE request according to 3GPP TS 24.229 [4];\n2)\tshall include an SDP offer according to 3GPP TS 24.229 [4], and include ICE candidates in the SDP offer as per IETF RFC 8839 [90], if required;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5], if removing a media-floor control entity; and\n4)\tshall send the SIP request towards the MCPTT client according to rules and procedures of 3GPP TS 24.229 [4].\nOn receipt of the SIP 200 (OK) response, the participating MCPTT function:\n1)\tshall interact with media plane as specified in 3GPP TS 24.380 [5], if there is change in media parameters or codecs in the received SDP answer, compared to those in the previously agreed SDP;\n2)\tshall interact with media plane as specified in 3GPP TS 24.380 [5], if there is a media stream, that is currently used in the pre-established session, marked as rejected in the received SDP answer; and\n3)\tshall interact with media plane as specified in 3GPP TS 24.380 [5], if there is a media stream accepted in the received SDP answer, that is not currently used by the participant in the pre-established session.\nNOTE:\tThe participating MCPTT function keeps resources for previously agreed media stream, media-floor control entities, media parameters and codecs until it receives a SIP 200 (OK) response.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "8.4\tSession release",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "8.4.1\tMCPTT client procedures",
                            "text_content": "NOTE:\tThe MCPTT client needs to be prepared to release the pre-established session when receiving a SIP BYE request generated by the SIP core (e.g. due to network release of media plane resources).\nWhen a MCPTT client needs to release a pre-established session as created in clause 8.2.1, the MCPTT client:\n1)\tshall generate a SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall set the Request-URI of the SIP BYE request to the URI that identifies the pre-established session;\n3)\tshall send the SIP BYE request towards the participating MCPTT function within the SIP dialog of the pre-established session according to rules and procedures of the 3GPP TS 24.229 [4]; and\n4)\tshall, upon receiving a SIP 200 (OK) response to the SIP BYE request interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving a SIP BYE request from the participating MCPTT function within a pre-established session the MCPTT client shall check whether there are any MCPTT calls using the pre-established session, and:\n1)\tif there is an established MCPTT call then the MCPTT client shall remove the MCPTT client from the MCPTT call by performing the procedures for session release for each MCPTT session as specified in 3GPP TS 24.380 [5]; and\n2)\tif there is no MCPTT call using the pre-established session, then the MCPTT client shall:\na)\tinteract with the media plane as specified in 3GPP TS 24.380 [5] for disconnecting the media plane resources towards the participating MCPTT function; and\nb)\tshall generate and send a SIP 200 (OK) response to the SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "8.4.2\tParticipating MCPTT function procedures",
                            "text_content": "Upon receiving a SIP BYE request from the MCPTT client within a pre-established session the participating MCPTT function:\n1)\tshall check whether there is a MCPTT call using the pre-established session, and:\na)\tif there is an established MCPTT session then the participating MCPTT function shall remove the MCPTT client from the MCPTT session by performing the procedures as specified in clause 6.3.2.1.6; and\nb)\tif there is a MCPTT session in the process of being established, then the participating MCPTT function:\ni)\tshall send a SIP CANCEL request to cancel the MCPTT session in the process of being established as specified in 3GPP TS 24.229 [4]; and\nii)\tshall release the MCPTT session as specified in the clause clause 6.3.2.1.6, if a SIP 200 (OK) response for the SIP INVITE request is received from the remote side; and\nc)\tif there is no MCPTT call using the pre-established session, then the participating MCPTT function shall:\ni)_\tinteract with the media plane as specified in 3GPP TS 24.380 [5] for disconnecting the media plane resources towards the MCPTT client; and\nii)\tshall generate and send a SIP 200 (OK) response to the SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP BYE request from the remote side, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for releasing media plane resources towards the remote side;\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for releasing media plane resources towards the MCPTT client; and\n3)\tshall send a SIP 200 (OK) response to the SIP BYE request to the MCPTT client.\nWhen a participating MCPTT function needs to release a pre-established session as created in clause 8.2.2, the participating MCPTT function:\n1)\tshall first release any participants of all MCPTT calls that are using the pre-established session using the procedures as follows. The participating MCPTT function:\na)\tshall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5];\nb)\tshall generate a SIP BYE request as specified in 3GPP TS 24.229 [4];\nc)\tshall set the Request-URI to the MCPTT session identity;\nd)\tshall include a P-Asserted-Identity header field in the outgoing SIP BYE request set to the public service identity of the participating MCPTT function;\ne)\tshall send the SIP BYE request toward the controlling MCPTT function, according to 3GPP TS 24.229 [4]; and\nf)\tshall, upon receiving a SIP 200 (OK) response to the SIP BYE request the terminating MCPTT function shall interact with the media plane as specified in clause 6.4 in 3GPP TS 24.380 [5];\n2)\tshall generate a SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4];\n3)\tshall set the Request-URI of the SIP BYE request to the URI that identifies the pre-established session;\n4)\tshall send the SIP BYE request towards the MCPTT client within the SIP dialog of the pre-established session according to rules and procedures of the 3GPP TS 24.229 [4]; and\n5)\tshall, upon receiving a SIP 200 (OK) response to the SIP BYE request interact with the media plane as specified in 3GPP TS 24.380 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "9\tAffiliation",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 9.2 contains the procedures for explicit affiliation at the MCPTT client, the MCPTT server serving the MCPTT user and the MCPTT server owning the MCPTT group.\nClause 9.2 contains the procedures for implicit affiliation at the MCPTT server serving the MCPTT user and the MCPTT server owning the MCPTT group.\nClause 9.3 describes the coding used for explicit affiliation.\nThe procedures for implicit affiliation in this clause are triggered at the MCPTT server serving the MCPTT user in the following circumstances:\n-\ton receipt of a SIP INVITE request or a SIP REFER request from an MCPTT client to join an MCPTT chat group, where the MCPTT client is not already affiliated to the MCPTT group;\n-\ton receipt of a SIP INVITE request or a SIP REFER request from an MCPTT client when attempting to initiate an MCPTT emergency group call or MCPTT imminent peril group call and the MCPTT client is not already affiliated to the MCPTT group;\n-\ton receipt of a SIP MESSAGE request from an MCPTT client when initiating an MCPTT emergency alert targeted to an MCPTT group and the MCPTT client is not already affiliated to the MCPTT group; and\n-\ton receipt of a SIP REGISTER request for service authorisation (as described in clause 7.3.2) or SIP PUBLISH request for service authorisation and service settings (as described in clause 7.3. 3), as determined by configuration in the MCPTT user profile document as specified in 3GPP TS 24.484 [50].\nThe procedures for implicit affiliation in this clause are triggered at the MCPTT server owning the MCPTT group in the following circumstances:\n-\ton receipt of a SIP INVITE request from the MCPTT server serving the MCPTT user where an MCPTT user wants to join an MCPTT chat group and the MCPTT client is not already affiliated to the MCPTT group;\n-\ton receipt of a SIP INVITE request from the MCPTT server serving the MCPTT user where an MCPTT user initiates an MCPTT emergency group call or MCPTT imminent peril group call and the MCPTT client is not already affiliated to the MCPTT group; and\n-\ton receipt of a SIP MESSAGE request from the MCPTT server serving the MCPTT user when the MCPTT user initiates an MCPTT emergency alert targeted to an MCPTT group and the MCPTT client is not already affiliated to the MCPTT group.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.2.1\tMCPTT client procedures",
                            "text_content": "The MCPTT client procedures consist of:\n-\tan affiliation status change procedure;\n-\tan affiliation status determination procedure;\n-\ta procedure for sending affiliation status change request in negotiated mode to target MCPTT user;\n-\ta procedure for receiving affiliation status change request in negotiated mode from authorized MCPTT user; and\n-\ta rules based affiliation status change procedure.\nIn order to obtain information about success or rejection of changes triggered by the affiliation status change procedure for an MCPTT user, the MCPTT client needs to initiate the affiliation status determination procedure for the MCPTT user before starting the affiliation status change procedure for the MCPTT user.\nIn order:\n-\tto indicate that an MCPTT user is interested in one or more MCPTT group(s) at an MCPTT client;\n-\tto indicate that the MCPTT user is no longer interested in one or more MCPTT group(s) at the MCPTT client;\n-\tto indicate that the MCPTT user continues to have interest in one or more MCPTT group(s) at an MCPTT client due to near expiration of the expiration time of an MCPTT group with the affiliation status set to the \"affiliated\" state received in a SIP NOTIFY request in clause 9.2.1.3;\n-\tto send an affiliation status change request in mandatory mode to another MCPTT user;\n-\tto indicate that an MCPTT user is interested in one or more MCPTT group(s) at an MCPTT client triggered by a location or functional alias activation criteria;\n-\tto indicate that the MCPTT user is no longer interested in one or more MCPTT group(s) at the MCPTT client client triggered by location or functional alias deactivation criteria; or\n-\tany combination of the above;\nthe MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].\nWhen the MCPTT user indicates that he is no longer interested in one or more MCPTT group(s) at the MCPTT client, the MCPTT client shall first check the <manual-deaffiliation-not-allowed-if-affiliation-rules-are-met> element within the <anyExt> element of the <entry> element corresponding to the group information within the <GroupList> list element of the <anyExt> element of the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]). If the affiliation to the group has been activated due to a rule being fulfilled and the <manual-deaffiliation-not-allowed-if-affiliation-rules-are-met> element is set to a value of \"true\", the MCPTT client shall suppress the MCPTT user's request.\nNOTE 1:\tIf the request is suppressed, a notification message can be displayed to the user\nIn the SIP PUBLISH request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT ID of the MCPTT user;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tif the targeted MCPTT user is interested in at least one MCPTT group at the targeted MCPTT client, shall set the Expires header field according to IETF RFC 3903 [37], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the targeted MCPTT user is no longer interested in any MCPTT group at the targeted MCPTT client, shall set the Expires header field according to IETF RFC 3903 [37], to zero; and\n6)\tshall include an application/pidf+xml MIME body indicating per-user affiliation information according to clause 9.3.1. In the MIME body, the MCPTT client:\na)\tshall include all MCPTT groups where the targeted MCPTT user indicates its interest at the targeted MCPTT client;\nb)\tshall include the MCPTT client ID of the targeted MCPTT client;\nc)\tshall not include the \"status\" attribute and the \"expires\" attribute in the <affiliation> element; and\nd)\tshall set the <p-id> child element of the <presence> root element to a globally unique value.\nNOTE:\tThis procedure deviates from IETF RFC 3903 [37] by possibly including an application/pidf+xml MIME body when refreshing the expiration time for one or more groups. The use of this MIME body provides the ability to refresh affiliation or to deaffiliate multiple groups in a single message.\nThe MCPTT client shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nNOTE 1:\tThe MCPTT UE also uses this procedure to determine which MCPTT groups the MCPTT user successfully affiliated to.\nIn order to discover MCPTT groups:\n1)\twhich the MCPTT user at an MCPTT client is affiliated to; or\n2)\twhich another MCPTT user is affiliated to;\nthe MCPTT client shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT ID of the targeted MCPTT user;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT client wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero; and\n6)\tshall include an Accept header field containing the application/pidf+xml MIME type; and\n7)\tif requesting MCPTT groups where the MCPTT user is affiliated to at the MCPTT client, shall include an application/simple-filter+xml MIME body indicating per-client restrictions of presence event package notification information according to clause 9.3.2, indicating the MCPTT client ID of the MCPTT client.\nIn order to re-subscribe or de-subscribe, the MCPTT client shall generate an in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:\n1)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 3:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n2)\tif the MCPTT client wants to de-subscribe, shall set the Expires header field according to IETF RFC 6665 [26], to zero; and\n3)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nUpon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-user affiliation information constructed according to clause 9.3.1, then the MCPTT client shall determine affiliation status of the MCPTT user for each MCPTT group at the MCPTT client(s) in the MIME body. If the <p-id> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request is included, the <p-id> element value indicates the SIP PUBLISH request which triggered sending of the SIP NOTIFY request.\nNOTE:\tProcedure for sending affiliation status change request in negotiated mode to several target MCPTT users is not supported in this version of the specification.\nUpon receiving a request from the MCPTT user to send an affiliation status change request in negotiated mode to a target MCPTT user, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]. In the SIP MESSAGE request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT ID of the target MCPTT user;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n4)\tshall include an application/vnd.3gpp.mcptt-affiliation-command+xml MIME body as specified in Annex F.4; and\n5)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client shall indicate to the user that the request has been delivered to an MCPTT client of the target MCPTT user.\nUpon receiving a SIP MESSAGE request containing:\n1)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n2)\tan application/vnd.3gpp.mcptt-affiliation-command+xml MIME body with a list of MCPTT groups for affiliation under the <affiliate> element and a list of MCPTT groups for de-affiliation under the <de-affiliate> element;\nthen the MCPTT client:\n1)\tshall send a 200 (OK) response to the SIP MESSAGE request;\n2)\tshall seek confirmation of the list of MCPTT groups for affiliation and the list of MCPTT groups for de-affiliation, resulting in an accepted list of MCPTT groups for affiliation and an accepted list of MCPTT groups for de-affiliation; and\n3)\tif the user accepts the request:\na)\tshall perform affiliation for each entry in the accepted list of MCPTT groups for affiliation for which the MCPTT client is not affiliated, as specified in clause 9.2.1.2; and\nb)\tshall perform de-affiliation for each entry in the accepted list of MCPTT groups for de-affiliation for which the MCPTT client is affiliated, as specified in clause 9.2.1.2.\nIn order to subscribe to changes in per-group dynamic data, the MCPTT client shall generate an initial SIP SUBSCRIBE request specified in 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT group ID of the targeted MCPTT group;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field specified in IETF RFC 6050 [9];\n4)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field specified in IETF RFC 6665 [26], to 4294967295;\nNOTE 1:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT client wants to fetch the current state only, shall set the Expires header field specified in IETF RFC 6665 [26], to zero;\n6)\tshall include an Accept header field containing the application/pidf+xml MIME type; and\n7)\tshall include an application/simple-filter+xml MIME body indicating per-group restrictions of presence event package notification information specified in clause 9.3.2, indicating the MCPTT group ID.\nIn order to re-subscribe or de-subscribe, the MCPTT client shall generate an in-dialog SIP SUBSCRIBE request specified in 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:\n1)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field specified in IETF RFC 6665 [26], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n2)\tif the MCPTT client wants to de-subscribe, shall set the Expires header field specified in IETF RFC 6665 [26], to zero; and\n3)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nUpon receiving a SIP NOTIFY request specified in 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26], if the SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-group dynamic data information constructed according to clause 9.3.1, then the MCPTT client shall determine per-group dynamic data of the MCPTT group in the MIME body.\nThe MCPTT client can based on configuration decide to affiliate or de-affiliate to a group.\nUser profile based affiliation rules are controlled by the elements <RulesForAffiliation> or <RulesForDeAffiliation> of the MCPTT user profile document identified by the MCPTT ID of the MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]). The rules can be composed of location criteria (including heading and speed) or functional alias based criteria. A rule is fulfilled if  any of the location criteria and any of the functional alias based criteria are met. If, any defined rule is fulfilled, the MCPTT client shall initiate the affiliation status change procedure as specified in clause 9.2.1.2.\nIf the <permitted-geographic-area> element of the <list-service> element of an MCS group document is present and the MCPTT client is within the area specified in the <permitted-geographic-area> element, the MCPTT client is allowed to affiliate to the group.\nIf the <mandatory-geographic-area> element of the <list-service> element of an MCS group document is present and the MCPTT client is not within the area specified in the <mandatory-geographic-area> element the MCPTT client shall de-affiliate from the group.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9.2.2\tMCPTT server procedures",
                            "text_content": "The MCPTT server procedures consist of:\n-\tprocedures of MCPTT server serving the MCPTT user; and\n-\tprocedures of MCPTT server owning the MCPTT group.\nThe procedures of MCPTT server serving the MCPTT user consist of:\n-\ta receiving affiliation status change from MCPTT client procedure;\n-\ta receiving subscription to affiliation status procedure;\n-\ta sending notification of change of affiliation status procedure;\n-\ta sending affiliation status change towards MCPTT server owning MCPTT group procedure;\n-\tan affiliation status determination from MCPTT server owning MCPTT group procedure;\n-\ta procedure for authorizing affiliation status change request in negotiated mode sent to served MCPTT user;\n-\ta forwarding affiliation status change towards another MCPTT user procedure;\n-\ta forwarding subscription to affiliation status towards another MCPTT user procedure\n-\tan affiliation status determination procedure;\n-\tan affiliation status change by implicit affiliation procedure;\n-\tan implicit affiliation status change completion procedure;\n-\tan implicit affiliation status change cancellation procedure;\n-\tan implicit affiliation to configured groups procedure; and\n-\tforwarding subscription to group dynamic data towards the controlling MCPTT server procedure.\nThe MCPTT server shall maintain a list of MCPTT user information entries. The list of the MCPTT user information entries contains one MCPTT user information entry for each served MCPTT ID.\nIn each MCPTT user information entry, the MCPTT server shall maintain:\n1)\tan MCPTT ID. This field uniquely identifies the MCPTT user information entry in the list of the MCPTT user information entries; and\n2)\ta list of MCPTT client information entries.\nIn each MCPTT client information entry, the MCPTT server shall maintain:\n1)\tan MCPTT client ID. This field uniquely identifies the MCPTT client information entry in the list of the MCPTT client information entries; and\n2)\ta list of MCPTT group information entries.\nIn each MCPTT group information, the MCPTT server shall maintain:\n1)\tan MCPTT group ID. This field uniquely identifies the MCPTT group information entry in the list of the MCPTT group information entries;\n2)\tan affiliation status;\n3)\tan expiration time;\n4)\tan affiliating p-id; and\n5)\ta next publishing time.\nUpon receiving a SIP PUBLISH request such that:\n1)\tRequest-URI of the SIP PUBLISH request contains either the public service identity identifying the originating participating MCPTT function serving the MCPTT user, or the public service identity identifying the terminating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP PUBLISH request contains the \"presence\" event type; and\n5)\tSIP PUBLISH request contains an application/pidf+xml MIME body indicating per-user affiliation information according to clause 9.3.1;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n2)\tif the Request-URI of the SIP PUBLISH request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP PUBLISH request;\n3)\tif the Request-URI of the SIP PUBLISH request contains the public service identity identifying the terminating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n4)\tif the originating MCPTT ID is different than the served MCPTT ID and the originating MCPTT ID is not authorized to modify affiliation status of the served MCPTT ID, shall send a 403 (Forbidden) response and shall not continue with the rest of the steps;\n5)\tif the Expires header field of the SIP PUBLISH request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n6)\tif the Expires header field of the SIP PUBLISH request has nonzero value, shall determine the candidate expiration interval to according to IETF RFC 3903 [37];\n7)\tif the Expires header field of the SIP PUBLISH request has zero value, shall set the candidate expiration interval to zero;\n8)\tshall respond with SIP 200 (OK) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK) response, the MCPTT server:\na)\tshall set the Expires header field according to IETF RFC 3903 [37], to the candidate expiration time;\n9)\tif the \"entity\" attribute of the <presence> element of the application/pidf+xml MIME body of the SIP PUBLISH request is different than the served MCPTT ID, shall not continue with the rest of the steps;\n10)\tshall identify the served MCPTT client ID in the \"id\" attribute of the <tuple> element of the <presence> element of the application/pidf+xml MIME body of the SIP PUBLISH request;\n11)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n12)\tshall consider an MCPTT client information entry such that:\na)\tthe MCPTT client information entry is in the list of MCPTT client information entries of the served MCPTT user information entry; and\nb)\tthe MCPTT client ID of the MCPTT client information entry is equal to the served MCPTT client ID;\nas the served MCPTT client information entry;\n13)\tshall consider a copy of the list of the MCPTT group information entries of the served MCPTT client information entry as the served list of the MCPTT group information entries;\n14)\tif the candidate expiration interval is nonzero:\na)\tshall construct the candidate list of the MCPTT group information entries as follows:\ni)\tfor each MCPTT group ID which has an MCPTT group information entry in the served list of the MCPTT group information entries, such that the expiration time of the MCPTT group information entry has not expired yet, and which is indicated in a \"group\" attribute of an <affiliation> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\nA)\tshall copy the MCPTT group information entry into a new MCPTT group information entry of the candidate list of the MCPTT group information entries;\nB)\tif the affiliation status of the MCPTT group information entry is \"deaffiliating\" or \"deaffiliated\", shall set the affiliation status of the new MCPTT group information entry to the \"affiliating\" state and shall set the affiliating p-id of the new MCPTT group information entry to the value of the <p-id> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\nC)\tshall set the expiration time of the new MCPTT group information entry to the current time increased with the candidate expiration interval;\nii)\tfor each MCPTT group ID which has an MCPTT group information entry in the served list of the MCPTT group information entries, such that the expiration time of the MCPTT group information entry has not expired yet, and which is not indicated in any \"group\" attribute of the <affiliation> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\nA)\tshall copy the MCPTT group information entry into a new MCPTT group information entry of the candidate list of the MCPTT group information entries; and\nB)\tif the affiliation status of the MCPTT group information entry is \"affiliated\" or \"affiliating\":\n-\tshall set the affiliation status of the new MCPTT group information entry to the \"de-affiliating\" state; and\n-\tshall set the expiration time of the new MCPTT group information entry to the current time increased with twice the value of timer F; and\niii)\tfor each MCPTT group ID:\nA)\twhich does not have an MCPTT group information entry in the served list of the MCPTT group information entries; or\nB)\twhich has an MCPTT group information entry in the served list of the MCPTT group information entries, such that the expiration time of the MCPTT group information entry has already expired;\nand which is indicated in a \"group\" attribute of the <affiliation> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\nA)\tshall add a new MCPTT group information entry in the candidate list of the MCPTT group information list for the MCPTT group ID;\nB)\tshall set the affiliation status of the new MCPTT group information entry to the \"affiliating\" state;\nC)\tshall set the expiration time of the new MCPTT group information entry to the current time increased with the candidate expiration interval; and\nD)\tshall set the affiliating p-id of the new MCPTT group information entry to the value of the <p-id> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request;\nb)\tdetermine the candidate number of MCPTT group IDs as number of different MCPTT group IDs which have an MCPTT group information entry:\ni)\tin the candidate list of the MCPTT group information entries; or\nii)\tin the list of the MCPTT group information entries of an MCPTT client information entry such that:\nA)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry; and\nB)\tthe MCPTT client ID of the MCPTT client information entry is not equal to the served MCPTT client ID;\nwith the affiliation status set to the \"affiliating\" state or the \"affiliated\" state and with the expiration time which has not expired yet; and\nc)\tif the candidate number of MCPTT group IDs is bigger than N2 value of the served MCPTT ID (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall based on MCPTT service provider policy reduce the candidate MCPTT group IDs to that equal to N2;\nNOTE:\tThe MCPTT service provider policy can determine to remove an MCPTT group ID based on the order it appeared in the PUBLISH request or based on the importance or priority of the MCPTT group or some other policy to determine which MCPTT groups are preferred.\n15)\tif the candidate expiration interval is zero, constructs the candidate list of the MCPTT group information entries as follows:\na)\tfor each MCPTT group ID which has an entry in the served list of the MCPTT group information entries:\ni)\tshall copy the MCPTT group entry of the served list of the MCPTT group information into a new MCPTT group information entry of the candidate list of the MCPTT group information entries;\nii)\tshall set the affiliation status of the new MCPTT group information entry to the \"de-affiliating\" state; and\niii)\tshall set the expiration time of the new MCPTT group information entry to the current time increased with twice the value of timer F;\n16)\tshall replace the list of the MCPTT group information entries stored in the served MCPTT client information entry with the candidate list of the MCPTT group information entries;\n17)\tshall perform the procedures specified in clause 9.2.2.2.6 for the served MCPTT ID and each MCPTT group ID:\na)\twhich does not have an MCPTT group information entry in the served list of the MCPTT group information entries and which has an MCPTT group information entry in the candidate list of the MCPTT group information entries with the affiliation status set to the \"affiliating\" state;\nb)\twhich has an MCPTT group information entry in the served list of the MCPTT group information entries with the expiration time already expired, and which has an MCPTT group information entry in the candidate list of the MCPTT group information entries with the affiliation status set to the \"affiliating\" state;\nc)\twhich has an MCPTT group information entry in the served list of the MCPTT group information entries with the affiliation status set to the \"deaffiliating\" state or the \"deaffiliated\" state and with the expiration time not expired yet, and which has an MCPTT group information entry in the candidate list of the MCPTT group information entries with the affiliation status set to the \"affiliating\" state; or\nd)\twhich has an MCPTT group information entry in the served list of the MCPTT group information entries with the affiliation status set to the \"affiliated\" state and with the expiration time not expired yet, and which has an MCPTT group information entry in the candidate list of the MCPTT group information entries with the affiliation status set to the \"de-affiliating\" state;\n18)\tshall identify the handled p-id in the <p-id> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\n19)\tshall perform the procedures specified in clause 9.2.2.2.5 for the served MCPTT ID.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains either the public service identity identifying the originating participating MCPTT function serving the MCPTT user, or the public service identity identifying the terminating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type;\nthe MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tif the Request-URI of the SIP SUBSCRIBE request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tif the Request-URI of the SIP SUBSCRIBE request contains the public service identity identifying the terminating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n4)\tif the originating MCPTT ID is different than the served MCPTT ID and the originating MCPTT ID is not authorized to modify affiliation status of the served MCPTT ID, shall send a 403 (Forbidden) response and shall not continue with the rest of the steps; and\n5)\tshall generate a 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify the subscriber about changes of the information of the served MCPTT ID, as described in clause 9.2.2.2.5.\nIn order to notify the subscriber about changes of the served MCPTT ID, the MCPTT server:\n1)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n2)\tshall consider the list of the MCPTT client information entries of the served MCPTT user information entry as the served list of the MCPTT client information entries;\n3)\tshall generate an application/pidf+xml MIME body indicating per-user affiliation information according to clause 9.3.1 and the served list of the MCPTT client information entries with the following clarifications:\na)\tthe MCPTT server shall not include information from an MCPTT group information entry with the expiration time already expired;\nb)\tthe MCPTT server shall not include information from an MCPTT group information entry with the affiliation status set to the \"deaffiliated\" state;\nc)\tif the SIP SUBSCRIBE request creating the subscription of this notification contains an application/simple-filter+xml MIME body indicating per-client restrictions of presence event package notification information according to clause 9.3.2, the MCPTT server shall restrict the application/pidf+xml MIME body according to the application/simple-filter+xml MIME body; and\nd)\tif this procedures is invoked by procedure in clause 9.2.2.2.3 where the handled p-id value was identified, the MCPTT server shall set the <p-id> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request to the handled p-id value; and\n4)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9.2.2.2.4. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-user affiliation information.\nNOTE 1:\tUsage of one SIP PUBLISH request to carry information about change of affiliation state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nIn order:\n-\tto send an affiliation request of a served MCPTT ID to a handled MCPTT group ID;\n-\tto send an de-affiliation request of a served MCPTT ID from a handled MCPTT group ID; or\n-\tto send an affiliation request of a served MCPTT ID to a handled MCPTT group ID due to near expiration of the previously published information;\nthe MCPTT server shall generate a SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51]. In the SIP PUBLISH request, the MCPTT server:\n1)\tshall set the Request-URI to the public service identity of the controlling MCPTT function associated with the handled MCPTT group ID;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the handled MCPTT group ID or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\na)\tshall include the <mcptt-request-uri> element set to the handled MCPTT group ID; and\nb)\tshall include the <mcptt-calling-user-id> element set to the served MCPTT ID;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tif sending an affiliation request, shall set the Expires header field according to IETF RFC 3903 [37], to 4294967295;\nNOTE 7:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif sending an de-affiliation request, shall set the Expires header field according to IETF RFC 3903 [37], to zero;\n6)\tshall include an P-Asserted-Identity header field set to the public service identity of the MCPTT server according to 3GPP TS 24.229 [4];\n7)\tshall set the current p-id to a globally unique value;\n8)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n9)\tfor each MCPTT group information entry such that:\na)\tthe MCPTT group information entry has the \"affiliating\" affiliation status, the MCPTT group ID set to the handled MCPTT group ID, the expiration time has not expired yet and the affiliating p-id is not set;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry; and\nc)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry;\nshall set the affiliating p-id of the MCPTT group information entry to the current p-id; and\n10)\tshall include an application/pidf+xml MIME body indicating per-group affiliation information constructed according to clause 9.3.1.2. The MCPTT server shall indicate all served MCPTT client IDs, such that:\na)\tthe affiliation status is set to \"affiliating\" or \"affiliated\", and the expiration time has not expired yet in an MCPTT group information entry with the MCPTT group ID set to the handled MCPTT group;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry;\nc)\tthe MCPTT client information entry has the MCPTT client ID set to the served MCPTT client ID; and\nd)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry.\nThe MCPTT server shall set the <p-id> child element of the <presence> root element to the current p-id.\nThe MCPTT server shall not include the \"expires\" attribute in the <affiliation> element.\nThe MCPTT server shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nIf timer F expires for the SIP PUBLISH request sent for a (de)affiliation request of served MCPTT ID to the MCPTT group ID or upon receiving a SIP 3xx, 4xx, 5xx or 6xx response to the SIP PUBLISH request, the MCPTT server:\n1)\tshall remove each MCPTT group ID entry such that:\na)\tthe MCPTT group information entry has the MCPTT group ID set to the handled MCPTT group ID;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry; and\nc)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry.\nNOTE 1:\tUsage of one SIP SUBSCRIBE request to subscribe for notification about change of affiliation state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nIn order to discover whether a served MCPTT user was successfully affiliated to a handled MCPTT group in the MCPTT server owning the handled MCPTT group, the MCPTT server shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT server:\n1)\tshall set the Request-URI to the public service identity of the controlling MCPTT function associated with the handled MCPTT group ID;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the handled MCPTT group ID or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\na)\tshall include the <mcptt-request-uri> element set to the handled MCPTT group ID; and\nb)\tshall include the <mcptt-calling-user-id> element set to the served MCPTT ID;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tif the MCPTT server wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 7:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT server wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n6)\tshall include an Accept header field containing the application/pidf+xml MIME type; and\n7)\tshall include an application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information according to clause 9.3.2, indicating the served MCPTT ID.\nIn order to re-subscribe or de-subscribe, the MCPTT server shall generate an in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT server:\n1)\tif the MCPTT server wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 8:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n2)\tif the MCPTT server wants to de-subscribe, shall set the Expires header field according to IETF RFC 6665 [26], to zero; and\n3)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nUpon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-group affiliation information constructed according to clause 9.3.1, then the MCPTT server:\n1)\tfor each served MCPTT ID and served MCPTT client ID such that the application/pidf+xml MIME body of SIP NOTIFY request contains:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID;\nc)\tan <affiliation> child element of the <status> element of the <tuple> element;\nd)\tthe \"client\" attribute of the <affiliation> element indicating the served MCPTT client ID; and\nd)\tthe \"expires\" attribute of the <affiliation> element indicating expiration of affiliation;\nperform the following:\na)\tif an MCPTT group information entry exists such that:\ni)\tthe MCPTT group information entry has the \"affiliating\" affiliation status, the MCPTT group ID set to the handled MCPTT group ID, and the expiration time has not expired yet;\nii)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry with the MCPTT client ID set to the served MCPTT client ID;\niii)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of a served MCPTT user information entry with the MCPTT ID set to the served MCPTT ID; and\niv)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nshall set the affiliation status of the MCPTT group information entry to \"affiliated\"; and\nshall set the next publishing time of the MCPTT group information entry to the current time and half of the time between the current time and the expiration of affiliation; and\n2) for each MCPTT group information entry such that:\na)\tthe MCPTT group information entry has the \"affiliated\" affiliation status or the \"deaffiliating\" affiliation status, the MCPTT group ID set to the handled MCPTT group ID, and the expiration time has not expired yet;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry with the MCPTT client ID set to a served MCPTT client ID;\nc)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry with the MCPTT ID set to a served MCPTT ID; and\nd)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nfor which the application/pidf+xml MIME body of SIP NOTIFY request does not contain:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID;\nc)\tan <affiliation> child element of the <status> child element of the <tuple> element; and\nd)\tthe \"client\" attribute of the <affiliation> element indicating the served MCPTT client ID.\nperform the following:\na)\tshall set the affiliation status of the MCPTT group information entry to \"deaffiliated\"; and\nb)\tshall set the expiration time of the MCPTT group information entry to the current time; and\n3)\tif a <p-id> element is included in the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request, then for each MCPTT group information entry such that:\na)\tthe MCPTT group information entry has the \"affiliating\" affiliation status, the MCPTT group ID set to the handled MCPTT group ID, the expiration time has not expired yet and with the affiliating p-id set to the value of the <p-id> element;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry with the MCPTT client ID set to a served MCPTT client ID;\nc)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry with the MCPTT ID set to a served MCPTT ID; and\nd)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nfor which the application/pidf+xml MIME body of SIP NOTIFY request does not contain:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID;\nc)\tan <affiliation> child element of the <status> child element of the <tuple> element; and\nd)\tthe \"client\" attribute of the <affiliation> element indicating the served MCPTT client ID;\nperform the following:\na)\tshall set the affiliation status of the MCPTT group information entry to \"deaffiliated\"; and\nb)\tshall set the expiration time of the MCPTT group information entry to the current time.\nUpon receiving a SIP MESSAGE request such that:\n1)\tRequest-URI of the SIP MESSAGE request contains the public service identity identifying the terminating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe SIP MESSAGE request contains an application/vnd.3gpp.mcptt-affiliation-command+xml MIME body;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request;\n2)\tshall identify the originating MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request;\n3)\tif the originating MCPTT ID is not authorized to send an affiliation status change request in negotiated mode to the served MCPTT ID, shall send a 403 (Forbidden) response and shall not continue with the rest of the steps;\n4)\tshall set the Request-URI of the SIP MESSAGE request to the public user identity bound to the served MCPTT ID in the MCPTT server; and\n5)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nbefore forwarding the SIP MESSAGE request further.\nUpon receiving a SIP PUBLISH request such that:\n1)\tRequest-URI of the SIP PUBLISH request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID not served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP PUBLISH request contains the \"presence\" event type; and\n5)\tSIP PUBLISH request contains an application/pidf+xml MIME body indicating per-user affiliation information according to clause 9.3.1;\nthen the MCPTT server:\n1)\tshall identify the target MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body of the SIP PUBLISH request;\n2)\tshall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP PUBLISH request;\n3)\tshall generate a SIP PUBLISH request from the received SIP PUBLISH request. In the generated SIP PUBLISH request, the MCPTT server:\na)\tshall set the Request-URI to the public service identity identifying the terminating participating MCPTT function serving the target MCPTT ID;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the originating participating MCPTT function determines the public service identity of the terminating participating MCPTT function serving the target MCPTT ID or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nb)\tshall include a P-Asserted-Identity header field containing the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\nA)\tshall include the <mcptt-request-uri> element set to the target MCPTT ID; and\nB)\tshall include the <mcptt-calling-user-id> element set to the originating MCPTT ID; and\nd)\tshall include other signalling elements from the received SIP PUBLISH request; and\n4)\tshall send the generated SIP PUBLISH request according to 3GPP TS 24.229 [4].\nThe MCPTT server shall forward received SIP responses to the SIP PUBLISH request.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP SUBCRIBE request contains an application/vnd.3gpp.mcptt-info MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID not served by MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type;\nthen the MCPTT server:\n1)\tshall identify the target MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tshall generate a SIP SUBSCRIBE request from the received SIP SUBSCRIBE request. In the generated SIP SUBSCRIBE request, the MCPTT server:\na)\tshall set the Request-URI to the public service identity identifying the terminating participating MCPTT function serving the target MCPTT ID;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the originating participating MCPTT function determines the public service identity of the terminating participating MCPTT function serving the target MCPTT ID or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nb)\tshall include a P-Asserted-Identity header field containing the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\nA)\tshall include the <mcptt-request-uri> element set to the target MCPTT ID; and\nB)\tshall include the <mcptt-calling-user-id> element set to the originating MCPTT ID; and\nd)\tshall include other signalling elements from the received SIP SUBSCRIBE request; and\n4)\tshall send the generated SIP SUBSCRIBE request according to 3GPP TS 24.229 [4].\nThe MCPTT server shall forward any received SIP responses to the SIP SUBSCRIBE request, any received SIP NOTIFY request and any received SIP responses to the SIP NOTIFY request.\nThis clause is referenced from other procedures.\nIf the participating MCPTT function needs to determine the affiliation status of an MCPTT user to an MCPTT group, the participating function:\n1)\tshall find the user information entry in the list of MCPTT user information entries described in clause 9.2.2.2.2 such that the MCPTT ID of the MCPTT user information entry is equal to the MCPTT ID of the originator of the received SIP request;\na)\tif the applicable MCPTT group information entry cannot be found, then the participating MCPTT function shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the skip the rest of the steps;\n2)\tshall find the MCPTT client information entry in the list of MCPTT client information entries of MCPTT user information entry found in step 1) in which the MCPTT client id matches the value of the <mcptt-client-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP request;\na)\tif the applicable MCPTT client information entry cannot be found, then the participating MCPTT function shall determine that the MCPTT user is not affiliated to the MCPTT group at the MCPTT client and the skip the rest of the steps;\n3)\tshall find the MCPTT group information entry in the list of MCPTT group information entries of MCPTT client information entry found in step 2 such that the MCPTT group identity matches the value of the identity of the targeted MCPTT group;\na)\tif the applicable MCPTT group information entry was found in step 3) and the affiliation status of the MCPTT group information entry is \"affiliating\" or \"affiliated\", shall determine that the MCPTT user at the MCPTT client to be affiliated to the targeted MCPTT group and skip the rest of the steps;\nb)\tif the applicable MCPTT group information entry was found in step 3) and the affiliation status of the MCPTT group information entry is \"deaffiliating\" or \"deaffiliated\", shall determine that the MCPTT user at the MCPTT client to not be affiliated to the targeted MCPTT group and skip the rest of the steps; or\nc)\tif the applicable MCPTT group information entry was not found in step 3), shall determine that the MCPTT user at the MCPTT client is not affiliated to the targeted MCPTT group.\nThis clause is referenced from other procedures.\nUpon receiving a SIP request that requires implicit affiliation of the sending MCPTT client to an MCPTT group, the participating MCPTT function:\n1)\tshall determine the served MCPTT client ID from the <mcptt-client-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP request;\n2)\tshall determine the MCPTT group ID from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP request;\n3)\tshall determine the served MCPTT ID by using the public user identity in the P-Asserted-Identity header field of the SIP request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n4)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n5)\tshall consider an MCPTT client information entry such that:\na)\tthe MCPTT client information entry is in the list of MCPTT client information entries of the served MCPTT user information entry; and\nb)\tthe MCPTT client ID of the MCPTT client information entry is equal to the served MCPTT client ID;\nas the served MCPTT client information entry;\n6)\tshall consider a copy of the list of the MCPTT group information entries of the served MCPTT client information entry as the served list of the MCPTT group information entries;\n7)\tshall construct the candidate list of the MCPTT group information entries as follows:\na)\tfor each MCPTT group ID which has an MCPTT group information entry in the served list of the MCPTT group information entries shall copy the MCPTT group information entry into a new MCPTT group information entry of the candidate list of the MCPTT group information entries; and\nb)\tif the determined MCPTT group ID does not have an MCPTT group information entry in the served list of the MCPTT group information entries or has an MCPTT group information entry in the served list of the MCPTT group information entries, such that the expiration time of the MCPTT group information entry has already expired:\ni)\tshall add a new MCPTT group information entry in the candidate list of the MCPTT group information list for the determined MCPTT group ID;\nii)\tshall set the affiliation status of the new MCPTT group information entry to the \"affiliating\" state; and\niii)\tshall set the expiration time of the new MCPTT group information entry to the current time increased with the candidate expiration interval;\n8)\tdetermine the candidate number of MCPTT group IDs as the number of different MCPTT group IDs which have an MCPTT group information entry:\na)\tin the candidate list of the MCPTT group information entries; or\nb)\tin the list of the MCPTT group information entries of an MCPTT client information entry such that:\ni)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry; and\nii)\tthe MCPTT client ID of the MCPTT client information entry is not equal to the served MCPTT client ID;\nwith the affiliation status set to the \"affiliating\" state or the \"affiliated\" state and with the expiration time which has not expired yet; and\n9)\tif the candidate number of MCPTT group IDs is bigger than the N2 value of the served MCPTT ID (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall based on MCPTT service provider policy reduce the candidate MCPTT group IDs to that equal to N2;\nNOTE 2:\tThe MCPTT service provider policy can determine to remove an MCPTT group ID based on the importance or priority of other MCPTT groups, received SIP requests containing an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1 or other policy to determine which MCPTT groups are preferred.\n10)\tif the determined MCPTT group ID cannot be added to the the candidate list of the MCPTT group information entries due to exceeding the MCPTT user's N2 limit (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile of the served MCPTT ID), shall discard the candidate list of the MCPTT group information entries and skip the remaining steps of the current procedure; and\n11)\tshall replace the list of the MCPTT group information entries stored in the served MCPTT client information entry with the candidate list of the MCPTT group information entries.\nThis clause is referenced from other procedures.\nIf the participating MCPTT function has received a SIP 2xx response from the controlling MCPTT function to a SIP request that had triggered performing the procedures of clause 9.2.2.2.12, the participating MCPTT function:\n1)\tshall set the affiliation status of the MCPTT group information entry added to the candidate list of the MCPTT group information entries by the procedures of clause 9.2.2.2.12 to \"affiliated\"; and\n2)\tshall perform the procedures specified in clause 9.2.2.2.5 for the served MCPTT ID.\nThis clause is referenced from other procedures.\nIf the participating MCPTT function determines that a received SIP request that had triggered performing the procedures of clause 9.2.2.2.12 needs to be rejected or if the participating MCPTT function receives a SIP 4xx, 5xx or 6xx response from the controlling MCPTT function for the received SIP request, the participating MCPTT function:\n1)\tshall remove the MCPTT group ID entry added by the procedures of clause 9.2.2.2.12 such that:\na)\tthe MCPTT group information entry has the MCPTT group ID set to the MCPTT group ID of the MCPTT group targeted by the received SIP request;\nb)\tthe MCPTT group information entry is in the list of the MCPTT group information entries of an MCPTT client information entry containing the MCPTT client ID included in the received SIP request; and\nc)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the MCPTT user information entry containing the MCPTT ID of the sender of the received SIP request.\nThis clause is referenced from other procedures.\nIf the participating MCPTT function has successfully performed service authorization for the MCPTT ID identified in the service authorisation procedure as described in 3GPP TS 33.180 [78], the participating MCPTT function:\n1)\tshall identify the MCPTT ID included in the SIP request received for service authorisation procedure as the served MCPTT ID;\n2)\tshall identify the MCPTT client ID from the <mcptt-client-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in the SIP request received for service authorisation as the served MCPTT client ID;\n3)\tshall download the MCPTT user profile from the MCPTT user database as defined in 3GPP TS 29.283 [73] if not already stored at the participating MCPTT function;\n4)\tif no <ImplicitAffiliations> element is contained in the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) for the served MCPTT ID or the <ImplicitAffiliations> element contains no <entry> elements containing an MCPTT group ID, shall skip the remaining steps;\n5)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n6)\tshall consider an MCPTT client information entry such that:\na)\tthe MCPTT client information entry is in the list of MCPTT client information entries of the served MCPTT user information entry; and\nb)\tthe MCPTT client ID of the MCPTT client information entry is equal to the served MCPTT client ID;\nas the served MCPTT client information entry;\n7)\tshall consider a copy of the list of the MCPTT group information entries of the served MCPTT client information entry as the served list of the MCPTT group information entries;\n8)\tshall construct the candidate list of the MCPTT group information entries as follows:\na)\tfor each MCPTT group ID which has an MCPTT group information entry in the served list of the MCPTT group information entries shall copy the MCPTT group information entry into a new MCPTT group information entry of the candidate list of the MCPTT group information entries;\nb)\tfor each MCPTT group ID contained in an <entry> element of the <ImplicitAffiliations> element in the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) for the served MCPTT ID that does not have an MCPTT group information entry in the served list of the MCPTT group information entries or has an MCPTT group information entry in the served list of the MCPTT group information entries such that the expiration time of the MCPTT group information entry has already expired:\ni)\tshall add a new MCPTT group information entry in the candidate list of the MCPTT group information list for the MCPTT group ID;\nii)\tshall set the affiliation status of the new MCPTT group information entry to the \"affiliating\" state; and\niii)\tshall set the expiration time of the new MCPTT group information entry to the current time increased with the candidate expiration interval;\nc)\tif in step b) above, no new MCPTT group information entries were added to the candidate list of the MCPTT group information list for the MCPTT group ID:\ni)\tshall discard the candidate list; and\nii)\tshall skip the remaining steps;\n9)\tdetermine the candidate number of MCPTT group IDs as the number of different MCPTT group IDs which have an MCPTT group information entry:\na)\tin the candidate list of the MCPTT group information entries; or\nb)\tin the list of the MCPTT group information entries of an MCPTT client information entry such that:\ni)\tthe MCPTT client information entry is in the list of the MCPTT client information entries of the served MCPTT user information entry; and\nii)\tthe MCPTT client ID of the MCPTT client information entry is not equal to the served MCPTT client ID;\nwith the affiliation status set to the \"affiliating\" state or the \"affiliated\" state and with the expiration time which has not expired yet; and\nc)\tif the candidate number of MCPTT group IDs is bigger than the N2 value of the served MCPTT ID (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall based on MCPTT service provider policy reduce the candidate MCPTT group IDs to that equal to N2;\nNOTE 1:\tThe MCPTT service provider policy can determine to remove an MCPTT group ID based on the importance or priority of other MCPTT groups, received SIP requests containing an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1 or other policy to determine which MCPTT groups are preferred.\n10)\tshall replace the list of the MCPTT group information entries stored in the served MCPTT client information entry with the candidate list of the MCPTT group information entries; and\n11)\tfor each MCPTT group ID contained in an <entry> element of the <ImplicitAffiliations> element in the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) for the served MCPTT ID and which has an MCPTT group information entry in the candidate list of the MCPTT group information entries with an affiliation status of \"affiliating\", shall perform the procedures specified in clause 9.2.2.2.6 for the served MCPTT ID and each MCPTT group ID.\nNOTE 2:\tTo learn of the MCPTT groups successfully affiliated to, the MCPTT client can subscribe to that information by the procedures specified in clause 9.2.1.3.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info MIME body containing the<mcptt-request-uri> element which identifies an MCPTT group ID not served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type;\nthen the MCPTT server:\n1)\tshall identify the target MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tshall if the originating MCPTT ID is not authorized for this subscription reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n4)\tshall generate a SIP SUBSCRIBE request from the received SIP SUBSCRIBE request. In the generated SIP SUBSCRIBE request, the MCPTT server:\na)\tshall set the Request-URI to the public service identity identifying the controlling MCPTT function serving the target MCPTT group ID;\nNOTE 1:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function serving he target MCPTT group ID or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nb)\tshall include a P-Asserted-Identity header field containing the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\nA)\tshall include the <mcptt-request-uri> element set to the target MCPTT group ID; and\nB)\tshall include the <mcptt-calling-user-id> element set to the originating MCPTT ID; and\nd)\tshall include other signalling elements from the received SIP SUBSCRIBE request; and\n4)\tshall send the generated SIP SUBSCRIBE request according to 3GPP TS 24.229 [4].\nThe MCPTT server shall forward any received SIP responses to the SIP SUBSCRIBE request, any received SIP NOTIFY requests and any received SIP responses to the SIP NOTIFY request.\nThe procedures of MCPTT server owning the MCPTT group consist of:\n-\treceiving group affiliation status change procedure;\n-\treceiving subscription to affiliation status procedure;\n-\tsending notification of change of affiliation status procedure;\n-\taffiliation eligibility check procedure;\n-\timplicit affiliation eligibility check procedure;\n-\taffiliation status change by implicit affiliation procedure;\n-\treceiving subscription to group dynamic data procedure and;\n-\tsending notification of change of group dynamic data procedure.\nNOTE:\tUsage of CSC-3 part of MCPTT group affiliation procedure and of CSC-3 part of MCPTT group de-affiliation procedure is not specified in this version of the specification.\nThe MCPTT server shall maintain a list of MCPTT group information entries.\nIn each MCPTT group information entry, the MCPTT server shall maintain:\n1)\tan MCPTT group ID. This field uniquely identifies the MCPTT group information entry in the list of the MCPTT group information entries;\n2)\tthe status of the MCPTT group as defined in clause 10.1.5.5 of 3GPP TS 23.280 [82], along with the MCPTT ID of the user that last changed the status; and\n3)\ta list of MCPTT user information entries.\nIn each MCPTT user information entry, the MCPTT server shall maintain:\n1)\tan MCPTT ID. This field uniquely identifies the MCPTT user information entry in the list of the MCPTT user information entries;\n2)\ta list of MCPTT client information entries; and\n3)\tan expiration time.\nIn each MCPTT client information entry, the MCPTT server shall maintain:\n1)\tan MCPTT client ID. This field uniquely identifies the MCPTT client information entry in the list of the MCPTT client information entries.\nUpon receiving a SIP PUBLISH request such that:\n1)\tRequest-URI of the SIP PUBLISH request contains the public service identity of the controlling MCPTT function associated with the served MCPTT group;\n2)\tthe SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the <mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP PUBLISH request contains the \"presence\" event type; and\n5)\tSIP PUBLISH request contains an application/pidf+xml MIME body indicating per-group affiliation information constructed according to clause 9.3.1.2;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n3)\tif the Expires header field of the SIP PUBLISH request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n4)\tif an MCPTT group for the served MCPTT group ID does not exist in the group management server according to 3GPP TS 24.481 [31], shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n5)\tif the handled MCPTT ID is not a member of the MCPTT group identified by the served MCPTT group ID, shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n6)\tshall respond with SIP 200 (OK) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK) response, the MCPTT server:\na)\tshall set the Expires header field according to IETF RFC 3903 [37], to the selected expiration time;\n7)\tif the \"entity\" attribute of the <presence> element of the application/pidf+xml MIME body of the SIP PUBLISH request is different than the served MCPTT group ID, shall not continue with the rest of the steps;\n8)\tif the handled MCPTT ID is different from the MCPTT ID in the \"id\" attribute of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request, shall not continue with the rest of the steps;\n9)\tshall consider an MCPTT group information entry such that:\na)\tthe MCPTT group information entry is in the list of MCPTT group information entries described in clause 9.2.2.3.2; and\nb)\tthe MCPTT group ID of the MCPTT group information entry is equal to the served MCPTT group ID;\nas the served MCPTT group information entry;\n10)\tif the selected expiration time is zero:\na0)\tif the MCPTT group identity configuration for the served MCPTT group ID found in the group management server according to 3GPP TS 24.481 [31] contains:\ni)\ta <forbidden-deaffiliation-FAs> element and the handled MCPTT ID has activated a functional alias that matches with one of the <entry> elements of the <forbidden-deaffiliation-FAs> element; or\nii)\ta <forbidden-deaffiliation-if-last-FAs> element and the handled MCPTT ID has activated a functional alias that matches with one of the <entry> elements of the <forbidden-deaffiliation-if-last-FAs> element and corresponds to the last user that has bound the functional alias to the served MCPTT group ID;\nshall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\nNOTE:\tThe MCPTT server learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.2.2.7.\na)\tshall remove the MCPTT user information entry such that:\ni)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served MCPTT group information entry; and\nii)\tthe MCPTT user information entry has the MCPTT ID set to the served MCPTT ID;\n11)\tif the selected expiration time is not zero:\na)\tshall consider an MCPTT user information entry such that:\ni)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served MCPTT group information entry; and\nii)\tthe MCPTT ID of the MCPTT user information entry is equal to the handled MCPTT ID;\nas the served MCPTT user information entry;\nb)\tif the MCPTT user information entry does not exist:\ni)\tshall insert an MCPTT user information entry with the MCPTT ID set to the handled MCPTT ID into the list of the MCPTT user information entries of the served MCPTT group information entry; and\nii)\tshall consider the inserted MCPTT user information entry as the served MCPTT user information entry; and\nc)\tshall set the following information in the served MCPTT user information entry:\ni)\tset the MCPTT client ID list according to the \"client\" attributes of the <affiliation> elements of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\nii)\tset the expiration time according to the selected expiration time;\n12)\tshall identify the handled p-id in the <p-id> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\n13)\tshall perform the procedures specified in clause 9.2.2.3.5 for the served MCPTT group ID.\nNOTE:\tUsage of one SIP SUBSCRIBE request to subscribe for notification about change of affiliation state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity of the controlling MCPTT function associated with the served MCPTT group;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type; and\n5) the SIP SUBSCRIBE request contains an application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information according to clause 9.3.2 indicating the same MCPTT ID as in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n3)\tif the Expires header field of the SIP SUBSCRIBE request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n4)\tif an MCPTT group for the served MCPTT group ID does not exist in the group management server according to 3GPP TS 24.481 [31], shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n5)\tif the handled MCPTT ID is not a member of the MCPTT group identified by the served MCPTT group ID, shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps; and\n6)\tshall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify subscriber about changes of the information of the served MCPTT ID, as described in clause 9.2.2.3.5.\nIn order to notify the subscriber identified by the handled MCPTT ID about changes of the affiliation status of the served MCPTT group ID, the MCPTT server:\n1)\tshall consider an MCPTT group information entry such that:\na)\tthe MCPTT group information entry is in the list of MCPTT group information entries described in clause 9.2.2.3.2; and\nb)\tthe MCPTT group ID of the MCPTT group information entry is equal to the served MCPTT group ID;\n2)\tshall consider an MCPTT user information entry such:\na)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served MCPTT group information entry; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the handled MCPTT ID;\nas the served MCPTT user information entry;\n3)\tshall generate an application/pidf+xml MIME body indicating per-group affiliation information according to clause 9.3.1 and the served list of the served MCPTT user information entry of the MCPTT group information entry with following clarifications:\na)\tthe MCPTT server shall include the \"expires\" attribute in the <affiliation> element; and\nb)\tif this procedures is invoked by procedure in clause 9.2.2.3.3 where the handled p-id was identified, the MCPTT server shall set the <p-id> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request to the handled p-id value; and\n4)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9.2.2.3.4. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-group affiliation information.\nThis clause is referenced from other procedures.\nUpon receiving a SIP request for an MCPTT group that the MCPTT user is not currently affiliated to and that requires the controlling MCPTT function to check on the eligibility of the MCPTT user to be implicitly affiliated to the MCPTT group, the controlling MCPTT function:\n1)\tshall perform the procedures of clause 9.2.2.3.8 to determine if the MCPTT user is eligible to be affiliated to the MCPTT group; and\n2)\tif the MCPTT user was determined eligible to be affiliated to the MCPTT group by the procedures of clause 9.2.2.3.8, shall consider the MCPTT user to be eligible for implicit affiliation to the MCPTT group.\nThis clause is referenced from other procedures.\nUpon receiving a SIP request for an MCPTT group that the MCPTT user is not currently affiliated to and that requires the controlling MCPTT function to perform an implicit affiliation to, the controlling MCPTT function:\n1)\tshall identify the served MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;\n3)\tshall consider an MCPTT group information entry such that:\na)\tthe MCPTT group information entry is in the list of MCPTT group information entries described in clause 9.2.2.3.2; and\nb)\tthe MCPTT group ID of the MCPTT group information entry is equal to the served MCPTT group ID;\nas the served MCPTT group information entry;\n4)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served MCPTT group information entry; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the handled MCPTT ID;\nas the served MCPTT user information entry;\nc)\tif the MCPTT user information entry does not exist:\ni)\tshall insert an MCPTT user information entry with the MCPTT ID set to the handled MCPTT ID into the list of the MCPTT user information entries of the served MCPTT group information entry; and\nii)\tshall consider the inserted MCPTT user information entry as the served MCPTT user information entry; and\nd)\tshall make the following modifications in the served MCPTT user information entry:\ni)\tadd the MCPTT client ID derived from the received SIP request to the MCPTT client ID list if not already present; and\nii)\tset the expiration time as determined by local policy;\n5)\tshall perform the procedures specified in clause 9.2.2.3.5 for the served MCPTT group ID.\nThis clause is referenced from other procedures.\nUpon receiving a SIP request for an MCPTT group that the MCPTT user is not currently affiliated to and that requires the controlling MCPTT function to check on the eligibility of the MCPTT user to be affiliated to the MCPTT group, the controlling MCPTT function shall:\n1)\tshall identify the served MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP request;\n3)\tif an MCPTT group for the served MCPTT group ID does not exist in the group management server according to 3GPP TS 24.481 [31], shall consider the MCPTT user to be ineligible for affiliation and skip the rest of the steps;\n4)\tif the handled MCPTT ID is not a member of the MCPTT group identified by the served MCPTT group ID, shall consider the MCPTT user to be ineligible for affiliation and skip the rest of the steps;\n5)\tif there is no MCPTT group information entry in the list of MCPTT group information entries described in clause 9.2.2.3.2 with an MCPTT group identity matching the served MCPTT group ID, then shall consider the MCPTT user to be ineligible for affiliation and skip the rest of the steps; or\n6)\tshall consider the MCPTT user to be eligible for affiliation.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity of the controlling MCPTT function associated with the served MCPTT group;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type; and\n5)\tthe SIP SUBSCRIBE request contains an application/simple-filter+xml MIME body indicating per-group dynamic data of presence event package notification information according to clause 9.3.2 indicating the same MCPTT group ID as in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT group ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n3)\tif the Expires header field of the SIP SUBSCRIBE request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n4)\tif an MCPTT group for the served MCPTT group ID does not exist in the group management server according to 3GPP TS 24.481 [31], shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n5)\tif the handled MCPTT ID is not authorized to subscribe to group dynamic data of the MCPTT group identified by the served MCPTT group ID, shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps; and\n6)\tshall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify subscriber about changes of the information of the served MCPTT ID, as described in clause 9.2.2.3.10.\nIn order to notify the subscriber identified by the handled MCPTT ID about changes of the per-group dynamic data of the served MCPTT group ID, the MCPTT server:\n1)\tshall consider an MCPTT group information entry such that:\na)\tthe MCPTT group information entry is in the list of MCPTT group information entries described in clause 9.2.2.3.2; and\nb)\tthe MCPTT group ID of the MCPTT group information entry is equal to the served MCPTT group ID;\n2)\tshall generate an application/pidf+xml MIME body indicating per-group dynamic data according to clause 9.3.1 with the following clarifications:\na)\tthe MCPTT server shall include the \"expires\" attribute in the <affiliation> element; and\n3)\tshall send a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9.2.2.3.8. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-group dynamic data.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "9.3\tCoding",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9.3.1\tExtension of application/pidf+xml MIME type",
                            "text_content": "The clauses of the parent clause describe an extension of the application/pidf+xml MIME body specified in IETF RFC 3863 [52]. The extension is used to indicate:\n-\tper-user affiliation information;\n-\tper-group affiliation information; and\n-\tper-group dynamic data information.\nThe application/pidf+xml MIME body indicating per-user affiliation information is constructed according to IETF RFC 3863 [52] and:\n1)\tcontains a <presence> root element according to IETF RFC 3863 [52];\n2)\tcontains an \"entity\" attribute of the <presence> element set to the MCPTT ID of the MCPTT user;\n3)\tcontains one <tuple> child element according to IETF RFC 3863 [52] per each MCPTT client of the <presence> element;\n4)\tcan contain a <p-id> child element defined in the XML schema defined in table 9.3.1.2-1, of the <presence> element set to an identifier of a SIP PUBLISH request;\n5)\tcontains an \"id\" attribute of the <tuple> element set to the MCPTT client ID;\n6)\tcontains one <status> child element of each <tuple> element;\n7)\tcontains one <affiliation> child element defined in the XML schema defined in table 9.3.1.2-1, of the <status> element, for each MCPTT group in which the MCPTT user is interested at the MCPTT client;\n8)\tcontains a \"group\" attribute of each <affiliation> element set to the MCPTT group ID of the MCPTT group in which the MCPTT user is interested at the MCPTT client;\n9)\tcan contain a \"status\" attribute of each <affiliation> element indicating the affiliation status of the MCPTT user to MCPTT group at the MCPTT client; and\n10)\tcan contain an \"expires\" attribute of each <affiliation> element indicating expiration of affiliation of the MCPTT user to MCPTT group at the MCPTT client.\nThe application/pidf+xml MIME body indicating per-group affiliation information is constructed according to IETF RFC 3856 [51] and:\n1)\tcontains the <presence> root element according to IETF RFC 3863 [52];\n2)\tcontains an \"entity\" attribute of the <presence> element set to the MCPTT group ID of the MCPTT group;\n3)\tcontains one <tuple> child element according to IETF RFC 3863 [52] of the <presence> element;\n4)\tcan contain a <p-id> child element defined in the XML schema defined in table 9.3.1.2-1, of the <presence> element set to an identifier of a SIP PUBLISH request;\n5)\tcontains an \"id\" attribute of the <tuple> element set to the MCPTT ID of the MCPTT user;\n6)\tcontains one <status> child element of each <tuple> element;\n7)\tcontains one <affiliation> child element defined in the XML schema defined in table 9.3.1.2-1, of the <status> element, for each MCPTT client at which the MCPTT user is interested in the MCPTT group;\n8)\tcontains one \"client\" attribute defined in the XML schema defined in table 9.3.1.2-1, of the <affiliation> element set to the MCPTT client ID;\n9)\tcan contain an \"expires\" attribute defined in the XML schema defined in table 9.3.1.2-1, of the <affiliation> element indicating expiration of affiliation of the MCPTT user to MCPTT group at the MCPTT client; and\n10)\tcan contain one <functionalAlias> child element defined in the XML schema defined in table 9.3.1.2-1, of the <status> element, for each functional alias that the group member identified by the \"id\" attribute of the <tuple> element has activated with the \"functionalAliasID\" attribute set to the corresponding functional alias ID.\nThe application/pidf+xml MIME body indicating per-group dynamic data information is constructed according to IETF RFC 3856 [51] and:\n1)\tcontains the <presence> root element according to IETF RFC 3863 [52];\n2)\tcontains an \"entity\" attribute of the <presence> element set to the MCPTT group ID of the MCPTT group;\n3)\tcan contain a <groupStatus> child element defined in the XML schema, of the <presence> element set to an appropriate value specified in Table 9.3.1.2-3;\n4)\tcan contain a \"ModifiedBy\" attribute of the <groupStatus> element;\n5)\tcan contain an <additionalData> child element definied in the XML schema defined in table 9.3.1.2-1, of the <presence> element;\n6)\tcan contain a <groupBroadcastAlias> attribute defined in the XML schema defined in table 9.3.1.2-1 of the <additionalData> element;\n7)\tcan contain a <groupRegroupAlias> attribute defined in the XML schema defined in table 9.3.1.2-1 of the <additionalData> element;\n8)\tcan contain a <groupCallOnoing> attribute defined in the XML schema defined in table 9.3.1.2-1 of the <additionalData> element;\n9)\tcontains one <tuple> child element per affiliated MCPTT ID of the MCPTT group, according to IETF RFC 3863 [52] of the <presence> element;\n10)\tcontains an \"id\" attribute of the <tuple> element set to the MCPTT ID of the group member;\n11)\tcontains one <status> child element of each <tuple> element;\n12)\tcontains one <affiliation> child element defined in the XML schema defined in table 9.3.1.2-1, of the <status> element, for each MCPTT client at which the MCPTT user is interested in the MCPTT group;\n13)\tcontains one \"client\" attribute defined in the XML schema defined in table 9.3.1.2-1, of the <affiliation> element set to the MCPTT client ID;\n14)\tcan contain an \"expires\" attribute defined in the XML schema defined in table 9.3.1.2-1, of the <affiliation> element indicating expiration of affiliation of the MCPTT user to MCPTT group at the MCPTT client; and\n15)\tcan contain one <functionalAlias> child element defined in the XML schema defined in table 9.3.1.2-1, of the <status> element, for each functional alias that the group member identified by the \"id\" attribute of the <tuple> element has activated with the \"functionalAliasID\" attribute set to the corresponding functional alias ID.\nTable 9.3.1.2-1: XML schema with elements and attributes extending the application/pidf+xml MIME body\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:ns:mcpttPresInfo:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:mcpttPI10=\"urn:3gpp:ns:mcpttPresInfo:1.0\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n\n<!-- MCPTT specific child elements of presence element -->\n<xs:element name=\"p-id\" type=\"xs:string\"/>\n<xs:element name=\"groupStatus\" type=\"mcpttPI10:groupStatusType\"/>\n<xs:element name=\"additionalData\" type=\"mcpttPI10:additionalDataType\"/>\n\n<!-- MCPTT specific child elements of tuple element -->\n<xs:element name=\"affiliation\" type=\"mcpttPI10:affiliationType\"/>\n<xs:complexType name=\"affiliationType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"group\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"client\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"status\" type=\"mcpttPI10:statusType\" use=\"optional\"/>\n<xs:attribute name=\"expires\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:element name=\"functionalAlias\" type=\"mcpttPI10:functionalAliasType\"/>\n<xs:complexType name=\"functionalAliasType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"functionalAliasID\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"expires\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:simpleType name=\"statusType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"affiliating\"/>\n<xs:enumeration value=\"affiliated\"/>\n<xs:enumeration value=\"deaffiliating\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:complexType name=\"groupStatusType\">\n<xs:simpleContent>\n<xs:extension base=\"xs:string\">\n<xs:attribute name=\"ModifiedBy\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n\n<xs:complexType name=\"emptyType\"/>\n<xs:complexType name=\"additionalDataType\">\n<xs:complexContent>\n<xs:extension base=\"mcpttPI10:emptyType\">\n<xs:attribute name=\"groupBroadcastAlias\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"groupRegroupAlias\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"groupCallOngoing\" type=\"xs:boolean\" use=\"optional\"/>        <xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:extension>\n</xs:complexContent>\n</xs:complexType>\n\n</xs:schema>\nThe application/pidf+xml MIME body refers to namespaces using prefixes specified in table 9.3.1.2-2.\nTable 9.3.1.2-2: Assignment of prefixes to namespace names in the application/pidf+xml MIME body\n\nTable 9.3.1.2-3 ABNF syntax of values of the <groupStatus> element\nin-peril-value = %x69.6E.2D.70.65.72.69.6C ; \"in-peril\"\nemergency-value = %x65.6D.65.72.67.65.6E.63.79 ; \"emergency\"\n\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9.3.1.2-2: Assignment of prefixes to namespace names in the application/pidf+xml MIME body",
                                    "table number": 5,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9.3.2\tExtension of application/simple-filter+xml MIME type",
                            "text_content": "The clauses of the parent clause describe an extension of the application/simple-filter+xml MIME body specified in IETF RFC 4661 [63].\nThe extension is used to indicate per-client restrictions of presence event package notification information, per-user restrictions of presence event package notification information and per-group dynamic data restrictions of presence event package notification information.\nThe application/simple-filter+xml MIME body indicating per-client restrictions of presence event package notification information is constructed according to IETF RFC 4661 [63] and:\n1)\tcontains a <filter-set> root element according to IETF RFC 4661 [63];\n2)\tcontains a <ns-bindings> child element according to IETF RFC 4661 [63], of the <filter-set> element;\n3)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63] set to \"pidf\"; and\nB)\tcontains a \"urn\" attribute set to the \"urn:ietf:params:xml:ns:pidf\" value;\n4)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63], set to \"mcpttPI10\"; and\nB)\tcontains an \"urn\" attribute according to IETF RFC 4661 [63], set to the \"urn:3gpp:ns:mcpttPresInfo:1.0\" value;\n5)\tcontains a <filter> child element according to IETF RFC 4661 [63], of the <filter-set> element where the <filter> element;\nA)\tcontains an \"id\" attribute set to a value constructed according to IETF RFC 4661 [63];\nB)\tdoes not contain an \"uri\" attribute of the <filter> child element according to IETF RFC 4661 [63]; and\nC)\tdoes not contain an \"domain\" attribute according to IETF RFC 4661 [63];\n6)\tcontains a <what> child element according to IETF RFC 4661 [63], of the <filter> element; and\n7)\tcontains an <include> child element according to IETF RFC 4661 [63], of the <what> element where the <include> element;\nA)\tdoes not contain a \"type\" attribute according to IETF RFC 4661 [63]; and\nB)\tcontains the value, according to IETF RFC 4661 [63], set to concatenation of the '//pidf:presence/pidf:tuple[@id=\"' string, the MCPTT client ID, and the '\"]' string.\nThe application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information is constructed according to IETF RFC 4661 [63] and:\n1)\tcontains a <filter-set> root element according to IETF RFC 4661 [63];\n2)\tcontains a <ns-bindings> child element according to IETF RFC 4661 [63], of the <filter-set> element;\n3)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63] set to \"pidf\"; and\nB)\tcontains a \"urn\" attribute set to the \"urn:ietf:params:xml:ns:pidf\" value;\n4)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63], set to \"mcpttPI10\"; and\nB)\tcontains an \"urn\" attribute according to IETF RFC 4661 [63], set to the \"urn:3gpp:ns:mcpttPresInfo:1.0\" value;\n5)\tcontains a <filter> child element according to IETF RFC 4661 [63], of the <filter-set> element where the <filter> element;\nA)\tcontains an \"id\" attribute set to a value constructed according to IETF RFC 4661 [63];\nB)\tdoes not contain an \"uri\" attribute of the <filter> child element according to IETF RFC 4661 [63]; and\nC)\tdoes not contain an \"domain\" attribute according to IETF RFC 4661 [63];\n6)\tcontains a <what> child element according to IETF RFC 4661 [63], of the <filter> element; and\n7)\tcontains an <include> child element according to IETF RFC 4661 [63], of the <what> element where the <include> element;\nA)\tdoes not contain a \"type\" attribute according to IETF RFC 4661 [63]; and\nB)\tcontains the value, according to IETF RFC 4661 [63], set to concatenation of the '//pidf:presence/pidf:tuple[@id=\"' string, the MCPTT ID, and the '\"]' string.\nThe application/simple-filter+xml MIME body indicating per-group dynamic data restrictions of presence event package notification information is constructed according to IETF RFC 4661 [63] and:\n1)\tcontains a <filter-set> root element according to IETF RFC 4661 [63];\n2)\tcontains an <ns-bindings> child element according to IETF RFC 4661 [63], of the <filter-set> element;\n3)\tcontains an <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63] set to \"pidf\"; and\nB) contains a \"urn\" attribute set to the \"urn:ietf:params:xml:ns:pidf\" value;\n4)\tcontains an <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63], set to \"mcpttPI10\"; and\nB)\tcontains a \"urn\" attribute according to IETF RFC 4661 [63], set to the \"urn:3gpp:ns:mcpttPresInfo:1.0\" value;\n5)\tcontains a <filter> child element according to IETF RFC 4661 [63], of the <filter-set> element where the <filter> element;\nA)\tcontains an \"id\" attribute set to a value constructed according to IETF RFC 4661 [63];\nB)\tdoes not contain a \"uri\" attribute of the <filter> child element according to IETF RFC 4661 [63]; and\nC)\tdoes not contain a \"domain\" attribute according to IETF RFC 4661 [63];\n6)\tcontains a <what> child element according to IETF RFC 4661 [63], of the <filter> element; and\n7)\tcontains one or more <include> child elements according to IETF RFC 4661 [63], of the <what> element where the <include> element(s);\nA)\tdoes not contain a \"type\" attribute according to IETF RFC 4661 [63]; and\nB)\tcan contain one of the values, according to IETF RFC 4661 [63], needed to retrieve the dynamic group data the UE is interested in:\na)\t\"//pidf:presence/pidf:groupStatus/@pidf:ModifiedBy\" if the group status is requested;\nb)\t\"//pidf:presence/pidf:additionalData/@pidf:groupBroadcastAlias\" if the group broadcast alias is requested;\nc)\t\"//pidf:presence/pidf:additionalData/@pidf:groupRegroupAlias\" if the group regroup alias is requested;\nd)\t\"//pidf:presence/pidf:additionalData/@pidf:groupCallOngoing\" if the group call ongoing information is requested; or\ne)\t\"//pidf:presence/pidf:tuple/pidf:status/pidf:affiliation/@pidf:client [@pidf:status=\"affiliated\"]\" if the Contact address for all affiliated users are requested.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "9A\tFunctional Alias",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "9A.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "Clause 9A.2 contains the procedures for management of Functional Alias at the MCPTT client, the MCPTT server serving the MCPTT user and the MCPTT server owning the Functional Alias.\nClause 9A.3 describes the coding used for management of Functional Aliases.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "9A.2\tProcedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9A.2.1\tMCPTT client procedures",
                            "text_content": "The MCPTT client procedures consist of:\n-\ta functional alias status change procedure;\n-\ta functional alias status determination procedure; and\n-\ta location based functional alias status change procedure.\nIn order to obtain information about success or rejection of changes triggered by the functional alias status change procedure for an MCPTT user, the MCPTT client needs to initiate the functional alias status determination procedure for the MCPTT user before starting the functional alias status change procedure for the MCPTT user.\nIn order:\n-\tto indicate that an MCPTT user requests to activate or to take-over one or more functional aliases;\n-\tto indicate that the MCPTT user requests to deactivate one or more functional aliases;\n-\tto indicate that the MCPTT user continues to have interest in one or more functional aliases due to near expiration of the expiration time of a functional alias with the status set to the \"activated\" state received in a SIP NOTIFY request in clause 9A.2.1.3;\n-\tto indicate that the MCPTT client entering into or exiting from a location area triggers one or more functional aliases to be activated;\n-\tto indicate that the MCPTT client entering into or exiting from a location area triggers one or more functional aliases to be deactivated; or\n-\tany combination of the above;\nthe MCPTT client shall generate a SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37], and IETF RFC 3856 [51].\nWhen the MCPTT user requests to deactivate a functional alias, the MCPTT client shall first check the <manual-deactivation-not-allowed-if-location-criteria-met> element within the <anyExt> element of the <entry> element corresponding to the functional alias within the <FunctionalAliasList> list element of the <anyExt> element of the <OnNetwork> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]). If the functional alias has been activated due to a location area trigger and the <manual-deactivation-not-allowed-if-location-criteria-met> element is set to a value of \"true\", the MCPTT client shall suppress the MCPTT user's request.\nNOTE 1:\tIf the request is suppressed, a notification message can be displayed to the user.\nIn the SIP PUBLISH request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include the <mcptt-request-uri> element set to the MCPTT ID of the MCPTT user;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tif the MCPTT client requests to activate one or more functional aliases, shall set the Expires header field according to IETF RFC 3903 [37], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT client requests to deactivate one or more functional aliases, shall set the Expires header field according to IETF RFC 3903 [37], to zero; and\nNOTE 3:\tActivation and deactivation of functional alias cannot be performed with the same PUBLISH request.\n6)\tshall include an application/pidf+xml MIME body indicating per-user functional alias information according to clause 9A.3.1. In the MIME body, the MCPTT client:\na)\tshall include all functional aliases where the MCPTT user requests activation for the MCPTT ID;\nb)\tshall include the MCPTT client ID of the targeted MCPTT client;\nc)\tshall not include the \"status\" attribute and the \"expires\" attribute in the <>functionalAlias element;\nd)\tif the MCPTT client has received an indication that take over of a functional alias is possible and intends to take over a functional alias, shall include a <take-over> child element in the <status> element set to \"true\"; and\nNOTE 4:\tThe MCPTT client learns that take over of a functional alias is possible from procedures specified in clause 9A.2.1.3 (i.e., when status attribute is set to \"take-over-possible\"). The take-over indication applies to all functional aliases.\ne)\tshall set the <p-id-fa> child element of the <presence> root element to a globally unique value.\nNOTE 5:\tThis procedure deviates from IETF RFC 3903 [37] by possibly including an application/pidf+xml MIME body when refreshing the expiration time for one or more functional aliases. The use of this MIME body provides the ability to refresh activation or to deactivate of  multiple functional aliases in a single message.\nThe MCPTT client shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nNOTE 1:\tThe MCPTT UE also uses this procedure to determine which functional alias have been successfully activated for the MCPTT ID.\nIn order to discover functional aliases:\n1)\twhich are activated for the MCPTT user or which the MCPTT user is allowed to take-over; or\n2)\twhich another MCPTT user has activated;\nthe MCPTT client shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall include:\na)\tthe <mcptt-request-uri> element set to the MCPTT ID of the targeted MCPTT user; and\nb)\tthe <request-type> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element set to the value \"functional-alias-status-determination\";\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT client wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n6)\tshall include an Events header field set to \"presence\"; and\n7)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nIn order to re-subscribe or de-subscribe, the MCPTT client shall generate an in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT client:\n1)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 3:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n2)\tif the MCPTT client wants to de-subscribe, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n3)\tshall include an Events header field set to \"presence\"; and\n4)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nUpon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-user functional alias information constructed according to clause 9A.3.1, then the MCPTT client shall determine the status of each functional alias for the MCPTT user in the MIME body. If the <p-id-fa> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request is included, the <p-id-fa> element value indicates the SIP PUBLISH request which triggered sending of the SIP NOTIFY request.\nIf the MCPTT client detected a functional alias activation or deactivation, it shall perform the procedure specified in clause 9.2.1.7.\nIf a location criterion for functional alias activation or de-activation is met, the MCPTT client shall initiate the functional alias status change procedure as specified in clause 9A.2.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9A.2.2\tMCPTT server procedures",
                            "text_content": "The MCPTT server procedures consist of:\n-\tprocedures of MCPTT server serving the MCPTT user; and\n-\tprocedures of MCPTT server owning the functional alias.\nThe procedures of MCPTT server serving the MCPTT user consist of:\n-\ta receiving functional alias status change from MCPTT client procedure;\n-\ta receiving subscription to functional alias status procedure;\n-\ta sending notification of change of functional alias status procedure;\n-\ta sending functional alias  status change towards MCPTT server owning the functional procedure;\n-\ta functional alias status determination from MCPTT server owning the functional alias procedure;\n-\ta functional alias resolution from MCPTT server owning the functional alias procedure; and\n-\ta forwarding subscription to functional alias status towards another MCPTT server procedure, which is used to identify the status of functional aliases activated by a target user who is served by another MCPTT server.\nThe MCPTT server shall maintain a list of MCPTT user information entries. The list of the MCPTT user information entries contains one MCPTT user information entry for each served MCPTT ID.\nIn each MCPTT user information entry, the MCPTT server shall maintain:\n1)\tan MCPTT ID. This field uniquely identifies the MCPTT user information entry in the list of the MCPTT user information entries; and\n2)\ta list of functional alias information entries.\nIn each functional alias information, the MCPTT server shall maintain:\n1)\ta functional alias ID. This field uniquely identifies the functional alias information entry in the list of the functional alias information entries;\n2)\ta functional alias status;\n3)\tan expiration time;\n4)\ta functional alias p-id-fa; and\n5)\ta next publishing time.\nUpon receiving a SIP PUBLISH request such that:\n1)\tRequest-URI of the SIP PUBLISH request contains either the public service identity identifying the originating participating MCPTT function serving the MCPTT user, or the public service identity identifying the terminating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID served by the MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP PUBLISH request contains the \"presence\" event type; and\n5)\tSIP PUBLISH request contains an application/pidf+xml MIME body indicating per-user functional alias information according to clause 9A.3.1;\nthen the MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n2)\tif the Request-URI of the SIP PUBLISH request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP PUBLISH request;\n3)\tif the Request-URI of the SIP PUBLISH request contains the public service identity identifying the terminating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n4)\tif the originating MCPTT ID is different than the served MCPTT ID or the originating MCPTT ID is not authorized to modify functional alias status of the served MCPTT ID, shall send a SIP 403 (Forbidden) response and shall not continue with the rest of the steps;\n5)\tif the Expires header field of the SIP PUBLISH request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n6)\tif the Expires header field of the SIP PUBLISH request has nonzero value, shall determine the candidate expiration interval to according to IETF RFC 3903 [37];\n7)\tif the Expires header field of the SIP PUBLISH request has zero value, shall set the candidate expiration interval to zero;\n8)\tshall respond with SIP 200 (OK) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK) response, the MCPTT server:\na)\tshall set the Expires header field according to IETF RFC 3903 [37], to the candidate expiration time;\n9)\tif the \"entity\" attribute of the <presence> element of the application/pidf+xml MIME body of the SIP PUBLISH request is different than the served MCPTT ID, shall not continue with the rest of the steps;\n10)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n11)\tshall consider a copy of the list of the MCPTT functional alias entries of the served MCPTT user information entry as the served list of the MCPTT functional alias information entries;\n12)\tif the candidate expiration interval is nonzero,\tshall construct the candidate list of the MCPTT functional alias entries as follows:\na)\tfor each functional alias ID which has a functional alias information entry in the served list of the functional alias information entries, such that the expiration time of the functional alias information entry has not expired yet, and which is indicated in a \"functionalAliasID\" attribute of a <functionalAlias> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\ni)\tshall copy the functional alias information entry into a new functional alias information entry of the candidate list of the functional alias information entries;\nii)\tif the functional alias status of the functional alias information entry is \"deactivating\" or \"deactivated\", shall set the functional alias status of the new functional alias information entry to the \"activating\" state and shall set the activating p-id-fa of the new functional alias information entry to the value of the <p-id-fa> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\niii)\tshall set the expiration time of the new functional alias information entry to the current time increased with the candidate expiration interval;\nb)\tfor each functional alias ID which has a functional alias information entry in the served list of the functional alias information entries, such that the expiration time of the functional alias information entry has not expired yet, and which is not indicated in any \"functionalAliasID\" attribute of the <functionalAlias> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\ni)\tshall copy the functional alias information entry into a new functional alias information entry of the candidate list of the functional alias information entries; and\nii)\tif the functional alias status of the functional alias information entry is \"activated\" or \"activating\":\n-\tshall set the functional alias status of the new functional alias entry to the \"deactivating\" state; and\n-\tshall set the expiration time of the new functional alias information entry to the current time increased with twice the value of timer F; and\nc)\tfor each functional alias ID:\ni)\twhich does not have a functional alias information entry in the served list of the functional alias entries; or\nii)\twhich has a functional alias information entry in the served list of the functional alias information entries, such that the expiration time of the functional alias information entry has already expired;\nand which is indicated in a \"functionalAliasID\" attribute of the <functionalAlias> element of the <status> element of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request:\ni)\tshall add a new functional alias information entry in the candidate list of the functional alias information list for the functional alias ID;\nii)\tshall set the functional alias status of the new functional alias information entry to the \"activating\" state;\niii)\tshall set the expiration time of the new functional alias information entry to the current time increased with the candidate expiration interval; and\niv)\tshall set the activating p-id-fa of the new functional alias information entry to the value of the <p-id-fa> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request;\n13)\tif the candidate expiration interval is zero, constructs the candidate list of the functional alias information entries as follows:\na)\tfor each functional alias ID which has an entry in the served list of the functional alias information entries:\ni)\tshall copy the functional alias entry of the served list of the functional alias information into a new functional alias information entry of the candidate list of the functional alias information entries;\nii)\tshall set the functional alias status of the new functional alias information entry to the \"deactivating\" state; and\niii)\tshall set the expiration time of the new functional alias information entry to the current time increased with twice the value of timer F;\n14)\tshall replace the list of the functional alias information entries stored in the served MCPTT user information entry with the candidate list of the functional alias information entries;\n15)\tshall perform the procedures specified in clause 9A.2.2.2.6 for the served MCPTT ID and each functional alias:\na)\twhich does not have a functional alias information entry in the served list of the functional alias information entries and which has a functional alias information entry in the candidate list of the functional alias information entries with the functional alias status set to the \"activating\" state;\nb)\twhich has a functional alias information entry in the served list of the functional alias information entries with the expiration time already expired, and which has a functional alias information entry in the candidate list of the functional alias information entries with the functional alias status set to the \"activating\" state;\nc)\twhich has a functional alias information entry in the served list of the functional alias information entries with the functional alias status set to the \"deactivating\" state or the \"deactivated\" state and with the expiration time not expired yet, and which has an functional alias information entry in the candidate list of the functional alias information entries with the functional alias status set to the \"activating\" state; or\nd)\twhich has a functional alias information entry in the served list of the functional alias information entries with the functional alias status set to the \"activated\" state and with the expiration time not expired yet, and which has an functional alias information entry in the candidate list of the functional alias information entries with the functional alias status set to the \"deactivating\" state;\n16)\tshall identify the handled p-id-fa in the <p-id-fa> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\n17)\tshall perform the procedures specified in clause 9A.2.2.2.5 for the served MCPTT ID.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains either the public service identity identifying the originating participating MCPTT function serving the MCPTT user, or the public service identity identifying the terminating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing:\na)\tthe<mcptt-request-uri> element which identifies an MCPTT ID served by the MCPTT server; and\nb)\tthe <mcpttinfo> element with the <mcptt-Params> element containing an <anyExt> element with the <request-type> element set to a value of \"functional-alias-status-determination\";\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type;\nthe MCPTT server:\n1)\tshall identify the served MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tif the Request-URI of the SIP SUBSCRIBE request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tif the Request-URI of the SIP SUBSCRIBE request contains the public service identity identifying the terminating participating MCPTT function serving the MCPTT user, shall identify the originating MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n4)\tif the originating MCPTT ID is different than the served MCPTT ID and the originating MCPTT ID is not authorized to modify functional alias status of the served MCPTT ID, shall send a SIP 403 (Forbidden) response and shall not continue with the rest of the steps; and\n5)\tshall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify the subscriber about changes of the information of the served MCPTT ID, as described in clause 9A.2.2.2.5.\nIn order to notify the subscriber about changes of functional aliases of the served MCPTT ID, the MCPTT server:\n1)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n2)\tshall generate an application/pidf+xml MIME body indicating per-user functional alias information according to clause 9A.3.1 and the served list of the MCPTT user information entries with the following clarifications:\na)\tthe MCPTT server shall not include information from functional alias information entry with the expiration time already expired;\nb)\tthe MCPTT server shall not include information from a functional alias information entry with the functional alias status set to the \"deactivated\" state;\nc)\tif this procedures is invoked by procedure in clause 9A.2.2.2.3 where the handled p-id-fa value was identified, the MCPTT server shall set the <p-id-fa> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request to the handled p-id-fa value; and\n3)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9A.2.2.2.4. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-user functional alias information.\nNOTE 1:\tUsage of one SIP PUBLISH request to carry information about change of functional alias state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nIn order:\n-\tto send an activation request of a served MCPTT ID for a handled functional alias ID;\n-\tto send a deactivation request of a served MCPTT ID for a handled functional alias ID;\n-\tto send a take over request of a served MCPTT ID for a handled functional alias ID due to take over; or\n-\tto send an activation request of a served MCPTT ID for a handled functional alias ID due to near expiration of the previously published information;\nthe MCPTT server shall generate a SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51]. In the SIP PUBLISH request, the MCPTT server:\n1)\tshall set the Request-URI to the public service identity of the controlling MCPTT function associated with the handled functional alias ID;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\na)\tshall include the <mcptt-request-uri> element set to the handled functional alias ID; and\nb)\tshall include the <mcptt-calling-user-id> element set to the served MCPTT ID;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tif sending an activation request, shall set the Expires header field according to IETF RFC 3903 [37], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif sending a deactivation request, shall set the Expires header field according to IETF RFC 3903 [37], to zero;\n6)\tshall include a P-Asserted-Identity header field set to the public service identity of the MCPTT server according to 3GPP TS 24.229 [4];\n7)\tshall set the current p-id-fa to a globally unique value;\n8)\tshall consider an MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the served MCPTT ID;\nas the served MCPTT user information entry;\n9)\tfor each functional alias information entry such that:\na)\tthe functional alias information entry has the \"activating\" functional alias status, the functional alias ID set to the handled functional alias ID, the expiration time has not expired yet and the activating p-id-fa is not set; and\nb)\tthe functional alias information entry is in the list of the functional alias information entries of the served MCPTT user information entry;\nshall set the activating p-id-fa of the functional alias information entry to the current p-id-fa; and\n10)\tshall include an application/pidf+xml MIME body indicating per-functional alias status information constructed according to clause 9A.3.1.2. The MCPTT server shall indicate all served MCPTT user IDs, such that:\na)\tthe functional alias status is set to \"activating\" with or without \"take-over\" element or \"activated\", and the expiration time has not expired yet in a functional alias information entry with the functional alias ID set to the handled functional alias;\nb)\tthe functional alias information entry is in the list of the functional alias information entries of an MCPTT user information entry; and\nc)\tthe MCPTT user information entry is a served MCPTT user information entry.\nThe MCPTT server shall set the <p-id-fa> child element of the <presence> root element to the current p-id-fa.\nThe MCPTT server shall not include the \"expires\" attribute in the <functionalAlias> element.\nNOTE 3:\tThe MCPTT server sets the \"status\" attribute in the <functionalAlias> element to indicate whether the request is for functional alias take over.\nThe MCPTT server shall send the SIP PUBLISH request according to 3GPP TS 24.229 [4].\nIf timer F expires for the SIP PUBLISH request sent for a (de)activation request of served MCPTT ID for the functional alias ID or upon receiving a SIP 3xx, 4xx, 5xx or 6xx response to the SIP PUBLISH request, the MCPTT server:\n1)\tshall remove each functional alias ID entry such that:\na)\tthe functional alias information entry has the functional alias ID set to the handled functional alias ID; and\nb)\tthe functional alias information entry is in the list of the functional alias information entries of the served MCPTT user information entry.\nNOTE 1:\tUsage of one SIP SUBSCRIBE request to subscribe for notification about change of functional alias state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nIn order to discover whether a served MCPTT user successfully activated a handled functional alias in the MCPTT server owning the functional alias, the MCPTT server shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT server:\n1)\tshall set the Request-URI to the public service identity of the controlling MCPTT function associated with the handled functional alias;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\na)\tshall include the <mcptt-request-uri> element set to the handled functional alias ID; and\nb)\tshall include the <mcptt-calling-user-id> element set to the served MCPTT ID;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tif the MCPTT server wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tif the MCPTT server wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n6)\tshall include an Accept header field containing the application/pidf+xml MIME type;\n7)\tshall include an Events header field set to \"presence\"; and\n8)\tshall include an application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information according to clause 9A.3.2, indicating the served MCPTT ID.\nIn order to re-subscribe or de-subscribe, the MCPTT server shall generate an in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]. In the SIP SUBSCRIBE request, the MCPTT server:\n1)\tif the MCPTT server wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 3:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n2)\tif the MCPTT server wants to de-subscribe, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n3)\tshall include an Events header field set to \"presence\"; and\n4)\tshall include an Accept header field containing the application/pidf+xml MIME type.\nUpon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26], if SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-functional alias information constructed according to clause 9A.3.1, then the MCPTT server:\n1)\tfor each served MCPTT ID such that the application/pidf+xml MIME body of SIP NOTIFY request contains:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID;\nc)\tan <functionalAlias> child element of the <status> element of the <tuple> element; and\nd)\tthe \"expires\" attribute of the <functionalAlias> element indicating expiration of activation of functional alias;\nperform the following:\na)\tif a functional alias information entry exists such that:\ni)\tthe functional alias information entry has the \"activating\" functional alias status, the functional alias ID set to the handled functional alias ID, and the expiration time has not expired yet;\nii)\tthe functional alias information entry is in the list of the functional alias information entries of an MCPTT user information entry with the MCPTT ID set to the served MCPTT ID; and\niii)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2;\nshall set the functional alias status of the functional alias information entry to \"activated\"; and\nshall set the next publishing time of the functional alias information entry to the current time and half of the time between the current time and the expiration of the functional alias; and\n2)\tfor each functional alias information entry such that:\na)\tthe functional alias information entry has the \"activated\" functional alias status or the \"deactivating\" functional alias status, the functional alias ID set to the handled functional alias ID, and the expiration time has not expired yet;\nb)\tthe functional alias information entry is in the list of the functional alias information entries of an MCPTT user information entry with the MCPTT ID set to a served MCPTT ID; and\nc)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2; and\nfor which the application/pidf+xml MIME body of SIP NOTIFY request does not contain:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID; and\nc)\tan <functionalAlias> child element of the <status> child element of the <tuple> element.\nperform the following:\na)\tshall set the functional alias status of the functional alias information entry to \"deactivated\"; and\nb)\tshall set the expiration time of the functional alias information entry to the current time; and\n3)\tif a <p-id-fa> element is included in the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request, then for each functional alias information entry such that:\na)\tthe functional alias information entry has the \"activating\" functional alias status, the functional alias ID set to the handled functional alias ID, the expiration time has not expired yet and with the activating p-id-fa set to the value of the <p-id-fa> element;\nb)\tthe functional alias information entry is in the list of the functional alias information entries of an MCPTT user information entry with the MCPTT ID set to a served MCPTT ID; and\nd)\tthe MCPTT user information entry is in the list of MCPTT user information entries described in clause 9A.2.2.2.2; and\nfor which the application/pidf+xml MIME body of SIP NOTIFY request does not contain:\na)\ta <tuple> element of the root <presence> element;\nb)\tthe \"id\" attribute of the <tuple> element indicating the served MCPTT ID; and\nc)\tan <functionalAlias> child element of the <status> child element of the <tuple> element;\nperform the following:\na)\tshall set the functional alias status of the functional alias information entry to \"deactivated\"; and\nb)\tshall set the expiration time of the functional alias information entry to the current time.\nIn order to discover the MCPTT users that have successfully activated a handled functional alias in the MCPTT server owning the functional alias, the MCPTT server shall generate an initial SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26].\nIn the SIP SUBSCRIBE request, the MCPTT server:\n1)\tshall set the Request-URI to the public service identity of the controlling MCPTT function associated with the handled functional alias;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server shall include the <mcptt-request-uri> element set to the handled functional alias ID;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tshall set the Expires header field according to IETF RFC 6665 [26] to zero;\nNOTE:\tif the MCPTT server wants to receive the current status and later notification, can set the Expires header field according to IETF RFC 6665 [26], to 4294967295, which is the highest value defined for Expires header field in IETF RFC 3261 [24].\n5)\tshall include an Accept header field containing the application/pidf+xml MIME type;\n6)\tshall include an Events header field set to \"presence\"; and\n7)\tshall include an application/simple-filter+xml MIME body indicating per-functional alias restrictions of presence event package notification information indicating the served functional alias.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n2)\tthe SIP SUBCRIBE request contains an application/vnd.3gpp.mcptt-info MIME body containing the<mcptt-request-uri> element which identifies an MCPTT ID not served by MCPTT server;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9]; and\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type;\nthen the MCPTT server:\n1)\tshall identify the target MCPTT ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the originating MCPTT ID from public user identity in the P-Asserted-Identity header field of the SIP SUBSCRIBE request;\n3)\tshall generate a SIP SUBSCRIBE request from the received SIP SUBSCRIBE request. In the generated SIP SUBSCRIBE request, the MCPTT server:\na)\tshall set the Request-URI to the public service identity identifying the terminating participating MCPTT function serving the target MCPTT ID;\nb)\tshall include a P-Asserted-Identity header field containing the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\nc)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body. In the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT server:\nA)\tshall include the <mcptt-request-uri> element set to the target MCPTT ID; and\nB)\tshall include the <mcptt-calling-user-id> element set to the originating MCPTT ID; and\nd)\tshall include other signalling elements from the received SIP SUBSCRIBE request; and\n4)\tshall send the generated SIP SUBSCRIBE request according to 3GPP TS 24.229 [4].\nThe MCPTT server shall forward to the originating MCPTT ID any received SIP responses to the SIP SUBSCRIBE request, and for the duration of the subscription any received SIP NOTIFY requests and any received SIP responses to the SIP NOTIFY request according to 3GPP TS 24.229 [4].\nThe procedures of MCPTT server owning the functional alias consist of:\n-\treceiving functional alias status change procedure;\n-\treceiving subscription to functional alias status procedure;\n-\tsending notification of change of functional alias status procedure;\n-\tmodification of functional alias eligibility check procedure; and\n-\treceiving subscription to functional alias resolution procedure; and\n-\tsending notification of functional alias resolution procedure.\nThe MCPTT server shall maintain a list of functional alias information entries.\nIn each functional alias information entry, the MCPTT server shall maintain:\n1)\ta functional alias ID. This field uniquely identifies the functional alias information entry in the list of the functional alias information entries; and\n2)\ta list of MCPTT user information entries.\nIn each MCPTT user information entry, the MCPTT server shall maintain:\n1)\tan MCPTT ID. This field uniquely identifies the MCPTT user information entry in the list of the MCPTT user information entries;\n2)\ta take-over possible indication; and\n3)\tan expiration time.\nUpon receiving a SIP PUBLISH request such that:\n1)\tRequest-URI of the SIP PUBLISH request contains the public service identity of the controlling MCPTT function associated with the served functional alias;\n2)\tthe SIP PUBLISH request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the <mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP PUBLISH request contains the \"presence\" event type; and\n5)\tSIP PUBLISH request contains an application/pidf+xml MIME body indicating per-functional alias information constructed according to clause 9A.3.1.2;\nthen the MCPTT server:\n1)\tshall identify the served functional alias in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP PUBLISH request;\n3)\tif the Expires header field of the SIP PUBLISH request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP PUBLISH request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n4)\tif the functional alias does not exist in the MCPTT server, shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n4a)\tif SIP PUBLISH request is for activation of a functional alias then:\na)\tif handled MCPTT ID does not match with any of the entries in the <mcptt-user-list> which contains the MCPTT IDs of MCPTT users which are allowed to activate the functional alias; and\nb)\tif no local policy exists that authorizes the request by the handled MCPTT ID;\nshall reject the SIP PUBLISH request with SIP 403 (Forbidden) response according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n5)\tif SIP PUBLISH request is for activation of a functional alias and the number of activations for the handled functional alias is equal <max-simultaneous-activations>, shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n6)\tif SIP PUBLISH request is for take over of a functional alias, the MCPTT server shall use the <allow-takeover> element of the MCPTT service configuration document and the <allow-takeover-functional-alias-other-user> element of the MCPTT user profile document (see 3GPP TS 24.484 [50]) to determine if take over is possible. If take over is not possible, the MCPTT server shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n7)\tshall respond with SIP 200 (OK) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37]. In the SIP 200 (OK) response, the MCPTT server:\na)\tshall set the Expires header field according to IETF RFC 3903 [37], to the selected expiration time;\n8)\tif the \"entity\" attribute of the <presence> element of the application/pidf+xml MIME body of the SIP PUBLISH request is different than the served functional alias ID, shall not continue with the rest of the steps;\n9)\tif the handled MCPTT ID is different from the MCPTT ID in the \"id\" attribute of the <tuple> element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request, shall not continue with the rest of the steps;\n10)\tshall consider a functional alias information entry such that:\na)\tthe functional alias information entry is in the list of functional alias information entries described in clause 9A.2.2.3.2; and\nb)\tthe functional alias ID of the functional alias information entry is equal to the served functional alias ID;\nas the served functional alias information entry;\n11)\tif the selected expiration time is zero:\na)\tshall remove the MCPTT user information entry such that:\ni)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served functional alias information entry; and\nii)\tthe MCPTT user information entry has the MCPTT ID set to the served MCPTT ID;\n12)\tif the selected expiration time is not zero:\na)\tshall consider an MCPTT user information entry such that:\ni)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served functional alias information entry; and\nii)\tthe MCPTT ID of the MCPTT user information entry is equal to the handled MCPTT ID;\nas the served MCPTT user information entry;\nb)\tif the MCPTT user information entry does not exist:\ni)\tshall insert an MCPTT user information entry with the MCPTT ID set to the handled MCPTT ID into the list of the MCPTT user information entries of the served functional alias information entry; and\nii)\tshall consider the inserted MCPTT user information entry as the served MCPTT user information entry; and\nc)\tshall set the expiration time according to the selected expiration time in the served MCPTT user information entry;\n13)\tshall identify the handled p-id-fa in the <p-id-fa> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP PUBLISH request; and\n14)\tshall perform the procedures specified in clause 9A.2.2.3.5 for the served functional alias ID.\nNOTE:\tUsage of one SIP SUBSCRIBE request to subscribe for notification about change of functional alias state of several MCPTT users served by the same MCPTT server is not supported in this version of the specification.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity of the controlling MCPTT function associated with the served functional alias;\n2)\tthe SIP SUBSCRIBE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing the<mcptt-request-uri> element and the <mcptt-calling-user-id> element;\n3)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type; and\n5) the SIP SUBSCRIBE request contains an application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information according to clause 9A.3.2 indicating the same MCPTT ID as in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\nthen the MCPTT server:\n1)\tshall identify the served functional alias ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tshall identify the handled MCPTT ID in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n3)\tif the Expires header field of the SIP SUBSCRIBE request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n4)\tif a functional alias does not exist in the MCPTT server, shall reject the SIP PUBLISH request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps;\n5)\tif the handled MCPTT ID based on local policy is not authorized for notifications of the functional alias identified by the served functional alias ID, shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps; and\n6)\tshall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify subscriber about changes of the information of the served MCPTT ID, as described in clause 9A.2.2.3.5.\nIn order to notify the subscriber identified by the handled MCPTT ID about changes of the functional alias status of the served functional alias ID, the MCPTT server:\n1)\tshall consider a functional alias information entry such that:\na)\tthe functional alias information entry is in the list of functional alias information entries described in clause 9A.2.2.3.2; and\nb)\tthe functional alias ID of the functional alias information entry is equal to the served functional alias ID;\n2)\tshall consider an MCPTT user information entry such:\na)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served functional alias information entry; and\nb)\tthe MCPTT ID of the MCPTT user information entry is equal to the handled MCPTT ID;\nas the served MCPTT user information entry;\n3)\tshall generate an application/pidf+xml MIME body indicating per-functional alias information according to clause 9A.3.1 and the served list of the served MCPTT user information entry of the functional alias information entry with following clarifications:\na)\tthe MCPTT server shall include the \"expires\" attribute in the <functionalAlias> element; and\nb)\tif this procedures is invoked by procedure in clause 9A.2.2.3.3 where the handled p-id-fa was identified, the MCPTT server shall set the <p-id-fa> child element of the <presence> root element of the application/pidf+xml MIME body of the SIP NOTIFY request to the handled p-id-fa value; and\n4)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9A.2.2.3.4. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-functional alias information.\nIn order to deactivate a functional alias associated with a target MCPTT ID:\n1)\texternally triggered by an MCPTT administrator by a mechanism outside of the scope of the standard; or\n2)\tdirectly by the MCPTT function owning the functional alias as a result of an internal trigger like the expiration of the functional alias association;\nthe MCPTT server\n1)\tshall consider a functional alias information entry such that:\na)\tthe functional alias information entry is in the list of functional alias information entries described in clause 9A.2.2.3.2; and\nb)\tthe functional alias ID of the functional alias information entry is equal to the served functional alias ID;\nas the served functional alias information entry;\n2)\tshall remove the MCPTT user information entry such that:\na)\tthe MCPTT user information entry is in the list of the MCPTT user information entries of the served functional alias information entry; and\nb)\tthe MCPTT user information entry has the MCPTT ID set to the target MCPTT ID; and\n3)\tshall perform the procedures specified in clause 9A.2.2.3.5 for the served functional alias ID.\nUpon receiving a SIP SUBSCRIBE request such that:\n1)\tRequest-URI of the SIP SUBSCRIBE request contains the public service identity of the controlling MCPTT function associated with the requested functional alias;\n2)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n3)\tthe Event header field of the SIP SUBSCRIBE request contains the \"presence\" event type; and\n4)\tthe SIP SUBSCRIBE request contains an application/simple-filter+xml MIME body indicating per-functional alias restrictions of presence event package notification information according to clause 9A.3.2;\nthen the MCPTT server:\n1)\tshall identify the requested functional alias ID in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP SUBSCRIBE request;\n2)\tif the Expires header field of the SIP SUBSCRIBE request is not included or has nonzero value lower than 4294967295, shall send a SIP 423 (Interval Too Brief) response to the SIP SUBSCRIBE request, where the SIP 423 (Interval Too Brief) response contains a Min-Expires header field set to 4294967295, and shall not continue with the rest of the steps;\n3)\tif the requested functional alias does not exist in the MCPTT server, shall reject the SIP SUBSCRIBE request with SIP 403 (Forbidden) response to the SIP PUBLISH request according to 3GPP TS 24.229 [4], IETF RFC 3903 [37] and IETF RFC 3856 [51] and skip the rest of the steps; and\n4)\tshall generate a SIP 200 (OK) response to the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4], IETF RFC 6665 [26].\nFor the duration of the subscription, the MCPTT server shall notify subscriber about changes of the information of the requested functional alias, as described in clause 9A.2.2.3.8.\nIn order to notify the subscriber about the MCPTT users that have successfully activated the functional alias corresponding to the requested functional alias ID, the MCPTT server:\n1)\tshall consider a functional alias information entry such that:\na)\tthe functional alias information entry is in the list of functional alias information entries described in clause 9A.2.2.3.2; and\nb)\tthe functional alias ID of the functional alias information entry is equal to the requested functional alias ID;\n2)\tshall consider any MCPTT user information entry such that the MCPTT user information entry is in the list of the MCPTT user information entries of the served functional alias information entry, as the served MCPTT user information entry;\n3)\tshall generate an application/pidf+xml MIME body indicating per-functional alias information according to clause 9A.3.1 and the served list of the served MCPTT user information entry of the functional alias information entry\n4)\tsend a SIP NOTIFY request according to 3GPP TS 24.229 [4], and IETF RFC 6665 [26] for the subscription created in clause 9A.2.2.3.7. In the SIP NOTIFY request, the MCPTT server shall include the generated application/pidf+xml MIME body indicating per-functional alias information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "9A.3\tCoding",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9A.3.1\tExtension of application/pidf+xml MIME type",
                            "text_content": "The clauses of the parent clause describe an extension of the application/pidf+xml MIME body specified in IETF RFC 3863 [52]. The extension is used to indicate:\n-\tper-user functional alias information; and\n-\tper-functional alias status information.\nThe application/pidf+xml MIME body indicating per-user functional alias information is constructed according to IETF RFC 3863 [52] and:\n1)\tcontains a <presence> root element according to IETF RFC 3863 [52];\n2)\tcontains an \"entity\" attribute of the <presence> element set to the MCPTT ID of the MCPTT user;\n3)\tcontains one <tuple> child element according to IETF RFC 3863 [52] per <presence> element;\n4)\tcan contain a <p-id-fa> child element defined in the XML schema defined in table 9A.3.1.2-1, of the <presence> element set to an identifier of a SIP PUBLISH request;\n5)\tcontains an \"id\" attribute of the <tuple> element set to the MCPTT client ID;\n6)\tcontains one <status> child element of each <tuple> element;\n7)\tcontains one <functionalAlias> child element defined in the XML schema defined in table 9A.3.1.2-1, of the <status> element, for each functional alias in which the MCPTT user is interested;\n8)\tcontains a \"functionalAliasID\" attribute of each <functionalAlias> element set to the functional alias ID of the functional alias in which the MCPTT user is interested;\n9)\tcan contain a \"status\" attribute of each <functionalAlias> element indicating the activation status of functional alias for the MCPTT user;\n10)\tcan contain an \"expires\" attribute of each <functionalAlias> element indicating expiration of activation of the functional alias for the MCPTT user; and\n11)\tcan contain one <take-over> child element of the <status> element set to \"true\" indicating that the MCPTT user is interested to take over the functional aliases.\nThe application/pidf+xml MIME body indicating per-functional alias status information is constructed according to IETF RFC 3856 [51] and:\n1)\tcontains the <presence> root element according to IETF RFC 3863 [52];\n2)\tcontains an \"entity\" attribute of the <presence> element set to the functional alias ID of the functional alias;\n3)\tcontains one <tuple> child element according to IETF RFC 3863 [52] of the <presence> element;\n4)\tcan contain a <p-id-fa> child element defined in the XML schema defined in table 9A.3.1.2-1, of the <presence> element set to an identifier of a SIP PUBLISH request;\n5)\tcontains an \"id\" attribute of the <tuple> element set to the functional alias ID;\n6)\tcontains one <status> child element of each <tuple> element;\n7)\tcontains one <functionalAlias> child element defined in the XML schema defined in table 9A.3.1.2-1, of the <status> element, for each MCPTT ID for which functional alias information is provided;\n8)\tcontains one \"user\" attribute defined in the XML schema defined in table 9A.3.1.2-1, of the <functionalAlias> element set to the MCPTT client ID; and\n9)\tcan contain an \"expires\" attribute defined in the XML schema defined in table 9A.3.1.2-1, of the <functionalAlias> element indicating expiration of activation of the functional alias for the MCPTT user.\nTable 9A.3.1.2-1: XML schema with elements and attributes extending the application/pidf+xml MIME body\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:ns:mcpttPresInfoFA:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:mcpttPIFA10=\"urn:3gpp:ns:mcpttPresInfoFA:1.0\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n\n<!-- MCPTT functional alias specific child elements of presence element -->\n<xs:element name=\"p-id-fa\" type=\"xs:string\"/>\n\n<!-- MCPTT functional alias specific child elements of status element -->\n<xs:element name=\"functionalAlias\" type=\"mcpttPIFA10:functionalAliasType\"/>\n<xs:complexType name=\"functionalAliasType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:attribute name=\"functionalAliasID\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"user\" type=\"xs:anyURI\" use=\"optional\"/>\n<xs:attribute name=\"status\" type=\"mcpttPIFA10:statusType\" use=\"optional\"/>\n<xs:attribute name=\"expires\" type=\"xs:dateTime\" use=\"optional\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:element name=\"take-over\" type=\"xs:boolean\"/>\n\n<xs:simpleType name=\"statusType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"activating\"/>\n<xs:enumeration value=\"activated\"/>\n<xs:enumeration value=\"deactivating\"/>\n<xs:enumeration value=\"take-over-possible\"/>\n</xs:restriction>\n</xs:simpleType>\n\n</xs:schema>\nThe application/pidf+xml MIME body refers to namespaces using prefixes specified in table 9A.3.1.2-2.\nTable 9A.3.1.2-2: Assignment of prefixes to namespace names in the application/pidf+xml MIME body\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 9A.3.1.2-2: Assignment of prefixes to namespace names in the application/pidf+xml MIME body",
                                    "table number": 6,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "9A.3.2\tExtension of application/simple-filter+xml MIME type",
                            "text_content": "The clauses of the parent clause describe an extension of the application/simple-filter+xml MIME body specified in IETF RFC 4661 [63].\nThe extension is used to indicate per-user restrictions of presence event package notification information for functional alias information and per-functional alias restrictions of presence event package notification information.\nThe application/simple-filter+xml MIME body indicating per-user restrictions of presence event package notification information is constructed according to IETF RFC 4661 [63] and:\n1)\tcontains a <filter-set> root element according to IETF RFC 4661 [63];\n2)\tcontains a <ns-bindings> child element according to IETF RFC 4661 [63], of the <filter-set> element;\n3)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63] set to \"pidf\"; and\nB)\tcontains a \"urn\" attribute set to the \"urn:ietf:params:xml:ns:pidf\" value;\n4)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63], set to \"mcpttPIFA10\"; and\nB)\tcontains an \"urn\" attribute according to IETF RFC 4661 [63], set to the \"urn:3gpp:ns:mcpttPresInfoFA:1.0\" value;\n5)\tcontains a <filter> child element according to IETF RFC 4661 [63], of the <filter-set> element where the <filter> element;\nA)\tcontains an \"id\" attribute set to a value constructed according to IETF RFC 4661 [63];\nB)\tdoes not contain an \"uri\" attribute of the <filter> child element according to IETF RFC 4661 [63]; and\nC)\tdoes not contain an \"domain\" attribute according to IETF RFC 4661 [63];\n6)\tcontains a <what> child element according to IETF RFC 4661 [63], of the <filter> element; and\n7)\tcontains an <include> child element according to IETF RFC 4661 [63], of the <what> element where the <include> element;\nA)\tdoes not contain a \"type\" attribute according to IETF RFC 4661 [63]; and\nB)\tcontains the value, according to IETF RFC 4661 [63], set to concatenation of the '//pidf:presence/pidf:tuple[@id=\"' string, the MCPTT ID, and the '\"]' string.\nThe application/simple-filter+xml MIME body indicating per-functional alias restrictions of presence event package notification information is constructed according to IETF RFC 4661 [63] and:\n1)\tcontains a <filter-set> root element according to IETF RFC 4661 [63];\n2)\tcontains a <ns-bindings> child element according to IETF RFC 4661 [63], of the <filter-set> element;\n3)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63] set to \"pidf\"; and\nB)\tcontains a \"urn\" attribute set to the \"urn:ietf:params:xml:ns:pidf\" value;\n4)\tcontains a <ns-binding> child element according to IETF RFC 4661 [63], of the <ns-bindings> element where the <ns-binding> element:\nA)\tcontains a \"prefix\" attribute according to IETF RFC 4661 [63], set to \"mcpttPIFA10\"; and\nB)\tcontains a \"urn\" attribute according to IETF RFC 4661 [63], set to the \"urn:3gpp:ns:mcpttPresInfoFA:1.0\" value;\n5)\tcontains a <filter> child element according to IETF RFC 4661 [63], of the <filter-set> element where the <filter> element;\nA)\tcontains an \"id\" attribute set to a value constructed according to IETF RFC 4661 [63];\nB)\tdoes not contain an \"uri\" attribute of the <filter> child element according to IETF RFC 4661 [63]; and\nC)\tdoes not contain a \"domain\" attribute according to IETF RFC 4661 [63];\n6)\tcontains a <what> child element according to IETF RFC 4661 [63], of the <filter> element; and\n7)\tcontains an <include> child element according to IETF RFC 4661 [63], of the <what> element where the <include> element;\nA)\tdoes not contain a \"type\" attribute according to IETF RFC 4661 [63]; and\nB)\tcontains the value, according to IETF RFC 4661 [63], set to concatenation of the '//pidf:presence/pidf:tuple[@id=\"' string, the functional alias ID, and the '\"]' string.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "9A.4\tFunctional alias to group binding for the MCPTT user procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "9A.4.1\tGeneral",
                            "text_content": "This clause describes the functional alias to group binding for the MCPTT user procedures for on-network.\nFor on-network functional alias to group binding for the MCPTT user, the procedures for originating MCPTT clients, participating MCPTT functions and controlling MCPTT function are specified in clause 9A.2.\nAn MCPTT user can bind the same functional alias with multiple MCPTT groups but an MCPTT user cannot bind multiple functional aliases to the same MCPTT group.\nOnly the activated functional aliases are used for creating a binding with a MCPTT group or list of MCPTT groups.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "9A.4.2\tOn-network functional alias to group binding",
                            "text_content": "On request from an MCPTT user at MCPTT client, a request to create binding of a functional alias with group for the MCPTT user is initiated by the MCPTT client towards the participating MCPTT function.\nUpon receiving a request from an MCPTT user to bind a functional alias with an MCPTT group or a list of MCPTT groups for the MCPTT user, if the <allow-functional-alias-binding-with-group> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from an MCPTT user to bind a functional alias with an MCPTT group or a list of MCPTT groups for the MCPTT user, if the requested functional alias is not activated by MCPTT user at MCPTT client, the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from an MCPTT user to bind a functional alias with an MCPTT group or a list of MCPTT groups for the MCPTT user, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n3)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according IETF RFC 3841 [6];\n5)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n6)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with:\na) the <request-type> element set to a value of \"fa-group-binding-req\";\nb) the <binding-ind> element set to a value of \"true\";\nc) the <binding-fa-uri> element set to the URI of an activated functional alias that shall be bound with the specified list of MCPTT groups in \"uri\" attributes of <entry> elements of a <list> element of the <resource-lists> element in an application/resource-lists+xml MIME body;\nd) the <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\ne) if the MCPTT client needs to include an active functional alias in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias;\n7)\tshall include an application/resource-lists+xml MIME body containing a <resource-lists> element containing a <list> element containing one or more <entry> elements each containing a \"uri\" attribute set to an MCPTT group ID; and\n8)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client shall inform the MCPTT user of success in binding of a functional alias with the MCPTT group or list of MCPTT groups for the MCPTT user.\nOn receiving a SIP 4xx response a SIP 5xx response or a SIP 6xx response to the SIP MESSAGE request, the MCPTT client shall inform the MCPTT user of unsuccess in binding of a functional alias with the MCPTT group or list of MCPTT groups for the MCPTT user, possibly taking into account Warning header information for the failure reason.\nUpon receiving a request from an MCPTT user to unbind a functional alias with an MCPTT group or a list of MCPTT groups for the MCPTT user, if the <allow-functional-alias-binding-with-group> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from an MCPTT user to unbind a functional alias with an MCPTT group or a list of MCPTT groups for the MCPTT user, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n3)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according IETF RFC 3841 [6];\n5)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n6)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with:\na) the <request-type> element set to a value of \"fa-group-binding-req\";\nb) the <binding-ind> element set to a value of \"false\";\nc) the <unbinding-fa-uri> element set to the URI of a functional alias that shall be unbound from the specified list of MCPTT groups in \"uri\" attributes of <entry> elements of a <list> element of the <resource-lists> element in an application/resource-lists+xml MIME body;\nd) the <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\ne) if the MCPTT client needs to include an active functional alias in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias;\n7)\tshall include an application/resource-lists+xml MIME body containing a <resource-lists> element containing a <list> element containing one or more <entry> elements each containing a \"uri\" attribute set to an MCPTT group ID; and\n8)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client shall inform the MCPTT user of success in unbinding the functional alias with the MCPTT group or list of MCPTT groups for the MCPTT user.\nOn receiving a SIP 4xx response a SIP 5xx response or a SIP 6xx response to the SIP MESSAGE request, the MCPTT client shall inform the MCPTT user of unsuccess in unbinding of a functional alias with the MCPTT group or list of MCPTT groups for the MCPTT user, possibly taking into account Warning header information for the failure reason.\nThe participating MCPTT function has procedures to:\n-\treceive a request for binding/unbinding of a functional alias with the MCPTT group(s) for the MCPTT user from the MCPTT Client.\nUpon receipt of a \"SIP MESSAGE request for binding of a functional alias with the MCPTT group(s) for the MCPTT user for originating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif the <request-type> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request is set to a value of \"fa-group-binding-req\" and:\na) the <allow-functional-alias-binding-with-group> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"176 user not authorized to request for binding/unbinding of a functional alias with the MCPTT group(s) for the MCPTT user\" in a Warning header field, and shall not continue with the rest of the steps in this clause;\nb)\tthe SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or the <binding-ind> element and the <binding-fa-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"unable to determine target functional alias or group for creating/removing a binding information for the MCPTT user\" in a Warning header field, and shall not continue with the rest of the steps in this clause; and\nc)\tthe SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or the <binding-ind> element and the <unbinding-fa-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"177 unable to determine target functional alias or group for creating/removing a binding information for the MCPTT user\" in a Warning header field, and shall not continue with the rest of the steps in this clause;\n5)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n6)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function for the binding of a functional alias with the MCPTT group(s) for the MCPTT user service associated with the originating user's MCPTT ID identity;\n7)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n8)\tif the received SIP MESSAGE request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, shall check the status of the functional alias for the MCPTT ID. If the functional alias status is activated, then the participating MCPTT function shall set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request to the received value, otherwise it shall not include a <functional-alias-URI> element;\n9)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n10)\tshall copy the contents of the application/resource-lists+xml MIME body in the received SIP MESSAGE request into an application/resource-lists+xml MIME body in the outgoing SIP MESSAGE request;\n11) shall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n12)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n13)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n14)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n15)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 15):\n1)\tshall generate a SIP 200 (OK) response as specified in 3GPP TS 24.229 [4] with the following clarifications:\na)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function; and\n2)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the error response to the MCPTT client.\nThe participating MCPTT function has procedures to:\n-\treceive a request for binding/unbinding of a functional alias with the MCPTT group(s) for the MCPTT user from the MCPTT Client.\nUpon receiving a:\n-\t\"SIP MESSAGE request for binding of a functional alias with the MCPTT group(s) for the MCPTT user for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tthe SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or the <binding-ind> element and the <binding-fa-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"177 unable to determine target functional alias or group for creating/removing a binding information for the MCPTT user\" in a Warning header field, and shall not continue with the rest of the steps in this clause;\n4)\tthe SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or the <binding-ind> element and the <unbinding-fa-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"177 unable to determine target functional alias or group for creating/removing a binding information for the MCPTT user\" in a Warning header field, and shall not continue with the rest of the steps in this clause;\n5)\tif any of the <entry> elements of a <list> element of the <resource-lists> element in the application/resource-lists+xml MIME body of the incoming SIP MESSAGE request contains a \"uri\" attribute set to an MCPTT group ID where the indicated MCPTT group has an existing binding with any other functional alias from same MCPTT user, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"178 MCPTT group binding already exists with other functional alias\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n6)\tif the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request contains the <request-type> element set to a value of \"fa-group-binding-req\" and:\na) if the <binding-ind> element is set to a value of \"true\", shall update or store the record for the MCPTT client, and create a binding information for the functional alias specified in the <binding-fa-uri> element with the list of the MCPTT group(s) included in an application/resource-lists+xml MIME body; or\nb) if the <binding-ind> element is set to a value of \"false\", shall update or store the record for the MCPTT client, and remove a binding information of the functional alias specified in the <unbinding-fa-uri> element from the list of the MCPTT group(s) included in an application/resource-lists+xml MIME body;\n7)\tshall generate a SIP 200 (OK) response as specified in 3GPP TS 24.229 [4] with the following clarifications:\na)\tshall include a P-Asserted-Identity header field set to the public service identity of the controlling MCPTT function; and\n8)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "10\tGroup call",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "10.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the group call procedures for on-network and off-network.\nFor on-network, prearranged group call including emergency group call for each functional entity are specified in clause 10.1.1 and chat group (restricted) call including emergency group call for each functional entity are specified in clause 10.1.2.\nOff-network group call and off-network broadcast group call are specified in clause 10.2 and clause 10.3.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "10.1\tOn-network group call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.1.1\tPrearranged group call",
                            "text_content": "Upon receiving a request from an MCPTT user to establish an MCPTT prearranged group session the MCPTT client shall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that calls are not allowed on the indicated group; and\n2)\tshall skip the remainder of this procedure.\nThe MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user has requested the origination of an MCPTT emergency group call or is originating an MCPTT prearranged group call and the MCPTT emergency state is already set, the MCPTT client shall comply with the procedures in clause 6.2.8.1.1;\n2)\tif the MCPTT user has requested the origination of an MCPTT imminent peril group call, the MCPTT client shall comply with the procedures in clause 6.2.8.1.9;\n3)\tif the MCPTT user has requested the origination of a broadcast group call, the MCPTT client shall comply with the procedures in clause 6.2.8.2;\n4)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n7)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n8)\tshould include the \"timer\" option tag in the Supported header field;\n9)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n10)\tshall set the Request-URI of the SIP INVITE request to the public service identity identifying the participating MCPTT function serving the MCPTT user;\nNOTE 1:\tThe MCPTT client is configured with public service identity identifying the participating MCPTT function serving the MCPTT user.\n11)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n12)\tif the MCPTT client emergency group state for this group is set to \"MEG 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall include the Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2;\n13)\tif the MCPTT client imminent peril group state for this group is set to \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n14)\tshall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"prearranged\";\nb)\tthe <mcptt-request-uri> element set to the group identity;\nc)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nNOTE 2:\tThe MCPTT client does not include the MCPTT ID of the originating MCPTT user in the body, as this will be inserted into the body of the SIP INVITE request that is sent from the originating participating MCPTT function.\nd)\tif the group identity identifies a temporary group or a group regroup based on preconfigured group, the <associated-group-id> element set to the MCPTT group ID of a constituent group the MCPTT client is member of;\ne)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the initial SIP INVITE request, the <anyExt> element with the <functional-alias-URI> set to the URI of the used functional alias;\nNOTE 3:\tThe MCPTT client is informed about temporary groups regrouping MCPTT groups that the user is a member of as specified in 3GPP TS 24.481 [31]. The MCPTT client is informed about regroups based on a preconfigured group of MCPTT groups that the user is member of and affiliated to as specified in clause 16 of the present document.\nNOTE 4:\tIf the MCPTT user selected a TGI or the identity of a group regroup based on a preconfigured group where there are several constituent MCPTT groups where the MCPTT user is a member, the MCPTT client selects one of those MCPTT groups.\nNOTE 5:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nf)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value; and\ng)\tif the call request is a result of receiving a remotely initiated call request, shall include the <anyExt> element with the <remotely-initiated-call-request-ind> element set to \"true\";\n15)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1;\n16)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n17)\tshall send the SIP INVITE request towards the MCPTT server according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform the actions specified in clause 6.2.8.1.4;\n2A)\tmay notify the answer state to the user (i.e. \"Unconfirmed\" or \"Confirmed\") if received in the P-Answer-State header field; and\n3)\tmay subscribe to the conference event package as specified in clause 10.1.3.1.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\"; or\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";\nthe MCPTT client shall perform the actions specified in clause 6.2.8.1.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of an initial SIP INVITE request, the MCPTT client shall follow the procedures for termination of multimedia sessions in the IM CN subsystem as specified in 3GPP TS 24.229 [4] with the clarifications below.\nThe MCPTT client:\n1)\tmay reject the SIP INVITE request if any of the following conditions are met:\na)\tMCPTT client does not have enough resources to handle the call;\nb)\tthe number of the maximum simultaneous MCPTT emergency group calls supported for the specific calling functional alias as specified in the <MaxSimultaneousEmergencyGroupCalls> element within the <FunctionalAliasList> list element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been reached; or\nc)\tany other reason outside the scope of this specification;\n2)\tif the SIP INVITE request is rejected in step 1), shall respond toward participating MCPTT function either with appropriate reject code as specified in 3GPP TS 24.229 [4] and warning texts as specified in clause 4.4.2 or with SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure and skip the rest of the steps of this clause;\nNOTE:\tIf the SIP INVITE request contains an emergency indication or imminent peril indication, the MCPTT client can by means beyond the scope of this specification choose to accept the request.\n3)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n4)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT emergency group call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT emergency group call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nii)\tshould display the MCPTT group identity of the group with the emergency condition contained in the <mcptt-calling-group-id> element; and\niii)\tif the <alert-ind> element is set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information;\nb)\tshall set the MCPTT emergency group state to \"MEG 2: in-progress\";\nc)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nd)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\"; otherwise\n5)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT imminent peril group call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT imminent peril group call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tshould display the MCPTT group identity of the group with the imminent peril condition contained in the <mcptt-calling-group-id> element; and\nb)\tshall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";\n6)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user;\n6A)\tmay display to the MCPTT user the functional alias of the inviting MCPTT user;\n6B)\tif the <remotely-initiated-call-request-ind> element is included in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request, may indicate to the MCPTT user that the received call request is a result of receiving a remotely initiated call request;\n7)\tshall perform the automatic commencement procedures specified in clause 6.2.3.1.2 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode; or\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode, yet the invited MCPTT client allows the call to be answered with automatic commencement mode;\n8)\tshall perform the manual commencement procedures specified in clause 6.2.3.2.2 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is to use manual commencement mode; or\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode, yet the invited MCPTT client allows the call to be answered with manual commencement mode; and\n9)\twhen the SIP 200 (OK) response to the SIP INVITE request is sent, may subscribe to the conference event package as specified in clause 10.1.3.1.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to upgrade the MCPTT group call to an emergency condition or an imminent peril condition on an MCPTT prearranged group, the MCPTT client shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the clarifications given below.\n1)\tif the MCPTT user is requesting to upgrade the MCPTT group call to an in-progress emergency group state and this is an unauthorised request for an MCPTT emergency call as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to upgrade the MCPTT group call to an in-progress emergency group state; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tif the MCPTT user is requesting to upgrade the MCPTT group call to an in-progress imminent peril state and this is an unauthorised request for an MCPTT imminent peril group call as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to upgrade the MCPTT group call to an in-progress imminent peril group state; and\nb)\tshall skip the remaining steps of the current clause;\n3)\tif the MCPTT user has requested to upgrade the MCPTT group call to an MCPTT emergency call, the MCPTT client:\na)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.2.8.1.1; and\nb)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2.\n4)\tif the MCPTT user has requested to upgrade the MCPTT group call to an MCPTT imminent peril call, the MCPTT client:\na)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.2.8.1.9; and\nb)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n5)\tif the SIP re-INVITE request is to be sent within an on-demand session, shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n6)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n7)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n8)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5]; and\n2)\tshall perform the actions specified in clause 6.2.8.1.4.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nOn receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the SIP re-INVITE request the MCPTT client shall perform the actions specified in clause 6.2.8.1.5.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to cancel the in-progress emergency condition on a prearranged MCPTT group, the MCPTT client shall generate a SIP re-INVITE request while in an ongoing prearranged group call by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below, otherwise generate a SIP MESSAGE request by following client procedure of clause 12.1.1.5 of present document.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress emergency group state of the MCPTT group as determined by the procedures of clause 6.2.8.1.7, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress emergency group state of the MCPTT group; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and optionally an MCPTT emergency alert originated by the MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.3;\n3)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and an MCPTT emergency alert originated by another MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.14;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"prearranged\"; and\nb)\tthe <mcptt-request-uri> element set to the group identity;\nNOTE 1:\tThe MCPTT ID of the originating MCPTT user is not included in the body, as this will be inserted into the body of the SIP INVITE request that is sent by the originating participating MCPTT function.\n5)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP re-INVITE request according to IETF RFC 3840 [16];\n6)\tif the SIP re-INVITE request is to be sent within an on-demand session, shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n7)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE 2:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n8)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2; and\n9)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tshall set the MCPTT emergency group state of the group to \"MEG 1: no-emergency\";\n3)\tshall set the MCPTT emergency group call state of the group to \"MEGC 1: emergency-gc-capable\"; and\n4)\tif the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\", the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the SIP 2xx response to the SIP request for a priority group call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state to \"MEA 1: no-alert\".\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request:\n1)\tshall set the MCPTT emergency group state as \"MEG 2: in-progress\";\n2)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\" and the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\n3)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response did not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element and did not contain an <originated-by> element, the MCPTT emergency alert (MEA) state shall revert to its value prior to entering the current procedure.\nNOTE 3:\tIf the in-progress emergency group state cancel request is rejected, the state of the session does not change, i.e. continues with MCPTT emergency group call level priority.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to cancel the in-progress imminent peril condition on a prearranged MCPTT group, the MCPTT client shall generate a SIP re-INVITE request by following the procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress imminent peril group state of the MCPTT group as determined by the procedures of clause 6.2.8.1.10, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress imminent peril group state of the MCPTT group; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.11; and\n3)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"prearranged\"; and\nb)\tthe <mcptt-request-uri> element set to the group identity;\nNOTE 1:\tThe MCPTT ID of the originating MCPTT user is not included in the body, as this will be inserted into the body of the SIP re-INVITE request that is sent by the originating participating MCPTT function.\n5)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP re-INVITE request according to IETF RFC 3840 [16];\n6)\tif the SIP re-INVITE request is to be sent within an on-demand session, shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n7)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session; and\nNOTE 2:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n8)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tshall set the MCPTT imminent peril group state of the group to \"MIG 1: no-imminent-peril\"; and\n3)\tshall set the MCPTT imminent peril group call state of the group to \"MIGC 1: imminent-peril-gc-capable\".\nOn receiving a SIP 4xx, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request:\n1)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response:\na)\tcontains an application/vnd.3gpp.mcptt-info+xml MIME body with an <imminentperil-ind> element set to a value of \"true\"; or\nb)\tdoes not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an <imminentperil-ind> element;\nthen the MCPTT client shall set the MCPTT imminent peril group state as \"MIG 2: in-progress\".\nNOTE 3:\tThis is the case where the MCPTT client requested the cancellation of the MCPTT imminent peril in-progress state and was rejected.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request the MCPTT client:\n1)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user the MCPTT ID of the originator of the MCPTT emergency group call and an indication that this is an MCPTT emergency group call;\nb)\tif the <mcpttinfo> element containing the <mcptt-Params> element contains an <alert-ind> element set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information;\nc)\tshall set the MCPTT emergency group state to \"MEG 2: in-progress\";\nd)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\ne)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\";\n2)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user the MCPTT ID of the originator of the MCPTT imminent peril group call and an indication that this is an MCPTT imminent peril group call; and\nb)\tshall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";\n3)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user the MCPTT ID of the MCPTT user cancelling the MCPTT emergency group call;\nb)\tif the <mcpttinfo> element containing the <mcptt-Params> element contains an <alert-ind> element set to \"false\":\ni)\tshould display to the MCPTT user an indication of the MCPTT emergency alert cancellation and the MCPTT ID of the MCPTT user cancelling the MCPTT emergency alert; and\nii)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body including an <originated-by> element:\nA)\tshould display to the MCPTT user the MCPTT ID contained in the <originated-by> element of the MCPTT user that originated the MCPTT emergency alert; and\nB)\tif the MCPTT ID contained in the <originated-by> element is the MCPTT ID of the receiving MCPTT user shall set the MCPTT emergency alert state to \"MEA 1: no-alert\";\nc)\tshall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and\nd)\tif the MCPTT emergency group call state of the group is set to \"MEGC 3: emergency-call-granted\", shall set the MCPTT emergency group call state of the group to \"MEGC 1: emergency-gc-capable\";\n4)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user the MCPTT ID of the MCPTT user cancelling the MCPTT imminent peril group call and an indication that this is an MCPTT imminent peril group call;\nb)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nc)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\";\n5)\tshall check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n6)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n7)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP 200 (OK) response;\n8)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP 200 (OK) response;\n9)\tif the SIP re-INVITE request was received within an on-demand session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2;\n10)\tif the SIP re-INVITE request was received within a pre-established session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE:\tThe SIP re-INVITE request can be received within an on-demand session or a pre-established session. If the SIP re-INVITE request is received within a pre-established session, the media-level section for the MCPTT speech media stream and the media-level section of the media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n11)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4]; and\n12)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving a request from an MCPTT user to establish an MCPTT group session using an MCPTT group identity identifying a prearranged MCPTT group within the pre-established session, the MCPTT client shall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that calls are not allowed on the indicated group; and\n2)\tshall skip the remainder of this procedure.\nThe MCPTT client shall generate a SIP REFER request outside a dialog as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], and in accordance with the UE procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client shall follow the procedures specified in clause 10.1.2.2.2.1 with the clarification in step 3) of clause 10.1.2.2.2.1 that:\n1)\tan <entry> element of a <list> element of the <resource-lists> element in the application/resource-lists+xml MIME body shall contain a \"uri\" attribute set to the prearranged MCPTT group identity;\n2)\tthe <session-type> element of the application/vnd.3gpp.mcptt-info MIME body in the hname \"body\" parameter in the headers portion of the SIP URI shall be set to a value of \"prearranged\"; and\n3)\tif the MCPTT user has requested the origination of a broadcast group call, the MCPTT client shall comply with the procedures in clause 6.2.8.2.\nUpon receiving a SIP re-INVITE request within a pre-established session without an associated MCPTT call or when generating SIP responses to the SIP re-INVITE request, the MCPTT client shall follow the procedures in clause 10.1.1.2.1.2.\nNOTE:\tIn clause 10.1.1.2.1.2, the reader is assumed to replace occurrences of SIP INVITE request with SIP re-INVITE request.\nWhen an MCPTT client wants to leave the MCPTT session that has been established using on-demand session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.1.\nWhen an MCPTT client wants to leave the MCPTT call within a pre-established session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.2.\nUpon receiving a SIP BYE request for releasing the prearranged MCPTT group call, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nUpon receiving a request from an MCPTT user to rejoin an ongoing MCPTT session or triggered by coming back from out of coverage, the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nNOTE:\tHow an MCPTT client is informed whether it comes back from out of coverage is out of scope of present document.\nThe MCPTT client shall follow the procedures specified in clause 10.1.1.2.1.1 with the clarification in step 10) of clause 10.1.1.2.1.1 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity to rejoin.\nUpon receiving a request from an MCPTT user to rejoin an ongoing MCPTT call within the pre-established session or triggered by coming back from out of coverage, the MCPTT client shall generate a SIP REFER request as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], and in accordance with the UE procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client shall follow the procedures specified in clause 10.1.1.2.2.1 with the clarification in step 3) of clause 10.1.2.2.2.1 that the Refer-To header field of the SIP REFER request:\n1)\tshall contain a URI of the MCPTT session identity to rejoin; and\n2)\tshall contain a Content-Type header field in the headers portion of the SIP URI containing an application/vnd.3gpp.mcptt-info+xml MIME type of the hname \"body\" parameter in the headers portion of the SIP URI and the hname \"body\" parameter in the headers portion of the SIP URI containing the <mcpttinfo> element with the <mcptt-Params> element and with the <session-type> element set to a value of \"prearranged\".\nIn the procedures in this clause:\n1)\tgroup identity in an incoming SIP INVITE request refers to the group identity from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"prearranged\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE 1:\tif the SIP INVITE request contains an emergency indication or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif through local policy in the participating MCPTT function, the user identified by the MCPTT ID is not authorised to initiate prearranged group calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response to the SIP INVITE request, with warning text set to \"109 user not authorised to make prearranged group calls\" in a Warning header field as specified in clause 4.4;\n4)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the SIP INVITE request shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n5)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the participating MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\nNOTE 3:\tIf the SIP INVITE request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow for an exception to the limit for the maximum simultaneous MCPTT sessions supported for the MCPTT user.\n6)\tif the user identified by the MCPTT ID is not affiliated to the group identified in the <mcptt-request-uri> or in <associated-group-id> element of the \"SIP INVITE request for originating participating MCPTT function\" as determined by clause 9.2.2.2.11 and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, shall perform the actions specified in clause 9.2.2.2.12 for implicit affiliation;\n7)\tif the actions for implicit affiliation specified in step 6) above were performed but not successful in affiliating the MCPTT user due to the MCPTT user already having N2 simultaneous affiliations (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 486 (Busy Here) response with the warning text set to \"102 too many simultaneous affiliations\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps.\nNOTE 4:\tN2 is the total number of MCPTT groups that an MCPTT user can be affiliated to simultaneously as specified in 3GPP TS 23.379 [3].\nNOTE 5:\tif the SIP INVITE request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow an exception to the N2 limit (specified in the <MaxAffiliationsN2> element of the <Common> element of the MCPTT user profile of the served MCPTT ID). Alternatively, a lower priority affiliation of the MCPTT user could be cancelled to allow for the new affiliation.\nIf the incoming SIP INVITE request does not contain an <associated-group-id> element, then the group identity contained in the <mcptt-request-uri> element is determined not to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity in the SIP INVITE request. If the participating MCPTT function is unable to identify the controlling MCPTT function for the on demand prearranged group call, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 6:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 7:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 8:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 9:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 10:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.3;\n3)\tshall set the Request-URI to the public service identity of the controlling MCPTT function determined in step 8;\n4)\tshall not copy the following header fields from the incoming SIP INVITE request to the outgoing SIP INVITE request, if they were present in the incoming SIP INVITE request:\na)\tAnswer-Mode header field as specified in IETF RFC 5373 [18]; and\nb)\tPriv-Answer-Mode header field as specified in IETF RFC 5373 [18];\n5)\tshall set the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the MCPTT ID of the calling user;\n6)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the MCPTT client as specified in clause 6.3.2.1.1.1;\n6a)\tif the received SIP request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, then check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request to the received value, if the status is unequal activated then do not include a <functional-alias-URI> element;\nNOTE 11:\tThe participating MCPTT server learns the functional alias state for an MCPTT ID from procedures specified in clause 9A.2.2.2.7.\n7)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause F.3 and if not already copied, shall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml MIME body received in the SIP INVITE request into an application/vnd.3gpp.mcptt-location-info+xml MIME body included in the outgoing SIP request;\n8)\tif a Resource-Priority header field was included in the received SIP INVITE request, shall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the SIP INVITE request from the MCPTT client;\nNOTE 12:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n9)\tif, according to clause 6.4, the SIP INVITE request is regarded as being received with an implicit request to grant the floor to the originating MCPTT client:\nif:\na)\tthe incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has the location of the originating MCPTT client available; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n10)\tshall forward the SIP INVITE request, according to 3GPP TS 24.229 [4].\nIf incoming SIP INVITE request contains an <associated-group-id> element, then the group identity contained in the <mcptt-request-uri> element is determined to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.10;\n2)\tshall include an SDP offer based upon the SDP offer in the received SIP INVITE request from the MCPTT client as specified in clause 6.3.2.1.1.1; and\n3)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the above SIP INVITE request, the participating MCPTT function:\n1)\tvoid;\n2)\tshall generate a SIP 200 (OK) response as in clause 6.3.2.1.5.2 with the clarification that if an <MKFC-GKTPs> element was contained in the received SIP 2xx response it is not included in the generated SIP 200 (OK) response;\nNOTE 13:\tIf an <MKFC-GKTPs> element is received in a SIP 2xx response, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the originating client.\n3)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n4)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n5)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n6)\tshall include an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response;\n6A)\tshall include the answer state into the P-Answer-State header field of the outgoing SIP 200 (OK) response, if received in the P-Answer-State header field of the incoming SIP 200 (OK) response;\n7)\tif the procedures of clause 9.2.2.2.12 for implicit affiliation were performed in the present clause, shall complete the implicit affiliation by performing the procedures of clause 9.2.2.2.13;\n8)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4];\n9)\tshall interact with Media Plane as specified in 3GPP TS 24.380 [5]; and\n10)\tshall start the SIP Session timer according to rules and procedures of IETF RFC 4028 [7].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response;\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4]; and\n4)\tif the implicit affiliation procedures of clause 9.2.2.2.12 were invoked in this procedure, shall perform the procedures of clause 9.2.2.2.14.\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header field containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing an <entry> element with a \"uri\" attribute containing a SIP URI set to a pre-arranged group identity;\n2)\tan hname \"body\" parameter in the headers portion of the SIP URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"prearranged\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP REFER request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\nNOTE 1:\tIf the application/vnd.3gpp.mcptt-info MIME body included in the SIP REFER request as described at the top of the present clause contains an <emergency-ind> element or <imminentperil-ind> element set to a value of \"true\", and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif through local policy in the participating MCPTT function, the user identified by the MCPTT ID is not authorised to initiate prearranged group calls, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response to the SIP REFER request, with warning text set to \"109 user not authorised to make prearranged group calls\" in a Warning header field as specified in clause 4.4;\n5)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the participating MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nNOTE 3:\tIf the SIP REFER request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow for an exception to the limit for the maximum simultaneous MCPTT sessions supported for the MCPTT user.\n6)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\n7)\tif received SIP REFER request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.2.1.8.3;\n8)\tif the SIP REFER request contains in the application/vnd.3gpp.mcptt-info+xml MIME body:\na)\tan <emergency-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency group call as determined by clause 6.3.2.1.8.1;\nb)\tan <alert-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as determined by clause 6.3.2.1.8.2; or\nc)\tan <imminentperil-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT imminent peril group call as determined by clause 6.3.2.1.8.1;\nthen shall reject the SIP REFER request with a SIP 403 (Forbidden) response and skip the rest of the steps;\n9)\tshall retrieve the group identity within the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body referenced by the \"cid\" URL contained in the Refer-To header field of the SIP REFER request;\n10)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity within the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element in the application/resource-lists+xml MIME body referenced by the Refer-To header of the SIP REFER request. If the participating MCPTT function is unable to identify the controlling MCPTT function associated with the group identity, it shall reject the REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 4:\tThe public service identity can identify the controlling function in the primary MCPTT system or a part in ner MCPTT system.\nNOTE 5:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 6:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 7:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 8:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n11)\tif the user identified by the MCPTT ID is not affiliated to the group identified in the SIP REFER request as determined by clause 9.2.2.2.11 and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, shall perform the actions specified in clause 9.2.2.2.12 for implicit affiliation;\n12)\tif the actions for implicit affiliation specified in step 11) above were performed but not successful in affiliating the MCPTT user due to the MCPTT user already having N2 simultaneous affiliations (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall reject the SIP REFER request with a SIP 486 (Busy Here) response with the warning text set to \"102 too many simultaneous affiliations\" in a Warning header field as specified in clause 4.4. and skip the rest of the steps.\nNOTE 9:\tN2 is the total number of MCPTT groups that an MCPTT user can be affiliated to simultaneously as specified in 3GPP TS 23.379 [3].\nNOTE 10:\tIf the SIP REFER request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow an exception to the N2 limit (specified in the <MaxAffiliationsN2> element of the <Common> element of the MCPTT user profile of the served MCPTT ID). Alternatively, a lower priority affiliation of the MCPTT user could be cancelled to allow for the new affiliation.\n13)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP TS 24.229 [4];\nNOTE 11:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n14)\tshall send the response to the \"SIP REFER request for a pre-established session\" towards the MCPTT client according to 3GPP TS 24.229 [4];\n15)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.4;\n16)\tshall set the Request-URI of the SIP INVITE request to the public service identity determined in step 10;\n17)\tshall copy the group identity from the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body pointed to by the \"cid\" URL in the Refer-to header field of the SIP REFER request, to the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request;\n18)\tif the received SIP REFER request contained a Resource-Priority header field, shall include in the outgoing SIP INVITE request a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request from the MCPTT client;\nNOTE 12:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n18a)\tif, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n19)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving SIP provisional responses for the SIP INVITE request the participating MCPTT function:\n1)\tshall discard the received SIP responses without forwarding them.\nUpon receipt of a SIP 302 (Moved Temporarily) response to the SIP INVITE request the participating MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.10;\n2)\tshall include in the SIP INVITE request an SDP offer based upon the SDP offer negotiated during the pre-established session establishment, any subsequent pre-established session modification and the SDP offer (if any) included in the hname \"body\" parameter in the headers portion of the SIP URI contained in the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL in the Refer-To header field in the incoming SIP REFER request from the MCPTT client; and\n3)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tif the procedures of clause 9.2.2.2.12 for implicit affiliation were performed in the present clause, shall complete the implicit affiliation by performing the procedures of clause 9.2.2.2.13; and\n3)\tif the received SIP 2xx response was in response to a request for an MCPTT group call containing a Resource-Priority header field populated for an MCPTT emergency group call or MCPTT imminent peril group call as specified in clause 6.3.2.1.8.4 and does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\":\na)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.5; and\nb)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nNOTE 13:\tThere are two cases covered in the handling of the received SIP 2xx response above. The first case is when the SIP INVITE request sent to the controlling MCPTT function contained a Resource-Priority header field populated appropriately to request emergency level or imminent peril level priority but did not contain in the application/vnd.3gpp.mcptt-info+xml MIME body either an <emergency-ind> element or an <imminentperil-ind> element. The second case is when the SIP INVITE request sent to the controlling MCPTT function contained a Resource-Priority header field and contained either an <emergency-ind> element or an <imminentperil-ind> element. In either case, the received SIP 2xx response did not warn of a pending SIP INFO request.\nUpon receiving a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency call or MCPTT imminent peril call, the participating MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.5; and\n3)\tshall send the SIP re-INVITE request to the MCPTT client according to 3GPP TS 24.229 [4].\nNOTE 14:\tThis is the case where the SIP REFER request previously received from the MCPTT client contained a Resource-Priority header field populated for an MCPTT emergency group call or MCPTT imminent peril group call as specified in clause 6.3.2.1.8.4 but was also a request either an MCPTT emergency group call or an MCPTT imminent peril group call.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request in step 19) the participating MCPTT function:\n1)\tif the implicit affiliation procedures of clause 9.2.2.2.12 were invoked in this procedure, shall perform the procedures of clause 9.2.2.2.14; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request for an MCPTT session identifying an on-demand prearranged MCPTT group session or pre-established session, the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tIf the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the participating MCPTT function can choose to accept the request.\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\nNOTE 2:\tIf the received SIP re-INVITE request is received within a pre-established session associated with an MCPTT group session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n3)\tshall generate an outgoing SIP re-INVITE request as specified in clause 6.3.2.1.9;\n4)\tshall include the MCPTT ID of the originating user in <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request;\n5)\tshall, if the SIP re-INVITE request was received within an on-demand session, include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP re-INVITE request as specified in clause 6.3.2.1.1;\n6)\tshall, if the SIP re-INVITE request was received within a pre-established session, include in the SIP re-INVITE request an SDP offer based upon the previously negotiated SDP for the pre-established session as specified in clause 6.3.2.1.1.2;\n7)\tif the received SIP re-INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field; and\nNOTE 3:\tThe controlling MCPTT function will determine the validity of the Resource-Priority header field.\n8)\tshall forward the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP re-INVITE request in step 7) the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n5)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4]; and\n6)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receipt of a SIP 403 (Forbidden) response to the above SIP INVITE request in step 7) the participating MCPTT function:\n1)\tshall generate a SIP 403 (Forbidden) response according to 3GPP TS 24.229 [4];\n2)\tshall copy, if included in the received SIP 403 (Forbidden) response, the application/vnd.3gpp.mcptt-info+xml MIME body MIME body to the outgoing SIP (Forbidden) response;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 403 (Forbidden) response;\n4)\tshall forward the SIP 403 (Forbidden) response to the MCPTT client according to 3GPP TS 24.229 [4]; and\n5)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24], and shall not continue with the rest of the steps;\nNOTE 1:\tif the SIP INVITE request contains an emergency indication or an imminent peril indication set to a value of \"true\", the terminating participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall check the presence of the isfocus media feature tag in the Contact header field and if it is not present then the participating MCPTT function shall reject the request with a SIP 403 (Forbidden) response with the warning text set to \"104 isfocus not assigned\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n3)\tif the Answer-Mode Indication in the application/poc-settings+xml MIME body has not yet been received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4, shall reject the request with a SIP 480 (Temporarily Unavailable) response with the warning text set to \"146 T-PF unable to determine the service settings for the called user\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request to retrieve the binding between the MCPTT ID and public user identity;\n5)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n6)\tvoid;\nNOTE 2:\tIf an <MKFC-GKTPs> element is received in a SIP INVITE request, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the terminating client.\n7)\tshall perform the automatic commencement procedures specified in clause 6.3.2.2.5.1 and according to IETF RFC 5373 [18] if the \"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\"; and\n8)\tshall perform the manual commencement procedures specified in clause 6.3.2.2.6.1 and according to IETF RFC 5373 [18] if the \"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"manual-answer\".\nUpon receiving from the MCPTT client a SIP BYE request the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.6.\nUpon receiving from the MCPTT client a SIP REFER request when using a pre-established session with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.7.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.1.\nUpon receiving a SIP BYE request from the controlling MCPTT function and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.2.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"prearranged\", the participating MCPTT function shall follow the procedures specified in clause 10.1.1.3.1.1 with the clarification in step 10) of clause 10.1.1.3.1.1 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity which mapped to the MCPTT session identity provided in Request-URI of the \"SIP INVITE request for originating participating MCPTT function\".\nUpon receipt of a \"SIP REFER request for a pre-established session\", with the Refer-To header containing an application/vnd.3gpp.mcptt-info+xml MIME type content in an hname \"body\" parameter in the headers portion of the SIP URI and with the <session-type> element set to \"prearranged\" the participating MCPTT function shall follow the procedures specified in clause 10.1.1.3.1.2 with the clarification in step 16) of clause 10.1.1.3.1.2 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity which mapped to the MCPTT session identity provided in the Refer-to header field of the \"SIP REFER request for a pre-established session\".\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a SIP re-INVITE request for a terminating MCPTT client of a MCPTT group containing an emergency indication or imminent peril indication, the participating MCPTT function:\n1)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n2)\tshall generate an outgoing SIP re-INVITE request as specified in clause 6.3.2.2.10;\n3)\tshall include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP re-INVITE request as specified in clause 6.3.2.2.1; and\n4)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP re-INVITE request sent to the MCPTT client, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n4)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 10.1.1.4.2 or as the result of receiving a SIP 403 (Forbidden) response as described in this clause.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\n2)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user to be invited.;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the MCPTT user to be invited or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n3)\tshall set the P-Asserted-Identity header field to the public service identity of the controlling MCPTT function;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request:\na)\tthe <mcptt-request-uri> element set to the MCPTT ID of the terminating user; and\nb)\tthe <mcptt-calling-group-id> element set to the group identity;\nNOTE 6:\tThe <mcptt-calling-user-id> is already included in the MIME body as a result of calling clause 6.3.3.1.2 in step 1).\n5)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1;\n6)\tif the in-progress emergency state of the group is set to a value of \"true\" the controlling MCPTT function:\na)\tshall include a Resource-Priority header field populated with the values for an MCPTT emergency group call as specified in clause 6.3.3.1.19;\nb)\tif the received SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\":\ni)\tshall include in the outgoing SIP INVITE request in the application/vnd.3gpp.mcptt-info+xml MIME body an <emergency-ind> element set to a value of \"true\"; and\nii)\tif the <alert-ind> element is set to \"true\" in the received SIP INVITE request and the requesting MCPTT user and MCPTT group are authorised for the initiation of MCPTT emergency alerts as determined by the procedures of clause 6.3.3.1.13.1, shall populate the application/vnd.3gpp.mcptt-info+xml MIME body and the application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause 6.3.3.1.12. Otherwise, shall set the <alert-ind> element to a value of \"false\"; and\nc)\tif the in-progress imminent peril state of the group is set to a value of \"true\" shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <imminentperil-ind> element set to a value of \"false\";\n7)\tif the in-progress emergency state of the group is set to a value of \"false\" and the in-progress imminent peril state of the group is set to a value of \"true\", the controlling MCPTT function:\na)\tshall include a Resource-Priority header field populated with the values for an MCPTT imminent peril group call as specified in clause 6.3.3.1.19; and\nb)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\";\n8)\tvoid\n9)\tshall send the SIP INVITE request towards the terminating network in accordance with 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response containing a Require header field with the option tag \"100rel\" and containing a P-Answer-State header field with the value \"Unconfirmed\" in response to the SIP INVITE request the controlling MCPTT function:\n1)\tshall send a SIP PRACK request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\n2)\tshall send a SIP NOTIFY request to all participants with a subscription to the conference event package as specified in clause 10.1.3.4; and\n3)\tshall increment the local counter of the number of SIP 200 (OK) responses received from invited members, by 1.\nNOTE 7:\tThe notifications above could be sent prior to the SIP 200 (OK) response being sent to the inviting MCPTT client. These notifications received by MCPTT clients that are group members do not mean that the group session will be successfully established.\nNOTE 8:\tThe procedures executed by the controlling MCPTT function prior to sending a response to the inviting MCPTT client are specified in clause 10.1.1.4.2.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\n2)\tshall set the Request-URI to the public service identity of the non-controlling MCPTT function serving the group identity of the MCPTT group owned by the partner MCPTT system;\nNOTE 1:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 2:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 3:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function serving the MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 4:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n3)\tshall set the P-Asserted-Identity to the public service identity of the controlling MCPTT function;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request:\na)\tthe <mcptt-request-uri> element set to the group identity of the MCPTT group hosted by the non-controlling MCPTT function in the partner MCPTT system; and\nb)\tthe <mcptt-calling-group-id> element set to the group identity of the group served by the controlling MCPTT function;\n5)\tshall include the Recv-Info header field set to g.3gpp.mcptt-floor-request;\n6)\tvoid\n7)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1; and\n8)\tshall send the SIP INVITE request towards the partner MCPTT system in accordance with 3GPP TS 24.229 [4].\nUpon receiving SIP 403 (Forbidden) response for the SIP INVITE request, if according to local policy and if:\n1)\tthe response contains a Warning header field with the MCPTT warning code \"128\"; and\n2)\tthe response contains a P-Refused-URI-List header field and an application/resource-lists+xml MIME body as specified in IETF RFC 5318 [36];\nNOTE 5:\tThe application/resource-lists+xml MIME body contains MCPTT IDs identifying MCPTT users in a partner MCPTT system that needs to be invited to the prearranged group call in case of group regrouping using interrogating method as specified in 3GPP TS 23.379 [3] clause 10.6.2.4.2.\nthen the controlling MCPTT function:\n1)\tshall check if the number of members of the MCPTT group exceeds the value contained in the <on-network-max-participant-count> element of the group document as specified in 3GPP TS 24.481 [31]. If exceeded, the controlling MCPTT function shall invite only <on-network-max-participant-count> members from the application/resource-lists+xml MIME body; and\nNOTE 6:\tThe <on-network-max-participant-count> element indicates the maximum number of participants allowed in the prearranged group session It is operator policy that determines which participants in the application/resource-lists+xml MIME body are invited to the group call.\n2)\tshall invite MCPTT users as specified in this clause using the list of MCPTT IDs in URI-List.\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 7:\tThe procedures executed by the controlling MCPTT function prior to sending a response to the inviting MCPTT client are specified in clause 10.1.1.4.2.\n2)\tif at least one of the invited MCPTT clients has subscribed to the conference package, shall subscribe to the conference event package in the non-controlling MCPTT function as specified in clause 10.1.3.4.3; and\n3)\tif the 200 (OK) response includes the <floor-state> element set to \"floor-taken\", shall wait for a SIP INFO request containing a floor request from the non-controlling MCPTT function.\nUpon receiving a SIP INFO request containing a floor request where:\n1)\tthe Request-URI contains an MCPTT session ID identifying an ongoing temporary group session; and\n2)\tthe application/vnd.3gpp.mcptt-info+xml MIME body contains the <mcptt-calling-group-id> element with the MCPTT group ID of a MCPTT group invited to the temporary group session;\nthen the controlling MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the non-controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.\nIn the procedures in this clause:\n1)\tMCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the originating user from the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\tgroup identity in an incoming SIP INVITE request refers to the group identity from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n3)\tMCPTT ID in an outgoing SIP INVITE request refers to the MCPTT ID of the called user in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request;\n4)\tindication of required group members in a SIP 183 (Session Progress) response refers to the <required> element of the application/vnd.3gpp.mcptt-info+xml MIME body set to \"true\" in a SIP 183 (Session Progress) sent by the non-controlling MCPTT function of an MCPTT group;\n5)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n6)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a \"SIP INVITE request for controlling MCPTT function of an MCPTT group\", the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tif the SIP INVITE request contains an emergency indication or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating an MCPTT emergency group call as determined by clause 6.3.3.1.13.2, or for originating an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5, the controlling MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tif received SIP INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.3.1.17;\n5)\tif the group identity is associated with a group document maintained by the GMS:\nNOTE 2:\tHow the MCPTT server determines that a group identity represents a group for which a group document is stored in the GMS is an implementation detail.\na)\tshall retrieve the necessary group document(s) from the group management server for the group identity contained in the SIP INVITE request and carry out initial processing as specified in clause 6.3.5.2;\na1)\tif the group document contains a <list -service> element that contains a <preconfigured-group-use-only> element that is set to the value \"true\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"167 call is not allowed on the preconfigured group\" as specified in clause 4.4 \"Warning header field\" and skip the rest of the steps;\nb)\tif the group referred to by the group identity has been regrouped, shall:\ni)\tstop processing the SIP INVITE request;\nii)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"148 group is regrouped\" as specified in clause 4.4 \"Warning header field\";\niii)\tif the group referred to by the group identity has been regrouped based on a preconfigured group, shall send a copy of the notifying SIP MESSAGE that was generated and sent per clause 16.2.4.1 to the participating function for the MCPTT ID of the incoming SIP INVITE request; and\niv)\tskip the rest of the steps;\nc)\tif the result of the initial processing in clause 6.3.5.2 was that a SIP 4xx, 5xx or 6xx response to the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" has been sent, do not continue with the rest of the steps in this clause;\n6)\tif the group identity is associated with a user or group regroup based on a preconfigured group:\na)\tshall retrieve the stored information for the group identity;\nb)\tif there is no stored information for the group identity, the controlling MCPTT function:\ni)\tshall return a SIP 404 (Not Found) response with the warning text set to \"163 the group identity indicated in the request does not exist\" as specified in clause 4.4 \"Warning header field\" and shall not continue with the rest of the steps;\nNOTE 3:\tThe user or group regroup can have been removed very recently and the client has sent the group call request prior to receiving the removal notification.\n6a)\tif the group identity is associated with a TGI or the identity of a group regroup based a preconfigured group and the received SIP INVITE request does not include an <mcptt-calling-group-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall return a SIP 403 (Forbidden) response to \"SIP INVITE request for controlling MCPTT function of an MCPTT group\".\nNOTE 4:\tThis is the case where the MCPTT client has requested the setup of a regroup without including the identity of the constituent group, leading to the participating MCPTT function forwarding the SIP INVITE directly to the controlling MCPTT function. This is not allowed, since the originating client is required to include the identity of the constituent group.\n7)\tshall perform the actions as described in clause 6.3.3.2.2;\n8)\tshall maintain a local counter of the number of SIP 200 (OK) responses received from invited members and shall initialise this local counter to zero;\n9)\tshall determine if an MCPTT group call for the group identity is already ongoing by determining if an MCPTT session identity has already been allocated for the group call and the MCPTT session is active;\n10)\tif the SIP INVITE request contains an unauthorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n11)\tif the SIP INVITE request contains an unauthorised request for an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5, shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the following clarifications:\na)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\"; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n12)\tif a Resource-Priority header field is included in the SIP INVITE request:\na)\tif the Resource-Priority header field is set to the value indicated for emergency calls and the SIP INVITE request does not contain an emergency indication and the in-progress emergency state of the group is set to a value of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the rest of the steps; or\nb)\tif the Resource-Priority header field is set to the value indicated for imminent peril calls and the SIP INVITE request does not contain an imminent peril indication and the in-progress imminent peril state of the group is set to a value of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the rest of the steps;\n13)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element, the controlling MCPTT function can remember the location information contained in the <location-info> root element;\n14)\tif the MCPTT group call is not ongoing then:\na)\tif:\ni)\tthe user identified by the MCPTT ID is not affiliated to the group identity contained in the <mcptt-request-uri> element of the SIP INVITE request as specified in clause 6.3.6;\nii)\tthe group identity contained in an <mcptt-calling-group-id> element of the SIP INVITE request is not a constituent MCPTT group ID;\nNOTE 5:\tIf the SIP INVITE is for a temporary group or a group regroup based on preconfigured group, the affiliation of the calling user to the constituent group has been assured by the non-controlling MCPTT function of the constituent group before forwarding this SIP INVITE to the controlling function of the regroup.\niii)\tthe received SIP INVITE request does not contain an emergency indication or imminent peril indication; or\niv)\tthe received SIP INVITE request is an authorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2 or MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5 and the MCPTT user identified in the <mcptt-calling-user-id> of the SIP INVITE is determined to not be eligible for implicit affiliation as specified in clause 9.2.2.3.6;\nthen shall return a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4, and skip the rest of the steps below;\nb)\tif the user identified by the MCPTT ID is not authorised to initiate the prearranged group session as specified in clause 6.3.5.4, shall send a SIP 403 (Forbidden) response with the warning text set to: \"119 user is not authorised to initiate the group call\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\nc)\tif the received SIP INVITE request contains an authorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2 or MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5 and the MCPTT user is eligible to be implicitly affiliated with the MCPTT group as determined in step 14) a) iv) above, shall perform the implicit affiliation as specified in clause 9.2.2.3.7;\nd)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\ne)\tshall create a prearranged group session and allocate an MCPTT session identity for the prearranged group call, and shall handle timer TNG3 (group call timer) as specified in clause 6.3.3.5;\nf)\tif the group identity in the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" is a TGI or the identity of a group regroup based on a preconfigured group:\ni)\tshall, for each of the constituent MCPTT groups except for the calling MCPTT group identified in the <mcptt-calling-group-id> element of the incoming SIP INVITE, generate a SIP INVITE request towards the MCPTT server that owns the constituent MCPTT group identity by following the procedures in clause 10.1.1.4.1.2; and\nNOTE 6:\tThe MCPTT server that the SIP INVITE request is sent to acts as a non-controlling MCPTT function;\nii)\tshall send the SIP 200 (OK) response towards the inviting non-controlling MCPTT function according to 3GPP TS 24.229 [4];\ng)\tif the group identity in the SIP INVITE request for controlling MCPTT function of an MCPTT group is an MCPTT group ID:\ni)\tshall determine the members to invite to the prearranged MCPTT group call as specified in clause 6.3.5.5. If:\nA)\tthe number of affiliated members of the MCPTT group is lower than the value contained in the <on-network-minimum-number-of-affiliated-members> element of the group document as specified in 3GPP TS 24.481 [31]; or\nB)\tthe group document contains any <on-network-affiliation-to-group-required> group member as specified in 3GPP TS 24.481 [31] that is not affiliated;\nthen the controlling MCPTT function shall send a SIP 480 (Temporarily Unavailable) response to the MCPTT client that originated the group session with the warning text set to \"112 group call abandoned due to required group members not part of the group session\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\nii)\tif necessary, shall start timer TNG1 (acknowledged call setup timer) according to the conditions stated in clause 6.3.3.3;\niii)\tif the received SIP INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element set to a value of \"true\":\nA)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency call;\nB)\tif the received SIP INVITE contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, shall cache the information that the MCPTT user has initiated an MCPTT emergency alert; and\nC)\tif the in-progress emergency state of the group is set to a value of \"false\":\nI)\tshall set the value of the in-progress emergency state of the group to \"true\"; and\nII)\tshall start timer TNG2 (in-progress emergency group call timer) and handle its expiry as specified in clause 6.3.3.1.16;\niv)\tif the in-progress emergency state of the group is set to a value of \"false\" and if the received SIP INVITE request contains an imminent peril indication set to a value of \"true\", the controlling MCPTT function shall:\nA)\tshall cache the information that the MCPTT user has initiated an MCPTT imminent peril call; and\nB)\tif the in-progress imminent peril state of the group is set to a value of \"false\", shall set the in-progress imminent peril state of the group to a value of \"true\";\nv)\tshall invite each group member determined in step 13)g)i) above, to the group session, as specified in clause 10.1.1.4.1.1; and\nvi)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3; and\n15)\tif the MCPTT group call is ongoing then:\na)\tif:\ni)\tthe user identified by the MCPTT ID in the SIP INVITE request is not affiliated to the group identity contained in the <mcptt-request-uri> element of the SIP INVITE request as specified in clause 6.3.6;\nii)\tthe group identity contained in an <mcptt-calling-group-id> element of the SIP INVITE request is not a constituent MCPTT group ID;\niii)\tthe received SIP INVITE request does not contain an emergency indication or imminent peril indication; or\niv)\tthe received SIP INVITE request is an authorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2 or MCPTT imminent peril group call as determined clause 6.3.3.1.13.5 and is determined to not be eligible for implicit affiliation as specified in clause 9.2.2.3.6;\nthen shall return a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4, and skip the rest of the steps below;\nb)\tif the user identified by the MCPTT ID in the SIP INVITE request is not authorised to join the prearranged group session as specified in clause 6.3.5.3, shall send a SIP 403 (Forbidden) response with the warning text set to \"121 user is not authorised to join the group call\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\nc)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\nd)\tif <on-network-max-participant-count> as specified in 3GPP TS 24.481 [31] is already reached:\ni)\tif, according to local policy, the user identified by the MCPTT ID in the SIP INVITE request is deemed to have a higher priority than an existing user in the group session, may remove a participant from the session by following clause 10.1.1.4.4.3, and skip the next step; and\nNOTE 7:\tThe local policy for deciding whether to admit a user to a call that has reached its maximum amount of participants can include the <user-priority> and the <participant-type> of the user as well as other information of the user from the group document as specified in 3GPP TS 24.481 [31]. The local policy decisions can also include taking into account whether the imminent-peril indicator or emergency indicator was received in the SIP INVITE request.\nii)\tshall return a SIP 486 (Busy Here) response with the warning text set to \"122 too many participants\" to the originating network as specified in clause 4.4 and skip the rest of the steps;\ne)\tif the received SIP INVITE request contains an authorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2 or MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5 and the MCPTT user is eligible to be implicitly affiliated with the MCPTT group as determined in step 15) a) iv) above, shall perform the implicit affiliation as specified in clause 9.2.2.3.7;\nf)\tif the received SIP INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element set to a value of \"true\":\ni)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency call;\nii)\tif the received SIP INVITE contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, shall cache the information that the MCPTT user has initiated an MCPTT emergency alert;\niii)\tif the in-progress emergency state of the group is set to a value of \"false\":\nA)\tshall set the value of the in-progress emergency state of the group to \"true\";\nB)\tshall start timer TNG2 (in-progress emergency group call timer) and handle its expiry as specified in clause 6.3.3.1.16;\nC)\tshall generate SIP re-INVITE requests for the MCPTT emergency group call to the other call participants of the MCPTT group as specified in clause 6.3.3.1.6; and\nD)\tshall send the SIP re-INVITEs towards the other participants of the MCPTT group call;\niv)\tif the in-progress emergency state of the group is set to a value of \"true\":\nA)\tfor each of the other affiliated member of the group generate a SIP MESSAGE request notification of the MCPTT user's emergency indication as specified in clause 6.3.3.1.11, setting the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nv)\tupon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\ng)\tif the in-progress emergency state of the group is set to a value of \"false\" and if the SIP INVITE request contains an imminent peril indication set to a value of \"true\", the controlling MCPTT function:\ni)\tshall cache the information that the MCPTT user has initiated an MCPTT imminent peril call; and\nii)\tif the in-progress imminent peril state of the group is set to a value of \"false\":\nA)\tshall set the in-progress imminent peril state of the group to a value of \"true\";\nB)\tshall generate SIP re-INVITE requests for the MCPTT imminent peril group call to the other call participants of the MCPTT group as specified in clause 6.3.3.1.15;\nC)\tshall send the SIP re-INVITEs towards the other participants of the MCPTT group call; and\nD)\tupon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\niii)\tif the in-progress imminent peril state of the group is set to a value of \"true\":\nA)\tfor each of the other affiliated member of the group generate a SIP MESSAGE request notification of the MCPTT user's imminent peril indication as specified in clause 6.3.3.1.11, setting the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nh)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.3.2.3.2;\ni)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\nj)\tshall include in the SIP 200 (OK) response with the warning text set to \"123 MCPTT session already exists\" as specified in clause 4.4;\nk)\tif the received SIP re-INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nl)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\" and if the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 8:\tIn this case, the request was for an imminent peril call but a higher priority MCPTT emergency call was already in progress on the group. Hence, the imminent peril call request aspect of the request is denied but the request is granted with emergency level priority.\nm)\tshall interact with media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 9:\tResulting media plane processing is completed before the next step is performed.\nn)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client or inviting non-controlling MCPTT function according to 3GPP TS 24.229 [4];\no)\tshall generate a notification to the MCPTT clients, which have subscribed to the conference event package that the inviting MCPTT User has joined in the MCPTT group call, as specified in clause 6.3.3.4;\nNOTE 10:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\np)\tshall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS 24.229 [4];\nq)\tUpon receiving a SIP ACK to the above SIP 200 (OK) response and the SIP 200 (OK) response contained a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall follow the procedures in clause 6.3.3.1.18; and\nr)\tshall not continue with the rest of the clause.\nUpon receiving a SIP 183 (Session Progress) response to the SIP INVITE request specified in clause 10.1.1.4.1 containing a P-Answer-State header field with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], the timer TNG1 (acknowledged call setup timer) is not running, the controlling MCPTT function supports media buffering and the SIP final response is not yet sent to the inviting MCPTT client:\n1)\tshall generate a SIP 200 (OK) response to SIP INVITE request as specified in the clause 6.3.3.2.3.2;\n2)\tshall include the warning text set to \"122 too many participants\" as specified in clause 4,4 in the SIP 200 (OK) response, if the prearranged MCPTT group has more than <on-network-max-participant-count> members as specified in 3GPP TS 24.481 [31];\n3)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n4)\tshall include a P-Answer-State header field with the value \"Unconfirmed\";\n5)\tif the SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n6)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\" and if the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n7)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 11:\tResulting user plane processing is completed before the next step is performed.\n8)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n9)\tshall generate a notification to the MCPTT clients, which have subscribed to the conference event package that the inviting MCPTT User has joined in the MCPTT group call, as specified in clause 6.3.3.4; and\nNOTE 12:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n10)\tshall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response for a SIP INVITE request as specified in clause 10.1.1.4.1.2 containing an indication of required group members, the timer TNG1 (acknowledged call setup timer) is running and all SIP 200 (OK) responses have been received to all SIP INVITE requests sent to MCPTT clients specified in clause 10.1.1.4.1.1, then the controlling MCPTT function shall wait until the SIP 200 (OK) response has been received to the SIP INVITE request specified in clause 10.1.1.4.1.2 before generating a SIP 200 (OK) response to the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\".\nUpon receiving a SIP 200 (OK) response for a SIP INVITE request as specified in clause 10.1.1.4.1 that was sent to an affiliated and <on-network-required> group member as specified in 3GPP TS 24.481 [31]; and\n1)\tif the MCPTT ID in the SIP 200 (OK) response matches to the MCPTT ID in the corresponding SIP INVITE request;\n2)\tthere are no outstanding SIP 200 (OK) responses to SIP INVITE requests which were sent to affiliated and <on-network-required> group members as specified in 3GPP TS 24.481 [31]; and\n3)\tthere is no outstanding SIP 200 (OK) response to a SIP INVITE request sent in clause 10.1.1.4.1.2 where the SIP 183 (Session Progress) response contained an indication of required group members;\nthe controlling MCPTT function:\n1)\tshall stop timer TNG1 (acknowledged call setup timer) as described in clause 6.3.3.3;\n2)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3.2 before continuing with the rest of the steps;\n3)\tshall include the warning text set to \"122 too many participants\" as specified in clause 4.4 in the SIP 200 (OK) response, if all members were not invited because the prearranged MCPTT group has been exceeded the <on-network-max-participant-count> members as specified in 3GPP TS 24.481 [31];\n4)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n5)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 13:\tResulting media plane processing is completed before the next step is performed.\n6)\tshall send a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4];\n7)\tshall generate a notification to the MCPTT clients, which have subscribed to the conference event package that the inviting MCPTT user has joined in the MCPTT group call, as specified in clause 6.3.3.4; and\nNOTE 14:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n8)\tshall send the SIP NOTIFY request to the MCPTT clients according to 3GPP TS 24.229 [4].\nUpon:\n1)\treceiving a SIP 200 (OK) response for a SIP INVITE request as specified in clause 10.1.1.4.1;\n2)\tthe timer TNG1 (acknowledged call setup timer) is not running;\n3)\tthe local counter of the number of SIP 200 (OK) responses received from invited members is equal to the value of the <on-network-minimum-number-to-start> element of the group document;\n4)\tthe controlling MCPTT function supports media buffering; and\n5)\tthe SIP final response has not yet been sent to the inviting MCPTT client;\nthe controlling MCPTT function according to local policy:\n1)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3;\n2)\tshall include the warning text set to \"122 too many participants\" as specified in clause 4.4 in the SIP 200 (OK) response, if all members were not invited because the prearranged MCPTT group has exceeded the <max-participant-count> members as specified in 3GPP TS 24.481 [31];\n3)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n4)\tif the SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n5)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\" and if the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n6)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 15:\tResulting media plane processing is completed before the next step is performed.\n7)\tshall send a SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4];\n8)\tshall generate a notification to the MCPTT clients, which have subscribed to the conference event package that the inviting MCPTT user has joined in the MCPTT group call, as specified in clause 6.3.3.4; and\nNOTE 16:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n9)\tshall send the SIP NOTIFY request to the MCPTT clients according to 3GPP TS 24.229 [4].\nUpon expiry of timer TNG1 (acknowledged call setup timer), if there are outstanding SIP 200 (OK) responses to SIP INVITE requests sent to affiliated and <on-network-required> group members as specified in 3GPP TS 24.481 [31], the controlling MCPTT function shall follow the procedures specified in clause 6.3.3.3.\nIf timer TNG1 (acknowledged call setup timer) is running and a final SIP 4xx, 5xx or 6xx response is received from an affiliated and <on-network-required> group member as specified in 3GPP TS 24.481 [31], the controlling MCPTT function shall follow the relevant procedures specified in clause 6.3.3.3.\nIf:\n1)\ttimer TNG1 (acknowledged call setup timer) is not running;\n2)\tthe local counter of the number of SIP 200 (OK) responses received from invited members is equal to the value of the <on-network-minimum-number-to-start> element of the group document; and\n3)\ta final SIP 4xx, 5xx or 6xx response is received from an invited MCPTT client;\nthen the controlling MCPTT function shall perform one of the following based on policy:\n1)\tsend the SIP final response towards the inviting MCPTT client, according to 3GPP TS 24.229 [4], if a SIP final response was received from all the other invited MCPTT clients and the SIP 200 (OK) response is not yet sent; or\n2)\tremove the invited MCPTT client from the MCPTT Session as specified in clause 6.3.3.1.5, if a SIP final response other than 2xx or 3xx was received from all the invited MCPTT clients and the SIP 200 (OK) response is already sent. The controlling MCPTT function may invite an additional member of the prearranged MCPTT group as specified in clause 10.1.1.4.1 that has not already been invited, if the prearranged MCPTT group has more than <on-network-max-participant-count> members as specified in 3GPP TS 24.481 [31], and all members have not yet been invited.\nIf the group identity in the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" is a TGI or the identity of a group regroup based on a preconfigured group and constituent MCPTT groups were invited as specified in clause 10.1.1.4.1.2 and,\n1)\tif all non-controlling MCPTT functions hosting the constituent MCPTT groups have responded with a SIP 2xx, SIP 3xx, SIP 4xx, SIP 5xx or SIP 6xx responses to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\"; and\n2)\tif all expected SIP INFO requests containing a floor request are received;\nthen the controlling MCPTT function shall indicate to the media plane that all final responses are received.\nNOTE 17:\tIf the SIP 200 (OK) response to the SIP INVITE request for non-controlling MCPTT function of an MCPTT group included the application/vnd.3gpp.mcptt-info+xml MIME body with the <floor-state> element set to \"floor-taken\", the controlling MCPTT function expects that the non-controlling MCPTT functions sends a SIP INFO request containing a floor request.\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nUpon receiving a SIP BYE request the controlling MCPTT function shall follow the procedures as specified in clause 6.3.3.2.4.\nThis clause describes the procedures of each functional entity for ending the group call initiated by the controlling MCPTT function.\nWhen the MCPTT session for group call needs to be released as specified in clause 6.3.8.1, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nWhen an MCPTT client needs to be removed from the MCPTT session (e.g. due to de-affiliation or admitting a higher priority user), the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nAfter successful removing the MCPTT client from the MCPTT session, the controlling MCPTT function may generate a notification to the MCPTT clients, which have subscribed to the conference event package that an MCPTT user has been removed from the MCPTT session, as specified in clause 6.3.3.4 and send the SIP NOTIFY request to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP INVITE request that includes an MCPTT session identity of an ongoing MCPTT session in the Request-URI the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE 1:\tIf the SIP INVITE request contains an emergency indication or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating an MCPTT emergency group call as determined by clause 6.3.3.1.13.2, or for originating an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5, the controlling MCPTT function can according to local policy choose to accept the request.\n2)\tshall reject the SIP request with a SIP 404 (Not Found) response if the MCPTT group call represented by the MCPTT session identity in Request-URI is not present;\n3)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n4)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall determine the MCPTT ID of the calling user;\n6)\tif the user identified by the MCPTT ID is not authorised to join the prearranged group session as specified in clause 6.3.5.3, shall send a SIP 403 (Forbidden) response with the warning text set to \"121 user is not authorised to join the group call\" in a Warning header field as specified in clause 4.4. Otherwise continue with the rest of the steps below;\n7)\tshall perform the actions on receipt of an initial SIP INVITE request as described in clause 6.3.3.2.2;\n8)\tif the user identified by the MCPTT ID is not affiliated to the MCPTT group ID associated with the MCPTT session identity as specified in clause 6.3.6, shall return a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4;\n9)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n10)\tif <on-network-max-participant-count> as specified in 3GPP TS 24.481 [31] is already reached:\na)\tif, according to local policy, the user identified by the MCPTT ID in the SIP INVITE request is deemed to have a higher priority than an existing user in the group session, may remove a participant from the session by following clause 10.1.1.4.4.3, and skip the next step; and\nNOTE 2:\tThe local policy for deciding whether to admit a user to a call that has reached its maximum amount of participants can include the <user-priority> and the <participant-type> of the user as well as other information of the user from the group document as specified in 3GPP TS 24.481 [31]. The local policy decisions can also include taking into account whether the imminent-peril indicator or emergency indicator was received in the SIP INVITE request.\nb)\tshall return a SIP 486 (Busy Here) response with the warning text set to \"122 too many participants\" to the originating network as specified in clause 4.4 Otherwise, continue with the rest of the steps;\n11)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.3.2.3.2;\n12)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n13)\tshall interact with media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 3:\tResulting media plane processing is completed before the next step is performed.\n14)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n15)\tshall generate a notification to the MCPTT clients, which have subscribed to the conference event package that the inviting MCPTT User has joined in the MCPTT group call, as specified in clause 6.3.3.4; and\nNOTE 4:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n16)\tshall send a SIP NOTIFY request to each MCPTT client according to 3GPP TS 24.229 [4].\nWhen controlling MCPTT function is notified that an MCPTT client is newly affiliated or comes back from out of coverage, the controlling MCPTT function shall invite the MCPTT client to join an ongoing MCPTT group call by following the procedures specified in clause 10.1.1.4.1.\nNOTE:\tHow the MCPTT function is informed when an MCPTT client is coming back from out of coverage is out of scope of present document.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a SIP re-INVITE request for an MCPTT session identity identifying an on-demand prearranged MCPTT group session, the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tIf the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the controlling MCPTT function can choose to accept the request.\n2)\tif received SIP re-INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.3.1.17;\n3)\tif the received SIP re-INVITE request contains an unauthorised request to initiate an MCPTT emergency call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n4)\tif the received SIP re-INVITE request contains an imminent peril indication set to \"true\" for an MCPTT imminent peril group call and this is an unauthorised request for an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.6, shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response with the following clarifications:\na)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\"; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n5)\tif a Resource-Priority header field is included in the received SIP re-INVITE request:\na)\tif the Resource-Priority header field is set to the value indicated for emergency calls and the SIP re-INVITE request does not contain an emergency indication and the in-progress emergency state of the group is set to a value of \"false\", shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response and skip the rest of the steps; and\nb)\tif the Resource-Priority header field is set to the value indicated for imminent peril calls and the SIP re-INVITE request does not contain an imminent peril indication and the in-progress imminent peril state of the group is set to a value of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the rest of the steps;\n6)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\" and is an authorised request to initiate an MCPTT emergency group call as determined by clause 6.3.3.1.13.2, the controlling MCPTT function:\na)\tshall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency call i.e the group in-progress emergency state;\nb)\tif the received SIP INVITE contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency alert;\nc)\tif the in-progress emergency state of the group is set to a value of \"true\" and another MCPTT user is indicating a new emergency indication:\ni)\tfor each of the other affiliated members of the group:\nA)\tshall generate a SIP MESSAGE request notification of the MCPTT user's emergency indication as specified in clause 6.3.3.1.11;\nB)\tshall set the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nC)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP re-INVITE request; and\nD)\tif indicated above in step 6) b), shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nii)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\niii)\tif the in-progress imminent peril state of the group is set to a value of \"true\", shall set it to a value of \"false\"; and\nd)\tif the in-progress emergency state of the group is set to a value of \"false\":\ni)\tshall set the value of the in-progress emergency state of the group to \"true\";\nii)\tshall start timer TNG2 (in-progress emergency group call timer) and handle its expiry as specified in clause 6.3.3.1.16;\nNOTE 2:\tThe interactions of TNG2 with the TNG3 (group call timer) are explained in clause 6.3.3.5.2.\niii)\tshall generate SIP re-INVITE requests for the MCPTT emergency group call to the other participants of the MCPTT group call as specified in clause 6.3.3.1.6;\niv)\tshall send the SIP re-INVITEs towards the other participants of the MCPTT group call;\nv)\tfor each of other affiliated members of the group that are not participating in the call:\nA)\tshall generate a SIP MESSAGE request notification of the MCPTT user's emergency indication as specified in clause 6.3.3.1.11;\nB)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP re-INVITE request;\nC)\tshall set the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nD)\tif indicated above in step 6) b), shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nE)\tsend the SIP MESSAGE request according to 3GPP TS 24.229 [4]; and\nvi)\tupon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\n7)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and is an unauthorised request for an MCPTT emergency group call cancellation as determined by clause 6.3.3.1.13.4:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;\nb)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with an <emergency-ind> element set to a value of \"true\";\nc)\tif an <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is included in the SIP re-INVITE request set to \"false\", and there is an outstanding MCPTT emergency alert for the MCPTT user, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to a value of \"true\"; and\nd)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n7a)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and is an authorised request for an MCPTT emergency group call cancellation as determined by clause 6.3.3.1.13.4 and if another user is in emergency state and is transmitting media as determined by interacting with the media plane as specified in 3GPP TS 24.380 [5]:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;\nb)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with an <emergency-ind> element set to a value of \"true\";\nc)\tif an <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is included in the SIP re-INVITE request set to \"false\", and there is an outstanding MCPTT emergency alert for the MCPTT user, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to a value of \"true\"; and\nd)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n8)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and is determined to be an authorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4 and the in-progress emergency state of the group to is set to a value of \"true\", the controlling MCPTT function:\na)\tshall set the in-progress emergency group state of the group to a value of \"false\";\nb)\tshall clear the cache of the MCPTT ID of the MCPTT users having an outstanding MCPTT emergency group call;\nc)\tif an <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is included and set to \"false\" and is determined to be an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3 and there is an outstanding MCPTT emergency alert for the MCPTT user shall:\ni)\tif the received SIP re-INVITE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the MCPTT user identified by the <originated-by> element as having an outstanding MCPTT emergency alert; or\nii)\tif the received SIP re-INVITE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the sender of the SIP re-INVITE request as having an outstanding MCPTT emergency alert;\nd)\tshall generate SIP re-INVITE requests to the participants in the group call as specified in clause 6.3.3.1.6. The MCPTT controlling function:\ni)\tfor each of the other participants in the group call shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nii)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\nNOTE 3:\tClause 6.3.3.1.6 will inform the group call participants of the cancellation of the MCPTT group's in-progress emergency state and the cancellation of the MCPTT emergency alert if applicable.\ne)\tshall stop timer TNG2 (in-progress emergency group call timer); and\nNOTE 4:\tThe interactions of TNG2 with the TNG3 (group call timer) are explained in clause 6.3.3.5.2;\nf)\tfor each of the affiliated members of the group that are not participating in the call:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency call as specified in clause 6.3.3.1.11;\nii)\tset the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";\niii)\tif indicated above in step 8) c), set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and\niv)\tsend the SIP MESSAGE request according to 3GPP TS 24.229 [4];\n9)\tif the received SIP re-INVITE request contains an imminent peril indication and the in-progress emergency group state of the group is set to a value of \"false\", shall perform the procedures specified in clause 10.1.1.4.8 and skip the rest of the steps.\nUpon receiving a SIP 200 (OK) response to a SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\n1)\tshall generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1;\n3)\tshall include the \"norefersub\" option tag in a Supported header field according to IETF RFC 4488 [22];\n4)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n5)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\" and if this is an unauthorised request for an MCPTT emergency alert as determined by clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n6)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\" and if this is an unauthorised request for an MCPTT emergency alert cancellation as determined by clause 6.3.3.1.13.3, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n7)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\", this is an authorised request for an MCPTT imminent peril group call and the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 5:\tIn this case, the request was for an imminent peril call but a higher priority MCPTT emergency call was already in progress on the group. Hence, the imminent peril call request aspect of the request is denied but the request is granted with emergency level priority.\n8)\tshall interact with media plane as specified in 3GPP TS 24.380 [5]; and\n9)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nUpon receipt of a SIP 2xx response for an outgoing SIP MESSAGE request, the controlling MCPTT function shall handle according to 3GPP TS 24.229 [4].\nThis procedure is initiated by the controlling MCPTT function as the result of an action in clause 10.1.1.4.7.\nIn the procedures in this clause:\n1)\timminent peril indication in an incoming SIP re-INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nWhen the controlling function receives a SIP re-INVITE request with an imminent peril indication set to \"true\", the controlling function:\n1)\tif the in-progress emergency state of the group is set to a value of \"false\" and if the SIP re-INVITE request contains an imminent peril indication set to a value of \"true\" or the in-progress imminent peril state of the group to \"true\", the controlling MCPTT function shall:\nNOTE: 1\tThe calling procedure has already determined that this is not an unauthorised request for an MCPTT imminent peril call, therefore that check does not need to be repeated in the current procedure.\na)\tif the in-progress imminent peril state of the group is set to a value of \"true\" and the MCPTT user is indicating a new imminent peril indication:\ni)\tfor each of the other affiliated member of the group generate a SIP MESSAGE request notification of the MCPTT user's imminent peril indication as specified in clause 6.3.3.1.11 with the following clarifications;\nA)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nb)\tif the in-progress imminent peril state of the group is set to a value of \"false\";\ni)\tset the value of the in-progress imminent peril state of the group to \"true\";\nii)\tgenerate SIP re-INVITE requests for the MCPTT imminent peril group call to participants in the MCPTT group call as specified in clause 6.3.3.1.15;\niii)\tsend the SIP re-INVITES to all of the other participants in the MCPTT group call;\niv)\tfor each of the affiliated members of the group not participating in the group call, generate a SIP MESSAGE request notification of the MCPTT user's imminent peril indication as specified in clause 6.3.3.1.11 with the following clarifications;\nA)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nc)\tcache the information that the MCPTT user has initiated an MCPTT imminent peril call;\n2)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"false\" and is an unauthorised request for an MCPTT imminent peril group call cancellation as determined by clause 6.3.3.1.13.6 shall:\na)\treject the SIP re-INVITE request with a SIP 403 (Forbidden) response to the SIP re-INVITE request; and\nb)\tinclude in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\";\nc) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4]; and\nd) skip the rest of the steps;\n3)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"false\" and is determined to be an authorised request for an MCPTT imminent peril call cancellation as specified in clause 6.3.3.1.13.6 and the in-progress imminent peril state of the group to is set to a value of \"true\" the controlling MCPTT function shall:\na)\tset the in-progress imminent peril state of the group to a value of \"false\";\nb)\tcache the information that the MCPTT user no longer has an outstanding MCPTT imminent peril group call;\nc)\tgenerate SIP re-INVITES requests to the other participants in the MCPTT group call as specified in clause 6.3.3.1.15. The MCPTT controlling function:\ni)\tfor each participant shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nii)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 2:\tClause 6.3.3.1.15 will inform the affiliated and joined members of the cancellation of the MCPTT group's in-progress emergency state and the cancellation of the MCPTT emergency alert if applicable.\nd)\tfor each of the affiliated members of the group not participating in the call shall:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's imminent peril call as specified in clause 6.3.3.1.11;\nii)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and\niii)\tsend the SIP MESSAGE request according to 3GPP TS 24.229 [4];\n4)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1;\n5)\tshall include the \"norefersub\" option tag in a Supported header field according to IETF RFC 4488 [22];\n6)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n7)\tshall interact with media plane as specified in 3GPP TS 24.380 [5]; and\n8)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response for an outgoing SIP MESSAGE request, shall handle according to 3GPP TS 24.229 [4].\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT session. The procedure is initiated by the non-controlling MCPTT function of an MCPTT group as the result of an action in clause 10.1.1.5.2 or clause 10.1.1.5.5.\nThe non-controlling MCPTT function:\n1)\tshall invite the MCPTT clients as specified in clause 6.3.4.1.2;\n2)\tshall include in each SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the controlling MCPTT function according to the procedures specified in clause 6.3.4.1.1; and\n3)\tshall send each SIP INVITE request towards the terminating network in accordance with 3GPP TS 24.229 [4].\nFor each SIP 183 (Session Progress) response received to each SIP INVITE request sent to an MCPTT client, the non-controlling MCPTT function of an MCPTT group:\n1)\tFor each SIP 183 (Session Progress) response containing the option tag \"100rel\", shall send a SIP PRACK request towards the MCPTT client according to 3GPP TS 24.229 [4]; and\n2)\tshall cache the received response;\nFor each SIP 200 (OK) response received to each SIP INVITE request sent to an MCPTT client, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall send a SIP ACK request towards the MCPTT client according to 3GPP TS 24.229 [4];\n2)\tshall cache the SIP 200 (OK) response;\n3)\tshall start the SIP session timer according to rules and procedures of IETF RFC 4028 [7]; and\n4)\tif at least one of the participants has subscribed to the conference event package, shall send a SIP NOTIFY request to all participants with a subscription to the conference event package as specified in clause 10.1.3.5.2.\nOn receipt of a SIP 3xx, 4xx, 5xx or 6xx response from an invited MCPTT client, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall send an SIP ACK request towards the MCPTT client as specified in 3GPP TS 24.229 [4];\n2)\tshall remove the cached provisional responses received from the MCPTT client, if any cached provisional responses exists; and\n3)\tif the procedures are initiated by the receipt of the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" as specified in clause 10.1.1.5.2, shall cache the SIP 3xx, 4xx, 5xx or 6xx response.\nWhen receiving the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" the MCPTT server can be acting as a controller MCPTT function in an ongoing prearranged group call or, if an prearranged group call is not ongoing, be initiated as an non-controlling MCPTT function and invite MCPTT users.\nIf a prearranged group call is not ongoing the MCPTT server shall perform the actions specified in clause 10.1.1.5.2.2.\nIf the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" is received when a prearranged group call is ongoing, the controlling MCPTT function may switch from operating in a controlling MCPTT function mode to operate in a non-controlling MCPTT function mode as specified in clause 10.1.1.5.2.3.\nWhen operating in the non-controlling mode and a SIP BYE request is received from the controlling MCPTT function, the non-controlling MCPTT function shall change from operating in the non-controlling mode to operating in the controlling mode as specified in clause 10.1.1.5.2.4.\nUpon receipt of a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" and if a prearranged group call is not ongoing, the non-controlling MCPTT function of an MCPTT group:\nNOTE 1:\tThe Contact header field of the SIP INVITE request contains the isfocus media feature tag.\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tif the partner MCPTT system does not have a mutual aid relationship with the primary MCPTT system identified by the contents of the P-Asserted-Identity, shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"128 isfocus already assigned\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\n5)\tif a trusted mutual aid relationship exists between the partner MCPTT system and the primary MCPTT system and the procedure in 3GPP TS 23.379 [3] clause 10.6.2.4.2 is supported:\na)\tshall generate a SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4];\nb)\tshall retrieve the group members of the prearranged group identified by the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request, as specified in clause 6.3.5.2;\nc)\tif the retrieval of group members was successful shall include a P-Refused-URI-List header field populated with affiliated members of the prearranged group in accordance with the IETF RFC 5318 [36]:\nd)\tif the retrieval of group members was not successful, shall include the warning text set to \"128 isfocus already assigned\" in a Warning header field as specified in clause 4.4; and\ne)\tshall send the SIP 403 (Forbidden) response towards the controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and\nf)\tshall not process the remaining steps;\n6)\tshall retrieve the group document from the group management server for the MCPTT group ID contained in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request and carry out initial processing as specified in clause 6.3.5.2 and continue with the rest of the steps if the checks in clause 6.3.5.2 succeed;\n7)\tshall cache the content of the SIP INVITE request, if received in the Contact header field and if the specific feature tags are supported;\n8)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n9)\tdetermine the members to invite to the prearranged MCPTT group call as specified in clause 6.3.5.5;\n10)\tif the group document retrieved from the group management server contains <on-network-required> group members as specified in 3GPP TS 24.481 [31], shall send a SIP 183 (Session Progress) response to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" as specified in clause 6.3.4.2.2.1 and shall populate the response with an application/vnd.3gpp.mcptt-info+xml MIME body containing the <required> element set to \"true\".\n11)\tif the group document retrieved from the group management server does not contain any <on-network-required> group members as specified in 3GPP TS 24.481 [31], may, according to local policy, send a SIP 183 (Session Progress) response to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" as specified in clause 6.3.4.2.2.1;\n12)\tshall invite each group member determined in step 9) above, to the group session, as specified in clause 10.1.1.5.1; and\n13)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nUnless a SIP response has been sent to the controlling MCPTT function as specified in step 10 or 11 above, the non-controlling MCPTT function of an MCPTT group shall wait for the first SIP provisional response or first SIP 200 (OK) response from one of the invited MCPTT clients, before sending a response to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\".\nUpon receiving the first 18x response to a SIP INVITE request sent to an invited MCPTT client as specified in clause 10.1.1.5.1, not containing a P-Answer-State header field, and if a SIP 183 (Session Progress) response has not already been sent in response to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\", the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate a SIP 183 (Session Progress) response as described in clause 6.3.4.2.2.1; and\n2)\tshall forward the SIP 183 (Session Progress) response to the controlling MCPTT function according to 3GPP TS 24.229 [4].\nUpon receiving the first 18x response to a SIP INVITE request sent to an invited MCPTT client as specified in clause 10.1.1.5.1, containing a P-Answer-State header field with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], a SIP 183 (Session Progress) response has not already been sent in response to the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" and the non-controlling MCPTT function of an MCPTT group supports media buffering, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.4.2.2.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.4.2.1;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.5; and\nNOTE 2:\tResulting media plane processing is completed before the next step is performed.\n4)\tshall send a SIP 200 (OK) response to the controlling MCPTT function according to 3GPP TS 24.229 [4].\nIf the group document does not contain any <on-network-required> group members as specified in 3GPP TS 24.481 [31], then upon receiving the first SIP 200 (OK) response to a SIP INVITE request sent to an invited MCPTT client as specified in clause 10.1.1.5.1, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.4.2.2.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.4.2.1;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.5; and\nNOTE 3:\tResulting media plane processing is completed before the next step is performed.\n4)\tshall send a SIP 200 (OK) response to the controlling MCPTT function according to 3GPP TS 24.229 [4];\nIf the group document contains <on-network-required> group member(s) as specified in 3GPP TS 24.481 [31], then the non-controlling MCPTT function of an MCPTT group shall wait until all SIP 200 (OK) responses to SIP INVITE requests have been received from the <on-network-required> MCPTT clients before sending a SIP 200 (OK) response back to the controlling MCPTT function, as specified above.\nIf all invited MCPTT clients have rejected SIP INVITE requests with a SIP 3xx, 4xx, 5xx or 6xx response, the non-controlling MCPTT function of an MCPTT group:\n1)\tshall generate a SIP reject response as specified in 3GPP TS 24.229 [4];\n2)\tshall, from the list of reject response codes cached by the non-controlling MCPTT function of an MCPTT group, select the highest prioritized cached reject response code as specified in IETF RFC 3261 [24]; and\n3)\tshall send the reject response towards the controlling MCPTT function as specified in 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" and if a prearranged group call is already ongoing, the non-controlling MCPTT function of an MCPTT group:\nNOTE 1:\tThe Contact header field of the SIP INVITE request contains the isfocus media feature tag.\n1)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2A)\tif the MCPTT emergency group call state is set to either \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\" shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"166 constituent group is in an emergency call state\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\nNOTE 2:\t3GPP TS 23.280 [82] includes the possibility that local policy could allow a constituent group that is in an emergency state to be included in a group regroup; however, the transfer of that emergency state to the group regroup from the constituent group is not supported in the present document.\n3)\tif the partner MCPTT system does not have a mutual aid relationship to merged an ongoing prearranged call with the primary MCPTT system identified by the contents of the P-Asserted-Identity, shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"128 isfocus already assigned\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\n4)\tshall cache the content of the SIP INVITE request, if received in the Contact header field and if the specific feature tags are supported;\n5)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n6)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.4.2.2.2 before continuing with the rest of the steps;\n7)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.4.2.1;\n8)\tshall instruct the media plane to initialise the switch to non-controlling mode as specified in 3GPP TS 24.380 [5] clause 6.5.2.3.2;\nNOTE 3:\tResulting media plane processing is completed before the next step is performed. The media plane indicates the state of the floor and if the state is \"floor-taken\", information about the current speaker.\n9)\tif the media plane provided information about the current speaker, cache the information about the current speaker(s);\n10)\tshall send a SIP 200 (OK) response to the controlling MCPTT function according to 3GPP TS 24.229 [4].\nUpon receipt of the SIP ACK request, the non-controlling MCPTT function of an MCPTT group:\n1)\tif information about a current speaker is cached:\na)\tshall generate a SIP INFO request as specified in clause 6.3.4.1.3; and\nb)\tshall send the SIP INFO request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall instruct the media plane to finalise the switch to the non-controlling mode as specified in 3GPP TS 24.380 [5] clause 6. 5.2.3.3; and\n3)\tif at least one of the MCPTT clients in the pre-arranged group session has a subscription to the conference event package, shall subscribe to the conference event package from the controlling MCPTT function as specified in clause 10.1.3.5.3.\nUpon receipt of a SIP BYE request or a final SIP reject response from the controlling MCPTT function, the non-controlling MCPTT function of an MCPTT group:\n1)\tif keeping the prearranged group call active is according to the release policy in clause 6.3.8.1, shall request media plane to switch to controlling mode as specified in 3GPP TS 24.380 [5] clause 6.3.5;\nNOTE 1:\tResulting media plane processing is completed before the next step is performed.\n2)\tif a SIP BYE request was received, shall send a SIP 200 (OK) response to the SIP BYE request; and\n3)\tif keeping the prearranged group call active is according to the release policy in clause 6.3.8.1 and if at least one of the remaining MCPTT clients has subscribed to the conference package, shall send a NOTIFY request to all participants with a subscription to the conference event package as specified in clause 10.1.3.5.2.\nNOTE 2:\tThe SIP NOTIFY request will indicate that all participants, with the exception of the MCPTT users belonging to the constituent MCPTT group hosted by the non-controlling MCPTT function, have left the group session.\nUpon receipt of a SIP INVITE request that includes an MCPTT session identity of an ongoing MCPTT session in the Request-URI the non-controlling MCPTT function act as a controlling MCPTT function towards the MCPTT client and shall perform the actions in the clause 10.1.1.4.5.1 with the following clarifications:\n1)\tthe MCPTT session identity in the Contact header field of the SIP 200 (OK) response shall be the MCPTT session identity generated by the non-controlling MCPTT function; and\n2)\tthe clause 10.1.3.5.2 shall be used when sending the SIP NOTIFY request for subscriptions to the conference event package.\nWhen non-controlling MCPTT function is notified that an MCPTT client is newly affiliated or comes back from out of coverage, the non-controlling MCPTT function shall invite the MCPTT client to join an ongoing MCPTT group call by following the procedures specified in clause 10.1.1.5.1.\nNOTE:\tHow the MCPTT function is informed when an MCPTT client is coming back from out of coverage is out of scope of present document.\nUpon receiving a \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" when a prearranged group session is not ongoing, the non-controlling MCPTT-function shall:\nNOTE 1:\tThe difference between a \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" and a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" (from the controlling MCPTT function) is that the latter SIP INVITE request contains the isfocus media feature tag in the Contact header field.\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The non-controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tshall retrieve the group document from the group management server for the MCPTT group ID contained in the <associated-group-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request and carry out initial processing as specified in clause 6.3.5.2 and continue with the rest of the steps, if the checks in clause 6.3.5.2 succeed;\nNOTE 2:\tIf the checks are not successful, the SIP response to the \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" is already sent in the clause 6.3.5.2.\n5)\tshall cache the content of the SIP INVITE request;\n6)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n7)\tshall check the authorization of the MCPTT user in the <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" as specified in clause 6.3.5.4. If the MCPTT user is unauthorized to initiate a pre-arranged group session, the non-controlling MCPTT function shall send a SIP 403 (Forbidden) response with the warning text set to \"119 user is not authorised to initiate the group call\" in a Warning header field as specified in clause 4.4.\n8)\tif:\na)\tthe MCPTT user identified in the <mcptt-calling-user-id> of the incoming SIP INVITE is not affiliated to the group identity contained in the <associated-group-id> element of the incoming SIP INVITE request as specified in clause 6.3.6;\nb)\tthe incoming SIP INVITE request does not contain an emergency indication or an imminent peril indication; or\nc)\tthe incoming SIP INVITE request is an authorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2 or for an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5 and the MCPTT user identified in the <mcptt-calling-user-id> of the incoming SIP INVITE is determined to not be eligible for implicit affiliation as specified in clause 9.2.2.3.6;\nthen shall return a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4, and skip the rest of the steps below;\n9)\tshall generate a SIP INVITE request towards the controlling MCPTT function as specified in clause 6.3.4.1.4; and\n10)\tshall send the SIP INVITE request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the SIP INVITE request sent to the controlling MCPTT function as specified above, the non-controlling MCPTT function:\n1)\tshall send the SIP ACK request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall generate a SIP 200 (OK) to the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" as specified in 3GPP TS 24.229 [4] populated as follows:\na)\tshall include an SDP answer as specified in clause 6.3.4.2.1 based on the SDP answer in the SIP 200 (OK) response;\nb)\tshall include the public service identifier of the non-controlling MCPTT function in the P-Asserted-Identity header field;\nc)\tshall include the warning text set to \"148 group is regrouped\" in a Warning header field as specified in clause 4.4; and\nd)\tshall send the SIP 200 (OK) request according to 3GPP TS 24.229 [4];\nNOTE 3:\tAs long as the MCPTT group is regrouped the floor control messages in the media plane includes a grouped regrouped indication as specified in 3GPP TS 24.380 [5].\n3)\tshall start acting as a non-controlling MCPTT function and interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.5;\n4)\tshall determine the members to invite to the prearranged MCPTT group call as specified in clause 6.3.5.5; and\n5)\tshall invite each group member determined in step 4) immediately above, to the group session, as specified in clause 10.1.1.5.1.\nUpon receipt of other final SIP responses with the exception of the SIP 2xx response to the INVITE request sent to the controlling MCPTT function as specified above, the non-controlling MCPTT function:\n1)\tshall send the SIP ACK response to the controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and\n2)\tshall start acting as a controlling MCPTT function as specified in clause 10.1.1.4 and invite members as specified in clause 6.3.4.1.2.\nNOTE 4:\tRegardless if the controlling MCPTT function accepts or rejects the SIP INVITE request sent above, the prearranged group session continues to be initiated with only the members of the group homed on the non-controlling MCPTT function of the group being invited to the group call.\nThe non-controlling MCPTT function shall handle SIP responses (other than the SIP 2xx response) to the SIP INVITE requests sent to invited members as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to SIP INVITE requests sent to invited members, the non-controlling MCPTT function:\n1)\tshall send the SIP ACK request as specified in 3GPP TS 24.229 [4]; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.1.2\tChat group (restricted) call",
                            "text_content": "10.1.2.2.1.1\tProcedure for initiating a chat MCPTT group call and procedure for joining a chat MCPTT group call\nUpon receiving a request from an MCPTT user to initiate or join an MCPTT group call using an MCPTT group identity, identifying a chat MCPTT group, the MCPTT client shall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that calls are not allowed on the indicated group; and\n2)\tshall skip the remainder of this procedure.\nThe MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user has requested the origination of an MCPTT emergency group call or is originating an MCPTT chat group call and the MCPTT emergency state is already set, the MCPTT client shall comply with the procedures in clause 6.2.8.1.1;\n2)\tif the MCPTT user has requested the origination of an MCPTT imminent peril group call, shall comply with the procedures in clause 6.2.8.1.9;\n3)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n4)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n6)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n7)\tshould include the \"timer\" option tag in the Supported header field;\n8)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the refresher parameter is omitted. If included, the refresher parameter shall be set to \"uac\";\n9)\tshall set the Request-URI of the SIP INVITE request to the public service identity identifying the participating MCPTT function serving the MCPTT user;\nNOTE 1:\tThe MCPTT client is configured with public service identity identifying the participating MCPTT function serving the MCPTT user.\n10)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n11)\tif the MCPTT client emergency group state for this group is set to \"MEG 2: in-progress\" or \"MEG 4: confirm-pending\", the MCPTT client shall comply with the procedures in clause 6.2.8.1.2;\n12)\tif the MCPTT client imminent peril group state for this group is set to \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n13)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"chat\";\nb)\tthe <mcptt-request-uri> element set to the group identity;\nc)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nd)\tif the group identity identifies a temporary group or a group regroup based on preconfigured group, the <associated-group-id> element set to the MCPTT group ID of a constituent group the MCPTT client is member of;\nNOTE 2:\tThe MCPTT client is informed about temporary groups regrouping MCPTT groups that the user is a member of as specified in 3GPP TS 24.481 [31]. The MCPTT client is informed about regroups based on a preconfigured group of MCPTT groups that the user is member of and affiliated to as specified in clause 16.\nNOTE 3:\tIf the MCPTT user selected a TGI or the identity of a group regroup based on a preconfigured group where there are several constituent MCPTT groups where the MCPTT user is a member, the MCPTT client selects one of those MCPTT groups.\ne)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the initial SIP INVITE request, the <anyExt> element with the <functional-alias-URI> set to the URI of the used functional alias; and\nf)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value;\nNOTE 4:\tThe MCPTT ID of the originating MCPTT user is not included in the body, as this will be inserted into the body of the SIP INVITE request that is sent by the originating participating MCPTT function.\n14)\tshall include in the SIP INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n15)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n16)\tshall send the SIP INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\" or the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\", the MCPTT client shall perform the actions specified in clause 6.2.8.1.4; and\n3)\tmay subscribe to the conference event package as specified in clause 10.1.3.1.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\"; or\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";\nthe MCPTT client shall perform the actions specified in clause 6.2.8.1.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request the MCPTT client:\n1)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user the MCPTT ID of the originator of the MCPTT emergency group call and an indication that this is an MCPTT emergency group call;\nb)\tif the <mcpttinfo> element containing the <mcptt-Params> element contains an <alert-ind> element set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information;\nc)\tshall set the MCPTT emergency group state to \"MEG 2: in-progress\";\nd)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\";and\ne)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\";\n2)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user the MCPTT ID of the originator of the MCPTT imminent peril group call and an indication that this is an MCPTT imminent peril group call; and\nb)\tshall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";\n3)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user the MCPTT ID of the MCPTT user cancelling the MCPTT emergency group call;\nb)\tif the <mcpttinfo> element containing the <mcptt-Params> element contains an <alert-ind> element set to \"false\":\ni)\tshould display to the MCPTT user an indication of the MCPTT emergency alert cancellation and the MCPTT ID of the MCPTT user cancelling the MCPTT emergency alert; and\nii)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body including an <originated-by> element:\nA)\tshould display to the MCPTT user the MCPTT ID contained in the <originated-by> element of the MCPTT user that originated the MCPTT emergency alert; and\nB)\tif the MCPTT ID contained in the <originated-by> element is the MCPTT ID of the receiving MCPTT user, shall set the MCPTT emergency alert state to \"MEA 1: no-alert\";\nc)\tshall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and\nd)\tif the MCPTT emergency group call state of the group is set to \"MEGC 3: emergency-call-granted\", shall set the MCPTT emergency group call state of the group to \"MEGC 1: emergency-gc-capable\";\n4)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user the MCPTT ID of the MCPTT user cancelling the MCPTT imminent peril group call and an indication that this is an MCPTT imminent peril group call;\nb)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nc)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\";\n5)\tmay check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n6)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n7)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP 200 (OK) response;\n8)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP 200 (OK) response;\n9)\tif the SIP re-INVITE request was received within an on-demand session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2;\n10)\tif the SIP re-INVITE request was received within a pre-established session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session; and\nNOTE:\tThe SIP re-INVITE request can be received within an on-demand session or a pre-established session associated with an MCPTT group call. If the SIP re-INVITE request is received within a pre-established session, the media-level section for the MCPTT speech media stream and the media-level section of the media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n11)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to cancel the in-progress emergency condition on a chat MCPTT group, the MCPTT client shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress emergency group state of the MCPTT group as determined by the procedures of clause 6.2.8.1.7, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress emergency group state of the MCPTT group; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and optionally an MCPTT emergency alert originated by the MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.3;\n3)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and optionally an MCPTT emergency alert originated by another MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.14;\n4)\tshall, if the SIP re-INVITE request is to be sent within an on-demand session, include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n5)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE 1:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session associated with an MCPTT group call. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the MCPTT speech media stream and the media-level section of the media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n6)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2; and\n7)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tshall set the MCPTT emergency group state of the group to \"MEG 1: no-emergency\";\n2)\tshall set the MCPTT emergency group call state of the group to \"MEGC 1: emergency-gc-capable\"; and\n3)\tif the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\", the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the SIP 2xx response to the SIP request for a priority group call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state to \"MEA 1: no-alert\".\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request:\n1)\tshall set the MCPTT emergency group state as \"MEG 2: in-progress\";\n2)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\" and the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\n3)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response did not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element and did not contain an <originated-by> element, the MCPTT emergency alert (MEA) state shall revert to its value prior to entering the current procedure.\nNOTE 3:\tIf the in-progress emergency group state cancel request is rejected, the state of the session does not change, i.e. continues with MCPTT emergency group call level priority.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to upgrade the MCPTT group call to an emergency condition or an imminent peril condition on a chat MCPTT group, the MCPTT client shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the clarifications given below.\n1)\tif the MCPTT user is requesting to upgrade the MCPTT group call to an in-progress emergency group state and is not authorised to do so as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to upgrade the MCPTT group call to an in-progress emergency group state; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tif the MCPTT user is requesting to upgrade the MCPTT group session to an in-progress imminent peril state and is not authorised to do so as determined by the procedures of clause 6.2.8.1.8, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to upgrade the MCPTT group call to an in-progress imminent peril group state; and\nb)\tshall skip the remaining steps of the current clause;\n3)\tif the MCPTT user has requested to upgrade the MCPTT group call to an MCPTT emergency call, the MCPTT client:\na)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.2.8.1.1; and\nb)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2.\n4)\tif the MCPTT user has requested to upgrade the MCPTT group call to an MCPTT imminent peril call, the MCPTT client:\na)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body by following the procedures in clause 6.2.8.1.9; and\nb)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n5)\tif the SIP re-INVITE request is to be sent within an on-demand session, shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n6)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session associated with an MCPTT group call. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n7)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and:\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\nb)\tif location information has not yet been included in the SIP re-INVITE request;\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element;\n8)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2; and\n9)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5]; and\n2)\tshall perform the actions specified in clause 6.2.8.1.4.\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request the MCPTT client shall perform the actions specified in clause 6.2.8.1.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to cancel the in-progress imminent peril condition on a chat MCPTT group, the MCPTT client shall generate a SIP re-INVITE request by following the procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress imminent peril group state of the MCPTT group as determined by the procedures of clause 6.2.8.1.10, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress imminent peril group state of the MCPTT group; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.1.11;\n3)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"chat\"; and\nb)\tthe <mcptt-request-uri> element set to the group identity;\nNOTE 1:\tThe MCPTT ID of the originating MCPTT user is not included in the body, as this will be inserted into the body of the SIP re-INVITE request that is sent by the originating participating MCPTT function.\n5)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP re-INVITE request according to IETF RFC 3840 [16];\n6)\tif the SIP re-INVITE request is to be sent within an on-demand session, shall include in the SIP re-INVITE request an SDP offer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.2.1;\n7)\tif the SIP re-INVITE request is to be sent within a pre-established session, shall include an SDP offer in the SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session; and\nNOTE 2:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session associated with an MCPTT group call. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n8)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tshall set the MCPTT imminent peril group state of the group to \"MIG 1: no-imminent-peril\"; and\n3)\tshall set the MCPTT imminent peril group call state of the group to \"MIGC 1: imminent-peril-gc-capable\".\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request:\n1)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response:\na)\tcontains an application/vnd.3gpp.mcptt-info+xml MIME body with an <imminentperil-ind> element set to a value of \"true\"; or\nb)\tdoes not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an <imminentperil-ind> element;\nthen the MCPTT client shall set the MCPTT imminent peril group state as \"MIG 2: in-progress\".\nNOTE 2:\tThis is the case where the MCPTT client requested the cancellation of the MCPTT imminent peril in-progress state and was rejected.\nThis procedure is used for MCPTT emergency and MCPTT imminent peril calls when the MCPTT client is affiliated but not joined to the chat group.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of an initial SIP INVITE request, the MCPTT client:\n1)\tmay reject the SIP INVITE request if either of the following conditions is met:\na)\tMCPTT client does not have enough resources to handle the call;\nb)\tthe number of the maximum simultaneous MCPTT emergency group calls supported for the specific calling functional alias as specified in the <MaxSimultaneousEmergencyGroupCalls> element within the <FunctionalAliasList> list element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been reached; or\nc)\tany other reason outside the scope of this specification;\n2)\tif the SIP INVITE request is rejected in step 1), shall respond toward participating MCPTT function either with appropriate reject code as specified in 3GPP TS 24.229 [4] and warning texts as specified in clause 4.4.2 or with SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure and skip the rest of the steps of this clause;\nNOTE 1:\tif the SIP INVITE request contains an emergency indication or imminent peril indication, the MCPTT client can by means beyond the scope of this specification choose to accept the request.\n3)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT emergency group call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT emergency group call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nii)\tshould display the MCPTT group identity of the group with the emergency condition contained in the <mcptt-calling-group-id> element; and\niii)\tif the <alert-ind> element is set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information;\nb)\tshall set the MCPTT emergency group state to \"MEG 2: in-progress\";\nc)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nd)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\"; otherwise\n4)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT imminent peril group call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT imminent peril group call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tshould display the MCPTT group identity of the group with the imminent peril condition contained in the <mcptt-calling-group-id> element; and\nb)\tshall set the MCPTT imminent peril group state to \"MIG 2: in-progress\";\n5)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n6)\tshall accept the SIP INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n7)\tshall include the option tag \"timer\" in a Require header field of the SIP 200 (OK) response;\n8)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP 200 (OK) response;\n9)\tshall include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP 200 (OK) response;\n10)\tshall include the Session-Expires header field in the SIP 200 (OK) response and start the SIP session timer according to IETF RFC 4028 [7]. If no \"refresher\" parameter was included in the received SIP INVITE request the \"refresher\" parameter in the Session-Expires header field shall be set to \"uas\", otherwise shall include a \"refresher\" parameter set to the value received in the Session-Expires header field the received SIP INVITE request;\n11)\tshall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2;\n12)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4];\n13)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n14)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing an <mcptt-Params> element containing an <anyExt> element which includes a <functional-alias-URI> element, may display to the MCPTT user the functional alias of the inviting MCPTT user.\nUpon receiving a request from an MCPTT user to initiate or join an MCPTT group call using an MCPTT group identity identifying a chat MCPTT group within the pre-established session, the MCPTT client shall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that calls are not allowed on the indicated group; and\n2)\tshall skip the remainder of this procedure.\nThe MCPTT client shall generate a SIP REFER request outside a dialog as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], and in accordance with the UE procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request URI of the SIP REFER request to the session identity of the pre-established session;\n2)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20], and with the Content-ID header field set to this \"cid\" URL;\n3)\tshall include in the application/resource-lists+xml MIME body a single <entry> element in a <list> element in the <resource-lists> element where the <entry> elment contains a \"uri\" attribute set to the chat group identity, extended with the following parameters in the headers portion of the SIP URI:\nNOTE 1:\tCharacters that are not formatted as ASCII characters are escaped in the following parameters in the headers portion of the SIP URI.\na)\tthe Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nb)\tan Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6]; and\nc)\tan hname \"body\" parameter populated with:\ni)\tan application/sdp MIME body containing an SDP offer, if the session parameters of the pre-established session require modification or if implicit floor control is required, according to the conditions specified in clause 6.4;\nii)\tan application/vnd.3gpp.mcptt-info MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\nA)\tthe <session-type> element set to a value of \"chat\";\nB)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nC)\tif the chat group identity identifies a temporary group or a group regroup based on preconfigured group, the <associated-group-id> element set to the MCPTT group ID of a constituent group the MCPTT client is member of;\nNOTE 2:\tThe MCPTT client is informed about temporary groups regrouping MCPTT groups that the user is a member of as specified in 3GPP TS 24.481 [31]. The MCPTT client is informed about regroups based on a preconfigured group of MCPTT groups that the user is member of and affiliated to as specified in clause 16.\nNOTE 3:\tIf the MCPTT user selected a TGI or the identity of a group regroup based on a preconfigured group where there are several constituent MCPTT groups where the MCPTT user is a member, the MCPTT client selects one of those MCPTT groups.\nD)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the SIP REFER request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\nE)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value; and\niii)\tif:\nA)\timplicit floor control is required; and\nB)\tan application/vnd.3gpp.mcptt-info MIME body with the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element;\nNOTE 4:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\n4)\tif the MCPTT user has requested the origination of an MCPTT emergency group call or is originating an MCPTT group call and the MCPTT emergency state is already set:\na)\tif this is an authorised request for an MCPTT emergency group call as determined by the procedures of clause 6.2.8.8.1.8, shall comply with the procedures in clause 6.2.8.1.1; and\nb)\tif this is an unauthorised request for an MCPTT emergency group call as determined in step a) above, should indicate to the MCPTT user that they are not authorised to initiate an MCPTT emergency group call;\n5)\tif the MCPTT client emergency group state for this group is set to \"MEG 2: in-progress\" or \"MEG 4: confirm-pending\", shall include the Resource-Priority header field and comply with the procedures in clause 6.2.8.1.2;\n6)\tif the MCPTT user has requested the origination of an MCPTT imminent peril group call:\na)\tif this is an authorised request for an MCPTT imminent peril group call as determined by the procedures of clause 6.2.8.8.1.8, shall comply with the procedures in clause 6.2.8.1.9; and\nb)\tif this is an unauthorised request for an MCPTT imminent peril group call as determined in step a) above, should indicate to the MCPTT user that they are not authorised to initiate an MCPTT imminent peril group call;\n7)\tif the MCPTT client imminent peril group state for this group is set to \"MIG 2: in-progress\" or \"MIG 4: confirm-pending\" shall include the Resource-Priority header field and comply with the procedures in clause 6.2.8.1.12;\n8)\tshall include a P-Preferred-Service header field set to the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), according to IETF RFC 6050 [9];\n9)\tshall include the following according to IETF RFC 4488 [22]:\na)\tthe option tag \"norefersub\" in the Supported header field; and\nb)\tthe value \"false\" in the Refer-Sub header field.\n10)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session;\n11)\tshall include the g.3gpp.mcptt media feature tag in the Contact header field of the SIP REFER request according to IETF RFC 3840 [16]; and\n12)\tshall send the SIP REFER request according to 3GPP TS 24.229 [4].\nOn receiving a final SIP 2xx response to the SIP REFER request, the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nOn receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the SIP REFER request:\n1)\tif the MCPTT emergency group call state is set to \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\"; or\n2)\tif the MCPTT imminent peril group call state is set to \"MIGC 2: imminent-peril-call-requested\" or \"MIGC 3: imminent-peril-call-granted\";\nthe MCPTT client shall perform the actions specified in clause 6.2.8.1.5 and shall skip the remaining steps.\nOn receiving a SIP re-INVITE request within the pre-established session targeted by the sent SIP REFER request, and if the sent SIP REFER request was a request for an MCPTT emergency group call or an MCPTT imminent peril group call, the MCPTT client:\n1)\tshall perform the actions specified in clause 6.2.8.1.16;\n2)\tshall check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n3)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n4)\tshall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session; and\n5)\tshall send the SIP 200 (OK) response towards the participating MCPTT function according to rules and procedures of 3GPP TS 24.229 [4].\nOn call release by interaction with the media plane as specified in clause 9.2.2 of 3GPP TS 24.380 [5] if the sent SIP REFER request was a request for an MCPTT emergency group call or an MCPTT imminent peril group call, the MCPTT client shall perform the procedures specified in clause 6.2.8.1.17.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.1.13.\nWhen an MCPTT client wants to leave the MCPTT session that has been established using on-demand session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.1.\nWhen an MCPTT client wants to leave the MCPTT session within a pre-established session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.2.\nUpon receiving a SIP BYE request for releasing the MCPTT chat session, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nIn the procedures in this clause:\n1)\tgroup identity in an incoming SIP INVITE request refers to the group identity from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" for a group identity identifying a chat MCPTT group containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"chat\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE 1:\tIf the SIP INVITE request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif through local policy in the originating participating MCPTT function, the user identified by the MCPTT ID is not authorised to make chat group calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response to the SIP INVITE request, with warning text set to \"108 user not authorised to make chat group calls\" in a Warning header field as specified in clause 4.4;\n4)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n5)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\nNOTE 3:\tIf the SIP INVITE request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow for an exception to the limit for the maximum simultaneous MCPTT sessions supported for the MCPTT user.\n6)\tif the user identified by the MCPTT ID is not affiliated to the group identified in the <mcptt-request-uri> or in <associated-group-id> element of the \"SIP INVITE request for originating participating MCPTT function\" as determined by clause 9.2.2.2.11, shall perform the actions specified in clause 9.2.2.2.12 for implicit affiliation; and\n7)\tif the actions for implicit affiliation specified in step 6) above were performed but not successful in affiliating the MCPTT user due to the MCPTT user already having N2 simultaneous affiliations (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 486 (Busy Here) response with the warning text set to \"102 too many simultaneous affiliations\" in a Warning header field as specified in clause 4.4. and skip the rest of the steps.\nNOTE 4:\tN2 is the total number of MCPTT groups that an MCPTT user can be affiliated to simultaneously as specified in 3GPP TS 23.379 [3].\nNOTE 5:\tIf the SIP INVITE request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow an exception to the N2 limit (specified in the <MaxAffiliationsN2> element of the <Common> element of the MCPTT user profile of the served MCPTT ID). Alternatively, a lower priority affiliation of the MCPTT user could be cancelled to allow for the new affiliation.\nIf the incoming SIP INVITE request does not contain an <associated-group-id> element, then the group identity contained in the <mcptt-request-uri> element is determined not to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity in the SIP INVITE request. If the participating MCPTT function is unable to identify the controlling MCPTT function for the on demand prearranged group call, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 6:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 7:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 8:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 9:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 10:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.3;\n3)\tshall set the Request-URI to the public service identity of the controlling MCPTT function determined in step 1);\n4)\tshall include the MCPTT ID of the calling user in <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request;\n11a)\tif the received SIP request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, then check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request to the received value, if the status is unequal activated then do not include a <functional-alias-URI> element;\nNOTE 11:\tThe participating MCPTT server learns the functional alias state for an MCPTT ID from procedures specified in clause 9A.2.2.2.7.\n5)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request as specified in clause 6.3.2.1.1.1;\n6)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in Annex F.3;\na)\tif not already included, shall include a Content-Type header field set to \"application/vnd.3gpp.location-info+xml\"; and\nb)\tif not already copied, shall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml MIME body received in the SIP INVITE request into an application/vnd.3gpp.mcptt-location-info+xml MIME body included in the outgoing SIP request;\nNOTE 12:\t\tNote that the application/vnd.3gpp.mcptt-info+xml MIME body will already have been copied into the outgoing SIP INVITE request by clause 6.3.2.1.3.\n7) if a Resource-Priority header field was included in the received SIP INVITE request, shall include a Resource-Priority header field according to rules and procedures of IETF RFC 4412 [29] set to the value indicated in the Resource-Priority header field of the SIP INVITE request from the MCPTT client;\nNOTE 13:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n8)\tif according to clause 6.4, the SIP INVITE request is regarded as being received with an implicit request to grant the floor to the originating MCPTT client:\nif:\na)\tthe incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the originating MCPTT client available; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n9)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nIf incoming SIP INVITE request contains an <associated-group-id> element, then the group identity contained in the <mcptt-request-uri> element is determined to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.10;\n2)\tshall include an SDP offer based upon the SDP offer in the received SIP INVITE request from the MCPTT client as specified in clause 6.3.2.1.1.1; and\n3)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP INVITE request, the participating MCPTT function:\n1)\tvoid;\n2)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2 with the clarification that if an <MKFC-GKTPs> element was contained in the received SIP 2xx response it is not included in the generated SIP 200 (OK) response;\nNOTE 14:\tIf an <MKFC-GKTPs> element is received in a SIP 2xx response, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the originating client.\n3)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n4)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n5)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n6)\tshall include an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response;\n7)\tif the procedures of clause 9.2.2.2.12 for implicit affiliation were performed in the present clause, shall complete the implicit affiliation by performing the procedures of clause 9.2.2.2.13;\n8)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4];\n9)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n10)\tshall start the SIP Session timer according to rules and procedures of IETF RFC 4028 [7].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response;\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4]; and\n4)\tif the implicit affiliation procedures of clause 9.2.2.2.12 were invoked in the current procedure, shall perform the procedures of clause 9.2.2.2.14.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request for a served MCPTT client of a chat MCPTT group, the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE 1:\tIf the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the participating MCPTT function may by means beyond the scope of this specification choose to accept the request.\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\nNOTE 2:\tIf the received SIP re-INVITE request is received within a pre-established session associated with an MCPTT group call, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n3)\tshall generate an outgoing SIP re-INVITE request as specified in clause 6.3.2.1.9;\n4)\tshall include the MCPTT ID of the originating user in <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request;\n5)\tshall, if the SIP re-INVITE request was received within an on-demand session, include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP re-INVITE request as specified in clause 6.3.2.1.1.1;\n6)\tshall, if the SIP re-INVITE request was received within a pre-established session, include in the SIP re-INVITE request an SDP offer based upon the previously negotiated SDP for the pre-established session as specified in clause 6.3.2.1.1.2;\n7)\tif the received SIP re-INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field; and\nNOTE 3: The controlling MCPTT function will determine the validity of the Resource-Priority header field.\n8)\tshall forward the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP re-INVITE request in step 7) the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tif the SIP 200 (OK) response is to be sent within an on-demand session, shall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tif the SIP 200 (OK) response is to be sent within a pre-established session shall include in the SIP 200 (OK) response an SDP answer based upon the previously negotiated SDP for the pre-established session;\n4)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response; and\n5)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4];\nUpon receipt of a SIP 403 (Forbidden) response to the sent SIP re-INVITE request the participating MCPTT function:\n1)\tshall generate a SIP 403 (Forbidden) response according to 3GPP TS 24.229 [4];\n2)\tshall copy, if included in the received SIP 403 (Forbidden) response, the application/vnd.3gpp.mcptt-info+xml MIME body MIME body to the outgoing SIP (Forbidden) response;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 403 (Forbidden) response; and\n4)\tshall forward the SIP 403 (Forbidden) response to the MCPTT client according to 3GPP TS 24.229 [4];\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", for a terminating MCPTT client of a chat MCPTT group, the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE 1:\tIf the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the participating MCPTT function can by means beyond the scope of this specification choose to accept the request.\n2)\tshall check the presence of the isfocus media feature tag in the Contact header field and if it is not present then the participating MCPTT function shall reject the request with a SIP 403 (Forbidden) response with the warning text set to \"104 isfocus not assigned\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\n3)\tvoid;\nNOTE 2:\tIf an <MKFC-GKTPs> element is received in a SIP INVITE request, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the terminating client.\n4)\tif:\na)\tthe invited MCPTT client has a pre-established session without an associated MCPTT call such that:\ni)\tthe media-level section for the offered MCPTT speech media stream is the same as the media-level section for MCPTT speech media stream in the existing pre-established session; and\nii)\tthe media-level section of the offered media-floor control entity is the same as the media-level section for media-floor control entity in the existing pre-established session;\nthen the participating MCPTT function may according to local policy perform the actions specified in clause 10.1.2.3.2.2 and skip the remaining steps of the current procedure;\n5)\tshall generate a SIP INVITE request as specified in clause 6.3.2.2.3;\n6)\tshall set the Request-URI to the public user identity associated with the MCPTT ID of the MCPTT user to be invited based on the contents of the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the received \"SIP INVITE request for terminating participating MCPTT function\";\n7)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the participating MCPTT function;\n8)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received \"SIP INVITE request for terminating participating MCPTT function\" as specified in clause 6.3.2.2.1;\n9)\tif the received SIP INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field;\n10)\tshall perform the procedures specified in clause 6.3.2.2.9 to include any MIME bodies in the received SIP INVITE request; and\n11)\tshall send the SIP INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP INVITE request sent to the MCPTT client, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n4)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request for a terminating MCPTT client of a chat MCPTT group, the participating MCPTT function:\n1)\tshall check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n2)\tif the outgoing SIP re-INVITE request will be sent in the dialog of a pre-established session, perform the actions in clause 10.1.2.3.2.2 and skip the remaining steps of the current procedure;\n3)\tshall generate an outgoing SIP re-INVITE request as specified in clause 6.3.2.2.10;\n4)\tshall include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP re-INVITE request as specified in clause 6.3.2.2.1; and\n5)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP re-INVITE request sent to the MCPTT client, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1; and\n3)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing a <resource-lists> element that contains a <list> element that contains an <entry> element with a \"uri\" attribute containing a SIP URI set to a chat group identity;\n2)\tan hname \"body\" parameter in the headers portion of the SIP URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"chat\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP REFER request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\nNOTE 1:\tIf the application/vnd.3gpp.mcptt-info MIME body included in the SIP REFER request as described at the top of the present clause contains an <emergency-ind> element or <imminentperil-ind> element set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4and shall not continue with any of the remaining steps;\n4)\tif through local policy in the participating MCPTT function, the user identified by the MCPTT ID is not authorised to make chat group calls, shall reject the SIP REFER request with a SIP 403 (Forbidden) response to the SIP REFER request, with warning text set to \"108 user not authorised to make group calls\" in a Warning header field as specified in clause 4.4.2;\n5)\tshall retrieve the group identity in the \"uri\" attribute within the <entry> element of a <list> element within the <resource-lists> element of the application/resource-lists+xml MIME body, referenced by the \"cid\" URL contained in the Refer-To header field of the SIP REFER request;\n6)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the participating MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nNOTE 3:\tIf the SIP REFER request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow for an exception to the limit for the maximum simultaneous MCPTT sessions supported for the MCPTT user.\n7)\tif received SIP REFER request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.2.1.8.3;\n8)\tif the SIP REFER request contains in the application/vnd.3gpp.mcptt-info+xml MIME body:\na)\tan <emergency-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency group call as determined by clause 6.3.2.1.8.1;\nb)\tan <alert-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as determined by clause 6.3.2.1.8.2; or\nc)\tan <imminentperil-ind> element set to a value of \"true\" and this is an unauthorised request for an MCPTT imminent peril group call as determined by clause 6.3.2.1.8.1;\nthen shall reject the SIP REFER request with a SIP 403 (Forbidden) response and skip the rest of the steps;\n9)\tif the user identified by the MCPTT ID is not affiliated to the group identified in the SIP REFER request or in the <associated-group-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body as determined by clause 9.2.2.2.11, shall perform the actions specified in clause 9.2.2.2.12 for implicit affiliation;\n10)\tif the actions for implicit affiliation specified in step 9) above were performed but not successful in affiliating the MCPTT user due to the MCPTT user already having N2 simultaneous affiliations (specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile), shall reject the SIP REFER request with a SIP 486 (Busy Here) response with the warning text set to \"102 too many simultaneous affiliations\" in a Warning header field as specified in clause 4.4. and skip the rest of the steps;\nNOTE 4:\tN2 is the total number of MCPTT groups that an MCPTT user can be affiliated to simultaneously as specified in 3GPP TS 23.379 [3].\nNOTE 5:\tIf the SIP REFER request contains an emergency indication set to a value of \"true\" or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to allow an exception to the N2 limit (specified in the <MaxAffiliationsN2> element of the <Common> element of the MCPTT user profile of the served MCPTT ID). Alternatively, a lower priority affiliation of the MCPTT user could be cancelled to allow for the new affiliation.\n11)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP TS 24.229 [4];\n12)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing the value \"false\" and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\nIf the incoming SIP REFER request does not contain an <associated-group-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body, then the group identity contained in the application/resource-lists MIME body is determined not to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity in the \"uri\" attribute within the <entry> element of a <list> element within the <resource-lists> element in the application/resource-lists+xml MIME body pointed to by the \"cid\" URL in the Refer-To header field of the SIP REFER request. If the participating MCPTT function is unable to identify the controlling MCPTT function associated with the group identity, it shall reject the REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with the remaining steps;\nNOTE 6:\tThe public service identity can identify the controlling function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 7:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 8:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 9:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 10:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall send the SIP 200 (OK) response to the SIP REFER request towards the MCPTT client according to 3GPP TS 24.229 [4];\nNOTE 11:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n3)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.4;\n4)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the controlling MCPTT function determined in step 13);\n5)\tshall copy the group identity from the \"uri\" attribute of the <entry> element of a <list> element within the <resource-lists> element of the application/resource-lists+xml MIME body pointed to by the \"cid\" URL in the Refer-to header field of the SIP REFER request, to the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request;\n6)\tif the received SIP REFER request contained a Resource-Priority header field, shall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request from the MCPTT client;\n7)\tif, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n8)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nIf incoming SIP REFER request contains an <associated-group-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body, then the group identity contained in the application/resource-lists MIME body is determined to be a TGI or the identity of a group regroup based on a preconfigured group and the participating MCPTT function:\n1)\tshall send the SIP 200 (OK) response to the SIP REFER request towards the MCPTT client according to 3GPP TS 24.229 [4];\n2)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.10;\n3)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the non-controlling MCPTT function associated with the group identity contained in the <associated-gourp-id> element of the incoming SIP REFER request;\n4)\tshall copy the group identity from the \"uri\" attribute of the <entry> element of the application/resource-lists MIME body pointed to by the \"cid\" URL in the Refer-to header field of the SIP REFER request, to the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request;\n5)\tif the received SIP REFER request contained a Resource-Priority header field, shall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request from the MCPTT client; and\n6)\tshall include in the SIP INVITE request an SDP offer based upon the SDP offer negotiated during the pre-established session establishment, any subsequent pre-established session modification and the SDP offer (if any) included in the hname \"body\" parameter in the headers portion of the SIP URI contained in the <entry> element of the application/resource-lists MIME body, referenced by the \"cid\" URL in the Refer-To header field in the incoming SIP REFER request from the MCPTT client;\n7)\tif, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n8)\tshall send the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP INVITE request in step 19) the participating MCPTT function shall follow procedures specified in 3GPP TS 24.229 [4], with the clarifications given below:\n1)\tshall cache the contact received in the Contact header field;\n2)\tif the procedures of clause 9.2.2.2.12 for implicit affiliation were performed in the present clause, shall complete the implicit affiliation by performing the procedures of clause 9.2.2.2.13;\n3)\tif the received SIP 2xx response was in response to a request for an MCPTT group call containing a Resource-Priority header field populated for an MCPTT emergency group call or MCPTT imminent peril group call as specified in clause 6.3.2.1.8.4 and does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\":\na)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.5; and\nb)\tshall send the SIP re-INVITE request to the MCPTT client according to 3GPP TS 24.229 [4]; and\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nNOTE 12:\tThere are two cases covered in the handling of the received SIP 2xx response above. The first case is when the SIP INVITE request sent to the controlling MCPTT function contained a Resource-Priority header field populated appropriately to request emergency level or imminent peril level priority but did not contain in the application/vnd.3gpp.mcptt-info+xml MIME body either an <emergency-ind> element or an <imminentperil-ind> element. The second case is when the SIP INVITE request sent to the controlling MCPTT function contained a Resource-Priority header field and contained either an <emergency-ind> element or an <imminentperil-ind> element. In either case, the received SIP 2xx response did not warn of a pending SIP INFO request.\nUpon receiving a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency call or MCPTT imminent peril call, the participating MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.5; and\n3)\tshall send the SIP re-INVITE request to the MCPTT client according to 3GPP TS 24.229 [4].\nNOTE 13:\tThis is the case where the SIP REFER request previously received from the MCPTT client contained a Resource-Priority header field populated for an MCPTT emergency group call or MCPTT imminent peril group call as specified in clause 6.3.2.1.8.4 but was also a request for either an MCPTT emergency group call or an MCPTT imminent peril group call.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request sent to the controlling MCPTT function, the participating MCPTT function:\n1)\tif the implicit affiliation procedures of clause 9.2.2.2.12 were invoked in the present clause, shall perform the procedures of clause 9.2.2.2.14; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nNOTE 1:\tIf an <MKFC-GKTPs> element is received in a SIP INVITE request, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the terminating client.\nUpon receipt of a SIP INVITE request or a SIP re-INVITE request for a terminating MCPTT client of a chat MCPTT group using a pre-established session, the participating MCPTT function:\n1)\tshall generate an outgoing SIP re-INVITE request as specified in clause 6.3.2.2.10 to be sent within the dialog of the pre-established session;\n2)\tif the received SIP INVITE request or SIP re-INVITE request contains a Resource-Priority header field, shall include a Resource-Priority header field with the contents set as in the received Resource-Priority header field;\n3)\tshall include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request or SIP re-INVITE request as specified in clause 6.3.2.1.1.2; and\nNOTE 2:\tThe media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as in the existing pre-established session as per the conditions for pre-established session usage specified in clause 10.1.2.3.1.3.\n4)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the above SIP re-INVITE request sent to the MCPTT client, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in clause 6.3.2.2.2.2; and\n3)\tshall send the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nUpon receiving from the MCPTT client a SIP BYE request the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.6.\nUpon receiving from the MCPTT client a SIP REFER request when using a pre-established session with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.7.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.1.\nUpon receiving a SIP BYE request from the controlling MCPTT function and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.2.\nIn the procedures in this clause:\n1)\tMCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the originating user from the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\tgroup identity in an incoming SIP INVITE request refers to the group identity from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n3)\tMCPTT ID in an outgoing SIP INVITE request refers to the MCPTT ID of the called user in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request;\n4)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n5)\talert indication in an incoming SIP INVITE request refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" containing a group identity identifying a chat MCPTT group, the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tIf the SIP INVITE request contains an emergency indication set to a value of \"true\", the controlling MCPTT function can by means beyond the scope of this specification choose to accept the request.\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag;\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; or\nc)\tthe isfocus media feature tag is present in the Contact header field;\n3)\tif received SIP INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.3.1.17;\n4)\tif the group identity is associated with a group document maintained by the GMS:\nNOTE 2:\tHow the MCPTT server determines that a group identity represents a group for which a group document is stored in the GMS is implementationspecific.\na)\tshall retrieve the necessary group document(s) from the group management server for the group identity contained in the SIP INVITE request and carry out initial processing as specified in clause 6.3.5.2;\nb)\tif the group document contains a <list -service> element that contains a <preconfigured-group-use-only> element that is set to the value \"true\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"167 call is not allowed on the preconfigured group\" as specified in clause 4.4 and skip the rest of the steps;\nc)\tif the group referred to by the group identity has been regrouped:\ni)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"148 group is regrouped\" as specified in clause 4.4 \"Warning header field\";\nii)\tif the group referred to by the group identity has been regrouped based on a preconfigured group, shall send a copy of the notifying SIP MESSAGE that was generated and sent per clause 16.2.4.1 to the participating function for the MCPTT ID of the incoming SIP INVITE request; and\niii)\tshall skip the rest of the steps;\nd)\tif the result of the initial processing in clause 6.3.5.2 was that a SIP 4xx, 5xx or 6xx response to the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" has been sent, do not continue with the rest of the steps in this clause;\n5)\tif the group identity is associated with a user or group regroup based on a preconfigured group:\na)\tshall retrieve the stored information for the group identity;\nb)\tif there is no stored information for the group identity, the controlling MCPTT function:\ni)\tshall return a SIP 404 (Not Found) response with the warning text set to \"163 the group identity indicated in the request does not exist\" as specified in clause 4.4 \"Warning header field\" and shall not continue with the rest of the steps;\nNOTE 3:\tThe user or group regroup can have been removed very recently and the client has sent the group call request prior to receiving the removal notification.\n5a)\tif the group identity is associated with a TGI or the identity of a group regroup based on a preconfigured group and the received SIP INVITE request does not include an <mcptt-calling-group-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall return a SIP 403 (Forbidden) response to \"SIP INVITE request for controlling MCPTT function of an MCPTT group\".\n6)\tif the MCPTT user identified by the MCPTT ID in the SIP INVITE request is not affiliated with the MCPTT group identified by the group identity in the SIP INVITE request as determined by the procedures of clause 6.3.6:\na)\tif the MCPTT user is eligible to be implicitly affiliated with the MCPTT chat group as determined by clause 9.2.2.3.6; and\nb)\tif the group identity contained in an <mcptt-calling-group-id> element of the SIP INVITE request is not a constituent MCPTT group ID;\nNOTE 4:\tIf the SIP INVITE is for a temporary group or a group regroup based on preconfigured group, the affiliation of the calling user to the constituent group has been assured by the non-controlling MCPTT function of the constituent group before forwarding this SIP INVITE to the controlling function of the regroup.\n, then shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n7)\tif the SIP INVITE request contains unauthorised request for an MCPTT emergency group call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n8)\tif the SIP INVITE request contains an unauthorised request for an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.6, shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the following clarifications:\na)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\"; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n9)\tif a Resource-Priority header field is included in the SIP INVITE request:\na)\tif the Resource-Priority header field is set to the value indicated for emergency calls and the SIP INVITE request does not contain an emergency indication and the in-progress emergency state of the group is set to a value of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps; and\nb)\tif the Resource-Priority header field is set to the value indicated for imminent peril calls and the SIP INVITE request does not contain an imminent peril indication and the in-progress imminent peril state of the group is set to a value of \"false\", shall reject the SIP INVITE request with a SIP 403 (Forbidden) response; and skip the remaining steps;\n10)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n11)\tif the chat group session is not ongoing then:\na)\tshall create a chat group session and allocate an MCPTT session identity for the chat group session, and may handle timer TNG3 (group call timer) as specified in clause 6.3.3.5;\nb)\tif the group identity in the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" is a TGI or the identity of a group regroup based on a preconfigured group:\ni)\tshall, for each of the constituent MCPTT groups except for the calling MCPTT group identified in the <mcptt-calling-group-id> element of the incoming SIP INVITE, generate a SIP INVITE request towards the MCPTT non-controlling function that owns the constituent MCPTT group identity by following the procedures in clause 10.1.2.4.1.1A;\n12)\tif the chat group session is ongoing and the <on-network-max-participant-count> as specified in 3GPP TS 24.481 [31] is already reached:\na)\tif, according to local policy, the user identified by the MCPTT ID in the SIP INVITE request is deemed to have a higher priority than an existing user in the chat group session, may remove a participant from the session by following clause 10.1.1.4.4.3, and skip the next step; and\nNOTE 5:\tThe local policy for deciding whether to admit a user to a call that has reached its maximum amount of participants can include the <user-priority> and the <participant-type> of the user as well as other information of the user from the group document as specified in 3GPP TS 24.481 [31]. The local policy decisions can also include taking into account whether the imminent-peril indicator or emergency indicator was received in the SIP INVITE request.\nb)\tshall return a SIP 486 (Busy Here) response with the warning text set to \"122 too many participants\" to the originating network as specified in clause 4.4 Otherwise, continue with the rest of the steps;\n13)\tif the received SIP INVITE request was determined to be eligible for implicit affiliation in step 5) and if clause 9.2.2.3.7 was not previously invoked in the present clause, shall perform the implicit affiliation as specified in clause 9.2.2.3.7;\n14)\tif the SIP INVITE request contains an emergency indication set to a value of \"true\" or the in-progress emergency state of the group to \"true\" the controlling MCPTT function shall:\na)\tvalidate that the SIP INVITE request includes a Resource-Priority header field populated with the values for an MCPTT emergency group call as specified in clause 6.3.3.1.19, and if not:\ni)\tperform the actions specified in clause 6.3.3.1.8;\nii)\tsend the SIP UPDATE request generated in clause 6.3.3.1.8 towards the initiator of the SIP INVITE request according to 3GPP TS 24.229 [4]; and\niii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8, proceed with the rest of the steps.\nNOTE 6:\tVerify that the Resource-Priority header is included and properly populated for both ongoing and newly- entered in-progress emergency states of the specified group.\nb)\tif the in-progress emergency state of the group is set to a value of \"true\" and the MCPTT user is indicating a new emergency indication:\ni)\tfor each of the other affiliated members of the group generate a SIP MESSAGE request notification of the MCPTT user's emergency indication as specified in clause 6.3.3.1.11 with the following clarifications:\nA)\tset the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nB)\tif the received SIP INVITE contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, perform the procedures specified in clause 6.3.3.1.12; and\nC)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nii)\tcache the information that the MCPTT user has initiated an MCPTT emergency call; and\niii)\tif the SIP INVITE request contains an authorised request for an MCPTT emergency alert as determined in step i) B) above, cache the information that the MCPTT user has initiated an MCPTT emergency alert; and\nc)\tif the in-progress emergency state of the group is set to a value of \"false\":\ni)\tshall set the value of the in-progress emergency state of the group to \"true\";\nii)\tshall start timer TNG2 (in-progress emergency group call timer) and handle its expiry as specified in clause 6.3.3.1.16;\niii)\tshall generate SIP re-INVITE requests for the MCPTT emergency group call to the other affiliated and joined participants of the chat MCPTT group as specified in clause 6.3.3.1.6;\niv)\tshall generate SIP INVITE requests for the MCPTT emergency group call to the affiliated but not joined members of the chat MCPTT group as specified in clause 6.3.3.1.7;\nA)\tfor each affiliated but not joined member shall send the SIP INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tupon receiving a SIP 200 (OK) response to the SIP INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\nv)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency call; and\nvi)\tif the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is set to \"true\" and is an authorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall cache the information that the MCPTT user has initiated an MCPTT emergency alert; and\nvii)\tif the in-progress imminent peril state of the group is set to a value of \"true\", shall set it to a value of \"false\";\n15)\tif the in-progress emergency state of the group is set to a value of \"false\" and if the SIP INVITE request contains an imminent peril indication set to a value of \"true\" or the in-progress imminent peril state of the group is set to \"true\", the controlling MCPTT function shall:\na)\tvalidate that the SIP INVITE request includes a Resource-Priority header field populated with the values for an MCPTT imminent peril group call as specified in clause 6.3.3.1.19, and if not:\ni)\tperform the actions specified in clause 6.3.3.1.8;\nii)\tsend the SIP UPDATE request generated in clause 6.3.3.1.8 towards the initiator of the SIP INVITE request according to 3GPP TS 24.229 [4]; and\niii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8 proceed with the rest of the steps.\nNOTE 7:\tVerify that the Resource-Priority header is included and properly populated for both ongoing and newly- entered in-progress imminent peril states of the specified group.\nb)\tif the in-progress imminent peril state of the group is set to a value of \"true\" and the MCPTT user is indicating a new imminent peril indication:\ni)\tfor each of the other affiliated member of the group generate a SIP MESSAGE request notification of the MCPTT user's imminent peril indication as specified in clause 6.3.3.1.11 with the following clarifications;\nA)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nii)\tcache the information that the MCPTT user has initiated an MCPTT imminent peril call; and\nc)\tif the in-progress imminent peril state of the group is set to a value of \"false\":\ni)\tshall set the value of the in-progress imminent peril state of the group to \"true\";\nii)\tshall generate SIP re-INVITE requests for the MCPTT imminent peril group call to the other affiliated and joined participants of the chat MCPTT group as specified in clause 6.3.3.1.15;\niii)\tshall generate SIP INVITE requests for the MCPTT imminent peril call to the affiliated but not joined members of the chat MCPTT group as specified in clause 6.3.3.1.7;\nA)\tfor each affiliated but not joined member shall send the SIP INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\niv)\tshall cache the information that the MCPTT user has initiated an MCPTT imminent peril call;\n16)\tshall accept the SIP request and generate a SIP 200 (OK) response to the SIP INVITE request according to 3GPP TS 24.229 [4];\n17)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1 unless the procedures of clause 6.3.3.1.8 were performed in step 13)a) or step 14)a) above;\n18)\tshould include the Session-Expires header field and start supervising the SIP session according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n19)\tshall include the \"timer\" option tag in a Require header field;\n20)\tshall include the following in a Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\nc)\tthe MCPTT session identity; and\nd)\tthe media feature tag isfocus;\n21)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n22)\tif the SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n23)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\" and if the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 8:\tIn this case, the request was for an imminent peril call but a higher priority MCPTT emergency call was already in progress on the group. Hence, the imminent peril call request aspect of the request is denied but the request is granted with emergency level priority.\n24)\tshall interact with media plane as specified in 3GPP TS 24.380 [5];\n25)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4]; and\n26)\tif the chat group session was already ongoing and if at least one of the participants has subscribed to the conference event package, shall send a SIP NOTIFY request to all participants with a subscription to the conference event package as specified in clause 10.1.3.4.2.\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client or towards the inviting non-controlling MCPTT function, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\n2)\tshall set the Request-URI to the public service identity of the non-controlling MCPTT function serving the group identity of the constituent MCPTT group;\nNOTE 1:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 2:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 3:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function serving the MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 4:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n3)\tshall set the P-Asserted-Identity to the public service identity of the controlling MCPTT function;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request:\na)\tthe <mcptt-request-uri> element set to the group identity of the constituent MCPTT group served by the non-controlling MCPTT; and\nb)\tthe <mcptt-calling-group-id> element set to the group identity of the group served by the controlling MCPTT function;\n5)\tshall include the Recv-Info header field set to g.3gpp.mcptt-floor-request;\n6)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1; and\n7)\tshall send the SIP INVITE request towards the non-controlling MCPTT function in accordance with 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\n2)\tif at least one MCPTT clients has subscribed to the conference package, shall subscribe to the conference event package in the non-controlling MCPTT function as specified in clause 10.1.3.4.3; and\n3)\tif the 200 (OK) response includes the <floor-state> element set to \"floor-taken\", shall wait for a SIP INFO request containing a floor request from the non-controlling MCPTT function.\nUpon receiving a SIP INFO request containing a floor request where:\n1)\tthe Request-URI contains an MCPTT session ID identifying an ongoing temporary group session; and\n2)\tthe application/vnd.3gpp.mcptt-info+xml MIME body contains the <mcptt-calling-group-id> element with the MCPTT group ID of a MCPTT group invited to the temporary group session;\nthen the controlling MCPTT function:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the non-controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP re-INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\timminent peril indication in an incoming SIP re-INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a SIP re-INVITE request for an MCPTT session identity identifying a chat MCPTT group session, the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tif the SIP re-INVITE request contains an emergency indication or an imminent peril indication set to a value of \"true\" and this is an authorised request for originating an MCPTT emergency group call as determined by clause 6.3.3.1.13.2, or for originating an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5, the controlling MCPTT function can according to local policy choose to accept the request.\n2)\tif the received SIP re-INVITE request includes an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element included or an <imminentperil-ind> element included, shall validate the request as described in clause 6.3.3.1.17;\n3)\tif the SIP re-INVITE request contains an unauthorised request to initiate an MCPTT emergency call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n4)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\" and is an authorised request to initiate an MCPTT emergency group call as determined by clause 6.3.3.1.13.2, the controlling MCPTT function shall:\na)\tvalidate that the SIP re-INVITE request includes a Resource-Priority header field is populated correctly for an MCPTT emergency group call as specified in clause 6.3.3.1.19, and if not:\ni)\tshall perform the actions specified in clause 6.3.3.1.8; and\nii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8 shall proceed with the rest of the steps.\nNOTE 2:\tVerify that the Resource-Priority header is included and properly populated for both ongoing and newly-entered in-progress emergency states of the specified group.\nb)\tif the in-progress emergency state of the group is set to a value of \"true\" and the MCPTT user is indicating a new emergency indication:\ni)\tshall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency call;\nii)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\" and is an authorised request for an MCPTT emergency alert as determined by clause 6.3.3.1.13.1, shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency alert; and\niii)\tfor each of the other affiliated members of the group, generate a SIP MESSAGE request notification of the MCPTT user's emergency indication as specified in clause 6.3.3.1.11 with the following clarifications:\nA)\tset the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nB)\tif the received SIP re-INVITE contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, perform the procedures specified in clause 6.3.3.1.12; and\nC)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nc)\tif the in-progress emergency state of the group is set to a value of \"false\":\ni)\tshall set the value of the in-progress emergency state of the group to \"true\";\nii)\tshall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency call;\niii)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall cache the MCPTT ID of the MCPTT user that has initiated an MCPTT emergency alert;\niv)\tshall start timer TNG2 (in-progress emergency group call timer) and handle its expiry as specified in clause 6.3.3.1.16;\nv)\tshall generate SIP re-INVITE requests for the MCPTT emergency group call to the other affiliated and joined participants of the chat MCPTT group as specified in clause 6.3.3.1.6. The MCPTT controlling function:\nA)\tfor each affiliated and joined member shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nvi)\tshall generate SIP INVITE requests for the MCPTT emergency group call to the affiliated but not joined members of the chat MCPTT group as specified in clause 6.3.3.1.7. The controlling MCPTT function:\nA)\tfor each affiliated but not joined member shall send the SIP INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nvii)\tif the in-progress imminent peril state of the group is set to a value of \"true\", shall set it to a value of \"false\";\n5)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and is an unauthorised request for an MCPTT emergency group call cancellation as determined by clause 6.3.3.1.13.4:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;\nb)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with an <emergency-ind> element set to a value of \"true\";\nc)\tif an <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is included set to \"false\" and there is an outstanding MCPTT emergency alert for the MCPTT user, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body and <alert-ind> element set to a value of \"true\"; and\nd)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n6)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and is determined to be an authorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4 and the in-progress emergency state of the group to is set to a value of \"true\" the controlling MCPTT function shall:\na)\tvalidate that the SIP re-INVITE request includes a Resource-Priority header field is populated correctly for a normal priority MCPTT group call as specified in clause 6.3.3.1.19, and if not:\ni)\tshall perform the actions specified in clause 6.3.3.1.8; and\nii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8 shall proceed with the rest of the steps;\nNOTE 3:\tVerify that the Resource-Priority header is included and properly populated for an in-progress emergency state cancellation of the specified group.\nb)\tshall set the in-progress emergency group state of the group to a value of \"false\";\nc)\tshall clear the cache of the MCPTT ID of the MCPTT user identified by the <originated-by> element as having an outstanding MCPTT emergency group call;\nd)\tif an <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is included and set to \"false\" and is determined to be an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3 and there is an outstanding MCPTT emergency alert for the MCPTT user shall:\ni)\tif the received SIP re-INVITE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the MCPTT user identified by the <originated-by> element as having an outstanding MCPTT emergency alert; and\nii)\tif the received SIP re-INVITE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the sender of the SIP re-INVITE request as having an outstanding MCPTT emergency alert;\ne)\tshall generate SIP re-INVITE requests to the other affiliated and joined members of the MCPTT group as specified in clause 6.3.3.1.6. The MCPTT controlling function:\ni)\tfor each affiliated and joined member shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nii)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 4:\tClause 6.3.3.1.6 will inform the affiliated and joined members of the cancellation of the MCPTT group's in-progress emergency state and the cancellation of the MCPTT emergency alert if applicable.\nf)\tfor each of the affiliated but not joined members of the group shall:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency call as specified in clause 6.3.3.1.11;\nii)\tset the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";\niii)\tif indicated above in step d), set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and\niv)\tsend the SIP MESSAGE request according to 3GPP TS 24.229 [4];\n7)\tif a Resource-Priority header field is included in the SIP re-INVITE request:\na)\tif the Resource-Priority header field is set to the value indicated for emergency calls and the received SIP re-INVITE request does not contain an authorised request for an MCPTT emergency call as determined in step 4) above and the in-progress emergency state of the group is set to a value of \"false\", shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps; or\nb)\tif the Resource-Priority header field is set to the value indicated for imminent peril calls and the received SIP re-INVITE request does not contain an authorised request for an MCPTT imminent peril call as determined by the procedures of clause 6.3.3.1.13.5 and the in-progress imminent peril state of the group is set to a value of \"false\", shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps;\n8)\tif the received SIP re-INVITE request contains an imminent peril indication, shall perform the procedures specified in clause 10.1.2.4.1.3 and skip the rest of the steps;\n9)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1 unless the procedures of clause 6.3.3.1.8 were performed in step 6) a) i) above;\n10)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n11)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\" and if this is an unauthorised request for an MCPTT emergency alert as determined by clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n12)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\" and if this is an unauthorised request for an MCPTT emergency alert cancellation as determined by clause 6.3.3.1.13.3, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\n13)\tif the received SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\", this is an authorised request for an MCPTT imminent peril group call and if the in-progress emergency state of the group is set to a value of \"true\", shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 5:\tIn this case, the request was for an imminent peril call but a higher priority MCPTT emergency call was already in progress on the group. Hence, the imminent peril call request aspect of the request is denied but the request is granted with emergency level priority.\n14)\tshall interact with media plane as specified in 3GPP TS 24.380 [5]; and\n15)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nIn the procedures in this clause:\n1)\timminent peril indication in an incoming SIP INVITE request refers to the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nWhen the controlling function receives a SIP re-INVITE request with and imminent peril indication, the controlling function:\n1)\tif the SIP re-INVITE request contains an unauthorised request to initiate an MCPTT imminent peril group call as determined by clause 6.3.3.1.13.5, shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response with the following clarifications:\na)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\"; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n2)\tif the in-progress emergency group state of the group is set to a value of \"false\" and if the SIP re-INVITE request contains an imminent peril indication set to a value of \"true\" or the in-progress imminent peril state of the group to \"true\", the controlling MCPTT function shall:\na)\tvalidate that the SIP re-INVITE request includes a Resource-Priority header field with the namespace set to the MCPTT-specific namespace specified in IETF RFC 8101 [48] and the priority set to the priority designated for imminent peril calls and if not:\ni)\tperform the actions specified in clause 6.3.3.1.8;\nii)\tsend the SIP UPDATE request generated in clause 6.3.3.1.8 towards the initiator of the SIP re-INVITE request according to 3GPP TS 24.229 [4]; and\niii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8 proceed with the rest of the steps.\nNOTE 3:\tVerify that the Resource-Priority header is included and properly populated for both ongoing and newly- entered in-progress imminent peril states of the specified group.\nb)\tif the in-progress imminent peril state of the group is set to a value of \"true\" and the MCPTT user is indicating a new imminent peril indication:\ni)\tfor each of the other affiliated member of the group generate a SIP MESSAGE request notification of the MCPTT user's imminent peril indication as specified in clause 6.3.3.1.11 with the following clarifications;\nA)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\"; and\nB)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nii)\tcache the information that the MCPTT user has initiated an MCPTT imminent peril call; and\nc)\tif the in-progress imminent peril state of the group is set to a value of \"false\":\ni)\tshall set the value of the in-progress imminent peril state of the group to \"true\";\nii)\tshall generate SIP re-INVITE requests for the MCPTT imminent peril group call to the other affiliated and joined participants of the chat MCPTT group as specified in clause 6.3.3.1.15;\niii)\tshall generate SIP INVITE requests for the MCPTT imminent peril group call to the affiliated but not joined members of the chat MCPTT group as specified in clause 6.3.3.1.7;\nA)\tfor each affiliated but not joined member shall send the SIP INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\niv)\tshall cache the information that the MCPTT user has initiated an MCPTT imminent peril call;\n3)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"false\" and is an unauthorised request for an MCPTT imminent peril group call cancellation as determined by clause 6.3.3.1.13.6 shall:\na)\treject the SIP re-INVITE request with a SIP 403 (Forbidden) response to the SIP re-INVITE request; and\nb)\tinclude in the SIP 403 (Forbidden) response:\ni)\tinclude in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in Annex F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <imminentperil-ind> element set to a value of \"false\";\nii) send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4]; and\niii) skip the rest of the steps;\n4)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"false\" and is determined to be an authorised request for an MCPTT imminent peril call cancellation as specified in clause 6.3.3.1.13.6 and the in-progress imminent peril state of the group to is set to a value of \"true\" the controlling MCPTT function shall:\na)\tvalidate that the SIP re-INVITE request includes a Resource-Priority header field with the namespace set to the MCPTT-specific namespace specified in IETF RFC 8101 [48], and the priority set to the priority level designated for a normal priority MCPTT group call, and if not:\ni)\tshall perform the actions specified in clause 6.3.3.1.8; and\nii)\tupon receiving a SIP 200 (OK) response to the SIP UPDATE request sent in clause 6.3.3.1.8 shall proceed with the rest of the steps;\nNOTE 3:\tverify that the Resource-Priority header is included and properly populated for an in-progress emergency group state cancellation of the specified group.\nb)\tshall set the in-progress imminent peril state of the group to a value of \"false\";\nc)\tshall cache the information that the MCPTT user no longer has an outstanding MCPTT imminent peril group call;\nd)\tshall generate SIP re-INVITES requests to the other affiliated and joined members of the MCPTT group as specified in clause 6.3.3.1.15. The MCPTT controlling function:\ni)\tfor each affiliated and joined member shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nii)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 4:\tclause 6.3.3.1.15 will inform the affiliated and joined members of the cancellation of the MCPTT group's in-progress emergency group state and the cancellation of the MCPTT emergency alert if applicable.\ne)\tfor each of the affiliated but not joined members of the group shall:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's imminent peril call as specified in clause 6.3.3.1.11;\nii)\tset the <imminentperil-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and\niii)\tsend the SIP MESSAGE request according to 3GPP TS 24.229 [4];\n5)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1 unless the procedures of clause 6.3.3.1.8 were performed in step 2) or 4) above;\n6)\tshall include the \"norefersub\" option tag in a Supported header field according to IETF RFC 4488 [22];\n7)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n8)\tshall interact with media plane as specified in 3GPP TS 24.380 [5]; and\n9)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP BYE request the controlling MCPTT function shall follow the procedures as specified in clause 6.3.3.2.4.\nThis clause describes the procedures of each functional entity for ending the group call initiated by the controlling MCPTT function.\nWhen the MCPTT session for group call needs to be released as specified in clause 6.3.8.1, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nWhen an MCPTT client needs to be removed from the MCPTT session (e.g. due to de-affiliation or admitting a higher priority user), the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nAfter successful removing the MCPTT client from the MCPTT session, the controlling MCPTT function may generate a notification to the MCPTT clients, which have subscribed to the conference event package that an MCPTT user has been removed from the MCPTT session, as specified in clause 6.3.3.4 and send the SIP NOTIFY request to the MCPTT client according to 3GPP TS 24.229 [4].\nWhen receiving the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" the MCPTT server can be acting as a controller MCPTT function in an ongoing chat group call or, if a chat group call is not ongoing, be initiated as an non-controlling MCPTT function and invite MCPTT users.\nIf a chat group call is not ongoing the MCPTT server shall perform the actions specified in clause 10.1.2.5.1.2.\nIf the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" is received when a chat group call is ongoing, the controlling MCPTT function may switch from operating in a controlling MCPTT function mode to operate in a non-controlling MCPTT function mode as specified in clause 10.1.2.5.1.3.\nWhen operating in the non-controlling mode and a SIP BYE request is received from the controlling MCPTT function, the non-controlling MCPTT function shall change from operating in the non-controlling mode to operating in the controlling mode as specified in clause 10.1.2.5.1.4.\nUpon receipt of a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" and if a chat group call is not ongoing, the non-controlling MCPTT function of an MCPTT group:\nNOTE 1:\tThe Contact header field of the SIP INVITE request contains the isfocus media feature tag.\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tif the partner MCPTT system does not have a mutual aid relationship with the primary MCPTT system identified by the contents of the P-Asserted-Identity, shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"128 isfocus already assigned\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\n5)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n6)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.4.2.2.2 before continuing with the rest of the steps;\n7)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.4.2.1;\n8)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.5; and\nNOTE 2:\tResulting media plane processing is completed before the next step is performed.\n9)\tshall send a SIP 200 (OK) response to the controlling MCPTT function according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" and if a chat group call is already ongoing, the non-controlling MCPTT function of an MCPTT group:\nNOTE 1:\tThe Contact header field of the SIP INVITE request contains the isfocus media feature tag.\n1)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2A)\tif the MCPTT emergency group call state is set to either \"MEGC 2: emergency-call-requested\" or \"MEGC 3: emergency-call-granted\" shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"166 constituent group is in an emergency call state\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\nNOTE 2:\t3GPP TS 23.280 [82] includes the possibility that local policy could allow a constituent group that is in an emergency state to be included in a group regroup; however, the transfer of that emergency state to the group regroup from the constituent group is not supported in the present document.\n3)\tif the partner MCPTT system does not have a mutual aid relationship with the primary MCPTT system identified by the contents of the P-Asserted-Identity, shall reject the \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" with a SIP 403 (Forbidden) response, with warning text set to \"128 isfocus already assigned\" in a Warning header field as specified in clause 4.4, and shall not process the remaining steps;\n4)\tshall cache the content of the SIP INVITE request, if received in the Contact header field and if the specific feature tags are supported;\n5)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n6)\tshall generate SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.4.2.2.2 before continuing with the rest of the steps;\n7)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.4.2.1;\n8)\tshall instruct the media plane to initialise the switch to the non-controlling mode as specified in 3GPP TS 24.380 [5] clause 6.5.2.3;\nNOTE 3:\tResulting media plane processing is completed before the next step is performed. The media plane indicates the state of the floor and if the state is \"floor-taken\", information about the current speaker(s).\n9)\tif the media plane provided information about the current speaker(s), cache the information about the current speaker(s); and\n10)\tshall send a SIP 200 (OK) response to the controlling MCPTT function according to 3GPP TS 24.229 [4].\nUpon receipt of the SIP ACK request, the non-controlling MCPTT function of an MCPTT group:\n1)\tif information about a current speaker(s) is cached:\na)\tshall generate a SIP INFO request as specified in clause 6.3.4.1.3; and\nb)\tshall send the SIP INFO request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall instruct the media plane to finalise the switch to the non-controlling mode as specified in 3GPP TS 24.380 [5] clause 6.3.5.3; and\n3)\tif at least one of the MCPTT clients in the chat group session has a subscription to the conference event package, shall subscribe to the conference event package from the controlling MCPTT function as specified in clause 10.1.3.5.3.\nUpon receipt of a SIP BYE request, the non-controlling MCPTT function of an MCPTT group:\n1)\tif keeping the chat group call active is according to the release policy in clause 6.3.8.1, shall request media plane to switch to controlling mode as specified in 3GPP TS 24.380 [5] clause 6.3.5;\nNOTE 1:\tResulting media plane processing is completed before the next step is performed.\n2)\tshall send a SIP 200 (OK) response to the SIP BYE request; and\n3)\tif at least one MCPTT client has subscribed to the conference package, shall send a NOTIFY request to all participants with a subscription to the conference event package as specified in clause 10.1.3.5.2.\nNOTE 2:\tThe SIP NOTIFY request will indicate that all participants, with the exception of the MCPTT users belonging to the constituent MCPTT group hosted by the non-controlling MCPTT function, have left the group session.\nUpon receiving of a \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" when a chat session is ongoing, the non-controlling MCPTT function shall act as a controlling MCPTT function towards the MCPTT client and shall perform the actions in the clause 10.1.2.4.1.1 with the following clarifications:\n1)\tthe MCPTT session identity in the Contact header field of the SIP 200 (OK) response shall be the MCPTT session identity generated by the non-controlling MCPTT function; and\n2)\tthe clause 10.1.3.5.2 shall be used when sending the SIP NOTIFY request for subscriptions to the conference event package.\nUpon receipt of a SIP re-INVITE request from an MCPTT client the non-controlling MCPTT function shall act as the controlling MCPTT function and shall perform the actions in clause 10.1.2.4.1.2.\nUpon receiving a \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" when a chat group session is not ongoing, the non-controlling MCPTT-function shall:\nNOTE 1:\tThe difference between a \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" and a \"SIP INVITE request for non-controlling MCPTT function of an MCPTT group\" (from the controlling MCPTT function) is that the latter SIP INVITE request contains the isfocus media feature tag in the Contact header field.\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The non-controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tshall retrieve the group document from the group management server for the MCPTT group ID contained in the <associated-group-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request and carry out initial processing as specified in clause 6.3.5.2 and continue with the rest of the steps if the checks in clause 6.3.5.2 succeed;\nNOTE 2:\tIf the checks are not successful, the SIP response to the \"SIP INVITE request from participating MCPTT function for controlling MCPTT function of an MCPTT group\" is already sent in the clause 6.3.5.2.\n5)\tshall cache the content of the SIP INVITE request;\n6)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may apply any preferential treatment to the SIP request as specified in 3GPP TS 24.229 [4];\n7)\tshall check the authorization of the MCPTT user in the <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the \"SIP INVITE request from participating MCPTT function for controlling MCPTT function of an MCPTT group\" as specified in clause 6.3.5.2. If the MCPTT user is unauthorized to join a chat group session, the non-controlling MCPTT function shall send a SIP 403 (Forbidden) response with the warning text set to \"106 user not authorised to join chat group\" in a Warning header field as specified in clause 4.4.\n8)\tif the MCPTT user identified by the MCPTT ID in the SIP INVITE request is not affiliated with the MCPTT group identified by the group identity conained in the <associated-group-id> element element in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP INVITE request as determined by the procedures of clause 6.3.6:\na)\tshall check if the MCPTT user is eligible to be implicitly affiliated with the MCPTT chat group as determined by clause 9.2.2.3.6; and\nb)\tif the MCPTT user is not eligible for implicit affiliation, shall reject the SIP INVITE request with a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n9)\tshall generate a SIP INVITE request towards the controlling MCPTT function as specified in clause 6.3.4.1.4; and\n10)\tshall send the SIP INVITE request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the SIP INVITE request sent to the controlling MCPTT function as specified above, the non-controlling MCPTT function:\n1)\tshall send the SIP ACK request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall generate a SIP 200 (OK) to the \"SIP INVITE request from participating MCPTT function for non-controlling MCPTT function of an MCPTT group\" as specified in 3GPP TS 24.229, populated as follows:\na)\tshall include an SDP answer as specified in clause 6.3.4.2.1, based on the SDP answer in the SIP 200 (OK) response;\nb)\tshall include the public service identifier of the non-controlling MCPTT function in the P-Asserted-Identity header field; and\nc)\tshall include the warning text set to \"148 group is regrouped\" in a Warning header field as specified in clause 4.4; and\nNOTE 3:\tAs long as the MCPTT group is regrouped, the floor control messages in the media plane includes a grouped regrouped indication as specified in 3GPP TS 24.380 [5].\n3)\tshall start acting as a non-controlling MCPTT function and interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.5.\nUpon receipt of other final SIP responses with the exception of the SIP 2xx response to the INVITE request sent to the controlling MCPTT function as specified above, the non-controlling MCPTT function:\n1)\tshall send the SIP ACK response to the controlling MCPTT function as specified in 3GPP TS 24.229 [4]; and\n2)\tperform the actions in the clause 10.1.1.5.2.4.\nNOTE 4:\tRegardless if the controlling MCPTT function accepts or rejects the SIP INVITE request sent above, the chat group session continues to be initiated with only the members of the group homed on the non-controlling MCPTT function of the group being invited to the group call.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.1.3\tSubscription to the conference event package",
                            "text_content": "The IETF RFC 4575 [30] defines a conference event package that shall be used to obtain the status of participants in group sessions.\nThe MCPTT client may subscribe to the conference event package at any time in a group session that the MCPTT client participates in. The clause 10.1.3.2 specifies the procedures in the MCPTT client when subscribing to the conference events.\nThe participating MCPTT function shall forward conference state subscriptions and notifications as specified in clause 10.1.3.3.\nThe controlling MCPTT function shall handle subscriptions and notification of conference events as specified in clause 10.1.3.4.\nThe non-controlling MCPTT function shall handle subscriptions and notification of conference events as specified in clause 10.1.3.5.\nWhen the non-controlling MCPTT function connection model is used, the controlling MCPTT function subscribes to the conference event package from the non-controlling MCPTT function as specified in clause 10.1.3.4.3 and the non-controlling MCPTT function subscribes to the conference event package from the controlling MCPTT function as specified in clause 10.1.3.5.3.\nA MCPTT client may subscribe to the conference event package when a group call is ongoing and the ongoing group call is not initiated as a broadcast group call by sending a SIP SUBSCRIBE request to obtain information of the status of a group session.\nWhen subscribing to the conference event package, the MCPTT client:\n1)\tshall generate a SIP SUBSCRIBE request and use a new SIP-dialog according to IETF RFC 6665 [26], IETF RFC 4575 [30] and 3GPP TS 24.229 [4];\n2)\tshall set the Request-URI of the SIP SUBSCRIBE request to the MCPTT session identity of the group session;\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n4)\tshall include an Accept-Contact header with the media feature tag g.3gpp.icsi-ref with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n5)\tif the MCPTT client wants to receive the current status and later notification, shall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 1:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n6)\tif the MCPTT client wants to fetch the current state only, shall set the Expires header field according to IETF RFC 6665 [26], to zero;\n7)\tshall include an Accept header field containing the application/conference-info+xml\"MIME type;\n8)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-request-uri> element set to the MCPTT group ID of the group session; and\n9)\tshall send the SIP SUBSCRIBE request using a new SIP dialog according to 3GPP TS 24.229 [4].\nThe responses to the SIP SUBSCRIBE request shall be handled according to IETF RFC 6665 [26], IETF RFC 4575 [30] and TS 24.229 [4].\nUpon receiving a SIP NOTIFY requests to the previously sent SIP SUBSCRIBE request the MCPTT client:\n1)\tshall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575 [30]; and\n2)\tmay process the current state information to the MCPTT client based on the information in the SIP NOTIFY request body and may display to the MCPTT user the MCPTT IDs of the participating MCPTT users and the functional alias the participating MCPTT user has bound to that MCPTT group if available.\nWhen needed the MCPTT client shall terminate the subscription and indicate it terminated according to IETF RFC 6665 [26].\nNOTE 2:\tThe contents of the received SIP NOTIFY request body is specified in clause 6.3.3.4.\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the participating function\" from a MCPTT client served by the participating MCPTT function and if the SIP SUBSCRIBE request contains:\n1)\tthe ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n2)\tan Accept header field containing the application/conference-info+xml\"MIME type; and\n3)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing the <mcptt-request-uri> set to a MCPTT group ID;\nthen the participating MCPTT function:\n1)\tshall attempt to resolve the received Request-URI to an existing MCPTT session identity;\n2)\tif the participating MCPTT function could not resolve the received Request-URI to an existing MCPTT session identity, shall reject the SIP SUBSCRIBE response with a SIP 404 (Not Found) response with a warning text set to \"137 the indicated group call does not exist\" as specified in clause 4.4 and shall skip the rest of the steps\n3)\tshall generate a SUBSCRIBE request as specified in TS 24.229 [4]\n4)\tshall set the SIP URI in the Request-URI with the MCPTT session identity that is mapped to the MCPTT session identity in the received Request-URI;\n5)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body the <mcptt-calling-user-id> element set to the MCPTT ID of the served user: and\n6)\tshall insert a Record-Route header containing a URI identifying its own address; and\n7)\tshall send the SIP SUBSCRIBE request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP response to the SIP SUBSCRIBE request the participating MCPTT function:\n1)\tshall copy the content of the incoming SIP response to an outgoing SIP response;\n2)\tif a SIP 200 (OK) response, shall include in the Contact header field of the outgoing SIP response an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response in the outgoing SIP response; and\n3)\tshall forward the SIP response according to 3GPP TS 24.229 [4].\nUpon receiving a SIP NOTIFY request within the dialog created by the SIP SUBSCRIBE request destined to a served MCPTT client, the participating MCPTT function:\n1)\tshall include the public service identity of the MCPTT user in the Request-URI;\n2)\tshall copy the content of the incoming SIP NOTIFY request to the outgoing SIP NOTIFY request; and\n3)\tshall send the SIP NOTIFY request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP response to the SIP NOTIFY request the participating MCPTT function:\n1)\tshall copy the content of the incoming SIP response to an outgoing SIP response;\n2)\tif a SIP 200 (OK) response, shall include an MCPTT session identity constructed from the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response in the outgoing SIP response; and\n3)\tshall forward the SIP response according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" and the SIP SUBSCRIBE request:\n1)\tcontains an application/vnd.3gpp.mcptt-info+xml MIME body with\na)\tthe <mcptt-request-uri> element set to the group identity of the group session and the <mcptt-calling-user-id> element set to either:\ni)\tthe MCPTT ID of a participant in the group session; or\nii)\ta constituent MCPTT group ID of a non-controlling MCPTT function in a temporary group session;\n2)\tcontains the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n3)\tcontains an Accept header field containing the application/conference-info+xml MIME type; and\n4)\tis not received in a group call initiated as a broadcast group call;\nthen the controlling MCPTT function:\n1)\tshall check if the <on-network-allow-conference-state> element in the group document in 3GPP TS 24.481 [31] allows the MCPTT ID or the constituent MCPTT group ID in the <mcptt-calling-user-id> element to subscribe to the conference event package and if not allowed:\na)\tshall reject the \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" with a SIP 403 (Forbidden) response to the SIP SUBSCRIBE request, with warning text set to \"138 subscription of conference events not allowed\" as specified in clause 4.4; and\nb)\tshall not continue with the remaining steps;\n2)\tshall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575 [30];\n3)\tshall cache information about the subscription;\n4)\tshall send a conference state notification as specified in clause 10.1.3.4.2; and\n5)\tif the SIP SUBSCRIBE request is the first SUBSCRIBE request from a participant in a temporary group session, shall subscribe to the conference event package from all non-controlling MCPTT functions in the group session as specified in clause 10.1.3.4.3.\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function in an group call initiated as a broadcast group call, the controlling MCPTT function:\n1)\tshall generate a SIP 480 (Temporarily Unavailable) response to the SIP SUBSCRIBE request as specified in 3GPP TS 24.229 [4];\n2)\tshall include a Warning header field with the warning text set to \"105 subscription not allowed in a broadcast group call\" as specified in clause 4.4; and\n3)\tsend the SIP 480 (Temporarily Unavailable) response according to 3GPP TS 24.229 [4].\nThe procedures in this clause is triggered by:\n1)\tthe receipt of a SIP SUBSCRIBE request as specified in clause 10.1.3.4.1;\n2)\tthe receipt of a SIP BYE request from one of the participants in a pre-arranged or a chat group session; or\n3)\twhen a new participant is added in a pre-arranged or chat group session.\nWhen sending a conference event notification, the controlling MCPTT function:\n1)\tshall generate a notification package as specified in clause 6.3.3.4 to all MCPTT clients which have subscribed to the conference event package; and\nNOTE:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n2)\tshall send a SIP NOTIFY request to all participants which have subscribed to the conference event package as specified in 3GPP TS 24.229 [4].\nThe procedure in this clause is triggered by:\n1)\tthe receipt of a SIP 200 (OK) response to a SIP INVITE request for non-controlling MCPTT function of an MCPTT group and if at least one participant already has subscribed to the conference event package in the controlling MCPTT function as specified in clause 10.1.3.4.1; or\n2)\tthe receipt of the first SIP SUBSCRIBE request as specified in clause 10.1.3.4.1 and one or more participant in the group session is a non-controlling MCPTT function;\nthen, for each non-controlling MCPTT function from where a SIP 200 (OK) response to a SIP INVITE request for non-controlling MCPTT function of an MCPTT group has been received and where a SIP SUBSCRIBE request is not already sent, the controlling MCPTT function:\n1)\tshall generate a SIP SUBSCRIBE request and use a new SIP-dialog according to IETF RFC 6665 [26], IETF RFC 4575 [30] and 3GPP TS 24.229 [4];\n2)\tshall set the Request-URI of the SIP SUBSCRIBE request to the public service identity of the non-controlling MCPTT function serving the group identity of the MCPTT group owned by the partner MCPTT system;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP SUBSCRIBE request set to the public service identity of the controlling MCPTT function;\n4)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9];\n5)\tshall include an Accept-Contact header with the g.3gpp.mcptt along with \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n7)\tshall include an Accept header field containing the application/conference-info+xml MIME type;\n8)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with:\na)\tthe <mcptt-request-uri> element set to the constituent MCPTT group ID; and\nb)\tthe <mcptt-calling-group-id> set to the temporary MCPTT group ID; and\n9)\tshall send the SIP SUBSCRIBE request using a new SIP dialog according to 3GPP TS 24.229 [4].\nThe responses to the SIP SUBSCRIBE request shall be handled according to IETF RFC 6665 [26], IETF RFC 4575 [30] and TS 24.229 [4].\nUpon receiving an incoming SIP NOTIFY requests to the previously sent SIP SUBSCRIBE request, the controlling MCPTT function:\n1)\tshall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575 [30];\n2)\tshall modify the SIP NOTIFY request as specified in clause 6.3.3.4; and\n3)\tshall forward the modified SIP NOTIFY request according to 3GPP TS 24.229 [4] to all other participants with a subscription to the conference event package.\nNOTE:\tA non-controlling MCPTT function of an MCPTT group is regarded as a participant in a temporary group session.\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" that terminates the subscription of the conference event package as specified in IETF RFC 6665 [26], the controlling MCPTT function:\n1)\tshall send a SIP 200 (OK) response as specified in IETF RFC 6665 [26]; and\n2)\tif there are no remaining subscriptions to the event package in the ongoing MCPTT call in a temporary group session, shall terminate the subscriptions to the conference event package as specified in IETF RFC 6665 [26] in all non-controlling MCPTT functions in the temporary group session.\nUpon expiry of the subscription timer and if there are no remaining subscriptions to the event package in the ongoing MCPTT call in a temporary group session, the controlling MCPTT function shall terminate the subscriptions to the conference event package as specified in IETF RFC 6665 [26] in all non-controlling MCPTT functions in the temporary group session.\nUpon receipt of \"SIP SUBSCRIBE request for conference event status subscription in the non-controlling MCPTT function\" and the SIP SUBSCRIBE request:\n1)\tcontains an application/vnd.3gpp.mcptt-info+xml MIME body with\na)\tthe <mcptt-request-uri> element set to the constituent MCPTT group ID; and\nb)\tthe <mcptt-calling-user-id> element is set to:\ni)\ta participant in the group session; or\nii)\tthe temporary MCPTT group ID;\n2)\tcontains the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n3)\tcontains an Accept header field containing the application/conference-info+xml MIME type; and\n4)\tis not received in a group call initiated as a broadcast group call;\nthen the non-controlling MCPTT function:\n1)\tshall check if the <on-network-allow-conference-state> element in the group document in 3GPP TS 24.481 [31] of the constituent group allows the MCPTT ID in the <mcptt-calling-user-id> element to subscribe to the conference event package and if not allowed:\na)\tshall reject the \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" with a SIP 403 (Forbidden) response to the SIP SUBSCRIBE request, with warning text set to \"138 subscription of conference events not allowed\" as specified in clause 4.4; and\nb)\tshall not continue with the remaining steps;\n2)\tshall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575 [30];\n3)\tshall cache information about the subscription;\n4)\tshall generate a notification package as specified in clause 6.3.4.3 and send a SIP NOTIFY request according to 3GPP TS 24.229 [4] to the MCPTT client which have subscribed to the conference event package; and\n5)\tif the SIP SUBSCRIBE request is the first SIP SUBSCRIBE request from a MCPTT client, shall subscribe to the conference event package from the controlling MCPTT functions in the group session as specified in clause 10.1.3.5.3.\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the controlling MCPTT function\" in a group call initiated as a broadcast group call, the controlling MCPTT function:\n1)\tshall generate a SIP 480 (Temporarily Unavailable) response to the SIP SUBSCRIBE request as specified in 3GPP TS 24.229 [4];\n2)\tshall include a Warning header field with the warning text set to \"105 subscription not allowed in a broadcast group call\" as specified in clause 4.4; and\n3)\tsend the SIP 480 (Temporarily Unavailable) response according to 3GPP TS 24.229 [4].\nThe procedures in this clause is triggered by:\n1)\tthe receipt of a receipt of a SIP BYE request from one of the participants in a pre-arranged or a chat group session; or\n2)\twhen a new participant is added in a pre-arranged or chat group session.\nWhen sending a conference event notification, the non-controlling MCPTT function:\n1)\tshall generate a notification package as specified in clause 6.3.4.3 to all participants which have subscribed to the conference event package; and\nNOTE:\tAs a group document can potentially have a large content, the controlling MCPTT function can notify using content-indirection as defined in IETF RFC 4483 [32].\n2)\tshall send a SIP NOTIFY request to all participants which have subscribed to the conference event package as specified in 3GPP TS 24.229 [4].\nUpon receipt of the first subscription to the conference event package from an MCPTT client, the non-controlling MCPTT function:\n1)\tshall generate a SIP SUBSCRIBE request and use a new SIP-dialog according to IETF RFC 6665 [26], IETF RFC 4575 [30] and 3GPP TS 24.229 [4];\n2)\tshall set the Request-URI of the SIP SUBSCRIBE request to the temporary MCPTT session identity;\nNOTE:\tThe SIP URI received in the Contact header field of the SIP INVITE request for non-controlling MCPTT function of an MCPTT group is the temporary MCPTT session identity. Towards MCPTT clients the non-controlling MCPTT function uses an internal generated MCPTT session identity.\n3)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service header field according to IETF RFC 6050 [9];\n4)\tshall include an Accept-Contact header with the media feature tag g.3gpp.icsi-ref with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n5)\tshall set the Expires header field according to IETF RFC 6665 [26], to 4294967295;\nNOTE 2:\t4294967295, which is equal to 232-1, is the highest value defined for Expires header field in IETF RFC 3261 [24].\n6)\tshall include an Accept header field containing the application/conference-info+xml MIME type;\n7)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with:\na)\tthe <mcptt-request-uri> element set to the temporary MCPTT group ID: and\nb)\tthe <mcptt-calling-group-id> set to the constituent MCPTT group ID; and\n8)\tshall send the SIP SUBSCRIBE request using a new SIP dialog according to 3GPP TS 24.229 [4].\nThe 2xx response to the SIP SUBSCRIBE request shall be handled according to IETF RFC 6665 [26], IETF RFC 4575 [30] and TS 24.229 [4].\nUpon receiving an incoming SIP NOTIFY requests to the previously sent SIP SUBSCRIBE request the non-controlling MCPTT function:\n1)\tshall handle the request according to IETF RFC 6665 [26] and IETF RFC 4575 [30];\n2)\tshall store conference information based on the SIP NOTIFY request content;\n3)\tshall modify the SIP NOTIFY request as specified in clause 6.3.4.3; and\n4)\tforward the modified SIP NOTIFY request according to 3GPP TS 24.229 [4] to all MCPTT clients with a subscription to the conference event package.\nUpon receipt of a \"SIP SUBSCRIBE request for conference event status subscription in the non-controlling MCPTT function\" that terminates the subscription of the conference event package as specified in IETF RFC 6665 [26], the non-controlling MCPTT function:\n1)\tshall send a SIP 200 (OK) response as specified in IETF RFC 6665 [26]; and\n2)\tif there are no remaining subscriptions to the event package (excluding any subscriptions to the event package made by the controlling MCPTT function), shall terminate the subscriptions to the conference event package in the controlling MCPTT function as specified in IETF RFC 6665 [26].\nUpon expiry of the subscription timer and if there are no remaining subscriptions to the event package (excluding any subscriptions to the event package made by the controlling MCPTT function), the non-controlling MCPTT function shall terminate the subscriptions to the conference event package in the controlling MCPTT function as specified in IETF RFC 6665 [26].\nNOTE:\tThe subscription to the event package made by the controlling MCPTT function will be terminated by the controlling MCPTT function when the last subscription to the event package is terminated in the controlling MCPTT function.\nThe present clause describes an extensions of the application/conference-info+xml MIME body specified in IETF RFC 4575 [30].\nThe functional alias extension is used to indicate per-user functional alias association with MCPTT group.\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\ntargetNamespace=\"urn:3gpp:ns:mcpttConfInfo:1.0\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:mcpttConfInfo=\"urn:3gpp:ns:mcpttConfInfo:1.0\"\nelementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\">\n\n<!-- MCPTT specific child element of endpoint element -->\n<xs:element name=\"functional-alias\" type=\"xs:anyURI\" use=\"optional\"/>\n\n</xs:schema>\n\nThe application/conference-info MIME body refers to namespaces using prefixes specified in table 10.1.3.6.1.2-1.\nTable 10.1.3.6.1.2-1: Assignment of prefixes to namespace names in the application/pidf+xml MIME body\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 10.1.3.6.1.2-1: Assignment of prefixes to namespace names in the application/pidf+xml MIME body",
                                    "table number": 7,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "10.1.4\tRemote change of an MCPTT user's selected group",
                            "text_content": "Clause 10.1.4 specifies the MCPTT client procedures, participating MCPTT function procedures and controlling MCPTT function procedures for the on-network remote change of an MCPTT user's selected group.\nUpon receiving a request from the MCPTT user to send a group selection change request to change the selected group of a targeted MCPTT user to a specific MCPTT group, the MCPTT client:\n1)\tif:\na)\tthe <RemoteGroupSelectionURIList> element does not exist in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\nb)\tthe <RemoteGroupSelectionURIList> element exists in the MCPTT user profile document and the MCPTT ID of the targeted MCPTT user does not match with one of the <entry> elements of the <RemoteGroupSelectionURIList> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshould indicate to the requesting MCPTT user that they are not authorised to change the selected MCPTT group of the targeted MCPTT user; and\nb)\tshall skip the rest of the steps of the present clause;\n1A)\tshall determine whether the group document associated with the specific MCPTT group contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\na)\tshould indicate to the MCPTT user that calls are not allowed on the specific MCPTT group; and\nb)\tshall skip the remainder of this procedure;\n2)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4]; and\nd)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> set to the MCPTT group identity to be selected by the targeted MCPTT user; and\nii)\tthe <request-type> element set to a value of \"group-selection-change-request\"; and\ne)\tshall insert in the SIP MESSAGE request an application/resource-lists+xml MIME body with the MCPTT ID of the targeted MCPTT user, according to rules and procedures of IETF RFC 5366 [20];\n3)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n4)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, should indicate to the MCPTT user the failure of the sent group selection change request and not continue with the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for group selection change response for terminating client\", the MCPTT client:\n1)\tshall determine the success or failure of the sent group selection change request from the value of the <selected-group-change-outcome> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\n2)\tshould indicate to the MCPTT user the success or failure of the sent group selection change request.\nUpon receiving a \"SIP MESSAGE request for group selection change request for terminating client\", the MCPTT client:\n1)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body containing an <affiliation-required> element set to a value of \"true\":\na)\tshall invoke the procedures of clause 9.2.1.2 to affiliate to the MCPTT group identified by the contents of the <mcptt-calling-group-id> included in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tif the MCPTT client has not already invoked the procedures of clause 9.2.1.3, shall invoke the procedures of clause 9.2.1.3; and\nc)\tupon receiving a SIP NOTIFY request including a <p-id> element set to a value matching the <p-id> value included in the SIP PUBLISH request sent in step 1) a) above as specified in clause 9.2.1.3, shall determine if the affiliation procedure to the MCPTT group identified by the contents of the <mcptt-calling-group-id> in the received SIP MESSAGE request was successful;\n2)\tif the received SIP MESSAGE request contained an application/vnd.3gpp.mcptt-info+xml MIME body containing an <affiliation-required> element set to a value of \"true\" and the affiliation was successful as determined in step 1) c) above, or if the <affiliation-required> element was not present in the received SIP MESSAGE request:\na)\tshall change the MCPTT client's selected group to the MCPTT group identified by the contents of the <mcptt-calling-group-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\nb)\tshall determine the success or failure of the change of selected group action;\n3)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4]; and\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request;\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> set to the MCPTT group identity to be selected by the MCPTT user; and\nii)\tthe <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"group-selection-change-response\";\nB)\tif the MCPTT client was able to successfully change the selected group as determined in step 2) b) above, then a <selected-group-change-outcome> element set to a value of \"success\"; and\nC)\tif the MCPTT client:\nI)\twas required to affiliate to the MCPTT group identified by the contents of the <mcptt-calling-group-id> in the received SIP MESSAGE request and the affiliation failed as determined in step 1) c); or\nII)\tfailed to change the selected group as determined in step 2) b);\nthen a <selected-group-change-outcome> element set to a value of \"fail\";\n4)\tshould indicate to the MCPTT user the success or failure of the requested change of selected group action;\n5)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n6)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a \"SIP MESSAGE request for group-selection-change for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif the \"SIP MESSAGE request for group selection change for originating participating MCPTT function\" contains the <request-type> element set to a value of \"group-selection-change-request\":\na)\tif:\ni)\tthe <RemoteGroupSelectionURIList> element does not exist in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\nii)\tif the MCPTT ID contained in the <mcptt-request-uri> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in the received \"SIP MESSAGE request for group selection change for originating participating MCPTT function\" does not match with one of the <entry> elements of the <RemoteGroupSelectionURIList> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\ni)\tshall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"155 user not authorised to change user's selected group\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n4)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity contained in the <mcptt-request-uri> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n6)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 4);\n7)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n8)\tshall copy the contents of the application/resource-lists+xml MIME body into the outgoing SIP MESSAGE request;\n9)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n10)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n11)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n12)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n13)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n14)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the sent SIP MESSAGE request, the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the error response to the MCPTT client.\nUpon receiving a \"SIP MESSAGE request for group-selection-change for terminating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall forward the SIP 2xx response to the controlling MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the response to the controlling MCPTT function.\nUpon receiving:\n-\ta \"SIP MESSAGE request for group selection change request for controlling MCPTT function\"; or\n-\ta \"SIP MESSAGE request for group selection change response for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2A)\tif the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element that is set to the value \"true\", shall shall reject the SIP request with a SIP 403 (Forbidden) response with the warning text set to \"167 call is not allowed on the preconfigured group\" as specified in clause 4.4 \"Warning header field\" and skip the rest of the steps;\n3)\tif there is a <request-type> element set to a value of \"group-selection-change-request\" contained in the <anyExt> element in the <mcptt-Params> element contained in the <mcpttinfo> root element contained in the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request:\na)\tif the MCPTT user identified by the MCPTT ID in the \"uri\" attribute of an <entry> element in a <list> element in the <resource-lists> element of the application/resource-lists+xml MIME body contained in the SIP MESSAGE request is not affiliated with the MCPTT group identified by the <mcptt-request-uri> in the application/vnd.3gpp. mcptt-info+xml MIME body as determined by the procedures of clause 6.3.6:\ni)\tshall determine if the MCPTT user is eligible to be affiliated with the MCPTT group as determined by clause 9.2.2.3.8; and\nii)\tif the MCPTT user is not eligible for affiliation, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request with the following clarifications:\na)\tshall set the <mcptt-calling-group-id> to the MCPTT group identity contained in the <mcptt-request-uri> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\nb)\tshall set the <mcptt-request-uri> element of the application/vnd.3gpp. mcptt-info+xml MIME body in the outgoing SIP MESSAGE request to the MCPTT ID of the targeted MCPTT user contained in the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body contained in the received SIP MESSAGE request;\n8)\tif the received SIP MESSAGE request is a \"SIP MESSAGE request for group selection change request for controlling MCPTT function\":\na)\tif the targeted MCPTT user is not affiliated to the identified MCPTT group and was determined to be eligible to be affiliated with the MCPTT group in step 3) a) i) above, shall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <anyExt> element an <affiliation-required> element set to a value of \"true\";\n9)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n10)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n11) shall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\n12)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.1.5\tRemotely initiated group call",
                            "text_content": "Clause 10.1.5 specifies the MCPTT client procedures, participating MCPTT function procedures and controlling MCPTT function procedures for on-network remotely initiated group call.\nIn the procedures clause 10.1.5.2:\n-\tthe term \"requesting MCPTT user\" is used to refer to the user who sent a request to initiate a remotely initiated group call;\n-\tthe term \"remote MCPTT user\" is used to refer to the user who is sent a request to initiate a remotely initiated group call; and\n-\tthe term \"targeted MCPTT group\" is used to refer to the group that is to be called in the requested remotely initiated group call.\nUpon receiving a request from the requesting MCPTT user to send a remotely initiated group call request to the remote MCPTT user for a targeted MCPTT group, the MCPTT client:\n1)\tif:\na)\tthe <allow-request-remote-init-group-call> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\":\nthen:\na)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a remotely initiated group call request to the remote MCPTT user; and\nb)\tshall skip the rest of the steps of the present clause;\n1A)\tshall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\na)\tshould indicate to the MCPTT user that calls are not allowed on the indicated group; and\nb)\tshall skip the remainder of this procedure;\n2)\tif:\na)\tthe requesting MCPTT user has indicated that the affiliation status of the remote MCPTT user to the targeted MCPTT group needs to be verified; and\nb)\tthe <allow-request-affiliated-groups> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\";\ni)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to request the affiliation status of other MCPTT users; and\nii)\tshall skip the rest of the steps of the present clause; and\nc)\tthe <allow-request-affiliated-groups> element of the of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen:\na)\tshall invoke the procedures of clause 9.2.1.3 to determine if the remote MCPTT user is affiliated to the targeted MCPTT group; and\nb)\tif the remote MCPTT user is determined to not be affiliated to the targeted MCPTT group:\ni)\tif the <allow-request-to-affiliate-other-users> of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\":\nA)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a remotely initiated group call request to the targeted MCPTT user; and\nB)\tshall skip the rest of the steps of the present clause; and\nii)\tif the <allow-request-to-affiliate-other-users> of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the requesting MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nA)\tshall invoke the procedures of clause 9.2.1.2 to affiliate the remote MCPTT user to the targeted MCPTT group by the requesting MCPTT user;\nB)\tif the procedures of clause 9.2.1.2 were not successful:\nI)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a remotely initiated group call request to the remote MCPTT user; and\nII)\tshall skip the rest of the steps of the present clause; and\nC)\tupon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [4], IETF RFC 3856 [51], and IETF RFC 6665 [26]:\nI)\tif the SIP NOTIFY request contains an application/pidf+xml MIME body indicating per-user affiliation information constructed according to clause 9.3.1, shall determine if the per user affiliation information indicates that the remote MCPTT user is affiliated;\nII)\tif per user affiliation information in the received SIP NOTIFY request indicates that the remote MCPTT user is not affiliated to the targeted MCPTT group, should indicate to the requesting MCPTT user that the remote MCPTT user cannot be affiliated to the targeted MCPTT group; and\nIII)\tif it is determined in the previous step that the remote MCPTT user cannot be affiliated to the targeted MCPTT group, shall skip the rest of the steps of the present clause;\n3)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> set to the MCPTT group identity of the targeted MCPTT group for the remotely initiated call; and\nii)\tan <anyExt> element containing:\nA)\tthe <request-type> element set to a value of \"remotely-initiated-group-call-request\";\nB)\tthe <notify-remote-user> element set to a value of \"true\" if the requesting MCPTT user has indicated that the remote MCPTT user be notified of the remotely initiated group call request;\nC)\tthe <notify-remote-user> element set to a value of \"false\" if the requesting MCPTT user has indicated that the remote MCPTT user not be notified of the remotely initiated group call request; and\nD)\tmay include <ric-app-level-priority> element set to a value of the namespace and priority values as specified in IETF RFC 8101 [48], and MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) to be used by the remote MCPTT user to request an application level priority while initiating a call as a result of received remotely initiated call request;\ne)\tshall insert in the SIP MESSAGE request an application/resource-lists+xml MIME body with the MCPTT ID of the remote MCPTT user, according to rules and procedures of IETF RFC 5366 [20]; and\nf)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the remote MCPTT user; and\n4)\tshall send the SIP MESSAGE request towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, should indicate to the requesting MCPTT user the failure of the sent remotely initiated group call request and not continue with the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for remotely initiated group call response for terminating client\", the MCPTT client:\n1)\tshall determine the success or failure of the sent remotely initiated group call request from the value of the <remotely-initiated-call -outcome> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\n2)\tshould indicate to the requesting MCPTT user the success or failure of the sent remotely initiated group call request.\nUpon receiving a \"SIP MESSAGE request for remotely initiated group call request for terminating client\", the MCPTT client:\n1)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"true\", may indicate to the remote MCPTT user that a remotely initiated call request to call the targeted MCPTT group has been received; and\n2)\tif according to local policy on-demand sessions are to be used for remotely initiated group calls, shall invoke the procedures of clause 10.1.1.2.1.1 to originate an MCPTT group call to the targeted MCPTT group with the following clarifications:\na)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"false\":\ni)\tshall not indicate to the remote MCPTT user that a remotely initiated call request to call the targeted MCPTT group has been received; and\nii)\tshall not give any indication to the remote MCPTT user that the remotely initiated call origination is in progress; and\nb)\tif the <ric-app-level-priority> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of the namespace and priority value, may include Resource-Priority header field in the initial SIP INVITE request with the value received in the <ric-app-level-priority> element; and\n3)\tif according to local policy pre-established sessions are to be used for remotely initiated group calls and a pre-established session is available, shall invoke the procedures of clause 10.1.1.2.2.1 to originate an MCPTT group call to the targeted MCPTT group with the following clarifications:\na)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"false\":\ni)\tshall not indicate to the remote MCPTT user that a remotely initiated call request to call the targeted MCPTT group has been received; and\nii)\tshall not give any indication to the remote MCPTT user that the remotely initiated call origination is in progress; and\nb)\tif the <ric-app-level-priority> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of the namespace and priority value, may include Resource-Priority header field in the initial SIP REFER request with the value received in the <ric-app-level-priority> element.\nEditor's note:\tIt is FFS that how the client will handle the request if according to local policy pre-established sessions are to be used for remotely initiated group calls and a pre-established session is not available.\nUpon completion of the procedures of clause 10.1.1.2.1.1 or clause 10.1.1.2.2.1, the MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4]; and\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-request-uri> set to the MCPTT group identity called by the remote MCPTT user; and\nii)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"remotely-initiated-group-call-response\";\nB)\tif the procedures of clause 10.1.1.2.1.1 or clause 10.1.1.2.2.1 were successful in originating an MCPTT group call to the targeted MCPTT group, a <remotely-initiated-call-outcome> element set to a value of \"success\"; and\nC)\tif the procedures of clause 10.1.1.2.1.1 or clause 10.1.1.2.2.1 were not successful in originating an MCPTT group call to the targeted MCPTT group, a <remotely-initiated-call-outcome> element set to a value of \"fail\";\n2)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the requesting MCPTT user; and\n3)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nIn the procedures of this clause:\n-\tthe term \"requesting MCPTT user\" is used to refer to the user who sent a request to initiate a remotely initiated group call; and\n-\tthe term \"remote MCPTT user\" is used to refer to the user who is sent a request to initiate a remotely initiated group call.\nUpon receiving a \"SIP MESSAGE request for remotely initiated group call for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif the \"SIP MESSAGE request for remotely initiated group call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"remotely-initiated-group-call-request\":\na)\tif the <allow-request-remote-init-group-call> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"157 user not authorised to request a remotely initiated group call\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n4)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity contained in the <mcptt-request-uri> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n6)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 4);\n7)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n8)\tshall copy the contents of the application/resource-lists+xml MIME body into the outgoing SIP MESSAGE request;\n9)\tshall set the <mcptt-calling-user-id> element of the <mcptt-Params> element of the <mcpttinfo> element to the MCPTT ID determined in step 2) above;\n10)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n11)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n12)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n13)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n14)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the sent SIP MESSAGE request, the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the error response to the MCPTT client.\nUpon receiving a \"SIP MESSAGE request for remotely initiated group call for terminating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response and skip the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall forward the SIP 2xx response to the controlling MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the response to the controlling MCPTT function.\nUpon receiving:\n-\ta \"SIP MESSAGE request for remotely initiated group call request for controlling MCPTT function\"; or\n-\ta \"SIP MESSAGE request for remotely initiated group call response for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2A)\tif the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element that is set to the value \"true\", shall shall reject the SIP request with a SIP 403 (Forbidden) response with the warning text set to \"167 call is not allowed on the preconfigured group\" as specified in clause 4.4 \"Warning header field\" and skip the rest of the steps;\n3)\tif:\na)\tthere is a <request-type> element set to a value of \"remotely-initiated-group-call-request\" contained in the <anyExt> element in the <mcptt-Params> element contained in the <mcpttinfo> root element contained in the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request; and\nb)\tif the MCPTT user identified by the MCPTT ID in the \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body contained in the SIP MESSAGE request is not affiliated with the MCPTT group identified by the <mcptt-request-uri> in the application/vnd.3gpp. mcptt-info+xml MIME body as determined by the procedures of clause 6.3.6;\nthen:\na)\tshall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request with the following clarifications:\na)\tshall set the <mcptt-calling-group-id> to the MCPTT group identity contained in the <mcptt-request-uri> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\nb)\tshall set the <mcptt-request-uri> element of the application/vnd.3gpp. mcptt-info+xml MIME body in the outgoing SIP MESSAGE request to the MCPTT ID contained in the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body contained in the received SIP MESSAGE request;\n8)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated with the MCPTT user identified by the MCPTT ID contained in the <mcptt-request-uri> element of the application/vnd.3gpp. mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n9)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n10) shall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\n11)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, the controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.2\tOff-network group call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.2.1\tGeneral",
                            "text_content": "In order to participate in a call of an MCPTT group, the MCPTT client:\n1)\tshall send the MONP message as a UDP message to the multicast IP address of the MCPTT group, to UDP port 8809, with an IP time-to-live set to 255; and\n2)\tshall treat UDP messages received on the multicast IP address of the MCPTT group and on port 8809 as received MONP messages.\nThe MONP message is the entire payload of the UDP message.\nFor an off-network MCPTT session, only MCPTT speech is used.\nOne off-network MCPTT session includes one media-floor control entity.\nThe MCPTT client shall generate an SDP body for a group call in accordance with rules and procedures of RFC4566 [12].\nThe MCPTT client:\n1)\tshall include in the session-level section:\na)\tthe \"o=\" field with the <username> portion set to a dash;\nb)\tthe \"s=\" field with the <session name> portion set to a dash; and\nc)\tthe \"c=\" field with the <nettype> portion set to \"IN\", the <addrtype> portion set to the IP version of a multicast IP address of the MCPTT group and the <connection-address> portions set to the multicast IP address of the MCPTT group;\n2)\tshall include the media-level section for MCPTT speech consisting of:\na)\tthe \"m=\" field with the <media> portion set to \"audio\", the <port> portion set to a port number for MCPTT speech of the MCPTT group, the <proto> field set to \"RTP/AVP\" and <fmt> portion set indicating RTP payload type numbers;\nb)\tthe \"i=\" field with the <session description> portion set to \"speech\";\nc)\tthe \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both, indicating the codec(s) and media parameters of the MCPTT speech with the following clarification:\ni)\tif the \"/<x>/<x>/Common/PreferredVoiceCodec\" leaf node is present in the group document configured on the group management client as specified in 3GPP TS 24.483 [45] containing an RTP payload format name as specified in IETF RFC 4566 [12], indicating a preferred voice codec for an MCPTT group; and\nii)\tif the MCPTT client supports the encoding name indicated in the value of the \"name\" attribute;\nthen the MCPTT client:\ni)\tshall insert the value of the \"/<x>/<x>/Common/PreferredVoiceCodec\" leaf node in the <encoding name> field of the \"a=rtpmap\" attribute as defined in IETF RFC 4566 [12]; and\nd)\tthe \"a=rtcp:\" attribute indicating port number to be used for RTCP at the MCPTT client selected according to the rules and procedures of IETF RFC 3605 [13], if the media steam uses other than the default IP address; and\n3)\tshall include the media-level section for media-floor control entity consisting of:\na)\tan \"m=\" line, with the <media> portion set to \"application\", the <port> portion set to a port number for media-floor control entity of the MCPTT group, the <proto> field set to \"udp\" and <fmt> portion set to \"MCPTT\"; and\nb)\tthe \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor control entity as specified 3GPP TS 24.380 [5].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.2\tBasic call control",
                            "text_content": "In this release of specification, media streams of off-network group call cannot be modified and the SDP is the same for the entire duration of the call.\nThe maximum number of simultaneous off-network group calls is limited by the value of \"/<x>/Common/MCPTTGroupCall/MaxCallN4\" leaf node present in the UE configuration as specified in 3GPP TS 24.483 [45].\nThe Figure 10.2.2.2-1 gives an overview of the main states and transitions on the UE for call control.\nEach call control state machine is per MCPTT group ID.\n\nThe figure depicts a basic control state machine, which is a crucial component in the design of a control system. It illustrates the flow of control commands and their corresponding responses, providing a clear representation of the system's logic and behavior.\nFigure 10.2.2.2-1: Basic call control state machine\nThe following pieces of information are associated with the basic call control state machine:\na)\tthe stored call identifier of the call;\nb)\tthe probe response value of the call;\nc)\tthe stored refresh interval of the call;\nd)\tthe stored SDP body of the call;\ne)\tthe stored originating MCPTT user ID of the call;\nf)\tthe stored MCPTT group ID of the call; and\ng)\tthe stored call start time of the call.\nThe basic call control state machine has a related call type control state machine described in clause 10.2.3.2.\nWhen sending the message, MCPTT client indicates the stored current ProSe per-packet priority associated with the call type control state machine to the lower layers.\nThis state exists for UE, when the UE is not part of an ongoing call.\nThis state is the start state of this state machine.\nThis state is the stop state of this state machine.\nThis state exists for UE, when the UE has sent a GROUP CALL PROBE message and is waiting for a GROUP CALL ANNOUNCEMENT message.\nThis state exists for UE, when the UE is part of an ongoing group call.\nThis state exists for UE, when the UE has presented a notification to the MCPTT user for the received GROUP CALL ANNOUNCEMENT message, is waiting for a response and is not expected to send confirm indication.\nThis state exists for UE, when the UE has presented a notification to the MCPTT user for the received GROUP CALL ANNOUNCEMENT message, is waiting for a response and is expected to send confirm indication.\nThis state exists for UE, when the group call was rejected or released, GROUP CALL ANNOUNCEMENT message was sent or received and GROUP CALL ANNOUNCEMENT messages continue being received.\nThis state exists for UE, when the group call was released, GROUP CALL ANNOUNCEMENT message was neither sent nor received and GROUP CALL PROBE was sent.\nThe MCPTT client:\n1)\tshall generate a random number, X, with uniform distribution between 0 and 1; and\n2)\tshall set the TFG2 (periodic announcement) timer as follows:\n-\tTFG2 (periodic announcement) = the refresh interval of the call * (2/3 + 2/3*X) seconds.\nThe MCPTT client:\n1)\tshall generate a random number, X, with uniform distribution between 0 and 1; and\n2)\tshall set the TFG2 (periodic announcement) timer as follows:\n-\tTFG2 (periodic announcement) = 1/12*X seconds.\nThe MCPTT client shall set the TFG6 (max duration) timer as follows:\n-\tTFG6 (max duration) = X – (Y – Z) seconds, where:\n-\tX = value of \"/<x>/<x>/OffNetwork/MaxDuration\" leaf node present in group configuration as specified in 3GPP TS 24.483 [45];\n-\tY = current UTC time, in seconds since midnight UTC of January 1, 1970 (not counting leap seconds);\n-\tZ = Call start time IE of the GROUP CALL ANNOUNCEMENT message or the stored call start time, if a GROUP CALL ANNOUNCEMENT message was not received that caused this max duration timer calculation to be invoked.\nWhen in the \"S1: start-stop\" state, upon an indication from an MCPTT user to initiate a group call for an MCPTT group ID, the MCPTT client:\n1)\tshall store the MCPTT group ID as the MCPTT group ID of the call;\n2)\tshall create a call type control state machine as described in clause 10.2.3.2;\n3)\tshall generate a GROUP CALL PROBE message as specified in clause 15.1.2. In the GROUP CALL PROBE message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\n4)\tshall send the GROUP CALL PROBE message as specified in clause 10.2.1.1.1;\n5)\tshall start timer TFG3 (call probe retransmission);\n6)\tshall start timer TFG1 (wait for call announcement); and\n7)\tshall enter the \"S2: waiting for call announcement\" state.\nWhen in the \"S2: waiting for call announcement\" state, upon expiration of TFG3 (call probe retransmission), the MCPTT client:\n1)\tshall generate a GROUP CALL PROBE message as specified in clause 15.1.2. In the GROUP CALL PROBE message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\n2)\tshall send the GROUP CALL PROBE message as specified in clause 10.2.1.1.1;\n3)\tshall start timer TFG3 (call probe retransmission); and\n4)\tshall remain in the \"S2: waiting for call announcement\" state.\nWhen in the \"S3: part of ongoing call\" state, upon receiving a GROUP CALL PROBE message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tif the stored probe response value of the call is set to \"false\":\na)\tshall stop timer TFG2 (call announcement);\nb)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.2; and\nc)\tshall set the stored probe response of the call to \"true\"; and\n2)\tshall remain in the \"S3: part of ongoing call\" state.\nWhen in the \"S2: waiting for call announcement\" state, upon expiry of timer TFG1 (wait for call announcement), the MCPTT client:\n1)\tshall stop timer TFG3 (call probe retransmission), if running;\n2)\tshall generate an SDP body as specified in clause 10.2.1.1.2 and store it as the SDP body of the call;\n3)\tshall generate a random number with uniform distribution between 0 and 65535 and store it as the call identifier of the call;\n4)\tshall select refresh interval value and store it as the refresh interval of the call;\n5)\tshall store own MCPTT user ID as the originating MCPTT user ID of the call;\n6)\tshall store the current UTC time as the call start time of the call;\n7)\tshall generate a GROUP CALL ANNOUNCEMENT message as specified in clause 15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Call type IE to the stored current call type associated with the call type control state machine;\nc)\tshall set the Refresh interval IE to the stored refresh interval of the call;\nd)\tshall set the SDP IE to the stored SDP body of the call;\ne)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call;\nf)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\ng)\tshall set the Call start time IE to the stored call start time of the call;\nh)\tshall set the Last call type change time IE to the stored last call type change time of the call associated with call type control state machine;\ni)\tshall set the Last user to change call type IE to last user to change call type associated with call type control state machine; and\nj)\tmay include the Confirm mode indication IE;\n8)\tshall send the GROUP CALL ANNOUNCEMENT message as specified in clause 10.2.1.1.1;\n9)\tshall establish a media session based on the stored SDP body of the call;\n10)\tshall start floor control as originating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n11)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2 (using stored call start time);\n12)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n13)\tshall enter the \"S3: part of ongoing call\" state.\nNote: In this release of the specification, the refresh interval of the call is fixed to 10 seconds.\nWhen in the \"S2: waiting for call announcement\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tshall stop timer TFG3 (call probe retransmission);\n2)\tshall stop timer TFG1 (wait for call announcement);\n3)\tshall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message as the SDP body of the call;\n4)\tshall store the value of the Call identifier IE of the GROUP CALL ANNOUNCEMENT message as the call identifier of the call;\n5)\tshall store the value of the originating MCPTT user ID IE of the GROUP CALL ANNOUNCEMENT message as the Originating MCPTT user ID of the call;\n6)\tshall store the value of the Refresh interval IE of the GROUP CALL ANNOUNCEMENT message as the refresh interval of the call;\n7)\tshall store the value of the Call start time IE of the GROUP CALL ANNOUNCEMENT message as the call start time of the call;\n8)\tshall establish a media session based on the stored SDP body of the call;\n9)\tshall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n10)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2;\n11)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n12)\tshall enter the \"S3: part of ongoing call\" state.\nWhen in the \"S1: start-stop\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE not matching MCPTT group ID of the call stored for other state machines, the MCPTT client:\n1)\tshall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message as the SDP body of the call;\n2)\tshall store the value of the Call identifier IE of the GROUP CALL ANNOUNCEMENT message as the call identifier of the call;\n3)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL ANNOUNCEMENT message as the originating MCPTT user ID of the call;\n4)\tshall store the value of the Refresh interval IE of the GROUP CALL ANNOUNCEMENT message as the refresh interval of the call;\n5)\tshall store the value of the MCPTT group ID IE of the GROUP CALL ANNOUNCEMENT message as the MCPTT group ID of the call;\n6)\tshall store the value of the Call start time IE of the GROUP CALL ANNOUNCEMENT message as the call start time of the call;\n7)\tshall create a call type control state machine as described in clause 10.2.3.2;\n8)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is required upon a terminating call request reception:\na)\tshall start timer TFG4 (waiting for the user);\nb)\tif the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication IE, shall enter the \"S5: pending user action with confirm indication\" state; and\nc)\tif the GROUP CALL ANNOUNCEMENT message does not contains the Confirm mode indication IE, shall enter the \"S4: pending user action without confirm indication\" state; and\n9)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is not required upon a terminating call request reception:\na)\tshall establish a media session based on the stored SDP body of the call;\nb)\tshall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\nc)\tif the GROUP CALL ANNOUNCEMENT message contains the Confirm mode indication IE:\ni)\tshall generate a GROUP CALL ACCEPT message as specified in clause 15.1.4. In the GROUP CALL ACCEPT message, the MCPTT client:\nA)\tshall set the Call identifier IE to the stored call identifier of the call;\nB)\tshall set the Sending MCPTT user ID IE to own MCPTT user id;\nC)\tshall set the Call type IE to the stored current call type associated with the call type control state machine; and\nD)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\nii)\tshall send the GROUP CALL ACCEPT message as specified in clause 10.2.1.1.1;\nd)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2;\ne)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\nf)\tshall enter the \"S3: part of ongoing call\" state.\nWhen in the \"S5: pending user action with confirm indication\" state, upon indication from the MCPTT user to accept the incoming group call, the MCPTT client:\n1)\tshall establish a media session based on the stored SDP body of the call;\n2)\tshall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n3)\tshall generate a GROUP CALL ACCEPT message as specified in clause 15.1.4. In the GROUP CALL ACCEPT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Sending MCPTT user ID IE to own MCPTT user id;\nc)\tshall set the Call type IE to the stored current call type associated with the call type control state machine; and\nd)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\n4)\tshall send the GROUP CALL ACCEPT message as specified in clause 10.2.1.1.1;\n5)\tshall stop timer TFG4;\n6)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2 (using stored call start time);\n7)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n8)\tshall enter the \"S3: part of ongoing call\" state.\nWhen in the \"S4: pending user action without confirm indication\" state, upon an indication from the MCPTT user to accept the incoming group call, the MCPTT client:\n1)\tshall establish a media session based on the stored SDP body of the call;\n2)\tshall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n3)\tshall stop timer TFG4;\n4)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2 (using stored call start time);\n5)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n6)\tshall enter the \"S3: part of ongoing call\" state.\nWhen in the \"S3: part of ongoing call\" state, upon receiving a GROUP CALL ACCEPT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tcan inform the MCPTT user about the call acceptance; and\n2)\tshall remain in the \"S3: part of ongoing call\" state.\nWhen in the \"S5: pending user action with confirm indication\" state or the \"S4: pending user action without confirm indication\" state, upon an indication from the MCPTT user to reject the incoming group call, the MCPTT client:\n1)\tshall stop timer TFG4 (waiting for the user);\n2)\tshall start timer TFG5 (not present incoming call announcements); and\n3)\tshall enter the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S5: pending user action with confirm indication\" state or the \"S4: pending user action without confirm indication\" state, upon expiration of timer TFG4 (waiting for the user), the MCPTT client:\n1)\tshall start timer TFG5 (not present incoming call announcements); and\n2)\tshall enter the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S3: part of ongoing call\" state, upon expiry of timer TFG2 (call announcement), the MCPTT client:\n1)\tshall generate a GROUP CALL ANNOUNCEMENT message as specified in clause 15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Call type IE to the stored current call type associated with the call type control state machine;\nc)\tshall set the Refresh interval IE to the stored refresh interval of the call;\nd)\tshall set the SDP IE to the stored SDP body of the call;\ne)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call;\nf)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\ng)\tshall set the Last call type change time IE to the stored last call type change time of the call associated with call type control state machine;\nh)\tshall set the Last user to change call type IE to last user to change call type associated with call type control state machine;\ni)\tshall set the Call start time IE to the stored call start time of the call;\nj)\tif the stored probe response value of the call is set to \"true\", shall include Probe response IE;\n2)\tshall send the GROUP CALL ANNOUNCEMENT message as specified in clause 10.2.2.1.1.1;\n3)\tif the stored probe response value of the call is set to \"true\", shall set the stored probe response value of the call to \"false\";\n4)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n5)\tshall remain in the \"S3: part of ongoing call\" state.\nWhen in the \"S3: part of ongoing call\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the Call start time IE being the same as the stored call start time of the call, the Last call type change time IE being the same as the stored last call type change time of the call associated with the call type control state machine, the Last user to change call type IE being the same as the stored last user to change call type of the call associated with the call type control state machine and the Call identifier IE being the same as the stored call identifier of the call and Call type IE same as the stored current call type associated with the call type control state machine and:\n1)\tif the stored probe response value of the call is set to \"true\" and GROUP CALL ANNOUNCEMENT message contains Probe response IE; or\n2)\tif the stored probe response value of the call is set to \"false\":\nthe MCPTT client,\n1)\tshall stop timer TFG2 (call announcement);\n2)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1;\n3)\tshall set the stored probe response of the call to \"false\", if set to \"true\"; and\n4)\tshall remain in the \"S3: part of ongoing call\" state.\nWhen in the \"S3: part of ongoing call\" state, the \"S5: pending user action with confirm indication\" state, or the \"S4: pending user action without confirm indication\" state, upon an indication from the MCPTT user to release the group call, the MCPTT client:\n1)\tshall release the media session, if established;\n2)\tshall stop floor control as specified in clause 7.2.3.9.2 in 3GPP TS 24.380 [5];\n3)\tshall stop timer TFG4 (waiting for the user), if running;\n4)\tshall stop timer TFG2 (call announcement), if running;\n5)\tshall start timer TFG5 (not present incoming call announcements);\n6)\tshall stop timer TFG6 (max duration), if running; and\n7)\tshall enter the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S6: ignoring incoming call announcements\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tshall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message as the SDP body of the call;\n2)\tshall store the value of the Call identifier IE of the GROUP CALL ANNOUNCEMENT message as the call identifier of the call;\n3)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL ANNOUNCEMENT message as the originating MCPTT user ID of the call;\n4)\tshall store the value of the Refresh interval IE of the GROUP CALL ANNOUNCEMENT message as the refresh interval of the call;\n5)\tshall store the value of the Call start time IE of the GROUP CALL ANNOUNCEMENT message as the call start time of the call;\n6)\tshall stop timer TFG5 (not present incoming call announcements);\n7)\tshall start timer TFG5 (not present incoming call announcements); and\n8)\tshall remain in the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S6: ignoring incoming call announcements\" state, upon an indication from the MCPTT user to initiate a group call for an MCPTT group ID matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tstop timer TFG5 (not present incoming call announcements);\n2)\tshall establish a media session based on the stored SDP body of the call;\n3)\tshall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n4)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2 (using stored call start time);\n5)\tshall start timer TFG2 (call announcement) with value as specified in clause 10.2.2.4.1.1.1; and\n6)\tshall enter the \"S3: part of ongoing call\" state.\nWhen in the \"S6: ignoring incoming call announcements\" state, upon expiration of timer TFG5 (not present incoming call announcements), the MCPTT client:\n1)\tshall release the stored SDP body of the call;\n2)\tshall release the stored call identifier of the call;\n3)\tshall release the stored originating MCPTT user ID of the call;\n4)\tshall release the stored refresh interval of the call;\n5)\tshall release the stored MCPTT group ID of the call;\n6)\tshall release the stored call start time of the call;\n7)\tshall destroy the call type control state machine as specified in clause 10.2.3.4.10 or 10.2.3.4.11; and\n8)\tshall enter the \"S1: start-stop\" state.\nWhen in the \"S2: waiting for call announcement\" state, upon an indication from the MCPTT user to release the group call, the MCPTT client:\n1)\tshall stop timer TFG3 (call probe retransmission); and\n2)\tshall enter the \"S7: Waiting for call announcement after call release\" state.\nWhen in the \"S7: Waiting for call announcement after call release\" state, upon an indication from the MCPTT user to initiate a group call for an MCPTT group ID matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tshall stop timer TFG1 (wait for call announcement);\n2)\tshall generate a GROUP CALL PROBE message as specified in clause 15.1.2. In the GROUP CALL PROBE message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\n3)\tshall send the GROUP CALL PROBE message as specified in clause 10.2.1.1.1;\n4)\tshall start timer TFG3 (call probe retransmission);\n5)\tshall start timer TFG1 (wait for call announcement); and\n6)\tshall enter the \"S2: waiting for call announcement\" state.\nWhen in the \"S7: Waiting for call announcement after call release\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call, the MCPTT client:\n1)\tshall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message as the SDP body of the call;\n2)\tshall store the value of the Call identifier IE of the GROUP CALL ANNOUNCEMENT message as the call identifier of the call;\n3)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL ANNOUNCEMENT message as the originating MCPTT user ID of the call;\n4)\tshall store the value of the Refresh interval IE of the GROUP CALL ANNOUNCEMENT message as the refresh interval of the call;\n5)\tshall store the value of the Call start time IE of the GROUP CALL ANNOUNCEMENT message as the call start time of the call;\n6)\tshall stop timer TFG1 (wait for call announcement);\n7)\tshall start timer TFG5 (not present incoming call announcements); and\n8)\tshall enter the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S7: Waiting for call announcement after call release\" state, upon expiration of timer TFG1 (wait for call announcement), the MCPTT client:\n1)\tshall release the stored MCPTT group ID of the call;\n2)\tshall destroy the call type control state machine as specified in clause 10.2.3.4.11; and\n3)\tshall enter the \"S1: start-stop\" state.\nWhen in the \"S3: part of ongoing call\" state, upon expiration of timer TFG6 (max duration), the MCPTT client:\n1)\tshall release the media session;\n2)\tshall stop floor control as specified in clause 7.2.3.9.2 in 3GPP TS 24.380 [5];\n3)\tshall stop timer TFG2 (call announcement), if running;\n4)\tshall start timer TFG5 (not present incoming call announcements); and\n5)\tshall enter the \"S6: ignoring incoming call announcements\" state.\nWhen in the \"S3: part of ongoing call\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call and:\n1)\tthe Originating MCPTT user ID IE is different from the stored originating MCPTT user ID of the call; or\n2)\tthe Call identifier IE is different from the stored call identifier of the call;\nthen:\n1)\tif the stored current call type associated with the call type control state machine is \"BASIC GROUP CALL\" and the value of the Call type IE of GROUP CALL ANNOUNCEMENT message is either \"IMMINENT PERIL GROUP CALL\" or \"EMERGENCY GROUP CALL\";\n2)\tif the stored current call type associated with the call type control state machine is \"IMMINENT PERIL GROUP CALL\" and the value of the Call type IE of GROUP CALL ANNOUNCEMENT message is \"EMERGENCY GROUP CALL\";\n3)\tif the stored current call type associated with the call type control state machine being equal to the Call type IE of the GROUP CALL ANNOUNCEMENT message and the Call start time IE of the GROUP CALL ANNOUNCEMENT message being lower than the stored call start time of the call; or\n4)\tif the stored current call type associated with the call type control state machine being equal to the Call type IE of the GROUP CALL ANNOUNCEMENT message and the Call start time IE of the GROUP CALL ANNOUNCEMENT message being equal to the stored call start time of the call and the Call identifier IE of the GROUP CALL ANNOUNCEMENT message being lower than the stored call identifier of the call;\nthe MCPTT client:\n1)\tshall store the value of the SDP IE of the GROUP CALL ANNOUNCEMENT message as the SDP body of the call;\n2)\tshall store the value of the Call identifier IE of the GROUP CALL ANNOUNCEMENT message as the call identifier of the call;\n3)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL ANNOUNCEMENT message as the originating MCPTT user ID of the call;\n4)\tshall store the value of the Refresh interval IE of the GROUP CALL ANNOUNCEMENT message as the refresh interval of the call;\n5)\tshall store the value of the Call start time IE of the GROUP CALL ANNOUNCEMENT message as the call start time of the call;\n6)\tshall adjust the media session based on the stored SDP body of the call and restart floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n7)\tshall stop timer TFG6 (max duration);\n8)\tshall start timer TFG6 (max duration) with value as specified in clause 10.2.2.4.1.2;\n9)\tshall stop timer TFG2 (call announcement); and\n10)\tshall start timer TFG2 (call announcement) with value according to rules and procedures as specified in clause 10.2.2.4.1.1.1; and\n11)\tshall remain in the \"S3: part of ongoing call\" state.\n10.2.2.4.7.1\tUnexpected MONP message received\nUpon receiving a MONP message in a state where there is no handling specified for the MONP message, the MCPTT client shall discard the MONP message.\n10.2.2.4.7.2\tUnexpected indication from MCPTT user\nUpon receiving an indication from the MCPTT user in a state where there is no handling specified for the indication, the MCPTT client shall ignore the indication.\n10.2.2.4.7.3\tUnexpected expiration of a timer\nUpon expiration of a timer in a state where there is no handling specified for expiration of the timer, the MCPTT client shall ignore the expiration of the timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.2.3\tCall type control",
                            "text_content": "This state machine exists in parallel with the basic call control state machine for off-network group call as specified in clause 10.2.2.2.\nThe Figure 10.2.3.2-1 gives an overview of the states and transitions of the state machine.\nThe figure depicts a call type control state machine, which is a crucial component in a call center's call handling system. It is used to manage the flow of calls and ensure that they are handled efficiently and effectively. The state machine is designed to handle various call types, such as incoming calls, outgoing calls, and hold calls. It also includes a call queue, which is used to store incoming calls and prioritize them based on their priority. The state machine is integrated with the call center's call handling system, which includes call routing, call transfer, and call transfer to the next available agent. The figure provides a visual representation of the state machine, making it easier to understand and interpret the system's operation.\nFigure 10.2.3.2-1: Call type control state machine\nThe following pieces of information are associated with the call type control state machine:\na)\tthe stored current call type;\nb)\tthe stored current ProSe per-packet priority;\nc)\tthe stored last call type change time of the call; and\nd)\tthe stored last user to change call type of the call.\nWhen sending the message, MCPTT client indicates the stored current ProSe per-packet priority (as described in 3GPP TS 24.483 [45]) associated with the call type control state machine to the lower layers.\nThis state is the start state of this state machine.\nThis state exists for UE, when the UE is part of an in-progress emergency group call.\nThis state exists for UE, when the UE is part of an in-progress basic group call.\nThis state exists for UE, when the UE is part of an in-progress imminent peril group call.\nThe MCPTT client shall set the TFG13 (implicit downgrade emergency) timer as follows:\n1)\tTFG13 (implicit downgrade emergency) = X – (Y – Z) seconds, where:\na)\tX = value of \"/<x>/<x>/OffNetwork/EmergencyCallCancel\" leaf node present in group configuration as specified in 3GPP TS 24.483 [45];\nb)\tY = current UTC time, in seconds since midnight UTC of January 1, 1970 (not counting leap seconds); and\nc)\tZ = Last call type change time IE of the GROUP CALL ANNOUNCEMENT message or the Last call type change time IE of the GROUP CALL EMERGENCY END message.\nThe MCPTT client shall set the TFG14 (implicit downgrade imminent peril) timer as follows:\n1)\tTFG14 (implicit downgrade imminent peril) = X – (Y – Z) seconds, where:\na)\tX = value of \"/<x>/<x>/OffNetwork/ImminentPerilCallCancel\" leaf node present in group configuration as specified in 3GPP TS 24.483 [45];\nb)\tY = current UTC time, in seconds since midnight UTC of January 1, 1970 (not counting leap seconds); and\nc)\tZ = Last call type change time IE of the GROUP CALL ANNOUNCEMENT message or the Last call type change time IE of the GROUP CALL IMMINENT PERIL END message.\nWhen in the \"T0: waiting for the call to establish \"state, upon an indication from an MCPTT user to initiate a group call probe for an MCPTT group, the MCPTT client:\n1)\tif the stored emergency state associated with emergency alert state machine described in 12.2.2.2 is set to \"true\" and the value of \"/<x>/<x>/Common/AllowedEmergencyCall\" leaf node present in group configuration as specified in 3GPP TS 24.483 [45] is set to \"true\":\na)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\n2)\tif the stored emergency state associated with emergency alert state machine described in 12.2.2.2 is set to \"false\", and:\na)\tif the user initiates an MCPTT emergency call and the values of \"/<x>/<x>/Common/MCPTTGroupCall/EmergencyCall/Enabled\" leaf node present in the user profile and \"/<x>/<x>/Common/AllowedEmergencyCall\" leaf node present in group configuration as specified in 3GPP TS 24.483 [45] are set to \"true\":\ni)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\"; and\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nb)\tif the user initiates an MCPTT imminent peril group call and the values of \"/<x>/<x>/Common/MCPTTGroupCall/ImminentPerilCall/Authorised\" leaf node present in the user profile \"/<x>/<x>/Common/AllowedImminentPerilCall \"leaf node present in group configuration as specified in 3GPP TS 24.483 [45] are set to \"true\":\ni)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\"; and\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45]; and\nc)\tif the user initiates an MCPTT group call which is not an MCPTT emergency call and which is not an MCPTT imminent peril group call:\ni)\tshall set the stored current call type to \"BASIC GROUP CALL\"; and\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n3)\tshall set the stored last call type change time to current UTC time;\n4)\tshall set the last user to change call type to own MCPTT user ID; and\n5)\tshall remain in \"T0: waiting for the call to establish\" state.\nWhen in the \"T0: waiting for the call to establish \" state, upon receipt of a GROUP CALL ANNOUNCEMENT message as a response to GROUP CALL PROBE message, the MCPTT client:\n1)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\":\na)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nc)\tshall set the stored last call type change time to the Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nd)\tshall set the stored last user to change call type to the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\ne)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1; and\nf)\tshall enter \"T1: in-progress emergency group call\" state;\n2)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\", and if the stored current call type is other than \"EMERGENCY GROUP CALL\":\na)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\nc)\tshall set the stored last call type change time to the Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nd)\tshall set the stored last user to change call type to the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\ne)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2; and\nf)\tshall enter \"T3: in-progress imminent peril group call\" state; and\n3)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"BASIC GROUP CALL\", and if the stored current call type is \"BASIC GROUP CALL\":\na)\tshall set the stored last call type change time to the Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nb)\tshall set the stored last user to change call type to the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message; and\nc)\tshall enter \"T2: in-progress basic group call\" state.\nWhen in the \"T0: waiting for the call to establish\" state, upon receipt of a GROUP CALL ANNOUNCEMENT message by an idle MCPTT client when MCPTT user acknowledgement is required, the MCPTT client:\n1)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\":\na)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\n2)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\":\na)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\n3)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"BASIC GROUP CALL\":\na)\tshall set the stored current call type to \"BASIC GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n4)\tshall set the stored last call type change time to the Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\n5)\tshall set the last user to change call type to the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message; and\n6)\tshall remain in \"T0: waiting for the call to establish\" state.\nWhen in the \"T0: waiting for the call to establish\" state, upon receipt of a GROUP CALL ANNOUNCEMENT message by an idle MCPTT client when MCPTT user acknowledgement is not required, the MCPTT client:\n1)\tshall set the stored last call type change time to the Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\n2)\tshall set the last user to change call type to the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\n3)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\":\na)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nc)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1; and\nd)\tshall enter \"T1: in-progress emergency group call\" state;\n4)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\":\na)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\nc)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2; and\nd)\tshall enter \"T3: in-progress imminent peril group call\" state; and\n5)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"BASIC GROUP CALL\":\na)\tshall set the stored current call type to \"BASIC GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45]; and\nc)\tshall enter \"T2: in-progress basic group call\" state.\nWhen in state \"T0: waiting for the call to establish\", if:\na)\tthe MCPTT user accepts the call when MCPTT user acknowledgement is required; or\nb)\tthe MCPTT client sends a GROUP CALL ANNOUNCEMENT message on expiry of timer TFG1 (wait for call announcement) associated with the basic call control state machine;\nthe MCPTT client:\n1)\tif the stored current call type is set to \"EMERGENCY GROUP CALL\"\na)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1; and\nb)\tshall enter \"T1: in-progress emergency group call\" state;\n2)\tif the stored current call type is set to \"IMMINENT PERIL GROUP CALL\"\na)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2; and\nb)\tshall enter \"T3: in-progress imminent peril group call\" state; or\n3)\tif the stored current call type is set to \"BASIC GROUP CALL\"\na)\tshall enter \"T2: in-progress basic group call\" state.\nWhen in the \"T2: in-progress basic group call\" state, upon receiving an indication from the user to upgrade the call to \"IMMINENT PERIL GROUP CALL\" or \"EMERGENCY GROUP CALL\" or when in the \"T3: in-progress imminent peril group call\" state, upon receiving an indication from the user to upgrade the call to \"EMERGENCY GROUP CALL\", the MCPTT client:\n1)\tif the user request is to upgrade the call to \"EMERGENCY GROUP CALL\" and the value of \"/<x>/<x>/OffNetwork/EmergencyCallChange\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\":\na)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nc)\tshall store the current UTC time as last call type change time of the call;\nd)\tshall store own MCPTT user ID as last user to change call type of the call;\ne)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1;\nf)\tshall stop timer TFG11 (emergency end retransmission), if running;\ng)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running; and\nh)\tshall enter \"T1: in-progress emergency group call\" state;\n2)\tif the user request is to upgrade the call to \"IMMINENT PERIL GROUP CALL\" and the value of \"/<x>/<x>/OffNetwork/ ImminentPerilCallChange\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] set to \"true\":\na)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\nc)\tshall store the current UTC time as last call type change time of the call;\nd)\tshall store own MCPTT user ID as last user to change call type of the call;\ne)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2;\nf)\tshall stop timer TFG12 (imminent peril end retransmission), if running; and\ng)\tshall enter \"T3: in-progress imminent peril group call\" state;\n3)\tshall generate a GROUP CALL ANNOUNCEMENT message as specified in clause 15.1.3. In the GROUP CALL ANNOUNCEMENT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call associated with the basic call control state machine;\nb)\tshall set the Call type IE to the stored current call type;\nc)\tshall set the Refresh interval IE to the stored refresh interval of the call associated with the basic call control state machine;\nd)\tshall set the SDP IE to the stored SDP body of the call associated with the basic call control state machine;\ne)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call associated with the basic call control state machine;\nf)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call associated with the basic call control state machine;\ng)\tshall set the call start time IE to the stored call start time of the call;\nh)\tshall set the Last call type change time IE to the stored last call type change time of the call; and\ni)\tshall set the Last user to change call type IE to the stored last user to change call type of the call; and\n4)\tshall send the GROUP CALL ANNOUNCEMENT message as specified in clause 10.2.1.1.1;\nWhen in the \"T1: in-progress emergency group call\" state or \"T2: in-progress basic group call\" state or \"T3: in-progress imminent peril group call\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching with MCPTT group ID of the ongoing call and the Call Identifier IE being the same as the stored call identifier of the call, the MCPTT client:\n1)\tif the stored last user to change call type of the call is same as the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message and the stored last call type change time is smaller than Last call type change time IE of the GROUP CALL ANNOUNCEMENT message:\na)\tshall set the stored last call type change time of the call to Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nb)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\" and the stored call type is other than \"EMERGENCY GROUP CALL\":\ni)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\";\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\niii)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running;\niv)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1; and\nv)\tshall enter \"T1: in-progress emergency group call\" state;\nc)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\" and the stored call type is other than \"IMMINENT PERIL GROUP CALL\":\ni)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL\";\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\niii)\tshall stop timer TFG13 (implicit downgrade emergency), if running;\niv)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2; and\nv)\tshall enter \"T3: in-progress imminent peril group call\" state; and\nd)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"BASIC GROUP CALL\" and the stored call type is other than \"BASIC GROUP CALL\":\ni)\tshall set the stored current call type to \"BASIC GROUP CALL\";\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\niii)\tshall stop timer TFG13 (implicit downgrade emergency), if running;\niv)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running; and\nv)\tshall enter \"T2: in-progress basic group call\" state; and\n2)\tif the stored last user to change call type of the call is different from the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message and:\na) if the stored call type is same as Call type IE in the received GROUP CALL ANNOUNCEMENT message and the stored last call type change time is smaller than Last call type change time IE of the GROUP CALL ANNOUNCEMENT message:\ni)\tshall set the stored last call type change time of the call to Last call type change time IE of the GROUP CALL ANNOUNCEMENT message; and\nii)\tshall set the stored last user to change call type of the call to Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\nb)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\" and the stored call type is other than \"EMERGENCY GROUP CALL\":\ni)\tshall set the stored last call type change time of the call to Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nii)\tshall set the stored last user to change call type of the call to Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\niii)\tshall set the stored current call type to \"EMERGENCY GROUP CALL\";\niv)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nv)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running;\nvi)\tshall start timer TFG13 (implicit downgrade emergency) with value as specified in clause 10.2.3.4.1.1; and\nvii)\tshall enter \"T1: in-progress emergency group call\" state; and\nc)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\" and the stored call type is \"BASIC GROUP CALL\":\ni)\tshall set the stored last call type change time of the call to Last call type change time IE of the GROUP CALL ANNOUNCEMENT message;\nii)\tshall set the stored last user to change call type of the call to Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message;\niii)\tshall set the stored current call type to \"IMMINENT PERIL GROUP CALL \";\niv)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\nv)\tshall start timer TFG14 (implicit downgrade imminent peril) with value as specified in clause 10.2.3.4.1.2; and\nvi)\tshall enter \"T3: in-progress imminent peril group call\" state; and\nd)\tif the Call type IE of the received GROUP CALL ANNOUNCEMENT message is set to \"BASIC GROUP CALL\" and the stored call type is other than \"BASIC GROUP CALL\":\ni)\tshall set the stored current call type to \"BASIC GROUP CALL\";\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\niii)\tshall stop timer TFG13 (implicit downgrade emergency), if running;\niv)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running; and\nv)\tshall enter \"T2: in-progress basic group call\" state.\nWhen in the \"T1: in-progress emergency group call\" state, upon receiving an indication from:\n1)\tthe MCPTT user who upgraded the MCPTT group call; or\n2)\tan authorized MCPTT user with the value of \"/<x>/<x>/Common/MCPTTGroupCall/EmergencyCall/CancelMCPTTGroup\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\",\nto downgrade \"EMERGENCY GROUP CALL\", the MCPTT client:\n1)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n2)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n3)\tshall set current UTC time as last call type change time of the call;\n4)\tshall store own MCPTT user ID as last user to change call type of the call;\n5)\tshall generate a GROUP CALL EMERGENCY END message as specified in clause 15.1.15. In the GROUP CALL EMERGENCY END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call associated with the basic call control state machine;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call associated with the basic call control state machine;\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call associated with the basic call control state machine;\nd)\tshall set the Last call type change time IE to the stored last call type change time of the call; and\ne)\tshall set the Last user to change call type IE to the stored last user to change call type of the call;\n6)\tshall send the GROUP CALL EMERGENCY END message as specified in clause 10.2.1.1.1;\n7)\tshall stop timer TFG13 (implicit downgrade emergency);\n8)\tshall initialize the counter CFG11 (emergency end retransmission) with value set to 1;\n9)\tshall start timer TFG11 (emergency end retransmission); and\n10)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T2: in-progress basic group call\" state, upon expiry of timer TFG11 (emergency end retransmission), the MCPTT client:\n1)\tshall generate a GROUP CALL EMERGENCY END message as specified in clause 15.1.15. In the GROUP CALL EMERGENCY END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call associated with the basic call control state machine;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call associated with the basic call control state machine;\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call associated with the basic call control state machine;\nd)\tshall set the Last call type change time IE to the stored last call type change time of the call; and\ne)\tshall set the Last user to change call type IE to the stored last user to change call type of the call;\n2)\tshall send the GROUP CALL EMERGENCY END message as specified in clause 10.2.1.1.1;\n3)\tshall increment the value of the counter CFG11 (emergency end retransmission) by 1;\n4)\tshall start timer TFG11 (emergency end retransmission) if the value of the associated counter CFG11 (emergency end retransmission) is less than the upper limit; and\n5)\tshall remain in \"T2: in-progress basic group call\" state.\nWhen in the \"T1: in-progress emergency group call\" state, upon receiving GROUP CALL EMERGENCY END message, the MCPTT client:\n1)\tshall set the stored last call type change time to the Last call type change time IE of the received GROUP CALL EMERGENCY END message;\n2)\tshall set the stored last user to change call type to the Last user to change call type IE of the received GROUP CALL EMERGENCY END message;\n3)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n4)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n5)\tshall stop timer TFG13 (implicit downgrade emergency); and\n6)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T3: in-progress imminent peril group call\" state, upon receiving an indication from:\n1)\tthe MCPTT user who upgraded the call; or\n2)\tan authorized user with the value of \"/<x>/<x>/Common/MCPTTGroupCall/ImminentPerilCall/Cancel\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\",\nto downgrade \"IMMINENT PERIL GROUP CALL\", the MCPTT client:\n1)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n2)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n3)\tshall set current UTC time as last call type change time of the call;\n4)\tshall store own MCPTT user ID as last user to change call type of the call;\n5)\tshall generate a GROUP CALL IMMINENT PERIL END message as specified in clause 15.1.14. In the GROUP CALL IMMINENT PERIL END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call associated with the basic call control state machine;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call associated with the basic call control state machine;\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call associated with the basic call control state machine;\nd)\tshall set the Last call type change time IE to the stored last call type change time of the call; and\ne)\tshall set the Last user to change call type IE to the stored last user to change call type of the call;\n6)\tshall send the GROUP CALL IMMINENT PERIL END message as specified in clause 10.2.1.1.1;\n7)\tshall stop timer TFG14 (implicit downgrade imminent peril);\n8)\tshall initialize the counter CFG12 (imminent peril end retransmission) with value set to 1;\n9)\tshall start timer TFG12 (imminent peril end retransmission); and\n10)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T2: in-progress basic group call\" state, upon expiry of timer TFG12 (imminent peril end retransmission), the MCPTT client:\n1)\tshall generate a GROUP CALL IMMINENT PERIL END message as specified in clause 15.1.14. In the GROUP CALL IMMINENT PERIL END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call associated with the basic call control state machine;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call associated with the basic call control state machine;\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call associated with the basic call control state machine;\nd)\tshall set the Last call type change time IE to the stored last call type change time of the call; and\ne)\tshall set the Last user to change call type IE to the stored last user to change call type of the call;\n2)\tshall send the GROUP CALL IMMINENT PERIL END message as specified in clause 10.2.1.1.1;\n3)\tshall increment the value of the counter CFG12 (imminent peril end retransmission) by 1;\n4)\tshall start the timer TFG12 (imminent peril end retransmission) if the value of the associated counter CFG12 (imminent peril end retransmission) is less than the upper limit; and\n5)\tshall remain in \"T2: in-progress basic group call\" state.\nWhen in the \"T3: in-progress imminent peril group call\" state, upon receiving GROUP CALL IMMINENT PERIL END message, the MCPTT client:\n1)\tshall set the stored last call type change time to the Last call type change time IE of the received GROUP CALL IMMINENT PERIL END message;\n2)\tshall set the stored last user to change call type to the Last user to change call type IE of the received GROUP CALL IMMINENT PERIL END message;\n3)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n4)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45];\n5)\tshall stop timer TFG14 (implicit downgrade imminent peril); and\n6)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T1: in-progress emergency group call\" state, upon expiry of timer TFG13 (implicit downgrade emergency), the MCPTT client:\n1)\tshall store the current UTC time as the stored last call type change time of the call;\n2)\tshall store the originating MCPTT user ID as the stored last user to change call type of the call;\n3)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n4)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45]; and\n5)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T3: in-progress imminent peril call\" state, upon expiry of timer TFG14 (implicit downgrade imminent peril), the MCPTT client:\n1)\tshall store the current UTC time as the stored last call type change time of the call;\n2)\tshall store the originating MCPTT user ID as the stored last user to change call type of the call;\n3)\tshall set the stored current call type to \"BASIC GROUP CALL\";\n4)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network basic group call as described in 3GPP TS 24.483 [45]; and\n5)\tshall enter the \"T2: in-progress basic group call\" state.\nWhen in the \"T1: in-progress emergency group call\" state or \"T2: in-progress basic group call\" state or \"T3: in-progress imminent peril group call\" state, upon receiving a GROUP CALL ANNOUNCEMENT message with the MCPTT group ID IE matching the stored MCPTT group ID of the call and:\n1)\tthe Originating MCPTT user ID IE is different from the stored originating MCPTT user ID of the call; or\n2)\tthe Call identifier IE is different from the stored call identifier of the call;\nthen:\n1)\tif the stored current call type is \"BASIC GROUP CALL\" and the value of the Call type IE of GROUP CALL ANNOUNCEMENT message is either \"IMMINENT PERIL GROUP CALL\" or \"EMERGENCY GROUP CALL\"; or\n2)\tif the stored current call type is \"IMMINENT PERIL GROUP CALL\" and the value of the Call type IE of GROUP CALL ANNOUNCEMENT message is \"EMERGENCY GROUP CALL\"; or\n3)\tif the stored current call type being equal to the Call type IE of the GROUP CALL ANNOUNCEMENT message and the Call start time IE of the GROUP CALL ANNOUNCEMENT message being lower than the stored call start time of the call; or\n4)\tif the stored current call type being equal to the Call type IE of the GROUP CALL ANNOUNCEMENT message and the Call start time IE of the GROUP CALL ANNOUNCEMENT message being equal to the stored call start time of the call and the Call identifier IE of the GROUP CALL ANNOUNCEMENT message being lower than the stored call identifier of the call;\nthe MCPTT client:\n1)\tshall store the value of the Last call type change time IE of the received GROUP CALL ANNOUNCEMENT message as the last call type change time of the call;\n2)\tshall store the value of the Last user to change call type IE of the GROUP CALL ANNOUNCEMENT message as the last user to change call type of the call;\n3)\tshall store the value of the Call type IE of the GROUP CALL ANNOUNCEMENT message as the current call type of the call;\n4)\tif the Call type IE of GROUP CALL ANNOUNCEMENT message is set to \"EMERGENCY GROUP CALL\":\na)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency group call as described in 3GPP TS 24.483 [45];\nb)\tshall stop timer TFG14 (implicit downgrade imminent peril), if running;\nc)\tshall start timer TFG13 (implicit downgrade emergency), if not started already, with values as specified in clause 10.2.3.4.1.1; and\nd)\tshall enter \"T1: in-progress emergency group call\" state; and\n5)\tif the Call type IE of GROUP CALL ANNOUNCEMENT message is set to \"IMMINENT PERIL GROUP CALL\":\na)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network imminent peril group call as described in 3GPP TS 24.483 [45];\nb)\tshall start timer TFG14 (implicit downgrade imminent peril), if not started already, with values as specified in clause 10.2.3.4.1.2; and\nc)\tshall enter \"T3: in-progress imminent peril group call\" state.\nWhen in state T1: in-progress emergency group call\" or \"T2: in-progress basic group call\" or \"T3: in-progress imminent peril group call\" or upon receiving an indication from MCPTT user to release the call, the MCPTT client:\n1)\tshall release stored current call type;\n2)\tshall release stored ProSe per-packet priority;\n3)\tshall release Last call type change time;\n4)\tshall release Last user to change call type; and\n5)\tshall enter \"T0: waiting for the call to establish\" state.\nWhen in state \"T0: waiting for the call to establish\", upon receiving an indication from MCPTT user to release or reject the call, the MCPTT client:\n1)\tshall release stored current call type;\n2)\tshall release stored ProSe per-packet priority;\n3)\tshall release Last call type change time;\n4)\tshall release Last user to change call type;\n5)\tshall remain in \"T0: waiting for the call to establish\" state.\nUpon receiving a MONP message in a state where there is no handling specified for the MONP message, the MCPTT client shall discard the MONP message.\nUpon receiving an indication from the MCPTT user in a state where there is no handling specified for the indication, the MCPTT client shall ignore the indication.\nUpon expiration of a timer in a state where there is no handling specified for expiration of the timer, the MCPTT client shall ignore the expiration of the timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "10.3\tOff-network Broadcast group call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "10.3.1\tGeneral",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "10.3.2\tBasic call control",
                            "text_content": "The figure 10.3.2.2-1 gives an overview of the main states and transitions on the UE for broadcast group call control.\nThe figure depicts a broadcast group call control state machine, illustrating the flow of control and state changes within a broadcast group call. The state machine is depicted in a flowchart format, with various states representing different actions and transitions. The figure provides a visual representation of the complex process involved in managing broadcast group calls, highlighting the importance of proper control and state management in communication systems.\nFigure 10.3.2.2-1: Broadcast group call control state machine\nThis state exists for UE, when the UE is not part of an ongoing broadcast group call.\nThis state exists for UE, when the UE is part of an ongoing broadcast group call.\nThis state exists for the UE, when the UE has presented a notification to the MCPTT user for the received GROUP CALL BROADCAST message, is waiting for a response and is not expected to send confirm indication.\nThis state exists for UE, when the group call was rejected or released and GROUP CALL BROADCAST messages continue being received.\nWhen in the \"B1: start-stop\" state, upon the indication from MCPTT user to initiate the broadcast group call, the MCPTT client:\n1)\tshall generate an SDP body as specified in clause 10.2.1.1.2 and store it as the SDP body of the call;\n2)\tshall generate a random number with uniform distribution between 0 and 65535 and store it as the call identifier of the call;\n3)\tshall store own MCPTT user ID as the originating MCPTT user ID of the call;\n4)\tshall store \"BROADCAST GROUP CALL\" as the current call type;\n5)\tshall generate a GROUP CALL BROADCAST message as specified in clause 15.1.20. In the GROUP CALL BROADCAST message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Call type IE to the stored current call type;\nc)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call;\nd)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\ne)\tshall set the SDP IE to the stored SDP body of the call;\n6)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network broadcast calls described in 3GPP TS 24.483 [45];\n7)\tshall start floor control as originating floor participant as described specified in clause 7.2 in 3GPP TS 24.380 [5];\n8)\tshall send the GROUP CALL BROADCAST message as specified in clause 10.2.1.1.1;\n9)\tshall establish a media session based on the stored SDP body of the call;\n10)\tshall start timer TFB2 (broadcast retransmission);\n11)\tshall start timer TFB1 (max duration); and\n12)\tshall enter the \"B2: in-progress broadcast group call\" state.\nWhen in the \"B1: start-stop\" state, upon receiving a GROUP CALL BROADCAST message with the Call identifier IE not matching any in-progress broadcast group call, the MCPTT client:\n1)\tshall store the value of the Call identifier IE of the GROUP CALL BROADCAST message as the call identifier of the call;\n2)\tshall store the value of the Call type IE of the GROUP CALL BROADCAST message as the received current call type;\n3)\tshall store the value of the SDP IE of the GROUP CALL BROADCAST message as the SDP body of the call;\n4)\tshall store the value of the Originating MCPTT user ID IE of the GROUP CALL BROADCAST message as the originating MCPTT user ID of the call;\n5)\tshall store the value of the MCPTT group ID IE of the GROUP CALL BROADCAST message as the MCPTT group ID of the call;\n6)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is required upon a terminating call request reception:\ni)\tshall start timer TFB3 (waiting for the user);\nii)\tshall notify the MCPTT user; and\niii)\tshall enter the \"B3: pending user action\" state; and\n7)\tif the terminating UE is configured that the terminating MCPTT user acknowledgement is not required upon a terminating call request reception:\ni)\tshall establish a media session based on the stored SDP body of the call;\nii) shall start floor control as terminating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\niii)\tshall start timer TFB1 (max duration); and\niv)\tshall enter the \"B2: in-progress broadcast group call\" state.\nWhen in the \"B3: pending user action\" state, upon indication from the MCPTT user to accept the incoming broadcast group call, the MCPTT client:\n1)\tshall establish a media session based on the stored SDP body of the call;\n2)\tshall start floor control as terminating floor participant as described specified in clause 7.2 in 3GPP TS 24.380 [5];\n3)\tshall stop timer TFB3 (waiting for the user);\n4)\tshall start timer TFB1 (max duration); and\n5)\tshall enter the \"B2: in-progress broadcast group call\" state.\nWhen in the \"B3: pending user action\" state, upon an indication from the MCPTT user to reject the incoming broadcast group call, the MCPTT client:\n1)\tshall stop timer TFB3 (waiting for the user);\n2)\tshall start timer TFB1 (max duration); and\n3)\tshall enter the \"B4: ignoring same call ID\" state.\nWhen in the \"B3: pending user action\" state, upon expiration of timer TFB3 (waiting for the user), the MCPTT client:\n1)\tshall start timer TFB1 (max duration); and\n2)\tshall enter the \"B4: ignoring same call ID\" state.\nWhen in the \"B2: in-progress broadcast group call\" state, upon an indication from the terminating MCPTT user to release the in-progress broadcast group call, the MCPTT client:\n1)\tshall release the media session;\n2)\tshall stop floor control; and\n3)\tshall enter the \"B4: ignoring same call ID\" state.\nWhen in the \"B2: in-progress broadcast group call\" state, upon an indication from the originating MCPTT user to release the in-progress broadcast group call, the MCPTT client:\n1)\tshall release the media session;\n2)\tshall generate a GROUP CALL BROADCAST END message as specified in clause 15.1.21. In the GROUP CALL BROADCAST END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call; and\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\n3)\tshall send the GROUP CALL BROADCAST END message as specified in clause 10.2.1.1.1;\n4)\tshall stop timer TFB2 (broadcast retransmission);\n5)\tshall stop timer TFB1 (max duration);\n6)\tshall clear the stored call identifier;\n7)\tshall stop floor control; and\n8)\tshall enter the \"B1: start-stop\" state.\nWhen in the \"B2: in-progress broadcast group call\" state or \"B4: ignoring same call ID\" state, upon receiving GROUP CALL BROADCAST END message with the same Call identifier IE as the stored call identifier, the MCPTT client:\n1)\tshall release media session;\n2)\tshall stop timer TFB1 (max duration);\n3)\tshall clear the stored call identifier;\n4)\tshall stop floor control, if running; and\n5)\tshall enter the \"B1: start-stop\" state.\nWhen in the \"B2: in-progress broadcast group call\" state, upon expiry of timer TFB2 (broadcast retransmission), the MCPTT client:\n1)\tshall generate a GROUP CALL BROADCAST message as specified in clause 15.1.20. In the GROUP CALL BROADCAST message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Call type IE to the stored current call type;\nc)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call;\nd)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call; and\ne)\tshall set the SDP IE to the stored SDP body of the call;\n2)\tshall send the GROUP CALL BROADCAST message as specified in clause 10.2.1.1.1;\n3)\tshall restart timer TFB2 (broadcast retransmission); and\n4)\tshall remain in the \"B2: in-progress broadcast group call\" state.\nWhen in the \"B4: ignoring same call ID\" state, upon receiving GROUP CALL BROADCAST message and if the call identifier in GROUP CALL BROADCAST message matches with the stored call identifier the MCPTT client:\n1)\tshall restart timer TFB1 (max duration); and\n2)\tshall remain in \"B4: ignoring same call ID\" state.\nFor the terminating UE when in the \"B2: in-progress broadcast group call\" state or \"B4: ignoring same call ID\" state, upon expiry of timer TFB1 (max duration) the MCPTT client:\n1)\tshall release the media session;\n2)\tshall clear the stored call identifier;\n3)\tshall stop floor control, if running; and\n4)\tshall enter the \"B1: start-stop\" state.\nFor the originating UE when in the \"B2: in-progress broadcast group call\" state, upon expiry of timer TFB1 (max duration) the MCPTT client:\n1)\tshall release the media session;\n2)\tshall generate a GROUP CALL BROADCAST END message as specified in clause 15.1.21. In the GROUP CALL BROADCAST END message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier of the call;\nb)\tshall set the Originating MCPTT user ID IE to the stored originating MCPTT user ID of the call; and\nc)\tshall set the MCPTT group ID IE to the stored MCPTT group ID of the call;\n3)\tshall send the GROUP CALL BROADCAST END message as specified in clause 10.2.1.1.1;\n4)\tshall stop timer TFB2 (broadcast retransmission);\n5)\tshall clear the stored call identifier;\n6)\tshall stop floor control; and\n7)\tshall enter the \"B1: start-stop\" state.\nWhen in the \"B2: in-progress broadcast group call\" state, upon receiving GROUP CALL BROADCAST message and if the call identifier in GROUP CALL BROADCAST message matches with the stored call identifier, the MCPTT client:\n1)\tshall restart timer TFB1 (max duration); and\n2)\tshall remain in \"B2: in-progress broadcast group call\" state.\nWhen in the \"B3: pending user action\" state, upon receiving GROUP CALL BROADCAST END message with the same Call identifier IE as the stored call identifier, the MCPTT client:\n1)\tshall clear the stored call identifier;\n2)\tshall stop timer TFB3 (waiting for the user); and\n3)\tshall enter the \"B1: start-stop\" state.\nUpon receiving a MONP message in a state where there is no handling specified for the MONP message, the MCPTT client shall discard the MONP message.\nUpon receiving an indication from the MCPTT user in a state where there is no handling specified for the indication, the MCPTT client shall ignore the indication.\nUpon expiration of a timer in a state where there is no handling specified for expiration of the timer, the MCPTT client shall ignore the expiration of the timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "11\tPrivate call",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "11.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the private call procedures between two MCPTT clients for on-network and off-network.\nFor on-network, private call procedures with floor control are specified in clause 11.1.1 and without floor control are specified in clause 11.1.2.\nFor on-network, private call procedures are specified for the MCPTT client, the participating MCPTT function and the controlling MCPTT function on the originating side and terminating side. These procedures include the support for first-to-answer call.\nFor off-network, only private call procedures with floor control are specified in clause 11.2.\nFor off-network, private call procedures are specified for the MCPTT client on the originating side and terminating side.\nFor both on-network and off-network private calls, the use of automatic commencement mode and manual commencement mode are specified.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "11.1\tOn-network private call and first-to-answer call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.1.1\tPrivate call with floor control and first-to-answer call with floor control",
                            "text_content": "Clause 11.1.1 specifies the MCPTT client procedures, participating MCPTT function procedures and controlling MCPTT function procedures for on-network private calls with floor control and first-to-answer calls with floor control. The procedures cover both on-demand and pre-established session establishment. The procedures also cover emergency private call initiation, upgrade and cancellation.\nFor a private call, the MCPTT client shall initiate the call to one MCPTT user\nFor a first-to-answer call, the MCPTT client shall initiate the call to a list of two or more MCPTT users.\nUpon receiving a request from an MCPTT user to establish an MCPTT private call, or upon accepting a request to perform a private call transfer or a private call forwarding, the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI of the SIP INVITE request to a public service identity of the participating MCPTT function serving the MCPTT user;\n2)\tif the MCPTT user has requested the origination of a first-to-answer call, if the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure;\n3)\tif the MCPTT user has requested the origination of an MCPTT emergency private call or is originating an MCPTT private call and the MCPTT emergency state is already set, the MCPTT client:\na)\tshall, if this is an authorised request for an MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.1, comply with the procedures in clause 6.2.8.3.2; and\nb)\tshould, if this is an unauthorised request for an MCPTT emergency private call as determined in step a) above, indicate to the MCPTT user that they are not authorised to initiate an MCPTT emergency private call;\n4)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n5)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n6)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n7)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n8)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n9)\tfor the establishment of a private call shall insert in the SIP INVITE request an application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT user or the functional alias to be called, according to rules and procedures of IETF RFC 5366 [20];\nNOTE 1:\tThe MCPTT client indicates whether an MCPTT ID or a functional alias is to be called as specified in step 14) c) ii).\nNOTE 2:\tIf the initiation of the MCPTT private call is triggered by accepting a request to perform a private call forwarding, the MCPTT ID of the invited MCPTT user to be called is the value of the <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request.\n10)\tfor the establishment of a first-to-answer call shall insert in the SIP INVITE request according to rules and procedures of IETF RFC 5366 [20] an application/resource-lists+xml MIME body with:\na)\tthe MCPTT IDs of the potential target MCPTT users; or\nb)\tthe functional alias to be called;\nNOTE 2:\tThe MCPTT client indicates whether a list of MCPTT IDs or a functional alias is to be called as specified in step 15) b).\n11)\tif an end-to-end security context needs to be established and if the MCPTT user is initiating a private call then:\na)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\nb)\tshall use the keying material to generate a PCK as described in 3GPP TS 33.180 [78];\nc)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty-eight bits being randomly generated as described in 3GPP TS 33.180 [78];\nd)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user as determined by the procedures of clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180 [78];\ne)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78]; and\ng)\tshall add the MCPTT ID of the originating MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and\nf)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78];\n12)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarification given in clause 6.2.1 and with a media stream of the offered media-floor control entity;\n13)\tif implicit floor control is required, shall comply with the conditions specified in clause 6.4 and:\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\"; and\nb)\tif location information has not yet been included in the SIP INVITE request;\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element;\n14)\tif the MCPTT user is initiating a private call then:\na)\tif force of automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18];\nb)\tif force of automatic commencement mode at the invited MCPTT client is not requested by the MCPTT user and:\ni)\tif automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18]; and\nii)\tif manual commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Manual\" according to the rules and procedures of IETF RFC 5373 [18];\nb1)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call transfer, and the received SIP MESSAGE request contains a <replaces-header-value> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body then\ni)\tshall include a SIP Replaces header field with the header field value set to the value in the <replaces-header-value> element of the incoming SIP MESSAGE request; and\nb2)\tif the call request is a result of receiving a remotely initiated call request and if force of automatic commencement mode at the invited MCPTT client is requested in the received remotely initiated call request as described in the clause 11.1.7.2.2, shall include in the SIP INVITE request a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18];\nb3)\tif the call request is a result of receiving a remotely initiated call request and if force of automatic commencement mode at the invited MCPTT client is not requested in the received remotely initiated call request as described in the clause 11.1.7.2.2 and:\ni)\tif automatic commencement mode at the invited MCPTT client is requested in the received remotely initiated call request as described in the clause 11.1.7.2.2, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18]; and\nii)\tif manual commencement mode at the invited MCPTT client is requested in the received remotely initiated call request as described in the clause 11.1.7.2.2, shall include in the SIP INVITE request an Answer-Mode header field with the value \"Manual\" according to the rules and procedures of IETF RFC 5373 [18]; and\nc)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\ni)\tthe <session-type> element set to a value of \"private\"; and\nii)\tan <anyExt> element containing:\nA)\tthe <call-to-functional-alias-ind> element set to \"true\" if the functional alias is used as a target of the call request;\nB)\tif the MCPTT client needs to include an active functional alias in the initial SIP INVITE request, the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 3:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nC)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\nD) if the call request is a result of receiving a remotely initiated call request, shall include the <anyExt> element with the <remotely-initiated-call-request-ind> element set to \"true\";\n14A)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call transfer then:\na)\tshall include in the SIP INVITE request a Priv-Answer-Mode header field with the same value as in the MCPTT call to be transferred according to the rules and procedures of IETF RFC 5373 [18]; and\nb)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\ni)\tthe <session-type> element set to a value of \"private\"; and\nii)\tan <anyExt> element containing:\nA)\tif the MCPTT client needs to include an active functional alias in the initial SIP INVITE request, the <functional-alias-URI> element set to the URI of the used functional alias;\nB)\twith the <call-transfer-ind> element set to \"true\";\nC)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\nD) if the call request is a result of receiving a remotely initiated call request, shall include the <anyExt> element with the <remotely-initiated-call-request-ind> element set to \"true\";\n14B)\tif the MCPTT client initiates the private call upon a request from an MCPTT user then:\na)\tshall set the <forwarding-sequence-number> element to 0;\n14C)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call forwarding then:\na)\tshall include in the SIP INVITE request a Priv-Answer-Mode header field with the same value as in the MCPTT call to be forwarded according to the rules and procedures of IETF RFC 5373 [18];\na1)\tshall increment <forwarding-sequence-number> element;\na2)\twith the <call-to-functional-alias-ind> set to \"false\";\nb)\tif the \"SIP MESSAGE request for forwarding private call request for terminating client\" contained a <forwarding-reason> with a value of \"immediate\", shall append an entry containing the MCPTT ID of the forwarded MCPTT user and an <anyExt> element containing the following elements to the <forwarding-immediate-list>;\ni) \t the <forwarding-sequence-number> element containing the sequence number of the forwarding;\nNOTE 4:\tThis number is the total number of immediate and other forwardings for a single call starting with 1 for the first forwarding.\nii)\tthe <forwarded-by-mcptt-id> element containing the MCPTT ID received in the<forwarded-by-mcptt-id> element of the incoming SIP MESSAGE request, if present;\niii)\tthe <forwarded-by-functional-alias> element set to the value of <forwarded-by-functional-alias > element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\niv)\tthe <forwarding-target-orig-id> element set to the value of <forwarding-target-orig-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nv)\tthe <forwarding-target-is-functional-alias> element set to the value of <forwarding-target-is-functional-alias> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present; and\nvi)\tthe <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nc)\tif the \"SIP MESSAGE request for forwarding private call request for terminating client\" contained a <forwarding-reason> with a value of \"no-answer\", or \"manual-input\", append an entry containing the MCPTT ID of the forwarded MCPTT user and an <anyExt> element containing the following elements to the <forwarding-other-list>:\ni)\tthe <forwarding-sequence-number> element containing the sequence number of the forwarding;\nNOTE 5:\tThis number is the total number of immediate and other forwardings for a single call starting with 1 for the first forwarding.\nii)\tthe <forwarded-by-mcptt-id> element containing the MCPTT ID received in the <forwarded-by-mcptt-id> element of the incoming SIP MESSAGE request, if present;\niii)\tthe <forwarded-by-functional-alias> element set to the <forwarded-by-functional-alias > element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\niv)\tthe <forwarding-target-id> element set to the <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nv)\tthe <forwarding-target-is-functional-alias> element set to the <forwarding-target-is-functional-alias> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nvi)\tthe <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present; and\nvii)\tthe <forwarding-reason> element set to the <forwarding-reason> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nd)\tshall cache both the <forwarding-immediate-list> and the <forwarding-other-list> until a final response for the SIP INVITE is received; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\ni)\tthe <session-type> element set to a value of \"private\"; and\nii)\tan <anyExt> element containing:\nA)\tif the MCPTT client needs to include an active functional alias in the initial SIP INVITE request, the <functional-alias-URI> element set to the URI of the used functional alias;\nB)\tthe <call-forwarding-ind> element set to \"true\";\nC)\tthe <forwarding-immediate-list> element;\nD)\tthe <forwarding-other-list> element;\nE)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\nF) if the call request is a result of receiving a remotely initiated call request, shall include the <anyExt> element with the <remotely-initiated-call-request-ind> element set to \"true\";\n15)\tif the MCPTT user is initiating a first-to-answer call shall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"first-to-answer\"; and\nb)\tan <anyExt> element containing:\ni)\tthe <call-to-functional-alias-ind> element set to \"true\" if the functional alias is used as a target of the call request;\nii)\tif the MCPTT client needs to include an active functional alias in the initial SIP INVITE request, the <functional-alias-URI> element set to the URI of the used functional alias; and\nNOTE 6:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\niii)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value;\n16)\tif the MCPTT emergency private call state is set to either \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\" or the MCPTT emergency private priority state for this private call is set to \"MEPP 2: in-progress\", the MCPTT client shall comply with the procedures in clause 6.2.8.3.3; and\n17)\tshall send SIP INVITE request towards the MCPTT server according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183(Session Progress) response to the SIP INVITE request the MCPTT client:\n1)\tmay indicate the progress of the session establishment to the inviting MCPTT user.\nUpon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tif the sent SIP INVITE request was for the origination of a first-to-answer call and the SDP answer contained in the received SIP 200 (OK) response contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the sender of the SIP 200 (OK) response from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails:\ni)\tif the sent SIP INVITE request was a request for an MCPTT emergency private call and if the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested, the MCPTT client:\nA)\tshall set the MCPTT emergency private call state to \"MEPC 1: emergency-pc-capable\";\nB)\tif the MCPTT emergency private priority state of the private call is \"MEPP 3: confirm-pending\" shall set the MCPTT emergency private priority state of the private call to \"MEPP 1: no-emergency\"; and\nC)\tif the sent SIP request for an MCPTT emergency private call contained an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\". and\nii)\tshall release the session as specified in the procedures of clause 11.1.3.1.1.1 with the following clarifications:\nA)\tshall include in the SIP BYE request an application/vnd.3gpp.mcptt-info+xml MIME body containing a <release-reason> element set to a value of \"authentication of the MIKEY-SAKE I_MESSAGE failed\"; and\nB)\tshall skip the remaining steps in the present clause; and\ne)\tif the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:\ni)\tshall extract and decrypt the encapsulated PCK using the originating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\nNOTE 7:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n3)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\", shall perform the actions specified in clause 6.2.8.3.4; and\n3A)\tmay notify the answer state to the user (i.e. \"Unconfirmed\" or \"Confirmed\") if received in the P-Answer-State header field;\n4)\tif the sent SIP INVITE request was for the origination of a first-to-answer call and the received SIP 200 (OK) response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcpttinfo> element containing the <mcptt-Params> element containing an <mcptt-called-party-id> element, may display the value of the <mcptt-called-party-id> element; and\n5)\tshall notify the user that the call has been successfully established.\nUpon receiving a SIP 300 (Multiple Choices) response to the SIP INVITE request the MCPTT client shall use the MCPTT ID of MCPTT user contained in the <mcptt-request-uri> element of the received application/vnd.3gpp.mcptt-info MIME body as the MCPTT ID of the invited MCPTT user and shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given in this clause and with the following additional clarifications:\n1)\tshall insert in the newly generated SIP INVITE request an application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT user in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body in the received SIP 300 (Multiple Choices) response;\n2)\tshall not include a <call-to-functional-alias-ind> element into the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\tshall include a <called-functional-alias-URI> element into the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body with the target functional alias URI used in the initial SIP INVITE request for establishing a private call.\nOn receiving of a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" shall:\n1)\tif the MCPTT client receives a SIP MESSAGE request for forwarding private call within a time decided by the client implementation, the MCPTT client shall follow the actions specified in clause 11.1.9.2.2;\n2)\tif the MCPTT client does not receive a SIP MESSAGE request for forwarding private call within a time decided by the client implementation, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID that was previously called; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"forwarding-private-call-response\"; and\nB)\ta <forwarding-call-outcome> element set to a value of \"fail\";\n3)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n4)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\"; or\n2)\tif the MCPTT emergency private call state is set to \"MEPC 3: emergency-pc-granted\";\nthe MCPTT client shall perform the actions specified in clause 6.2.8.3.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing session, the MCPTT client shall follow the actions specified in clause 6.2.8.3.7.\nUpon receipt of an initial SIP INVITE request, the MCPTT client shall follow the procedures for termination of multimedia sessions in the IM CN subsystem as specified in 3GPP TS 24.229 [4] with the clarifications below.\nThe MCPTT client:\n1)\tmay reject the SIP INVITE request if any of the following conditions are met:\na)\tMCPTT client is already occupied in another session and the number of simultaneous sessions exceeds <MaxCall>, the maximum simultaneous MCPTT session for private call, as specified in TS 24.484 [50];\nb)\tMCPTT client does not have enough resources to handle the call; or\nc)\tany other reason outside the scope of this specification;\notherwise, continue with the rest of the steps.\nNOTE 1:\tIf the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\", the participating MCPTT function can choose to accept the request.\n2)\tif the SIP INVITE request is rejected in step 1), shall respond toward participating MCPTT function either with appropriate reject code as specified in 3GPP TS 24.229 [4] and warning texts as specified in clause 4.4.2 or with SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure according to <allow-failure-restriction> as specified in 3GPP TS 24.484 [50] and skip the rest of the steps of this clause;\n3)\tif the SIP INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP INVITE request for an MCPTT emergency private call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT emergency private call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tif the <alert-ind> element is set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information; and\nb)\tif the session was established with a <session-type> of \"first-to-answer\"; shall temporarily save the current value of the MCPTT emergency private priority (MEPP) state;\nNOTE 2:\tThe current value of the MCPTT emergency private priority (MEPP) state needs to be temporarily saved because the MCPTT client may not be the one selected to terminate the first to answer emergency private call. Hence, the MCPTT client needs to be able to restore the MCPTT emergency private priority (MEPP) state to the saved value.\nc)\tshall set the MCPTT emergency private priority state to \"MEPP 2: in-progress\" for this private call;\n4)\tif the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the originating MCPTT user from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4; and\ne)\tif the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:\ni)\tshall extract and decrypt the encapsulated PCK using the terminating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\nNOTE 3:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n5)\tif an end-to-end security context needs to be established and if the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request is set to \"first-to-answer\" then:\na)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\nb)\tshall use the keying material to generate a PCK as described in 3GPP TS 33.180 [78];\nc)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP TS 33.180 [78];\nd)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the originator of the SIP INVITE request as determined by the procedures of clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180 [78];\ne)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78];\nf)\tshall add the MCPTT ID of the MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and\nNOTE 4:\tThe initiator of the MIKEY-SAKKE I_MESSAGE is in this case the terminating client from the perspective of the call.\ng)\tshall sign the MIKEY-SAKKE I_MESSAGE using the MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78];\n6)\tmay check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n7)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user;\n7A)\tmay display to the MCPTT user the functional alias of the inviting MCPTT user, if provided;\n7B)\tmay display to the MCPTT user the history of the MCPTT call forwardings based on information present in the <forwarding-immediate-list> and <forwarding-other-list> elements, if provided;\n7C)\tif the <remotely-initiated-call-request-ind> element included in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request, may indicate to the MCPTT user that the received call request is a result of receiving a remotely initiated call request;\n8)\tif the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request is set to \"first-to-answer\":\na)\tshall notify the user of the incoming call;\nb)\tshall not forward the first-to-answer call;\nc)\tif the MCPTT user is busy on another call, shall send a SIP 486 (Busy Here) to the SIP INVITE request according to 3GPP TS 24.229 [4] and not continue with any further steps in this clause; and\nd)\tif the MCPTT user does not answer the call within a time decided by the client implementation, the MCPTT client shall send a SIP 480 (Temporarily Unavailable) to the SIP INVITE request according to 3GPP TS 24.229 [4] and not continue with any further steps in this clause;\nNOTE 5:\tIn the conditions below, as the SIP layer implements the actions for commencement mode, it is assumed that the Answer-Mode or Priv-Answer-Mode header fields are set correctly in line with the setting of the <session-type> in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request.\n9)\tshall perform the automatic commencement procedures specified in clause 6.2.3.1.1 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode;\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode, yet the invited MCPTT client is willing to answer the call with automatic commencement mode; or\nc)\tSIP INVITE request contains a Priv-Answer-Mode header field with the value of \"Auto\"; and\n10)\tshall perform the manual commencement procedures specified in clause 6.2.3.2.1 if either of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode;\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode, yet the invited MCPTT client allows the call to be answered with manual commencement mode; or\nc)\tSIP INVITE request contains a Priv-Answer-Mode header field with the value of \"Manual\".\nUpon receiving the SIP CANCEL request cancelling a SIP INVITE request for which a dialog exists at the MCPTT client and a SIP 200 (OK) response has not yet been sent to the SIP INVITE request then the MCPTT client:\n1)\tif the session was established with a <session-type> of \"first-to-answer\", may notify the MCPTT user of the cancellation of the call;\n2)\tif a temporary MCPTT emergency private priority (MEPP) state value was saved in step 3) b) above:\na)\tshall restore the MCPTT emergency private priority (MEPP) state to the temporary MCPTT emergency private priority (MEPP) state value; and\nb)\tshall discard the temporary MCPTT emergency private priority (MEPP) state value;\n3)\tshall send a SIP 200 (OK) response to the SIP CANCEL request according to 3GPP TS 24.229 [4]; and\n4)\tshall send a SIP 487 (Request Terminated) response to the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving a SIP BYE request for an established dialog, the MCPTT client:\n1)\tif the session was established with a <session-type> of \"first-to-answer\" and:\na)\tif the received SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <release-reason> element set to a value of \"not selected for call\" or \"authentication of the MIKEY-SAKE I_MESSAGE failed\":\ni)\tif a temporary MCPTT emergency private priority (MEPP) state value was saved in step 3) b) above, shall restore the MCPTT emergency private priority (MEPP) state to the temporary MCPTT emergency private priority (MEPP) state value saved in step 3) b) above; and\nb)\tmay notify the MCPTT user of the release of the call; and\n2)\tshall follow the procedures in clause 11.1.4.2.\nNOTE 6:\tThe above conditions for SIP CANCEL and SIP BYE cover the case for a first-to-answer call where the MCPTT server has already established the private call with another MCPTT client and needs to immediately cancel or release the dialogs with other MCPTT clients.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request for an existing private call session, the MCPTT client shall:\n1)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication that this is a SIP re-INVITE request to upgrade this call to an MCPTT emergency private call and:\ni)\tshould display the MCPTT ID of the originator of the MCPTT emergency private call contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tif the <alert-ind> element is set to \"true\", should display to the MCPTT user an indication of the MCPTT emergency alert and associated information; and\nb)\tshall set the MCPTT emergency private priority state to \"MEPP 2: in-progress\" for this private call;\n2)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user an indication that this is a SIP re-INVITE request to downgrade this emergency private call to a normal priority private call and:\ni)\tshould display the MCPTT ID of the sender of the SIP re-INVITE request contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tif the <alert-ind> element is set to \"false\" should display to the MCPTT user an indication that the MCPTT emergency alert is cancelled;\niii)\tif the SIP re-INVITE request contains an application/vnd.3gpp.mcptt-info+xml MIME body including an <originated-by> element:\nA)\tshould display to the MCPTT user the MCPTT ID contained in the <originated-by> element of the MCPTT user that originated the MCPTT emergency alert; and\nB)\tif the MCPTT ID contained in the <originated-by> element is the MCPTT ID of the receiving MCPTT user, shall set the MCPTT emergency alert state to \"MPEA 1: no-alert\";\nb)\tshall set the MCPTT emergency private priority state to \"MEPP 1: no-emergency\" for this private call; and\nc)\tif the MCPTT emergency private call state of the call is set to \"MEPC 3: emergency-call-granted\", shall set the MCPTT emergency private call state of the call to \"MEPC 1: emergency-pc-capable\";\n3)\tmay check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n4)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user if not done so in step 1 or step 2 above;\nNOTE 1:\tAs this is a re-INVITE for an existing MCPTT private call session, there is no attempt made to change the answer-mode from its current state.\n4A)\tmay display to the MCPTT user the functional alias of the inviting MCPTT user, if provided;\n5)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n5A)\tshall, if the incoming SIP re-INVITE request contains a <transfer-announced-ind> element set to a value of \"true\" in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body, set the value of the <replaces-header-value> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the following value: The Call-ID header field, and the value of the from-tag header field parameter set to the value contained in the incoming SIP INVITE request. The value of the to-tag is the one set by the MCPTT client in the 200 (OK) response. Together they represent a dialog identifier;\n6)\tif the SIP re-INVITE request was received within an on-demand session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.2;\n7)\tif the SIP re-INVITE request was received within a pre-established session, shall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session;\nNOTE 2:\tThe SIP re-INVITE request can be received within an on-demand session or a pre-established session. If the SIP re-INVITE request is received within a pre-established session, the media-level section for the MCPTT speech media stream and the media-level section of the media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n8)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4]; and\n9)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to cancel the in-progress emergency condition on an MCPTT emergency private call, the MCPTT client shall generate a SIP re-INVITE request by following the UE session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress emergency condition on an MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.2, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress emergency condition on an MCPTT emergency private call; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and optionally an MCPTT emergency alert originated by the MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.3.6;\n3)\tshall, if the MCPTT user is cancelling an in-progress emergency condition and optionally an MCPTT emergency alert originated by another MCPTT user, include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.3.8;\n4)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.3.3;\n5)\tshall include in the SIP re-INVITE request an SDP offer the media parameters as currently established;\nNOTE 1:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session associated with an MCPTT group call. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n6)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n7)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tshall set the MCPTT emergency private priority state of the MCPTT private call to \"MEPP 1: no-emergency\";\n3)\tshall set the MCPTT emergency private call state of the call to \"MEPC 1: emergency-pc-capable\"; and\n4)\tif the MCPTT emergency alert state is set to \"MPEA 4: Emergency-alert-cancel-pending\", the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the SIP 2xx response to the SIP request for a priority group call does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", shall set the MCPTT emergency alert state to \"MPEA 1: no-alert\".\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request:\n1)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> element set to a value of \"true\", the MCPTT client shall set the MCPTT emergency private priority state as \"MEPP 2: in-progress\";\n2)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\" and the sent SIP re-INVITE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, the MCPTT client shall set the MCPTT emergency alert state to \"MPEA 3: emergency-alert-initiated\"; and\n3)\tif the SIP 4xx response, SIP 5xx response or SIP 6xx response did not contain an application/vnd.3gpp.mcptt-info+xml MIME body, shall set the MCPTT emergency private priority state as \"MEPP 2: in-progress\" and the MCPTT emergency alert (MPEA) state shall revert to its value prior to entering the current procedure.\nNOTE 2:\tIf the in-progress emergency private priority state cancel request is rejected, the state of the session does not change, i.e. continues with MCPTT emergency private call level priority.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.3.7.\nThis clause covers both on-demand session and pre-established sessions.\nUpon receiving a request from an MCPTT user to upgrade the ongoing MCPTT private call to an MCPTT emergency private call, the MCPTT client shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the clarifications given below.\n1)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as specified in clause 6.2.8.3.2;\n2)\tshall include a Resource-Priority header field and comply with the procedures in clause 6.2.8.3.3.\n3)\tshall include an SDP offer with the media parameters as currently established according to 3GPP TS 24.229 [4];\nNOTE:\tThe SIP re-INVITE request can be sent within an on-demand session or a pre-established session associated with an MCPTT private call. If the SIP re-INVITE request is sent within a pre-established session, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n4)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and:\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", and\nb)\tif location information has not yet been included in the SIP re-INVITE request;\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n5)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5]; and\n2)\tshall perform the actions specified in clause 6.2.8.3.4.\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the SIP re-INVITE request, the MCPTT client shall perform the actions specified in clause 6.2.8.3.5.\nOn receiving a SIP INFO request where the Request-URI contains an MCPTT session ID identifying an ongoing group session, the MCPTT client shall follow the actions specified in clause 6.2.8.3.7\nUpon receiving a request from an MCPTT user to establish an MCPTT private call within a pre-established session, or upon accepting a request to complete a private call transfer or a private call forwarding within a pre-established session, the MCPTT client shall generate a SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.\nNOTE 1:\tIf the inititation of the MCPTT private call is triggered by accepting a request to perform a private call forwarding, the MCPTT ID of the invited MCPTT user to be called is the value of the <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request.\nIf the user requested the private call to be a first-to-answer call and if the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nIf the MCPTT user is initiating a private call and an end-to-end security context needs to be established the MCPTT client:\n1)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\n2)\tshall use the keying material to generate a PCK as described in 3GPP TS 33.180 [78];\n3)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty-eight bits being randomly generated as described in 3GPP TS 33.180 [78];\n4)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user as determined by the procedures of clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180 [78];\n5)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78];\n6)\tshall add the MCPTT ID of the originating MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and\n7)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78].\nThe MCPTT client populates the SIP REFER request as follows:\n1)\tshall include the Request-URI set to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n2)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\n3)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22];\n4)\tshall include the option tag \"multiple-refer\" in the Require header field;\n5)\tmay include a P-Preferred-Identity header field in the SIP REFER request containing a public user identity as specified in 3GPP TS 24.229 [4];\n6)\tshall include a P-Preferred-Service header field set to the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), according to IETF RFC 6050 [9];\n7)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20], and with the Content-ID header field set to this \"cid\" URL;\n8)\tfor the initiation of a private call, shall include in the application/resource-lists+xml MIME body a single <entry> element in a <list> element in the <resource-lists> element, where the \"uri\" attribute of the single <entry> element is set to the MCPTT ID of the called user or the functional alias to be called, extended with the following URI header fields:\nNOTE 2:\tCharacters that are not formatted as ASCII characters are escaped in the following parameters in the headers portion of the SIP URI.\nNOTE 2A:\tThe MCPTT client indicates whether an MCPTT ID or a functional alias is to be called as specified in step 8) c) ii) C).\na)\tif force of automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18];\nb)\tif force of automatic commencement mode at the invited MCPTT client is not requested by the MCPTT user and:\ni)\tif automatic commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include an Answer-Mode header field with the value \"Automatic\" according to rules and procedures of IETF RFC 5373 [18]; and\nii)\tif manual commencement mode at the invited MCPTT client is requested by the MCPTT user, shall include an Answer-Mode header field with the value \"Manual\" according to rules and procedures of IETF RFC 5373 [18];\nb1)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call transfer, and the received SIP MESSAGE request contains a <replaces-header-value> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body then\ni)\tshall include a SIP Replaces header field with the header field value set to the value in the <replaces-header-value> element of the incoming SIP MESSAGE request; and\nc)\tshall include in an hname \"body\" parameter:\ni)\tif the SDP parameters of the pre-established session do not contain a media-level section of a media-floor control entity or if end-to-end security is required for the private call, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1. If implicit floor control is required and the pre-established session was not established with an implicit floor request, then the application/sdp MIME body shall contain an implicit floor request as specified in clause 6.4; and\nii)\tan application/vnd.3gpp.mcptt-info MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\nA)\tthe <session-type> element set to \"private\";\nB)\tif the MCPTT client needs to include an active functional alias in the SIP REFER request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 3:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nC)\tthe <anyExt> element with the <call-to-functional-alias-ind> element set to \"true\" if the functional alias is used as a target of the call request;\nD)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call transfer then shall include the <call-transfer-ind> set to \"true\";\nD1)\tif the MCPTT client initiates the private call upon a request from an MCPTT user shall set the <forwarding-sequence-number> element to 0;\nD2)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call forwarding shall increment the <forwarding-sequence-number> element;\nE)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call forwarding and if the \"SIP MESSAGE request for forwarding private call request for terminating client\" contained a < forwarding-reason > with a value of \"immediate\", shall append an entry containing the MCPTT ID of the forwarded MCPTT user and an <anyExt> element containing the following elements to the <forwarding-immediate-list>:\nI)\ta <forwarding-sequence-number> element containing the sequence number of the forwarding\nNOTE 3A:\tThis number is the total number of immediate and other forwardings for a single call starting with 1 for the first forwarding.\nII)\ta <forwarded-by-mcptt-id> element containing the MCPTT ID received in the<forwarded-by-mcptt-id> element of the incoming SIP MESSAGE request, if present;\nIII)\ta <forwarded-by-functional-alias> element set to the <forwarded-by-functional-alias > element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nIV)\ta <forwarding-target-orig-id> element set to the <forwarding-target-orig-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nV)\ta <forwarding-target-is-functional-alias> element set to the <forwarding-target-is-functional-alias> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present; and\nVI)\t\tthe <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nF)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call forwarding and if the \"SIP MESSAGE request for forwarding private call request for terminating client\" contained a < forwarding-reason > with a value of \"no-answer\", or \"manual-input\", shall append an entry containing the MCPTT ID of the forwarded MCPTT user and an <anyExt> element containing the following elements to the <forwarding-other-list>:\nI)\ta <forwarding-sequence-number> element containing the sequence number of the forwarding;\nNOTE 3B:\tThis number is the total number of immediate and other forwardings for a single call starting with 1 for the first forwarding.\nII)\ta <forwarded-by-mcptt-id> element containing the MCPTT ID received in the <forwarded-by-mcptt-id> element of the incoming SIP MESSAGE request, if present;\nIII)\ta <forwarded-by-functional-alias> element set to the <forwarded-by-functional-alias > element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nIV)\ta <forwarding-target-orig-id> element set to the <forwarding-target-orig-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nV)\ta <forwarding-target-is-functional-alias> element set to the <forwarding-target-is-functional-alias> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nVI)\tthe <forwarding-target-id> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present; and\nVII)\ta <forwarding-reason> element set to the <forwarding-reason> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request, if present;\nG)\tif the MCPTT client initiates the private call upon accepting a request to perform a private call forwarding:\nI)\tshall cache both the <forwarding-immediate-list> and the <forwarding-other-list> until a final response for the SIP REFER is received;\nII)\tshall include the <call-forwarding-ind> set to \"true\";\nIII)\tshall include the <forwarding-immediate-list> element;\nIV)\tshall include the <forwarding-other-list> element; and\nV)\tshall include the <call-to-functional-alias-ind> set to \"false\"; and\nH)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value;\n9)\tfor an initiation of a first-to-answer call, shall include in the application/resource-lists+xml MIME body an <entry> element in a <list> element in the <resource-lists> element for each of the targeted MCPTT users, with each <entry> element containing a \"uri\" attribute set to the MCPTT ID of the targeted user, extended with an hname \"body\" parameter in the headers portion of the SIP URI or a single <entry> element in a <list> element in the <resource-lists> element containing a \"uri\" attribute set to the functional alias is to be called, extended with hname \"body\" parameter in the headers portion of the SIP URI containing:\nNOTE 4:\tCharacters that are not formatted as ASCII characters are escaped in the following parameters in the headers portion of the SIP URI.\nNOTE 4A:\tThe MCPTT client indicates whether a list of MCPTT IDs or a functional alias is to be called as specified in step 9) b) ii).\na)\tif the SDP parameters of the pre-established session do not contain a media-level section of a media-floor control entity, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP TS 24.229 [4] with the clarification given in clause 6.2.1. If implicit floor control is required and the pre-established session was not established with an implicit floor request, then the application/sdp MIME body shall contain an implicit floor request as specified in clause 6.4; and\nb)\tan application/vnd.3gpp.mcptt-info MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\ni)\tthe <session-type> element set to \"first-to-answer\"; and\nii)\tan <anyExt> element containing:\nA)\tthe <call-to-functional-alias-ind> element set to \"true\" if the functional alias is used as a target of the call request;\nB)\tif the MCPTT client needs to include an active functional alias in the SIP REFER request, the <functional-alias-URI> element set to the URI of the used functional alias; and\nC)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value;\n10)\tif the MCPTT user has requested the origination of an MCPTT emergency private call or is originating an MCPTT private call and the MCPTT emergency state is already set, the MCPTT client:\na)\tif this is an authorised request for an MCPTT emergency private call as determined by the procedures of clause 6.2.8.3.1.1, shall comply with the procedures in clause 6.2.8.3.2; and\nb)\tif this is an unauthorised request for an MCPTT emergency private call as determined in step a) above, should indicate to the MCPTT user that they are not authorised to initiate an MCPTT emergency private call;\n11)\tif the MCPTT emergency private priority state for this call is set to \"MEPP 2: in-progress\", the MCPTT client shall comply with the procedures in clause 6.2.8.3.3;\n12)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session; and\n13)\tif:\na)\timplicit floor control is required;\nb)\tthe pre-established session was not established with an implicit floor request; and\nc)\tlocation information has not yet been included in the SIP REFER request;\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element.\nThe MCPTT client shall send the SIP REFER request towards the MCPTT server according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 300 (Multiple Choices) response to the SIP REFER request the MCPTT client shall use the MCPTT ID of MCPTT user contained in the <mcptt-request-uri> element of the received application/vnd.3gpp.mcptt-info MIME body as the MCPTT ID of the invited MCPTT user and shall generate a SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below in this clause with following additional clarifications:\n1)\tshall insert in the newly generated SIP REFER request an application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT user in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info MIME body in the received SIP 300 (Multiple Choices) response;\n2)\tshall not include an <call-to-functional-alias-ind> element into the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\tshall include a <called-functional-alias-URI> element into the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body with the target functional alias URI used in the initial SIP REFER request for establishing a private call.\nUpon receiving a final SIP 2xx response to the SIP REFER request the MCPTT client:\n1)\tshall interact with media plane as specified in 3GPP TS 24.380 [5];\n2) if the sent SIP REFER request was for the origination of a first-to-answer call and the received SIP 200 (OK) response contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcpttinfo> element containing the <mcptt-Params> element containing an <mcptt-called-party-id> element, may display the value of the <mcptt-called-party-id> element; and\n3)\tshall notify the user that the call has been successfully established.\nOn receiving of a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" shall:\n1)\tif the MCPTT client receives a SIP MESSAGE request for forwarding private call within a time decided by the client implementation, the MCPTT client shall follow the actions specified in clause 11.1.9.2.2;\n2)\tif the MCPTT client does not receive a SIP MESSAGE request for forwarding private call within a time decided by the client implementation, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID that was previously called; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"forwarding-private-call-response\"; and\nB)\ta <forwarding-call-outcome> element set to a value of \"fail\";\n3)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n4)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 4xx response, SIP 5xx response or a SIP 6xx response to the SIP REFER request for an MCPTT emergency private call:\n1)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\", the MCPTT client shall perform the actions specified in clause 6.2.8.3.5; and\n2)\tshall skip the remaining steps.\nUpon receipt of a SIP re-INVITE request within the pre-established session targeted by the sent SIP REFER request, the MCPTT client:\n1)\tif the sent SIP REFER request was a request to originate a first-to-answer call:\na)\tif the received SIP re-INVITE request contains an SDP offer including an a=key-mgmt attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\ni)\tshall extract the MCPTT ID of the sender of the SIP 200 (OK) response from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nii)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\niii)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\niv)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails:\nA)\tshall set the MCPTT emergency private call state to \"MEPC 1: emergency-pc-capable\";\nB)\tif the MCPTT emergency private priority state of the private call is \"MEPP 3: confirm-pending\" shall set the MCPTT emergency private priority state of the private call to \"MEPP 1: no-emergency\";\nC)\tif the sent SIP request for an MCPTT emergency private call contained an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to a value of \"true\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert\"; and\nD)\tshall release the session as specified in the procedures of clause 11.1.3.1.2.1 with the following clarifications:\nI)\tshall include in the SIP BYE request an application/vnd.3gpp.mcptt-info+xml MIME body containing a <release-reason> element set to a value of \"authentication of the MIKEY-SAKE I_MESSAGE failed\"; and\nII)\tshall skip the remaining steps in the present clause; and\nv)\tif the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:\nA)\tshall extract and decrypt the encapsulated PCK using the originating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nB)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\nNOTE 4:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n2)\tif the sent SIP REFER request was a request for an MCPTT emergency private call:\na)\tif the MCPTT emergency private call state is set to \"MEPC 2: emergency-pc-requested\" or \"MEPC 3: emergency-pc-granted\":\ni)\tshall set the MCPTT emergency private priority state of the call to \"MEPP 2: in-progress\" if it was not already set;\nii)\tshall set the MCPTT emergency private call state to \"MEPC 3: emergency-pc-granted\"; and\niii)\tif the MCPTT private emergency alert state is set to \"MPEA 2: emergency-alert-confirm-pending\" and:\nA)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"true\" or does not contain an <alert-ind> element, shall set the MCPTT private emergency alert state to \"MPEA 3: emergency-alert-initiated \"; or\nB)\tif the SIP re-INVITE request contains an <alert-ind> element set to a value of \"false\", shall set the MCPTT private emergency alert state to \"MPEA 1: no-alert \";\n3)\tshall check if a Resource-Priority header field is included in the incoming SIP re-INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n4)\tshall accept the SIP re-INVITE request and generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n5)\tshall include an SDP answer in the SIP 200 (OK) response to the SDP offer in the incoming SIP re-INVITE request according to 3GPP TS 24.229 [4], based upon the parameters already negotiated for the pre-established session; and\n6)\tshall send the SIP 200 (OK) response towards the participating MCPTT function according to rules and procedures of 3GPP TS 24.229 [4].\nOn call release by interaction with the media plane as specified in clause 9.2.2 of 3GPP TS 24.380 [5], if the sent SIP REFER request was a request for an MCPTT emergency private call, the MCPTT client shall perform the procedures specified in clause 6.2.8.1.18.\nThe MCPTT client shall follow the procedures for termination of multimedia sessions as specified in clause 11.1.1.2.1.2 with the following clarifications:\n1)\tif the MCPTT client is targeted for a new MCPTT emergency private call, the MCPTT client receives a SIP INVITE with an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind> set to a value of \"true\";\n2)\tif the MCPTT client is targeted for a new normal priority MCPTT private call, the MCPTT client receives a SIP re-INVITE request rather than a SIP INVITE request; or\n3)\tif the MCPTT client is targeted for a new MCPTT first-to-answer call, the MCPTT client receives a initial SIP INVITE request.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"private\" or \"first-to-answer\", the participating MCPTT function:\n1)\tmay reject the SIP INVITE request depending on the value of the Resource-Priority header field if the Resource-Priority header field is included in the received SIP INVITE request according to rules and procedures specified in IETF RFC 4412 [29] and shall not continue with the rest of the steps;\n2)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\nNOTE 1:\tIf the received SIP INVITE request contains an emergency indication set to a value of \"true\", the participating MCPTT function can choose to accept the request.\nNOTE 2:\tIf the received SIP INVITE request contains an emergency indication set to a value of \"true\", the participating MCPTT function can choose to allow an exception to the limit on the number of private calls and accept the request.\n3)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 3:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n4)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n5)\tshall:\na)\tif the <session-type> is set to \"private\", determine that the call is a private call; and\nb)\tif the <session-type> is set to \"first-to-answer\", determine that the call is a first-to-answer-call;\n6)\tif the call is a:\na)\tprivate call, determine the public service identity of the controlling MCPTT function for the private call service associated with the originating user's MCPTT ID identity; or\nb)\tfirst-to-answer, determine the public service identity of the controlling MCPTT function for the first-to-answer call service associated with the originating user's MCPTT ID identity;\nNOTE 4:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 5:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 6:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 7:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the private call service or first-to-answer call service associated with the originating user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 8:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n7)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the private call service or first-to-answer call service associated with the originating user's MCPTT ID identity, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n8)\tif the incoming SIP INVITE request does not contain an application/resource-lists+xml MIME body, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n9)\tif the call is a private call and the incoming SIP INVITE request contains an application/resource-lists+xml MIME body with more than one <entry> element in one or more <list> elements in the <resource-lists> element, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n10)\tif the <allow-private-call> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to initiate private calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response, with warning text set to \"107 user not authorised to make private calls\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n11)\tif the call is a private call and:\na)\tif the received SIP INVITE request includes an Answer-Mode header field as specified in IETF RFC 5373 [18] with the value \"Auto\" and the <allow-automatic-commencement> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]) indicating that the user identified by the MCPTT ID is not authorised to initiate private call with automatic commencement, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"125 user not authorised to make private call with automatic commencement\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nb)\tif the received SIP INVITE request includes an Answer-Mode header field as specified in IETF RFC 5373 [18] with the value \"Manual\" and the <allow-manual-commencement> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to initiate private call with manual commencement, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"126 user not authorised to make private call with manual commencement\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nc)\tif the received SIP INVITE request contains a <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and the originating participating MCPTT function has no cached mapping of the MCPTT ID of the transferred user and the MCPTT ID of the transfer target, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"170 user not authorised to make a private call transfer request\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\nd)\tif the received SIP INVITE request contains a <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and the originating participating MCPTT function has no cached mapping of the MCPTT ID of the forwarded user and the MCPTT ID of the target MCPTT user, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"173 user not authorised to make a private call forwarding request\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps; and\ne)\tif:\ni)\tthe received SIP INVITE request contains no <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, or if the received SIP INVITE request contains a <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the value is set to \"false\";\nii)\tif the received SIP INVITE request contains no <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, or if the received SIP INVITE request contains a <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the value is set to \"false\"; and\niii) if the received SIP INVITE request contains no <call-to-functional-alias-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, or if the received SIP INVITE request contains a <call-to-functional-alias-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the value is set to\"false\":\nthen:\ni)\tif the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\nA)\tif the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body does not match with any of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nB)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\nA)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"144 user not authorised to call this particular user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n11A)\tif the call is a first-to-answer call and:\na)\tif the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document or is set to a value of \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"156 user not authorised to originate a first-to-answer call\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n12)\tif the call is a first-to-answer call and if the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif:\ni)\tthe \"uri\" attribute of each and every <entry> element in a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body does not match with any of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nii)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\ni)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"153 user not authorised to call any of the users requested in the first-to-answer call\" in a Warning header field as specified in c clause 4.4 and shall not continue with the rest of the steps;\n13)\tif the call is a first-to-answer call or a private call, the received SIP INVITE request contains the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyEXT> element with the <call-to-functional-alias-ind> element set to \"true\" and the <functional-alias-URI> element, and the <ListOfAllowedFAsToCall> element exists with one or more <entry> elements within the entry of the FunctionalAliasList element corresponding to the calling <functional-alias-URI> in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif the \"uri\" attribute of the <entry> element in a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body does not match with any of the <entry> elements of the <ListOfAllowedFAsToCall> element of the entry within the FunctionalAliasList element corresponding to the calling <functional-alias-URI> of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"171 functional alias not allowed to call this particular functional alias\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n14)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the \"SIP INVITE request for originating participating MCPTT function\" shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n15)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.3 with the following clarifications:\na)\tif the call is a first-to-answer call and if the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]), then only the <entry> elements in a <list> element of the <resource-lists> element of the application/resource-lists MIME+xml body that have a \"uri\" attribute that matched with an <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) are included in the application/resource-lists+xml MIME body and the <session-type> is set to \"first-to-answer\" in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request generated in clause 6.3.2.1.3;\n16)\tshall set the Request-URI to the public service identity of the controlling MCPTT function as determined by step 6);\n17)\tshall set the <mcptt-calling-user-id> element in an application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the MCPTT ID of the calling user;\n18)\tif the call is a private call and:\na)\tif a Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was received in the incoming SIP INVITE request with a value of \"Manual\", shall not include a Priv-Answer-Mode header field in the outgoing SIP INVITE request;\nb)\tif the <allow-force-auto-answer> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), and the Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was received in the incoming SIP INVITE request with a value of \"Auto\", shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"143 not authorised to force auto answer\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nc)\tif the <allow-force-auto-answer> element of the <ruleset> element is present in the MCPTT user profile document with the value \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function, and the Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was received in the incoming SIP INVITE request with a value of \"Auto\", shall include the Priv-Answer-Mode header field set to a value of \"Auto\" in the outgoing SIP INVITE request;\nd)\tif a Priv-Answer-Mode header field containing the value of \"Auto\" has not been included in the outgoing SIP INVITE request as specified in step 17) above and the incoming \"SIP INVITE request for originating participating MCPTT function\" contained an Answer-Mode header field as specified in IETF RFC 5373 [18], then shall populate the Answer-Mode header field of the outgoing SIP INVITE request with the contents of the Answer-Mode header field from the incoming \"SIP INVITE request for originating participating MCPTT function\";\n19)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received \"SIP INVITE request for originating participating MCPTT function\", as specified in clause 6.3.2.1.1.1;\n19a)\tif the received SIP INVITE request contains the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyEXT> element with the <functional-alias-URI> element, then shall check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then the participating MCPTT function shall set the <functional-alias-URI> element of the <anyEXT> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request to the received value, otherwise shall not include a <functional-alias-URI> element;\nNOTE 9:\tThe participating MCPTT server learns the functional alias state for an MCPTT ID from procedures specified in clause 9A.2.2.2.7.\n20)\tshall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field if included in the SIP INVITE request from the MCPTT client;\n21)\tif, according to clause 6.4, the SIP INVITE request is regarded as being received with an implicit request to grant the floor to the originating MCPTT client, the participating MCPTT function:\nif:\na)\tthe incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the originating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n22)\tshall forward the SIP INVITE request, according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 180 (Ringing) response, the participating MCPTT function:\n1)\tshall generate a SIP 180 (Ringing) response to the SIP INVITE request as specified in the clause 6.3.2.1.5.1;\n2)\tshall include a P-Asserted-Identity header field in the outgoing SIP 180 (Ringing) response set to the public service identity of the participating MCPTT function;\n\n3)\tshall include Warning header field(s) received in the incoming SIP 180 (Ringing) response; and\n4)\tshall send the SIP 180 (Ringing) response to the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tshall include Warning header field(s) received in the incoming SIP 200 (OK) response;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n5)\tshall include an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response;\n5A)\tshall include the answer state into the P-Answer-State header field of the outgoing SIP 200 (OK) response, if received in the P-Answer-State header field of the incoming SIP 200 (OK) response;\n6)\tshall send the SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4];\n7)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n8)\tshall start the SIP session timer according to rules and procedures of IETF RFC 4028 [7].\nThe participating MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header field containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing one or more <entry> element(s) in one or more <list> elements in the <resource-lists> element, where the <entry> element contains a \"uri\" attribute containing a SIP URI set to the MCPTT ID of the called user(s);\n2)\tan hname body\" parameter in the headers portion of the SIP URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"private\" or \"first-to-answer\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP REFER request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\nNOTE 1:\tIf the application/vnd.3gpp.mcptt-info MIME body included in the SIP REFER request as described at the top of the present clause contains an <emergency-ind> element or <imminentperil-ind> element set to a value of \"true\", and this is an authorised request for originating a priority call as determined by clause 6.3.2.1.8.1, the participating MCPTT function can according to local policy choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif the received SIP REFER request does not contain an application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n5)\tif the received SIP REFER request contains an application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field with more than one <entry> element in a one or more <list> elements in the <resource-lists> element each with an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element:\na)\tnot set to \"first-to-answer\", shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps; or\nb)\tset to \"first-to-answer\", determine that the call is a first-to-answer call;\n6)\tif the received SIP REFER request contains an application/resource-lists MIME body referenced by a \"cid\" URL in the Refer-To header field with only one <entry> element with an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element:\na)\tnot set to \"private\", shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps; or\nb)\tset to \"private\", determine that the call is a private call;\n7)\tif the call is a:\na)\tprivate call, shall determine the public service identity of the controlling MCPTT function for the private call service associated with the originating user's MCPTT ID; or\nb)\tfirst-to-answer call, shall determine the public service identity of the controlling MCPTT function for the first-to-answer call service associated with the originating user's MCPTT ID;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the private call service or first-to-answer call service associated with the originating user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n8)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the private call service or first-to-answer call service associated with the originating user's MCPTT ID, it shall reject the REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n9)\tif the <allow-private-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function or is present with the value \"false\", indicating that the user identified by the MCPTT ID is not authorised to initiate private calls, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response to the SIP REFER request, with warning text set to \"107 user not authorised to make private calls\" in a Warning header field as specified in clause 4.4;\n10)\tif the call is a private call:\na)\tif the received SIP REFER request includes an Answer-Mode header field as specified in IETF RFC 5373 [18] set to \"Auto\" contained in the headers portion of the SIP URI present in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, and the <allow-automatic-commencement> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function or is present with the value \"false\" (indicating that the user identified by the MCPTT ID is not authorised to initiate private call with automatic commencement), shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"125 user not authorised to make private call with automatic commencement\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nb)\tif the received SIP REFER request includes an Answer-Mode header field as specified in IETF RFC 5373 [18] set to \"Manual\" contained in the headers portion of the SIP URI present in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, and the <allow-manual-commencement> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function or is present with the value \"false\" (indicating that the user identified by the MCPTT ID is not authorised to initiate private call with manual commencement), shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"126 user not authorised to make private call with manual commencement\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nc)\tif the <allow-force-auto-answer> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function or is present with the value \"false\", and the SIP REFER request contained a Priv-Answer-Mode header field as specified in IETF RFC 5373 [18] set to \"Auto\" in the headers portion of the SIP URI in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, shall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"143 not authorised to force auto answer\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nd)\tif the received SIP REFER request contains a <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and the originating participating MCPTT function has no cached mapping of the MCPTT ID of the transferred user and the MCPTT ID of the transfer target, shall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"170 user not authorised to make a private call transfer request\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\ne)\tif the received SIP REFER request contains a <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\" and the originating participating MCPTT function has no cached mapping of the MCPTT ID of the forwarded user and the MCPTT ID of the target MCPTT user, shall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"173 user not authorised to make a private call forwarding request\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps; and\nf)\tif:\ni)\tthe received SIP REFER request contains no <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, or if the received SIP REFER request contains a <call-transfer-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the value is set to \"false\"; and\nii)\tif the received SIP REFER request contains no <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, or if the received SIP REFER request contains a <call-forwarding-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the value is set to \"false\";\nthen:\ni)\tif the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\nA)\tif the SIP URI in a \"uri\" attribute of an <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field not match with a \"uri\" attribute of one of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nB)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\nA)\tshall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"144 user not authorised to call this particular user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n10A)\tif the call is a first-to-answer call and:\na)\tif the <allow-request-first-to-answer-call> element of the <ruleset> element is not present in the MCPTT user profile document or is set to a value of \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"156 user not authorised to originate a first-to-answer call\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n11)\tif the call is a first-to-answer call and if the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tthe \"uri\" attribute of each and every <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field does not match with the \"uri\" attribute of any of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nb)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\na)\tshall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"153 user not authorised to call any of the users requested in the first-to-answer call\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n12)\tif the call is a first-to-answer call or a private call, the received SIP REFER request contains the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyEXT> element with the <call-to-functional-alias-ind> element set to \"true\" and the <functional-alias-URI> element, the <ListOfAllowedFAsToCall> element exists with one or more <entry> elements within the entry of the FunctionalAliasList element corresponding to the calling <functional-alias-URI> in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field does not match with the \"uri\" attribute of any of the <entry> elements of the <ListOfAllowedFAsToCall> element of the entry within the FunctionalAliasList element corresponding to the calling <functional-alias-URI> of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshall reject the \"SIP REFER request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"171 functional alias not allowed to call this particular functional alias\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n13)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\n14)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP TS 24.229 [4];\nNOTE 7:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n15)\tif the URI of the functional alias to be called is included in the application/resource-lists+xml MIME body of the SIP REFER request, shall wait for the receipt of a SIP response to the SIP INVITE request that will be generated in step 16) and sent in step 20). Otherwise, shall send the response to the \"SIP REFER request for a pre-established session\" towards the MCPTT client according to 3GPP TS 24.229 [4];\n16)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.4 with the following clarifications:\na)\tif the call is a first-to-answer call and if the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]), then only the <entry> elements of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body that have a \"uri\" attribute that matched with the \"uri\" attribute of an <entry> element of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) are included in the application/resource-lists+xml MIME body and the <session-type> is set to \"first-to-answer\" in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request generated in clause 6.3.2.1.4;\n17)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the controlling MCPTT function as determined above in step 7);\n18)\tif the call is a private call:\na)\tif the SIP REFER request contained a Priv-Answer-Mode header field as specified in IETF RFC 5373 [18] set to \"Manual\" in the headers portion of the SIP URI in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, shall copy the Priv-Answer-Mode header field from the incoming SIP REFER request to the outgoing SIP INVITE request;\nb)\tif the <allow-force-auto-answer> element of the <ruleset> element is present in the MCPTT user profile document with the value \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function, and the Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was received in the headers portion of the SIP URI in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, with a value set to \"Auto\", shall copy the Priv-Answer-Mode header field to the outgoing SIP INVITE request; and\nc)\tif a Priv-Answer-Mode header field containing the value of \"Auto\" has not been copied to the outgoing SIP INVITE request as specified in step 16) above, and the incoming SIP REFER request contained an Answer-Mode header field in the headers portion of the SIP URI in the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, then copy the Answer-Mode header field to the outgoing SIP INVITE request;\n19)\tif the received SIP REFER request contained a Resource-Priority header field, shall include in the outgoing SIP INVITE request a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request;\nNOTE 8:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n19a)\tif the call is a private call and if the received SIP REFER request contains the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyEXT> element with the <functional-alias-URI> element, then shall check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then the participating MCPTT function shall set the <functional-alias-URI> element of the <anyEXT> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request to the received value, otherwise shall not include a <functional-alias-URI> element;\n19b) if, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n20)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving SIP provisional responses for the SIP INVITE request, the participating MCPTT function:\n1)\tshall discard the received SIP responses without forwarding them.\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, the participating MCPTT function:\n1)\tif:\na)\tthe received SIP 2xx response was in response to a request for an MCPTT private call; or\nb)\tthe received SIP 2xx response was in response to a SIP INVITE request for a first-to-answer call which did not include an a=key-mgmt \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE in the SDP answer;\nthen:\na)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tif the received SIP 2xx response was in response to a request for an MCPTT emergency private call and does not contain a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\":\na)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.6;\nb)\tshall send the SIP re-INVITE request towards the MCPTT client within the pre-established session according to 3GPP TS 24.229 [4]; and\nc)\tif the received SIP 2xx response was in response to a request for a first-to-answer call, upon receipt of a SIP 2xx response to the SIP re-INVITE, shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n3)\tif the received SIP 2xx response was in response to a SIP INVITE request for a first-to-answer call which was not a request for an MCPTT emergency private call and contains an SDP answer including an a=key-mgmt \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE, the participating MCPTT function:\na)\tshall generate a SIP re-INVITE request as specified in clause 6.3.2.1.8.7;\nb)\tshall send the SIP re-INVITE request towards the originating MCPTT client according to 3GPP TS 24.229 [4]; and\nc)\tupon receipt of a SIP 2xx response to the SIP re-INVITE, shall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving a SIP INFO request from the controlling MCPTT function within the dialog of the SIP INVITE request for an MCPTT emergency private call, the participating MCPTT function shall:\n1)\tshall send a SIP 200 (OK) response to the SIP INFO request to the controlling MCPTT function as specified in 3GPP TS 24.229 [4];\n2)\tshall generate a SIP re-INVITE request to be sent towards the MCPTT client within the pre-established session as specified in clause 6.3.2.1.8.6; and\n3)\tshall send the SIP re-INVITE request the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 300 (Multiple Choices), SIP 4xx, 5xx or 6xx response to the above SIP INVITE request in step 20), the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n2)\tif the generated final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" has not yet been sent in step 15), shall forward the received SIP response.\n\nThis clause covers both on-demand session and pre-established sessions.\nUpon receipt of a SIP re-INVITE request for an existing MCPTT private call session the participating MCPTT function:\n1)\tmay reject the SIP re-INVITE request depending on the value of the Resource-Priority header field if the Resource-Priority header field is included in the received SIP re-INVITE request according to rules and procedures specified in IETF RFC 4412 [29] and skip the rest of the steps;\n2)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24];\nNOTE 1:\tIf the SIP re-INVITE request contains an emergency indication, the participating MCPTT function can choose to accept the request.\n3)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP re-INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the SIP re-INVITE request shall reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\nNOTE 3:\tIf the received SIP re-INVITE request is received within a pre-established session, associated with an MCPTT private call, the media-level section for the offered MCPTT speech media stream and the media-level section of the offered media-floor control entity are expected to be the same as was negotiated in the existing pre-established session.\n5)\tshall generate a SIP re-INVITE request as specified in clause 6.3.2.1.9;\n6)\tshall set the <mcptt-calling-user-id> element in an application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request to the MCPTT ID of the calling user;\n6a)\tif the received SIP re-INVITE request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, then shall check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then the participating MCPTT function shall set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP re-INVITE request to the received value, otherwise shall not include a <functional-alias-URI> element;\n7)\tshall, if the SIP re-INVITE request was received within an on-demand session include in the SIP re-INVITE request an SDP containing the current media parameters used by the existing session;\n8)\tshall, if the SIP re-INVITE request was received within a pre-established session, include in the SIP re-INVITE request an SDP offer based upon the previously negotiated SDP for the pre-established session as specified in clause 6.3.2.1.1.2;\n9)\tshall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field if included in the SIP re-INVITE request from the MCPTT client; and\n10)\tshall forward the SIP re-INVITE request, according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tif the SIP 200 (OK) response is to be sent within an on-demand session shall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tif the SIP 200 (OK) response is to be sent within a pre-established session shall include in the SIP 200 (OK) response an SDP answer based upon the previously negotiated SDP for the pre-established session;\n4)\tshall include Warning header field(s) received in the incoming SIP 200 (OK) response;\n5)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n6)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4]; and\n7)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nThe participating MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nThis clause covers both on demand session and pre-established session.\nIn the procedure in this clause a private call requested by an MCPTT user refers to a private call:\n1)\twith no <call-transfer-ind> element present in the application/vnd.3gpp.mcptt-info+xml MIME body element or with a <call-transfer-ind> element present in the application/vnd.3gpp.mcptt-info+xml MIME body element and the value is set to \"false\"; and\n2)\twith no <call-forwarding-ind> element present in the application/vnd.3gpp.mcptt-info+xml MIME body element or with a <call-forwarding-ind> element present in the application/vnd.3gpp.mcptt-info+xml MIME body element and the value is set to \"false\".\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24], and shall not continue with the rest of the steps;\nNOTE:\tIf the received SIP INVITE request contains an emergency indication set to a value of \"true\", the participating MCPTT function can choose to accept the request.\n2)\tshall check the presence of the isfocus media feature tag in the Contact header field and if it is not present then the participating MCPTT function shall reject the request with a SIP 403 (Forbidden) response with the warning text set to \"104 isfocus not assigned\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n3)\tvoid;\n4)\tif :\na)\tthe <allow-call-forwarding> element exists in the MCPTT user profile document, and the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nb)\tthe <call-forwarding-on> element exists in the MCPTT user profile document and the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nc)\tthe <call-forwarding-condition> element exists in the MCPTT user profile document, and the value is set to \"immediate\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tif the <forwarding-immediate-list> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request exists, shall check if the number of maximum immediate private call forwardings as specified in the <max-immediate-forwardings> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) has been reached. If reached, the MCPTT server shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"174 maximum number of allowed forwardings exceeded\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\nb)\tshall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" in a Warning header field as specified in clause 4.4;\nc)\tshall generate a SIP MESSAGE request as described in clause 6.3.2.6 to trigger the call forwarding of a private call and shall include in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body:\ni)\t a <forwarding-reason> element set to a value of \"immediate\";\nd)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4]; and\ne)\tupon receipt of SIP 2xx response to the outgoing SIP MESSAGE requests, the participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4] and shall skip the rest of the steps;\n4a)\tif the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body is marked as migrated to a partner system then the following steps shall be performed:\na)\tshall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 480 (Temporarily Unavailable) response including warning text set to \"x call forwarding due to migration \" in a Warning header field as specified in clause 4.4;\nb)\tshall generate a SIP MESSAGE request as described in clause 6.3.2.6 to trigger the call forwarding of a private call and shall include in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body with the following clarification:\ni)\ta <forwarding-reason> element set to a value of \"migrated\";\nii)\ta <forwarding-target-orig-id> element set to the MCPTT ID in the partner system bound to the primary MCPTT ID at the migration authorization; and\niii)\tmay include a <PrivateCallKMSURI> element set to the value of the KMS URI associated with the MCPTT ID in the partner MCPTT system of the migrated MCPTT user;\nc)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4]; and\nd)\tupon receipt of SIP 2xx response to the outgoing SIP MESSAGE requests, the participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4] and shall skip the rest of the steps;\n5)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request to retrieve the binding between the MCPTT ID and public user identity;\n6)\tif the binding between the MCPTT ID and public user identity does not exist and if the <allow-call-forwarding> element exists in the MCPTT user profile document, and the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and if the <call-forwarding-on> element exists in the MCPTT user profile document, and the value is set to \"true\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and if the <call-forwarding-condition> element exists in the MCPTT user profile document, and the value is set to \"no-answer\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]):\na)\tif the incoming SIP INVITE request contains a <forwarding-other-list> element with one or more <entry> elements the MCPTT server shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"174 maximum number of allowed forwardings exceeded\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\nb)\tshall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 480 (Temporarily Unavailable) response including warning text set to \"175 call is forwarded\" in a Warning header field as specified in clause 4.4;\nc)\tshall generate a SIP MESSAGE request as described in clause 6.3.2.6 to trigger the call forwarding of a private call and shall include in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body:\ni)\ta <forwarding-reason> element to a value of \"no-answer\";\nd)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4]; and\ne)\tUpon receipt of SIP 2xx response to the outgoing SIP MESSAGE requests, the participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4] and shall skip the rest of the steps;\n7)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n7a)\tif the <session-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body is set to \"private\" and the Answer-Mode Indication in the application/poc-settings+xml MIME body has not yet been received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4, shall reject the request with a SIP 480 (Temporarily Unavailable) response with the warning text set to \"146 T-PF unable to determine the service settings for the called user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n8)\tif the call is a private call requested by an MCPTT user and if the called user identified by the MCPTT ID is unable to participate in private calls as identified in the called user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the terminating participating MCPTT function, shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"127 user not authorised to be called in private call\" in a Warning header field as specified in clause 4.4;\n9)\tif the call is a private call requested by an MCPTT user and if the <session-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body is set to \"private\" and if the <IncomingPrivateCallList> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request does not match with one of the <entry> elements of the <IncomingPrivateCallList> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nb)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to receive a private call by users not contained within the <entry> elements of the <IncomingPrivateCallList> element;\nthen:\na)\tshall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"159 user not authorised to be called by this originating user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n10)\tif the call is a first-to-answer call or a private call, the received SIP INVITE request contains the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyExt> element with the <call-to-functional-alias-ind> element set to \"true\", the <called-functional-alias-URI> element, and a <functional-alias-URI> element, and the <ListOfAllowedFAsToBeCalledFrom> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif the functional-alias-URI> element of the <anyEXT> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request does not match with any of the <entry> elements of the <ListOfAllowedFAsToBeCalledFrom> element of the entry within the FunctionalAliasList element corresponding to the called functional alias of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"172 functional alias not allowed to be called from this functional alias\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n11)\tif necessary, shall start timer TNP1 (call forwarding no answer timer) according to the conditions stated in clause 6.3.2.5. If the procedures in clause 6.3.2.5 results in a call forwarding, skip the rest of the steps in this clause.\n12)\tshall perform the automatic commencement procedures specified in clause 6.3.2.2.5.1 and according to IETF RFC 5373 [18] if one of the following conditions are met:\na)\t\"SIP INVITE request for terminating participating MCPTT function\" contains an Answer-Mode header field with the value \"Auto\";\nb)\t\"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\"; or\nc)\t\"SIP INVITE request for terminating participating MCPTT function\" contains a Priv-Answer-Mode header field with the value \"Auto\"; and\n13)\tshall perform the manual commencement procedures specified in clause 6.3.2.2.6.1 and according to IETF RFC 5373 [18] if either of the following conditions are met:\na)\t\"SIP INVITE request for terminating participating MCPTT function\" contains an Answer-Mode header field with the value \"Manual\";\nb)\t\"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"manual-answer\"; or\nc)\t\"SIP INVITE request for terminating participating MCPTT function\" contains a Priv-Answer-Mode header field with the value \"Manual\".\nThis clause covers the on-demand session case only.\nUpon receipt of a SIP re-INVITE request for an existing MCPTT private call session the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tIf the SIP re-INVITE request contains an emergency indication, the participating MCPTT function can choose to accept the request.\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP re-INVITE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP re-INVITE request with a SIP 404 (Not Found) response and skip the rest of the steps;\n4)\tshall generate a SIP re-INVITE as specified in clause 6.3.2.2.10;\nNOTE 2:\tAs this is the modification of an in-progress MCPTT private call, this procedure does not attempt modification of the existing answer-mode of the call.\n5)\tshall include in the SIP re-INVITE request an SDP offer containing the current media parameters used by the existing session; and\n6)\tshall send the SIP re-INVITE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving the SIP 200 (OK) response to the SIP re-INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as described in the clause 6.3.2.2.4.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer based on the SDP answer in the received SIP 200 (OK) response as specified in clause 6.3.2.2.2.1;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n5)\tshall forward the SIP 200 (OK) response according to 3GPP TS 24.229 [4].\nThe participating MCPTT function shall forward any other SIP response that does not contain SDP along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 11.1.1.4.2\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\nNOTE 1:\tAs a result of calling clause 6.3.3.1.2, the <mcptt-calling-user-id> containing the calling user's MCPTT ID is copied into the outgoing SIP INVITE.\n2)\tif the received SIP INVITE request contains an authorised request for an MCPTT emergency private call as determined by clause 6.3.3.1.13.2:\na)\tshall set the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nb)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, perform the procedures specified in clause 6.3.3.1.12; and\nc)\tif the received SIP INVITE request did not contain an alert indication or contains an alert indication set to a value of \"true\" and is not an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";\n3)\tif the received SIP INVITE request contained a <session-type> element in an application/vnd.3gpp.mcptt-info+xml MIME body set to \"first-to-answer\" shall include in the SIP INVITE request a Priv-Answer-Mode header field with the value \"Manual\" according to the rules and procedures of IETF RFC 5373 [18];\n4)\tshall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP INVITE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request;\n5)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user to be invited;\nNOTE 2:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the MCPTT user to be invited or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the controlling MCPTT function;\n7)\tshall include a Resource-Priority header field populated with the values for an MCPTT emergency private call as specified in clause 6.3.3.1.19, if either of the following conditions is met:\na)\tif the received SIP INVITE request contains an authorised request for an MCPTT emergency private call as determined in step 2 above; or\nb)\tthe originating MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user;\n8)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1;\n9)\tshall send the SIP INVITE request towards the core network according to 3GPP TS 24.229 [4]; and\n10)\tshall start a private call timer with a value set to the configured max private call duration for the user.\nUpon receiving a SIP 183 (Session Progress) response to the SIP INVITE request containing a Require header field with the option tag \"100rel\" and a P-Answer-State header field with the value \"Unconfirmed\" in response, the controlling MCPTT function:\n1)\tshall send a SIP PRACK request towards the terminating network according to 3GPP TS 24.229 [4].\nUpon receiving SIP 200 (OK) response for the SIP INVITE request the controlling MCPTT function:\n1)\tshall cache the contact received in the Contact header field; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon expiry of the private call timer, the controlling MCPTT function shall follow the procedure for releasing private call session as specified in clause 11.1.4.4.\nIn the procedures in this clause:\n1)\t<emergency–ind> refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\n2)\t<alert–ind> refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n3)\t<session-type> refers to the <session-type> element of an application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of:\n-\ta \"SIP INVITE request for controlling MCPTT function of a private call\"; or\n-\ta \"SIP INVITE request for controlling MCPTT function of a first-to-answer call\";\nthe controlling MCPTT function:\n1)\tif the <session-type> in the SIP INVITE request is set to \"private\":\na)\tshall check whether the public service identity contained in the Request-URI is allocated for private call and perform the actions specified in clause 6.3.7.1 if it is not allocated and skip the rest of the steps; and\nb)\tshall perform actions to verify the MCPTT ID of the inviting MCPTT user in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request, and authorise the request according to local policy, and if it is not authorised the controlling MCPTT function shall return a SIP 403 (Forbidden) response with the warning text as specified in \"Warning header field\" and skip the rest of the steps;\n2)\tif the <session-type> in the SIP INVITE request is set to \"first-to-answer\" shall check whether the public service identity contained in the Request-URI is allocated for first-to-answer call and perform the actions specified in clause 6.3.7.1 if it is not allocated and skip the rest of the steps;\n3)\tif the incoming SIP INVITE request does not contain an application/resource-lists+xml MIME body shall reject the SIP INVITE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tif the <session-type> is set to \"private\" and the application/resource-lists+xml MIME body contains more than one <entry> element in a <list> element of the <resource-lists> element, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n5)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec or media format is acceptable by the controlling MCPTT function and if not, reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n6)\tif received SIP INVITE request includes an <emergency-ind>, shall validate the request as described in clause 6.3.3.1.17;\n7)\tif the received SIP INVITE request contains an unauthorised request for an MCPTT emergency private call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n8)\tif a Resource-Priority header field is included in the received SIP INVITE request and if the Resource-Priority header field is set to the value indicated for emergency calls, shall reject the SIP INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps if neither one of the following conditions are true:\na)\tthe SIP INVITE request does not contain an authorised request for an MCPTT emergency call as determined in step 7 above; or\nb)\tthe originating MCPTT user is not in an in-progress emergency private call state with the targeted MCPTT user;\n8a)\tif the <session-type> in the received SIP INVITE request is set to \"private\" and if the SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyExt> element with the <call-to-functional-alias-ind> element set to a value of \"true\":\na)\tshall identify the MCPTT ID(s) of the MCPTT user(s) that have activated the received called functional alias in the application/resource-lists+xml MIME body of the SIP INVITE request by performing the actions specified in clause 9A.2.2.2.8;\nb)\tif unable to determine any MCPTT ID that has activated the received called functional alias in the application/resource-lists+xml MIME body of the SIP INVITE request, shall reject the \"SIP INVITE request for controlling MCPTT function of a private call\" with a SIP 403 (Forbidden) response including a warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps; and\nc)\tselects one of the identified MCPTT IDs, and shall send a SIP 300 (Multiple Choices) response to the \"SIP INVITE request for controlling MCPTT function of a private call\" populated according to 3GPP TS 24.229 [4], IETF RFC 3261 [24] with:\nA)\ta Contact header field containing a SIP URI for the MCPTT session identity; and\nB)\tan application/vnd.3gpp.mcptt-info MIME body with an <mcptt-request-uri> element set to the selected MCPTT ID and shall not continue with the rest of the steps in this clause;\nNOTE 1:\tHow the controlling MCPTT function selects the appropriate MCPTT ID is implementation-specific.\n9)\tif:\na)\tthe received SIP INVITE request contains an emergency indication set to a value of \"true\";\nb)\tthe originating MCPTT user is not in an in-progress emergency private call state with the targeted MCPTT user; and\nc)\tthe <session-type> in the SIP INVITE request is set to \"private\";\nthen:\na)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency private call to the targeted user; and\nb)\tshall cache the information that the MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user;\n10)\tshall perform actions as described in clause 6.3.3.2.2;\n11)\tshall allocate an MCPTT session identity for the MCPTT session;\n12)\tif the <session-type> in the received SIP INVITE request is set to \"first-to-answer\" and if the SIP INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing the <anyExt> element with the <call-to-functional-alias-ind> element set to a value of \"true\":\na)\tshall identify the MCPTT ID(s) of the MCPTT user(s) that have activated the received called functional alias in the application/resource-lists+xml MIME body of the SIP INVITE request by performing the actions specified in clause 9A.2.2.2.8;\nb)\tif unable to determine any MCPTT ID that has activated the received called functional alias in the application/resource-lists+xml MIME body of the SIP INVITE, shall reject the \"SIP INVITE request for controlling MCPTT function of a private call\" with a SIP 403 (Forbidden) response including a warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\nc)\tshall copy the URI of the functional alias to be called listed in the application/resource-lists+xml MIME body of the incoming SIP INVITE request, into the <called-functional-alias-URI> element of the <anyEXT> element of the <mcptt-Params> element of the <mcpttinfo> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nd)\tshall invite the identified MCPTT ID(s) as specified in clause 11.1.1.4.1;\notherwise shall invite the MCPTT user(s) listed in the application/resource-lists+xml MIME body of received SIP INVITE request as specified in clause 11.1.1.4.1; and\n13)\tif the <session-type> in the received SIP INVITE request is set to \"private\", shall invite the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP INVITE request as specified in clause 11.1.1.4.1.\nUpon receiving a SIP 180 (Ringing) response and if the SIP 180 (Ringing) response or the SIP final response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tif the SIP 180 (Ringing) response is associated with a SIP INVITE that contained a <session-type> set to \"private\", shall generate a SIP 180 (Ringing) response to the SIP INVITE request and send the SIP 180 (Ringing) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4]; and\n2)\tif the SIP 180 (Ringing) response is associated with a SIP INVITE that contained a <session-type> set to \"first-to-answer\", and no other SIP 180 (Ringing) responses have been received that are associated with a SIP INVITE that contained a <session-type> set to \"first-to-answer\", shall generate a SIP 183 (Session Progress) response to the SIP INVITE request and send the SIP 183 (Session Progress) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response to the SIP INVITE request specified in clause 11.1.1.4.1 containing a P-Answer-State header field with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], if the <session-type> in the SIP INVITE request is set to \"private\", the controlling MCPTT function supports media buffering and the SIP final response is not yet sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to SIP INVITE request as specified in the clause 6.3.3.2.3.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tshall include a P-Answer-State header field with the value \"Unconfirmed\";\n4)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 2:\tThis is the case when the MCPTT user's request for an MCPTT emergency private call was granted but the request for the MCPTT emergency alert was denied.\n5)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n6)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, the SIP dialog was established as a result of receiving a SIP INVITE request with a <session-type> element set to the value of \"private\" and the SIP final response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 3:\tThis is the case when the MCPTT user's request for an MCPTT emergency private call was granted but the request for the MCPTT emergency alert was denied.\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\nNOTE 4:\tResulting media plane processing is completed before the next step is performed.\n5)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, the SIP dialog was established as a result of receiving a SIP INVITE request with a <session-type> element set to the value of \"first-to-answer\" and the SIP final response has not yet been sent to the inviting MCPTT client the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tthe received SIP INVITE request contains an emergency indication set to a value of \"true\":\na)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency private call to the targeted user; and\nb)\tshall cache the information that the MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user;\n4)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4;\nNOTE 5:\tThis is the case when the MCPTT user's request for an MCPTT emergency private call was granted but the request for the MCPTT emergency alert was denied.\n5)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element containing an <mcptt-called-party-id> element set to the MCPTT ID that was sent in the corresponding SIP INVITE request;\n6)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\nNOTE 6:\tResulting media plane processing is completed before the next step is performed.\n7)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n8)\tfor all other MCPTT clients that were invited due to the controlling MCPTT function receiving a SIP INVITE request with a <session-type> element set to the value of \"first-to-answer\":\na)\tshall send a SIP BYE request to release a SIP dialog that has been established since the SIP 200 (OK) response was sent in step6) by following the procedures in clause 6.3.3.1.5 with the clarification that the SIP BYE request contain an application/vnd.3gpp.mcptt-info+xml MIME body including a <release-reason> element set to a value of \"not selected for call\";\nb)\tshall generate and send a SIP CANCEL request according SIP IETF RFC 3261 [24], to cancel a SIP dialog that has not yet been established since the SIP 200 (OK) response was sent in step 6);\nc)\ton receiving a SIP 200 (OK) to a SIP CANCEL request, shall wait to receive a SIP 487 (Request Terminated) to the original SIP INVITE request sent to the client; and\nd)\tif a SIP 487 (Request Terminated) from the MCPTT client is not received within a time determined by the MCPTT server implementation, shall send a SIP BYE towards the MCPTT client by following the procedures in clause 6.3.3.1.5 with the clarification that the SIP BYE request contain an application/vnd.3gpp.mcptt-info+xml MIME body including a <release-reason> element set to a value of \"not selected for call\"; and\n9)\tif not successful in cancelling or terminating SIP dialogs in step 7) above, may repeat the SIP CANCEL and SIP BYE requests.\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, where the SIP 200 (OK) response was sent with a Warning header field as specified in clause 4.4 with the warning text containing the mcptt-warn-code set to \"149\", the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nThe controlling MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nUpon receiving a SIP BYE request from the originating MCPTT client containing an application/vnd.3gpp.mcptt-info+xml MIME body containing a <release-reason> element set to a value of \"authentication of the MIKEY-SAKE I_MESSAGE failed\", the controlling MCPTT function:\n1)\tif the received \"SIP INVITE request for controlling MCPTT function of a first-to-answer call\" contains an emergency indication set to a value of \"true\":\na)\tshall delete from cache the information that the MCPTT user has initiated an MCPTT emergency private call to the targeted user; and\nb)\tshall delete from cache the information that the MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user; and\n2)\tshall follow the procedures in clause 11.1.3.3.1.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP re-INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\talert indication in an incoming SIP re-INVITE request refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receiving a SIP re-INVITE request with an emergency indication set to a value of \"true\", the controlling MCPTT function:\n1)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec or media format is acceptable by the controlling MCPTT function and if not, reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n2)\tshall validate the request as described in clause 6.3.3.1.17;\n3)\tif the SIP re-INVITE request contains an unauthorised request for an MCPTT emergency private call as determined by clause 6.3.3.1.13.2:\na)\tshall reject the SIP INVITE request with a SIP 403 (Forbidden) response as specified in clause 6.3.3.1.14; and\nb)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n4)\tif a Resource-Priority header field is included in the received SIP re-INVITE request and if the Resource-Priority header field is set to the value indicated for emergency calls, shall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response and skip the remaining steps if neither of the following conditions are true:\na)\tthe SIP re-INVITE request does contains an authorised request for an MCPTT emergency call as determined in step 2 above; or\nb)\tthe originating MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user;\n5)\tif the SIP re-INVITE request contains an emergency indication set to a value of \"true\" and the originating MCPTT user is not in an in-progress emergency private call state with the targeted MCPTT user:\na)\tshall cache the information that the MCPTT user is in an in-progress emergency private call state with the targeted MCPTT user; and\nb)\tif the SIP re-INVITE request contains an alert indication set to \"true\" and this is an authorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall cache the information that the MCPTT user has sent an MCPTT emergency alert to the targeted user; and\n6)\tshall send a SIP re-INVITE invite towards the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP re-INVITE request as specified in clause 11.1.1.4.5.\nUpon receiving a SIP 200 (OK) response for the SIP re-INVITE request and if the SIP response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP re-INVITE request as specified in the clause 6.3.3.2.3 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP re-INVITE request containing the current media parameters used by the existing session;\n3)\tif the received SIP re-INVITE request contains an alert indication set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4.\nNOTE:\tWhen a SIP 200 (OK) response sent to the originator as a response to a SIP INVITE request that contained authorised request(s) for an MCPTT emergency private call and optionally an MCPTT emergency alert, the originator will consider a SIP 200 (OK) response populated in this manner as confirmation that its request(s) for an upgrade to an MCPTT emergency private call and optionally an MCPTT emergency alert were accepted by the controlling function.\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n5)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18:\nThe controlling MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP INVITE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\talert indication in an incoming SIP INVITE request refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receiving a SIP re-INVITE request with an emergency indication set to a value of \"false\", the controlling MCPTT function:\n1)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec or media format is acceptable by the controlling MCPTT function and if not, reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n2)\tshall validate the request as described in clause 6.3.3.1.17;\n3)\tif the SIP re-INVITE request contains an unauthorised request for an MCPTT emergency private call cancellation as determined by clause 6.3.3.1.13.4:\na)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response;\nb)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in annex F.1 with an <emergency-ind> element set to a value of \"true\";\nc)\tif the SIP re-INVITE request contains an alert indication set to \"false\" and this is an unauthorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3, shall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element set to \"true; and\nd)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n4)\tshall reject the SIP re-INVITE request with a SIP 403 (Forbidden) response if a Resource-Priority header field is included in the received SIP re-INVITE request set to the value configured for emergency calls, and skip the remaining steps; and\n5\tif the SIP re-INVITE request contains an authorised request for an MCPTT emergency private call cancellation as determined by clause 6.3.3.1.13.4:\na)\tshall clear the cache of the MCPTT ID of the originator of the MCPTT emergency private call that is no longer in an in-progress emergency private call state with the targeted MCPTT user; and\nb)\tif the SIP re-INVITE request contains an alert indication set to \"false\" and this is an authorised request for an MCPTT emergency alert cancellation meeting the conditions specified in clause 6.3.3.1.13.3:\ni)\tif the received SIP re-INVITE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall clear the cache of the MCPTT ID of MCPTT user identified by the <originated-by> element as having an outstandingMCPTT emergency alert; and\nii)\tif the received SIP re-INVITE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the sender of the SIP re-INVITE request as having an outstanding MCPTT emergency alert;\n6)\tshall send a SIP re-INVITE request towards the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP re-INVITE request as specified in clause 11.1.1.4.6.\nUpon receiving a SIP 200 (OK) response for the SIP re-INVITE request and if the SIP response has not yet been sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP re-INVITE request as specified in the clause 6.3.3.2.3 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP re-INVITE request as specified in the clause 6.3.3.2.2;\n3)\tif the received SIP re-INVITE request contains an alert indication set to a value of \"false\" and this is an unauthorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3, shall include in the SIP 200 (OK) response the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4.\nNOTE:\tWhen a SIP 200 (OK) response sent to the originator as a response to a SIP INVITE request that contained authorised request(s) for an MCPTT emergency private call cancellation and optionally an MCPTT emergency alert cancellation, the originator will consider a SIP 200 (OK) response populated in this manner as confirmation that its request(s) for cancellation of an MCPTT emergency private call and optionally an MCPTT emergency alert were accepted by the controlling function.\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\n5)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP ACK to the SIP 200 (OK) response sent towards the inviting MCPTT client, and the SIP 200 (OK) response was sent with the warning text set to \"149 SIP INFO request pending\" in a Warning header field as specified in clause 4.4, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.18.\nThe controlling MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nThis clause describes the procedures for sending a re-INVITE request to an MCPTT user in an MCPTT private call for the purpose of upgrading the session to an emergency private call session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 11.1.1.4.3.\nThe controlling MCPTT function:\n1)\tshall generate a SIP re-INVITE request as specified in clause 6.3.3.1.9;\n2)\tif the received SIP re-INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing re-INVITE request;\n3)\tif the received SIP re-INVITE request contains an authorised request for an MCPTT emergency private call as determined by clause 6.3.3.1.13.2:\na)\tshall set the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\nb)\tif the received SIP INVITE request contains an alert indication set to a value of \"true\" and this is an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, perform the procedures specified in clause 6.3.3.1.12; and\nc)\tif the received SIP INVITE request did not contain an alert indication or contains an alert indication set to a value of \"true\" and is not an authorised request for an MCPTT emergency alert meeting the conditions specified in clause 6.3.3.1.13.1, shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";\n4)\tshall include a Resource-Priority header field populated with the values for an MCPTT emergency private call as specified in clause 6.3.3.1.19, if the received SIP re-INVITE request contains an authorised request for an MCPTT emergency private call as determined in step 2 above; and\n5)\tshall send the SIP re-INVITE request towards the core network according to 3GPP TS 24.229 [4].\nUpon receiving SIP 200 (OK) response for the SIP re-INVITE request the controlling MCPTT function:\n1)\tshall cache the contact received in the Contact header field.\nThis clause describes the procedures for sending a re-INVITE request to an MCPTT user in an MCPTT emergency private call for the purpose of downgrading the session to a normal priority private call session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 11.1.1.4.4.\nThe controlling MCPTT function:\n1)\tshall generate a SIP re-INVITE request as specified in clause 6.3.3.1.9;\n2)\tif the received SIP re-INVITE request contained an application/vnd.3gpp.mcptt-info+xml MIME body, shall copy the application/vnd.3gpp.mcptt-info+xml MIME body to the outgoing re-INVITE request.\n3)\tif the received SIP re-INVITE request contains an authorised request for an MCPTT emergency private call cancellation as determined by clause 6.3.3.1.13.4:\na)\tshall set the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\";\nb)\tif the received SIP INVITE request contains an alert indication set to a value of \"false\" and this is an authorised request for an MCPTT emergency alert cancellation meeting the conditions specified in clause 6.3.3.1.13.3:\ni)\tshall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"false\"; and\nii)\tif the received SIP request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the received <originated-by> element to an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP re-INVITE request;\nc)\tif the received SIP INVITE request contains an alert indication set to a value of \"false\" and is not an authorised request for an MCPTT emergency alert cancellation meeting the conditions specified in clause 6.3.3.1.13.3, shall set the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body to a value of \"true\";\n4)\tshall include a Resource-Priority header field populated with the values for a normal MCPTT private call as specified in clause 6.3.3.1.19, if the received SIP re-INVITE request contains an authorised request for an MCPTT emergency private call cancellation as determined in step 3 above; and\n5)\tshall send the SIP re-INVITE request towards the core network according to 3GPP TS 24.229 [4].\nUpon receiving SIP 200 (OK) response for the SIP re-INVITE request the controlling MCPTT function:\n1)\tshall cache the contact received in the Contact header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.2\tPrivate call without floor control and first-to-answer call without floor control",
                            "text_content": "Clause 11.1.2 specifies the MCPTT client procedures, participating MCPTT function procedures and controlling MCPTT function procedures for on-network private calls without floor control and first-to-answer calls without floor control. The procedures in clause 11.1.2 refer to the on-network private calls with floor control procedures and first-to-answer calls with floor control procedures in clause 11.1.1 citing the differences.\nWhen the MCPTT user wants to make an on-demand private call without floor control or first-to-answer call without floor control, the MCPTT client shall follow the procedures in clause 11.1.1.2.1.1 with the following exceptions:\n1)\tin step 12) of clause 11.1.1.2.1.1, the MCPTT client shall not offer a media-level section for a media-floor control entity; and\n2)\tstep 13) of clause 11.1.1.2.1.1 shall be ignored.\nWhen the MCPTT user wants to make a private call without floor control or first-to-answer call without floor control using a pre-established session, the MCPTT client shall follow the procedures in clause 11.1.1.2.2.1 with the following exceptions:\n1)\tstep 8 c) i) is re-written as: if the SDP parameters of the pre-established session contain a media-level section of a media-floor control entity or if end-to-end security is required for the private call, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1. If the pre-established session was established with implicit floor control, then the application/sdp MIME body shall not contain the implicit floor request as specified in clause 6.4; and\n2)\tstep 9a) is re-written as: if the SDP parameters of the pre-established session contain a media-level section of a media-floor control entity, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1. If the pre-established session was established with implicit floor control, then the application/sdp MIME body shall not contain the implicit floor request as specified in clause 6.4.\nUpon receipt of an initial SIP INVITE request for the private call or first-to-answer call with an SDP offer not including a media-level section for a media-floor control entity, the MCPTT client shall consider it as the request for private call without floor control and shall follow the procedures as specified in clause 11.1.1.2.1.2 for on-demand session and clause 11.1.1.2.2.2 for pre-established session.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" for a private call or first-to-answer call with an SDP offer not including a media-level section for media plane control messages, the participating MCPTT function shall consider it as a request for a private call without floor control or first-to-answer call without floor control and shall follow the procedures as specified in clause 11.1.1.3.1.1 for an on-demand session.\nUpon receipt of a \"SIP REFER request for a pre-established session\" for a private call or first-to-answer call with an SDP offer including a media-level section for media plane control messages with the 'fmtp' attribute containing a value of \"mc_no_floor_ctrl\" as specified in 3GPP TS 24.380 [5] clause 14, the participating MCPTT function shall consider it as a request for a private call without floor control or first-to-answer call without floor control and shall follow the procedures as specified in clause 11.1.1.3.1.2 for initiation using a pre-established session.\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\" for the private call or first-to-answer call with SDP offer not including media-level section for media-floor control entity, the participating MCPTT shall consider it as the request for the private call without floor control or first-to-answer call without floor control and shall follow the procedures as specified in clause 11.1.1.3.2.\nThe controlling MCPTT function shall follow the procedures as specified in clause 11.1.1.4.1.\nUpon receiving of a \"SIP INVITE request for controlling MCPTT function of a private call\" or a \"SIP INVITE request for controlling MCPTT function of a first-to-answer call\", with SDP offer not including media-level section for media-floor control entity, the controlling MCPTT function shall consider it as the request for the private call without floor control or first-to-answer call without floor control, and shall follow the procedures as specified in clause 11.1.1.4.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.3\tEnding the private call initiated by MCPTT client",
                            "text_content": "Upon receiving a request from an MCPTT user to release an MCPTT private call session established using on-demand session signalling, the MCPTT client shall follow the procedures as specified in clause 6.2.5.1.\nUpon receiving a SIP BYE request for private call session, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nUpon receiving a request from an MCPTT user to release an MCPTT private call within a pre-established session, the MCPTT client shall follow the procedures as specified in clause 6.2.5.2.\nThe MCPTT client shall follow the procedures for terminating of request for MCPTT private call release as specified in clause 6.2.6.\nUpon receiving from the MCPTT client a SIP BYE request the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.6.\nUpon receiving from the MCPTT client a SIP REFER request when using a pre-established session with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.7.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.1.\nUpon receiving a SIP BYE request from the controlling MCPTT function and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function:\n1)\tshall interact with the media plane as specified in clause 9.3 in 3GPP TS 24.380 [5] for disconnecting the media plane resources towards the controlling MCPTT function;\n2)\tshall send a SIP 200 (OK) response to the controlling MCPTT function;\n3)\tshall interact with the media plane as specified in clause 9.3 in 3GPP TS 24.380 [5] for disconnecting media plane resources towards the MCPTT client from the media plane resources towards the controlling MCPTT function; and\n4)\tshall maintain the pre-established session towards the MCPTT client.\nUpon receiving a SIP BYE request the controlling MCPTT function shall follow the procedures as specified in clause 6.3.3.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.4\tEnding the private call initiated by the MCPTT server",
                            "text_content": "This clause describes the procedures of each functional entity for ending the private call initiated by the MCPTT server.\nNOTE:\tFor private call without floor control, ending the private call is initiated only by the MCPTT client.\n\nUpon receiving a SIP BYE request for private call session, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nWhen the MCPTT session for private call needs to be released as specified in clause 6.3.8.2, the participating MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.1.\nUpon receiving a SIP BYE request from the controlling MCPTT function and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function shall follow the procedures in clause 11.1.3.2.2.2.\nWhen the MCPTT session for private call needs to be released as specified in clause 6.3.8.2, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.5\tPrivate call call-back",
                            "text_content": "Clause 11.1.5 describes the MCPTT client procedures, the participating MCPTT function procedures and the controlling MCPTT function procedures for private call call-back.\nIn the procedures in clause 11.1.5.2:\n-\tthe term \"requesting MCPTT client\" is used to refer to the client that initiates a private call call-back request, initiates a private call call-back cancel request or receives a private call call-back fulfilment;\n-\tthe term \"requesting MCPTT user\" is used to refer to the MCPTT user that requests a private call call-back or requests a private call call-back cancel;\n-\tthe term \"target MCPTT client\" is used to refer to the client that generates a private call call-back response, generates a private call call-back cancel response or initiates a private call call-back fulfilment; and\n-\tthe term \"target MCPTT user\" is used to refer to the MCPTT user that is targeted for a private call call-back request or a private call call-back cancel request,\nThe requesting MCPTT client needs to store the MCPTT ID of the target MCPTT user together with state information as specified in Table G.13-1. In the procedures in clause 11.1.5.2, the notation {MCPTT-ID, private call call-back requesting client state} is used to describe the information that the requesting MCPTT client stores.\nThe target MCPTT client needs to store the MCPTT ID of the requesting MCPTT user together with state information as specified in Table G.13-2. Additionally, for a private call call-back request, the target MCPTT client needs to store the urgency of the request and the time of the request. In the procedures in clause 11.1.5.2, the notation {MCPTT ID, private call call-back target client state, urgency, time-of-request} is used to describe the information that the target MCPTT client stores.\nThe {MCPTT-ID, private call call-back requesting client state} entry on the requesting MCPTT client is known as the \"PCCB requesting client entry\".\nThe {MCPTT ID, private call call-back target client state, urgency, time-of-request} entry on the target MCPTT client is known as the \"PCCB target client entry\".\nWhen a private call call-back request is cancelled or when a private call call-back is fulfilled, the \"PCCB requesting client entry\" is deleted on the requesting MCPTT client and the \"PCCB target client entry\" is deleted on the target MCPTT client.\nUpon receiving a request from the MCPTT user to send a private call call-back request, if the <allow-request-private-call-call-back> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from the MCPTT user to send a private call call-back cancel request, if the <allow-cancel-private-call-call-back> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from the requesting MCPTT user to send a private call call-back request or to send a private call call-back cancel request, that has been authorised successfully by the requesting MCPTT client, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nThe MCPTT client:\n1)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n2)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n4)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n5)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID of the targeted MCPTT user, according to rules and procedures of IETF RFC 5366 [20];\n6)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <anyExt> element containing:\na)\tif the request is a private call call-back request:\ni)\tthe <request-type> set to a value of \"private-call-call-back-request>;\nii)\tthe <urgency-ind> set to a value of \"low\", \"normal\" or \"high\" to indicate the urgency of the call-back request; and\niii)\tthe <time-of-request> set to the date and time of the request using the format specified in clause F.1.3; and\nb)\tif the request is a private call call-back cancel request, the <request-type> set to a value of \"private-call-call-back-cancel-request\";\n7)\tshall store a \"PCCB requesting client entry\" containing the MCPTT ID of the targeted user and:\na)\tif the request is a private call call-back request, shall set the private call call-back requesting client state to \"PCCB-I2: confirm-pending\"; and\nb)\tif the request is a private call call-back cancel request, shall set the private call call-back requesting client state to \"PCCB-I4: cancel-pending\"; and\n8)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP MESSAGE request in step 8), the MCPTT client shall set the private call call-back requesting client state of the \"PCCB requesting client entry\" matching the MCPTT ID of the targeted MCPTT user, to \"PCCB-I1: no-call-back\", shall delete the \"PCCB requesting client entry\" and shall exit this procedure.\nUpon receiving a \"SIP MESSAGE request for private call call-back response for terminating client\" with an <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to an MCPTT-ID matching a \"PCCB requesting client entry\" stored on the client, if the private call call-back requesting client state is set to \"PCCB-I2: confirm-pending\", then the MCPTT client shall set the private call call-back requesting client state to \"PCCB-I3: confirmed\".\nUpon receiving a \"SIP MESSAGE request for private call call-back cancel response for terminating client\" with an <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body set to the an MCPTT-ID matching a \"PCCB requesting client entry\" entry stored on the client, if the private call call-back requesting client state is set to \"PCCB-I4: cancel-pending\", then the MCPTT client shall set the private call call-back requesting client state to \"PCCB-I1: no-call-back\" and shall delete the \"PCCB requesting client entry\" associated with the target MCPTT user.\nUpon receiving a \"SIP MESSAGE request for private call call-back request for terminating client\", the MCPTT client:\n1)\tshall store a \"PCCB target client entry\" entry with:\na)\tthe MCPTT ID set to the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tthe private call call-back receiving client state set to \"PCCB-I2: private-call-pending\";\nc)\tthe urgency set to the value of the <urgency-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\nd)\tthe time-of-request set to the value of the <time-of-request> element in the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\tshall notify the user of the stored information related to the private call call back request.\nUpon receiving a \"SIP MESSAGE request for private call call-back cancel request for terminating client\" where the \"PCCB target client entry\" associated with the MCPTT ID in the <mcptt-calling-user-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body contains a private call call-back requesting client state set to \"PCCB-R2: private-call-pending\", the MCPTT client shall set the private call call-back requesting client state to \"PCCB-R1: no-call-back\" and shall delete the \"PCCB target client entry\" associated with the requesting MCPTT user.\nThe MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6] in the SIP MESSAGE request\n4)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n5)\tshall set the Request-URI in the SIP MESSAGE request to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n6)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request;\n7)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <anyExt> element containing:\na)\tif the received SIP MESSAGE was a \"SIP MESSAGE request for private call call-back request for terminating MCPTT client\", the <response-type> element set to a value of \"private-call-call-back-response\"; and\nb)\tif the received SIP MESSAGE was a \"SIP MESSAGE request for private call call-back cancel request for terminating MCPTT client\", the <response-type> element set to a value of \"private-call-call-back-cancel-response\"; and\n8)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nWhen the target MCPTT user wants to make a private call call-back, the target MCPTT client shall initiate a private call in manual commencement mode towards the requesting MCPTT client using the MCPTT ID of the requesting MCPTT user as found in the \"PCCB target client entry\" stored on the UE, by following the procedures in:\n1)\tclause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 for private call with floor control; or\n2)\tclause 11.1.2.2 for private call without floor control;\nUpon sending a SIP 200 (OK) response to the request for establishment of a private call as specified in clause 11.1.1.2.1.1, clause 11.1.1.2.2.1 or clause 11.1.2.2, if the \"PCCB requesting client entry\" of the target MCPTT user contains a private call call-back requesting client state set to \"PCCB-I3: confirmed\", then the requesting MCPTT client shall set the private call call-back requesting client state to \"PCCB-I1: no-call-back\" and shall delete the \"PCCB requesting client entry\" associated with the target MCPTT user.\nUpon receiving a SIP 2xx response to the SIP INVITE request or SIP REFER request for establishment of the private call, as specified in clause 11.1.1.2.1.1, clause 11.1.1.2.2.1 or clause 11.1.2.2, if the \"PCCB target client entry\" of the requesting MCPTT user contains a private call call-back target client state set to \"PCCB-R2: private-call-pending\", then the target MCPTT client shall set the private call call-back target client state to \"PCCB-R1: no-call-back\" and shall delete the \"PCCB target client entry\" associated with the requesting MCPTT user.\nUpon receiving a \"SIP MESSAGE request for private call call-back for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif the \"SIP MESSAGE request for private call call-back for originating participating MCPTT function\" contains the <request-type> element set to a value of \"private-call-call-back-request\", and the <allow-request-private-call-call-back> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"151 user not authorised to make a private call call-back request\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps in this clause;\n4)\tif the \"SIP MESSAGE request for private call call-back for originating participating MCPTT function\" contains the <request-type> element set to a value of \"private-call-call-back-cancel-request\", and the <allow-cancel-private-call-call-back> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"152 user not authorised to make a private call call-back cancel request\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps in this clause;\n5)\tshall determine the public service identity of the controlling MCPTT function for the private call call-back service for the MCPTT user;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the private call call-back service for the MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n7)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 5);\n8)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n9)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n10)\tshall copy the contents of the application/resource-lists+xml MIME body in the received SIP MESSAGE request into an application/resource-lists+xml MIME body in the outgoing SIP MESSAGE request;\n11)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n12)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n13)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n14)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n15)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 13), the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, the participating MCPTT function shall forward the error response to the MCPTT client.\nUpon receiving a \"SIP MESSAGE request for private call call-back for terminating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall forward the SIP 2xx response to the controlling MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the response to the controlling MCPTT function.\nUpon receiving a:\n-\t\"SIP MESSAGE request for private call call-back request for controlling MCPTT function\";\n-\t\"SIP MESSAGE request for private call call-back cancel request for controlling MCPTT function\"; or\n-\t\"SIP MESSAGE request for private call call-back responses for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tif the incoming SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or contains an application/resource-lists+xml MIME body with more than one total <entry> element in all <list> elements of the <resource-lists> element, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\n8)\tshall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP MESSAGE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\n9)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user to be invited;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the MCPTT user to be invited or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n10)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n11)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\n12)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.6\tAmbient listening call",
                            "text_content": "Clause 11.1.6 specifies the MCPTT client procedures, participating MCPTT function procedures and controlling MCPTT function procedures for on-network ambient listening calls. The procedures as specified are applicable to both locally initiated and remotely initiated ambient listening call.\nThe procedures for originating an ambient listening call are initiated by the MCPTT user at the MCPTT client in the following circumstances:\n-\tan authorised MCPTT user initiates an ambient listening call in order to listen to the terminating user; or\n-\tan authorised MCPTT user initiates an ambient listening call in order to be listened to by the terminating user.\nThe procedures for releasing an ambient listening call are initiated by the MCPTT user at the MCPTT client in the following circumstances:\n-\ta listening MCPTT user initiates the ambient listening call release; or\n-\ta listened-to MCPTT user who was the originator of the ambient listening call initiates the ambient listening call release.\nThe procedures for releasing an ambient listening call by the controlling MCPTT function are initiated in the following circumstances:\n-\tcan be triggered by the MCPTT administrator by a mechanism outside of the scope of the standard; or\n-\tcan be triggered by a call terminating event occurring at the controlling MCPTT function such as a timer expiration.\nThe MCPTT client takes the actions needed to avoid letting the user detect that an ambient listening call is active. This includes:\n-\tavoiding that the user is aware of the beginning of an ambient listening call, except an ambient listening call initiated by the user;\n-\tavoiding that the user is aware of the end of an ambient listening call, except an ambient listening call initiated by the user;\n-\tavoiding that the user is aware of the ongoing progress of an ambient listening call, even an ambient listening call initiated by the user; and\n-\tavoiding changes in the display of information, visual, audible, or haptic, that might occur or might be absent if the ambient call was not active.\nUpon receiving a request from the MCPTT user to originate a remote initiated ambient listening call, if the <allow-request-remote-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from the MCPTT user to originate a locally initiated ambient listening call, if the <allow-request-locally-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from an MCPTT user to establish an MCPTT ambient listening call that has been authorised successfully by the requesting MCPTT client, the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI of the SIP INVITE request to a public service identity of the participating MCPTT function serving the MCPTT user;\n2)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n3)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n4)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref contain with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"ambient-listening\";\n8)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body an <ambient-listening-type> element set to a value of:\na)\t\"local-init\", if the MCPTT user has requested a locally initiated ambient listening call; or\nb)\t\"remote-init\", if the MCPTT user has requested a remotely initiated ambient listening call;\n9)\tshall insert in the SIP INVITE request an application/resource-lists+xml MIME body with the MCPTT ID of the targeted MCPTT user, according to rules and procedures of IETF RFC 5366 [20];\nNOTE 1:\tthe targeted MCPTT user is the listened-to MCPTT user in the case of a remotely initiated ambient listening call or the listening MCPTT user in the case of a locally initiated listening call.\n10)\tif an end-to-end security context needs to be established then:\na)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\nb)\tshall use the keying material to generate a PCK as described in 3GPP TS 33.180 [78];\nc)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP TS 33.180 [78];\nd)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user and a time related parameter as described in 3GPP TS 33.180 [78];\ne)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78];\nf)\tshall add the MCPTT ID of the originating MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and\ng)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78];\n11)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarification given in clause 6.2.1 and with a media stream of the offered media-floor control entity;\n12)\tif this is a locally initiated ambient listening call, shall comply with the conditions for implicit floor control as specified in clause 6.4;\n13)\tif this is a remotely initiated ambient listening call, shall comply with the conditions for an implicit request to grant the floor to the terminating MCPTT client as specified in clause 6.4;\n14) shall include in the SIP INVITE request a Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18]; and\n15)\tshall send the SIP INVITE request towards the participating MCPTT function according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 183(Session Progress) response to the SIP INVITE request the MCPTT client:\n1)\tif the SIP 183(Session Progress) response includes an alert-info header field as specified in IETF RFC 3261 [24] and as updated by IETF RFC 7462 [77] set to a value of \"<file:///dev/null>\" shall not give any indication of the progress of the call setup to the MCPTT user; and\nNOTE 2:\tThe alert-info header field having the value of \"<file:///dev/null>\" is intended to result in having a \"null\" alert, i.e. an alert with no content or physical manifestation of any kind.\n2)\tif this is a remotely initiated ambient listening call, may indicate the progress of the session establishment to the inviting MCPTT user.\nUpon receiving a SIP 200 (OK) response to the SIP INVITE request the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tif this is a remotely initiated ambient listening call, shall notify the user that the call has been successfully established;\n3)\tif this is a locally initiated ambient listening call, shall not provide any indication to the user that the call has been successfully established;\n4)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the sent SIP INVITE request was set to a value of \"local-init\":\na)\tshall cache the value of \"listened-to MCPTT user\" as the ambient listening client role for this call; or\nb)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body was set to a value of \"remote-init\" shall cache the value of \"listening MCPTT user\" as the ambient listening client role for this call; and\n5)\tshall cache the value contained in the <ambient-listening-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body set in step 8) as the ambient listening type of this call.\nUpon receipt of an initial SIP INVITE request, the MCPTT client shall follow the procedures for termination of multimedia sessions in the IM CN subsystem as specified in 3GPP TS 24.229 [4] with the clarifications below.\nThe MCPTT client:\n1)\tmay reject the SIP INVITE request if either of the conditions in step a) or b) are met:\na)\tMCPTT client is already occupied in another session and the number of simultaneous sessions exceeds <MaxCall>, the maximum simultaneous MCPTT session for private call, as specified in TS 24.484 [50]; or\nb)\tMCPTT client does not have enough resources to handle the call;\nc)\tif neither condition a) nor b) are met, continue with the rest of the steps;\n2)\tif the SIP INVITE request is rejected in step 1):\na)\tshall respond towards the participating MCPTT function either with:\ni)\tan appropriate reject code as specified in 3GPP TS 24.229 [4] and warning texts as specified in clause 4.4.2; or\nii)\twith a SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure according to <allow-failure-restriction> as specified in 3GPP TS 24.484 [50]; and\nb)\tskip the rest of the steps of this clause;\n3)\tif the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the originating MCPTT user from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4; and\ne)\tif the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:\ni)\tshall extract and decrypt the encapsulated PCK using the terminating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\nNOTE 1:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n4)\tmay check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n5)\tshall perform the automatic commencement procedures specified in clause 6.2.3.1.1;\nNOTE 2:\tAuto-answer is the commencement mode for both participants in locally initiated and remotely initiated ambient listening calls.\n6)\tif the received SIP INVITE request includes an alert-info header field as specified in IETF RFC 3261 [24] and as updated by IETF RFC 7462 [77] set to a value of \"<>\" shall not give any indication of the progress of the call to the MCPTT user;\nNOTE 3:\tThe alert-info header field having the value of \"<>\" is intended to result in having a \"null\" alert, i.e. an alert with no content or physical manifestation of any kind.\n7)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request was set to a value of \"remote-init\":\na)\tshall cache the value of \"listened-to MCPTT user\" as the ambient listening client role for this call;\nNOTE 4:\tThe terminating user in a remotely initiated ambient listening is the listened-to MCPTT user and is intended to be totally unaware that their microphone is activated and a call is in progress.\n8)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request was set to a value of \"local-init\":\na)\tshall cache the value of \"listening MCPTT user\" as the ambient listening client role for this call;\nb)\tshould provide an indication to the MCPTT user that the ambient listening call is in progress; and\nc)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user; and\n9)\tshall cache as the ambient listening type for the call the value contained in the <ambient-listening-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP INVITE request.\nUpon receiving a request from an MCPTT user to release an MCPTT ambient listening call:\nThe MCPTT client:\n1)\tif the MCPTT client has not received a g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93] in:\na)\ta received SIP INVITE request for the ambient listening call; or\nb)\ta received SIP 200 (OK) response to a sent SIP INVITE request for the ambient listening call;\nthen shall skip the rest of the steps;\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n3)\tshall generate a SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4] and IETF RFC 6086 [64]; and\n4)\tshall send the SIP BYE request within the dialog of the MCPTT ambient call session as specified in 3GPP TS 24.229 [4].\nUpon receipt of the SIP 200 (OK) response to the SIP BYE request the MCPTT client:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tif the cached ambient listening client role is equal to \"listened-to MCPTT user\", shall provide no indication that an ambient listening call has been terminated;\n3)\tif the cached ambient listening client role is equal to \"listening MCPTT user\", may provide an indication to the MCPTT user that the ambient listening call has been terminated; and\n4)\tshall clear the cache of the data stored as:\na)\tambient listening client role; and\nb)\tambient listening type.\nThis clause is referenced from other procedures.\nUpon receipt of a SIP BYE request in the dialog of an ambient listening session, the MCPTT client:\n1)\tshall comply with the procedures of clause 6.2.6;\n2)\tif the cached ambient listening client role is equal to \"listened-to MCPTT user\", shall provide no indication that an ambient listening call has been terminated;\n3)\tif the cached ambient listening client role is equal to \"listening MCPTT user\", may provide an indication to the MCPTT user that the ambient listening call has been terminated; and\n4)\tshall clear the cache of the data stored as:\na)\tambient listening client role; and\nb)\tambient listening type.\nUpon receiving a request from the MCPTT user to originate a remote initiated ambient listening call, if the <allow-request-remote-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from the MCPTT user to originate a locally initiated ambient listening call, if the <allow-request-locally-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\", the MCPTT client shall inform the MCPTT user and shall exit this procedure.\nUpon receiving a request from an MCPTT user to establish an MCPTT ambient listening call that has been authorised successfully by the requesting MCPTT client within a pre-established session, the MCPTT client shall generate a SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.\nIf an end-to-end security context needs to be established the MCPTT client:\n1)\tif necessary, shall instruct the key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\n2)\tshall use the keying material to generate a PCK as described in 3GPP TS 33.180 [78];\n3)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP TS 33.180 [78];\n4)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID of the invited user and a time related parameter as described in 3GPP TS 33.180 [78];\n5)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78];\n6)\tshall add the MCPTT ID of the originating MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]; and\n7)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78].\nThe MCPTT client populates the SIP REFER request as follows:\n1)\tshall include the Request-URI set to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n2)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\n3)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22];\n4)\tshall include the option tag \"multiple-refer\" in the Require header field;\n5)\tmay include a P-Preferred-Identity header field in the SIP REFER request containing a public user identity as specified in 3GPP TS 24.229 [4];\n6)\tshall include a P-Preferred-Service header field set to the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), according to IETF RFC 6050 [9];\n7)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20], and with the Content-ID header field set to this \"cid\" URL;\n8)\tshall include in the application/resource-lists+xml MIME body a single <entry> element in a <list> element of the <resource-lists> element where the single <entry> element contains a \"uri\" attribute set to the MCPTT ID of the targeted user, extended with hname \"body\" parameter containing:\na)\tan application/vnd.3gpp.mcptt-info MIME body containing:\ni)\ta <session-type> element set to \"ambient-listening\";\nii)\tif the MCPTT user has requested a locally initiated ambient listening call, an <ambient-listening-type> element set to a value of \"local-init\"; or\niii)\tif the MCPTT user has requested a remotely initiated ambient listening call, an <ambient-listening-type> element set to a value of \"remote-init\";\nb)\ta Priv-Answer-Mode header field with the value \"Auto\" according to the rules and procedures of IETF RFC 5373 [18];\nc)\tif the SDP parameters of the pre-established session do not contain a media-level section of a media-floor control entity or if end-to-end security is required for the ambient listening call, an application/sdp MIME body containing the SDP parameters of the pre-established session according to 3GPP TS 24.229 [4] with the clarification given in clause 6.2.1;\nd)\tif this is a locally initiated ambient listening call, shall comply with the conditions for implicit floor control as specified in clause 6.4;\ne)\tif this is a remotely initiated ambient listening call, shall comply with the conditions for an implicit request to grant the floor to the terminating MCPTT client as specified in clause 6.4; and\nf)\tif implicit floor control is to be requested per clause 6.4, then:\ni)\tthe application/sdp MIME body shall contain an implicit floor request as specified in clause 6.4; and\nii)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", then shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n9)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session.\nThe MCPTT client shall send the SIP REFER request towards the MCPTT server according to 3GPP TS 24.229 [4].\nUpon receiving a final SIP 2xx response to the SIP REFER request the MCPTT client:\n1)\tshall interact with media plane as specified in 3GPP TS 24.380 [5]; and\n2)\tif this is a locally initiated ambient listening call, shall not provide any indication to the user that the call setup is in progress.\nOn call establishment by interaction with the media plane as specified in clause 9.2.2 of 3GPP TS 24.380 [5] if the sent SIP REFER request the MCPTT client:\n1)\tif the MCPTT user has requested a locally initiated ambient listening call shall provide no indication to the MCPTT user that the ambient listening call has been successfully established; and\n2)\tif the MCPTT user has requested a remotely initiated ambient listening call shall provide an indication to the MCPTT user that the ambient listening call has been successfully established.\n3)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the sent SIP REFER request was set to a value of \"local-init\":\na)\tshall cache the value of \"listened-to MCPTT user\" as the ambient listening client role for this call; or\nb)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body was set to a value of \"remote-init\" shall cache the value of \"listening MCPTT user\" as the ambient listening client role for this call; and\n4)\tshall cache the value contained in the <ambient-listening-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body set in step 8) as the ambient listening type of this call.\nThe MCPTT client shall follow the procedures for termination of multimedia sessions for ambient listening calls as specified in clause 11.1.6.2.1.2.\nNOTE:\tThe terminating MCPTT client in an ambient listening call receives a SIP INVITE request with Replaces header field when using a pre-established session.\nUpon receiving a request from an MCPTT user to release an MCPTT ambient listening call when using a pre-established MCPTT session:\nThe MCPTT client:\n1)\tif the MCPTT client has not received a g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93] in:\na)\ta received SIP INVITE request for the ambient listening call; or\nb)\ta received SIP 200 (OK) response to a sent SIP INVITE request or SIP REFER request for the ambient listening call;\nthen shall skip the rest of the steps; and\n2)\tshall perform the actions specified in clause 6.2.5.2.\nIf the procedures of clause 6.2.5.2 were successful:\n1)\tif the cached ambient listening client role is equal to \"listened-to MCPTT user\", shall provide no indication that an ambient listening call has been terminated;\n2)\tif the cached ambient listening client role is equal to \"listening MCPTT user\", may provide an indication to the MCPTT user that the ambient listening call has been terminated; and\n3)\tshall clear the cache of the data stored as:\na)\tambient listening client role; and\nb)\tambient listening type.\nUpon receiving a SIP INFO request containing an application/vnd.3gpp.mcptt-info+xml MIME body containing a <release-reason> element, the MCPTT client:\n1)\tif the cached ambient listening client role is equal to \"listened-to MCPTT user\", shall provide no indication that an ambient listening call is being terminated;\n2)\tif the cached ambient listening client role is equal to \"listening MCPTT user\", should provide an indication to the MCPTT user that an ambient listening call is being terminated;\n3)\tshall generate and send a SIP 200 OK response to the SIP INFO request according to 3GPP TS 24.229 [4]; and\n4)\tshall comply with the procedures of clause 11.1.6.2.2.5.\nThis clause is referenced from other procedures.\nUpon receiving an interaction with the media plane indicating release of the ambient listening call but preservation of the pre-established session as specified in clause 9.2 of 3GPP TS 24.380 [5], the MCPTT client:\n1)\tif the cached ambient listening client role is equal to \"listened-to MCPTT user\", shall provide no indication that an ambient listening call has been terminated;\n2)\tif the cached ambient listening client role is equal to \"listening MCPTT user\", may provide an indication to the MCPTT user that the ambient listening call has been terminated; and\n3)\tshall clear the cache of the data stored as:\na)\tambient listening client role; and\nb)\tambient listening type.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"ambient-listening\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif the <ambient-listening-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of:\na)\t\"remote-init\" and an <allow-request-remote-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\"; or\nb)\t\"local-init\" and an <allow-request-locally-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response, with warning text set to \"user not authorised to make an ambient listening call\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n5)\tshall determine the public service identity of the controlling MCPTT function for the ambient listening call service associated with the originating user's MCPTT ID identity. If the participating MCPTT function is unable to identify the controlling MCPTT function for the ambient listening call service associated with the originating user's MCPTT ID identity, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the ambient listening call service associated with the originating user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tif the incoming SIP INVITE request does not contain an application/resource-lists+xml MIME body or contains an application/resource-lists+xml MIME body with more than one <entry> element in all <list> elements of the <resource-lists> element, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n7)\tif the <allow-private-call> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to initiate private calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response, with warning text set to \"107 user not authorised to make private calls\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n8)\tif the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tif the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body does not match with the \"uri\" attribute of one of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nb)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"144 user not authorised to call this particular user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n9)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the \"SIP INVITE request for originating participating MCPTT function\" shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n10)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.3;\n11)\tshall set the Request-URI to the public service identity of the controlling MCPTT function determined in step 5);\n12)\tshall set the <mcptt-calling-user-id> element in an application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the MCPTT ID of the calling user;\n13)\tif the Priv-Answer-Mode header field specified in IETF RFC 5373 [18] was received in the incoming SIP INVITE request with a value of \"Auto\" or if no Priv-Answer-Mode header field was received in the incoming SIP INVITE request or a Priv-Answer-Mode header field was received containing a value other than \"Auto\", shall include the Priv-Answer-Mode header field set to a value of \"Auto\" in the outgoing SIP INVITE request;\n14)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received \"SIP INVITE request for originating participating MCPTT function\", as specified in clause 6.3.2.1.1.1;\n15) if, according to clause 6.4, the SIP INVITE request is regarded as being received with an implicit request to grant the floor to the originating MCPTT client:\nif:\na)\tthe incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the originating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n16)\tshall forward the SIP INVITE request, according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tshall include Warning header field(s) received in the incoming SIP 200 (OK) response;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n5)\tshall include an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response;\n6)\tshall include the answer state into the P-Answer-State header field of the outgoing SIP 200 (OK) response, if received in the P-Answer-State header field of the incoming SIP 200 (OK) response;\n7)\tshall send the SIP 200 (OK) response to the inviting MCPTT client according to 3GPP TS 24.229 [4]; and\n8)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receiving from the MCPTT client a SIP BYE request the participating MCPTT function:\n1)\tshall follow the procedures as specified in clause 11.1.3.2.1.1.\nUpon receiving from the MCPTT client a SIP REFER request when using a pre-established session with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.7.\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header field containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing one <entry> element in a <list> element of the <resource-lists> element with a \"uri\" attribute containing a SIP URI set to the MCPTT ID of the called user(s);\n2)\ta \"body\" parameter of the SIP URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"ambient-listening\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif the received SIP REFER request does not contain an application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n5)\tif the received SIP REFER request contains an application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field with more than one total <entry> element in all <lists> elements of the <resource-lists> element where each <entry> element contains an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n6)\tif the received SIP REFER request contains an application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field with only one <entry> element in all <list> elements of the <resource-lists> element where the <entry> element contains an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element not set to \"ambient-listening\", shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n7)\tif the <ambient-listening-type> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP REFER request is set to a value of:\na)\t\"remote-init\" and an <allow-request-remote-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\"; or\nb)\t\"local-init\" and an <allow-request-locally-initiated-ambient-listening> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen shall reject the \"SIP REFER request for a pre-established session\" with a SIP 403 (Forbidden) response, with warning text set to \"154 The MCPTT user is not authorised to make an ambient listening call\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n8)\tshall determine the public service identity of the controlling MCPTT function for the ambient listening call service associated with the originating user's MCPTT ID;\nNOTE 1:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the ambient listening call serviceassociated with the originating user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n9)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the ambient listening call service associated with the originating user's MCPTT ID, it shall reject the REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n10)\tif the <allow-private-call> element of the <ruleset> element is not present in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the participating MCPTT function or is present with the value \"false\", indicating that the user identified by the MCPTT ID is not authorised to initiate private calls, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response to the SIP INVITE request, with warning text set to \"107 user not authorised to make private calls\" in a Warning header field as specified in clause 4.4;\n11)\tif the <PrivateCall> element exists in the MCPTT user profile document with one or more <entry> elements (see the MCPTT user profile document in 3GPP TS 24.484 [50]) and:\na)\tthe \"uri\" attribute of each and every <entry> element of all the <list> elements of the <resource-lists> element of the application/resource-lists+xml MIME body referenced by a \"cid\" URL in the Refer-To header field do not match with any of the <entry> elements of the <PrivateCall> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\nb)\tif configuration is not set in the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) that allows the MCPTT user to make a private call to users not contained within the <entry> elements of the <PrivateCall> element;\nthen:\na)\tshall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"144 user not authorised to call this particular user\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\n12)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\n13)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP TS 24.229 [4];\nNOTE 6:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n14)\tshall include in the SIP 200 (OK) response the g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93];\nNOTE 7: The originator of the ambient listening call is either the initiator of a \"remote-init\" ambient listening type call or the originator of a \"local-init\" ambient listening type call. In either case, the originating user is allowed to release the ambient listening call.\n15)\tshall send the response to the \"SIP REFER request for a pre-established session\" towards the MCPTT client according to 3GPP TS 24.229 [4];\n16)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.4;\n17)\tshall include a Priv-Answer-Mode header field set to a value of \"Auto\" in the outgoing SIP INVITE request;\n18)\tshall set the Request-URI of the SIP INVITE request to the public service identity of the controlling MCPTT function as determined above in step 7);\nNOTE 8:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n18a)\tif, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n19)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving SIP provisional responses for the SIP INVITE request the participating MCPTT function:\n1)\tshall discard the received SIP responses without forwarding them.\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request in step 21) the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function:\nNOTE:\tThe procedures in the present clause are applicable for both on-demand and pre-established sessions.\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24], and shall not continue with the rest of the steps;\n2)\tshall check the presence of the isfocus media feature tag in the Contact header field and if it is not present then the participating MCPTT function shall reject the request with a SIP 403 (Forbidden) response with the warning text set to \"104 isfocus not assigned\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n3)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request to retrieve the binding between the MCPTT ID and public user identity;\n4)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n5)\twhen the called user identified by the MCPTT ID is unable to participate in private calls as identified in the called user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) on the terminating participating MCPTT function, shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"127 user not authorised to be called in private call\" in a Warning header field as specified in clause 4.4; and\n6)\tshall perform the automatic commencement procedures specified in clause 6.3.2.2.5.1 and according to IETF RFC 5373 [18].\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 11.1.3.2.2.1.\nUpon receiving a SIP BYE request from the controlling MCPTT function for an ambient listening call and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function:\n1)\tif the SIP BYE request contains an application/vnd.3gpp.mcptt-info+xml MIME body:\na)\tshall generate a SIP INFO request according to rules and procedures of 3GPP TS 24.229 [4] and IETF RFC 6086 [64];\nb)\tshall include the Info-Package header field set to g.3gpp.mcptt-info in the SIP INFO request;\nc)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP BYE request to the SIP INFO request; and\nd)\tshall send the SIP INFO request towards the targeted MCPTT client in the dialog of the pre-established session according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 2xx response for the sent SIP INFO request, shall perform the procedures specified in clause 11.1.3.2.2.2.\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT ambient listening session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 11.1.6.4.2\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\nNOTE 1:\tAs a result of calling clause 6.3.3.1.2, the <mcptt-calling-user-id> containing the calling user's MCPTT ID is copied into the outgoing SIP INVITE.\n2)\tshall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP INVITE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request;\n3)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user to be invited;\nNOTE 2:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the MCPTT user to be invited or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP INVITE request set to the public service identity of the controlling MCPTT function;\n5)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1;\n6)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"local-init\", shall include the g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93];\nNOTE 7:\tThe only case where the terminating user can release the ambient listening call is when the terminating client is the \"listening MCPTT user\";\n7)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"remote-init\", shall include in the outgoing SIP INVITE request an alert-info header field set to a value of \"<>\" according to IETF RFC 3261 [24];\n8)\tshall send the SIP INVITE request towards the core network according to 3GPP TS 24.229 [4]; and\n9)\tshall start a private call timer with a value set to the configured max private call duration for the user.\nUpon receiving SIP 200 (OK) response for the SIP INVITE request, the controlling MCPTT function:\n1)\tshall cache the contact received in the Contact header field; and\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nUpon expiry of the private call timer, the controlling MCPTT function shall follow the procedure for releasing the ambient listening call session as specified in clause 11.1.6.4.3, with the clarification that the <release-reason> element included in the SIP BYE request shall be set to \"private-call-timer-expiry\".\nUpon receiving of a \"SIP INVITE request for controlling MCPTT function of an ambient listening call\" the controlling MCPTT function:\n1)\tshall check whether the public service identity contained in the Request-URI is allocated for ambient listening call and perform the actions specified in clause 6.3.7.1 if it is not allocated and skip the rest of the steps;\n2)\tshall perform actions to verify the MCPTT ID of the inviting MCPTT user in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request, and authorise the request according to local policy; and\n3)\tif the request is not authorised as determined by step 2) above, the controlling MCPTT function shall return a SIP 403 (Forbidden) response with the warning text as specified in \"Warning header field\" and skip the rest of the steps;\n4)\tshall validate that the received SDP offer includes at least one media stream for which the media parameters and at least one codec or media format is acceptable by the controlling MCPTT function and if not, reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n5)\tshall perform actions as described in clause 6.3.3.2.2;\n6)\tshall allocate an MCPTT session identity for the MCPTT ambient listening call session; and\n7)\tshall invite the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP INVITE request as specified in clause 11.1.6.4.1.\nUpon receiving a SIP 183 (Session Progress) response to the SIP INVITE request specified in clause 11.1.6.4.1 containing a P-Answer-State header field with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], the controlling MCPTT function supports media buffering and the SIP final response is not yet sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to SIP INVITE request as specified in the clause 6.3.3.2.3.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tshall include a P-Answer-State header field with the value \"Unconfirmed\";\n4)\tshall include in the SIP 200 (OK) response the g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93];\nNOTE 1:\tThe originator of the ambient listening call is either the initiator of a \"remote-init\" ambient listening type call or the originator of a \"local-init\" ambient listening type call. In either case, the originating user is allowed to release the ambient listening call.\n5)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n6)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n7)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"remote-init\":\na)\tshall cache the MCPTT ID contained in the <mcptt-calling-user-id> element of the received SIP INVITE request as the listening MCPTT user of the ambient listening call and cache the MCPTT ID contained in the application/resource-lists+xml MIME body of the received SIP INVITE request as the listened-to MCPTT user; and\nb)\tshall cache the ambient listening type of the ambient listening call as \"remote-init\"; and\n8)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"local-init\":\na)\tshall cache the MCPTT ID contained in the <mcptt-calling-user-id> element of the received SIP INVITE request as the listened-to MCPTT user of the ambient listening call and cache the MCPTT ID contained in the application/resource-lists+xml MIME body of received SIP INVITE request as the listening MCPTT user; and\nb)\tshall cache the ambient listening type of the ambient listening call as \"local-init\".\nIf the procedures of clause 11.1.6.4.1 were successful in inviting the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP INVITE request and the SIP final response is not yet sent to the inviting MCPTT client, the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.2;\n3)\tshall include in the SIP 200 (OK) response the g.3gpp.mcptt.ambient-listening-call-release feature-capability indicator as described in clause D.3 in the Feature-Caps header field according to IETF RFC 6809 [93];\nNOTE 2:\tThe originator of the ambient listening call is either the initiator of a \"remote-init\" ambient listening type call or the originator of a \"local-init\" ambient listening type call. In either case, the originating user is allowed to release the ambient listening call.\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n5)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n6)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"remote-init\":\na)\tshall cache the MCPTT ID contained in the <mcptt-calling-user-id> element of the received SIP INVITE request as the listening MCPTT user of the ambient listening call and cache the MCPTT ID contained in the application/resource-lists+xml MIME body of the received SIP INVITE request as the listened-to MCPTT user; and\nb)\tshall cache the ambient listening type of the ambient listening call as \"remote-init\"; and\n7)\tif the <ambient-listening-type> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body in the received SIP INVITE request is set to a value of \"local-init\":\na)\tshall cache the MCPTT ID contained in the <mcptt-calling-user-id> element of the received SIP INVITE request as the listened-to MCPTT user of the ambient listening call and cache the MCPTT ID contained in the application/resource-lists+xml MIME body of received SIP INVITE request as the listening MCPTT user; and\nb)\tshall cache the ambient listening type of the ambient listening call as \"local-init\".\nIf the procedures of clause 11.1.6.4.1 were not successful in inviting the MCPTT user listed in the application/resource-lists+xml MIME body of received SIP INVITE request, the controlling MCPTT function shall reject the received SIP INVITE request with a SIP 480 (Temporarily Unavailable) response and skip the remaining procedures of the present clause.\nThe controlling MCPTT function shall forward any other SIP response that does not contain SDP, including any MIME bodies contained therein, along the signalling path to the originating network according to 3GPP TS 24.229 [4].\nThe ambient listening call release is triggered by an MCPTT administrator by a mechanism outside of the scope of the standard, or directly by the controlling MCPTT function as a result of an event as specified in clause 10.14.3.3 of 3GPP TS 23.379 [3].\nThis clause is referenced from other procedures.\nUpon receipt of a trigger to release an ongoing ambient listening call identified by the MCPTT ID of the listening MCPTT user, the MCPTT ID of the listened-to MCPTT user and the ambient listening type of the call, the controlling MCPTT function:\n1)\tshall identify the MCPTT sessions of the listening MCPTT user and the MCPTT ID of the listened-to MCPTT user for the ambient listening call to be released;\n2)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for the MCPTT session release;\n3)\tshall generate a SIP BYE request according to rules and procedures of 3GPP TS 24.229 [4] to be sent in the dialog for the ambient listening call with the MCPTT client of the listened-to MCPTT user; and\n4)\tshall send the SIP BYE request in the dialog for the ambient listening call with the MCPTT client of the listened-to MCPTT user.\nUpon receipt of a SIP 200 (OK) response to the SIP BYE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] for the MCPTT session release;\n2)\tshall generate a SIP BYE requests according to 3GPP TS 24.229 [4];\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body in the SIP BYE request including a <release-reason> element set to a value of:\na)\t\"administrator-action\" if triggered by an MCPTT administrator;\nb)\t\"private-call-expiry\" if the ambient listening call is released due to the expiry of the private call timer;\nc)\t\"call-request-for-listened-to-client\" if there is a call request targeted to the listened-to client; or\nd)\t\"call-request-initiated-by-listened-to-client\" if there is a call request initiated by the listened-to client; and\n4)\tshall send the SIP BYE requests in the dialog for the ambient listening call with the MCPTT client of the listening MCPTT user according to3GPP TS 24.229 [4].\nUpon receipt of a SIP 200 (OK) response to the SIP BYE request sent to MCPTT client of the listening MCPTT user the controlling MCPTT function:\n1)\tshall delete the following cached data for the ambient listening call:\na)\tthe MCPTT ID of the listened-to MCPTT user\nb)\tthe MCPTT ID of the listening MCPTT user; and\nc)\tthe ambient listening type.\nUpon receipt of a SIP 200 (OK) response to the SIP BYE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP sessions with the MCPTT clients;\n2)\tshall delete the following cached data for the ambient listening call:\na)\tthe MCPTT ID of the listened-to MCPTT user;\nb)\tthe MCPTT ID of the listening MCPTT user; and\nc)\tthe value of the ambient listening type.\nUpon receipt of a SIP BYE request for an ambient listening session the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing the media plane resource associated with the SIP session towards the MCPTT client;\n2)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4];\n3)\tshall send the SIP BYE request in the dialog of the other participant in the ambient listening call according to3GPP TS 24.229 [4];\n4)\tshall generate a SIP BYE request according to 3GPP TS 24.229 [4]; and\n5)\tshall send the SIP BYE request in the dialog of the participant in the ambient listening call according to3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response to the sent SIP BYE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in clause 6.3 in 3GPP TS 24.380 [5] for releasing media plane resources associated with the SIP session with the MCPTT ambient listening call participant;\n2)\tshall generate a SIP 200 (OK) response to the received SIP BYE request and send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4]; and\n3)\tshall delete the following cached data for the ambient listening call:\na)\tthe MCPTT ID of the listened-to MCPTT user;\nb)\tthe MCPTT ID of the listening MCPTT user; and\nc)\tthe value of the ambient listening type.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.7\tRemotely initiated private call",
                            "text_content": "Clause 11.1.7 describes the MCPTT client procedures, the participating MCPTT function procedures and the controlling MCPTT function procedures for the on-network remotely initiated private call functionality.\nIn the procedures of clause 11.1.7.2, clause 11.1.7.3, and clause 11.1.7.4:\n-\tthe term \"requesting MCPTT user\" is used to refer to the MCPTT user who sent a request to initiate a remotely initiated private call;\n-\tthe term \"remote MCPTT user\" is used to refer to the MCPTT user who is sent a request to initiate a remotely initiated private call; and\n-\tthe term \"identified MCPTT user\" is used to refer to the MCPTT user to be invited to the remotely initiated private call.\nUpon receiving a request from the requesting MCPTT user to send a remotely initiated private call request to the remote MCPTT user to originate a private call to an identified MCPTT user, the MCPTT client:\n1)\tif:\na)\tthe <allow-request-remote-init-private-call> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a remotely initiated private call request to the remote MCPTT user; and\nb)\tshall skip the rest of the steps of the present clause;\n2)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-called-party-id> element set to the MCPTT ID of the identified MCPTT user of the remotely initiated private call; and\nii)\tan <anyExt> element containing:\nA)\tthe <request-type> element set to a value of \"remotely-initiated-private-call-request\";\nB)\tthe <notify-remote-user> element set to a value of \"true\" if the requesting MCPTT user has indicated that the remote MCPTT user be notified of the remotely initiated private call request;\nC)\tthe <notify-remote-user> element set to a value of \"false\" if the requesting MCPTT user has indicated that the remote MCPTT user not be notified of the remotely initiated private call request;\nD)\tmay include <ric-app-level-priority> element set to a value of the namespace and priority values as specified in IETF RFC 8101 [48] and MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) to be used by the remote MCPTT user to request an application level priority while initiating a call as a result of received remotely initiated call request; and\nE)\tmay include <ric-commencement-mode> element set to:\nI)\ta value of \"force-auto-mode\", if the requesting MCPTT user has indicated that the remote MCPTT user to request the force of automatic commencement mode at the invited MCPTT client while initiating a call as a result of received remotely initiated call request;\nII)\ta value of \"auto-mode\", if the requesting MCPTT user has indicated that the remote MCPTT user to request the automatic commencement mode at the invited MCPTT client while initiating a call as a result of received remotely initiated call request; or\nIII)\ta value of \"manual-mode\", if the requesting MCPTT user has indicated that the remote MCPTT user to request the manual commencement mode at the invited MCPTT client while initiating a call as a result of received remotely initiated call request;\ne)\tshall insert in the SIP MESSAGE request a application/resource-lists+xml MIME body with the MCPTT ID of the remote MCPTT user, according to rules and procedures of IETF RFC 5366 [20]; and\nf)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n3)\tshall send the SIP MESSAGE request towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, should indicate to the requesting MCPTT user the failure of the sent remotely initiated private call request and not continue with the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for remotely initiated private call response for terminating client\", the MCPTT client:\n1)\tshall determine the success or failure of the sent remotely initiated private call request from the value of the <remotely-initiated-call-outcome> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request; and\n2)\tshould indicate to the requesting MCPTT user the success or failure of the sent remotely initiated private call request.\nUpon receiving a \"SIP MESSAGE request for remotely initiated private call request for terminating client\", the MCPTT client:\n1)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"true\", may indicate to the remote MCPTT user that a remotely initiated private call request to call the identified MCPTT user has been received;\n2)\tshall extract the MCPTT ID of the identified MCPTT user from the <mcptt-called-party-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request;\n3)\tif according to local policy on-demand sessions are to be used for remotely initiated private calls, shall invoke the procedures of clause 11.1.1.2.1.1 to originate an MCPTT private call to the identified MCPTT user with the following clarifications:\na)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"false\":\ni)\tshall not indicate to the remote MCPTT user that a remotely initiated private call request to call the identified MCPTT user has been received; and\nii)\tif a SIP 180 (Ringing) response or SIP 183 (Session Progress) response is received to the to the sent SIP INVITE request, shall not give any indication to the remote MCPTT user that the remotely initiated private call origination is in progress;\nb)\tif the <ric-app-level-priority> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of the namespace and priority value, may include Resource-Priority header field in the initial SIP INVITE request with the value received in the <ric-app-level-priority> element; and\nc)\tif the <ric-commencement-mode> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to:\ni)\ta value of \"force-auto-mode\", may include in the initial SIP INVITE request a privileged answer mode with auto commencement mode (i.e. a Priv-Answer-Mode header field with the value \"Auto\") to force of automatic commencement mode at the invited MCPTT client;\nii)\ta value of \"auto-mode\", may include in the initial SIP INVITE request a answer mode with auto commencement mode (i.e. a Answer-Mode header field with the value \"Auto\") to request automatic commencement mode at the invited MCPTT client; or\niii)\ta value of \"manual-mode\", may include in the initial SIP INVITE request a answer mode with manual commencement mode (i.e. a Answer-Mode header field with the value \"Manual\") to request manual commencement mode at the invited MCPTT client; and\n4)\tif according to local policy pre-established sessions are to be used for remotely initiated private calls and a pre-established session is available, shall invoke the procedures of clause 11.1.1.2.2.1 to originate an MCPTT private call to the identified MCPTT user with the following clarifications:\na)\tif the <notify-remote-user> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of \"false\":\ni)\tshall not indicate to the remote MCPTT user that a remotely initiated private call request to call the identified MCPTT user has been received; and\nii)\tshall not give any indication to the remote MCPTT user that the remotely initiated private call origination is in progress.\nb)\tif the <ric-app-level-priority> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set to a value of the namespace and priority value, may include Resource-Priority header field in the initial SIP REFER request with the value received in the <ric-application-level-priority> element; and\nc)\tif the <ric-commencement-mode> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request is set:\ni)\tto value of \"force-auto-mode\", may include in the initial SIP REFER request a privileged answer mode with auto commencement mode (i.e. a Priv-Answer-Mode header field with the value \"Auto\") to force of automatic commencement mode at the invited MCPTT client;\nii)\tto value of \"auto-mode\", may include in the initial SIP REFER request a answer mode with auto commencement mode (i.e. a Answer-Mode header field with the value \"Auto\") to request automatic commencement mode at the invited MCPTT client; or\niii)\tto value of \"manual-mode\", may include in the initial SIP REFER request to answer mode with manual commencement mode (i.e. a Answer-Mode header field with the value \"Manual\") to request manual commencement mode at the invited MCPTT client.\nUpon completion of the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1, the MCPTT client:\n1)\tif:\na)\tthe MCPTT ID of the identified MCPTT user is identical to the <mcptt-calling-user-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request: and\nb)\tthe procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were successful in originating an MCPTT private call to the identified MCPTT user;\nthen:\na)\tshall skip the remaining steps of the current clause;\nNOTE:\tIn this case, it is not necessary to send a response to the sender of the remotely initiated private call request as the sender and the terminating party of the successful private call origination are the same user and will be aware of the request's outcome.\n2)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-called-party-id> set to the MCPTT ID of the identified MCPTT user called by the remote MCPTT user; and\nii)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"remotely-initiated-private-call-response\";\nB)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were successful in originating an MCPTT private call to the identified MCPTT user, a <remotely-initiated-call-outcome> element set to a value of \"success\"; and\nC)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were not successful in originating an MCPTT private call to the identified MCPTT user, a <remotely-initiated-call-outcome> element set to a value of \"fail\";\n3)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n4)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a \"SIP MESSAGE request for remotely initiated private call for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif:\na)\tthe \"SIP MESSAGE request for remotely initiated private call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"remotely-initiated-private-call-request; and\nb)\tif the <allow-request-remote-init-private-call> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"158 user not authorised to request a remotely initiated private call\" in a Warning header field as specified in clause 4.4, and not continue with the rest of the steps in this clause;\n4)\tshall determine the public service identity of the controlling MCPTT function for the remotely initiated private call service for the requesting MCPTT user;\n5)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n6)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function associated with the remotely initiated private call service for the requesting MCPTT user;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the remotely initiated private call service for the requesting MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n7)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n8)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body the MCPTT ID determined in step 2) above;\n9)\tshall copy the contents of the application/resource-lists+xml MIME body in the received SIP MESSAGE request into an application/resource-lists+xml MIME body in the outgoing SIP MESSAGE request;\n10)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n11)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n12)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n13)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n14)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 13), the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the error response to the MCPTT client.\nUpon receiving a \"SIP MESSAGE request for remotely initiated private call for terminating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response and skip the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP INVITE request; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall forward the SIP 2xx response to the controlling MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the response to the controlling MCPTT function.\nUpon receiving a:\n-\t\"SIP MESSAGE request for remotely initiated private call request for controlling MCPTT function\"; or\n-\t\"SIP MESSAGE request for remotely initiated private call response for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tif the incoming SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or contains an application/resource-lists+xml MIME body with more than one <entry> element in all <list> elements of the <resource-lists> element, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\n8)\tshall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP MESSAGE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\n9)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user identified by the MCPTT ID contained in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n10)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n11)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\n12)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.8\tPrivate call transfer",
                            "text_content": "In the procedures of clause 11.1.8:\n-\tthe term \"requesting MCPTT user\" is used to refer to the MCPTT user who sent a request to initiate a private call transfer;\n-\tthe term \"transferred MCPTT user\" is used to refer to the MCPTT user who is being transferred to the new target MCPPT user; and\n-\tthe term \"target MCPTT user\" is used to refer to the MCPTT user that is the new target of the private call.\nUpon receiving a request from an MCPTT user to transfer an ongoing MCPTT private call to a target MCPTT user, the MCPTT client:\n1)\tif:\na)\tthe <allow-call-transfer> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a private call transfer request; and\nb)\tshall skip the rest of the steps of the present clause;\n2)\tif the request from the MCPTT user is for an announced transfer of an ongoing MCPTT private call to a target MCPTT user, shall follow the procedure of clause 11.1.8.2.3;\n3)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-called-party-id> element set to MCPTT ID of the target MCPTT user; and\nii)\tan <anyExt> element containing:\nA)\tthe <request-type> element set to a value of \"transfer-private-call-request\"; and\nB)\tif the call is requested to be transferred to a functional alias and the MCPTT client is aware of active functional aliases, then the <call-to-functional-alias-ind> element set to \"true\"; otherwise, the <call-to-functional-alias-ind> element set to \"false\";\nC)\tif the request from the MCPTT user is for an announced transfer, and the incoming SIP INVITE request contained a Supported header field containing an option tag \"replaces\", and, if present, the <replaces-header-value> element set to content copied from the call to the target MCPTT user provided in step 2;\nNOTE:\tFor a call transfer to a MCPTT ID the value is the MCPTT ID of the target user, while for call transfer to a functional alias the value is the functional alias of the target user.\ne)\tshall insert in the SIP MESSAGE request an application/resource-lists+xml MIME body with the MCPTT ID of the transferred MCPTT user, according to rules and procedures of IETF RFC 5366 [20]; and\nf)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n4)\tshall send the SIP MESSAGE request towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, should indicate to the requesting MCPTT user the failure of the sent private call transfer request and skip the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for transfer private call response for terminating client\", the MCPTT client:\n1)\tshall determine the success or failure of the sent transfer private call request from the value of the <transfer-call-outcome> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request and generate and send a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n2)\tif the outcome of the private call transfer is a success, the MCPTT client shall invoke the procedures of clause 11.1.3.1 to end the MCPTT private call with the transferred MCPTT user; and\na)\tif the request from the MCPTT user is for an announced private call transfer, shall invoke the procedures of clause 11.1.3.1 to end the MCPTT private call with the target MCPTT user;and\n3)\tshould indicate to the requesting MCPTT user the success or failure of the sent private call transfer request.\nUpon receiving a \"SIP MESSAGE request for transfer private call request for terminating client\", the MCPTT client:\n1)\tshould indicate to the transferred MCPTT user that a request to transfer the previously ongoing call to a new target MCPTT user has been received;\n2)\tshall extract the MCPTT ID of the target MCPTT user from the <mcptt-called-party-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request;\n3)\tif present in the received SIP MESSAGE request, shall extract the content of the <replaces-header-value> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request;\n4)\tif according to local policy on-demand sessions are to be used for transfer of private calls, shall invoke the procedures of clause 11.1.1.2.1.1 to originate an MCPTT private call to the target MCPTT user; and\n5)\tif according to local policy pre-established sessions are to be used for transfer of private calls and a pre-established session is available, shall invoke the procedures of clause 11.1.1.2.2.1 to originate an MCPTT private call to the target MCPTT user;\nUpon completion of the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1, the MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-called-party-id> set to the MCPTT ID of the target MCPTT user called by the transferred MCPTT user; and\nii)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"transfer-private-call-response\";\nB)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were successful in originating an MCPTT private call to the identified MCPTT user, a <transfer-call-outcome> element set to a value of \"success\"; and\nC)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were not successful in originating an MCPTT private call to the identified MCPTT user, a <transfer-call-outcome> element set to a value of \"fail\";\n2)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the transferred MCPTT user; and\n3)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nThis clause describes the procedures for transferring an MCPTT private call for both cases if a call to the target MCPTT user is already established or not.\nWhen the MCPTT user requests an announced private call transfer of an ongoing private MCPTT call, the MCPTT client:\n1)\tshall put the ongoing MCPTT private call with the transferred MCPTT user on hold following the procedures as described in RFC 5359, clause 2.1;\n2)\tIf the requesting MCPTT user does not have a call to the target MCPTT user established:\na)\tshall initiate an on-demand private call as specified in clause 11.1.1.2.1, or a private call using pre-established session as specified in clause 11.1.1.2.2 to the target MCPTT user with the following clarification:\ni)\tshall include a <transfer-announced-ind> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body;\nb) if present in the the 200 (OK) response received for the MCPTT call in step 2a, shall provide the content of the <replaces-header-value> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body to the procedure in clause 11.1.8.2.1;\nc)\tonce the call to the target MCPPT user is established, the MCPTT client should notify the requesting MCPTT user to announce the call transfer to the target MCPTT user;\nd)\tif no <replaces-header-value> element was received in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the 200 (OK) response message in step 2a, shall terminate the MCPTT private call with the target user as specified in clause 11.1.3; and\ne)\tshould offer the MCPTT user the option to retrieve the ongoing call with the transferred MCPTT user, to announce the transfer to the calling MCPTT user.\n3)\tIf the requesting MCPTT user already has a call to the target MCPTT user established:\na)\tshall generate a SIP re-INVITE request to be sent towards the target MCPTT user as specified in 3GPP TS 24.229 [4], with the following clarification:\ni)\tshall include a <transfer-announced-ind> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body set to a value of \"true\": and\nii)\tshall include an SDP offer with the media parameters as currently established according to 3GPP TS 24.229 [4];\nb)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4];\nc)\tif present in the the 200 (OK) response received for the SIP re-INVITE request in step 3a, shall provide the content of the <replaces-header-value> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body to the procedure in clause 11.1.8.2.1; and\nd)\tif no <replaces-header-value> element was received in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the 200 (OK) response message of the SIP re-INVITE request in step 3a, should indicate to the requesting MCPTT user failure of invoking the private call transfer request and shall not continue with the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for transfer private call for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tif:\na)\tthe \"SIP MESSAGE request for transfer private call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"transfer-private-call-request\"; and\nb)\tif the <allow-call-transfer> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"170 user not authorised to make a private call transfer request\" in a Warning header field as specified in clause 4.4, and skip the rest of the steps;\n5)\tif the \"SIP MESSAGE request for transfer private call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"transfer-private-call-request\" and:\na)\tif the <allow-call-transfer-to-any-user> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\"; and\ni)\tif the call is transferred to an MCPTT ID and the <mcptt-called-party-id> element does not match the <uri-entry> element of one of the <entry> elements of the <AllowedMCPTTIdsForCallTransfer> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]); or\nii)\tif the call is transferred to a functional alias and the <mcptt-called-party-id> element does not match the <uri-entry> element of one of the <entry> elements of the <AllowedFunctionalAliasesForCallTransfer> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nthen:\na)\tshall reject the \"SIP MESSAGE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response including warning text set to \"170 user not authorised to make a private call transfer request\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\n6)\tshall determine the public service identity of the controlling MCPTT function for the private call transfer service for the requesting MCPTT user;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the private call transfer service for the requesting MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n7)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n8)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 6);\n9)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n10)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n11)\tshall copy the contents of the application/resource-lists+xml MIME body in the received SIP MESSAGE request into an application/resource-lists+xml MIME body in the outgoing SIP MESSAGE request;\n12)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n13)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n14)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n15)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n16)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 16), the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, the participating MCPTT function shall forward the error response to the MCPTT client.\nUpon receiving a\n-\t\"SIP MESSAGE request for transfer private call request for terminating participating MCPTT function\"; or\n-\t\"SIP MESSAGE request for transfer private call response for terminating participating MCPTT function\";\nthe participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response and skip the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tif the \"SIP MESSAGE request for transfer private call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"transfer-private-call-request\"\na)\tshall extract the MCPTT ID of the target MCPTT user from the <mcptt-called-party-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request;\nb)\tshall cache the mapping of the MCPTT ID used in step 2) and target MCPTT ID extracted in step a);\nNOTE 1:\tIf multiple private calls transfers are in progress at the same time for the same user, multiple mappings have to be stored.\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n7)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receiving a:\n-\t\"SIP MESSAGE request for transfer private call request for controlling MCPTT function\"; or\n-\t\"SIP MESSAGE request for transfer private call response for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tif the incoming SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or contains an application/resource-lists+xml MIME body with a total of more than one <entry> element in all <list> elements of the <resource-lists> element, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\n8)\tif the incoming SIP MESSAGE request contains in the application/vnd.3gpp. mcptt-info+xml MIME body <call-to-functional-alias-ind> set to \"true\" shall identify the MCPTT ID(s) of the MCPTT user(s) that have activated the received functional alias by performing the actions specified in clause 9A.2.2.2.8:\na)\tif the functional alias is not activated by any MCPTT user, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\nb)\tif the functional alias is activated by one MCPTT user, shall use the MCPTT ID of that user as new target MCPTT ID;\nc)\tif the functional alias is simultaneously activated by multiple MCPTT users, shall select an appropriate MCPTT ID based on local policy. The selection of an appropriate MCPTT ID is left to implementation. The outcome of the selection includes rejection. Upon completion of the selection process,:\ni)\tif the controlling MCPTT function was unable to select an MCPTT ID, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps; or\nii)\tif the selection process concluded by selecting an appropriate MCPTT ID, this MCPTT ID shall be used as new target MCPTT ID;\nd)\tshall copy the new target MCPTT ID into the <mcptt-called-party-id> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request.\ne)\tshall set <call-to-functional-alias-ind> to \"false\" in the application/vnd.3gpp. mcptt-info+xml MIME body of the outgoing SIP message;\n9)\tshall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP MESSAGE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\n10)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user identified by the MCPTT ID contained in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n11)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n12)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controling MCPTT function; and\n13)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.1.9\tPrivate call forwarding",
                            "text_content": "In the procedures of clause 11.1.9:\n-\tthe term \"forwarded-calling-client\" is used to refer to the originating MCPTT client who has made a private call attempt that is being forwarded;\n-\tthe term \"forwarded-by-client\" is used to refer to the MCPTT client to whom a private call has been placed and who has requested that the private call be forwarded either through settings at its participating MCPTT function or through manual user input; and\n-\tthe term \"forwarded-to-client\" is used to refer to the terminating MCPTT client to whom a private call attempt is being forwarded\nThe following procedure covers the case when an MCPTT user decides to forward an incoming MCPTT private call to a new target MCPTT ID or functional alias based on manual user input instead of accepting the incoming MCPTT private call. If the MCPTT user decides to forward an incoming MCPTT private call to a new target MCPTT ID or functional alias based on manual user input, the MCPTT client:\nNOTE 1:\tForwarding an MCPTT private call based on manual user input is only possible for manual commencement mode.\n1)\tif:\na)\tthe <allow-call-fwd-manual-any> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshould indicate to the requesting MCPTT user that the requesting MCPTT user is not authorised to initiate a private call forwarding request; and\nb)\tshall skip the rest of the steps of the present clause;\n1A)\tif the incoming SIP INVITE request contains a <forwarding-other-list> element with one or more <entry> elements should indicate to the requesting MCPTT user that the maximum number of allowed forwardings is exceeded and shall skip the rest of the steps of the present clause;\n2)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tan <anyExt> element containing:\nA)\tthe <request-type> element set to a value of \"forward-private-call-request\";\nB)\tif the call is requested to be forwarded to a functional alias and the MCPTT client is aware of active functional aliases, then the <call-to-functional-alias-ind> element set to \"true\"; otherwise, the <call-to-functional-alias-ind> element set to \"false\";\nNOTE 2:\tFor call forwarding to an MCPTT ID the value of the <forwarding-target-orig-id> is the MCPTT ID of the target user, while for call forwarding to a functional alias the value is the functional alias of the target user.\nC)\tthe <forwarding-reason> element set to a value of \"manual-input\";\nD)\tthe <forwarded-by-functional-alias> set to the <called-functional-alias-URI> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request, if present;\nE)\tthe <forwarded-by-mcptt-id> element set to the MCPTT ID present in the <mcptt-request-uri> received in the SIP application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request; and\nF)\tthe <forwarding-target-orig-id> element set to the MCPTT ID or the functional alias to be used of the target MCPTT user;\ne)\tshall insert in the SIP MESSAGE request an application/resource-lists+xml MIME body with the MCPTT ID of the forwarded-calling-client MCPTT user, according to rules and procedures of IETF RFC 5366 [20]; and\nf)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n4)\tshall send the SIP MESSAGE request towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nNOTE 3:\tThe SIP MESSAGE is sent towards the client of the forwarded MCPTT user. The procedure how to process this incoming SIP MESSAGE is descibed in clause 11.1.9.2.2. Clause 11.1.9.2.2 also contains references to clause 11.1.1.2.1.1 and clause 11.1.1.2.2.1 describing how to originate an MCPTT private call from the forwarded MCPTT user to the target MCPTT.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, should indicate to the requesting MCPTT user the failure of the sent private call forwarding request and skip the rest of the steps.\nUpon receiving a \"SIP MESSAGE request for forwarding private call response for terminating client\", the MCPTT client:\n1)\tshall determine the success or failure of the sent forwarding private call request from the value of the <forwarding-call-outcome> element contained in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body included in the received SIP MESSAGE request and generate and send a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4]; and\n2)\tshould indicate to the requesting MCPTT user the success or failure of the sent private call forwarding request.\nUpon receiving a \"SIP MESSAGE request for forwarding private call request for terminating client\", the MCPTT client:\n1)\tshould indicate to the forwarded MCPTT user that a request to forward the previously initiated call to a new target MCPTT user has been received;\n2)\tshall extract the MCPTT ID of the target MCPTT user from the <mcptt-called-party-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request;\n3)\tif according to local policy on-demand sessions are to be used for forwarding of private calls, shall invoke the procedures of clause 11.1.1.2.1.1 to originate an MCPTT private call to the target MCPTT user; and\n4)\tif according to local policy pre-established sessions are to be used for forwarding of private calls and a pre-established session is available, shall invoke the procedures of clause 11.1.1.2.2.1 to originate an MCPTT private call to the target MCPTT user.\nUpon completion of the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1, the MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the following clarifications:\na)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\nd)\tshall include in a \"uri\" attribute of <entry> element of a <list> element of the <resource-lists> element of an application/resource-lists+xml MIME body the MCPTT ID contained in the <mcptt-calling-user-id> element in the application/ vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request; and\ne)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element containing:\ni)\tthe <mcptt-called-party-id> set to the MCPTT ID of the forwarded-to-client called by theforwarded-calling-client; and\nii)\tan <anyExt> element containing:\nA)\tthe <response-type> element set to a value of \"forwarding-private-call-response\";\nB)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were successful in originating an MCPTT private call to the identified MCPTT user, a <forwarding-call-outcome> element set to a value of \"success\"; and\nC)\tif the procedures of clause 11.1.1.2.1.1 or clause 11.1.1.2.2.1 were not successful in originating an MCPTT private call to the identified MCPTT user, a <forwarding-call-outcome> element set to a value of \"fail\";\n2)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving theforwarded-by-client; and\n3)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receiving a \"SIP MESSAGE request for forwarding private call for originating participating MCPTT function\" the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tif:\na)\tthe \"SIP MESSAGE request for forwarding private call for originating participating MCPTT function\" contains the <request-type> element set to a value of \"forward-private-call-request\"; and\nb)\tif the <allow-call-forward-manual-input> element of the <ruleset> element is not present in the requesting MCPTT user's MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) or is set to a value of \"false\";\nthen:\na)\tshall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"173 user not authorised to make a private call forwarding request\" in a Warning header field as specified in clause 4.4, and skip the rest of the steps;\n5)\tshall determine the public service identity of the controlling MCPTT function for the forwarding private call service for the requesting MCPTT user;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the private call forwarding service for the requesting MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n7)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 5);\n8)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n9)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n10)\tshall copy the contents of the application/resource-lists+xml MIME body in the received SIP MESSAGE request into an application/resource-lists+xml MIME body in the outgoing SIP MESSAGE request;\n10a)\tshall set the <forwarded-by-mcptt-id> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request to the MCPTT ID determined in step 2:\n11)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\n12)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n13)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n14)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n15)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 15), the participating MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the MCPTT client.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, shall forward the error response to the MCPTT client.\nUpon receiving a\n-\t\"SIP MESSAGE request for forwarding private call request for terminating participating MCPTT function\"; or\n-\t\"SIP MESSAGE request for forwarding private call response for terminating participating MCPTT function\";\nthe participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response and skip the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11;\n5)\tif the \"SIP MESSAGE request for forwarding private call for terminating participating MCPTT function\" contains the <request-type> element set to a value of \"forward-private-call-request\":\na)\tshall extract the MCPTT ID of the target MCPTT user from the <mcptt-called-party-id> element contained in the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body contained in the received SIP MESSAGE request; and\nb)\tshall cache the mapping of the MCPTT ID used in step 2) and target MCPTT ID extracted in step a);\nNOTE:\tIf multiple private call forwardings are in progress at the same time for the same user, multiple mappings have to be stored.\n6)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), into the P-Asserted-Service header field of the outgoing SIP MESSAGE request; and\n7)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receiving a:\n-\t\"SIP MESSAGE request for forwarding private call request for controlling MCPTT function\"; or\n-\t\"SIP MESSAGE request for forwarding private call response for controlling MCPTT function\";\nthe controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n3)\tif the incoming SIP MESSAGE request does not contain an application/resource-lists+xml MIME body or contains an application/resource-lists+xml MIME body with a total of more than one <entry> element in all <list> elements in the <resource-lists> element, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n4)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n7)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\n8)\tif the incoming SIP MESSAGE is a SIP MESSAGE request for forwarding private call request for controlling MCPTT function:\na)\tshall copy the value of the <forwarding-target-orig-id> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request into the <forwarding-target-id> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\nb)\tif the incoming SIP MESSAGE request contains in the application/vnd.3gpp. mcptt-info+xml MIME body <call-to-functional-alias-ind> set to \"true\" shall identify the MCPTT ID(s) of the MCPTT user(s) that have activated the received functional alias by performing the actions specified in clause 9A.2.2.2.8:\ni)\tif the functional alias is not activated by any MCPTT user, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\nii)\tif the functional alias is activated by one MCPTT user, shall use the MCPTT ID of that user as the new target MCPTT ID;\niii)\tif the functional alias is simultaneously activated by multiple MCPTT users, shall select an appropriate MCPTT ID based on local policy. The selection of an appropriate MCPTT ID is left to implementation. The outcome of the selection includes rejection. Upon completion of the selection process:\nA)\tif the controlling MCPTT function was unable to select an MCPTT ID, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response including warning text set to \"145 unable to determine called party\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps; and\nB)\tif the selection process concluded by selecting an appropriate MCPTT ID, this MCPTT ID shall be used as new target MCPTT ID;\niv)\tshall copy the new target MCPTT ID into the < forwarding-target-id > element in the <mcptt-Params> element of the <mcpttinfo> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\nv)\tshall set <call-to-functional-alias-ind> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp. mcptt-info+xml MIME body of the outgoing SIP message to \"false\"; and\nvi)\tshall include a <forwarding-target-is-functional-alias> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request with a value set to \"true\";\nc)\tif the incoming SIP MESSAGE request does not contain a <call-to-functional-alias-ind> element in the application/vnd.3gpp. mcptt-info+xml MIME body, or if it is present and set to \"false\" shall set the <forwarding-target-is-functional-alias> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request with a value set to “false”;\n9) shall copy the MCPTT ID of the MCPTT user listed in the MIME resources body of the incoming SIP MESSAGE request, into the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\n10)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user identified by the MCPTT ID contained in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP MESSAGE request;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system.\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the terminating participating MCPTT function associated with the targeted MCPTT user or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n11)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n12)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\n13)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall generate a SIP 200 (OK) response and forward the SIP 200 (OK) response to the originating participating MCPTT function.\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the SIP MESSAGE request, controlling MCPTT function shall forward the error response to the originating participating MCPTT function.\n\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "11.2\tOff-network private call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "11.2.1\tGeneral",
                            "text_content": "In order to participate in a private call, the MCPTT client:\n1)\tshall send the MONP message as a UDP message to the local IP address of the MCPTT user, to UDP port 8809, with an IP time-to-live set to 255; and\n2)\tshall treat UDP messages received on the port TBD as received 8809 messages.\nNOTE:\tAn MCPTT client that supports IPv6 shall listen to the IPv6 addresses.\nFor an off-network MCPTT session, only MCPTT speech is used.\nOne off-network MCPTT session includes one media-floor control entity.\nThe MCPTT client shall generate an SDP body for a private call in accordance with rules and procedures of IETF RFC 4566 [12] and IETF RFC 3264 [44].\nThe MCPTT client:\n1)\tshall include in the session-level section:\na)\tthe \"o=\" field with the <username> portion set to a dash;\nb)\tthe \"s=\" field with the <session name> portion set to a dash; and\nc)\tthe \"c=\" field with the <nettype> portion set to \"IN\", the <addrtype> portion set to the IP version of the unicast IP address of the MCPTT client and the <connection-address> portion set to the unicast IP address of the MCPTT client;\n2)\tshall include the media-level section for MCPTT speech consisting of:\na)\tthe \"m=\" field with the <media> portion set to \"audio\", the <port> portion set to a port number for MCPTT speech of the MCPTT group, the <proto> field set to \"RTP/AVP\" and <fmt> portion set indicating RTP payload type numbers;\nb)\tthe \"i=\" field with the <session description> portion set to \"speech\";\nc)\tthe \"a=fmtp:\" attribute(s), the \"a=rtpmap:\" attribute(s) or both, indicating the codec(s) and media parameters of the MCPTT speech; and\nd)\tthe \"a=rtcp:\" attribute indicating port number to be used for RTCP at the MCPTT client selected according to the rules and procedures of IETF RFC 3605 [13], if the media steam uses other than the default IP address;\n3)\tshall include the media-level section for media-floor control entity consisting of:\na)\tan \"m=\" line, with the <media> portion set to \"application\", the <port> portion set to a port number for media-floor control entity of the MCPTT group, the <proto> field set to \"udp\" and <fmt> portion set to \"MCPTT\"; and\nb)\tthe \"a=fmtp:MCPTT\" attribute indicating the parameters of the media-floor control entity as specified 3GPP TS 24.380 [5]; and\n4)\tshall include the MIKEY-SAKKE I_MESSAGE, if generated by the MCPTT client, in an \"a=key-mgmt\" attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF RFC 4567 [47].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.2\tBasic call control",
                            "text_content": "The maximum number of simultaneous off-network private calls is limited by the value of \"/<x>/Common/PrivateCall/MaxCallN10\" leaf node present in the UE configuration as specified in 3GPP TS 24.483 [45].\nThe figure 11.2.2.2-1 gives an overview of the main states and transitions on the UE for private call control.\nEach private call control state machine is per MCPTT user ID.\nThe figure depicts a private control state machine, which is a crucial component in the design of a control system. It is used to manage the state of a system and ensure that it remains within a desired range. The diagram shows the various states and their corresponding actions, such as start, stop, and reset, which are essential for the proper functioning of the system. The use of a control state machine in this context ensures that the system can be easily monitored and controlled, making it a valuable tool in the design of control systems.\nFigure 11.2.2.2-1: Private call control state machine\nIn this state, no private call control entity exists.\nThis state exists for UE, when the UE is not part of an ongoing private call.\nThis state exists for UE, when the UE has sent a PRIVATE CALL SETUP REQUEST message and is waiting for a response, PRIVATE CALL ACCEPT or PRIVATE CALL REJECT message.\nThis state exists for UE, when the UE has sent a PRIVATE CALL RELEASE message and is waiting for a PRIVATE CALL RELEASE ACK message.\nThis state exists for UE, when the UE is part of an ongoing private call.\nThis state exists for UE, when the UE has presented a notification to the user for the received PRIVATE CALL SETUP REQUEST message and is waiting for a user indication.\nWhen in the \"P0: start-stop\" state or \"P1: ignoring same call id\", upon an indication from MCPTT User to initiate a private call and the value of \"/<x>/<x>/Common/PrivateCall/Authorised\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\", the MCPTT client:\n1)\tshall generate and store the call identifier as a random number uniformly distributed between (0, 65536);\n2)\tshall store own MCPTT user ID as caller ID;\n3)\tshall store MCPTT user ID of the callee as callee ID;\n4)\tshall store \"AUTOMATIC COMMENCEMENT MODE\" as commencement mode, if requested and the value of \"/<x>/<x>/Common/PrivateCall/AutoCommence\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise if the value of \"/<x>/<x>/Common/PrivateCall/ManualCommence\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\", store \"MANUAL COMMENCEMENT MODE\" as commencement mode;\n5)\tshall create a call type control state machine as described in clause 11.2.3.2;\n6)\tif an end-to-end security context needs to be established then:\na)\tshall use keying material provided by the key management server to generate a PCK as described in 3GPP TS 33.180 [78];\nb)\tshall use the PCK to generate a PCK-ID with the four most significant bits set to \"0001\" to indicate that the purpose of the PCK is to protect private call communications and with the remaining twenty eight bits being randomly generated as described in 3GPP TS 33.180 [78];\nc)\tshall encrypt the PCK to a UID associated to the MCPTT client using the MCPTT ID and KMS URI of the invited user as determined by the procedures of clause 6.2.8.3.9 and a time related parameter as described in 3GPP TS 33.180 [78];\nd)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-ID as specified in 3GPP TS 33.180 [78];\ne)\tshall add the MCPTT ID of the originating MCPTT user to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nf)\tshall sign the MIKEY-SAKKE I_MESSAGE using the originating MCPTT user's signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78] and;\ng)\tshall store the MIKEY-SAKKE I_MESSAGE for later inclusion in an SDP body;\n7)\tmay store current user location as user location;\n8)\tshall generate and store offer SDP, as defined in clause 11.2.1.1.2;\n9)\tshall generate a PRIVATE CALL SETUP REQUEST message as specified in clause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:\na)\tshall set the Call identifier IE with the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\nd)\tshall set the Commencement mode IE with the stored commencement mode;\ne)\tshall set the Call type IE with the stored current call type associated with the call type control state machine;\nf)\tshall set the SDP offer IE with the stored offer SDP; and\ng)\tmay set the User location IE with the stored user location if the stored current call type associated with the call type control state machine is \"EMERGENCY PRIVATE CALL\".\n10)\tshall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT client according to rules and procedures as specified in clause 11.2.1.1.1;\n11)\tshall initialize the counter CFP1 (private call request retransmission) with the value set to 1;\n12)\tshall start timer TFP1 (private call request retransmission);\n13)\tif in \"P1: ignoring same call id\" state, shall stop timer TFP7 (waiting for any message with same call identifier); and\n14)\tshall enter the \"P2: waiting for call response\" state.\nWhen in the \"P2: waiting for call response\" state, upon expiry of timer TFP1 (private call request retransmission) and the value of the counter CFP1 (private call request retransmission) is less than the upper limit, the MCPTT client:\n1)\tmay update the stored user location with current user location;\n2)\tshall increment the value of counter CFP1 (private call request retransmission) by 1;\n3)\tshall generate a PRIVATE CALL SETUP REQUEST message as specified in clause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:\na)\tshall set the Call identifier IE with the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\nd)\tshall set the Commencement mode IE with the stored commencement mode;\ne)\tshall set the Call type IE with the stored current call type associated with the call type control state machine;\nf)\tshall set the SDP offer IE with the stored offer SDP; and\ng)\tmay set the User location IE with stored user location if the stored current call type is \"EMERGENCY PRIVATE CALL\" associated with the call type control state machine.\n4)\tshall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT client according to rules and procedures as specified in clause 11.2.1.1.1;\n5)\tshall start timer TFP1 (private call request retransmission); and\n6)\tshall remain in the \"P2: waiting for call response\" state.\nWhen in the \"P2: waiting for call response\" state, upon receiving a PRIVATE CALL RINGING message, the MCPTT client:\n1)\tshall remain in the \"P2: waiting for call response\" state.\nIn the \"P2: waiting for call response\" state, when timer TFP1 (private call request retransmission) expires and the value of the counter CFP1 (private call request retransmission) is equal to the upper limit and the stored commencement mode is \"AUTOMATIC COMMENCEMENT MODE\", the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall release the call type control state machine; and\n3)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P2: waiting for call response\" state when timer TFP1 (private call request retransmission) expires and the value of the counter CFP1 (private call request retransmission) is equal to the upper limit and the stored commencement mode is \"MANUAL COMMENCEMENT MODE\", the MCPTT client:\n1)\tshall start timer TFP9 (waiting for call response message); and\n2)\tshall remain in the \"P2: waiting for call response\" state.\nWhen in the \"P2: waiting for call response\" state, upon expiry of timer TFP9 (waiting for call response message), the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall release the call type control state machine; and\n3)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P2: waiting for call response\" state, upon receiving a PRIVATE CALL REJECT message in response to PRIVATE CALL SETUP REQUEST message with Call identifier IE same as the stored call identifier, the MCPTT client:\n1)\tshall stop timer TFP1 (private call request retransmission), if running;\n2)\tshall stop timer TFP9 (waiting for call response message), if running;\n3)\tshall start timer TFP7 (waiting for any message with same call identifier);\n4)\tshall release the call type control state machine; and\n5)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P2: waiting for call response\" state, upon receiving a PRIVATE CALL ACCEPT message response to PRIVATE CALL SETUP REQUEST message with the same call identifier, the MCPTT client:\n1)\tshall store the SDP answer IE received in the PRIVATE CALL ACCEPT message as answer SDP;\n2)\tshall generate a PRIVATE CALL ACCEPT ACK message as specified in clause 15.1.11:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID.\n3)\tshall send the PRIVATE CALL ACCEPT ACK message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n4)\tshall stop timer TFP1 (private call request retransmission), if running;\n5)\tshall stop timer TFP9 (waiting for call response message), if running;\n6)\tshall establish a media session based on the SDP body of the stored answer SDP;\n7)\tshall start floor control as originating floor participant as specified in clause 7.2 in 3GPP TS 24.380 [5];\n8)\tshall start timer TFP5 (max duration); and\n9)\tshall enter the \"P4: part of ongoing call\" state.\nWhen in the \"P2: waiting for call response\" state, upon an indication from MCPTT User to cancel the private call request, the MCPTT client:\n1)\tshall generate a PRIVATE CALL RELEASE message as specified in clause 15.1.9;\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\n2)\tshall send the PRIVATE CALL RELEASE message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall stop timer TFP1 (private call request retransmission);\n4)\tshall stop timer TFP9 (waiting for call response message);\n5)\tshall start timer TFP3 (private call release retransmission);\n6)\tshall initialize the counter CFP3 with value set to 1; and\n7)\tshall enter the \"P3: waiting for release response\" state.\nWhen in the \"P0: start-stop\" or \"P1: ignoring same call id\" state, upon receiving a PRIVATE CALL SETUP REQUEST message with Call identifier IE different than stored call identifier and media session declared in SDP body of PRIVATE CALL SETUP REQUEST message cannot be established, the MCPTT client:\n1)\tshall store the Call identifier IE in the received message as call identifier;\n2)\tshall store the MCPTT user ID of the caller IE in the received PRIVATE CALL SETUP message as caller ID;\n3)\tshall store own MCPTT user ID as callee ID;\n4)\tshall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8. In the PRIVATE CALL REJECT message, the MCPTT client:\na)\tshall set the Call identifier IE to the cached call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with stored callee ID; and\nd)\tshall set the Reason IE as \"FAILED\", if requested to restrict notification of call failure and the value of \"/<x>/<x>/Common/PrivateCall/FailRestrict\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise, shall set the Reason IE as \"MEDIA FAILURE\".\n5)\tshall send the PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n6)\tshall start timer TFP7 (waiting for any message with same call identifier); and\n7)\tshall enter the \"P1: ignoring same call id\" state if current state is the \"P0: start-stop\" state.\nWhen in the \"P0: start-stop\" or \"P1: ignoring same call id\" state, upon receiving a PRIVATE CALL SETUP REQUEST message with Commencement mode IE set to \"AUTOMATIC COMMENCEMENT MODE\" and Call identifier IE different than stored call identifier and media session declared in SDP body of PRIVATE CALL SETUP REQUEST message can be established, the MCPTT client:\n1)\tshall store the Call identifier IE in the received message as call identifier;\n2)\tshall create the call type control state machine as described in clause 11.2.3.2;\n3)\tshall store the MCPTT user ID of the caller IE in the received PRIVATE CALL SETUP REQUEST message as caller ID;\n4)\tshall store own MCPTT user ID as callee ID;\n5)\tif the SDP offer contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the originating MCPTT user from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif the validation of the signature failed, shall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8. In the PRIVATE CALL REJECT message, the MCPTT client:\ni)\tshall set the call identifier IE to the stored call identifier;\nii)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\niii)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\niv)\tshall set the Reason IE as \"FAILED\", if requested to restrict notification of call failure and the value of \"/<x>/<x>/Common/PrivateCall/FailRestrict\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise, shall set the reason IE as \"E2E SECURITY CONTEXT FAILURE\";\nv)\tshall send the PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nvi)\tshall release call type control state machine; and\nvii)\tshall remain in the current state;\ne)\tif the validation of the signature was successful:\ni)\tshall extract and decrypt the encapsulated PCK using the terminating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78];\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\niii)\tshall generate and store answer SDP based on received SDP offer IE in PRIVATE CALL SETUP REQUEST message, as defined in clause 11.2.1.1.2;\niv)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:\nA)\tshall set the Call identifier IE to the stored call identifier; and\nB)\tshall set the MCPTT user ID of the caller IE with stored caller ID.\nC)\tshall set the MCPTT user ID of the callee IE with stored callee ID; and\nD)\tshall set the SDP answer IE with the stored answer SDP;\nv)\tshall send PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nvi)\tshall establish a media session based on the SDP body of the stored answer SDP;\nvii)\tshall initialize the counter CFP4 with value set to 1;\nviii)\tshall start timer TFP4 (private call accept retransmission);\nix)\tif in \"P1: ignoring same call id\" state, shall stop timer TFP7 (waiting for any message with same call identifier); and\nx)\tshall enter the \"P5: pending\" state; and\nNOTE:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n6)\tif the SDP offer does not contain an \"a=key-mgmt\" attribute, the MCPTT client:\na)\tshall generate and store answer SDP based on received SDP offer IE in PRIVATE CALL SETUP REQUEST message, as defined in clause 11.2.1.1.2;\nb)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7:\ni)\tshall set the Call identifier IE to the stored call identifier;\nii)\tshall set the MCPTT user ID of the caller IE with stored caller ID.\niii)\tshall set the MCPTT user ID of the callee IE with stored callee ID; and\niv)\tshall set the SDP answer IE with the stored answer SDP;\nc)\tshall send PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nd)\tshall establish a media session based on the SDP body of the stored answer SDP;\ne)\tshall initialize the counter CFP4 with value set to 1;\nf)\tshall start timer TFP4 (private call accept retransmission);\ng)\tif in \"P1: ignoring same call id\" state, shall stop timer TFP7 (waiting for any message with same call identifier); and\nh)\tshall enter the \"P5: pending\" state.\nWhen in the \"P5: pending\" state, upon expiry of timer TFP4 (private call accept retransmission), the MCPTT client:\n1)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID; and\nd)\tshall set the SDP answer IE with the stored answer SDP;\n2)\tshall send PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall increment the value of the counter CFP4 (private call accept retransmission) by 1;\n4)\tshall start timer TFP4 (private call accept retransmission); and\n5)\tshall remain in the \"P5: pending\" state.\nWhen in the \"P5: pending\" state, upon receiving a PRIVATE CALL ACCEPT ACK message or RTP media from originating user, the MCPTT client:\n1)\tshall stop timer TFP4(private call accept retransmission);\n2)\tshall start floor control as terminating MCPTT client as specified in clause 7.2 in 3GPP TS 24.380 [5];\n3)\tshall start timer TFP5 (max duration); and\n4)\tshall enter the \"P4: part of ongoing call\" state.\nIn the \"P5: pending\" state, when timer TFP4 (private call accept retransmission) expires and the value of the counter CFP4 (private call accept retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall release the call type control state machine; and\n3)\tshall enter the \"P1: ignoring same call id\" state.\n\nWhen in the \"P0: start-stop\" or \"P1: ignoring same call id\" state, upon receiving a PRIVATE CALL SETUP REQUEST message with Commencement mode IE set to \"MANUAL COMMENCEMENT MODE\" and Call identifier IE different from stored call identifier, the MCPTT client:\n1)\tshall store the Call identifier IE in the received message as call identifier;\n2)\tshall create the call type control state machine as described in clause 11.2.3.2;\n3)\tshall store the MCPTT user ID of the caller IE as received in the PRIVATE CALL SETUP REQUEST as caller ID;\n4)\tshall store own MCPTT user ID as callee ID;\n5)\tshall generate a PRIVATE CALL RINGING message as specified in clause 15.1.6;\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\n6)\tshall send PRIVATE CALL RINGING message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n7)\tif in \"P1: ignoring same call id\" state, shall stop timer TFP7 (waiting for any message with same call identifier);\n8)\tshall start timer TFP2 (waiting for user to respond); and\n9)\tshall enter the \"P5: pending\" state.\nWhen in the \"P5: pending\" state, upon expiry of timer TFP2 (waiting for user to respond), the MCPTT client:\n1)\tshall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID; and\nd)\tshall set the Reason IE as \"FAILED\".\n2)\tshall send the PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall start timer TFP7 (waiting for any message with same call identifier);\n4)\tshall release the call type control state machine; and\n5)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P5: pending\" state, upon an indication from MCPTT User to accept the incoming private call, the MCPTT client:\n1)\tif the SDP offer contains an \"a=key-mgmt\" attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE I_MESSAGE:\na)\tshall extract the MCPTT ID of the originating MCPTT user from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\nb)\tshall convert the MCPTT ID to a UID as described in 3GPP TS 33.180 [78];\nc)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\nd)\tif the validation of the signature failed, shall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8. In the PRIVATE CALL REJECT message, the MCPTT client:\ni)\tshall set the call identifier IE to the stored call identifier;\nii)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\niii)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\niv)\tshall set the Reason IE as \"FAILED\", if requested to restrict notification of call failure and the value of \"/<x>/<x>/Common/PrivateCall/FailRestrict\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise, shall set the reason IE as \"E2E SECURITY CONTEXT FAILURE\";\nv)\tshall send the PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nvi)\tshall stop timer TFP2 (waiting for user to respond);\nvii)\tif timer TFP 7 is not running, shall start timer TFP7 (waiting for any message with same call identifier);\nviii)\tshall release the call type control state machine; and\nix)\tshall enter the \"P1: ignoring same call id\" state;\ne)\tif the validation of the signature was successful:\ni)\tshall extract and decrypt the encapsulated PCK using the terminating user's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78];\nii)\tshall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\niii)\tshall generate and store answer SDP based on received SDP offer IE in PRIVATE CALL SETUP REQUEST message, as defined in clause 11.2.1.1.2;\niv)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:\nA)\tshall set the Call identifier IE to the stored call identifier;\nB)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nC)\tshall set the MCPTT user ID of the callee IE with the stored callee ID; and\nD)\tshall set the SDP answer IE with the stored answer SDP;\nv)\tshall send the PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nvi)\tshall establish a media session based on the SDP body of the private call;\nvii)\tshall stop timer TFP2 (waiting for user to respond);\nviii)\tshall initialize the counter CFP4 with value set to 1;\nix)\tshall start timer TFP4 (private call accept retransmission); and\nx)\tshall remain in the \"P5: pending\" state; and\nNOTE:\tWith the PCK successfully shared between the originating MCPTT client and the terminating MCPTT client, both clients are able to use SRTP/SRTCP to create an end-to-end secure session.\n2)\tif the SDP offer does not contain an \"a=key-mgmt\" attribute, the MCPTT client:\na)\tshall generate and store answer SDP based on received SDP offer IE in PRIVATE CALL SETUP REQUEST message, as defined in clause 11.2.1.1.2;\nb)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:\ni)\tshall set the Call identifier IE to the stored call identifier;\nii)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\niii)\tshall set the MCPTT user ID of the callee IE with the stored callee ID; and\niv)\tshall set the SDP answer IE with the stored answer SDP;\nc)\tshall send the PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\nd)\tshall establish a media session based on the SDP body of the private call;\ne)\tshall stop timer TFP2 (waiting for user to respond);\nf)\tshall initialize the counter CFP4 with value set to 1;\ng)\tshall start timer TFP4 (private call accept retransmission); and\nh)\tshall remain in the \"P5: pending\" state.\nWhen in the \"P5: pending\" state, upon expiry of timer TFP4 (private call accept retransmission), the MCPTT client:\n1)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7. In the PRIVATE CALL ACCEPT message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID; and\nd)\tshall set the SDP answer IE with the stored answer SDP;\n2)\tshall send PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall increment the value of the (counter CFP4 private call accept retransmission) by 1;\n4)\tshall start timer TFP4 (private call accept retransmission); and\n5)\tshall remain in the \"P5: pending\" state.\nWhen in the \"P5: pending\" state, upon receiving a PRIVATE CALL ACCEPT ACK message or RTP media from originating user, the MCPTT client:\n1)\tshall stop timer TFP4 (private call accept retransmission);\n2)\tshall start floor control as terminating MCPTT client as specified in clause 7.2 in 3GPP TS 24.380 [5];\n3)\tshall start timer TFP5 (max duration); and\n4)\tshall enter the \"P4: part of ongoing call\" state.\nIn the \"P5: pending\" state, when timer TFP4 (private call accept retransmission) expires and the value of the counter CFP4 (private call accept retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall release the call type control state machine; and\n3)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P5: pending\" state, upon an indication from MCPTT User to reject the incoming private call, the MCPTT client:\n1)\tshall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with stored callee ID; and\nd)\tshall set the Reason IE as \"FAILED\", if requested to restrict notification of call failure and the value of \"/<x>/<x>/Common/PrivateCall/FailRestrict\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise, shall set the Reason IE as \"REJECT\";\n2)\tshall send the PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall stop timer TFP2 (waiting for user to respond);\n4)\tshall start timer TFP7 (waiting for any message with same call identifier);\n5)\tshall release the call type control state machine; and\n6)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P5: pending\" state or \"P1: ignoring same call id\" state, upon receiving a PRIVATE CALL RELEASE message, the MCPTT client:\n1)\tshall generate a PRIVATE CALL RELEASE ACK message as specified in clause 15.1.10. In the PRIVATE CALL RELEASE ACK message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID; and.\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID.\n2)\tshall send the PRIVATE CALL RELEASE ACK message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tif in the \"P5: pending\" state and timer TFP7 (waiting for any message with same call identifier) is not running, shall start timer TFP7 (waiting for any message with same call identifier);\n4)\tshall stop timer TFP2 (waiting for user to respond), if running;\n5)\tshall stop timer TFP4 (private call accept retransmission) if running;\n6)\tshall release the call type control state machine, if the current state is \"P5: pending\" state; and\n7)\tshall enter the \"P1: ignoring same call id\" state, if the current state is \"P5: pending\" state.\nWhen in the \"P4: part of ongoing call\" state, upon an indication from MCPTT User to release a private call, the MCPTT client:\n1)\tshall generate a PRIVATE CALL RELEASE message as specified in clause 15.1.9. In the PRIVATE CALL RELEASE message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with stored callee ID.\n2)\tshall send the PRIVATE CALL RELEASE message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall stop timer TFP5 (max duration);\n4)\tshall initialize the counter CFP3 (private call release retransmission) with the value set to 1;\n5)\tshall start timer TFP3 (private call release retransmission); and\n6)\tshall enter the \"P3: waiting for release response\" state.\nWhen in the \"P3: waiting for release response\" state, upon expiry of timer TFP3 (private call release retransmission), the MCPTT client:\n1)\tshall generate a PRIVATE CALL RELEASE message as specified in clause 15.1.9. In the PRIVATE CALL RELEASE message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID.\n2)\tshall send the PRIVATE CALL RELEASE message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall increment the value of timer CFP3 by 1;\n4)\tshall start timer TFP3 (private call release retransmission); and\n5)\tshall remain in the \"P3: waiting for release response\" state.\nIn the \"P3: waiting for release response\" state, when timer TFP3 (private call request retransmission) expires and the value of the counter CFP3 (private call release retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall terminate the media session;\n2)\tshall start timer TFP7 (waiting for any message with same call identifier);\n3)\tshall release the call type control state machine; and\n4)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P4: part of ongoing call\" state, upon receiving a PRIVATE CALL RELEASE message, the MCPTT client:\n1)\tshall generate a PRIVATE CALL RELEASE ACK message as specified in clause 15.1.10;\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE the stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID.\n2)\tshall send the PRIVATE CALL RELEASE ACK message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall terminate the media session for private call;\n4)\tshall stop timer TFP5 (max duration);\n5)\tshall start timer TFP7 (waiting for any message with same call identifier);\n6)\tshall release the call type control state machine; and\n7)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P3: waiting for release response\" state, upon receiving a PRIVATE CALL RELEASE ACK to PRIVATE CALL RELEASE message, the MCPTT client:\n1)\tshall stop timer TFP3 (private call release retransmission), if running;\n2)\tshall terminate the media session;\n3)\tshall start timer TFP7 (waiting for any message with same call identifier);\n4)\tshall release the call type control state machine; and\n5)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P4: part of ongoing call\" state, upon expiry of timer TFP5 (max duration), the MCPTT client:\n1)\tshall terminate the media session;\n2)\tshall start timer TFP7 (waiting for any message with same call identifier);\n3)\tshall release the call type control state machine; and\n4)\tshall enter the \"P1: ignoring same call id\" state.\nWhen in the \"P1: ignoring same call id\" state, upon expiry of timer TFP7 (waiting for any message with same call identifier) the MCPTT client:\n1)\tshall clear the stored call identifier; and\n2)\tshall enter the \"P0: start-stop\" state.\nIn the \"P4: part of ongoing call\" state, when timer TFP1 (private call request retransmission) expires and the value of the counter CFP1 (private call request retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall stop timer TFP5 (max duration);\n3)\tshall release the call type control state machine; and\n4)\tshall enter the \"P1: ignoring same call id\" state.\nIn the \"P4: part of ongoing call\" state, when timer TFP6 (emergency private call cancel retransmission) expires and the value of the counter CFP6 (emergency private call cancel retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall start timer TFP7 (waiting for any message with same call identifier);\n2)\tshall stop timer TFP5 (max duration);\n3)\tshall release the call type control state machine; and\n4)\tshall enter the \"P1: ignoring same call id\" state.\nUpon receiving a MONP message in a state where there is no handling specified for the MONP message, the MCPTT client shall discard the MONP message.\nUpon receiving an indication from the MCPTT user in a state where there is no handling specified for the indication, the MCPTT client shall ignore the indication.\nUpon expiration of a timer in a state where there is no handling specified for expiration of the timer, the MCPTT client shall ignore the expiration of the timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "11.2.3\tCall type control",
                            "text_content": "This state machine exists in parallel with the call control state machine for off-network private call as specified in clause 11.2.2.2.\nThe Figure 11.2.3.2-1 gives an overview of the states and transitions of the state machine.\nThe figure depicts a call type control state machine, which is a crucial component in a call center's call handling system. It illustrates the flow of calls from the caller to the call center, with various states representing different stages of the call handling process. The figure includes a flowchart and a list of states, providing a visual representation of the system's logic and decision-making processes.\nFigure 11.2.3.2-1: Call type control state machine\nWhen sending the message, MCPTT client indicates the stored current ProSe per-packet priority associated with the call type control state machine to the lower layers.\nThis state is the start state of this state machine.\nThis state exists for UE, when the UE is part of an in-progress private call.\nThis state exists for UE, when the UE is part of an in-progress emergency private call.\nWhen in \"Q0: waiting for the call to be established\" state, upon an indication from the MCPTT user to initiate a call, the MCPTT client:\n1)\tif the stored emergency state associated with emergency alert state machine described in 12.2.2.2 is set to \"true\" and the value of \"/<x>/<x>/Common/PrivateCall/EmergencyCall/Authorised\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\":\na)\tshall set the stored current call type to \"EMERGENCY PRIVATE CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency private call as described in 3GPP TS 24.483 [45]; or\n2)\tif the stored emergency state associated with emergency alert state machine described in 12.2.2.2 is set to \"false\":\na)\tif the user initiates an MCPTT emergency private call and the value of \"/<x>/<x>/Common/PrivateCall/EmergencyCall/Authorised\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\":\ni)\tshall set the stored current call type to \"EMERGENCY PRIVATE CALL\"; and\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency private call as described in 3GPP TS 24.483 [45]; or\nb)\tif the user initiates an MCPTT private call:\ni)\tshall set the stored current call type to \"PRIVATE CALL\"; and\nii)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network private call as described in 3GPP TS 24.483 [45].\nWhen in \"Q0: waiting for the call to be established\" state, upon receipt of a PRIVATE CALL SETUP REQUEST message by an idle MCPTT client, the MCPTT client:\n1)\tif the Call type IE of the received PRIVATE CALL SETUP REQUEST message is set to \"EMERGENCY PRIVATE CALL\":\na)\tshall set the stored current call type to \"EMERGENCY PRIVATE CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network emergency private call as described in 3GPP TS 24.483 [45];\n2)\tif the Call type IE of the received PRIVATE CALL SETUP REQUEST message is set to \"PRIVATE CALL\":\na)\tshall set the stored current call type to \"PRIVATE CALL\"; and\nb)\tshall set the stored current ProSe per-packet priority to value corresponding to MCPTT off-network private call as described in 3GPP TS 24.483 [45].\nWhen in \"Q0: waiting for the call to be established\" state, upon receiving PRIVATE CALL ACCEPT message or PRIVATE CALL ACCEPT ACK message, the MCPTT client:\n1)\tif the stored current call type is set to \"EMERGENCY PRIVATE CALL\":\na)\tshall start TFP8 (implicit downgrade) timer; and\nb)\tshall enter \"Q2: in-progress emergency private call\" state; or\n2)\tif the stored current call type is set to \"PRIVATE CALL\":\na)\tshall enter \"Q1: in-progress private call\" state.\nWhen in the \"Q1: in-progress private call\" state, upon an indication from MCPTT User to upgrade the call to emergency and the value of \"/<x>/<x>/Common/PrivateCall/EmergencyCall/Authorised\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\", the MCPTT client:\n1)\tshall generate and store emergency offer SDP as defined in clause 11.2.1.1.2;\n2)\tshall update stored caller ID as own MCPTT user ID;\n3)\tshall update stored callee ID as MCPTT user ID of the other user;\n4)\tshall store current user location as user location;\n5)\tshall set the stored current call type to \"EMERGENCY PRIVATE CALL\";\n6)\tshall generate a PRIVATE CALL SETUP REQUEST message as specified in clause 15.1.5. In the PRIVATE SETUP REQUEST message, the MCPTT client:\na)\tshall set the Call identifier IE with the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\nd)\tshall set the Commencement mode IE as \"AUTOMATIC COMMENCEMENT MODE\";\ne)\tshall set the Call type IE to the stored current call type;\nf)\tshall set the SDP offer IE with emergency offer SDP; and\ng)\tmay set the User location IE with user location.\n7)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network emergency private call as described in 3GPP TS 24.483 [45];\n8)\tshall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT client according to rules and procedures as specified in clause 11.2.1.1.1;\n9)\tshall initialize the counter CFP1 (private call request retransmission) with value set to 1;\n10)\tshall start timer TFP1 (private call request retransmission);\n11)\tshall stop timer TFP6 (emergency private call cancel retransmission), if running; and\n12)\tshall enter the \"Q2: in-progress emergency private call\" state.\nWhen in the \"Q2: in-progress emergency private call\" state, upon expiry of timer TFP1 (private call request retransmission) and the value of CFP1 is less than the limit for CFP1, the MCPTT client:\n1)\tmay update the stored user location with current user location;\n2)\tshall increment the value of the counter CFP1 (private call request retransmission) by 1;\n3)\tshall generate a PRIVATE CALL SETUP REQUEST message as specified in clause 15.1.5. In the PRIVATE CALL SETUP REQUEST message, the MCPTT client:\na)\tshall set the Call identifier IE with the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID;\nc)\tshall set the MCPTT user ID of the callee IE with stored callee ID;\nd)\tshall set the Commencement mode IE as \"AUTOMATIC COMMENCEMENT MODE\";\ne)\tshall set the Call type IE to the stored current call type;\nf)\tshall set the SDP offer IE with the stored emergency offer SDP; and\ng)\tmay set the User location IE with stored user location;\n4)\tshall send the PRIVATE CALL SETUP REQUEST message towards other MCPTT client according to rules and procedures as specified in clause 11.2.1.1.1;\n5)\tshall start timer TFP1 (private call request retransmission); and\n6)\tshall remain in the \"Q2: in-progress emergency private call\" state.\nWhen in the \"Q2: in-progress emergency private call\" state, upon receiving a PRIVATE CALL ACCEPT message response to PRIVATE CALL SETUP REQUEST message with the same call identifier, the MCPTT client:\n1)\tshall store the SDP answer IE received in the PRIVATE CALL ACCEPT message as emergency answer SDP;\n2)\tshall generate a PRIVATE CALL ACCEPT ACK message as specified in clause 15.1.11:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\n3)\tshall send the PRIVATE CALL ACCEPT ACK message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\n4)\tshall stop timer TFP1 (private call request retransmission), if running;\n5)\tif timer TFP8 is not running, shall start TFP8 (implicit downgrade) timer;\n6)\tshall establish a media session based on the SDP body of the stored emergency answer SDP, if not already established based on the received SDP body of the stored emergency answer SDP; and\n7)\tshall remain in the current state.\nNOTE:\tPRIVATE CALL ACCEPT ACK message is retransmitted, as described in this clause, every time a PRIVATE CALL ACCEPT message is received.\nWhen in the \"Q2: in-progress emergency private call\" state, upon receiving a PRIVATE CALL REJECT message in response to PRIVATE CALL SETUP REQUEST message with Call identifier IE same as stored call identifier, the MCPTT client:\n1)\tshall stop timer TFP1 (private call request retransmission), if running;\n2)\tshall set the ProSe per-packet priority to the value corresponding to the MCPTT off-network private call as described in 3GPP TS 24.483 [45];\n3)\tshall set the stored current call type to \"PRIVATE CALL\"; and\n4)\tshall enter the \"Q1: in-progress private call\" state.\nIn the \"Q2: in-progress emergency private call\" state, when timer TFP1 (private call request retransmission) expires and the value of the counter CFP1 (private call request retransmission) is equal to the upper, the MCPTT client:\n1)\tshall release the stored current call type;\n2)\tshall release the stored Prose per-packet priority; and\n3)\tshall enter \"Q0: waiting for the call to be established\".\nWhen in the \"Q1: in-progress private call\" state or \"Q2: in-progress emergency private call\" state, upon receiving a PRIVATE CALL SETUP REQUEST message with the Call identifier IE same as the stored call identifier of the call, the Call type IE set as \"EMERGENCY PRIVATE CALL\", the MCPTT client:\n1)\tif the media session declared in SDP body of PRIVATE CALL SETUP REQUEST message can be established:\na)\tshall generate and store emergency answer SDP based on received SDP offer IE in PRIVATE CALL SETUP REQUEST message, as defined in clause 11.2.1.1.2;\nb)\tshall update the stored caller ID with the MCPTT user ID of the caller IE as received in the PRIVATE CALL SETUP REQUEST message;\nc)\tshall update the stored callee ID with own MCPTT user ID;\nd)\tshall generate a PRIVATE CALL ACCEPT message as specified in clause 15.1.7:\ni)\tshall set the Call identifier IE to the stored call identifier;\nii)\tshall set the MCPTT user ID of the callee IE with stored callee ID;\niii)\tshall set the MCPTT user ID of the caller IE with stored caller ID; and\niv)\tshall set the SDP answer IE with the stored emergency answer SDP;\ne)\tif in the \"Q1: in-progress private call\" state, shall set the ProSe per-packet priority to the value corresponding to MCPTT off-network emergency private call as described in 3GPP TS 24.483 [45];\nf)\tif in the \"Q1: in-progress private call\" state, shall stop timer TFP6 (emergency private call cancel retransmission), if running;\ng)\tif in the \"Q1: in-progress private call\" state, shall start timer TFP8 (implicit downgrade);\nh)\tshall send PRIVATE CALL ACCEPT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1;\ni)\tif in the \"Q1: in-progress private call\" state, shall set the stored current call type to \"EMERGENCY PRIVATE CALL\"; and\nj)\tif in the \"Q1: in-progress private call\" state, shall enter the \"Q2: in-progress emergency private call\" state; otherwise remain in the \"Q2: in-progress emergency private call\" state;\n2)\tif the media session declared in SDP body of PRIVATE CALL SETUP REQUEST message cannot be established:\na)\tshall generate a PRIVATE CALL REJECT message as specified in clause 15.1.8;\nb)\tshall set the call identifier IE with the call identifier in the received message;\nc)\tshall set the MCPTT user ID of the caller IE with the caller ID in the received message;\nd)\tshall set the MCPTT user ID of the callee IE with the callee ID in the received message;\ne)\tshall set the Reason IE as \"FAILED\", if requested to restrict notification of call failure and the value of \"/<x>/<x>/Common/PrivateCall/FailRestrict\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] is set to \"true\". Otherwise, shall set the reason IE as \"MEDIA FAILURE\";\nf)\tshall send a PRIVATE CALL REJECT message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1; and\ng)\tshall remain in the current state.\nWhen in the \"Q2: in-progress emergency private call\" state, upon an indication from:\n1)\tthe caller of the emergency private call; or\n2)\tthe recipient of the emergency private call with the value of \"/<x>/<x>/Common/PrivateCall/EmergencyCall/CancelPriority\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] set to \"true\",\nto cancel the emergency private call, the MCPTT client:\n1)\tshall generate a PRIVATE CALL EMERGENCY CANCEL message as specified in clause 15.1.12. In the PRIVATE CALL EMERGENCY CANCEL message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee.\n2)\tshall send the PRIVATE CALL EMERGENCY CANCEL message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall stop TFP1 (private call request retransmission), if running;\n4)\tshall stop TFP8 (implicit downgrade) timer;\n5)\tshall initialize the counter CFP6 (emergency private call cancel retransmission) with the value set to 1;\n6)\tshall start timer TFP6 (emergency private call cancel retransmission);\n7)\tshall set the stored current call type to \"PRIVATE CALL\"; and\n8)\tshall enter the \"Q1: in-progress private call\" state.\nWhen in the \"Q1: in-progress private call\" state, upon expiry of timer TFP6 (emergency private call cancel retransmission) and the value of the counter CFP6 (emergency private call cancel retransmission) is less than upper limit, the MCPTT client:\n1)\tshall generate a PRIVATE CALL EMERGENCY CANCEL message as specified in clause 15.1.12. In the PRIVATE CALL EMERGENCY CANCEL message, the MCPTT client:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with the stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with store callee ID.\n2)\tshall send the PRIVATE CALL EMERGENCY CANCEL message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tshall increment the value of the timer CFP6 (emergency private call cancel retransmission) by 1;\n4)\tshall start timer TFP6 (emergency private call cancel retransmission); and\n5)\tshall remain in the \"Q1: in-progress private call\" state.\nWhen in the \"Q1: in-progress private call\" state, upon receiving a PRIVATE CALL EMERGENCY CANCEL ACK message response to PRIVATE CALL EMERGENCY CANCEL message with the same \"call identifier\", the MCPTT client:\n1)\tshall stop timer TFP6 (emergency private call cancel retransmission), if running;\n2)\tshall establish a media session based on the SDP body of the stored answer SDP;\n3)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network private call as described in 3GPP TS 24.483 [45]; and\n4)\tshall remain in the \"Q1: in-progress private call\" state.\nIn the \"Q1: in-progress private call\" state, when timer TFP6 (emergency private call cancel retransmission) expires and the value of the counter CFP6 (emergency private call cancel retransmission) is equal to the upper limit, the MCPTT client:\n1)\tshall release the stored current call type;\n2)\tshall release the stored Prose per-packet priority; and\n3)\tshall enter \"Q0: waiting for the call to be established\".\nWhen in the \"Q1: in-progress private call\" state or \"Q2: in-progress emergency private call\" state, upon receiving a PRIVATE CALL EMERGENCY CANCEL message with the same \"call identifier\" IE, the MCPTT client:\n1)\tshall generate a PRIVATE CALL EMERGENCY CANCEL ACK as specified in clause 15.1.13:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the callee IE with own MCPTT user ID; and\nc)\tshall set the MCPTT user ID of the caller IE with MCPTT user ID of the caller IE in received message;\n2)\tshall send PRIVATE CALL EMERGENCY CANCEL ACK message according to rules and procedures as specified in clause 11.2.1.1.1;\n3)\tif in the \"Q2: in-progress emergency private call\" state, shall stop timer TFP8 (implicit downgrade);\n4)\tshall establish a media session based on the SDP body of the stored answer SDP;\n5)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network private call as described in 3GPP TS 24.483 [45]; and\n6)\tshall enter the \"Q1: in-progress private call\" state and set the stored current call type to \"PRIVATE CALL\", if current state is the \"Q2: in-progress emergency private call\" state.\nWhen in the \"Q2: in-progress emergency private call\" state, upon expiry of TFP8 (implicit downgrade) timer, the MCPTT client:\n1)\tshall establish a media session based on the SDP body of the stored answer SDP;\n2)\tshall set the ProSe per-packet priority to the value corresponding to MCPTT off-network private call as described in 3GPP TS 24.483 [45];\n3)\tshall set the stored current call type to \"PRIVATE CALL\"; and\n4)\tshall enter the \"Q1: in-progress private call\" state.\nWhen in state \"Q1: in-progress private call\" or \"Q2: in-progress emergency private call\", upon receiving an indication from MCPTT user to release the call or upon receiving PRIVATE CALL RELEASE message, the MCPTT client:\n1)\tshall release the stored current call type;\n2)\tif in the \"Q2: in-progress emergency private call\" state, shall stop timer TFP1 (private call request retransmission), if running;\n3)\tif in the \"Q1: in-progress private call\" state, shall stop timer TFP6 (emergency private call cancel retransmission), if running;\n4)\tif in the \"Q2: in-progress emergency private call\" state, shall stop timer TFP8 (implicit downgrade);\n5)\tshall release the stored Prose per-packet priority; and\n6)\tshall enter \"Q0: waiting for the call to be established\".\nWhen in the \"Q1: in-progress private call\" state, upon receiving a PRIVATE CALL ACCEPT message response to PRIVATE CALL SETUP REQUEST message with the same call identifier, the MCPTT client:\n1)\tshall generate a PRIVATE CALL ACCEPT ACK message as specified in clause 15.1.11:\na)\tshall set the Call identifier IE to the stored call identifier;\nb)\tshall set the MCPTT user ID of the caller IE with stored caller ID; and\nc)\tshall set the MCPTT user ID of the callee IE with the stored callee ID;\n2)\tshall send the PRIVATE CALL ACCEPT ACK message in response to the request message according to rules and procedures as specified in clause 11.2.1.1.1; and\n3)\tshall remain in the current state.\nNOTE:\tPRIVATE CALL ACCEPT ACK message is retransmitted, as described in this clause, every time a PRIVATE CALL ACCEPT message is received.\nUpon receiving a MONP message in a state where there is no handling specified for the MONP message, the MCPTT client shall discard the MONP message.\nUpon receiving an indication from the MCPTT user in a state where there is no handling specified for the indication, the MCPTT client shall ignore the indication.\nUpon expiration of a timer in a state where there is no handling specified for expiration of the timer, the MCPTT client shall ignore the expiration of the timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "12\tEmergency alert",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "12.0\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the emergency alert procedures for on-network and off-network.\nFor on-network emergency alert, the procedures for originating and terminating MCPTT clients, participating MCPTT functions and controlling MCPTT function are specified in clause 12.1. MCPTT emergency call procedures that have emergency alerts as an optional capability shall be performed as defined in clause 10.1 for on-network group call and defined in clause 11.1 for on-network private call.\nFor off-network emergency alert, the procedures for each functional entity is specified in clause 12.2.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "12.1\tOn-network emergency alert",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.1.1\tClient procedures",
                            "text_content": "Upon receiving a request from the MCPTT user to send an MCPTT emergency alert to the indicated MCPTT group shall determine whether the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element. If a <preconfigured-group-use-only> element exists and is set to the value \"true\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that alerts are not allowed on the indicated group; and\n2)\tshall skip the remainder of this procedure.\nIf this is an authorised request for an MCPTT emergency alert as determined by clause 6.2.8.1.6, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nNOTE 1:\tThis SIP MESSAGE request is assumed to be sent out-of-dialog.\nThe MCPTT client:\n1)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n2)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n4)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-request-uri> element set to:\ni)\tif the <EmergencyAlert> element of the MCPTT user profile exists, then:\nA)\tif the <entry-info> attribute of the <entry> element of the <EmergencyAlert> element is set to the value 'DedicatedGroup', the value in the <uri-entry> element of the <entry> element of the <EmergencyAlert> element; and\nB)\tif the <entry-info> attribute of the <entry> element of the <EmergencyAlert> element is set to the value 'UseCurrentlySelectedGroup' and there is no currently selected group, the value in the <uri-entry> element of the <entry> element of the <EmergencyAlert> element; and\nii)\tif the <EmergencyAlert> element of the MCPTT user profile does not exist, the group identity selected by the MCPTT user;\nb)\tthe <alert-ind> element set to a value of \"true\";\nc)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nd)\tif the MCPTT client needs to include an active functional alias in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\nNOTE 2:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\ne)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value;\n5)\tshall include in the SIP MESSAGE request the specific location information for MCPTT emergency alert as specified in clause 6.2.9.1;\n6)\tshall set the MCPTT emergency state if not already set;\n7)\tshall set the MCPTT emergency alert state to \"MEA 2: emergency-alert-confirm-pending\";\n8)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user; and\n9)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\".\nOn receiving a SIP 4xx response a SIP 5xx response or a SIP 6xx response to the SIP MESSAGE request, the MCPTT client shall set the MCPTT emergency alert state to \"MEA 1: no-alert\".\nNOTE 3:\tThe MCPTT emergency state is left set in this case as the MCPTT user presumably is in the best position to determine whether or not they are in a life-threatening condition. The assumption is that the MCPTT user can clear the MCPTT emergency state manually if need be.\nNOTE 4:\tBased on implementation the MCPTT client can subsequently automatically originate an MCPTT emergency group call as specified in clause 10.1.1.2.\nUpon receiving a request from the MCPTT user to send an MCPTT emergency alert cancellation to the indicated MCPTT group and this is an authorised request for an MCPTT emergency alert cancellation as determined by clause 6.2.8.1.6, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nNOTE 1:\tThis SIP MESSAGE request is assumed to be sent out-of-dialog.\nThe MCPTT client:\n1)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n2)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n3)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing the public user identity of the originator as specified in 3GPP TS 24.229 [4];\n4)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-request-uri> element set to the MCPTT group identity;\nb)\tthe <alert-ind> element set to a value of \"false\";\nc)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nd)\tif the MCPTT client needs to include an active functional alias in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\nNOTE 1A:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\ne)\tif the MCPTT user is cancelling an MCPTT emergency alert originated by another MCPTT user, include the <originated-by> element set to the MCPTT ID of the MCPTT user who originated the MCPTT emergency alert;\n5)\tif the MCPTT user has additionally requested the cancellation of the in-progress emergency state of the MCPTT group and this is an authorised request for an in-progress emergency group state cancellation as determined by clause 6.2.8.1.7, shall include an <emergency-ind> element set to a value of \"false\" in the <mcpttinfo> element containing the <mcptt-Params> element;\n6)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n7)\tif the generated SIP MESSAGE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall set the MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-pending\"; and\n8)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receipt of a SIP MESSAGE request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind-rcvd> element set to true and an <mcptt-client-id> matching the MCPTT client ID included in the sent SIP MESSAGE request:\n1)\tif the <alert-ind> element is set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\" and the sent SIP MESSAGE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall:\na)\tset the MCPTT emergency alert state to \"MEA 1: no-alert\"; and\nb)\tclear the MCPTT emergency state if not already cleared;\n2)\tif the <alert-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request is set to a value of \"true\" and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\" and the sent SIP MESSAGE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\nNOTE 2:\tIt would appear to be an unusual situation for the initiator of an MCPTT emergency alert to not be able to clear their own alert. Nevertheless, an MCPTT user can be configured to be authorised to initiate MCPTT emergency alerts but not have the authority to clear them. Hence, the case is covered here.\n3)\tif an <emergency-ind> element is present in the application/vnd.3gpp.mcptt-info+xml MIME body of received SIP MESSAGE request is set to a value of \"false\" and the sent SIP MESSAGE request contains an <emergency-ind> element set to a value of \"false\":\na)\tshall set the MCPTT emergency group call state of the group to \"MEGC 1: emergency-gc-capable\"; and\nb)\tshall set the MCPTT emergency group state of the group to \"MEG 1: no-emergency\".\nNOTE 3:\tThe case where an <emergency-ind> element is set to true is possible but not handled specifically above as it results in no state changes.\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the sent SIP MESSAGE request:\n1)\tif the received SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <alert-ind> element set to a value of \"true\", the sent SIP MESSAGE request did not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\nNOTE 4:\tIn this case, an <emergency-ind> element would either not be present or would be set to true. In either case, no change in state would result. Hence, this case is not specified above.\n2)\tif the received SIP 4xx response, SIP 5xx response or a SIP 6xx response to the SIP MESSAGE request does not contain an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind> element, the sent SIP MESSAGE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body and the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\".\nUpon receipt of a \"SIP MESSAGE request for emergency notification\", the MCPTT client:\n1)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\", may display to the MCPTT user the functional alias of the originating MCPTT user, if provided, and should display to the MCPTT user an indication of the MCPTT emergency alert and associated information, including:\na)\tthe MCPTT group identity contained in <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tthe originator of the MCPTT emergency alert contained in the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nc)\tthe mission critical organization of the MCPTT emergency alert originator contained in the <mc-org> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nNOTE 1:\tThis is the case of the MCPTT client receiving the notification of another MCPTT user's emergency alert.\n2)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user an indication of the MCPTT emergency alert cancellation and associated information, including:\ni)\tthe MCPTT group identity contained in the <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body;\nii)\tthe originator of the MCPTT emergency alert contained in:\nA)\tif present, the <originated-by> element of the application/vnd.3gpp.mcptt-info+xml MIME body; or\nB)\tthe <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nb)\tif the MCPTT ID contained in the <originated-by> element is the MCPTT ID of the receiving MCPTT user, shall set the MCPTT emergency alert state to \"MEA 1: no-alert\"; and\nc)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element is set to a value of \"false\":\ni)\tshall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and\nii)\tshall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-capable\";\nNOTE 2:\tThis is the case of the MCPTT client receiving the notification of the cancellation by a third party of an MCPTT emergency alert. This can be the MCPTT emergency alert of another MCPTT user or the MCPTT emergency alert of the recipient, as determined by the contents of the <originated-by> element. Optionally, notification of the cancellation of the in-progress emergency state of the MCPTT group can be included.\n3)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication of the additional emergency MCPTT user participating in the MCPTT emergency group call including the following if not already displayed as part of step 1):\ni)\tthe MCPTT group identity contained in the <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tthe <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tshall set the MCPTT emergency group state to \"MEG 2: in-progress\" if not already set to that value;\nNOTE 3:\tThis is the case of the MCPTT client receiving notification of an additional MCPTT user in an MCPTT emergency state (i.e., not the MCPTT user that originally triggered the in-progress emergency state of the group) joining the in-progress emergency group call or in the case of MCPTT client not participating in an in-progress emergency group call but affiliated to group to receive notification of an MCPTT users having MCPTT outstanding emergency call. An emergency alert indication, if included, is handled in step 1).\n4)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user an indication of the cancellation of the in-progress emergency state of the MCPTT group call including the following if not already displayed as part of step 2):\ni)\tthe MCPTT group identity contained in the <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tthe <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tshall set the MCPTT emergency group state to \"MEG 1: no-emergency\"; and\nc)\tshall set the MCPTT emergency group call state to \"MEGC 1: emergency-gc-capable\";\nNOTE 4:\tThis is the case of the MCPTT client receiving the notification of the cancellation of the in-progress emergency state of the MCPTT group. In this case, the receiving MCPTT client is affiliated with the MCPTT group but not participating or participating in the session. An emergency alert cancellation, if included, is handled in step 2).\n5)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"true\":\na)\tshould display to the MCPTT user an indication of the MCPTT user participating in the MCPTT imminent peril group call including the following if not already displayed as part of step 1):\ni)\tthe MCPTT group identity contained in the <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tthe <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\nb)\tshall set the MCPTT imminent peril group state to \"MIG 2: in-progress\" if not already set to that value;\nNOTE 5:\tThis is the case of the MCPTT client receiving notification of an additional MCPTT user initiating an imminent peril group call when there is already an in-progress imminent peril state in effect on the group.\n6)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <imminentperil-ind> element set to a value of \"false\":\na)\tshould display to the MCPTT user an indication of the cancellation of the in-progress imminent peril state of the MCPTT group including the following if not already displayed as part of step 2):\ni)\tthe MCPTT group identity contained in the <mcptt-calling-group-id> element application/vnd.3gpp.mcptt-info+xml MIME body; and\nii)\tthe <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body;\nb)\tshall set the MCPTT imminent peril group state to \"MIG 1: no-imminent-peril\"; and\nc)\tshall set the MCPTT imminent peril group call state to \"MIGC 1: imminent-peril-gc-capable\";\nNOTE 6:\tThis is the case of the MCPTT client receiving notification of the cancellation of the in-progress imminent peril state of the group.\n7)\tshall generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4]; and\n8)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP MESSAGE request for notification of entry into or exit from a group geographic area\", the MCPTT client;\n1)\tshall send a SIP 200 (OK) to the participating MCPTT function that sent the SIP MESSAGE request; and\n2)\tif the <group-geo-area-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body is:\na)\tset to \"true\":\ni)\tmay display to the MCPTT user an indication that a group geographic area has been entered; and\nii)\tshall execute the procedure in clause 9.2.1.2 to affiliate to the group indicated by the participating MCPTT function; or\nb)\tset to \"false\":\ni)\tmay display to the MCPTT user an indication that a group geographic area has been exited; and\nii)\tshall execute the procedure in clause 9.2.1.2 to de-affiliate from the group indicated by the participating MCPTT function.\nUpon receiving a request from an MCPTT user to cancel the in-progress emergency condition on a prearranged MCPTT group on which there is no call ongoing, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] with the clarifications given below.\nNOTE 1:\tThis SIP MESSAGE request is assumed to be sent out-of-dialog.\nThe MCPTT client:\n1)\tif the MCPTT user is not authorised to cancel the in-progress emergency group state of the MCPTT group as determined by the procedures of clause 6.2.8.1.7, the MCPTT client:\na)\tshould indicate to the MCPTT user that they are not authorised to cancel the in-progress emergency group state of the MCPTT group; and\nb)\tshall skip the remaining steps of the current clause;\n2)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP MESSAGE request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n4)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing the public user identity of the originator as specified in 3GPP TS 24.229 [4];\n5)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-request-uri> element set to the MCPTT group identity; and\nb)\tthe <emergency-ind> element set to a value of \"false\";\n6)\tif the MCPTT user has additionally requested the cancellation of an MCPTT emergency alert originated by MCPTT user, shall include an <alert-ind> element set to a value of \"false\" in the <mcpttinfo> element containing the <mcptt-Params> element;\n7)\tshall set the Request-URI to the public service identity identifying the participating MCPTT function serving the MCPTT user;\n8)\tif the generated SIP MESSAGE request contain an <alert -ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall set the MCPTT emergency alert state to \"MEA 4: Emergency-alert-cancel-pending\"; and\n9)\tshall send the SIP MESSAGE request according to rules and procedures of 3GPP TS 24.229 [4].\nOn receipt of a SIP MESSAGE request containing an application/vnd.3gpp.mcptt-info+xml MIME body with an <emergency-ind-rcvd> element set to a value of \"true\" and an <mcptt-client-id> matching the MCPTT client ID included in the sent SIP MESSAGE request:\n1)\tif an <emergency-ind> element is present in the application/vnd.3gpp.mcptt-info+xml MIME body of received SIP MESSAGE request and is set to a value of \"false\":\na)\tshall set the MCPTT emergency group state of the group to \"MEG 1: no-emergency\".\nNOTE 3:\tThe case where an <emergency-ind> element is set to true is possible but not handled specifically above as it results in no state changes.\n2)\tif the <alert-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request is set to a value of \"true\" and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\" and the sent SIP MESSAGE request contain an <alert-ind> element set to value \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body, shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\nNOTE 2:\tIt would appear to be an unusual situation for the initiator of an MCPTT emergency alert to not be able to clear their own alert. Nevertheless, an MCPTT user can be configured to be authorised to initiate MCPTT emergency alerts but not have the authority to clear them. Hence, the case is covered here.\n3)\tif the <alert-ind> element in the application/vnd.3gpp.mcptt-info+xml MIME body of the received SIP MESSAGE request is set to a value of \"false\" and if the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\" and the sent SIP MESSAGE request contain an <alert-ind> element set to value \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body, shall:\na)\tset the MCPTT emergency alert state to \"MEA 1: no-alert\"; and\nb)\tclear the MCPTT emergency state if not already cleared;\nOn receiving a SIP 4xx response, SIP 5xx response or SIP 6xx response to the sent SIP MESSAGE request:\n1)\tif the received SIP 4xx response, SIP 5xx response or SIP 6xx response contains an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <alert-ind> element set to a value of \"true\" and the sent SIP MESSAGE request contain an <alert-ind> element set to value \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body and the MCPTT emergency alert state is set to \"MEA 4: Emergency-alert-cancel-pending\", shall set the MCPTT emergency alert state to \"MEA 3: emergency-alert-initiated\"; and\nNOTE 4:\tIn this case, <emergency-ind> element is set to true is possible but not handled specifically above as it results in no state changes.\nUpon receipt of a \"SIP MESSAGE request for notification of entry into or exit from an emergency alert area\", the MCPTT client:\n1)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-alert-area-ind> element value:\na)\tset to \"true\":\ni)\tmay display to the MCPTT user an indication that MCPTT client has entered a pre-defined emergency alert area; and\nii)\tif the MCPTT user is not in emergency state, shall initiate the emergency alert origination procedure as specified in clause 12.1.1.1; or\nb)\tset to \"false\":\ni)\tmay display to the MCPTT user an indication that MCPTT client has exited a pre-defined emergency alert area;\nNOTE:\tIn this case, the MCPTT emergency state remains set, as the MCPTT user is in the best position to determine whether or not they are in a life-threatening condition. The MCPTT user can clear the MCPTT emergency state manually, if needed.\n2)\tshall generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4]; and\n3)\tshall send the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.1.2\tParticipating MCPTT function procedures",
                            "text_content": "Upon receipt of a \"SIP MESSAGE request for emergency notification for originating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tif the SIP MESSAGE request contains an emergency indication set to a value of \"true\" or an alert indication set to a value of \"true\", the participating MCPTT function can, according to local policy, choose to accept the request.\n2)\tshall determine the MCPTT ID of the calling user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\nNOTE 2:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n2a)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n3)\tif the MCPTT user is not affiliated with the MCPTT group as determined by clause 9.2.2.2.11, shall perform the actions specified in clause 9.2.2.2.12 for implicit affiliation;\n4)\tif the actions for implicit affiliation specified in step 3) above were performed but not successful in affiliating the MCPTT user due to the MCPTT user already having N2 simultaneous affiliations(specified in the <MaxAffiliationsN2> element of the <Common> element of the corresponding MCPTT user profile of the served MCPTT ID), shall reject the \"SIP MESSAGE request for emergency notification for originating participating MCPTT function\" with a SIP 486 (Busy Here) response with the warning text set to \"102 too many simultaneous affiliations\" in a Warning header field as specified in clause 4.4. and skip the rest of the steps.\nNOTE 3:\tN2 is the total number of MCPTT groups that an MCPTT user can be affiliated to simultaneously as specified in 3GPP TS 23.379 [3].\nNOTE 4:\tAs this is a request for MCPTT emergency services, the participating MCPTT function can choose to accept the request.\n5)\tshall determine the public service identity of the controlling MCPTT function associated with the group identity in the received SIP MESSAGE request;\nNOTE 5:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 6:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 7:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 8:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the group identity or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 9:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n6)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n7)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 5) above;\n8)\tshall copy the contents of the application/vnd.3gpp. mcptt-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 included in the outgoing SIP MESSAGE request;\n8a)\tif the received SIP MESSAGE request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, shall check the status of the functional alias for the MCPTT ID. If the functional alias status is activated, then the participating MCPTT function shall set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request to the received value, otherwise it shall not include a <functional-alias-URI> element;\n9)\tshall set the <mcptt-calling-user-id> contained in <mcptt-Params> element of the application/vnd.3gpp.mcptt-info+xml MIME body to the MCPTT ID determined in step 2) above;\n10)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause F.3 shall copy the contents of the application/vnd.3gpp.mcptt-location-info+xml MIME body in the received SIP MESSAGE request into an application/vnd.3gpp.mcptt-location-info+xml MIME body included in the outgoing SIP MESSAGE request;\n11)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function; and\n12)\tshall send the SIP MESSAGE request as specified to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the SIP MESSAGE request sent in step 10):\n1)\tshall generate a SIP 200 (OK) response as specified in 3GPP TS 24.229 [4] with the follow clarifications:\na)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n2)\tif the procedures of clause 9.2.2.2.12 for implicit affiliation were performed in the present clause, shall complete the implicit affiliation by performing the procedures of clause 9.2.2.2.13; and\n3)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the sent SIP MESSAGE request and if the implicit affiliation procedures of clause 9.2.2.2.12 were invoked in the present clause, the participating MCPTT function shall perform the procedures of clause 9.2.2.2.14.\nIn the procedures in this clause:\n1)\temergency indication in an incoming SIP MESSAGE request refers to the <emergency-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body; and\n2)\talert indication in an incoming SIP MESSAGE request refers to the <alert-ind> element of the application/vnd.3gpp.mcptt-info+xml MIME body.\nUpon receipt of a \"SIP MESSAGE request for emergency notification for terminating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\nNOTE 1:\tif the SIP MESSAGE request contains an emergency indication set to a value of \"true\" or an alert indication set to a value of \"true\", the participating MCPTT function can by means beyond the scope of this specification choose to accept the request.\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request as specified in clause 6.3.2.2.11; and\n5)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP MESSAGE request routed to the terminating participating MCPTT function with the Request-URI set to the public service identity of the terminating participating MCPTT function and the SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with an <alert-ind-rcvd> or <emergency-ind-rcvd> element present, the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP MESSAGE request to retrieve the binding between the MCPTT ID and public user identity;\n3)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP MESSAGE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\n4)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\na)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nb)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public user identity associated to the MCPTT ID of the MCPTT user that was in the Request-URI of the incoming SIP MESSAGE request;\nc)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request; and\nd)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function; and\n5)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the participating MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.1.3\tControlling MCPTT function procedures",
                            "text_content": "Upon receipt of a \"SIP MESSAGE request for emergency notification for controlling MCPTT function\", the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\nNOTE:\tIf the SIP MESSAGE request contains an alert indication set to a value of \"true\", the controlling MCPTT function can, according to local policy, choose to accept the request.\n2)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if an Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2A)\tif the group document contains a <list-service> element that contains a <preconfigured-group-use-only> element that is set to the value \"true\", shall shall reject the SIP request with a SIP 403 (Forbidden) response with the warning text set to \"168 alert is not allowed on the preconfigured group\" as specified in clause 4.4 \"Warning header field\" and skip the rest of the steps;\n3)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\", the <emergency-ind> element present or not and call is ongoing on associated group on which outstanding alert exists, shall perform the procedures specified in clause 12.1.3.2 and skip the rest of the steps;\n3a)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\", the <alert-ind> element present or not and no call is ongoing on the group on which in-progress emergency state cancelation request is recieved, shall perform the procedures specified in clause 12.1.3.3 and skip the rest of the steps;\n4)\tif the received SIP MESSAGE request contains an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"true\":\na)\tif the received SIP MESSAGE request is an unauthorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1 shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE request as specified in 3GPP TS 24.229 [4] with the following clarifications:\ni)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <alert-ind> element set to a value of \"false\"; and\nii)\tshall send the SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps; and\nb)\tif the received SIP MESSAGE request is an authorised request for an MCPTT emergency alert as specified in clause 6.3.3.1.13.1:\ni)\tif the sending MCPTT user identified by the <mcptt-calling-user-id> element included in the application/vnd.3gpp.mcptt-info+xml MIME body is not affiliated with the MCPTT group identified by the <mcptt-request-uri> element of the MIME body as determined by the procedures of clause 6.3.6:\nI)\tshall check if the MCPTT user is eligible to be implicitly affiliated with the MCPTT group as determined by clause 9.2.2.3.6;\nII)\tif the MCPTT user is determined not to be eligible to be implicitly affiliated to the MCPTT group shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below; or\nIII)\tif the procedures of clause 9.2.2.3.6 determined the MCPTT user to be eligible to be implicitly affiliated to the MCPTT group shall, perform the implicit affiliation as specified in clause 9.2.2.3.7;\nii)\tfor each of the other affiliated members of the group:\nA)\tgenerate an outgoing SIP MESSAGE request notification of the MCPTT user's emergency alert indication as specified in clause 6.3.3.1.11 with the clarifications of clause 6.3.3.1.12;\nB)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request; and\nC)\tsend the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4];\niii)\tshall generate a SIP 200 (OK) response to the received SIP MESSAGE request as specified in 3GPP TS 24.229 [4] with the following clarifications:\nA)\tshall cache the information that the MCPTT user has initiated an MCPTT emergency alert;\niv)\tshall send the SIP 200 (OK) response to the received SIP MESSAGE according to rules and procedures of 3GPP TS 24.229 [4].\nv)\tshall generate a SIP MESSAGE request as described in clause 6.3.3.1.20 to indicate successful receipt of an emergency alert, and shall include in the application/vnd.3gpp.mcptt-info+xml MIME body:\nA)\tthe <alert-ind> element set to a value of \"true\";\nB)\tthe <alert-ind-rcvd> element set to a value of true; and\nC)\tthe <mcptt-client-id> element with the MCPTT client ID that was included in the incoming SIP MESSAGE request; and\nvi)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP MESSAGE request for emergency notification for controlling MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <alert-ind> element set to a value of \"false\", the controlling MCPTT function:\n1)\tif the received SIP MESSAGE request is an unauthorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.1:\na)\tand if the received SIP MESSAGE request does not contain an <emergency-ind> element set to a value of \"false\" or is an unauthorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE request as specified in 3GPP TS 24.229 [4] with the following clarifications:\ni)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <alert-ind> element set to a value of \"true\";\nii)\tif the received SIP MESSAGE request contains an <emergency-ind> element of the <mcpttinfo> element set to a value of \"false\" and if the in-progress emergency state of the group is set to a value of \"true\" and this is an unauthorised request for an MCPTT emergency call cancellation as determined in step i) above, shall include an <emergency-ind> element set to a value of \"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP 403 (Forbidden) response; and\niii)\tshall send the SIP 403 (Forbidden) response according to rules and procedures of 3GPP TS 24.229 [4] and skip the rest of the steps; and\nb)\tand if the received SIP MESSAGE request contains an <emergency-ind> element set to a value of \"false\" and is an authorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4 and the in-progress emergency state of the MCPTT group is set to a value of \"true\":\ni)\tshall set the in-progress emergency state of the group to a value of \"false\";\nii)\tshall clear the cache of the MCPTT ID of the MCPTT user that triggered the setting of the in-progress emergency state of the MCPTT group to \"true\";\niii)\tshall generate SIP re-INVITE requests to the other affiliated and joined members of the MCPTT group as specified in clause 6.3.3.1.6. The MCPTT controlling function:\nA)\tfor each affiliated and joined member shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5];\niv)\tfor each of the affiliated but not joined members of the group shall:\nA)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency call as specified in clause 6.3.3.1.11;\nB)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request; and\nC)\tshall include an <emergency-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\nv)\tshall generate a SIP 200 (OK) response to the received SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nvi)\tshall send the SIP 200 (OK) response to the received SIP MESSAGE as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\nvii)\tshall generate a SIP MESSAGE request as described in clause 6.3.3.1.20 to indicate successful receipt of the request for emergency alert cancellation\nviii)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request:\nA)\tthe <alert-ind> element set to a value of \"true\";\nB)\tthe <alert-ind-rcvd> element set to a value of true;\nC)\tthe <emergency-ind> element set to a value of \"false\"; and\nD)\tthe <mcptt-client-id> element with the MCPTT client ID that was included in the incoming SIP MESSAGE request; and\nix)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4]; and\n2)\tif the received SIP MESSAGE request is an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3:\na)\tif the received SIP MESSAGE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, shall clear the cache of the MCPTT ID of the MCPTT user identified by the <originated-by> element as having an outstanding MCPTT emergency alert;\nb)\tif the received SIP MESSAGE request does not contain an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, clear the cache of the MCPTT ID of the sender of the SIP MESSAGE request as having an outstanding MCPTT emergency alert;\nc)\tif the received SIP MESSAGE request does not contain an <emergency-ind> element set to a value of \"false\" or is an unauthorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4, for each of the affiliated members of the group shall:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency alert as specified in clause 6.3.3.1.11;\nii)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request;\niii)\tif the received SIP MESSAGE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the received <originated-by> element to an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\niv)\tshall include an <alert-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nv)\tsend the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nd)\tif the received SIP MESSAGE request contains an <emergency-ind> element set to a value of \"false\" and is an authorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4 and the in-progress emergency state of the MCPTT group is set to a value of \"true\":\ni)\tshall set the in-progress emergency state of the group to a value of \"false\";\nii)\tcache the information that the MCPTT user has cancelled the outstanding in-progress emergency state of the group;\niii)\tshall generate SIP re-INVITES requests to the other affiliated and joined members of the MCPTT group as specified in clause 6.3.3.1.6. The MCPTT controlling function:\nA)\tfor each affiliated and joined member shall send the SIP re-INVITE request towards the MCPTT client as specified in 3GPP TS 24.229 [4]; and\nB)\tUpon receiving a SIP 200 (OK) response to the SIP re-INVITE request the controlling MCPTT function shall interact with the media plane as specified in 3GPP TS 24.380 [5]; and\niv)\tfor each of the affiliated but not joined members of the group shall:\nA)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency call as specified in clause 6.3.3.1.11;\nB)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request;\nC)\tif the received SIP MESSAGE request contains an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body, copy the contents of the received <originated-by> element to an <originated-by> element in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\nD)\tinclude in the application/vnd.3gpp.mcptt-info+xml MIME body an <alert-ind> element set to a value of \"false\"; and\nE)\tshall include an <emergency-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\ne)\tshall generate a SIP 200 (OK) response to the received SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nf)\tshall send the SIP 200 (OK) response to the received SIP MESSAGE as specified in 3GPP TS 24.229 [4].\ng)\tshall generate a SIP MESSAGE request as described in clause 6.3.3.1.20 to indicate successful receipt of the request for emergency alert cancellation;\nh)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body, the <alert-ind> element set to a value of \"false\" and the <alert-ind-rcvd> set to \"true\";\ni)\tshall populate the <mcptt-client-id> element with the MCPTT client ID that was included in the incoming SIP MESSAGE request;\nj)\tif the received SIP MESSAGE request contains an <emergency-ind> element of the <mcpttinfo> element set to a value of \"false\":\ni)\tif this is an authorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4, shall include an <emergency-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nii)\totherwise, if this is an unauthorised request for an MCPTT emergency call cancellation as specified in clause 6.3.3.1.13.4, and the in-progress emergency state of the group is set to a value of \"true\", shall include an <emergency-ind> element set to a value of \"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nk)\tshall send the SIP MESSAGE request according to according to the rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP MESSAGE request for emergency notification for controlling MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <emergency-ind> element set to a value of \"false\" and no call is ongoing on the group on which in-progress emergency cancellation request is made, the controlling MCPTT function:\n1)\tif the received SIP MESSAGE request is an unauthorised request for an MCPTT in-progress emergency group state cancellation as specified in clause 6.3.3.1.13.4:\na)\tand if the received SIP MESSAGE request does not contain an <alert-ind> element or is an unauthorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3, shall reject the SIP MESSAGE request with a SIP 403 (Forbidden) response to the SIP MESSAGE request as specified in 3GPP TS 24.229 [4] with the following clarifications:\ni)\tshall include in the SIP 403 (Forbidden) response an application/vnd.3gpp.mcptt-info+xml MIME body as specified in clause F.1 with the <mcpttinfo> element containing the <mcptt-Params> element with the <emergency-ind> element set to a value of \"true\";\nii)\tif the received SIP MESSAGE request contains an <alert-ind> element of the <mcpttinfo> element set to a value of \"false\" and this is an unauthorised request for an MCPTT emergency alert cancellation as determined in step a) above and the emergency state of the MCPTT user has outstanding emergency state, shall include an <alert-ind> element set to a value of \"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP 403 (Forbidden) response; and\niii)\tshall send the SIP 403 (Forbidden) response according to rules and procedures of 3GPP TS 24.229 [4] and skip the rest of the steps; and\nb)\tand if the received SIP MESSAGE request contains an <alert-ind> element set to a value of \"false\" and is an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3 and the MCPTT user has outstanding emergency state:\ni)\tshall clear the cache of the MCPTT ID of the MCPTT user that has the outstanding emergency alert state;\nii)\tfor each of the affiliated members of the group shall:\nA)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's emergency alert as specified in clause 6.3.3.1.11;\nB)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request; and\nC)\tshall include an <alert-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\nD)\tsend the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4];\niii)\tshall generate a SIP 200 (OK) response to the received SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\niv)\tshall send the SIP 200 (OK) response to the received SIP MESSAGE as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\nv)\tshall generate a SIP MESSAGE request as described in clause 6.3.3.1.20 to indicate successful receipt of the request for emergency alert cancellation\nvi)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP MESSAGE request:\nA)\tthe <emergency-ind> element set to a value of \"true\";\nB)\tthe <emergency-ind-rcvd> element set to a value of \"true\";\nC)\tthe <alert-ind> element set to a value of \"false\"; and\nD)\tthe <mcptt-client-id> element with the MCPTT client ID that was included in the incoming SIP MESSAGE request; and\nvii)\tshall send the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4]; and\n2)\tif the received SIP MESSAGE request is an authorised request for an MCPTT in-progress emergency group state cancellation as specified in clause 6.3.3.1.13.4:\na)\tshall set the in-progress emergency state of the group to a value of \"false\";\nb)\tcache the information that the MCPTT user has cancelled the outstanding in-progress emergency state of the group and clear the cache of the all MCPTT ID of the MCPTT users that triggered the setting of the in-progress emergency state of the MCPTT group to \"true\";\nc)\tif the received SIP MESSAGE request contains an <alert-ind> element set to a value of \"false\" and is an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3 and the MCPTT user has outstanding emergency state, clear the cache of the MCPTT ID of the sender of the SIP MESSAGE request as having an outstanding MCPTT emergency alert;\nd)\tfor each of the affiliated members of the group shall:\ni)\tgenerate a SIP MESSAGE request notification of the cancellation of the MCPTT user's/group emergency state as specified in clause 6.3.3.1.11;\nii)\tshall include an <emergency-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request;\niii)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with the <mcptt-calling-user-id> element set to the value of the <mcptt-calling-user-id> element in the received SIP MESSAGE request;\niv)\tif the received SIP MESSAGE request contains an <alert-ind> element of the <mcpttinfo> element set to a value of \"false\" and this is an authorised request for an MCPTT emergency alert cancellation as determined in step c) above, shall include an <alert-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nv)\tsend the SIP MESSAGE request according to according to rules and procedures of 3GPP TS 24.229 [4];\ne)\tshall generate a SIP 200 (OK) response to the received SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\nf)\tshall send the SIP 200 (OK) response to the received SIP MESSAGE as specified in 3GPP TS 24.229 [4].\ng)\tshall generate a SIP MESSAGE request as described in clause 6.3.3.1.20 to indicate successful receipt of the request for in-progress emergency group cancellation;\nh)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body, the <emergency-ind> element set to a value of \"false\" and the <emergency-ind-rcvd> set to \"true\";\ni)\tshall populate the <mcptt-client-id> element with the MCPTT client ID that was included in the incoming SIP MESSAGE request;\nj)\tif the received SIP MESSAGE request contains an <alert-ind> element of the <mcpttinfo> element set to a value of \"false\":\ni)\tif this is an authorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3, shall include an <alert-ind> element set to a value of \"false\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nB)\totherwise, if this is an unauthorised request for an MCPTT emergency alert cancellation as specified in clause 6.3.3.1.13.3, shall include an <alert-ind> element set to a value of \"true\" in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request; and\nk)\tshall send the SIP MESSAGE request according to according to the rules and procedures of 3GPP TS 24.229 [4].\nUpon receipt of SIP 2xx responses to the outgoing SIP MESSAGE requests, the controlling MCPTT function shall follow the procedures specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "12.2\tOff-network emergency alert",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "12.2.1\tGeneral",
                            "text_content": "",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.2\tBasic state machine",
                            "text_content": "The figure 12.2.2.2-1 gives an overview of the main states and transitions on the UE for emergency alert.\nEach emergency alert state machine is per MCPTT group.\nThe figure depicts an emergency alert state machine, which is a crucial component in the communication system. It illustrates the flow of information and the decision-making process during an emergency alert. The state machine is depicted in a flowchart format, with different states representing different alert states. The figure provides a visual representation of the system's logic and decision-making process, making it easier to understand and interpret.\nFigure 12.2.2.2-1: Emergency alert state machine\nThe following pieces of information are associated with the emergency alert state machine:\na)\tthe stored emergency state of the MCPTT group; and\nb)\tthe stored organization name of the MCPPT client.\nNOTE:\tThe emergency alert state machine is referred by the MCPTT off-network group call and MCPTT off-network private call procedures.\nThis state is the start state of this state machine.\nThe UE stays in this state while not in emergency state.\nThis state exists for UE, when the UE has sent a GROUP EMERGENCY ALERT message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "12.2.3\tProcedures",
                            "text_content": "When in state \"E1: Not in emergency state\", upon receiving an indication from the MCPTT user to transmit an emergency alert for an MCPTT group ID, and the values of \"/<x>/<x>/Common/MCPTTGroupCall/EmergencyAlert/Authorised\" leaf node present in the user profile and \"/<x>/<x>/Common/AllowedEmergencyAlert\" present in group configuration as specified in 3GPP TS 24.483 [45] are set to \"true\", the MCPTT client:\n1)\tshall set the stored emergency state as \"true\";\n2)\tshall set the stored MCPTT group ID to the indicated MCPTT group ID;\n3)\tshall generate a GROUP EMERGENCY ALERT message as specified in clause 15.1.16. In the GROUP EMERGENCY ALERT message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID;\nb)\tshall set the Originating MCPTT user ID IE to own MCPTT user ID;\nc)\tshall set the Organization name IE to own organization name; and\nd)\tmay set the User location IE with client's current location, if requested;\n4)\tshall send the GROUP EMERGENCY ALERT message as specified in clause 10.2.1.1.1;\n5)\tshall start timer TFE2 (emergency alert retransmission); and\n6)\tshall enter \"E2: Emergency state\" state.\nWhen in state \"E2: Emergency state\", upon expiry of timer TFE2 (emergency alert retransmission), the MCPTT client:\n1)\tshall generate a GROUP EMERGENCY ALERT message as specified in clause 15.1.16. In the GROUP EMERGENCY ALERT message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID;\nb)\tshall set the originating MCPTT user ID IE to own MCPTT user ID;\nc)\tshall set the Organization name IE to own organization name; and\nd)\tmay set the Location IE with client's current location, if requested; and\n2)\tshall send the GROUP EMERGENCY ALERT message as specified in clause 10.2.1.1.1;\n3)\tshall start the timer TFE2 (emergency alert retransmission); and\n4)\tshall remain in the current state.\nWhen in state \"E1: Not in emergency state\" or in \"E2: Emergency state\", upon receiving a GROUP EMERGENCY ALERT message with the Originating MCPTT user ID IE not stored in the list of users in emergency, the MCPTT client:\n1)\tshall store the Originating MCPTT user ID IE and location IE in the list of users in emergency;\n2)\tshall generate a GROUP EMERGENCY ALERT ACK message as specified in clause 15.1.17. In the GROUP EMERGENCY ALERT ACK message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the MCPTT group ID IE of the received GROUP EMERGENCY ALERT message;\nb)\tshall set the Sending MCPTT user ID IE to own MCPTT user ID; and\nc)\tshall set the Originating MCPTT user ID IE to the Originating MCPTT user ID IE of the received GROUP EMERGENCY ALERT message; and\n3)\tshall send the GROUP EMERGENCY ALERT ACK message as specified in clause 10.2.1.1.1;\n4)\tshall start timer TFE1 (emergency alert); and\n5)\tshall remain in the current state.\nNOTE:\tEach instance of timer TFE1 is per MCPTT user ID.\nWhen in state \"E1: Not in emergency state\" or in \"E2: Emergency state\", upon receiving a GROUP EMERGENCY ALERT message with the Originating MCPTT user ID IE stored in the list of users in emergency, the MCPTT client:\n1)\tmay update the stored location of the user with the received Location IE;\n2)\tshall restart the associated timer TFE1 (emergency alert); and\n3)\tshall remain in the current state.\nWhen in \"E2: Emergency state\", upon receiving an indication from the MCPTT user to cancel an emergency alert and the value of \"/<x>/<x>/Common/MCPTTGroupCall/EmergencyAlert/Cancel\" leaf node present in the user profile as specified in 3GPP TS 24.483 [45] set to \"true\", the MCPTT client:\n1)\tshall set the stored emergency state as \"false\";\n2)\tshall generate a GROUP EMERGENCY ALERT CANCEL message as specified in clause 15.1.18. In the GROUP EMERGENCY ALERT CANCEL message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the stored MCPTT group ID;\nb)\tshall set the Originating MCPTT user ID IE to own MCPTT user ID; and\nc)\tshall set the Sending MCPTT user ID IE to own MCPTT user ID;\n3)\tshall send the GROUP EMERGENCY ALERT CANCEL message as specified in clause 10.2.1.1.1;\n4)\tshall stop timer TFE2 (emergency alert retransmission); and\n5)\tshall enter \"E1: Not in emergency state\" state.\nWhen in state \"E1: Not in emergency state\" or in \"E2: Emergency state\", upon receiving a GROUP EMERGENCY ALERT CANCEL message with the Originating MCPTT user ID IE stored in the list of users in emergency, the MCPTT client:\n1)\tshall remove the MCPTT user ID and associated location information from the stored list of users in emergency;\n2)\tshall generate a GROUP EMERGENCY ALERT CANCEL ACK message as specified in clause 15.1.19. In the GROUP EMERGENCY ALERT CANCEL ACK message, the MCPTT client:\na)\tshall set the MCPTT group ID IE to the MCPTT group ID IE of the received GROUP EMERGENCY ALERT CANCEL message; and\nb)\tshall set the Sending MCPTT user ID IE to own MCPTT user ID; and\nc)\tshall set the Originating MCPTT user ID IE to the Originating MCPTT user ID IE of the received GROUP EMERGENCY ALERT message;\n3)\tshall send the GROUP EMERGENCY ALERT CANCEL ACK message as specified in clause 10.2.1.1.1;\n4)\tshall stop the associated timer TFE1 (emergency alert); and5)\tshall remain in the current state.\nWhen in state \"E1: Not in emergency state\" or in \"E2: Emergency state\", upon expiry of timer TFE1 (emergency alert) associated with a stored MCPTT user ID, the MCPTT client:\n1)\tshall remove the MCPTT user ID and associated location information from the stored list of users in emergency; and\n2)\tshall remain in the current state.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "13\tLocation procedures",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "13.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "If the participating MCPTT function needs to obtain location information, the participating MCPTT function configures the MCPTT client upon successful service authorization. The configuration contains information the MCPTT client uses to set up filter criteria for when the MCPTT client shall send location reports to the participating MCPTT function.\nThe participating MCPTT function can also explicitly request the MCPTT client to send a location report.\nThe MCPTT client will, based on the received configuration or when explicitly requested, send location reports.\nThe location information is used by the participating MCPTT function to determine whether to use MBMS bearers or not as described in clause 14.\nIn case of LTE MBMS and 5G MBS co-existence, the inter-RAT information contained in the location information is used by the participating MCPTT function to determine how to receive MCPTT services after inter-RAT change.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "13.2\tParticipating MCPTT function location procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "13.2.1\tGeneral",
                            "text_content": "The participating MCPTT function has procedures to:\n-\tconfigure the location reporting at the UE;\n-\trequest the UE to report the location of the UE; and\n-\treceive a location information report from the UE.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.2\tLocation reporting configuration",
                            "text_content": "The participating MCPTT function may configure the location reporting in the MCPTT client by generating a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]. The participating MCPTT function:\n1)\tshall include a Request-URI set to the URI corresponding to the identity of the MCPTT client;\n2)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" in accordance with IETF RFC 3841 [6];\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-request-uri> element containing the MCPTT ID of the MCPTT user to receive the configuration;\n4)\tshall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with the <Configuration> element contained in the <location-info> root element set to the desired configuration;\n5)\tshall include the TriggerId attribute where defined for the sub-elements defining the trigger criterion ;\n6)\tshall include the public service identity of the participating MCPTT function in the P-Asserted-Identity header field;\n7)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n8)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nNOTE:\tThe participating MCPTT function can first identify the users that have activated a functional alias. It can learn the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.2.2.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.3\tLocation information request",
                            "text_content": "If the participating MCPTT function needs to request the MCPTT client to report its location, the participating MCPTT functions shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]. The participating MCPTT function:\n1)\tshall include a Request-URI set to the URI corresponding to the identity of theMCPTT client;\n2)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" in accordance with IETF RFC 3841 [6];\n3)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with an <mcptt-request-uri> element containing the MCPTT ID of the MCPTT user;\n4)\tshall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Request> element contained in the <location-info> root element;\n5)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nNOTE:\tThe participating MCPTT function can first identify the users that have activated a functional alias. It can learn the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.2.2.8.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.4\tLocation information report",
                            "text_content": "If the participating MCPTT function receives a SIP request containing:\n1)\ta Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\"; and\n2)\tan application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element;\nthen the participating MCPTT function shall authorise the location report based on the MCPTT ID received. If the MCPTT user is authorised to send a location report the participating MCPTT function:\n1)\tshall use the location information as needed; and\n2)\tshall follow the procedure of clause 6.3.2.4.1, if the MCPTT client has entered into or exited from an emergency alert area ;and\n3)\tshall follow the procedure of clause 6.3.2.4.2, if the MCPTT client has entered into or exited from a group geographic area.\nNOTE:\tThe <Report> element contains the event triggering identity in the location information report from the UE, and can contain location information.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.2.5\tAbnormal cases",
                            "text_content": "Upon receipt of a SIP request:\n1)\twhere the P-Asserted-Identity identifies a public user identity not associated with an MCPTT user served by the participating MCPTT function; or\n2)\twith a MIME body with Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\" and with a <mcptt-request-URI> element containing an MCPTT ID that identifies an MCPTT user served by the participating MCPTT function;\nthen, when the SIP request contains:\n1)\tan Accept-Contact header field with the g.3gpp.mcptt media feature tag;\n2)\tan Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n3)\tan application/vnd.3gpp.mcptt-location-info+xml MIME body containing a <Request> element or a <Configuration> element;\nthe participating MCPTT function shall remove the application/vnd.3gpp.mcptt-location-info+xml MIME body from the outgoing SIP request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "13.3\tMCPTT client location procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "13.3.1\tGeneral",
                            "text_content": "The MCPTT client sends a location report when one of the trigger criteria is fulfilled or when it receives a request from the participating MCPTT function to send a location report. To send the location report the MCPTT client can use an appropriate SIP message that it needs to send for other reasons, or it can include the location report in a SIP MESSAGE request.\nTo send a location report, the MCPTT client includes in the SIP MESSAGE request an application/vnd.3gpp.mcptt-location-info+xml MIME body as specified in clause F.3. The MCPTT client populates the elements in accordance with its reporting configuration. Further location information may also be included in the P-Access-Network-Info header field.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.2\tLocation reporting configuration",
                            "text_content": "Upon receiving a SIP MESSAGE request containing:\n1)\tan Accept-Contact header field with the media feature tag g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2)\ta Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\"; and\n3)\tan application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Configuration> root element included in the <location-info> root element;\nthen the MCPTT client:\n1)\tshall store the contents of the <Configuration> elements;\n2)\tshall set the location reporting triggers accordingly; and\n3)\tshall start the minimumReportInterval timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.3\tLocation information request",
                            "text_content": "Upon receiving a SIP MESSAGE request containing\n1)\tan Accept-Contact header field with the media feature tag g.3gpp.icsi-ref set to the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n2)\ta Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\"; and\n3)\tan application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Request> element included in the <location-info> root element;\nthen the MCPTT client:\n1)\tshall send a location report as specified in clause 13.3.4; and\n2)\tshall reset the minimumReportInterval timer.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "13.3.4\tLocation information report",
                            "text_content": "If a location reporting trigger fires the MCPTT client checks if the minimumReportInterval timer is running. If the timer is running the MCPTT client waits until the timer expires. When the minimumReportInterval timer fires, the MCPTT client:\n1)\tshall, if any of the reporting triggers are still true, send a location information report as specified in clause 13.3.4.2.\nIf the MCPTT client receives a location information request as specified in clause 13.3.3, the MCPTT client shall send a location report as specified in clause 13.3.4.2.\nIf the MCPTT client needs to send a SIP request for other reasons (e.g. a SIP MESSAGE request containing an MBMS listening report as described in clause 14), the MCPTT client:\n1)\tshall include an application/vnd.3gpp.mcptt-location-info+xml MIME body and in the <location-info> root element the MCPTT client shall include:\na)\ta <Report> element and if the Report was triggered by a location request include the <ReportID> attribute set to the value of the <RequestID> attribute in the received Request;\nb)\t<TriggerId> child elements, where each element is set to the value of the <Trigger-Id> attribute associated with the trigger that have fired; and\nc)\tthe location reporting elements corresponding to the triggers that have fired;\n2)\tshall set the minimumReportInterval timer to the minimumReportInterval time and start the timer; and\n3)\tshall reset all triggers.\nIf the MCPTT client does not need to send a SIP request for other reasons, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]. The MCPTT client;\n1)\tshall include in the Request-URI, the SIP URI received in the P-Asserted-Identity header field in the received SIP MESSAGE request for location report configuration;\n2)\tshall include a Content-Type header field set to \"application/vnd.3gpp.mcptt-location-info+xml\";\n3)\tshall include an application/vnd.3gpp.mcptt-location-info+xml MIME body and in the <location-info> root element include:\na)\ta <Report> element and if the Report was triggered by a location request include the <ReportID> attribute set to the value of the <RequestID> attribute in the received Request;\nb)\ta <TriggerId> child element set to the value of each <Trigger-Id> value of the triggers that have fired; and\nc)\tthe location reporting elements corresponding to the triggers that have fired;\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.mcptt along with parameters \"require\" and \"explicit\" in accordance with IETF RFC 3841 [6];\n5)\tshall set the minimumReportInterval timer to the minimumReportInterval time and start the timer;\n6)\tshall reset all triggers; and\n7)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "14\tMBMS transmission usage procedure",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "14.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the participating MCPTT function and the MCPTT client procedure for:\n1)\tMBMS bearer announcements;\n2)\tMBMS bearer listening status; and\n3)\tMBMS bearer suspension status.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14.2\tParticipating MCPTT function MBMS usage procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14.2.1\tGeneral",
                            "text_content": "This clause describes the procedures in the participating MCPTT function for:\n1)\tsending an MBMS bearer announcements to the MCPTT client;\n2)\treceiving an MBMS bearer listening status from the MCPTT client; and\n3)\treceiving an MBMS bearer suspension status from the MCPTT client.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.2.2\tSending MBMS bearer announcement procedures",
                            "text_content": "The availability of a MBMS bearer is announced to MCPTT clients by means of an MBMS bearer announcement message. One or more MBMS bearer announcement elements are included in an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body.\nAn MBMS bearer announcement message can contain new MBMS bearer announcements, updated MBMS bearer announcements or cancelled MBMS bearer announcements or a mix of all of them at the same time in an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body. Each initial MBMS bearer announcement message announces one MBMS bearer intended to carry a general purpose MBMS subchannel used for application level multicast signalling in a specified MBMS service area and additionally, the message could also announce zero or more extra MBMS bearers intended to carry media and media control.\nNOTE:\tA new MBMS bearer announcement does not implicitly remove previously sent MBMS bearer announcements if the previously sent MBMS bearer announcement is not included in an MBMS bearer announcement message. However, the application/sdp MIME body, if included in the new MBMS bearer announcement message, fully replaces the existing application/sdp MIME body (which includes the MSCCK security key used to protect the general purpose MBMS subchannel).\nWhen and to whom the participating MCPTT function sends the MBMS bearer announcement is based on local policy in the participating MCPTT function.\nThe following clauses describe how the participating MCPTT function:\n1.\tsends an initial MBMS bearer announcement message;\n2.\tupdates a previously sent announcement of MBMS bearer(s);\n3.\tcancels a previously sent announcement of MBMS bearer(s); and\n4.\tkeys, re-keys or un-keys MCPTT groups using Multicast Signalling Key (MuSiK) via a key download procedure.\nPrior to the participating MCPTT function transmitting on an MBMS bearer, the participating MCPTT function:\n1.\tif necessary, shall instruct the local key management client to request keying material from the key management server as described in 3GPP TS 33.180 [78];\n2.\tshall generate MSCCK(s) with the corresponding MSCCK-ID(s) and MuSiK(s) with the corresponding MuSiK-ID(s) as necessary; and\n3.\tshall distribute MSCCKs, MSCCK-IDs, MuSiKs and MuSiK-IDs to the MCPTT clients, as needed, using the keying material received from the key management server for security protection, as described in 3GPP TS 33.180 [78].\nFor each MCPTT client that the participating MCPTT function is sending an MBMS bearer announcement to, the participating MCPTT function:\n1)\tshall generate an SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall set the Request-URI to the URI received in the To header field in a third-party SIP REGISTER request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall include one application/sdp MIME body conforming to 3GPP TS 24.229 [4], where the application/sdp MIME body:\na)\tshall include the Content-Disposition header field with the value \"render\";\nb)\tshould include one or more \"m=audio\" media lines and media line attributes as defined in 3GPP TS 24.380 [5] to be used as the MBMS subchannel for audio and media control. Additionally, the participating MCPTT function:\ni)\tshall set c-line to the unspecified address (0.0.0.0), if IPv4, or to a domain name within the \".invalid\" DNS top-level domain, if IPv6;\nii)\tshall set port number of the media line to 9;\nii)\tshall include the \"a=rtcp-mux\" attribute as specified in IETF RFC 5761 [39]; and\niii)\tshall include the \"a=rtcp:9\" as specified in IETF RFC 5761 [39].\nc)\tshould include one or more \"m=audio\" media lines and media line attributes as defined in 3GPP TS 24.380 [5] to be used as the MBMS subchannel for audio only. Additionally, the participating MCPTT function:\ni)\tshall set the c-line to the unspecified address (0.0.0.0), if IPv4, or to a domain name within the \".invalid\" DNS top-level domain, if IPv6; and\nii)\tshall set the port number of the media line to 9;\nNOTE 1:\tIf an MBMS subchannel for audio only is included, the \"a=rtcp-mux\" and \"a=rtcp:\" attributes are not included in the media line.\nd)\tshall include one \"m=application\" media line as defined in 3GPP TS 24.380 [5] to be used as the general purpose MBMS subchannel. The media line shall include a valid multicast IP address and a valid port number. If the protection of MBMS subchannel control messages sent over the general purpose MBMS subchannel of the MBMS bearer is required, the participating MCPTT function also includes an \"a=key-mgmt\" media-level attribute. The participating MCPTT function:\ni)\tshall encrypt the MSCCK to a UID associated to the targeted MCPTT ID and a time related parameter as described in 3GPP TS 33.180 [78];\nii)\tshall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated MSCCK and MSCCK-ID as specified in 3GPP TS 33.180 [78];\niii)\tshall add the public service identity of the participating MCPTT function to the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78];\niv)\tshall sign the MIKEY-SAKKE I_MESSAGE using the public service identity of the participating MCPTT function signing key provided in the keying material together with a time related parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS 33.180 [78]; and\nv)\tshall include the \"mikey\" key management and protocol identifier and the signed MIKEY-SAKKE I_MESSAGE in the value of the a=key-mgmt\" media-level attribute according to IETF RFC 4567 [47]; and\nNOTE 2:\tThe media parameters to be used by the MBMS subchannel for media is included in the Map Group To Bearer message defined in 3GPP TS 24.380 [5] and not included in this application/sdp MIME body.\ne)\tif \"m=audio\" media lines to be used in an MBMS subchannel for audio only are included above, shall include one or more \"m=application\" media line as defined in 3GPP TS 24.380 [5] to be used as the MBMS subchannel for floor control messages. The media line:\ni)\tshall set c-line to the unspecified address (0.0.0.0), if IPv4, or to a domain name within the \".invalid\" DNS top-level domain, if IPv6; and\nii)\tshall set the port number of the media line to 9;\nNOTE 3:\tThe use of a separate MBMS subchannel for floor control is optional. When a separate MBMS subchannel for floor control is not used, floor control messages are sent in the MBMS subchannel for media.\nNOTE 4:\tThe port number 9 used in this clause indicates that the final address and port has not yet been determined. The final address and port information will be sent in the Map Group To Bearer message and MapGroupToSessionStream message.\n6)\tshall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body defined in clause F.2 with the <version> element set to \"1\" and one or more <announcement> elements associated with the pre-activated MBMS bearers. Each set of an <announcement> element:\na)\tshall include a TMGI value in the <TMGI> element;\nNOTE 5:\tThe same TMGI value can only appear in one <announcement> element. The TMGI value is also used to identify the <announcement> when updating or cancelling the <announcement> element.\nNOTE 6:\tThe security key active for the general purpose MBMS subchannel on which the mapping (i.e. the Map Group To Bearer message) of media or media control to this MBMS bearer was indicated, is used for MBMS subchannels on this MBMS bearer, unless a different key or an indication of not using encryption is in place.\nb)\tshall include the QCI value in the <QCI> element;\nc)\tif multiple carriers are supported, shall include the frequency to be used in the <frequency> element;\nNOTE 7:\tIn the current release if the <frequency> element is included, the frequency in the <frequency> element is the same as the frequency used for unicast.\nd)\tshall include one or more MBMS service area IDs in <mbms-service-area-id> elements in the <mbms-service-areas> element;\nNOTE 8:\tInitial mappings of groups to MBMS subchannels on an MBMS bearer for the purpose of carrying media or media control can occur only where the MBMS service area for this bearer and the MBMS service area for the bearer carrying the general purpose MBMS subchannel on which the Map Group To Bearer message is sent intersect. However, once media or media control were successfully mapped to this bearer, the reception by the MCPTT client can continue (until Unmap Group To Bearer is received or until timeout) throughout the entire MBMS service area of this bearer.\ne)\tmay include the <report-suspension> element and set it to \"true\" value or the \"false\" value;\nNOTE 9:\tThe participating function can choose to direct some clients not to send an MBMS bearer suspension report when notified by RAN, by including the <report-suspension> element set to \"false\". The purpose is to prevent an avalanche of identical reports sent by clients roughly at the same time, to report the suspension of the same MBMS bearer. The way the participation function determines which clients are to send or not to send the report is outside the scope of the present document.\nf)\tif the MBMS bearer is carrying the general purpose MBMS subchannel, shall include one <GPMS>element, giving the number of the \"m=application\" media line in the application/sdp MIME body generated in step 5 above to be used for the general purpose MBMS subchannel; and\ng)\tif the packet headers are compressed with ROHC specified in RFC 5795 [80] in this MBMS bearer, the <anyExt> element in the <announcement> element in the <mcptt-mbms-usage-info> element shall include the <mcptt-mbms-rohc> element defined in clause F.2.3.\n7)\tshall include the MBMS public service identity of the participating MCPTT function in the P-Asserted-Identity header field;\n8)\tshall include in a MIME body with Content-Type header field set to \"application/vnd.3gpp.mcptt-info+xml\", the <mcptt-request-uri> element set to the MCPTT ID of the user; and\n9)\tshall send the SIP MESSAGE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nWhen the participating MCPTT function wants to update a previously sent announcement, the participating MCPTT function sends an MBMS bearer announcement in an SIP MESSAGE request as specified in clause 14.2.2.2 where the participating MCPTT function in the <announcement> element to be updated:\n1)\tshall include the same TMGI value as in the MBMS bearer announcement to be updated in the <TMGI> element;\nNOTE 1:\tTMGI value is used to identify the <announcement> when updating or cancelling the <announcement> element and can't be changed.\n2)\tshall include the same or an updated value of the QCI in the <QCI> element;\n3)\tif a frequency was included in the previously sent announcement, shall include the same value in the <frequency> element;\nNOTE 2:\tIn the current release if the <frequency> element is included, the frequency in the <frequency> element is the same as the frequency used for unicast.\n4)\tshall include the same list of MBMS service area IDs or an updated list of MBMS service area IDs in the <mbms-service-areas> element;\n5)\tmay include the same or an updated value in the <report-suspension> element;\n6)\tshall include the <GPMS> element with the same value as in the initial <announcement> element; and\n7)\tshall include the same application/sdp MIME body as included in the initial MBMS announcement.\nWhen the participating MCPTT function wants to cancel an MBMS bearer announcement associated with an <announcement> element, the participating MCPTT function sends an MBMS bearer announcement as specified in clause 14.2.2.2 where the participating MCPTT function in the <announcement> element to be cancelled:\n1)\tshall include the same TMGI value as in the <announcement> element to be cancelled in the <TMGI> element;\n2)\tshall not include an <mbms-service-areas> element;\n3)\tif the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body only contains <announcement> elements that are to be cancelled, shall not include an <GPMS> element; and\n4)\tif the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body only contains <announcement> elements that are to be cancelled, shall not include an application/sdp MIME body.\nFor each MCPTT client that the participating MCPTT function is intending to use an MBMS bearer to transmit confidentiality protected floor control signalling (SRTCP) to the client, the participating MCPTT function shall perform a key download procedure for each Multicast Signalling Key (MuSiK). Two kinds of MuSiK download are possible: default MuSiK download and explicit MuSiK download. The default MuSiK download is used to set, reset or unset a MuSiK and its corresponding MuSiK-ID and is applicable to all groups supported by the MCPTT client, except for certain identified groups for which MuSiKs and MUSiK-IDs are assigned, reassigned or unassigned separately via explicit MuSiK download. The default MuSiK and MUSiK-ID can apply to all the MCPTT clients supported by the participating MCPTT function and can be overridden by the explicit MuSiK download which is selectively applied only to the MCPTT clients using the explicitly identified groups. A group subject to explicit MuSiK download, can be switched to the default MuSiK protection via a default MuSiK download identifying that group. The participating MCPTT function:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n2)\tshall set the Request-URI to the URI received in the To header field in a third-party SIP REGISTER request;\n3)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n4)\tshall include a P-Asserted-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body defined in clause F.2 with the <version> element set to \"1\", and either\na)\tcontaining an <mbms-explicitMuSiK-download> element with at least one <group> element associated with the MuSiK being downloaded; or\nb)\tcontaining an <mbms-defaultMuSiK-download> element with zero or more <group> elements associated with the MuSiK being downloaded;\n6)\tif the floor control signaling for the group(s) in the specified list is to be protected using the MuSiK, shall include an application/mikey MIME body with the MIKEY message containing the encrypted MuSiK and the corresponding MuSiK-ID, constructed as described in clauses 5.8.1 and 5.2.2 of 3GPP TS 33.180 [78];\nNOTE:\tClause 9.2.1.3 of 3GPP TS 33.180 [78] shows an example on how to include an application/mikey MIME body in a SIP message.\n7)\tshall send the SIP MESSAGE request towards the MCPTT client according to 3GPP TS 24.229 [4].\nThe participating MCPTT function shall consider the key download successful on receipt of a 200 OK message in response to the SIP MESSAGE request sent in step 7).\nA participating MCPTT function that does not receive a 200 OK message from a specific MCPTT client shall use unicast signalling for floor control towards that MCPTT client for the groups for which the MuSiK was intended.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.2.3\tReceiving an MBMS bearer listening status from an MCPTT client",
                            "text_content": "Upon receiving a \"SIP MESSAGE request for an MBMS listening status update\", the participating MCPTT function shall handle the request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33].\nIf the SIP MESSAGE request contains:\n1)\tan application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body with an <mbms-listening-status> element; and\n2)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an MCPTT ID in the <mcptt-request-uri> served by the participating MCPTT function;\nthen the participating MCPTT function:\n1)\tshall verify that the public user identity in the P-Asserted-Identity header field is bound to the MCPTT ID in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, and if that is the case:\na)\tif the <mbms-listening-status> element is set to \"listening\":\ni)\tif a <session-id> element is included, shall indicate to the media plane that the MCPTT client in the session identified by the <session-id> element is now listening to the MBMS subchannel; and\nii)\tif <general-purpose> element is included with the value \"true\", shall indicate to the media plane that the MCPTT client is now listening to the general purpose MBMS subchannel; and\nNOTE 1:\tThe <mbms-listening-status> element can contain an <anyExt> element containing an <mbms-reception-quality> element. The use of this element is implementation specific.\nb)\tif the <mbms-listening-status> element is set to \"not-listening\":\ni)\tif a <session-id> element is included, shall indicate to the media plane that the MCPTT client in the sessions identified by the <session-id> elements is not listening to the MBMS subchannel;\nii)\tif <general-purpose> element is included with the value \"false\", shall indicate to the media plane that the MCPTT client is no longer listening to the general purpose MBMS bearer; and\niii)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5].\nNOTE 2:\tIf the MCPTT client reports that the MCPTT client is no longer listening to the general purpose MBMS subchannel it is implicitly understood that the MCPTT client no longer listens to any MBMS subchannel in ongoing conversations that the MCPTT client previously reported status \"listening\".\nNOTE 3:\tThe <mbms-listening-status> element can contain an <anyExt> element containing an <mbms-reception-quality> element. The use of this element is implementation specific.\nIf the SIP MESSAGE request contains:\n1)\tan application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body with an <mbms-suspension-status> element; and\n2)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an MCPTT ID in the <mcptt-request-uri> served by the participating MCPTT function;\nthen the participating MCPTT function:\n1)\tshall verify that the public user identity in the P-Asserted-Identity header field is bound to the MCPTT ID in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, and if that is the case:\na)\tif the <mbms-suspension-status> element is set to \"suspending\":\ni)\tshall consider that the bearer identified by the <suspended-TMGI> element is about to be suspended and that the reduction or elimination of traffic on that bearer and/or on some of the bearers indicated in the <other-TMGI> elements can potentially avoid the suspension; and\nNOTE 4:\tAn MBMS bearer is about to be suspended when RAN has notified the clients of the decision to suspend the bearer, but the actual suspension, which would occur at the end of the MCCH modification period, has not taken place yet because the MCCH modification period has not yet expired.\nii)\tmay take implementation/configuration specific immediate action for the MCPTT client that reports the suspension as well as other MCPTT clients that listen to the same bearer (e.g. moving traffic to unicast bearer(s)), reducing transmission rate, eliminating traffic, modifying pre-emption priority); or\nb)\tif the <mbms-suspension-status> element is set to \"not-suspending\":\ni)\tshall consider that the bearer identified by the <suspended-TMGI> element is no longer about to be suspended; and\nNOTE 5:\tAn MBMS bearer is no longer about to be suspended when RAN has notified the clients of the decision to no longer suspend the bearer after having previously notified the clients that the bearer would be suspended at the end of the MCCH modification period. The RAN notifications to first suspend and subsequently not to suspend the same MBMS bearer would have to come within the same MCCH modification period.\nii)\tmay take implementation/configuration specific immediate action for the MCPTT client that reports the suspension as well as other MCPTT clients that listen to the same bearer (e.g. restoring traffic previously reduced or eliminated from MBMS bearers upon reception of suspension information).\nNOTE 6:\tIf the MCPTT client reports that the MCPTT client is no longer listening to MBMS subchannels associated with the MBMS bearer indicated in the suspension information, it is implicitly understood that the suspension of that MBMS bearer has actually occurred.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.2.4\tAbnormal cases",
                            "text_content": "Upon receipt of a SIP MESSAGE request with an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\n1)\twhere the P-Asserted-Identity identifies a public user identity not associated with MCPTT user served by the participating MCPTT function; or\n2)\twith an application/vnd.3gpp.mcptt-info+xml MIME body and with a <mcptt-request-uri> element containing an MCPTT ID that identifies an MCPTT user served by the participating MCPTT function and an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body containing one or more <announcement> elements;\nthen the participating MCPTT function shall send a SIP 403 (Forbidden) response as specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "14.3\tMCPTT client MBMS usage procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14.3.1\tGeneral",
                            "text_content": "This clause describes the procedures in the MCPTT client for:\n1)\treceiving an MBMS bearer announcement from the participating MCPTT function;\n2)\tsending an MBMS bearer listening status report to the participating MCPTT function; and\n3)\tsending an MBMS bearer suspension status report to the participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.2\tReceiving an MBMS bearer announcement",
                            "text_content": "The MCPTT client associates each received application/sdp MIME body and each received security key with a general purpose MBMS subchannel announced in the same MBMS Bearer Announcement message. When receiving a Map Group To Bearer message, the MCPTT client interprets its content (e.g. the m= line number) in the context of the application/sdp MIME body associated with the general purpose MBMS subchannel on which the Map Group To Bearer was received.\nWhen the MCPTT client receives a SIP MESSAGE request containing:\n1)\ta P-Asserted-Service header field containing the \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n2)\tan application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body containing one or more an <announcement> element(s);\nthen the MCPTT client for each <announcement> element in the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\n1)\tif the <mbms-service-areas> element is present:\na)\tif an <announcement> element with the same value of the <TMGI> element is already stored:\ni)\tshall replace the old <announcement> element with the <announcement> element received in the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body;\nb)\tif there is no <announcement> element with the same value of the <TMGI> element stored:\ni)\tshall store the received <announcement> element;\nc)\tshall associate the received announcement with the received application/sdp MIME body;\nd)\tshall associate the received announcement with the received <GPMS> element;\ne)\tshall store the MBMS public service identity of the participating MCPTT function received in the P-Asserted-Identity header field and associate the MBMS public service identity with the new <announcement> element;\nf)\tif a \"a=key-mgmt\" media-level attribute with the \"mikey\" key management and protocol identifier and a MIKEY-SAKKE I_MESSAGE is included for the general purpose MBMS subchannel defined in the \"m=application\" media line in the application/sdp MIME body in the received SIP MESSAGE request,\ni)\tshall extract the initiator URI from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the initiator URI deviates from the public service identity of the participating MCPTT function serving the MCPTT user, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nii)\tshall convert the initiator URI to a UID as described in 3GPP TS 33.180 [78];\niii)\tshall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as described in 3GPP TS 33.180 [78];\niv)\tif authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall reject the SIP MESSAGE request with a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and include warning text set to \"136 authentication of the MIKEY-SAKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nv)\tshall extract and decrypt the encapsulated MSCCK using the participating MCPTT function's (KMS provisioned) UID key as described in 3GPP TS 33.180 [78]; and\nvi)\tshall extract the MSCCK-ID, from the payload as specified in 3GPP TS 33.180 [78];\nNOTE:\tWith the MSCCK successfully shared between the participating MCPTT function and the served UEs, the participating MCPTT function is able to securely send MBMS subchannel control messages to the MCPTT clients.\ng)\tshall listen to the general purpose MBMS subchannel defined in the \"m=application\" media line in the application/sdp MIME body in the received SIP MESSAGE request when entering an MBMS service area where the announced MBMS bearer is available; and\nh)\tshall check the condition for sending a listening status report as specified in the clause 14.3.3; and\n2)\tif no <mbms-service-areas> element is present:\na)\tshall discard a previously stored <announcement> element identified by the value of the <TMGI>;\nb)\tshall remove the association with the stored application/sdp MIME body and stop listening to the general purpose MBMS subchannel;\nc)\tif no more <announcement> elements associated with the stored application/sdp MIME body are stored in the MCPTT client, shall remove the stored application/sdp MIME body; and\nd)\tcheck the condition for sending a listening status report as specified in the clause 14.3.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.3\tThe MBMS bearer listening status and suspension report procedures",
                            "text_content": "If one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives a Map Group To Bearer message over the general purpose MBMS channel;\nb)\tparticipates in a group session identified by the Map Group To Bearer message; and\nc)\tthe status \"listening\" is not already reported; or\n2)\tif the MCPTT client:\na)\treceives an announcement as described in clause 14.3.2;\nb)\tenters an MBMS service area where a general purpose MBMS is available; and\nc)\texperiences good MBMS bearer radio condition;\nthen the MCPTT client shall report that the MCPTT client is listening to the MBMS bearer as specified in clause 14.3.3.2.\nIf one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives an MBMS bearer announcement as described in the clause 14.3.2;\nb)\tthe MBMS bearer announcement contains a cancellation of an <announcement> element identified by the same TGMI value as received in a Map Group To Bearer message in an ongoing conversation; and\nc)\tthe status \"not-listening\" is not already reported;\n2)\tif the MCPTT client:\na)\treceives an MBMS bearer announcement as described in the clause 14.3.2;\nb)\tthe MBMS bearer announcement contains a cancellation of an <announcement> element;\nc)\tdoes not participate in an ongoing conversation;\nd)\tthe MCPTT client has reported the \"listening\" status due to the availability of the general purpose MBMS subchannel in the <announcement> element; and\ne)\tthe status \"not-listening\" is not already reported; or\n3.\tif the MCPTT client:\na)\tsuffers from bad MBMS bearer radio condition,\nthen the MCPTT client shall report that the MCPTT client is not listening to the MBMS subchannels as specified in clause 14.3.3.2.\nIf all the following conditions are fulfilled:\n1)\tthe MCPTT client has reported \"listening\" as the most recent listening status relative to an MBMS bearer;\n2)\tthe MCPTT client is notified that the MBMS bearer is about to be suspended by the RAN; and\n3)\tthe MCPTT client has not received a MBMS bearer announcement containing a <report-suspension> element set to \"false\",\nthen the MCPTT client shall report that the MBMS bearer is about to be suspended, as specified in clause 14.3.3.2.\nIf all the following conditions are fulfilled:\n1)\tthe MCPTT client has reported \"listening\" as the most recent listening status relative to an MBMS bearer;\n2)\tthe MCPTT client has reported that the MBMS bearer is about to be suspended, but the suspension of the bearer has not been detected yet by the MCPTT client;\n3)\tthe MCPTT client is notified that the MBMS bearer is no longer to be suspended by the RAN; and\n4)\tthe MCPTT client has not received a MBMS bearer announcement containing a <report-suspension> element set to \"false\",\nthen the MCPTT client shall report that the MBMS bearer is no longer to be suspended, as specified in clause 14.3.3.2.\nWhen the MCPTT client wants to report the MBMS bearer listening status, the MCPTT client:\nNOTE 1:\tThe application/vnd.3gpp.mcptt-mbms-usage-info+xml can contain both the listening status \"listening\" and \"not listening\" at the same time.\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and\na)\tshall include in the Request-URI the MBMS public service identity of the participating MCPTT function received in the P-Asserted-Identity header field of the announcement message;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\nc)\tshould include a public user identity in the P-Preferred-Identity header field as specified in 3GPP TS 24.229 [4];\nd)\tshall include a P-Preferred-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\ne)\tshall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body with the <version> element set to \"1\";\nf)\tif the MCPTT client is listening to the MBMS bearer, the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\ni)\tshall include an <mbms-listening-status> element set to \"listening\";\nii)\tif the intention is to report that the MCPTT client is listening to the MBMS subchannel for an ongoing conversation in a session (e.g. as the response to the Map Group To Bearer message), shall include the MCPTT session identity of the ongoing conversation in a <session-id> element;\niii)\tshall include one or more <TGMI> elements for which the listening status applies;\niv)\tif the intention is to report that the MCPTT client is listening to the general purpose MBMS subchannel, shall include the <general-purpose> element set to \"true\"; and\nv)\tmay include an anyExt element containing:\nA)\tan <mbms-reception-quality> element indicating the received satisfactory quality level;\ng)\tif the MCPTT client is not listening, the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\ni)\tshall include an <mbms-listening-status> element set to \"not-listening\";\niii)\tshall include one or more <TGMI> elements for which the listening status applies;\niii)\tif the intention is to report that the MCPTT client is no longer listening to the MBMS subchannel in an ongoing session (e.g. as the response to Unmap Group to Bearer message), shall include the MCPTT session identity in a <session-id> element;\niv)\tif the intention is to report that the MCPTT client is no longer listening to general purpose MBMS subchannel, shall include the <general-purpose> element set to \"false\"; and\nv)\tmay include an anyExt element containing:\nA)\tan <mbms-reception-quality> element indicating the received not satisfactory quality level; andNOTE 2:\tIf the MCPTT client reports that the MCPTT client is no longer listening to the general purpose MBMS subchannel, it is implicitly understood that the MCPTT client no longer listens to any MBMS subchannel in ongoing conversations that the MCPTT client previously reported status \"listening\".\nh)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-request-uri> set to the MCPTT ID; and\n2)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nWhen the MCPTT client meets all the conditions specified in clause 14.3.3.1 for reporting a change in an MBMS bearer suspension status, the MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and\na)\tshall include in the Request-URI the MBMS public service identity of the participating MCPTT function received in the P-Asserted-Identity header field of the announcement message;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\nc)\tshould include a public user identity in the P-Preferred-Identity header field as specified in 3GPP TS 24.229 [4];\nd)\tshall include a P-Preferred-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\ne)\tshall include an application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body with the <version> element set to \"1\";\nf)\tif at least one MBMS bearer is about to be suspended, the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\ni)\tshall include an <mbms-suspension-status> element set to \"suspending\";\nii)\tshall set the <number-of-reported-bearers> element to the total number of the included <suspended-TMGI> elements and <other-TMGI> elements;\niii)\tshall include <suspended-TMGI> element(s) set to the TMGI value for each of the MTCHs on the same MCH corresponding to the MBMS bearers about to be suspended; and\niv)\tmay include <other-TMGI> elements, if available, corresponding to the TMGI values for other MTCHs on the same MCH as the MBMS bearers to be suspended;\nNOTE 3:\tTo report the suspension of MTCHs on different MCHs, the MCPTT client sends a separate message for each of the involved MCHs.\ng)\tif the MBMS bearer is no longer about to be suspended, the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body:\ni)\tshall include an <mbms-suspension-status> element set to \"not-suspending\";\nii)\tshall set the <number-of-reported-bearers> element to the number of included <suspended-TMGI> elements; and\niii)\tshall include a <suspended-TMGI> element set to the corresponding TMGI value for each of the MTCHs of the MBMS bearers that are no longer about to be suspended; and\nh)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-request-uri> set to the MCPTT ID; and\n2)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nNOTE 4:\tThe MCPTT client reports in separate messages the MBMS bearers that are about to be suspended and the MBMS bearers that are no longer about to be suspended.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14.3.4\tReceiving a MuSiK download message",
                            "text_content": "When the MCPTT client receives a SIP MESSAGE request containing:\n1)\ta P-Asserted-Service header field containing the \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\n2)\twith one of the following:\na)\tan application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body containing an <mbms-explicitMuSiK-download> element with at least one <group> subelement; or\nb)\tan application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body containing an <mbms-defaultMuSiK-download> element with zero or more <group> subelements;\nthe MCPTT client shall:\n1)\tif the received message contains an <mbms-explicitMuSiK-download> element, set the impacted groups to be those groups identified by the <group> subelements;\n2)\tif the received message contains an <mbms-defaultMuSiK-download> element without <group> subelements, set the impacted groups to be all groups not associated with currently valid explicit MuSiK downloads; and\n3)\tif the received message contains an <mbms-defaultMuSiK-download> element with <group> subelements, first dissociate those groups identified by the <group> subelements from currently valid associations with explicit MuSiK downloads and then set the impacted groups to be all groups not associated with currently valid explicit MuSiK downloads.\nIf the key identifier within the CSB-ID of the MIKEY payload is a MuSiK-ID (4 most-significant bits have the value '6'), the MCPTT client:\n1)\tshall process the MIKEY payload according to 3GPP TS 33.180 [78], as follows:\na)\tif the initiator field (IDRi) has type 'URI' (identity hiding is not used), the client:\ni)\tshall extract the initiator URI from the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the initiator URI deviates from the public service identity of the participating MCPTT function serving the MCPTT client, shall reject the SIP MESSAGE request by sending a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and including warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps; and\nii)\tshall convert the initiator URI to a UID as described in 3GPP TS 33.180 [78];\nb)\totherwise, if the initiator field (IDRi) has type 'UID' (identity hiding in use), the client:\ni)\tshall convert the public service identity of participating MCPTT function serving the MCPTT user to a UID as described in 3GPP TS 33.180 [78]; and\nii)\tshall compare the generated UID with the UID in the initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [78]. If the two initiator UIDs deviate from each other, shall reject the SIP MESSAGE request by sending a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and including warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nc)\totherwise, shall reject the SIP MESSAGE request by sending a SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and including warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps;\nd)\tshall use the UID to validate the signature of the I_MESSAGE as described in 3GPP TS 33.180 [78];\ne)\tif authentication verification of the I_MESSAGE fails or the I_MESSAGE does not contain a Status attribute, shall reject the SIP MESSAGE request by sending SIP 488 (Not Acceptable Here) response as specified in IETF RFC 4567 [47], and including warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field as specified in clause 4.4 and shall not continue with the rest of the steps; and\nf)\tshall examine the Status attribute and shall either mark the associated security functions as \"not in use\" or shall extract and store the encapsulated MuSiK and the corresponding MuSiK-ID from the payload as specified in 3GPP TS 33.180 [78]; and\n2)\tfor each of the impacted groups, shall either associate the status 'security not in use' or shall add/replace in the storage associated with the group the MuSiK-ID and the MuSiK, for use (decrypted) as security key for floor control.\nNOTE:\tIt is expected that the MCPTT client is capable of storing a different MuSiK for each MCPTT group of interest.\nThe MCPTT client shall respond with SIP 200 OK only if it finds the message syntactically correct and recognizes it as a valid and error-free MuSiK download (default or explicit) message.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "14A\tMCPTT Service Continuity",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "14A.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the procedures for service continuity of an ongoing SIP session supporting an MCPTT private call or MCPTT group call when:\n-\tthe MCPTT UE (referred to as the remote UE) is connected to the network via E-UTRAN and decides to connect to a UE-to-network relay, e.g. because it realises that it is losing connection to the network and wants to ensure seamless service; and\n-\tthe remote UE is connected to the network via the UE-to-network-relay and decides to disconnect from the UE-to-network relay, e.g. because the remote UE realises that it is losing connection to UE-to-network relay or because the LTE-Uu link quality goes above a certain threshold, and decides to connect to the network via E-UTRAN for seamless service.\nMCPTT service continuity follows the principles of 3GPP TS 24.237 [58] for PS-PS service continuity. In particular:\n1)\tthe SIP session is anchored at a Service Centralisation and Continuity Application Server (SCC AS) before and after the handover. This requires that initial filter criteria is configured to ensure that the SCC AS is in the registration path, is the first application server in the path of an originating session, and the last AS in the path of a terminating session;\n2)\tthe remote UE is an SC UE that supports PS-PS access transfer as per 3GPP TS 24.237 [58]; and\n3)\tthe remote UE is either configured with a static PS to PS STI as specified in 3GPP TS 24.216 [66] that it uses when initiating the session transfer request, or it uses a dynamic PS to PS STI which is the URI contained in the Contact header field returned at the creation of the dialog over the Source Access Leg, as specified in 3GPP TS 24.237 [58].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14A.2\tService continuity from on-network MCPTT service to UE-to-network relay MCPTT service",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14A.2.1\tRemote UE",
                            "text_content": "When performing service continuity from on-network MCPTT service to UE-to-network relay MCPTT service, the remote UE:\n1)\tshall perform ProSe UE-to-network relay discovery over PC5 as specified in clause 10A of 3GPP TS 24.334 [28];\nNOTE 1:\tDepending on the model (A or B) used for discovery as specified in 3GPP TS 24.334 [28], the remote UE can perform UE-to-network relay discovery while still in coverage (when model A is used), or while still in coverage if the LTE-Uu link quality drops below a certain threshold (when model B is used).\nNOTE 2:\tAs part of the discovery process, service authorisation is performed as specified in 3GPP TS 24.334 [28]. The UE-to-network relay is provisioned with relay service code(s) associated with allowed MCPTT group(s) as specified in 3GPP TS 24.483 [45] and 3GPP TS 24.484 [50]. To find a permitted UE-to-network relay for group communications, a remote UE is provisioned with the relay service code(s) associated with the MCPTT group(s) which the MCPTT user is part of, in the MCPTT group configuration MO as specified in 3GPP TS 24.483 [45].\n2)\tshall select a suitable UE-to-network relay by performing the UE-to-network relay selection procedure specified in clause 10A.2.12 of 3GPP TS 24.334 [28];\n3)\tshall establish a direct link to the relay as specified in clause 10.4.2 of 3GPP TS 24.334 [28];\nNOTE 3:\tAs part of this process the remote UE is assigned a /64 IPv6 Prefix by the relay.\n4)\tshall initiate IMS registration over the UE-to-network relay target access leg by following the procedures in clause 10.2.0 of 3GPP TS 24.237 [58];\nNOTE 4:\tAs part of this process the remote UE needs to discover the P-CSCF address to connect to via the UE-to-network relay. The remote UE either uses mechanism I or mechanism III of clause 9.2.1 in 3GPP TS 24.229 [4] to discover the P-CSCF address. The details of how mechanism I or mechanism III are used to discover the P-CSCF address are not covered by the present document.\n5)\tshall initiate session transfer by following the procedures specified in clause 10.2.1 of 3GPP TS 24.237 [58];\n6)\tafter successful session transfer if MCPTT content is being distributed on the target side using MBMS bearers, shall send a MBMS bearer listening status report procedure to the participating MCPTT function by performing the procedures in clause 14.3.3; and\nNOTE 5:\tUpon receiving the MBMS bearer listening status from an MCPTT client indicating that the MCPTT UE is now listening to a MBMS subchannel, the participating MCPTT function performs the procedures in clause 14.2.3 to switch to MBMS bearer.\n7)\tafter successful session transfer if the remote UE still has an connection in the source access, may perform IMS de-registration of the contact address of the IMS public user identity registered on the source access leg by following the procedures in 3GPP TS 24.229 [4];\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14A.2.2\tSCC AS",
                            "text_content": "The SCC AS follows the procedures in clause 10.3.2 of 3GPP TS 24.237 [58].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "14A.3\tService continuity from UE-to-network relay MCPTT service to on-network MCPTT service",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14A.3.1\tRemote UE",
                            "text_content": "When performing access transfer between UE-to-network relay MCPTT service and on-network MCPTT service, the remote UE:\n1)\tshall initiate IMS registration over the on-network target access leg by following the procedures in clause 10.2.0 of 3GPP TS 24.237 [58]; and\nNOTE:\tThe remote UE uses option II procedures for P-CSCF discovery as defined in clause L.2.2.1 of 3GPP TS 24.229 [4] to discover the P-CSCF address when connecting to EPC.\n2)\tfollows the procedures in steps 5), 6) and 7) of clause 14A.2.1.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14A.3.2\tSCC AS",
                            "text_content": "The SCC AS follows the procedures in clause 14A.2.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "14B\t5G MBS transmission usage procedure",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "14B.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the participating MCPTT function and the MCPTT client procedure for:\n1)\tMBS session announcement;\n2)\tUE session join notification;\n3)\tMBS session listening status; and\n4)\tMBS session de-announcement.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "14B.2\tParticipating MCPTT function MBS usage procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14B.2.1\tGeneral",
                            "text_content": "This clause describes the procedures in the participating MCPTT function for:\n1)\tsending an MBS session announcement to the MCPTT client;\n2)\treceiving a UE session join notification from the MCPTT client;\n3)\treceiving an MBS session listening status from the MCPTT client; and\n4)\treceiving an MBS session de-announcement acknowledgement from the MCPTT client.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.2.2\tSending MBS session announcement procedures",
                            "text_content": "The participating MCPTT function follows the procedure in clause 14.2.2.1 with the terminology mapping specified in clause L.3.4.\nShall generate a SIP MESSAGE request as specified in clause 14.2.2.2 with the following clarifications/exceptions.\nAll steps of clause 14.2.2.2 apply also for MBS except step 6), with the clarification that terminology mapping specified in clause L.3.4 applies.\nIn place of step 6) of clause 14.2.2.2, the following step 6) shall be used:\n6)\tshall include an application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body defined in clause F.2A with the <version> element set to \"1\" and one or more <announcement> elements associated with the pre-activated MBS sessions. Each set of an <announcement> element:\na)\tin case of the MCPTT server is able to provide the MC services to the client over 5G MBS sessions (either broadcast or multicast), shall include <mbs-session-infoType> providing the MBS session related information:\ni)\t\tshall include an MBS session ID value in the <mbs-session-id> element;\nNOTE 1:\tThe identity of the MBS session used to deliver MC service group communication data. It is either TMGI for broadcast MBS and multicast MBS sessions, or source specific IP multicast address for multicast MBS session.\nii)\t\tshall include the <mbs-session-mode> element and set it to \"multicast\" value or the \"broadcast\" value;\niii)\tshall include a MC service group ID value in the <mc-service-group-id> element;\niv)\tif the MBS sessions is carrying the general purpose MBS subchannel, shall include one <GPMS>element, giving the number of the \"m=application\" media line in the application/sdp MIME body generated in above to be used for the general purpose MBS subchannel;\nv)\tmay include one or more MBS service area IDs in <mbs-service-area-id> elements in the <mbs-service-areas> element;\nvi)\tfor multicast MBS session, may include the <report-ue-session-join-notification> element and set it to \"true\" value or the \"false\" value;\nvii)\tmay include <multicast-mbs-session-related-info>, additional information to be used by the MC service client to join the multicast MBS session such as PLMN ID of the default PLMN service provider in case of source specific IP multicast address, DNN, and SNSSAI of the PDU session associated with the multicast MBS session;\nNOTE 2:\tSuch information may be pre-configured in the MC service UE, or provided in any other implementation specific way.\nviii)\tfor broadcast MBS session, shall include an MBS Frequency Selection Area ID value in the <mbs-fsa-id> element;\nix)\tif multiple carriers are supported, shall include the frequency to be used in the <frequency> element; and\nNOTE 3:\tIn the current release if the <frequency> element is included, the frequency in the <frequency> element is the same as the frequency used for unicast.\nx)\tmay include the <mbs-session-de-announcement-acknowledgement> element and set it to \"true\" value or the \"false\" value;\nb)\tin case of LTE eMBMS and 5G MBS co-existence, shall include <eMBMS-bearer-infoType> providing the 4G eMBMS bearer related information:\ni)\tmay include a list of additional alternative TMGI which may be used in roaming scenarios in the <Alternative-TMGI> element; and\nii)\tthe remaining elements are generated as specified in step 6) of clause 14.2.2.2.\nWhen the participating MCPTT function wants to update a previously sent announcement, the participating MCPTT function sends an MBS session announcement in a SIP MESSAGE request as specified in clause 14B.2.2.2 where the participating MCPTT function in the <announcement> element to be updated:\n1)\t<mbs-session-infoType> to be updated as specified in clause 14.2.2.3 with the terminology mapping specified in clause L.3.4; and\n2)\t<eMBMS-bearer-infoType> to be updated as specified in clause 14.2.2.3.\nWhen the participating MCPTT function wants to cancel an MBS session announcement associated with an <announcement> element, the participating MCPTT function sends an MBS session announcement as specified in clause 14B.2.2.2 where the participating MCPTT function in the <announcement> element to be cancelled:\n1)\t<mbs-session-infoType> to be cancelled as specified in clause 14.2.2.4 with the terminology mapping specified in clause L.3.4; and\n2)\t<eMBMS-bearer-infoType> to be cancelled as specified in clause 14.2.2.4.\nThe participating MCPTT function follows the procedure in clause 14.2.2.5 with the terminology mapping specified in clause L.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.2.3\tReceiving an MBS session listening status or MBS session de-announcement acknowledgement from an MCPTT client",
                            "text_content": "If the SIP MESSAGE request contains:\n1)\tan application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body with an <mbs-listening-status> element; and\n2)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an MCPTT ID in the <mcptt-request-uri> served by the participating MCPTT function;\nthen the participating MCPTT function follows the procedure \"MBMS bearer listening status\" in clause 14.2.3 with the terminology mapping specified in clause L.3.4.\nIf the SIP MESSAGE request contains:\n1)\tan application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body with an <mbs-session-de-announcement-status> element; and\n2)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an MCPTT ID in the <mcptt-request-uri> served by the participating MCPTT function;\nthen the participating MCPTT function:\n1)\tshall verify that the public user identity in the P-Asserted-Identity header field is bound to the MCPTT ID in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, and if that is the case:\na)\tif the <mbs-session-de-announcement-status> element is set to \"deleting\":\ni)\tshall consider that the MBS session identified by the <de-announcement-mbs-session-id> element is about to be deleted and that the reduction or elimination of traffic on that MBS session and/or on some of the MBS sessions indicated in the <other-mbs-session-id> elements can potentially avoid the deletion; and\nii)\tmay take implementation/configuration specific immediate action for the MCPTT client that reports the deletion as well as other MCPTT clients that listen to the same MBS session(e.g. moving traffic to unicast delivery), reducing transmission rate, eliminating traffic, modifying pre-emption priority); or\nb)\tif the <mbs-session-de-announcement-status> element is set to \"not-deleting\":\ni)\tshall consider that the MBS session identified by the <de-announcement-mbs-session-id> element is no longer about to be deleted; and\nii)\tmay take implementation/configuration specific immediate action for the MCPTT client that reports the deletion as well as other MCPTT clients that listen to the same MBS session(e.g. restoring traffic previously reduced or eliminated from MBS session upon reception of deletion information).\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.2.4\tAbnormal cases",
                            "text_content": "Upon receipt of a SIP MESSAGE request with an application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body, then the participating MCPTT function follows the procedure in clause 14.2.4 with the terminology mapping specified in clause L.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.2.5\tReceiving a UE session join notification from an MCPTT client",
                            "text_content": "Upon receiving a \"SIP MESSAGE request for a UE session join notification\", the participating MCPTT function shall handle the request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33].\nIf the SIP MESSAGE request contains:\n1)\tan application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body with an <mbs-multicast-joining-status> element; and\n2)\tan application/vnd.3gpp.mcptt-info+xml MIME body containing an MCPTT ID in the <mcptt-request-uri> served by the participating MCPTT function;\nthen the participating MCPTT function:\n1)\tshall verify that the public user identity in the P-Asserted-Identity header field is bound to the MCPTT ID in the <mcptt-request-uri> element in the application/vnd.3gpp.mcptt-info+xml MIME body, and if that is the case:\na)\tif the <mbs-multicast-joining-status> element is set to \"ue-session-join\":\ni)\tif a <session-id> element is included, shall indicate to the media plane that the MCPTT client in the session identified by the <session-id> element wants to receive multicast data identified by a specific MBS session ID; and\nb)\tif the <mbs-multicast-joining-status> element is set to \"ue-session-leave\":\ni)\tif a <session-id> element is included, shall indicate to the media plane that the MCPTT client in the sessions identified by the <session-id> elements no longer wants to receive multicast data identified by a specific MBS session ID;\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "14B.3\tMCPTT client MBS usage procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "14B.3.1\tGeneral",
                            "text_content": "This clause describes the procedures in the MCPTT client for:\n1)\treceiving an MBS session announcement from the participating MCPTT function;\n2)\tsending a UE session join notification to the participating MCPTT function;\n3)\tsending an MBS session listening status report to the participating MCPTT function; and\n4)    sending an MBS session de-announcement acknowledgement to the participating MCPTT function.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.3.2\tReceiving an MBS session announcement",
                            "text_content": "The participating MCPTT client follows the procedure in clause 14.3.2 with the terminology mapping specified in clause L.3.4.\nWhen the MCPTT client for each <announcement> element in the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body:\n1) if the <mbs-service-areas> element is present:\na)\tif an <announcement> element with the same value of the <mbs-session-id> element is already stored:\ni)\tshall replace the old <announcement> element with the <announcement> element received in the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body;\nb)\tif there is no <announcement> element with the same value of the <mbs-session-id> element stored:\ni)\tshall store the received <announcement> element;\nc)\tthe remaining parts in step 1) of clause 14.3.2 applies also for MBS, with the clarification that terminology mapping specified in clause L.3.4 applies.\n2)  if no <mbs-service-areas> element is present:\na)\tshall discard a previously stored <announcement> element identified by the value of the <mbs-session-id>; and\nb)\tthe remaining parts in step 2) of clause 14.3.2 applies also for MBS, with the clarification that terminology mapping specified in clause L.3.4 applies;\n3)  for 5G MBS and 4G MBMS co-existence, the <eMBMS-bearer-infoType> is performed as specified in clause 14.3.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.3.3\tThe MBS session listening status and de-announcement acknowledgement procedures",
                            "text_content": "If one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives a Map Group To Session Stream message over the general purpose MBS channel;\nb)\tparticipates in a group session identified by the Map Group To Session Stream message; and\nc)\tthe status \"listening\" is not already reported; or\n2)\tif the MCPTT client:\na)\treceives an announcement as described in clause 14B.3.2;\nb)\tfor multicast MBS session, sends a UE session join notification as described in clause 14B.3.5;\nc)\tenters an MBS service area where a specific MBS session stream is available; and\nd)\texperiences good MBS session radio condition;\nthen the MCPTT client shall report that the MCPTT client is listening to the MBS session as specified in clause 14B.3.3.2.\nIf one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives an MBS session announcement as described in the clause 14B.3.2;\nb)\tthe MBS session announcement contains a cancellation of an <announcement> element identified by the same MBS session ID value as received in a Map Group To Session Stream message in an ongoing conversation; and\nc)\tthe status \"not-listening\" is not already reported;\n2)\tif the MCPTT client:\na)\treceives an MBS session announcement as described in the clause 14B.3.2;\nb)\tthe MBS session announcement contains a cancellation of an <announcement> element;\nc)\tdoes not participate in an ongoing conversation;\nd)\tthe MCPTT client has reported the \"listening\" status due to the availability of the general purpose MBS subchannel in the <announcement> element; and\ne)\tthe status \"not-listening\" is not already reported; or\n3)\tif the MCPTT client:\na)\tsuffers from bad MBS session radio condition,\nthen the MCPTT client shall report that the MCPTT client is not listening to the MBS session stream as specified in clause 14B.3.3.2.\nIf all the following conditions are fulfilled:\n1)\tthe MCPTT client has reported \"listening\" as the most recent listening status relative to an MBS session; and\n2)\tthe MCPTT client has not received a MBS session announcement containing a <mbs-session-de-announcement-acknowledgement> element set to \"false\",\nthen the MCPTT client shall report that the MBS session is about to be deleted, as specified in clause 14B.3.3.2.\nIf all the following conditions are fulfilled:\n1)\tthe MCPTT client has reported \"listening\" as the most recent listening status relative to an MBS session;\n2)\tthe MCPTT client has reported that the MBS session is about to be deleted, but the deletion of the MBS session has not been detected yet by the MCPTT client; and\n3)\tthe MCPTT client has not received a MBS session announcement containing a <mbs-session-de-announcement-acknowledgement> element set to \"false\",\nthen the MCPTT client shall report that the MBS session is no longer to be deleted, as specified in clause 14B.3.3.2.\nWhen the MCPTT client wants to report the MBS session listening status, the MCPTT client shall generate a SIP MESSAGE request as specified \"MBMS bearer listening status\" in clause 14.3.3.2 with the terminology mapping specified in clause L.3.4 applise;\nWhen the MCPTT client meets all the conditions specified in clause 14B.3.3.1 for reporting a change in an MBS session de-announcement status, the MCPTT client shall generate a SIP MESSAGE request as specified \"MBMS bearer suspension status\" in clause 14.3.3.2 with the terminology mapping specified in clause L.3.4 applise with the following clarifications/exceptions:\n1)\tin step f) of clause 14.2.2.2 1) with the exception that if at least one MBS session is about to be deleted, the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body:\ni)\tshall include an <mbs-session-de-announcement-status> element set to \"deleting\";\nii)\tshall set the <number-of-reported-sessions> element to the total number of the included <deleted-mbs-session-id> elements and <other-mbs-session-id> elements;\niii)\tshall include <deleted-mbs-session-id> element(s) set to the MBS session ID value for each of the MBS sessions about to be deleted; and\niv)\tmay include <other-mbs-session-id> elements, if available, corresponding to the MBS session ID values for other MBS sessions to be deleted;\n2)\tin step g) of clause 14.2.2.2 1) with the exception that if the MBS session is no longer about to be deleted, the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body:\ni)\tshall include an <mbs-session-de-announcement-status> element set to \"not-deleting\";\nii)\tshall set the <number-of-reported-sessions> element to the number of included <deleted-mbs-session-id> elements; and\niii)\tshall include a <deleted-mbs-session-id> element set to the corresponding MBS session ID value for each of the MBS sessions that are no longer about to be deleted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.3.4\tReceiving a MuSiK download message",
                            "text_content": "The MCPTT client follows the procedure in clause 14.3.4 with the terminology mapping specified in clause L.3.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "14B.3.5\tThe UE session join notification",
                            "text_content": "For multicast MBS sessions, if one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives a Map Group To Session Stream message over the general purpose MBS channel;\nb)\tparticipates in a group session identified by the Map Group To Session Stream message; and\nc)\tthe status \"ue-session-join\" is not already reported; or\n2)\tif the MCPTT client:\na)\treceives an announcement as described in clause 14B.3.2;\nb)\tenters an MBS service area where a specific MBS session stream is available; and\nc)\texperiences good MBS session radio condition;\nthen the MCPTT client shall report that the MCPTT client indicates to MCPTT server that such MCPTT client wants to receive multicast data identified by a specific MBS session ID, as specified in clause 14B.3.5.2.\nFor multicast MBS sessions, if one of the following conditions is fulfilled:\n1)\tif the MCPTT client:\na)\treceives an MBS session announcement as described in the clause 14B.3.2;\nb)\tthe MBS session announcement contains a cancellation of an <announcement> element identified by the same MBS session ID value as received in a Map Group To Session Stream message in an ongoing conversation; and\nc)\tthe status \"ue-session-leave\" is not already reported;\n2)\tif the MCPTT client:\na)\treceives an MBS session announcement as described in the clause 14B.3.2;\nb)\tthe MBS session announcement contains a cancellation of an <announcement> element;\nc)\tdoes not participate in an ongoing conversation;\nd)\tthe MCPTT client has reported the \"ue-session-join\" status due to the availability of the general purpose MBS subchannel in the <announcement> element; and\ne)\tthe status \"ue-session-leave\" is not already reported; or\n3)\tif the MCPTT client:\na)\tsuffers from bad MBS session radio condition,\nthen the MCPTT client shall report that the MCPTT client no longer wants to receive multicast data identified by a specific MBS session ID, as specified in clause 14B.3.3.2.\nWhen the MCPTT client wants to send the UE session join notification, the MCPTT client:\n1)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and\na)\tshall include in the Request-URI the MBS public service identity of the participating MCPTT function received in the P-Asserted-Identity header field of the announcement message;\nb)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media-feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\nc)\tshould include a public user identity in the P-Preferred-Identity header field as specified in 3GPP TS 24.229 [4];\nd)\tshall include a P-Preferred-Service header field with the value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\ne)\tshall include an application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body with the <version> element set to \"1\";\nf)\tif the MCPTT client is successfully joining a certain multicast MBS session procedure, the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body:\ni)\tshall include an <mbs-multicast-joining-status> element set to \"ue-session-join\";\nii)\tif the intention is to report that the MCPTT client is joining a certain multicast MBS session procedure, shall include the MCPTT session identity of the ongoing conversation in a <session-id> element; and\niii)\tshall include one or more <mbs-session-id> elements for which the listening status applies;\ng)\tif the MCPTT client is not joining a certain multicast MBS session procedure, the application/vnd.3gpp.mcptt-mbs-usage-info+xml MIME body:\ni)\tshall include an <mbs-multicast-joining-status> element set to \"ue-session-leave\";\nii)\tif the intention is to report that the MCPTT client is not joining a certain multicast MBS session procedure, shall include the MCPTT session identity in a <session-id> element; and\niii)\tshall include one or more <mbs-session-id> elements for which the listening status applies;\nh)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcptt-request-uri> set to the MCPTT ID; and\n2)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "15\tOff-network message formats",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "15.1\tMONP message functional definitions and contents",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "15.1.1\tGeneral",
                            "text_content": "The following clauses describe the MONP message functional definitions and contents. Each message consist of a series of information elements. Annex I describes the standard format of a MONP message and the encoding rules for each type of information element.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "15.1.2\tGROUP CALL PROBE message",
                            "text_content": "This message is sent by the UE to other UEs to check for an ongoing group call. For contents of the message see Table 15.1.2.1-1.\nMessage type:\tGROUP CALL PROBE\nDirection:\tUE to other UEs\nTable 15.1.2.1-1: GROUP CALL PROBE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.2.1-1: GROUP CALL PROBE message content",
                                    "table number": 8,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.3\tGROUP CALL ANNOUNCEMENT message",
                            "text_content": "This message is sent by the UE to other UEs to announce an ongoing group call to other UEs. For contents of the message see Table 15.1.3.1-1.\nMessage type:\tGROUP CALL ANNOUNCEMENT\nDirection:\tUE to other UEs\nTable 15.1.3.1-1: GROUP CALL ANNOUNCEMENT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.3.1-1: GROUP CALL ANNOUNCEMENT message content",
                                    "table number": 9,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.4\tGROUP CALL ACCEPT message",
                            "text_content": "This message is sent by the UE to other UEs to indicate acceptance of a group call. For contents of the message see Table 15.1.4.1-1.\nMessage type:\tGROUP CALL ACCEPT\nDirection:\tUE to other UEs\nTable 15.1.4.1-1: GROUP CALL ACCEPT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.4.1-1: GROUP CALL ACCEPT message content",
                                    "table number": 10,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.5\tPRIVATE CALL SETUP REQUEST message",
                            "text_content": "This message is sent by a UE to another UE to request setup of a private call. For contents of the message see Table 15.1.5.1-1.\nMessage type:\tPRIVATE CALL SETUP REQUEST\nDirection:\tUE to another UE\nTable 15.1.5.1-1: PRIVATE CALL SETUP REQUEST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.5.1-1: PRIVATE CALL SETUP REQUEST message content",
                                    "table number": 11,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.6\tPRIVATE CALL RINGING message",
                            "text_content": "This message is automatically sent by a UE to another UE in response to a PRIVATE CALL SETUP REQUEST message. This message indicates that the UE has presented the incoming call notification to the user and is awaiting user response. For contents of the message see Table 15.1.6.1-1.\nMessage type:\tPRIVATE CALL RINGING\nDirection:\tUE to another UE\nTable 15.1.6.1-1: PRIVATE CALL RINGING message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.6.1-1: PRIVATE CALL RINGING message content",
                                    "table number": 12,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.7\tPRIVATE CALL ACCEPT message",
                            "text_content": "This message is sent by a UE to another UE in response to a PRIVATE CALL SETUP REQUEST message when user accepts the call. This message indicates that the UE accepts the call setup request. For contents of the message see Table 15.1.7.1-1.\nMessage type:\tPRIVATE CALL ACCEPT\nDirection:\tUE to another UE\nTable 15.1.7.1-1: PRIVATE CALL ACCEPT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.7.1-1: PRIVATE CALL ACCEPT message content",
                                    "table number": 13,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.8\tPRIVATE CALL REJECT message",
                            "text_content": "This message is sent by a UE to another UE in response to a PRIVATE CALL SETUP REQUEST message when user rejects the call. This message indicates that the UE rejects the call setup request. For contents of the message see Table 15.1.8.1-1.\nMessage type:\tPRIVATE CALL REJECT\nDirection:\tUE to another UE\nTable 15.1.8.1-1: PRIVATE CALL REJECT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.8.1-1: PRIVATE CALL REJECT message content",
                                    "table number": 14,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.9\tPRIVATE CALL RELEASE message",
                            "text_content": "This message is sent by a UE to another UE to terminate an ongoing private call. For contents of the message see Table 15.1.9.1-1.\nMessage type:\tPRIVATE CALL RELEASE\nDirection:\tUE to another UE\nTable 15.1.9.1-1: PRIVATE CALL RELEASE message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.9.1-1: PRIVATE CALL RELEASE message content",
                                    "table number": 15,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.10\tPRIVATE CALL RELEASE ACK message",
                            "text_content": "This message is sent by a UE to another UE in response to a PRIVATE CALL RELEASE message. This message indicates that the UE has terminated the call. For contents of the message see Table 15.1.10.1-1.\nMessage type:\tPRIVATE CALL RELEASE ACK\nDirection:\tUE to another UE\nTable 15.1.10.1-1: PRIVATE CALL RELEASE ACK message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.10.1-1: PRIVATE CALL RELEASE ACK message content",
                                    "table number": 16,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.11\tPRIVATE CALL ACCEPT ACK message",
                            "text_content": "This message is sent by a UE to another UE in response to a PRIVATE CALL ACCEPT message. This message acknowledges the receipt of PRIVATE CALL ACCEPT message. For contents of the message see Table 15.1.11.1-1.\nMessage type:\tPRIVATE CALL ACCEPT ACK\nDirection:\tUE to another UE\nTable 15.1.11.1-1: PRIVATE CALL ACCEPT ACK message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.11.1-1: PRIVATE CALL ACCEPT ACK message content",
                                    "table number": 17,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.12\tPRIVATE CALL EMERGENCY CANCEL message",
                            "text_content": "This message is sent by a UE to another UE to indicate termination of emergency mode in private call. For contents of the message see Table 15.1.12.1-1.\nMessage type:\tPRIVATE CALL EMERGENCY CANCEL\nDirection:\tUE to another UE\nTable 15.1.12.1-1: PRIVATE CALL EMERGENCY CANCEL message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.12.1-1: PRIVATE CALL EMERGENCY CANCEL message content",
                                    "table number": 18,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.13\tPRIVATE CALL EMERGENCY CANCEL ACK message",
                            "text_content": "This message is sent by a UE to another UE to indicate receipt of PRIVATE CALL EMERGENCY CANCEL message. For contents of the message see Table 15.1.13.1-1.\nMessage type:\tPRIVATE CALL EMERGENCY CANCEL ACK\nDirection:\tUE to another UE\nTable 15.1.13.1-1: PRIVATE CALL EMERGENCY CANCEL ACK message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.13.1-1: PRIVATE CALL EMERGENCY CANCEL ACK message content",
                                    "table number": 19,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.14\tGROUP CALL IMMINENT PERIL END message",
                            "text_content": "This message is sent by the UE to other UEs to indicate termination of imminent peril mode in the group call. For contents of the message see Table 15.1.14.1-1.\nMessage type:\tGROUP CALL IMMINENT PERIL END\nDirection:\tUE to other UEs\nTable 15.1.14.1-1: GROUP CALL IMMINENT PERIL END message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.14.1-1: GROUP CALL IMMINENT PERIL END message content",
                                    "table number": 20,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.15\tGROUP CALL EMERGENCY END message",
                            "text_content": "This message is sent by the UE to other UEs to indicate termination of emergency mode in the group call. For contents of the message see Table 15.1.15.1-1.\nMessage type:\tGROUP CALL EMERGENCY END\nDirection:\tUE to other UEs\nTable 15.1.15.1-1: GROUP CALL EMERGENCY END message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.15.1-1: GROUP CALL EMERGENCY END message content",
                                    "table number": 21,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.16\tGROUP EMERGENCY ALERT message",
                            "text_content": "This message is sent by the UE to other UEs to indicate an emergency situation. For contents of the message see Table 15.1.16.1-1.\nMessage type:\tGROUP EMERGENCY ALERT\nDirection:\tUE to other UEs\nTable 15.1.16.1-1: GROUP EMERGENCY ALERT message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.16.1-1: GROUP EMERGENCY ALERT message content",
                                    "table number": 22,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.17\tGROUP EMERGENCY ALERT ACK message",
                            "text_content": "This message is sent by the UE to other UEs to indicate receipt of emergency alert. For contents of the message see Table 15.1.17.1-1.\nMessage type:\tGROUP EMERGENCY ALERT ACK\nDirection:\tUE to other UEs\nTable 15.1.17.1-1: GROUP EMERGENCY ALERT ACK message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.17.1-1: GROUP EMERGENCY ALERT ACK message content",
                                    "table number": 23,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.18\tGROUP EMERGENCY ALERT CANCEL message",
                            "text_content": "This message is sent by the UE to other UEs to indicate end of emergency situation. For contents of the message see Table 15.1.18.1-1.\nMessage type:\tGROUP EMERGENCY ALERT CANCEL\nDirection:\tUE to other UEs\nTable 15.1.18.1-1: GROUP EMERGENCY ALERT CANCEL message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.18.1-1: GROUP EMERGENCY ALERT CANCEL message content",
                                    "table number": 24,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.19\tGROUP EMERGENCY ALERT CANCEL ACK message",
                            "text_content": "This message is sent by the UE to other UEs to indicate receipt of emergency alert cancel. For contents of the message see Table 15.1.19.1-1.\nMessage type:\tGROUP EMERGENCY ALERT CANCEL ACK\nDirection:\tUE to other UEs\nTable 15.1.19.1-1: GROUP EMERGENCY ALERT CANCEL ACK message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.19.1-1: GROUP EMERGENCY ALERT CANCEL ACK message content",
                                    "table number": 25,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.20\tGROUP CALL BROADCAST message",
                            "text_content": "This message is sent by the UE to other UEs to announce a broadcast group call to other UEs. For contents of the message see Table 15.1.20.1-1.\nMessage type:\tGROUP CALL BROADCAST\nDirection:\tUE to other UEs\nTable 15.1.20.1-1: GROUP CALL BROADCAST message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.20.1-1: GROUP CALL BROADCAST message content",
                                    "table number": 26,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.21\tGROUP CALL BROADCAST END message",
                            "text_content": "This message is sent by the UE to other UEs to indicate termination of a broadcast group call. For contents of the message see Table 15.1.21.1-1.\nMessage type:\tGROUP CALL BROADCAST END\nDirection:\tUE to other UEs\nTable 15.1.21.1-1: GROUP CALL BROADCAST END message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.21.1-1: GROUP CALL BROADCAST END message content",
                                    "table number": 27,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.22\tMCVIDEO MESSAGE CARRIER message",
                            "text_content": "This message is used to carry an MCVIDEO message.\nFor contents of the message see Table 15.1.22.1-1.\nMessage type:\tMCVIDEO MESSAGE CARRIER\nDirection:\tUE to other UEs\nTable 15.1.22.1-1: MCVIDEO MESSAGE CARRIER message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.22.1-1: MCVIDEO MESSAGE CARRIER message content",
                                    "table number": 28,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.1.23\tMCDATA MESSAGE CARRIER message",
                            "text_content": "This message is used to carry an MCDATA message.\nFor contents of the message see Table 15.1.23.1-1.\nMessage type:\tMCDATA MESSAGE CARRIER\nDirection:\tUE to other UEs\nTable 15.1.23.1-1: MCDATA MESSAGE CARRIER message content\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.1.23.1-1: MCDATA MESSAGE CARRIER message content",
                                    "table number": 29,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "15.2\tGeneral message format and information elements coding",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "15.2.1\tGeneral",
                            "text_content": "The least significant bit of a field is represented by the lowest numbered bit of the highest numbered octet of the field. When the field extends over more than one octet, the order of bit values progressively decreases as the octet number increases.\nFigure 15.2.1-1 shows an example of a field where the most significant bit of the field is marked MSB and the least significant bit of the field is marked LSB.\nFigure 15.2.1-1: Example of bit ordering of a field\nWithin the protocols defined in the present document, the message consists of the following parts:\na)\tmessage type information element; and\nb)\tother information elements, as required.\nThe organization of a message is illustrated in the example shown in Figure 15.2.1-2.\nFigure 15.2.1-2: General message organization example\nUnless specified otherwise in the message descriptions of clause 15.1, a particular information element shall not be present more than once in a given message.\nThe sending entity shall set value of a spare bit to zero. The receiving entity shall ignore value of a spare bit\nThe sending entity shall not set a value of an information element to a reserved value. The receiving entity shall discard message containing an information element set to a reserved value.\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Figure 15.2.1-1 shows an example of a field where the most significant bit of the field is marked MSB and the least significant bit of the field is marked LSB.",
                                    "table number": 30,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "The organization of a message is illustrated in the example shown in Figure 15.2.1-2.",
                                    "table number": 31,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.2\tMessage type",
                            "text_content": "The purpose of the Message type information element is to identify the type of the message.\nThe value part of the Message type information element is coded as shown in Table 15.2.2-1.\nThe Message type information element is a type 3 information element with a length of 1 octet.\nTable 15.2.2-1: Message types\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.2.2-1: Message types",
                                    "table number": 32,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.3\tCall identifier",
                            "text_content": "The purpose of the Call identifier information element is to uniquely identify the call.\nThe Call identifier information element is coded as shown in Figure 15.2.3-1 and Table 15.2.3-1.\nThe Call identifier information element is a type 3 information element with a length of 2 octets.\n\n\nFigure 15.2.3-1: Call identifier information element\nTable 15.2.3-1: Call identifier information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 33,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.3-1: Call identifier information element",
                                    "table number": 34,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.4\tRefresh interval",
                            "text_content": "The refresh interval information identifier is used to indicate the minimum time period between successive periodic messages;\nThe Refresh interval information element is coded as shown in Figure 15.2.4-1 and Table 15.2.4-1.\nThe Refresh interval information element is a type 3 information element with a length of 2 octets.\nFigure 15.2.4-1: Refresh interval\nTable 15.2.4-1: Refresh interval information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Refresh interval information element is a type 3 information element with a length of 2 octets.",
                                    "table number": 35,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.4-1: Refresh interval information element",
                                    "table number": 36,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.5\tMCPTT group ID",
                            "text_content": "The MCPTT group ID information element is used to indicate the destination MCPTT group identifier;\nThe MCPTT group ID information element is coded as shown in Figure 15.2.5-1 and Table 15.2.5-1.\nThe MCPTT group ID information element is a type 6 information element.\n\nFigure 15.2.5-1: MCPTT group ID information element\nTable 15.2.5-1: MCPTT group ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 37,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.5-1: MCPTT group ID information element",
                                    "table number": 38,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.6\tSDP",
                            "text_content": "The purpose of the SDP information element is to contain SDP message.\nThe SDP information element is coded as shown in Figure 15.2.6-1 and Table 15.2.6-1.\nThe SDP information element is a type 6 information element.\n\n\nFigure 15.2.6-1: SDP information element\nTable 15.2.6-1: SDP information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "",
                                    "table number": 39,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.6-1: SDP information element",
                                    "table number": 40,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.7\tCommencement mode",
                            "text_content": "The purpose of the Commencement mode information element is to identify the type of the commencement mode of the private call.\nThe value part of the Commencement mode information element is coded as shown in Table 15.2.7-1.\nThe Commence mode information element is a type 3 information element with a length of 1 octet.\nTable 15.2.7-1: Commencement mode\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.2.7-1: Commencement mode",
                                    "table number": 41,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.8\tReason",
                            "text_content": "The purpose of the Reason information element is to indicate the reason of the reject.\nThe Reason information element is coded as shown in table 15.2.8-1.\nThe Reason information element is a type 3 information element.\nTable 15.2.8-1: Reason type\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.2.8-1: Reason type",
                                    "table number": 42,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.9\tConfirm mode indication",
                            "text_content": "The purpose of the Confirm mode indication information element is to indicate that the terminating MCPTT client is expected to confirm call acceptance.\nThe Confirm mode indication information element is coded as shown in figure 15.2.9-1.\nThe Confirm mode indication information element is a type 2 information element.\n\nFigure 15.2.9-1: Confirm mode indication information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Confirm mode indication information element is a type 2 information element.",
                                    "table number": 43,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.10\tMCPTT user ID",
                            "text_content": "The MCPTT user ID information element is used to indicate an MCPTT user ID.\nThe MCPTT user ID information element is coded as shown in Figure 15.2.10-1 and Table 15.2.10-1.\nThe MCPTT user ID information element is a type 6 information element.\nFigure 15.2.10-1: MCPTT user ID information element\nTable 15.2.10-1: MCPTT user ID information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The MCPTT user ID information element is a type 6 information element.",
                                    "table number": 44,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.10-1: MCPTT user ID information element",
                                    "table number": 45,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.11\tCall type",
                            "text_content": "The purpose of the Call type information element is to identify the type of the call.\nThe value part of the Call type information element is coded as shown in Table 15.2.11-1.\nThe Call type information element is a type 3 information element with a length of 1 octet.\nTable 15.2.11-1: Call type\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table 15.2.11-1: Call type",
                                    "table number": 46,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.12\tUser location",
                            "text_content": "The User location information element is used to indicate the current location of the MCPTT client;\nThe User location information element is coded as shown in Figure 15.2.12-1 and Table 15.2.12-1.\nThe User location information element is a type 6 information element.\nFigure 15.2.12-1: User location information element\nTable 15.2.12-1: User location information element\n\nThe User location information element contains the LocationInfo structure defined in clause 7.4 of 3GPP TS 29.199-9 [59].\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The User location information element is a type 6 information element.",
                                    "table number": 47,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.12-1: User location information element",
                                    "table number": 48,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.13\tOrganization name",
                            "text_content": "The Organization name information element is used to indicate the name of the organization to which the user belongs.\nThe Organization name information element is coded as shown in Figure 15.2.13-1 and Table 15.2.13-1.\nThe Organization name information element is a type 6 information element.\nFigure 15.2.13-1: Organization name information element\nTable 15.2.13-1: Organization name information element\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Organization name information element is a type 6 information element.",
                                    "table number": 49,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.13-1: Organization name information element",
                                    "table number": 50,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.14\tCall start time",
                            "text_content": "The Call start time information element is used to indicate the UTC time when a call was started.\nThe Call start time information element is coded as shown in Figure 15.2.14-1 and Table 15.2.14-1.\nThe Call start time information element is a type 3 information element with a length of 5 octets.\nFigure 15.2.14-1: Call start time value\nTable 15.2.14-1: Call start time value\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Call start time information element is a type 3 information element with a length of 5 octets.",
                                    "table number": 51,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.14-1: Call start time value",
                                    "table number": 52,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.15\tLast call type change time",
                            "text_content": "The Last call type change time information identifier is used to indicate the last UTC time when a call priority was changed.\nThe Last call type change time information element is coded as shown in Figure 15.2.15-1 and Table 15.2.15-1.\nThe Last call type change time information element is a type 3 information element with a length of 5 octets.\nFigure 15.2.15-1: Last call type change time value\nTable 15.2.15-1: Last call type change time value\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The Last call type change time information element is a type 3 information element with a length of 5 octets.",
                                    "table number": 53,
                                    "summary": "",
                                    "name": ""
                                },
                                {
                                    "description": "Table 15.2.15-1: Last call type change time value",
                                    "table number": 54,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "15.2.16\tProbe response",
                            "text_content": "The purpose of the probe response information element is to indicate that the GROUP CALL ANNOUNCEMENT message was sent in response of a GROUP CALL PROBE message.\nThe probe response information element is coded as shown in figure 15.2.16-1.\nThe probe response is a type 2 information element.\n\nFigure 15.2.16-1: Probe response information element\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "The probe response is a type 2 information element.",
                                    "table number": 55,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "16\tRegroup using a preconfigured group",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "16.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "In the procedures in this clause:\n1)\ttemporary group identity in an incoming SIP MESSAGE request refers to the temporary group identity from the <mcptt-regroup-uri> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request; and\n2)\tpreconfigured group identity in an incoming SIP MESSAGE request refers to the the group identity from the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request.\nRegroup using a preconfigured group refers to the creation of a user/group regroup based on the configuration information associated with an existing group that is referred to as the preconfigured group. A regroup takes its entire configuration from the preconfigured group, including security keys. If the preconfigured group document contains a <list-service> element that contains a <preconfigured-group-use-only> element, that <preconfigured-group-use-only> element is not included in the configuration of the regroup.\nAll MCPTT servers and all MCPTT clients are configured with the preconfigured group to allow immediate use of the regroup for a call upon creation of the regroup.\nA regroup using a preconfigured group is initiated by the MCPTT client referencing a preconfigured group document in the GMS. The advantage of regroup using a preconfigured group is speed of setup of the group, especially when large numbers of users (e.g., thousands) are involved. Control of the regroup using a preconfigured group is focused in the controlling MCPTT function. Creation and removal of a regoup is normally initiated by an MCPTT client. Removal can also be initiated by the controlling MCPTT function.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "16.2\tGroup regroup using a preconfigured group",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.2.1\tClient procedures",
                            "text_content": "Upon receiving a request from an MCPTT user to establish an MCPTT group regroup using a preconfigured group, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\n1)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n2)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n3)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n4)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n6)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nb)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\nc)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value;\n7)\tshall contain an application/vnd.3gpp.mcptt-regroup+xml MIME body with:\na)\tthe <regroup-action> element set to the value \"create\";\nb)\tthe <mcptt-regroup-uri> element set to a unique temporary group identity URI;\nNOTE:\tHow the unique temporary group identity URI is formed is an implementation decision.\nc)\tthe <preconfigured-group> element set to the group identity of the preconfigured group; and\nd)\tthe <groups-for-regroup> element set to the list of MCPTT group identities of groups that are to be included in the regroup; and\n8)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client:\n1)\tshould notify the MCPTT user of the successful creation of the group regroup using preconfigured group.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tshould notify the MCPTT user of the failure to create the group regroup using preconfigured group.\nUpon receiving a request from an MCPTT user to remove a user or group regroup using a preconfigured group, the MCPTT client:\n1)\tif the MCPTT client can determine that the in-progress emergency state of the regroup is set to a value of \"true\":\na)\tshould notify the user, and shall not proceed with the remaining steps;\nNOTE:\tThe MCPTT user can, if authorised, cancel the emergency state of the regroup and then reattempt to remove the regroup, if so desired.\n2)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\n3)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n4)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n5)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n6)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n7)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n8)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\nb)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\n9)\tshall contain an application/vnd.3gpp.mcptt-regroup+xml MIME body with:\na)\tthe <mcptt-regroup-uri> element set to the unique temporary group identity URI representing the regroup to be removed; and\nb)\tthe <regroup-action> element set to \"remove\"; and\n10)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client:\n1)\tshould notify the MCPTT user of the successful removal of the regroup using preconfigured group.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tshould notify the MCPTT user of the failure to remove the regroup using preconfigured group.\nUpon receiving a \"SIP MESSAGE request to the MCPTT client to request creation of a regroup using preconfigured group\", the MCPTT client:\n1)\tshould notify the MCPTT user of the creation of the regroup using preconfigured group;\n2)\tshall send a 200 (OK) response to the MCPTT server according to 3GPP TS 24.229 [4];\n3)\tin the application/vnd.3gpp.mcptt-regroup+xml MIME body contained in the incoming SIP MESSAGE request:\na)\tshall store the value of the <mcptt-regroup-uri> element as the temporary group identity and associate that with the group identity received in the <mcptt-regroup-uri> element;\nb)\tif a <users-for-regroup> element is included in that MIME body, should store the contents of the <users-for-regroup> element as the list of users that are part of that regroup and shall consider the regroup as a user regroup; and\nNOTE 1:\tThe MCPTT client can choose to display the list of users in the user regroup to the MCPTT user.\nc)\tif a <groups-for-regroup> element is included in that MIME body, should store the contents of the <groups-for-regroup> element as the list of groups that are part of that regroup and shall consider the regroup as a group regroup;\nNOTE 2:\tThe MCPTT client can choose to display the list of groups in the group regroup to the MCPTT user.\n4)\tshall consider that the MCPTT Client is affiliated with the regroup;\n5)\tshould not initiate calls targeting any of the constituent groups but instead target the regroup for the duration of a group regroup; and\n6)\tif the regroup is a chat group, the MCPTT client should join the regroup when this notification of creation is received.\nUpon receiving a \"SIP MESSAGE request to the MCPTT client to request removal of a regroup using preconfigured group\", the MCPTT client:\n1)\tshould notify the MCPTT user of the removal of the regroup using preconfigured group;\n2)\tshall send a 200 (OK) response to the MCPTT server according to 3GPP TS 24.229 [4]; and\n3)\tshall consider that the MCPTT client is de-affiliated from the regroup.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.2\tParticipating MCPTT function procedures",
                            "text_content": "In the procedures in this clause:\n1)\ttemporary group identity in an incoming SIP MESSAGE request refers to the temporary group identity from the <mcptt-regroup-uri> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request; and\n2)\tpreconfigured group identity in an incoming SIP MESSAGE request refers to the the group identity from the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request.\nUpon receipt of a \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a group regroup using preconfigured group\", the originating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The originating participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The originating participating MCPTT function shall skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\n3)\tshall authorise the user. If the user profile identified by the MCPTT ID does not contain an <allow-regroup> element set to \"true\", the originating participating MCPTT function shall reject the \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a group regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"160 user not authorised to request creation of a regroup\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of these steps;\n4)\tshall select a controlling MCPTT function to manage the regroup and determine the public service identity of that controlling MCPTT function;\nNOTE 1:\tHow the originating participating MCPTT function selects a controlling MCPTT function to manage the regroup is a deployment decision.\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the selected controlling MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\na)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nb)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function selected in step 4);\nc)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request; and\ne)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 480 (Temporarily Unavailable) response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall select a different controlling MCPTT function to manage the regroup and determine the public service identity of that controlling MCPTT function;\nNOTE 7:\tHow the originating participating MCPTT function whether it decides to retry is a deployment decision.\nNOTE 8:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 9:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 10:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 11:\tHow the participating MCPTT function determines the public service identity of the selected controlling MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 12:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall generate a SIP MESSAGE request as specified in this clause with the Request-URI of the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function selected in step 1); and\n3)\tshall forward the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP MESSAGE request, the originating participating MCPTT function shall send a SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of any SIP 4xx response other than a 480 response, or a SIP 5xx or 6xx response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response; and\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP MESSAGE request to the originating participating MCPTT function to remove a regroup using preconfigured group\" for a temporary group identity, the originating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The originating participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The originating participating MCPTT function shall skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\n3)\tshall authorise the user. If the user profile identified by the MCPTT ID does not contain an <allow-regroup> element set to \"true\", the originating participating MCPTT function shall reject the \"SIP MESSAGE request to remove a regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"161 user not authorised to request removal of a regroup \" in a Warning header field as specified in clause 4.4, and shall skip the rest of these steps;\n4)\tshall determine the public service identity of the controlling MCPTT function associated with the regroup identity in the SIP MESSAGE request;\nNOTE 1:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function associated with the regroup or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\na)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nb)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 4;\nc)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request; and\ne)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function; and\n4)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response; and\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\nWhen receiving a \"SIP MESSAGE request to the terminating participating MCPTT function to create a group regroup using preconfigured group\", the terminating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The terminating participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The terminating participating MCPTT function shall skip the rest of the steps;\n2)\tshall send a SIP 200 (OK) response as specified in 3GPP TS 24.229 [4];\n3)\tfor each MCPTT ID contained in the <users-for-regroup> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body, the terminating participating MCPTT function:\na)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\nb)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public user identity associated with the MCPTT ID;\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request with the exception that any <users-for-regroup> elements shall not be copied;\nf)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\ng)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nh)\tshall consider the MCPTT ID as affiliated with the temporary group identity representing the regroup identified in the <mcptt-regroup-uri> element in the incoming SIP MESSAGE request; and\n4)\tshall store:\na)\tthe value of the <mcptt-regroup-uri> element as the identity of the regroup based on a preconfigured group;\nb)\tthe value of the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the identity of the preconfigured group; and\nc)\tthe set of MCPTT IDs contained in the <users-for-regroup> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the list of the users that are members of the group regroup;\nuntil the regroup is removed.\nWhen receiving a \"SIP MESSAGE request to the terminating participating MCPTT function to remove a regroup using preconfigured group\", the terminating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The terminating participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The terminating participating MCPTT function shall skip the rest of the steps;\n2)\tshall generate a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and shall send the SIP 200 (OK) response as specified in 3GPP TS 24.229 [4];\n3)\tfor each served MCPTT ID affiliated with the temporary group identity in the incoming SIP MESSAGE, the terminating participating MCPTT function:\na)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\nb)\tinclude in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public user identity associated with the MCPTT ID;\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request, with the exceptions that any <users-for-regroup> or <groups-for-regroup> elements shall not be copied;\nf)\tshall copy the contents of the P-Asserted-Identity header field of the incoming SIP MESSAGE request to the P-Asserted-Identity header field of the outgoing SIP MESSAGE request;\ng)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];and\nh)\tshall consider the MCPTT ID as deaffiliated from the regroup.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.3\tControlling MCPTT function procedures",
                            "text_content": "When receiving a \"SIP MESSAGE request to the controlling MCPTT function to request creation of a group regroup using preconfigured group\" the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response, may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall skip the rest of the steps;\n2)\tif the controlling MCPTT function is not able to handle the regroup based on the MCPTT group indicated in the <preconfigured-group> element in an application/vnd.3gpp.mcptt-regroup+xml MIME body:\na)\tshall generate a SIP 480 (Temporarily Unavailable) response to the incoming SIP MESSAGE request; and\nb)\tshall send the SIP 480 (Temporarily Unavailable) response as specified in 3GPP TS 24.229 [4] and skip the rest of the steps;\n3)\tif the controlling MCPTT function determines that the proposed group ID for the regroup is already in use, shall reject the \"SIP MESSAGE request to the controlling MCPTT function to request creation of a group regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"165 group ID for regroup already in use\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n4)\tfor each group identified in the <groups-for-regroup> element:\na)\tshall determine the controlling MCPTT function serving that group;\nNOTE 1:\tThe controlling MCPTT function serving a consitituent group assumes the role of a non-controlling MCPTT function for the regroup.\nb)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nc)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nd)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the non-controlling MCPTT function;\nNOTE 2:\tThe public service identity can identify the non-controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function associated with the constituent MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\nf)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\ng)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\nh)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\n5)\tshall wait to receive SIP responses from all of the non-controlling MCPTT functions that were sent a SIP MESSAGE request above;\n6)\tif all of the SIP responses received above are SIP 200 (OK) responses:\na)\tshall send a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall store the list of group identities contained in the <groups-for-regroup> element;\nc)\tshall store the value of the <mcptt-regroup-uri> element as the identity of the group regroup based on a preconfigured group; and\nd)\tshall store the value of the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the identity of the preconfigured group; and\n7)\tif at least one of the SIP responses received above is not a SIP 2xx response:\na)\tshall send a SIP 480 (Temporarily Unavailable) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tfor each non-controlling MCPTT function that returned a SIP 200 (OK) response in step 4:\ni)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nii)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the non-controlling MCPTT function;\nNOTE 7:\tThe public service identity can identify the non-controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 8:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 9:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 10:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function associated with the constituent MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 11:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\niii)\tshall include an application/vnd.3gpp.mcptt-regroup+xml MIME body in the outgoing SIP MESSAGE request with;\nA)\tan <mcptt-regroup-uri> element set to the identity of the regroup; and\nB)\ta <regroup-action> element set to \"remove\"; and\niv)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nWhen receiving a \"SIP MESSAGE request to the controlling MCPTT function to remove a regroup using preconfigured group\" the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The controlling MCPTT function shall skip the rest of the steps;\n2)\tif the in-progress emergency state of the regroup is set to a value of \"true\", then:\na)\tshall send a SIP 403 (Forbidden) response to the received SIP MESSAGE request including warning text set to \"169 user not authorised to remove regroup in an emergency state\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\nNOTE 1:\tThe MCPTT client that receives the SIP 403 (Forbidden) response is expected to notify the MCPTT user that the remove of the regroup was not accomplished because the regroup is in an emergency state. The MCPTT user can then, if authorised, cancel the emergency state of the regroup and reattempt to remove the regroup, if so desired.\n3)\tif the controlling MCPTT function determines that the requested group ID for the regroup removal does not exist, shall reject the \"SIP MESSAGE request to the controlling MCPTT function to remove a regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"163 the group identity indicated in the request does not exist\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n4)\tshall send a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n5)\tif the regroup is a group regroup based on preconfigured group, then:\na)\tfor each constituent group belonging to the regroup:\ni)\tshall determine the non-controlling MCPTT function serving that group;\nii)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\niii)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\niv)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the non-controlling MCPTT function;\nNOTE 2:\tThe public service identity can identify the non-controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function associated with the constituent MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nv)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\nvi)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\nvii)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\nviii)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\n6)\tif the regroup is a user regroup based on preconfigured group, then for each user belonging to the regroup, the controlling MCPTT function shall create a separate list of MCPTT IDs for users belonging to and affiliated with the regroup who are served by the same terminating participating MCPTT function and for each terminating participating MCPTT function;\na)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 7:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 8:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 9:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 10:\tHow the controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 11:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\nf)\tshall use the list of affiliated MCPTT IDs for this terminating participating MCPTT function to create and include a <users-for-regroup> element contained in the application/vnd.3gpp.mcptt-regroup+xml MIME body;\ng)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\nh)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nWhen the controlling MCPTT function decides to remove a regroup using preconfigured group, the controlling MCPTT function:\n1)\tif the regroup is a group regroup based on preconfigured group, then:\na)\tfor each constituent group belonging to the regroup:\ni)\tshall determine the non-controlling MCPTT function serving that group;\nii)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\niii)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the non-controlling MCPTT function determined in step i);\nNOTE 1:\tThe public service identity can identify the non-controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the non-controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the non-controlling MCPTT function associated with the constituent MCPTT group or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\niv)\tshall create an application/vnd.3gpp.mcptt-regroup+xml MIME body and include it in the outgoing SIP MESSAGE request with:\nA)\tan <mcptt-regroup-uri> element set to the identity of the regroup;\nB)\ta <regroup-action> element set to \"remove\"; and\nv)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\n2)\tif the regroup is a user regroup based on preconfigured group, then the controlling MCPTT function shall create a list of terminating participating MCPTT functions serving users belonging to and affiliated with the regroup and shall create a list of MCPTT IDs that are affiliated to the regroup and served by the same terminating partificpating MCPTT function for each of the members of the list of terminating participating MCPTT functions, and for each terminating participating MCPTT function in the list:\na)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 6:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 7:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 8:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 9:\tHow the controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 10:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nc)\tshall create an application/vnd.3gpp.mcptt-regroup+xml MIME body and include it in the outgoing SIP MESSAGE request with:\ni)\tan <mcptt-regroup-uri> element set to the identity of the regroup;\nii)\ta <regroup-action> element set to \"remove\"; and\niii)\ta <users-for-regroup> element set to the list of MCPTT IDs served by this terminating participating MCPTT function that are affiliated to the regroup; and\nd)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.2.4\tNon-controlling MCPTT function procedures",
                            "text_content": "When receiving a \"SIP MESSAGE request to a non-controlling MCPTT function to request creation of a group regroup using preconfigured group\" the non-controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response, may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24], and shall skip the rest of the steps;\n2)\tor each group identified in the <groups-for-regroup> element of an application/vnd.3gpp.mcptt-regroup+xml MIME body in the incoming SIP MESSAGE request for which the MCPTT function is the non-controlling MCPTT function:\na)\tshall determine if the group is already regrouped, and if the group is already regrouped:\ni)\tshall reject the SIP request with a SIP 403 (Forbidden) response including warning text set to \"148 group is regrouped\" in a Warning header field as specified in clause 4.4; and\nii)\tshall not process the remaining steps;\n3)\tshall store:\na)\tthe list of group identities contained in the <groups-for-regroup> element;\nb)\tthe value of the <mcptt-regroup-uri> element as the identity of the group regroup;\nc)\tthe value of the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the identity of the preconfigured group; and\nd)\tinformation that each of the groups identified in the <groups-for-regroup> element has been regrouped using a preconfigured group;\n4)\tshall send a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\n5)\tfor each group identified in the <groups-for-regroup> element of an application/vnd.3gpp.mcptt-regroup+xml MIME body in the incoming SIP MESSAGE request for which the MCPTT function is the non-controlling MCPTT function shall create a separate list of MCPTT IDs for users belonging to and affiliated with the identified group who are served by the same terminating participating MCPTT function;\n6)\tshall merge the lists of MCPTT IDs associated with each terminating participating MCPTT function such that the resulting list associated with a terminating participating MCPTT function contains the MCPTT IDs of all users served by the participating MCPTT function that belong to and are affiliated with any of the groups identified in the <groups-for-regroup> element; and\n7)\tfor each terminating participating MCPTT function identified above:\na)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the non-controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\nf)\tshall use the list of MCPTT IDs for this terminating participating MCPTT function as generated in step 3) to create and include the <users-for-regroup> element in the application/vnd.3gpp.mcptt-regroup+xml MIME body;\ng)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the non-controlling MCPTT function; and\nh)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nWhen receiving a \"SIP MESSAGE request to the non-controlling MCPTT function to remove a group regroup using preconfigured group\" the non-controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The non-controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The non-controlling MCPTT function shall skip the rest of the steps;\n2)\tshall send a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\n3)\tshall identify the constituent groups belonging to the regroup identified in the <mcptt-regroup-uri> in the application/vnd.3gpp.mcptt-regroup+xml MIME body contained in the incoming SIP MESSAGE for which this MCPTT function is the non-controlling MCPTT function and shall create a list of terminating participating MCPTT functions serving MCPTT IDs belonging to the identified constituent groups and for each member of the list of terminating participating MCPTT functions in the list shall create a list of MCPTT IDs affiuliated to the regroup and served by that terminating participating MCPTT function;\n4)\tfor each terminating participating MCPTT function identified in step 3):\na)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the non-controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\ni) shall create and include a <users-for-regroup> element containing the list of MCPTT IDs affiliated to the regroup that are served by this terminating participating MCPTT function as determined in step 3); and\nf)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the non-controlling MCPTT function; and\ng)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nWhen a non-controlling MCPTT function becomes aware of an MCPTT client affiliating with a group that it controls, where that group is a constituent group of a group regroup using preconfigured group, the non-controlling MCPTT function:\n1)\tshall create a list of MCPTT IDs for users belonging to and affiliated with the identified constituent group who are served by the same terminating participating MCPTT function as the MCPTT client affiliating with the constituent group;\n2)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n3)\tshall create in the SIP MESSAGE request copies of all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the SIP MESSAGE request received from the controlling MCPTT function for the group regroup to notify creation of the group regroup using preconfigured group;\n4)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the non-controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall create an application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP MESSAGE request using the information from the application/vnd.3gpp.mcptt-info+xml MIME body originally included in the SIP MESSAGE request received from the controlling MCPTT function for the group regroup to notify creation of the group regroup using preconfigured group;\n6)\tshall create an application/vnd.3gpp.mcptt-regroup+xml MIME body in the outgoing SIP MESSAGE request using the information from the application/vnd.3gpp.mcptt-regroup+xml MIME body originally included in the SIP MESSAGE request received from the controlling MCPTT function for the group regroup to notify creation of the group regroup using preconfigured group;\n7)\tshall use the list of MCPTT IDs as generated in step 1) to create and include the <users-for-regroup> element in the application/vnd.3gpp.mcptt-regroup+xml MIME body;\n8)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the non-controlling MCPTT function; and\n9)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "16.3\tUser regroup using a preconfigured group",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "16.3.1\tClient procedures",
                            "text_content": "Upon receiving a request from an MCPTT user to establish an MCPTT user regroup using a preconfigured group, the MCPTT client shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\n1)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n2)\tshall include an Accept-Contact header field with the media feature tag g.3gpp.icsi-ref with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with parameters \"require\" and \"explicit\" according to IETF RFC 3841 [6];\n3)\tshall set the Request-URI to the public service identity identifying the originating participating MCPTT function serving the MCPTT user;\n4)\tmay include a P-Preferred-Identity header field in the SIP MESSAGE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n5)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Asserted-Service-Id header field according to IETF RFC 6050 [9];\n6)\tshall contain an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client;\nb)\tif the MCPTT client is aware of active functional aliases, and an active functional alias is to be included in the SIP MESSAGE request, the <anyExt> element with the <functional-alias-URI> element set to the URI of the used functional alias; and\nc)\tif the MCPTT user has requested an application priority, the <anyExt> element with the <user-requested-priority> element set to the user provided value;\n7)\tshall contain an application/vnd.3gpp.mcptt-regroup+xml MIME body with:\na)\tthe <mcptt-regroup-uri> element set to a unique temporary group identity URI;\nNOTE:\tHow the unique temporary group identity URI is formed is an implementation decision.\nb)\tthe <preconfigured-group> element set to the group identity of the preconfigured group;\nc)\tthe <regroup-action> element set to \"create\"; and\nd)\tthe <users-for-regroup> element set to the list of MCPTT IDs of users that are to be included in the regroup; and\n8)\tshall send the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP MESSAGE request, the MCPTT client:\n1)\tshould notify the MCPTT user of the successful creation of the user regroup using preconfigured group.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tshould notify the MCPTT user of the failure to create the user regroup using preconfigured group.\nWhen the user requests the MCPTT client to remove a user regroup, the MCPTT client uses the procedure in clause 16.2.1.2.\nThe procedure in clause 16.2.1.3 is used by the MCPTT client when the MCPTT server notifies the MCPTT client of the creation of a user regroup using preconfigured group.\nThe procedure in clause 16.2.1.4 is used by the MCPTT client when the MCPTT server notifies the MCPTT client of the removal of a user regroup using preconfigured group.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.3.2\tParticipating MCPTT function procedures",
                            "text_content": "In the procedures in this clause:\n1)\ttemporary group identity in an incoming SIP MESSAGE request refers to the temporary group identity from the <mcptt-regroup-uri> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request; and\n2)\tpreconfigured group identity in an incoming SIP MESSAGE request refers to the the group identity from the <preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body of the incoming SIP MESSAGE request.\nUpon receipt of a \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a user regroup using preconfigured group\", the originating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The originating participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The originating participating MCPTT function shall skip the rest of the steps;\n2)\tshall determine the MCPTT ID of the user from the public user identity in the P-Asserted-Identity header field of the SIP MESSAGE request;\n3)\tshall authorise the user. If the user profile identified by the MCPTT ID does not contain an <allow-regroup> element set to \"true\", the originating participating MCPTT function shall reject the \"SIP MESSAGE request to the originating participating MCPTT function to request creation of a user regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"160 user not authorised to request creation of a regroup\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of these steps;\n4)\tshall select a controlling MCPTT function to manage the regroup and determine the public service identity of the controlling MCPTT function;\nNOTE 1:\tHow the originating participating MCPTT function selects a controlling MCPTT function to manage the regroup is a deployment decision.\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 3:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 4:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 5:\tHow the participating MCPTT function determines the public service identity of the selected controlling MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 6:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n5)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33] and:\na)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nb)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the controlling MCPTT function determined in step 4);\nc)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request; and\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request; and\ne)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function; and\n6)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4].\nUpon receipt of a SIP 480 (Temporarily Unavailable) response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall select a different controlling MCPTT function to manage the regroup and determine the public service identity of that controlling MCPTT function;\nNOTE 7:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 8:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 9:\tIf the controlling MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 10:\tHow the participating MCPTT function determines the public service identity of the selected controlling MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 11:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\n2)\tshall generate a SIP MESSAGE request as specified in this clause with the Request-URI of the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function determined in step 1); and\n3)\tshall forward the SIP MESSAGE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n3)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function; and\n4)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx response that is not a 480 response, or a SIP 5xx or 6xx response to the above SIP MESSAGE request, the originating participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response; and\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\nWhen the originating participating MCPTT function needs to remove a user regroup, the originating participating MCPTT function uses the procedure in clause 16.2.2.3.\nWhen receiving a \"SIP MESSAGE request to the terminating participating MCPTT function to create a user regroup using preconfigured group\", the terminating participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The terminating participating MCPTT function shall skip the rest of the steps;\n2)\tshall send a SIP 200 (OK) response in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\n3)\tfor each MCPTT ID contained in the <users-for-regroup> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body, the terminating participating MCPTT function is aware from stored information that the MCPTT client has not previously been notified of the creation of the user regroup:\na)\tshall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33]:\nb)\tinclude in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public user identity associated with the MCPTT ID;\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request, with the exception that any <groups-for-regroup> elements shall not be copied;\nf)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the participating MCPTT function;\ng)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4]; and\nh)\tshall consider the MCPTT ID as affiliated with the temporary group identity representing the regroup identified in the <mcptt-regroup-uri> element in the incoming SIP MESSAGE request; and\n4)\tshall store:\na)\tthe value of the <mcptt-regroup-uri> element as the identity of the regroup based on a preconfigured group;\nb)\tthe value of the preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the identity of the preconfigured group; and\nc)\tthe list of the users that are members of the user regroup;\nuntil the regroup is removed.\nWhen the terminating participating MCPTT function receives a request to remove a user regroup it uses the procedure in clause 16.2.2.5.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "16.3.3\tControlling MCPTT function procedures",
                            "text_content": "When receiving a \"SIP MESSAGE request to the controlling MCPTT function to request creation of a user regroup using preconfigured group\" the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP MESSAGE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. The controlling MCPTT function shall skip the rest of the steps;\n2)\tif the controlling MCPTT function is unable to handle the user regroup it shall send a SIP 480 (Temporarily Unavailable) response to the incoming SIP MESSAGE request and shall skip the rest of the steps;\n3)\tif the controlling MCPTT function determines that the proposed group ID for the regroup is already in use, shall reject the \"SIP MESSAGE request to the controlling MCPTT function to request creation of a user regroup using preconfigured group\" with a SIP 403 (Forbidden) response to the SIP MESSAGE request, with warning text set to \"165 group ID for regroup already in use\" in a Warning header field as specified in clause 4.4, and shall skip the rest of the steps;\n4)\tshall create a separate list of MCPTT IDs containing all users identified in the <users-for-regroup> element in the application/vnd.3gpp.mcptt-regroup+xml MIME body who are served by the same terminating participating MCPTT function;\n5)\tfor each terminating participating MCPTT function identified in step 3):\na)\tshall generate an outgoing SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33];\nb)\tshall include in the SIP MESSAGE request all Accept-Contact header fields and all Reject-Contact header fields, with their feature tags and their corresponding values along with parameters according to rules and procedures of IETF RFC 3841 [6] that were received (if any) in the incoming SIP MESSAGE request;\nc)\tshall set the Request-URI of the outgoing SIP MESSAGE request to the public service identity of the terminating participating MCPTT function;\nNOTE 1:\tThe public service identity can identify the terminating participating MCPTT function in the primary MCPTT system or in a partner MCPTT system.\nNOTE 2:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the public service identity can identify the MCPTT gateway server that acts as an entry point in the partner MCPTT system from the primary MCPTT system.\nNOTE 3:\tIf the terminating participating MCPTT function is in a partner MCPTT system in a different trust domain, then the primary MCPTT system can route the SIP request through an MCPTT gateway server that acts as an exit point from the primary MCPTT system to the partner MCPTT system\nNOTE 4:\tHow the controlling MCPTT function determines the public service identity of the targeted terminating participating MCPTT function or of the MCPTT gateway server in the partner MCPTT system is out of the scope of the present document.\nNOTE 5:\tHow the primary MCPTT system routes the SIP request through an exit MCPTT gateway server is out of the scope of the present document.\nd)\tshall copy the contents of the application/vnd.3gpp.mcptt-info+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-info+xml MIME body included in the outgoing SIP MESSAGE request;\ne)\tshall copy the contents of the application/vnd.3gpp.mcptt-regroup+xml MIME body received in the incoming SIP MESSAGE request into an application/vnd.3gpp.mcptt-regroup+xml MIME body included in the outgoing SIP MESSAGE request;\nf)\tshall use the list of MCPTT IDs for this participating MCPTT function as generated in step 3) to create and include a <users-for-regroup> element contained in the application/vnd.3gpp.mcptt-regroup+xml MIME body;\ng)\tshall include a P-Asserted-Identity header field in the outgoing SIP MESSAGE request set to the public service identity of the controlling MCPTT function; and\nh)\tshall send the SIP MESSAGE request as specified in 3GPP TS 24.229 [4];\n6)\twhen the controlling MCPTT function receives a SIP 200 (OK) response from any of the terminating participating MCPTT functions that were sent a SIP MESSAGE request in step 4) the controlling MCPTT function shall:\na)\tsend a SIP 200 (OK) response to the incoming SIP MESSAGE request; and\nb)\tstore the the value of the <mcptt-regroup-uri> element as the identity of the user regroup based on a preconfigured group;\nc)\tthe value of the preconfigured-group> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the identity of the preconfigured group; and\nd)\tstore the set of MCPTT IDs contained in the <users-for-regroup> element of the application/vnd.3gpp.mcptt-regroup+xml MIME body as the the list of the users that are members of the user regroup; and\n7)\tif no SIP 200 (OK) response is received for a SIP MESSAGE sent in step 4), the controlling MCPTT function shall send a SIP 480 (Temporarily Unavailable) response to the incoming SIP MESSAGE request in accordance with 3GPP TS 24.229 [4] and IETF RFC 3428 [33].\nWhen the controlling MCPTT function receives a request to remove a user regroup it uses the procedure in clause 16.2.3.2.\nWhen the controlling MCPTT function decides to remove a user regroup it uses the procedure in clause 16.2.3.3.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "17\tAdhoc group call",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "17.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the adhoc group call procedures for on-network across single or multiple MCPTT systems, and associated functions such as emergency calls, Imminent peril calls, broadcast calls and others.\nThe adhoc group calls can use the participant list provided by either an initiator of the call or the MCPTT server. The MCPTT server can use the criteria provided by the initiator of the call to determine the participant list along with local criteria or local policies. The resulting adhoc group uses the configuration of a separate preconfigured MCPTT group.\nNOTE 1:\tA preconfigured group that is intended only to provide configuration for the adhoc group is identified by a parameter in the group configuration described in 3GPP TS 23.280 [82].\nEditor’s Note: It is FFS an additional parameter is needed in group configuration.\nThe preconfigured MCPTT group that provides the configuration is not used for the MCPTT group communication, it only provides configuration for one or more adhoc group calls. The MCPTT group ID of the adhoc group call is provided by the MCPTT server when the adhoc group call originated. To establish a security context for the end-to-end secured adhoc group call, the security related information is used from this preconfigured group.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "17.2\tMCPTT client procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.2.1\tGeneral",
                            "text_content": "This clause describes the adhoc group call procedures using on-demand and pre-established sessions to setup adhoc group calls, release the ongoing adhoc group calls, and modify the ongoing adhoc group calls participants.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.2\tAdhoc group call setup",
                            "text_content": "This clause describes the originating, and terminating call setup procedures.\nUpon receiving a request from an MCPTT user to establish an MCPTT adhoc group session, the MCPTT client shall determine whether the service configuration document contains an <on-network> element that contains an <anyExt> element that contains an <adhoc-group-call> element that contains an <allow-adhoc-group-call-support> element and if an <allow-adhoc-group-call-support> element does not exist, or is set to a value of \"false, then the MCPTT client:1)\tshould indicate to the MCPTT user that adhoc group calls are not allowed; and\n2)\tshall skip the remainder of this procedure.\nUpon receiving a request from an MCPTT user to establish an MCPTT adhoc group session, the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client:\n1)\tshall set the Request-URI of the SIP INVITE request to a public service identity identifying the participating MCPTT function serving the MCPTT user;\n2)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP INVITE request according to IETF RFC 3840 [16];\n3)\tshall include an Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n4)\tshall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), in a P-Preferred-Service header field according to IETF RFC 6050 [9] in the SIP INVITE request;\n5)\tshall include an Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\n6)\tshould include the \"timer\" option tag in the Supported header field;\n7)\tshould include the Session-Expires header field according to IETF RFC 4028 [7]. It is recommended that the \"refresher\" header field parameter is omitted. If included, the \"refresher\" header field parameter shall be set to \"uac\";\n8)\tmay include a P-Preferred-Identity header field in the SIP INVITE request containing a public user identity as specified in 3GPP TS 24.229 [4];\n9)\tif the MCPTT user has requested the origination of a broadcast adhoc group call, the MCPTT client shall comply with the procedures in clause 6.2.8.2;\n10)\tshall contain in an application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <session-type> element set to a value of \"adhoc\";\nb)\tif the MCPTT client needs to include an identity of adhoc group, the <mcptt-request-uri> element set to the identity of the adhoc group;\nNOTE 1:\tIf the call setup request follows an emergency alert for an adhoc group then this element is included and the identity of adhoc group learned during an adhoc group emergency alert procedures is used.\nNOTE 2:\tThe MCPTT client can optionally include an identity of adhoc group if it learns by any other means or generated by the MCPTT client using required parameters.\nc)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\nNOTE 3:\tThe MCPTT client does not include the MCPTT ID of the originating MCPTT user in the body, as this will be inserted into the body of the SIP INVITE request that is sent from the originating participating MCPTT function.\nd)\tan <anyExt> element containing:\ni)\tif the MCPTT client needs to include an active functional alias in the initial SIP INVITE request, the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 4:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nii)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\niii)\tif end-to-end security needs to be established for the MCPTT adhoc group session, the <end-to-end-security> element set to \"true\";\n11)\tif the MCPTT user has requested to include the list of MCPTT users to be called and the call setup request does not follow an adhoc group for emergency alert, shall insert in the SIP INVITE request an application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT users to be called, according to rules and procedures of IETF RFC 5366 [20];\n12)\tif the MCPTT user has requested to include the criteria for determining the list of MCPTT users to be called and the call setup request does not follow an adhoc group for emergency alert, shall insert a <call-participants-criterias> with one or more criteria as a comma separated list into <anyExt> element of <mcptt-Params> element of <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request;\nNOTE 5:\tThe MCPTT client can include either a list of MCPTT users or the criteria for determining the list of MCPTT users to be called. These two information elements are not included if the call setup request follows an adhoc group for emergency alerts.\n13)\tshall include an SDP offer according to 3GPP TS 24.229 [4] with the clarifications given in clause 6.2.1;\n14)\tif an implicit floor request is required, shall indicate this as specified in clause 6.4 and\na)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\", shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n15)\tshall send the SIP INVITE request towards the MCPTT server according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP INVITE request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tmay notify the answer state to the user (i.e. \"Unconfirmed\" or \"Confirmed\") if received in the P-Answer-State header field;\n3)\tif the <preconfigured-group-id> element received in the application/vnd.3gpp.mcptt-info+xml MIME body, shall use the security related information from the group configuration associated with the received preconfigured group identity; and\n4)\tmay notify the user with the adhoc group identity received in the <mcptt-calling-group-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP INVITE request:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5]; and\n2)\tmay notify the user about call setup failure with an appropriate response along with the description.\nUpon receipt of an initial SIP INVITE request, the MCPTT client shall follow the procedures for the termination of multimedia sessions in the IM CN subsystem as specified in 3GPP TS 24.229 [4] with the clarifications below.\nThe MCPTT client:\n1)\tmay reject the SIP INVITE request if any of the following conditions are met:\na)\tMCPTT client does not have enough resources to handle the call; or\nb)\tany other reason outside the scope of this specification;\n2)\tif the SIP INVITE request is rejected in step 1), shall respond toward participating MCPTT function either with an appropriate reject code as specified in 3GPP TS 24.229 [4] and warning texts as specified in clause 4.4.2 or with SIP 480 (Temporarily unavailable) response not including warning texts if the user is authorised to restrict the reason for failure and skip the rest of the steps of this clause;\n3)\tshall check if a Resource-Priority header field is included in the incoming SIP INVITE request and may perform further actions outside the scope of this specification to act upon an included Resource-Priority header field as specified in 3GPP TS 24.229 [4];\n4)\tmay display to the MCPTT user the MCPTT ID of the inviting MCPTT user;\n5)\tmay display to the MCPTT user the functional alias of the inviting MCPTT user, if present;\n6)\tif the <preconfigured-group-id> element received in the application/vnd.3gpp.mcptt-info+xml MIME body, shall use the security related information from the group configuration associated with the received preconfigured group identity;\n7)\tmay notify the user with the adhoc group identity received in the <mcptt-calling-group-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body;\n8)\tshall perform the automatic commencement procedures specified in clause 6.2.3.1.2 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode; or\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Auto\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to manual commencement mode, yet the invited MCPTT client allows the call to be answered with automatic commencement mode; and\n9)\tshall perform the manual commencement procedures specified in clause 6.2.3.2.2 if one of the following conditions are met:\na)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is to use manual commencement mode; or\nb)\tSIP INVITE request contains an Answer-Mode header field with the value \"Manual\" and the MCPTT service setting at the invited MCPTT client for answering the call is set to automatic commencement mode, yet the invited MCPTT client allows the call to be answered with manual commencement mode.\nUpon receiving a request from an MCPTT user to establish an MCPTT adhoc group session within the pre-established session, the MCPTT client shall determine whether the service configuration document contains an <on-network> element that contains an <anyExt> element that contains an <adhoc-group-call> element that contains an <allow-adhoc-group-call-support> element and if an <allow-adhoc-group-call-support> element does not exist, or is set to a value of \"false\", then the MCPTT client:\n1)\tshould indicate to the MCPTT user that adhoc group calls are not allowed; and\n2)\tshall skip the remainder of this procedure.\nThe MCPTT client shall generate a SIP REFER request outside a dialog in accordance with the procedures specified in 3GPP TS 24.229 [4], IETF RFC 4488 [22] and IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], with the clarifications given below.\nThe MCPTT client:\n1)\tshall include the Request-URI set to the public service identity identifying the pre-established session on the MCPTT server serving the MCPTT user;\n2)\tshall include the Refer-Sub header field with value \"false\" according to rules and procedures of IETF RFC 4488 [22];\n3)\tshall include the Supported header field with value \"norefersub\" according to rules and procedures of IETF RFC 4488 [22];\n4)\tshall include the option tag \"multiple-refer\" in the Require header field;\n5)\tmay include a P-Preferred-Identity header field in the SIP REFER request containing a public user identity as specified in 3GPP TS 24.229 [4];\n6)\tshall include a P-Preferred-Service header field set to the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" (coded as specified in 3GPP TS 24.229 [4]), according to IETF RFC 6050 [9];\n7)\tif the MCPTT user has requested to include the list of MCPTT users to be called and the call setup request does not follow an adhoc group for emergency alert:\na)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20], and with the Content-ID header field set to this \"cid\" URL and Content-Type header filed set to \"application/resource-lists+xml\";\nb)\tshall include in the application/resource-lists MIME body an <entry> element for each of the targeted MCPTT users, with each <entry> element containing a \"uri\" attribute set to the MCPTT ID of the targeted user, extended with hname \"body\" parameter in the headers portion of the SIP URI containing:\nNOTE 1:\tCharacters that are not formatted as ASCII characters are escaped in the following parameters in the headers portion of the SIP URI.\ni)\tthe Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nii)\tan Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6]; and\niii)\tan hname \"body\" parameter populated with:\nA)\tan application/sdp MIME body containing an SDP offer, if the session parameters of the pre-established session require modification or if implicit floor control is requested, according to the conditions specified in clause 6.4;\nB)\tan application/vnd.3gpp.mcptt-info MIME body with:\nI)\tthe <session-type> element set to a value of \"adhoc\";\nII)\tthe MCPTT client may include the identity of adhoc group with the <mcptt-request-uri> element set to the identity of the adhoc group;\nNOTE 2:\tThe MCPTT client can optionally include an identity of adhoc group if it learns by any other means or generated by the MCPTT client using required parameters.\nIII)\tif the MCPTT user has requested the origination of a broadcast adhoc group call, the <broadcast-ind> element set to \"true\";\nIV)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\nV)\tan <anyExt> element containing:\nAA)\tif the MCPTT client needs to include an active functional alias in the SIP REFER request, the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 3:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nBB)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\nCC)\tif end-to-end security needs to be established for the MCPTT adhoc group session, the <end-to-end-security> element set to \"true\";\nC)\tif:\nI)\timplicit floor control is requested; and\nII)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nD)\tif several MIME bodies to be included in the hname \"body\" parameter, shall include the MIME bodies according to the procedures specified in clause 6.5;\n8)\tif the MCPTT user has requested to include the criteria for determining the list of MCPTT users to be called and the call setup request does not follow an adhoc group for emergency alert:\na)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an MIME body section which conatins one or more MIME bodies, and with the Content-ID header field set to this \"cid\" URL and Content-Type header filed set to \"application/vnd.3gpp.mcptt-info+xml\" or according to the procedures specified in clause 6.5 if several MIME bodies needs to be included;\nb)\tthe Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nc)\tan Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nd)\tshall include an application/sdp MIME body containing an SDP offer, if the session parameters of the pre-established session require modification or if implicit floor control is requested, according to the conditions specified in clause 6.4;\ne)\tshall include an application/vnd.3gpp.mcptt-info MIME body with:\ni)\tthe <session-type> element set to a value of \"adhoc\";\nii)\tthe MCPTT client may include the identity of adhoc group with the <mcptt-request-uri> element set to the identity of the adhoc group;\nNOTE 4:\tThe MCPTT client can optionally include an identity of adhoc group if it learns by any other means or generated by the MCPTT client using required parameters.\niii)\tif the MCPTT user has requested the origination of a broadcast adhoc group call, the <broadcast-ind> element set to \"true\";\niv)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\nv)\tan <anyExt> element containing:\nA)\tif the MCPTT client needs to include an active functional alias in the SIP REFER request, the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 5:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nB)\tthe <call-participants-criterias> element set to one or more criteria as a comma separated list;\nC)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value; and\nD)\tif end-to-end security needs to be established for the MCPTT adhoc group session, the <end-to-end-security> element set to \"true\";\nv)\tif:\nA)\timplicit floor control is requested; and\nB)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element;\n9)\tif the call setup request follows an emergency alert for an adhoc group:\na)\tshall set the Refer-To header field of the SIP REFER request as specified in IETF RFC 3515 [25] with a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that points to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20], and with the Content-ID header field set to this \"cid\" URL and Content-Type header filed set to \"application/resource-lists+xml\";\nb)\tshall include in the application/resource-lists+xml MIME body a single <entry> element in a <list> element in the <resource-lists> element where the <entry> elment contains a \"uri\" attribute set to the identity of the adhoc group learned during an adhoc group emergency alert procedure, extended with hname \"body\" parameter in the headers portion of the SIP URI containing:\nNOTE 6:\tCharacters that are not formatted as ASCII characters are escaped in the following parameters in the headers portion of the SIP URI.\ni)\tthe Accept-Contact header field containing the g.3gpp.mcptt media feature tag along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6];\nii)\tan Accept-Contact header field with the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" along with the \"require\" and \"explicit\" header field parameters according to IETF RFC 3841 [6]; and\niii)\tan hname \"body\" parameter populated with:\nA)\tan application/sdp MIME body containing an SDP offer, if the session parameters of the pre-established session require modification or if implicit floor control is requested, according to the conditions specified in clause 6.4;\nB)\tan application/vnd.3gpp.mcptt-info MIME body with:\nI)\tthe <session-type> element set to a value of \"adhoc\";\nII)\tthe <mcptt-client-id> element set to the MCPTT client ID of the originating MCPTT client; and\nIII)\tan <anyExt> element containing:\naa)\tif the MCPTT client needs to include an active functional alias in the SIP REFER request, the <functional-alias-URI> element set to the URI of the used functional alias;\nNOTE 7:\tThe MCPTT client learns the functional aliases that are activated for an MCPTT ID from procedures specified in clause 9A.2.1.3.\nbb)\tif the MCPTT user has requested an application priority, the <user-requested-priority> element set to the user provided value;\ncc)\tthe <adhoc-grp-emg-alert-grp-ind> element set to \"true\"; and\ndd)\tif end-to-end security needs to be established for the MCPTT adhoc group session, the <end-to-end-security> element set to \"true\";\nC)\tif:\nI)\timplicit floor control is requested; and\nII)\tif the <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nD)\tif several MIME bodies to be included in the hname \"body\" parameter, shall include the MIME bodies according to the procedures specified in clause 6.5;\nNOTE 8:\tThe MCPTT client can include either a list of MCPTT users or the criteria for determining the list of MCPTT users to be called. These two information elements are not included if the call setup request follows an adhoc group for emergency alerts.\n10)\tshall include a Target-Dialog header field as specified in IETF RFC 4538 [23] identifying the pre-established session;\n11)\tshall include the g.3gpp.mcptt media feature tag and the g.3gpp.icsi-ref media feature tag with the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field of the SIP REFER request according to IETF RFC 3840 [16]; and\n12)\tshall send the SIP REFER request according to 3GPP TS 24.229 [4].\nOn receiving a final SIP 2xx response to the SIP REFER request, the MCPTT client:\n1)\tshall interact with the user plane as specified in 3GPP TS 24.380 [5];\n2)\tif the <preconfigured-group-id> element received in the application/vnd.3gpp.mcptt-info+xml MIME body, shall use the security related information from the group configuration associated with the received preconfigured group identity; and\n3)\tmay notify the user with the adhoc group identity received in the <mcptt-calling-group-id> element contained in the application/vnd.3gpp.mcptt-info+xml MIME body.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the SIP REFER request:\n1)\tmay notify the user about call setup failure with an appropriate response along with the description.\nUpon receiving a SIP re-INVITE request within a pre-established Session without an associated MCPTT session or when generating SIP responses to the SIP re-INVITE request, the MCPTT client shall follow the procedures as specified in clause 17.2.2.1.2.\nNOTE:\tIn clause 17.2.2.1.2, the reader is assumed to replace occurrences of SIP INVITE request with SIP re-INVITE request.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.3\tAdhoc group call release",
                            "text_content": "This clause describes the originating, and terminating call release procedures.\nUpon receiving a request from an MCPTT user to release an MCPTT adhoc group session established using on-demand session, the MCPTT client shall follow the procedures as specified in clause 6.2.5.1.\nUpon receiving a SIP BYE request for releasing the MCPTT adhoc group session, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nUpon receiving a request from an MCPTT user to release an MCPTT adhoc group session established using pre-established session, the MCPTT client shall follow the procedures as specified in clause 6.2.5.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.4\tAdhoc group call leave",
                            "text_content": "This clause describes the originating, and terminating call leave procedures.\nUpon receiving a request from an MCPTT user to leave an MCPTT adhoc group session established using on-demand session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.1.\nUpon receiving a SIP BYE request for leave the MCPTT adhoc group session, the MCPTT client shall follow the procedures as specified in clause 6.2.6.\nUpon receiving a request from an MCPTT user to leave an MCPTT adhoc group session established using pre-established session, the MCPTT client shall follow the procedures as specified in clause 6.2.4.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.5\tAdhoc group call rejoin",
                            "text_content": "This clause describes the originating, and terminating call rejoin procedures.\nUpon receiving a request from an MCPTT user to rejoin an ongoing MCPTT session or triggered by coming back from out of coverage, the MCPTT client shall generate an initial SIP INVITE request by following the UE originating session procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nNOTE:\tHow an MCPTT client is informed whether it comes back from out of coverage is out of scope of present document.\nThe MCPTT client shall follow the procedures specified in clause 17.2.2.1.1 with the clarification in step 1) of clause 17.2.2.1.1 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity to rejoin.\nUpon receiving a request from an MCPTT user to rejoin an ongoing MCPTT call within the pre-established session or triggered by coming back from out of coverage, the MCPTT client shall generate a SIP REFER request as specified in IETF RFC 3515 [25] as updated by IETF RFC 6665 [26] and IETF RFC 7647 [27], and in accordance with the UE procedures specified in 3GPP TS 24.229 [4], with the clarifications given below.\nThe MCPTT client shall follow the procedures specified in clause 17.2.2.2.1 with the clarification in step 7, step 8 and step 9 of clause 17.2.2.2.1 that the Refer-To header field of the SIP REFER request:\n1)\tshall contain a URI of the MCPTT session identity to rejoin; and\n2)\tshall contain a Content-Type header field in the headers portion of the SIP URI containing an application/vnd.3gpp.mcptt-info+xml MIME type of the hname \"body\" parameter in the headers portion of the SIP URI and the hname \"body\" parameter in the headers portion of the SIP URI containing the <mcpttinfo> element with the <mcptt-Params> element and with the <session-type> element set to a value of \"adhoc\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.2.6\tAdhoc group call participants modify",
                            "text_content": "This clause describes the originating adhoc group call participants modify procedures.\nUpon receiving a request from an authorized MCPTT user to modify an ongoing MCPTT session to update the participants list, the MCPTT client shall generate a SIP re-INVITE request as specified in 3GPP TS 24.229 [4], with the clarifications given below.\n1)\tshall include an application/vnd.3gpp.mcptt-info+xml MIME body populated as currently established session;\n2)\tif the currently established session is based on the MCPTT user requested to include the list of MCPTT users to be called, shall insert in the SIP re-INVITE request an application/resource-lists+xml MIME body with:\na)\tif MCPTT users to be invited to a call, the MCPTT ID of the invited MCPTT users to be called with the \"method\" SIP URI parameter set to the value \"INVITE\" in the \"uri\" attribute of the each <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body; and\nb)\tif MCPTT users to be removed from a call, the MCPTT ID of the MCPTT users to be removed with the \"method\" SIP URI parameter with the value \"BYE\" in the \"uri\" attribute of the each <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body;\n3)\tshall include an SDP offer with the media parameters as currently established according to 3GPP TS 24.229 [4]; and\n4)\tshall send the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nOn receiving a SIP 2xx response to the SIP re-INVITE request, the MCPTT client:\n1)\tmay notify the user about successful call modification request.\nOn receiving a SIP 4xx response, a SIP 5xx response or a SIP 6xx response to the re-SIP INVITE request, the MCPTT client:\n1)\tmay notify the user about call participants modify request failure with an appropriate response along with the description.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.3\tParticipating MCPTT function procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.3.1\tGeneral",
                            "text_content": "This clause describes the adhoc group call participating MCPTT function procedures using on-demand and pre-established sessions to setup adhoc group calls, release the ongoing adhoc group calls, and modify the ongoing adhoc group calls participants.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.3.2\tAdhoc group call setup",
                            "text_content": "This clause describes the originating, and terminating call setup participating MCPTT function procedures.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"adhoc\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP INVITE request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif through local policy in the participating MCPTT function, the user identified by the MCPTT ID is not authorised to initiate adhoc group calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response to the SIP INVITE request, with warning text set to \"184 user not authorised to make adhoc group calls\" in a Warning header field as specified in clause 4.4;\n5)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the SIP INVITE request shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n6)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the participating MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\n7)\tshall determine the public service identity of the controlling MCPTT function for the adhoc group call service associated with the originating user's identity i.e. MCPTT ID;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system.\nNOTE 3:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the adhoc group call service associated with the originating user is out of the scope of the present document.\n8)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the adhoc group call service associated with the originating user's MCPTT ID identity, it shall reject the SIP INVITE request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n9)\tif the <allow-adhoc-group-call> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to initiate adhoc group calls, shall reject the \"SIP INVITE request for originating participating MCPTT function\" with a SIP 403 (Forbidden) response, with warning text set to \"185 user is not authorised to initiate the adhoc group call\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n10)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.3;\n11)\tshall set the Request-URI to the public service identity of the controlling MCPTT function as determined in step 7;\n12)\tshall not copy the following header fields from the incoming SIP INVITE request to the outgoing SIP INVITE request, if they were present in the incoming SIP INVITE request:\na)\tAnswer-Mode header field as specified in IETF RFC 5373 [18]; and\nb)\tPriv-Answer-Mode header field as specified in IETF RFC 5373 [18];\n13)\tshall set the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP INVITE request to the MCPTT ID of the calling user;\n14)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the MCPTT client as specified in clause 6.3.2.1.1.1;\n15)\tif the received SIP request contains a <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body, then check if the status of the functional alias is activated for the MCPTT ID. If the functional alias status is activated, then set the <functional-alias-URI> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request to the received value, if the status is not activated then do not include a <functional-alias-URI> element;\nNOTE 4:\tThe participating MCPTT server learns the functional alias state for an MCPTT ID from procedures specified in clause 9A.2.2.2.7.\n16)\tif a Resource-Priority header field was included in the received SIP INVITE request, shall include a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the SIP INVITE request from the MCPTT client;\nNOTE 5:\tThe participating MCPTT function will leave the verification of the Resource-Priority header field to the controlling MCPTT function.\n17)\tif, according to clause 6.4, the SIP INVITE request is regarded as being received with an implicit request to grant the floor to the originating MCPTT client:\nif:\na)\tthe incoming SIP INVITE request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has the location of the originating MCPTT client available; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n18)\tshall forward the SIP INVITE request, according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the above SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as in clause 6.3.2.1.5.2 with the clarification that if an <MKFC-GKTPs> element was contained in the received SIP 2xx response it is not included in the generated SIP 200 (OK) response;\nNOTE 6:\tIf an <MKFC-GKTPs> element is received in a SIP 2xx response, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the originating client.\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function;\n5)\tshall include an MCPTT session identity mapped to the MCPTT session identity provided in the Contact header field of the received SIP 200 (OK) response;\n6)\tshall include the answer state into the P-Answer-State header field of the outgoing SIP 200 (OK) response, if received in the P-Answer-State header field of the incoming SIP 200 (OK) response;\n7)\tshall send the SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4];\n8)\tshall interact with Media Plane as specified in 3GPP TS 24.380 [5]; and\n10)\tshall start the SIP Session timer according to rules and procedures of IETF RFC 4028 [7].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response; and\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24], and shall not continue with the rest of the steps;\n2)\tshall check the presence of the isfocus media feature tag in the Contact header field and if it is not present then the participating MCPTT function shall reject the request with a SIP 403 (Forbidden) response with the warning text set to \"104 isfocus not assigned\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n3)\tif the Answer-Mode Indication in the application/poc-settings+xml MIME body has not yet been received from the invited MCPTT client as defined in clause 7.3.3 or clause 7.3.4, shall reject the request with a SIP 480 (Temporarily Unavailable) response with the warning text set to \"146 T-PF unable to determine the service settings for the called user\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n4)\tshall use the MCPTT ID present in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request to retrieve the binding between the MCPTT ID and public user identity;\n5)\tif the binding between the MCPTT ID and public user identity does not exist, then the participating MCPTT function shall reject the SIP INVITE request with a SIP 404 (Not Found) response. Otherwise, continue with the rest of the steps;\nNOTE:\tIf an <MKFC-GKTPs> element is received in a SIP INVITE request, the participating MCPTT function essentially ignores it and does not forward it, resulting in unicast media plane transmission being used for the terminating client.\n6)\tif the <allow-adhoc-group-call-participation> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to participate in adhoc group calls, shall reject the \"SIP INVITE request for terminating participating MCPTT function\" with a SIP 403 (Forbidden) response, with warning text set to \"188 user is not allowed to participate in adhoc group call\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n7)\tshall perform the automatic commencement procedures specified in clause 6.3.2.2.5.1 and according to IETF RFC 5373 [18] if the \"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"auto-answer\"; and\n8)\tshall perform the manual commencement procedures specified in clause 6.3.2.2.6.1 and according to IETF RFC 5373 [18] if the \"SIP INVITE request for terminating participating MCPTT function\" does not contain an Answer-Mode header field and the Answer-Mode Indication received in the application/poc-settings+xml MIME body received from the invited MCPTT client as per clause 7.3.3 or clause 7.3.4 is set to \"manual-answer\".\nUpon receipt of a \"SIP REFER request for a pre-established session\", with:\n1)\tthe Refer-To header field containing a Content-ID (\"cid\") Uniform Resource Locator (URL) as specified in IETF RFC 2392 [62] that:\na)\tpoints to an application/resource-lists+xml MIME body as specified in IETF RFC 5366 [20] containing one or more <entry> element(s) in the <list> element in the <resource-lists> element, where the <entry> element contains a \"uri\" attribute containing a SIP URI set to the MCPTT ID of the called user(s) or ;\nb)\tpoints to an MIME body section which conatins one or more MIME bodies and Content-Type header filed set to \"application/vnd.3gpp.mcptt-info+xml\" or set to \"multipart/mixed\";\n2)\tan hname \"body\" parameter in the headers portion of the SIP URI specified above containing an application/vnd.3gpp.mcptt-info MIME body with the <session-type> element set to \"adhoc\"; and\n3)\ta Content-ID header field set to the \"cid\" URL;\nthe participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP REFER request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and shall not continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP REFER request;\nNOTE 1:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tif through local policy in the participating MCPTT function, the user identified by the MCPTT ID is not authorised to initiate adhoc group calls, shall reject the \"SIP REFER request for pre-established session\" with a SIP 403 (Forbidden) response to the SIP REFER request, with warning text set to \"184 user not authorised to make adhoc group calls\" in a Warning header field as specified in clause 4.4;\n5)\tshall check if the number of maximum simultaneous MCPTT group calls supported for the MCPTT user as specified in the <MaxSimultaneousCallsN6> element of the <MCPTT-group-call> element of the MCPTT user profile document (see the MCPTT user profile document in 3GPP TS 24.484 [50]) has been exceeded. If exceeded, the participating MCPTT function shall respond with a SIP 486 (Busy Here) response with the warning text set to \"103 maximum simultaneous MCPTT group calls reached\" in a Warning header field as specified in clause 4.4. Otherwise, continue with the rest of the steps;\n6)\tshall determine the public service identity of the controlling MCPTT function for the adhoc group call service associated with the originating user's identity i.e. MCPTT ID;\nNOTE 2:\tThe public service identity can identify the controlling MCPTT function in the primary MCPTT system.\nNOTE 3:\tHow the participating MCPTT function determines the public service identity of the controlling MCPTT function for the adhoc group call service associated with the originating user is out of the scope of the present document.\n7)\tif the participating MCPTT function is unable to identify the controlling MCPTT function for the adhoc group call service associated with the originating user's MCPTT ID identity, it shall reject the SIP REFER request with a SIP 404 (Not Found) response with the warning text \"142 unable to determine the controlling function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n8)\tif the <allow-adhoc-group-call> element of the <ruleset> element is not present in the MCPTT user profile document on the participating MCPTT function or is present with the value \"false\" (see the MCPTT user profile document in 3GPP TS 24.484 [50]), indicating that the user identified by the MCPTT ID is not authorised to initiate adhoc group calls, shall reject the \"SIP REFER request for a pre-established session\" with a SIP 403 (Forbidden) response, with warning text set to \"185 user is not authorised to initiate the adhoc group call\" in a Warning header field as specified in clause 4.4, and shall not continue with the rest of the steps;\n9)\tif the \"SIP REFER request for a pre-established session\" contained a Refer-Sub header field containing \"false\" value and a Supported header field containing \"norefersub\" value, shall handle the SIP REFER request as specified in 3GPP TS 24.229 [4], IETF RFC 3515 [25] as updated by IETF RFC 6665 [26], and IETF RFC 4488 [22] without establishing an implicit subscription;\n10)\tshall generate a final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\" according to 3GPP TS 24.229 [4];\nNOTE 4:\tIn accordance with IETF RFC 4488 [22], the participating MCPTT function inserts the Refer-Sub header field containing the value \"false\" in the SIP 200 (OK) response to the SIP REFER request to indicate that it has not created an implicit subscription.\n11)\tshall wait for the receipt of a SIP response to the SIP INVITE request that will be generated and sent in subsequent steps;\n12)\tshall generate a SIP INVITE request as specified in clause 6.3.2.1.4 with the following clarifications:\na)\tif the <adhoc-grp-emg-alert-grp-ind> element of the <anyExt> element of <mcptt-Params> element of <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request set to a value of \"true\", shall copy the identity of adhoc group from the \"uri\" attribute of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body pointed to by the \"cid\" URL in the Refer-to header field of the SIP REFER request, to the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request and do not include application/resource-lists+xml MIME body;\nNOTE 5:\tThe MCPTT client can include either a list of MCPTT users or the criteria for determining the list of MCPTT users to be called. These two information elements are not included if the call setup request follows an adhoc group for emergency alerts.\n13)\tshall set the Request-URI to the public service identity of the controlling MCPTT function as determined in step 6;\n14)\tshall not copy the following header fields from the incoming SIP INVITE request to the outgoing SIP INVITE request, if they were present in the incoming SIP INVITE request:\na)\tAnswer-Mode header field as specified in IETF RFC 5373 [18]; and\nb)\tPriv-Answer-Mode header field as specified in IETF RFC 5373 [18];\n15)\tif the received SIP REFER request contained a Resource-Priority header field, shall include in the outgoing SIP INVITE request a Resource-Priority header field according to rules and procedures of 3GPP TS 24.229 [4] set to the value indicated in the Resource-Priority header field of the received SIP REFER request from the MCPTT client;\nNOTE 6:\tThe participating MCPTT function will leave verification of the Resource-Priority header field to the controlling MCPTT function.\n16) if, according to clause 6.4, the SIP REFER request is regarded as being received with an implicit request to grant the floor to the initiating MCPTT client:\nif:\na)\tthe incoming SIP REFER request contained an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP REFER request into the outgoing SIP INVITE request;\notherwise:\nif:\na)\tthe participating MCPTT function has available the location of the initiating MCPTT client; and\nb)\tthe <allow-location-info-when-talking> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the calling MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"true\";\nthen shall include an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element; and\n17)\tshall forward the SIP INVITE request according to 3GPP TS 24.229 [4].\nUpon receiving SIP provisional responses for the SIP INVITE request, the participating MCPTT function:\n1)\tshall discard the received SIP responses without forwarding them.\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the participating MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\n2)\tshall include the application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP 200 (OK) response into the generated final SIP 200 (OK) response to the \"SIP REFER request for a pre-established session\";\n3)\tshall send the generated final SIP 200 (OK) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4]; and\n2)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a \"SIP INVITE request for terminating participating MCPTT function\", the participating MCPTT function shall follow the procedures as specified in clause 17.3.2.1.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.3.3\tAdhoc group call release",
                            "text_content": "This clause describes the originating, and terminating call release participating MCPTT function procedures.\nUpon receiving from the MCPTT client a SIP BYE request the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.6.\nUpon receiving a SIP BYE request from the controlling MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.1.\nUpon receiving from the MCPTT client a SIP REFER request when using a pre-established session with the \"method\" SIP URI parameter set to value \"BYE\" in the URI in the Refer-To header field the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.1.7.\nUpon receiving a SIP BYE request from the controlling MCPTT function and if the MCPTT session id refers to an MCPTT user that has a pre-established session with the participating MCPTT function, the participating MCPTT function shall follow the procedures as specified in clause 6.3.2.2.8.2.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.3.4\tAdhoc group call rejoin",
                            "text_content": "This clause describes the originating, and terminating call rejoin participating MCPTT function procedures.\nUpon receipt of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"adhoc\", the participating MCPTT function shall follow the procedures specified in clause 17.3.2.1.1 with the clarification in step 10) of clause 17.3.2.1.1 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity which mapped to the MCPTT session identity provided in Request-URI of the \"SIP INVITE request for originating participating MCPTT function\".\nUpon receipt of a \"SIP REFER request for a pre-established session\", with the Refer-To header containing an application/vnd.3gpp.mcptt-info+xml MIME type content in an hname \"body\" parameter in the headers portion of the SIP URI and with the <session-type> element set to \"adhoc\", the participating MCPTT function shall follow the procedures specified in clause 17.3.2.2.1 with the clarification in step 13) of clause 17.3.2.2.1 that the Request-URI of the SIP INVITE request shall contain a URI of the MCPTT session identity which mapped to the MCPTT session identity provided in the Refer-To header field of the \"SIP REFER request for a pre-established session\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.3.5\tAdhoc group call participants modify",
                            "text_content": "This clause describes the originating adhoc group call participants modify participating MCPTT function procedures.\nUpon receipt of a SIP re-INVITE request for an MCPTT session identifying an on-demand MCPTT adhoc group session, the participating MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server Internal Error) response. The participating MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall determine the MCPTT ID of the calling user from public user identity in the P-Asserted-Identity header field of the SIP re-INVITE request;\nNOTE:\tThe MCPTT ID of the calling user is bound to the public user identity at the time of service authorisation, as documented in clause 7.3.\n3)\tif the participating MCPTT function cannot find a binding between the public user identity and an MCPTT ID or if the validity period of an existing binding has expired, then the participating MCPTT function shall reject the SIP re-INVITE request with a SIP 404 (Not Found) response with the warning text set to \"141 user unknown to the participating function\" in a Warning header field as specified in clause 4.4, and shall not continue with any of the remaining steps;\n4)\tshall validate the media parameters and if the MCPTT speech codec is not offered in the SIP re-INVITE request shall reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n5)\tshall generate an outgoing SIP re-INVITE request according to 3GPP TS 24.229 [4];\n6)\tshall copy the application/vnd.3gpp.mcptt-info+xml MIME body from the received SIP re-INVITE request into the outgoing SIP re-INVITE request;\n7)\tshall include the MCPTT ID of the originating user in <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the SIP re-INVITE request;\n8)\tshall include in the SIP re-INVITE request an SDP offer based on the SDP offer in the received SIP re-INVITE request as specified in clause 6.3.2.1.1;\n9)\tshall copy the application/resource-lists+xml MIME body from the received SIP re-INVITE request into the outgoing SIP re-INVITE request; and\n10)\tshall forward the SIP re-INVITE request according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 2xx response in response to the above SIP re-INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.2.1.5.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer as specified in the clause 6.3.2.1.2.1;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 200 (OK) response;\n4)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the participating MCPTT function; and\n5)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 403 (Forbidden) response to the above SIP re-INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP 403 (Forbidden) response according to 3GPP TS 24.229 [4];\n2)\tshall copy, if included in the received SIP 403 (Forbidden) response, the application/vnd.3gpp.mcptt-info+xml MIME body MIME body to the outgoing SIP 403 (Forbidden) response;\n3)\tshall include Warning header field(s) that were received in the incoming SIP 403 (Forbidden) response; and\n4)\tshall forward the SIP 403 (Forbidden) response to the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receipt of a SIP 4xx, 5xx or 6xx response to the above SIP re-INVITE request, the participating MCPTT function:\n1)\tshall generate a SIP response according to 3GPP TS 24.229 [4];\n2)\tshall include Warning header field(s) that were received in the incoming SIP response; and\n3)\tshall forward the SIP response to the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                },
                {
                    "title": "17.4\tControlling MCPTT function procedures",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "17.4.1\tGeneral",
                            "text_content": "This clause describes the adhoc group calls controlling MCPTT function procedures using on-demand and pre-established sessions to setup adhoc group calls, release the ongoing adhoc group calls, and modify the ongoing adhoc group calls participants.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.4.2\tAdhoc group call setup",
                            "text_content": "This clause describes the originating, and terminating call setup controlling MCPTT function procedures.\nThis clause describes the procedures for inviting an MCPTT user to an MCPTT session. The procedure is initiated by the controlling MCPTT function as the result of an action in clause 17.4.2.2 or as the result of receiving a SIP 403 (Forbidden) response as described in this clause.\nThe controlling MCPTT function:\n1)\tshall generate a SIP INVITE request as specified in clause 6.3.3.1.2;\n2)\tshall set the Request-URI to the public service identity of the terminating participating MCPTT function associated to the MCPTT user to be invited;\nNOTE 1:\tHow the controlling MCPTT function finds the address of the terminating MCPTT participating function is out of the scope of the present document..\n3)\tshall set the P-Asserted-Identity header field to the public service identity of the controlling MCPTT function;\n4)\tshall include in the application/vnd.3gpp.mcptt-info+xml MIME body in the outgoing SIP INVITE request with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-request-uri> element set to the MCPTT ID of the terminating user;\nb)\tthe <mcptt-calling-group-id> element set to the adhoc group identity as determined in the clause 17.4.2.2; and\nNOTE 2:\tThe <mcptt-calling-user-id> is already included in the MIME body as a result of calling clause 6.3.3.1.2 in step 1).\nc)\tif end-to-end security is requested for the call, the <anyExt> element with the <preconfigured-group-id> element set to the preconfigured group identity as determined in the clause 17.4.2.2;\n5)\tshall include in the SIP INVITE request an SDP offer based on the SDP offer in the received SIP INVITE request from the originating network according to the procedures specified in clause 6.3.3.1.1;\n6)\tshall copy the application/vnd.3gpp.mcptt-location-info+xml MIME body from the received SIP INVITE request into the outgoing SIP INVITE request; and\n7)\tshall send the SIP INVITE request towards the terminating network in accordance with 3GPP TS 24.229 [4].\nUpon receiving a SIP 183 (Session Progress) response containing a Require header field with the option tag \"100rel\" to the SIP INVITE request the controlling MCPTT function:\n1)\tshall send a SIP PRACK request towards the MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request the controlling MCPTT function:\n1)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3; and\n2)\tshall increment the local counter of the number of SIP 200 (OK) responses received from invited members, by 1.\nNOTE 4:\tThe procedures executed by the controlling MCPTT function prior to sending a response to the inviting MCPTT client are specified in clause 17.4.2.2.\nIn the procedures in this clause:\n1)\tMCPTT ID in an incoming SIP INVITE request refers to the MCPTT ID of the originating user from the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\tadhoc group identity in an incoming SIP INVITE request if included refers to the adhoc group identity from the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request; and\n3)\tMCPTT ID in an outgoing SIP INVITE request refers to the MCPTT ID of the called user in the <mcptt-request-uri> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the outgoing SIP INVITE request.\nUpon receipt of a \"SIP INVITE request for controlling MCPTT function of a MCPTT adhoc group call\", the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n3)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n4)\tif the originating user identified by the MCPTT ID is not authorised to initiate the adhoc group session if the <allow-adhoc-group-call> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the originating MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\", shall send a SIP 403 (Forbidden) response with the warning text set to: \"185 user is not authorised to initiate the adhoc group call\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n5)\tif the MCPTT service does not support the adhoc group call, if the <allow-adhoc-group-call-support> element of the <adhoc-group-call> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]) is set to a value of \"false\" or does not exists, shall send a SIP 403 (Forbidden) response with the warning text set to: \"186 the MCPTT system do not support adhoc group call\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n6)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT users to be called exists in the incoming SIP INVITE request, shall check if the number of invited participants is within the configured limit as specified in the <max-no-participants> element of the <adhoc-group-call> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]). If not within the configured limit, shall send a SIP 403 (Forbidden) response including warning text set to \"189 maximum number of allowed adhoc group participants exceeded\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\n7)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT users to be called exists in the incoming SIP INVITE request and the <call-participants-criterias> element with one or more criteria as a comma separated into <anyExt> element of <mcptt-Params> element of <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body in the SIP INVITE request exists, shall send a SIP 403 (Forbidden) response including warning text set to \"187 can't determine the adhoc group participants\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\n8)\tshall perform the actions as described in clause 6.3.3.2.2;\n9)\tshall maintain a local counter of the number of SIP 200 (OK) responses received from invited members and shall initialise this local counter to zero;\n10)\tshall create the adhoc group and generate the group identity to be associated with the adhoc group if the identity of adhoc group included in the <mcptt-request-uri> element of the <mcptt-Params> element of the <mcpttinfo> element containing in an application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP INVITE request is not acceptable or not included;\n11)\tif originating MCPTT user has requested for end-to-end security by including the <end-to-end-security> element in the <anyExt> element of the <mcptt-Params> element of the <mcpttinfo> element containing in an application/vnd.3gpp.mcptt-info+xml MIME body received in the SIP INVITE request with the value set to \"true\", shall determine the preconfigured group from which security related materials can be used by the adhoc group call participants to communicate securely in the adhoc group session;\n12)\tshall determine the members to invite to the adhoc group session:\ni)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the invited MCPTT users to be called exists in the incoming SIP INVITE request, shall consider the each entry of the MCPTT users to be invited to the adhoc group session; or\nii)\tif the application/vnd.3gpp.mcptt-info+xml MIME body with the criteria for determining the list of MCPTT users to be called exists in the incoming SIP INVITE request included in the <call-participants-criterias> element of the <anyExt> element of <mcptt-Params> element of <mcpttinfo> element of the application/vnd.3gpp.mcptt-info+xml MIME body, shall consider each of the MCPTT users meeting the specified criteria and also based on the local policy to be invited to the adhoc group session;\n13)\tshall create an adhoc group session and allocate an MCPTT session identity for the adhoc group call, and shall start timer TNG3 (group call timer) with the value obtained from the <max-duration-of-call> element of the <adhoc-group-call> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]). When the last MCPTT client leaves the MCPTT session, shall stop timer TNG3 and on expiry of timer TNG3, shall release the MCPTT session;\n14)\tif the received SIP INVITE request contains an application/vnd.3gpp.mcptt-location-info+xml MIME body with a <Report> element included in the <location-info> root element, the controlling MCPTT function can remember the location information contained in the <location-info> root element;\n15) shall invite each adhoc group member determined in step 15) above, to the adhoc group session, as specified in clause 17.4.2.1.1;\n16) shall consider all the invited members as implicitly affiliated to the adhoc group; and\n17) shall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3.\nUpon receiving a SIP 183 (Session Progress) response to the SIP INVITE request specified in clause 17.4.2.1.1 containing a P-Answer-State header field with the value \"Unconfirmed\" as specified in IETF RFC 4964 [34], the controlling MCPTT function supports media buffering and the SIP final response is not yet sent to the inviting MCPTT client:\n1)\tshall generate a SIP 200 (OK) response to SIP INVITE request as specified in the clause 6.3.3.2.3.2;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tshall include a P-Answer-State header field with the value \"Unconfirmed\";\n4)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE 1:\tResulting user plane processing is completed before the next step is performed.\n5)\tshall include the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-calling-group-id> element set to the adhoc group identity as determined in this clause; and\nb)\tif end-to-end security is requested for the call, the <anyExt> element with the <preconfigured-group-id> element set to the preconfigured group identity as determined in this clause; and\n6)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\nUpon receiving a SIP 200 (OK) response for the SIP INVITE request, and the SIP final response has not yet been sent to the inviting MCPTT client the controlling MCPTT function:\n1)\tshall generate a SIP 200 (OK) response to the SIP INVITE request as specified in the clause 6.3.3.2.3.2 before continuing with the rest of the steps;\n2)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n3)\tshall interact with the media plane as specified in 3GPP TS 24.380 [5];\nNOTE 2:\tResulting media plane processing is completed before the next step is performed.\n4)\tshall include the application/vnd.3gpp.mcptt-info+xml MIME body with the <mcpttinfo> element containing the <mcptt-Params> element with:\na)\tthe <mcptt-calling-group-id> element set to the adhoc group identity as determined in this clause; and\nb)\tif end-to-end security requested for the call, the <anyExt> element with the <preconfigured-group-id> element set to the preconfigured group identity as determined in this clause; and\n5)\tshall send a SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.4.3\tAdhoc group call release",
                            "text_content": "This clause describes the originating, and terminating call release controlling MCPTT function procedures.\nWhen the MCPTT session for group call needs to be released as specified in clause 6.3.8.1, the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5 with the clarifications given below for the clause 6.3.8.1 that:\n1)\tthe condition \"minimum number of affiliated MCPTT group members is not present\" is not applicable;\nWhen an MCPTT client needs to be removed from the MCPTT session (e.g. user no longer meeting the criteria), the controlling MCPTT function shall follow the procedures in clause 6.3.3.1.5.\nUpon receiving a SIP BYE request the controlling MCPTT function shall follow the procedures as specified in clause 6.3.3.2.4.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.4.4\tAdhoc group call rejoin",
                            "text_content": "This clause describes the originating, and terminating call rejoin controlling MCPTT function procedures.\nUpon receipt of a SIP INVITE request that includes an MCPTT session identity of an ongoing MCPTT session in the Request-URI the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24]. Otherwise, continue with the rest of the steps;\n2)\tshall reject the SIP request with a SIP 404 (Not Found) response if the MCPTT adhoc group call represented by the MCPTT session identity in Request-URI is not present;\n3)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not, reject the request with a SIP 488 (Not Acceptable Here) response. Otherwise, continue with the rest of the steps;\n4)\tshall reject the SIP request with a SIP 403 (Forbidden) response and not process the remaining steps if:\na)\tan Accept-Contact header field does not include the g.3gpp.mcptt media feature tag; or\nb)\tan Accept-Contact header field does not include the g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\";\n5)\tshall determine the MCPTT ID of the calling user;\n6)\tshall perform the actions on receipt of an initial SIP INVITE request as described in clause 6.3.3.2.2;\n7)\tif the user identified by the MCPTT ID is no longer meeting the criteria if the adhoc group participants are determined using criteria while establishing adhoc group call, shall return a SIP 403 (Forbidden) response with the warning text set to \"188 user is not allowed to participate in adhoc group call\" in a Warning header field as specified in clause 4.4;\n8)\tif the user identified by the MCPTT ID is not affiliated to the MCPTT adhoc group ID associated with the MCPTT session identity as specified in clause 6.3.6, shall return a SIP 403 (Forbidden) response with the warning text set to \"120 user is not affiliated to this group\" in a Warning header field as specified in clause 4.4;\n9)\tshall generate a SIP 200 (OK) response as specified in the clause 6.3.3.2.3.2;\n10)\tshall include in the SIP 200 (OK) response an SDP answer to the SDP offer in the incoming SIP INVITE request as specified in the clause 6.3.3.2.1;\n11)\tshall interact with media plane as specified in 3GPP TS 24.380 [5] clause 6.3;\nNOTE :\tResulting media plane processing is completed before the next step is performed.\n12)\tshall send the SIP 200 (OK) response towards the inviting MCPTT client according to 3GPP TS 24.229 [4];\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "17.4.5\tAdhoc group call participants modify",
                            "text_content": "This clause describes the terminating adhoc group call participants modify controlling MCPTT function procedures.\nIn the procedures in this clause:\n1)\tMCPTT ID in an incoming SIP re-INVITE request refers to the MCPTT ID of the originating user from the <mcptt-calling-user-id> element of the application/vnd.3gpp.mcptt-info+xml MIME body of the incoming SIP INVITE request;\n2)\tMCPTT ID in an incoming SIP re-INVITE request refers to the MCPTT ID of the MCPTT user to be invited to a call from the \"uri\" attribute with the \"method\" SIP URI parameter set to the value \"INVITE\" of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body of the incoming SIP re-INVITE request; and\n3)\tMCPTT ID in an incoming SIP re-INVITE request refers to the MCPTT ID of the MCPTT user to be removed from a call from the \"uri\" attribute with the \"method\" SIP URI parameter set to the value \"BYE\" of the <entry> element of a <list> element of the <resource-lists> element of the application/resource-lists+xml MIME body of the incoming SIP re-INVITE request.\nUpon receipt of a SIP re-INVITE request for an MCPTT session identifying an on-demand MCPTT adhoc group session, the controlling MCPTT function:\n1)\tif unable to process the request due to a lack of resources or a risk of congestion exists, may reject the SIP re-INVITE request with a SIP 500 (Server Internal Error) response. The controlling MCPTT function may include a Retry-After header field to the SIP 500 (Server Internal Error) response as specified in IETF RFC 3261 [24] and skip the rest of the steps;\n2)\tshall determine if the media parameters are acceptable and the MCPTT speech codec is offered in the SDP offer and if not reject the request with a SIP 488 (Not Acceptable Here) response and skip the rest of the steps;\n3)\tif the originating user identified by the MCPTT ID is not authorised to modify the adhoc group session participants if the <allow-adhoc-group-call-modify> element of the <actions> element of a <rule> element of the <ruleset> element of the MCPTT user profile document identified by the MCPTT ID of the originating MCPTT user (see the MCPTT user profile document in 3GPP TS 24.484 [50]) is set to a value of \"false\", shall send a SIP 403 (Forbidden) response with the warning text set to: \"190 user is not authorised to initiate modify adhoc group call participants\" in a Warning header field as specified in clause 4.4 and skip the rest of the steps below;\n4)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the MCPTT users to be invited to a call or the MCPTT ID of the MCPTT users to be removed from a call exists in the incoming SIP re-INVITE request, shall check if the number of existing call participants and newly inviting MCPTT users is within the configured limit as specified in the <max-no-participants> element of the <adhoc-group-call> element of the <anyExt> element contained in the <OnNetwork> element of the MCPTT service configuration document (see the service configuration document in 3GPP TS 24.484 [50]). If not within the configured limit, shall send a SIP 403 (Forbidden) response including warning text set to \"189 maximum number of allowed adhoc group participants exceeded\" in a Warning header field as specified in clause 4.4 and shall skip the rest of the steps;\n5)\tshall determine the members to invite to the adhoc group session or remove from the adhoc group session based on the local policy and:\na)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the MCPTT users to be invited to a call exists in the incoming SIP re-INVITE request, shall consider each entry of the MCPTT users to be invited to the adhoc group session; or\nb)\tif the application/resource-lists+xml MIME body with the MCPTT ID of the MCPTT user to be removed from a call exists in the incoming SIP re-INVITE request, shall consider the each entry of the MCPTT users to be removed from the adhoc group session;\n6)\tif the determined members in step 6) above are to be invited to the adhoc group session, shall be invited to the adhoc group session, as specified in clause 17.4.2.1.1;\n7)\tif the determined members in step 6) above are to be removed from the adhoc group session, shall be removed from the adhoc group session, as specified in clause 17.4.3.1;\n8)\tshall consider all the invited members as implicitly affiliated to the adhoc group and remove the affiliation of the user who are removed from the adhoc group session;\n9)\tshall generate a SIP 200 (OK) response according to rules and procedures of 3GPP TS 24.229 [4];\n10)\tshall include in the SIP 200 (OK) response an SDP answer according to 3GPP TS 24.229 [4] with the clarifications specified in clause 6.3.3.2.1;\n11)\tshall include the \"norefersub\" option tag in a Supported header field according to IETF RFC 4488 [22];\n12)\tshall include the \"tdialog\" option tag in a Supported header field according to IETF RFC 4538 [23];\n13)\tshall include a P-Asserted-Identity header field in the outgoing SIP 200 (OK) response set to the public service identity of the controlling MCPTT function;\n14)\tshall include the following in the Contact header field:\na)\tthe g.3gpp.mcptt media feature tag;\nb)\tthe g.3gpp.icsi-ref media feature tag containing the value of \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"; and\nc)\tthe isfocus media feature tag; and\n15)\tshall send the SIP 200 (OK) response towards the MCPTT client according to 3GPP TS 24.229 [4].\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "A.0\tGeneral",
            "description": "The flows in this Annex are only for the purposes of illustration and are not guaranteed to be up-to-date.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "A.1\tGroup regrouping flow",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "A.1.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes how a temporary group call as the result of a group regroup operation is established.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.2\tUse case description",
                    "description": "",
                    "summary": "",
                    "text_content": "The police and a private security company cooperate during a fair. A temporary prearranged group is created as specified in TS 24.481 [31] to allow the policemen and security personal to communicate.\nThe temporary group consists of two groups of policemen and a group of security personal from the private security company. One of the groups of policemen is called in from another town. A dispatcher from the police creates the temporary group. The dispatcher is added to the group of policemen hosted by the controlling MCPTT function A.\nTable A.1.2-1 shows the group coding details.\nTable A.1.2-1:\tGroup coding details\n\nFor readability reasons all prearranged groups have only one member. Table A.1.2-1 shows the group member coding details.\nTable A.1.2-2:\tGroup member coding details\n\nEach MCPTT user is served by a different MCPTT function. Table A.1.2-3 shows the Participating MCPTT functions coding details.\nTable A.1.2-3:\tParticipating MCPTT functions coding details\n\nEach group is hosted by a different MCPTT server. Table A.1.2-4 shows the Controlling and non-controlling MCPTT functions coding details.\nTable A.1.2-4:\tControlling and non-controlling MCPTT functions coding details\n\n",
                    "tables": [
                        {
                            "description": "Table A.1.2-1:\tGroup coding details",
                            "table number": 56,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.1.2-2:\tGroup member coding details",
                            "table number": 57,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.1.2-3:\tParticipating MCPTT functions coding details",
                            "table number": 58,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "Table A.1.2-4:\tControlling and non-controlling MCPTT functions coding details",
                            "table number": 59,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "A.1.3\tSignalling flow",
                    "description": "",
                    "summary": "",
                    "text_content": "The temporary group consists of a group A1 (police), group A2 (police in other town) and a group B (security company in a partner system).\nFor the mcptt-id-B@mcptt-city1.net the controlling MCPTT function is using the connection model in figure 5.3.2-5.\nFor the mcptt-id-A3@mcptt-op.gov the controlling MCPTT function is using the connection model in figure 5.3.2-2.\nPreconditions:\n1)\tthe temporary group mcptt-group-A-B is already created and all members are affiliated to the group;\n2)\tthis is not an emergency or imminent peril call;\n3)\tMCPTT client A2 has a pre-established session and the MCPTT services setting for the commencement mode is auto-answer;\n4)\tMCPTT client A3 has no pre-established session and the MCPTT services setting for the commencement mode is manual-answer;\n5)\tMCPTT client has no pre-established session and the MCPTT services setting for queueing the commencement mode is auto-answer;\n6)\tthe IMS service provider (ims-op.net) is the same for all groups;\n7)\tthe flow does not consider confidentiality and integrity protection; and\n8)\tnon-controlling model used between the Primary and the partner is the \"untrusted\" model.\nFigure A.1.3-1 shows the signalling flow when the controlling MCPTT function invites the prearranged groups consisting in the temporary group.\nThe figure depicts a temporary prearranged group call setup, with participants arranged in a line, each with a designated phone number. The setup is temporary, as the participants are not connected to the network.\nFigure A.1.3-1: Temporary prearranged group call setup\nThe steps of the flow are as follows:\nNOTE 1:\tThe parameters in the coding parts are only those specified in the normative part of the present document. For information about other parameters, see 3GPP TS 24.229 [4].\n1)\tSIP INVITE request (MCPTT client A1 to participating MCPTT function A1) - see example in table A.1.3-1\nUpon receiving a request from an MCPTT user A1 to establish an MCPTT temporary group session the MCPTT client A1 sends a SIP INVITE request towards the participating MCPTT function A1 according to 3GPP TS 24.229 [4].\nTable A.1.3-1: SIP INVITE request (MCPTT client A1 to participating MCPTT function A1)\nINVITE sip: pf-A1.ims-op.net SIP/2.0\nAccept-Contact: *;+g.3gpp.mcptt;require;explicit,+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt;require;explicit\nP-Preferred-Service:urn:urn-7:3gpp-service.ims.icsi.mcptt\nSupported: timer\nSession-Expires: 3600;refresher=uac\nContact: <sip:[5555::aaa:bbb:ccc:eee]>;g.3gpp.mcptt;g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Preferred-Identity:<sip:userA1@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ccc:eee\nm=audio 3456 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=maxptime:20\ni=speech\nm=application 3457 udp mcptt\na=fmtp:MCPTT mc_queueing;mc_implicit_request\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1—\n\nRequest-URI:\tContains the public service identity of the participating MCPTT function serving the MCPTT user.\nAccept-Contact:\tContains the g.3gpp.mcptt feature tag.\nP-Preferred-Service:\tContains the ICSI for MCPTT.\nContact:\tContains the registered contact and the g.3gpp.mcptt feature tag.\nP-preferred-Identity:\tContains the public user identity of the MCPTT user.\nmcptt-info:\tThe application/vnd.3gpp.mcptt-info+xml contains the <mcptt-Params> element with the <session-type> element set to \"prearranged\" and the <mcptt-request-uri> element set to \"mcptt-group-T@mcptt-op.gov\".\nSDP offer:\tContains a media-level section for the MCPTT speech media stream and a media-level section for the media-floor control entity indicating that  of floor requests is supported (\"mc:queueing\") and that the SIP INVITE request is an implicit floor request (\"mc_implicit_request\").\n2)\tSIP INVITE request (participating MCPTT function A1 to controlling MCPTT function A) - see example in table A.1.3-2\nUpon receiving of a \"SIP INVITE request for originating participating MCPTT function\" containing an application/vnd.3gpp.mcptt-info+xml MIME body with the <session-type> element set to a value of \"prearranged\", the participating MCPTT function authorizes the MCPTT user to initiate the prearranged group call and since the MCPTT user is authorized, the participating MCPTT function A1 forwards the SIP INVITE request according to 3GPP TS 24.229 [4].\nTable A.1.3-2: SIP INVITE request (participating MCPTT function A to controlling MCPTT function A)\nINVITE sip: cf-A.ims-op.net SIP/2.0\nAccept-Contact:\nP-Asserted-Service:\nSupported:\nSession-Expires:\nContact:\nP-Asserted-Identity:<sip:userA1@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ccc:eef\nm=audio 7890 RTP/AVP 97\na=\na=\ni=\nm=application 7891 udp mcptt\na=\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-group-T@mcptt-city1.gov</>\n<mcptt-calling-user-id>mcptt-id-A1@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nRequest-URI:\tUpdated to include the public service identifier of the MCPTT server owning the mcptt-group-T@mcptt-city1.gov.\nmcptt-info:\tThe application/vnd.3gpp.mcptt-info+xml is updated to include the MCPTT ID of the MCPTT user in the <mcptt-calling-user-id> element. The participating MCPTT function A1 determines the MCPTT-ID using the public user identity to locate the binding formed during service authorisation.\nSDP offer:\tThe SDP offer is updated to include the IP address and port numbers of the participating MCPTT function.\n3)\tHTTP GET request (controlling MCPTT function A to GMS A)\nUpon receipt of the \"SIP INVITE request for controlling MCPTT function of an MCPTT group\" the controlling MCPTT functions fetches the group document mcptt-group-T@mcptt-op.gov from the GMS A.\n4)\tHTTP 200 response (GMS A to controlling MCPTT function A)\nThe GMS A returns the mcptt-group-T@mcptt-op.gov group document and the document indicates that this is a temporary group consisting of mcptt-group-A1@mcptt-op.gov, mcptt-group-B@mcptt-city1.net and mcptt-group-A2@mcptt-op.gov.\n5)\tHTTP GET request (controlling MCPTT function A to GMS A)\nSince the mcptt-id-A1@mcptt-op.gov is affiliated to the mcptt-group-A1@mcptt-op.gov the controlling MCPTT function fetches the group document from GMS A by means of a HTPP GET request as described in 3GPP TS 24.481 [31].\n6)\tHTTP 200 response (GMS A to controlling MCPTT function B)\nThe GMS A returns the mcptt-group-A1@mcptt-op.gov group document with the list of group members in a HTTP 200 response as described in 3GPP TS 24.481 [31].\nThe controlling MCPTT function verifies that the mcptt-id-A1@mcptt-op.gov is authorized to initiate a prearranged group call.\nThe following steps describe the invitation of the group member mcptt-id-A@mcptt-op.gov using a pre-established session between the participating MCPTT function A2 and MCPTT client A2. Other members can be invited using the same method or using on-demand session signalling.\n7)\tSIP INVITE request (controlling MCPTT function A to participating MCPTT function A2) - see example in table A.1.3-7\nThe controlling MCPTT function sends an initial SIP INVITE request towards the participating MCPTT function A2 according to 3GPP TS 24.229 [4].\nTable A.1.3-7: SIP INVITE request (controlling MCPTT function A to participating MCPTT function A2)\nINVITE sip: pf-A2.ims-op.net SIP/2.0\nAccept-Contact: *;+g.3gpp.mcptt;require;explicit,+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt;require;explicit\nP-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mcptt\nSupported:timer\nSession-Expires:3600\nContact: <sip:session@cf-A@ims-op.net:66350>;g.3gpp.mcptt;isfocus;g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Asserted-Identity:<sip:cf-a@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:aaa\nm=audio 23124 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=maxptime:20\ni=speech\nm=application 23125 udp mcptt\na=fmtp:MCPTT mc_queueing;\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-id-A2@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n<mcptt-calling-user-id>userA1@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nRequest-URI:\tContains the public service identity of the participating MCPTT function A2 associated to the MCPTT user mcptt-id-A2@mcptt-op.gov.\nContact:\tContains the MCPTT session identity.\nP-Asserted-Identity:\tContains the public service identity of the controlling MCPTT function A.\nmcptt-info\tIs copied from the received INVITE request and updated to include the \"mcptt-id-A2@mcptt-op.gov\" in the <mcptt-request-uri> element and mcptt-group-T@mcptt-op.gov in the <mcptt-calling-group-id> element.\nSDP offer:\tThe SDP offer is based on the received SDP offer where the IP address and port numbers are replaced with the IP address and port numbers of the controlling MCPTT function. The media-level section for the media-floor control entity is indicating that queueing of floor requests is supported (\"mc:queueing\").\n8)\tSIP 200 (OK) response (participating MCPTT function A2 to controlling MCPTT function A) - see example in table A.1.3-8\nThe participating MCPTT function detects that there is a pre-established session to the MCPTT client A2 where negotiated MCPTT speech media stream parameters and media-floor control entity 'fmtp' attributes matches the incoming SIP INVITE request and that the MCPTT service setting for commencement mode is set to \"auto-answer\".\nThe participating MCPTT function A2 sends a SIP 200 (OK) response to the controlling MCPTT function A according to 3GPP TS 24.229 [4].\nTable A.1.3-8: SIP 200 (OK) response (participating MCPTT function A2 to controlling MCPTT function A)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uac\nRequire: timer\nP-Asserted-Identity:<sip:userA2@ims-op.net>\nContact: <sip:[5555::aaa:ccc:aaa:bbbb]>; g.3gpp.mcptt;\nSupported: tdialog, norefersub, explicitsub, nosub\nP-Answer-State:Unconfirmed\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:ccc:aaa:bbbb\nm=audio 26456 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=maxptime:20\ni=speech\nm=application 26457 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-called-party-id>mcptt-id-A2@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1—\n\nP-Asserted-Identity:\tContains a public user identity of the sip: userA2@ims-op.net.\nContact:\tContains a URI that identifies the session in the participating MCPTT function A2.\nP-Answer-State:\tContains the value \"Unconfirmed\" to indicate that the participating MCPTT function A2 sent this on behalf of the MCPTT A2.\nSDP answer:\tThe SDP answer is based on the received SDP offer and is updated to IP address and port numbers of the participating MCPTT function A2. The media-floor control entity 'fmtp' attributes includes the \"mc_queueing\" to indicate that queueing is supported.\n9)\tSIP ACK request (controlling MCPTT function A to participating MCPTT function A2)\nThe controlling MCPTT function A acknowledge the SIP 200 (OK) response by means of the SIP ACK request.\n10)\tMCPC Connect message (participating MCPTT function to MCPTT client B)\nSince the MCPTT client B has a pre-established session the participating MCPTT function B uses the pre-established session to invite the MCPTT client B by means of a MCPC Connect messages as described in 3GPP TS 24.380 [5] annex A.\n11)\tMCPC Acknowledgement message (MCPTT client B to participating MCPTT B)\nThe MCPTT client B acceptes the invitation and sends an MCPC Acknowledge message as as described in 3GPP TS 24.380 [5] annex A.\n12)\tSIP 200 (OK) response (controlling MCPTT function A to participating MCPTT function A1) - see example in table A.1.3-12\nUpon receiving the SIP 200 (OK) response from the participating MCPTT function A2, the controlling MCPTT function A interacts with the media plane as specified in 3GPP TS 24.380 [5] clause 6.3 and sends the SIP 200 (OK) towards the participating MCPTT function A1 according to 3GPP TS 24.229 [4].\nNOTE 2:\tWhen more than one MCPTT user is invited (not done in this example) then when receiving additional SIP 200 (OK) responses from other participating MCPTT functions, the controlling MCPTT function sends the SIP ACK request towards the other participating MCPTT functions and interacts with the media plane as specified in clause 6.3 i.e. there is no SIP signalling sent towards the MCPTT client A1.\nNOTE 3:\tIf there more than one user in the group, the 200 (OK) response is not sent if the acknowledged timeout value for the group is running if some members of the group are marked as <on-network-required> as specified in 3GPP TS 24.481 [31], and responses are not received from those members.\nTable A.1.3-12: SIP 200 (OK) response (controlling MCPTT function A to participating MCPTT function A1)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uac\nRequire: timer\nP-Asserted-Identity:<sip:cf-A.ims-op.net>\nContact: <sip:[5555::aaa:bbb:ddd:bbbb]>; +g.3gpp.mcptt;+g.3gpp.icsi-ref; isfocus\nSupported: tdialog, norefersub, explicitsub, nosub\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:bbbb\nm=audio 23124 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=maxptime:20\ni=speech\nm=application 23125 udp mcptt\na=fmtp:MCPTT mc_queueing;mc_implicit_request\n\nP-Asserted-Identity:\tContains the public user identifier identifying the controlling MCPTT function.\nContact:\tContains the MCPTT session identifier and the g.3gpp.icsi-ref and isfocus media feature tags.\nSDP answer:\tContains the SDP answer to the SDP offer received from the participating MCPTT function A2 updated with the IP address and port numbers of the controlling MCPTT function. The media-level section for the media-floor control entity acknowledges that queueing is supported (\"mc_queueing\") and that the SIP INVITE request is accepted as an implicit floor request.\n13)\tSIP 200 (OK) response (participating MCPTT function A to MCPTT client A) - see example in table A.1.3-13\nThe participating MCPTT function A1 interacts with the media plane as specified in 3GPP TS 24.380 [5] clause 6.4 and sends the SIP 200 (OK) response towards the MCPTT client A1.\nTable A.1.3-13: SIP 200 (OK) response (participating MCPTT function A to MCPTT client A1)\nSIP/2.0 200 OK\nSession-Expires:\nRequire:\nP-Asserted-Identity:\nContact:\nResouce-Share: media-sharing; session-initiator; rules=\"k1::UL\"; timestamp=55688\nPriority-Share:allowed\nSupported: tdialog\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:ccc:aaa:bbb\nm=audio 7890 RTP/AVP 97\na=\na=\na=\nm=application 7891 udp mcptt\na=\n\nResource-Share:\tContains a new sharing key along with indication that MCPTT speech media can be shared in the uplink (UL) direction. The value \"k1\" is the key that P-CSCF can use to identify media streams towards MCPTT client A1 that can share media.\nPriority-Share:\tThe Priority-Share header field is set to \"allowed\" indicating that priority sharing can be applied by IMS.\nSDP answer:\tContains the SDP answer received from the controlling MCPTT function updated with the IP address and port numbers of the participating MCPTT function.\n14)-15)\tSIP ACK request (MCPTT client A1 to controlling MCPTT function A via participating MCPTT function A1)\nThe MCPTT client A1 acknowledges the receipt of the SIP 200 (OK) response by means of a SIP ACK request. The ACK request is forwarded by the participating MCPTT function A1 to the controlling MCPTT function A.\n16)\tSIP INVITE request (controlling MCPTT function A to non-Controlling MCPTT function C) - see example in table A.1.3-16\nSince the GMS storing the group document of the \"mcptt-group-B@mcptt-city1.net\" is not available to the controlling MCPTT function A, the controlling MCPTT function A decides to use the non-controlling MCPTT function connectivity model (see figure 5.3.2-5) and sends a SIP INVITE request towards the MCPTT server hosting \"mcptt-group-B@mcptt-city1.net\" according to 3GPP TS 24.229 [4].\nTable A.1.3-16: SIP INVITE request (controlling MCPTT function A to non-Controlling MCPTT function B)\nINVITE sip:cf-B.ims-op.net SIP/2.0\nAccept-Contact: *;+g.3gpp.mcptt;require;explicit,+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt;require;explicit\nP-Asserted-Service:urn:urn-7:3gpp-service.ims.icsi.mcptt\nSupported:timer\nSession-Expires:3600\nContact: <sip:session@cf-A@ims-op.net:66350>;g.3gpp.mcptt;isfocus;g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Asserted-Identity:<sip:cf-a@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:aaa\nm=audio 23124 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=maxptime:20\ni=speech\nm=application 23125 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-group-B@mcptt-city1.net</>\n<mcptt-calling-user-id>userA1@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nRequest-URI:\tContains the public service identity of the MCPTT server hosting the \"mcptt-group-B@mcptt-city1.net\".\nContact:\tContains the MCPTT session identity.\nmcptt-info:\tIs copied from the received INVITE request and updated to include the \"mcptt-group-B@mcptt-city1.net\" in the <mcptt-request-uri> element and mcptt-group-T@mcptt-op.gov in the <mcptt-calling-group-id> element.\nSDP offer:\tIs based on the received SDP offer where the IP address and port numbers are replaced with the IP address and port numbers of the controlling MCPTT function. The media-level section for the media-floor control entity is indicating that queueing is supported (\"mc:queueing\").\n17)\tHTTP GET request (controlling MCPTT function A to GMS B)\nSince mcptt-group-B@mcptt-city1.net is hosted by the non-controlling MCPTT function B the group document is fetched from GMS B.\nThe group document are fetched by means of a HTPP GET request as described in 3GPP TS 24.481 [31].\n18)\tHTTP 200 response (GMS B to controlling MCPTT function B)\nThe GMS B returns the mcptt-group-B@mcptt-city1.net group document with the list of group members in a HTTP 200 response as described in 3GPP TS 24.481 [31].\nThe following steps describes the invitation of one group member, mcptt-id-B@mcptt-city1.net, using an on-demand session between the participating MCPTT function B and MCPTT client B. Other members can be invited using the same method or using pre-established session.\n19)\tSIP INVITE request (non-controlling MCPTT function B to participating MCPTT function B) - see example in table A.1.3-19\nThe non-controlling MCPTT function B invites the MCPTT user \"mcptt-id-B@mcptt-city1.net\" to the session by sending and SIP INVITE request towards the terminating network in accordance with 3GPP TS 24.229 [4].\nTable A.1.3-19: SIP INVITE request (non-Controlling MCPTT function B to participating MCPTT function B)\nINVITE sip: pf-B.ims-op.net SIP/2.0\nAccept-Contact:\nP-Asserted-Service:\nSupported:\nSession-Expires:\nContact: <sip:sessionB@cf-B@ims-op.net:45678>;g.3gpp.mcptt; isfocus; g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Asserted-Identity:<sip:cf-b@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:ddd\nm=audio 34456 RTP/AVP 97\na=\na=\na=\ni=\nm=application 34457 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-id-B@mcptt-city1.net</>\n<mcptt-calling-user-id>mcptt-id-A@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nContact:\tContains a new MCPTT session identity and can be used by the members to rejoin the session.\nNOTE 4:\tThe MCPTT session identity received from the controlling MCPTT function A cannot be used since when a member of group mcptt-group-B@mcptt-city1.net rejoins the session, the member shall rejoin the session in the non-controlling MCPTT function B and not the session in the controlling MCPTT function A.\nP-Asserted-Identity:\tContains the public service identity of the non-controlling MCPTT function B.\nmcptt-info:\tThe identity of the invited MCPTT user mcptt-id-B@mcptt-city1.net is added.\nSDP offer:\tThe SDP offer is a copy of the received SDP offer updated with the IP address and port numbers of the non-controlling MCPTT function B.\n20)\tSIP 183 (Session Progress) response (participating MCPTT function B to non-Controlling MCPTT function B) - see example in table A.1.3-20\nThe participating MCPTT function B sends a SIP 183 (Session Progress) response towards the non-controlling MCPTT function B according to 3GPP TS 24.229 [4].\nTable A.1.3-20: SIP 183 (Session Progress) response (participating MCPTT function B non-Controlling MCPTT function B)\nSIP/2.0 183 Session Progress\nP-Asserted-Identity:\nContact: <sip:[5555::aaa:bbb:ccc:eef]>;+g.3gpp.mcptt;,+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Answer-State:Unconfirmed\n\nP-Answer-State:\tContains the \"Unconfirmed\" indication acknowledging the automatic commencement mode.\n21)\tSIP INVITE request (participating MCPTT function B to MCPTT client B) - see example in table A.1.3-21\nThe participating MCPTT function B sends the SIP INVITE request towards the MCPTT client B according to 3GPP TS 24.229 [4].\nTable A.1.3-21: SIP INVITE request (participating MCPTT function B to MCPTT client B)\nINVITE sip: userB@ims-op.net SIP/2.0\nAccept-Contact:\nP-Asserted-Service:\nSupported:timer;tdialog\nSession-Expires:refresher;uac\nContact:\nResouce-Share: media-sharing; session-receiver; rules=\"k2::UL\"; timestamp=55750\nPriority-Share:allowed\nP-Asserted-Identity:<sip:cf-b@ims-op.net>\nAnswer-Mode:Auto\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ccc:eef\nm=audio 16412 RTP/AVP 97\na=\na=\na=\ni=\nm=application 16413 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-id-B@mcptt-city1.net</>\n<mcptt-calling-user-id>userA1@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nRequest-URI:\tContains the public user identity of the mcptt-id-B@mcptt-city1.net.\nResource-Share:\tContains a new sharing key along with indication that MCPTT speech media can be shared in the uplink (UL) direction. The value \"k2\" is the key that P-CSCF can use to identify media streams towards MCPTT client A2 that can share media.\nPriority-Share:\tThe Priority-Share header field is set to \"allowed\" indicating that priority sharing can be applied by IMS.\nAnswer-Mode:\tThe MCPTT service setting is \"auto-answer\" so the participating MCPTT function includes the value \"auto\" in the Answer-Mode header field.\nSDP offer:\tThe SDP offer is a copy of the received SDP offer updated with the IP address and port numbers of the participating MCPTT function B.\n22)\tSIP 200 (OK) response (non-controlling MCPTT function B to controlling MCPTT function A) - see example in table A.1.3-22\nUpon receipt of the first SIP 200 (OK) response from the participating MCPTT function B serving the invited MCPTT user B in the prearranged group mcptt-group-C@mcptt-city1.net, the non-controlling MCPTT function interact with the media plane as specified in 3GPP TS 24.380 [5] and sends the SIP 200 (OK) response towards the controlling MCPTT function A in accordance with 3GPP TS 24.229 [4].\nNOTE 6:\tThe non-controlling function translates the SIP 183 (Session Progress) response with a P-Answer-State header field set to \"Auto\" to a SIP 200 (OK) response only if the non-controlling function supports media-buffering otherwise a SIP 183 (Session Progress) response is sent.\nTable A.1.3-22: SIP 200 (OK) response (non-controlling MCPTT function B to controlling MCPTT function A)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uac\nRequire: timer\nP-Asserted-Identity:<sip:cf-B.op.net>\nContact: <sip:[5555::aaa:bbb:ddd:ddd]>; g.3gpp.mcptt;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nSupported: tdialog, norefersub, explicitsub, nosub\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:ddd\nm=audio 34456 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=maxptime:20\ni=speech\nm=application 34457 udp mcptt\na=fmtp:MCPTT mc_queueing\n\nP-Asserted-Identity\tContains a public service identity identifying the non-controlling MCPTT function B.\nContact\tContains a contact address and the media feature tags g.3gpp.mcptt and g.3gpp.icsi-ref.\nSDP\tContains the SDP answer to the SDP offer received from the controlling MCPTT function A. The media-level section for the media-floor control entity acknowledges that queueing is supported (\"mc_queueing\").\nNOTE 5:\tThe SDP answer is based on the capabilities of the non-controlling MCPTT function and not based on the SIP 200 (OK) response received from the participating MCPTT function.\n23)\tSIP ACK request (controlling MCPTT function A to MCPTT client B via non-controlling MCPTT function B and participating MCPTT function B)\nThe controlling MCPTT function acknowledges the receipt of the SIP 200 (OK) response by means of a SIP ACK request.\n24)-25)\tSIP 200 (OK) response (MCPTT client B to non-controlling MCPTT function B via participating MCPTT function B) - see example in table A.1.3-24\nUpon receiving the SIP INVITE request the MCPTT client B accepts the invitation, interacts with the media plane as specified in 3GPP TS 24.380 clause 6.2 and sends the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nTable A.1.3-24: SIP 200 (OK) response (MCPTT client B to non-controlling MCPTT function B via participating MCPTT function B)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uas\nRequire: timer\nContact:<sip:[5555::baa:abb:ddd:cccc]>;+g.3gpp.mcptt;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\"\nP-Asserted-Identity:<sip:userB@ims-op.net>\nSupported: tdialog, norefersub, explicitsub, nosub\nP-Answer-State:Confirmed\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::baa:abb:ddd:cccc\nm=audio 62122 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=maxptime:20\ni=speech\nm=application 62123 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-called-party-id>mcptt-id-B@mcptt-city1.net</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1—\n\nContact:\tContains the registered contact and the g.3gpp.mcptt feature tag.\nP-Answer-State:\tContains the value \"Confirmed\" to indicate that the MCPTT client B sent the response.\nSDP answer:\tThe received SDP offer is accepted and updated with the IP address and port numbers of the MCPTT client B. The MCPTT client B confirms that queueing of floor requests are supported in the 'fmtp' attribute \"mc_queueing\".\n\nThe participating MCPTT function B updates the IP address and port numbers with the IP address and port numbers of the participating MCPTT function B.\n26)-27)\tSIP ACK request (non-controlling MCPTT function B to MCPTT client B via participating MCPTT function B)\nThe non-controlling MCPTT function acknowledges the receipt of the SIP 200 (OK) response by means of a SIP ACK request.\n28)\tSIP INVITE request (controlling MCPTT function A to non-controlling MCPTT function A) – see example in table A.1.3-28\nSince the GMS storing the group document of the \"mcptt-group-A2@mcptt-op.gov\" is not available to the controlling MCPTT function A, the controlling MCPTT function A decides to use the non-controlling MCPTT function connectivity model (see figure 5.3.2-2) and sends a SIP INVITE request towards the MCPTT server hosting \"mcptt-group-A2@mcptt-op.gov\" in accordance with 3GPP TS 24.229 [4].\nTable A.1.3-28: SIP INVITE request (controlling MCPTT function A to non-Controlling MCPTT function A)\nINVITE sip: cf-A2.ims-op.net SIP/2.0\nAccept-Contact: *;+g.3gpp.mcptt;require;explicit,+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt;require;explicit\nP-Asserted-Service:urn:urn-7:3gpp-service.ims.icsi.mcptt\nSupported:timer\nSession-Expires:3600\nContact: <sip:session@cf-A@ims-op.net:66350>;g.3gpp.mcptt;isfocus;g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Asserted-Identity:<sipcf-a@ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:aaa\nm=audio 23124 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; mode-change-period=2\na=maxptime:20\ni=speech\nm=application 23125 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-group-A2@mcptt-op.gov</>\n<mcptt-calling-user-id>userA1@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n\n--boundary1--\n\nRequest-URI:\tContains the public service identity of the MCPTT server hosting the \"mcptt-group-A2@mcptt-op.gov\".\nContact:\tContains the MCPTT session identity.\nmcptt-info:\tIs copied from the received INVITE request and updated to include the \"mcptt-group-A2@mcptt-op.gov\" in the <mcptt-request-uri> element and mcptt-group-T@mcptt-op.gov in the <mcptt-calling-group-id> element.\nSDP offer:\tIs based on the received SDP offer where the IP address and port numbers are replaced with the IP address and port numbers of the controlling MCPTT function. The media-level section for the media-floor control entity is indicating that queueing is supported (\"mc:queueing\").\n29)\tHTTP GET request (controlling MCPTT function A to GMS B)\nSince mcptt-group-A@mcptt-city1.net is hosted by the non-controlling MCPTT function A the group document is fetched from GMS A2.\nThe group document is fetched by means of a HTPP GET request as described in 3GPP TS 24.481 [31].\n30)\tHTTP 200 response (GMS B to controlling MCPTT function B)\nThe GMS B returns the mcptt-group-A2@mcptt-op.gov group document with the list of group members in a HTTP 200 response as described in 3GPP TS 24.481 [31].\nThe following steps describes the invitation of one group member, mcptt-id-A@mcptt-op.gov, using an on-demand session between the participating MCPTT function B and MCPTT client B. Other members can be invited using the same method or using pre-established session.\n31)\tSIP INVITE request (non-controlling MCPTT function A to participating MCPTT function A3) – see example in table A.1.3-31\nThe non-controlling MCPTT function A invites the MCPTT user mcptt-id-A3@mcptt-op.gov to the session by sending and SIP INVITE request towards the terminating network in accordance with 3GPP TS 24.229 [4].\nTable A.1.3-31: SIP INVITE request (non-Controlling MCPTT function A to participating MCPTT function A3)\nINVITE sip: pf-A3.ims-op.net SIP/2.0\nAccept-Contact:\nP-Asserted-Service:\nSupported:\nSession-Expires:\nContact: <sessionA@cf-A2@ims-op.net61234>;g.3gpp.mcptt; isfocus; g.3gpp.icsi-ref=urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nP-Asserted-Identity:<sip:cf-A2.ims-op.net>\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:eee\nm=audio 12344 RTP/AVP 97\na=\na=\na=\ni=\nm=application 12345 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-id-A3@mcptt-op.gov</>\n<mcptt-calling-user-id>mcptt-id-A@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nContact:\tContains a new MCPTT session identity and can be used by the members to rejoin the session.\nNOTE 7:\tThe MCPTT session identity received from the controlling MCPTT function A cannot be used since when a member of group mcptt-group-A2@mcptt-op.gov rejoins the session, the member shall rejoin the session in the non-controlling MCPTT function A and not the session in the controlling MCPTT function A.\nP-Asserted-Identity:\tContains the public service identity of the non-controlling MCPTT function A.\nmcptt-info:\tThe identity of the invited MCPTT user mcptt-id-A3@mcptt-op.gov is added.\nSDP offer:\tThe SDP offer is a copy of the received SDP offer updated with the IP address and port numbers of the non-controlling MCPTT function A.\n32)\tSIP INVITE request (participating MCPTT function A3 to MCPTT client A3) – see example in table A.1.3-32\nThe participating MCPTT function A3 sends the SIP INVITE request towards the MCPTT client A3 according to 3GPP TS 24.229 [4].\nTable A.1.3-32: SIP INVITE request (participating MCPTT function A3 to MCPTT client A3)\nINVITE sip: userA3@ims-op.net SIP/2.0\nAccept-Contact:\nP-Asserted-Service:\nSupported:timer;tdialog\nSession-Expires:refresher;uac\nContact:\nResouce-Share: media-sharing; session-receiver; rules=\"k3::UL\"; timestamp=32651\nPriority-Share:allowed\nP-Asserted-Identity:<sip:cf-A2.ims-op.net>\nAnswer-Mode:Manual\n\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:ccc:aaa:ccc\nm=audio 18412 RTP/AVP 97\na=\na=\na=\ni=\nm=application 18413 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-request-uri>mcptt-id-A3@mcptt-op.gov</>\n<mcptt-calling-user-id>mcptt-id-A@mcptt-op.gov</>\n<mcptt-calling-group-id>mcptt-group-T@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1--\n\nRequest-URI:\tContains the public user identity of the userA3@ims-op.net.\nResource-Share:\tContains a new sharing key along with indication that MCPTT speech media can be shared in the uplink (UL) direction. The value \"k3\" is the key that P-CSCF can use to identify media streams towards MCPTT client A3 that can share media.\nPriority-Share:\tThe Priority-Share header field is set to \"allowed\" indicating that priority sharing can be applied by IMS.\nAnswer-Mode:\tThe MCPTT service setting is \"manual-answer\" so the participating MCPTT function includes the value \"Manual\" in the Answer-Mode header field.\nSDP offer:\tThe SDP offer is a copy of the received SDP offer updated with the IP address and port numbers of the participating MCPTT function B.\n33)-34)\tSIP 200 (OK) response to the SIP INVITE request (MCPTT client A3 to non-controlling MCPTT function A) – see example in table A.1.3-33\nUpon receiving the SIP INVITE request the MCPTT client A3 accepts the invitation, interacts with the media plane as specified in 3GPP TS 24.380 clause 6.2 and sends the SIP 200 (OK) response towards the MCPTT server according to rules and procedures of 3GPP TS 24.229 [4].\nTable A.1.3-33: SIP 200 (OK) response (MCPTT client A3 to non-controlling MCPTT function via participating MCPTT function A3)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uas\nRequire: timer\nContact:<sip:[5555::bbb:aaa:ccc:aaa]>;+g.3gpp.mcptt;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\"\nP-Asserted-Identity:<sip:userA3@ims-op.net>\nSupported: tdialog, norefersub, explicitsub, nosub\nP-Answer-State:Confirmed\nContent-Type: multipart/mixed;boundary=\"boundary1\"\n--boundary1\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::baa:abb:ddd:cccc\nm=audio 25644 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=maxptime:20\ni=speech\nm=application 25644 udp mcptt\na=fmtp:MCPTT mc_queueing\n--boundary1\nContent-Type: application/vnd.3gpp.mcptt-info+xml\nContent-Length: (…)\n\n<?xml version=\"1.0\"?>\n<mcpttinfo>\n<mcptt-Params>\n<session-type>prearranged</>\n<mcptt-called-party-id>mcptt-id-A3@mcptt-op.gov</>\n</mcptt-Params>\n</mcpttinfo>\n--boundary1—\n\nContact:\tContains the registered contact, the g.3gpp.mcptt feature tag and the g.3gpp.icsi-ref media feature tag with the IMS communication service MCPTT.\nP-Answer-State:\tContains the value \"Confirmed\" to indicate that the MCPTT client sent the response.\nSDP answer:\tThe received SDP offer is accepted and updated with the IP address and port numbers of the MCPTT client A3. The MCPTT client A3 confirms that queueing of floor requests are supported in the 'fmtp' attribute \"mc_queueing\".\n\nThe participating MCPTT function A3 updates the IP address and port numbers with the IP address and port numbers of the participating MCPTT function A3.\n35)-36)\tSIP ACK request (non-controlling MCPTT function A to MCPTT client A3 via participating MCPTT function A3.\nThe non-controlling MCPTT function A acknowledges the receipt of the SIP 200 (OK) response to the INVITE request by means of a SIP ACK request.\n37)\tSIP 200 (OK) response to the SIP INVITE request (non-controlling MCPTT function A to controlling MCPTT function A) – see example in table A.1.3-37\nUpon receipt of the first SIP 200 (OK) response from the participating MCPTT function A3 serving the invited MCPTT user A3 in the prearranged group mcptt-id-A3@mcptt-op.gov, the non-controlling MCPTT function A interact with the media plane as specified in 3GPP TS 24.380 [5] and sends the SIP 200 (OK) towards the controlling MCPTT function A in accordance with 3GPP TS 24.229 [4].\nTable A.1.3-37: SIP 200 (OK) response (non-controlling MCPTT function A to controlling MCPTT function A)\nSIP/2.0 200 OK\nSession-Expires:3600;refresher=uac\nRequire: timer\nP-Asserted-Identity:<sip:cf-B.ims-op.net>\nContact: <sip:[5555::aaa:bbb:ddd:eee]>;+g.3gpp.mcptt;+g.3gpp.icsi-ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mcptt\nSupported: tdialog, norefersub, explicitsub, nosub\nContent-Type: application/sdp\nContent-Length: (…)\n\nc=IN IP6 5555::aaa:bbb:ddd:eee\nm=audio 12344 RTP/AVP 97\na=rtpmap:97 AMR\na=fmtp:97 mode-set=0,2,5,7; maxframes=2\na=maxptime:20\ni=speech\nm=application 12345 udp mcptt\na=fmtp:MCPTT mc_queueing\n\nP-Asserted-Identity\tContains a public service identity identifying the non-controlling MCPTT function A3.\nContact\tContains a contact address and the media feature tags g.3gpp.mcptt and g.3gpp.icsi-ref.\nSDP\tContains the SDP answer to the SDP offer received from the controlling MCPTT function A. The media-level section for the media-floor control entity acknowledged that queueing is supported (\"mc_queueing\").\nNOTE 8:\tThe SDP answer is based on the capabilities of the non-controlling MCPTT function and not based on the SIP 200 (OK) response received from the participating MCPTT function.\n38)\tSIP ACK request (controlling MCPTT function A to non-controlling MCPTT function A.\nThe controlling MCPTT function A acknowledges the receipt of the SIP 200 (OK) response to the INVITE request by means of a SIP ACK request.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.1\tGeneral",
            "description": "The following tables give a brief description of the timers used in the present document.\nFor the on-network timers described in the present document, the following timer families are used:\n-\tTNGx: Timer oN-network Group call x\nFor the off-network timers described in the present document, the following timer families are used:\n-\tTFGx:\tTimer oFf-network Group call x\n-\tTFPy:\tTimer oFf-network Private call y\n-\tTFBz:\tTimer oFf-network Broadcast group call z\nwhere x, y and z represent numbers.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "B.2\tOn-network timers",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.2.1\tTimers in the controlling MCPTT function",
                    "description": "",
                    "summary": "",
                    "text_content": "The table B.2.1-1 provides a description of the timers used by the controlling MCPTT function, specifies the timer values, describes the reason for starting of the timer, normal stop and the action on expiry.\nTable B.2.1-1: controlling MCPTT function timers\n\n",
                    "tables": [
                        {
                            "description": "Table B.2.1-1: controlling MCPTT function timers",
                            "table number": 60,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.2.2\tTimers in the terminating participating MCPTT function",
                    "description": "",
                    "summary": "",
                    "text_content": "The table B.2.2-1 provides a description of the timers used by the terminating participating MCPTT function, specifies the timer values, describes the reason for starting of the timer, normal stop and the action on expiry.\nTable B.2.2-1: controlling MCPTT function timers\n\n",
                    "tables": [
                        {
                            "description": "Table B.2.2-1: controlling MCPTT function timers",
                            "table number": 61,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "B.3\tOff-network timers",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "B.3.1\tTimers in off-network group call",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "B.3.1.1\tBasic call control",
                            "text_content": "The table B.3.1.1-1 lists the timers used in basic call control, their start values, their limits, describes the cause of the start, and the action to take on normal stop and on expiry.\nTable B.3.1.1-1: Timers in basic call control\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table B.3.1.1-1: Timers in basic call control",
                                    "table number": 62,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        },
                        {
                            "title": "B.3.1.2\tCall type control",
                            "text_content": "The table B.3.1.2-1 lists the timers used in call type control, their star values, describes the cause of start, and the action to take on normal stop and on expiry.\nTable B.3.1.2-1: Call type control\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "Table B.3.1.2-1: Call type control",
                                    "table number": 63,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "B.3.2\tTimers in off-network private call",
                    "description": "",
                    "summary": "",
                    "text_content": "The table B.3.2-1 lists the timers used in off-network private call, their start values, their limits, describes the cause of start, and the action to take on normal stop and on expiry.\nTable B.3.2-1: Timers in off-network private call\n\n",
                    "tables": [
                        {
                            "description": "Table B.3.2-1: Timers in off-network private call",
                            "table number": 64,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.3.3\tTimers in off-network broadcast call",
                    "description": "",
                    "summary": "",
                    "text_content": "The table B.3.3-1 lists the timers used in off-network broadcast call, their start values, their limits, describes the cause of start, and the action to take on normal stop and on expiry.\nTable B.3.3-1: Timers in off-network broadcast call\n\n",
                    "tables": [
                        {
                            "description": "Table B.3.3-1: Timers in off-network broadcast call",
                            "table number": 65,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "B.3.4\tTimers in off-network emergency alert",
                    "description": "",
                    "summary": "",
                    "text_content": "The table B.3.4-1 lists the timers used in off-network emergency alert, their start values, their limits, describes the cause of start, and the action to take on normal stop and on expiry.\nTable B.3.4-1: Timers in off-network emergency alert\n\n\n",
                    "tables": [
                        {
                            "description": "Table B.3.4-1: Timers in off-network emergency alert",
                            "table number": 66,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "C.1\tGeneral",
            "description": "The following tables give a brief description of the counters used in the present document.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "C.2\tOff-network counters",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "C.2.1\tCounters in off-network group call",
                    "description": "",
                    "summary": "",
                    "text_content": "The table C.2.1-1 lists the counters used in off-network group call, their default upper limits and the action to take upon reaching the upper limit. The counters start at 1.\nTable C.2.1-1: Counters in off-network group call\n\n",
                    "tables": [
                        {
                            "description": "Table C.2.1-1: Counters in off-network group call",
                            "table number": 67,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "C.2.2\tCounters in off-network private call",
                    "description": "",
                    "summary": "",
                    "text_content": "The table C.2.2-1 lists the counters used in off-network private call, their default upper limits and the action to take upon reaching the upper limit. The counters start at 1.\nTable C.2.2-1: Counters in off-network private call\n\n",
                    "tables": [
                        {
                            "description": "Table C.2.2-1: Counters in off-network private call",
                            "table number": 68,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "D.1\tGeneral",
            "description": "This clause describes the media feature tag definitions that are applicable for the 3GPP IM CN Subsystem for the realisation of the Mission Critical Push To Talk (MCPTT) service.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.2\tDefinition of media feature tag g.3gpp.mcptt",
            "description": "Media feature tag name: g.3gpp.mcptt\nASN.1 Identifier: 1.3.6.1.8.2.28\nSummary of the media feature indicated by this media feature tag: This media feature tag when used in a SIP request or a SIP response indicates that the function sending the SIP message supports Mission Critical Push To Talk (MCPTT) communication.\nValues appropriate for use with this media feature tag: Boolean\nThe media feature tag is intended primarily for use in the following applications, protocols, services, or negotiation mechanisms: This media feature tag is most useful in a communications application, for describing the capabilities of a device, such as a phone or PDA.\nExamples of typical use: Indicating that a mobile phone supports the Mission Critical Push To Talk (MCPTT) communication.\nRelated standards or documents: 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control Protocol specification\"\nSecurity Considerations: Security considerations for this media feature tag are discussed in clause 11.1 of IETF RFC 3840 [16].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "D.3\tDefinition of feature-capability indicator g.3gpp.mcptt.ambient-listening-call-release",
            "description": "Feature-capability indicator name: g.3gpp.mcptt.ambient-listening-call-release\nSummary of the feature indicated by this feature-capability indicator:\nThis feature-capability indicator when included in a Feature-Caps header field as specified in IETF RFC 6809 [93] in a SIP INVITE request or a SIP 200 (OK) response to a SIP INVITE request indicates that the MCPTT server is capable of receiving a SIP BYE from an MCPTT client to release an ambient-listening call.\nFeature-capability indicator specification reference:\n3GPP TS 24.379, http://www.3gpp.org/ftp/Specs/archive/24_series/24.379/\nValues appropriate for use with this feature-capability indicator: None\nExamples of typical use: Indicating that the MCPTT server can support receiving a SIP BYE from an MCPTT client to release an ambient listening call.\nSecurity Considerations: Security considerations for this feature-capability indicator are discussed in clause 9 of IETF RFC 6809 [93].\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.1\tGeneral",
            "description": "This clause describes the IMS communications service identifier definitions that are applicable for the 3GPP IM CN Subsystem for the realisation of the Mission Critical Push To Talk (MCPTT) service.\nNOTE:\tThe template has been created using the headers of the table in http://www.3gpp.org/specifications-groups/34-uniform-resource-name-urn-list\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "E.2\tDefinition of ICSI value for MCPTT service",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "E.2.1\tURN",
                    "description": "",
                    "summary": "",
                    "text_content": "urn:urn-7:3gpp-service.ims.icsi.mcptt\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.2\tDescription",
                    "description": "",
                    "summary": "",
                    "text_content": "This URN indicates that the device has the capabilities to support the mission critical push to talk (MCPTT) service.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.3\tReference",
                    "description": "",
                    "summary": "",
                    "text_content": "3GPP TS 24 379: \"Mission Critical Push To Talk (MCPTT) call control Protocol specification\"\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.3\tContact",
                    "description": "",
                    "summary": "",
                    "text_content": "Name:\t<MCC name>\nEmail:\t<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.4\tRegistration of subtype",
                    "description": "",
                    "summary": "",
                    "text_content": "Yes\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "E.2.5\tRemarks",
                    "description": "",
                    "summary": "",
                    "text_content": "None\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.1\tXML schema for MCPTT Information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.1.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type for MCPTT information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.1.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:mcpttInfo:1.0\"\nxmlns:mcpttinfo=\"urn:3gpp:ns:mcpttInfo:1.0\"\nelementFormDefault=\"qualified\"\nattributeFormDefault=\"unqualified\"\nxmlns:xenc=\"\"\nxmlns:mgktp=\"urn:3gpp:ns:mcpttGKTP:1.0\">\n\n<xs:import namespace=\"http://www.w3.org/2001/04/xmlenc#\"/>\n<xs:import namespace=\"urn:3gpp:ns:mcpttGKTP:1.0\"/>\n\n<!-- root XML element -->\n<xs:element name=\"mcpttinfo\" type=\"mcpttinfo:mcpttinfo-Type\" id=\"info\"/>\n\n<xs:complexType name=\"mcpttinfo-Type\">\n<xs:sequence>\n<xs:element name=\"mcptt-Params\" type=\"mcpttinfo:mcptt-ParamsType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"mcptt-ParamsType\">\n<xs:sequence>\n<xs:element name=\"mcptt-access-token\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"session-type\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"mcptt-request-uri\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"mcptt-calling-user-id\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"mcptt-called-party-id\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"mcptt-calling-group-id\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"required\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"emergency-ind\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"alert-ind\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"imminentperil-ind\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"broadcast-ind\" type=\"xs:boolean\" minOccurs=\"0\"/>\n<xs:element name=\"mc-org\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"floor-state\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"associated-group-id\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"originated-by\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"MKFC-GKTPs\" type=\"mgktp:singleTypeGKTPsType\" minOccurs=\"0\"/>\n<xs:element name=\"mcptt-client-id\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"alert-ind-rcvd\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"partner-mcptt-id\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:element name=\"migration-autho-result\" type=\"mcpttinfo:contentType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:simpleType name=\"protectionType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"Normal\"/>\n<xs:enumeration value=\"Encrypted\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:complexType name=\"contentType\">\n<xs:choice>\n<xs:element name=\"mcpttURI\" type=\"xs:anyURI\"/>\n<xs:element name=\"mcpttString\" type=\"xs:string\"/>\n<xs:element name=\"mcpttBoolean\" type=\"xs:boolean\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:attribute name=\"type\" type=\"mcpttinfo:protectionType\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n<!-- anyEXT elements – begin -->\n\n<xs:element name=\"ambient-listening-type\" type=\"mcpttinfo:ambientListeningType\"/>\n<xs:simpleType name=\"ambientListeningType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"remote-init\"/>\n<xs:enumeration value=\"local-init\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"release-reason\" type=\"mcpttinfo:releaseReasonType\"/>\n<xs:simpleType name=\"releaseReasonType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"private-call-expiry\"/>\n<xs:enumeration value=\"administrator-action\"/>\n<xs:enumeration value=\"not selected for call\"/>\n<xs:enumeration value=\"call-request-for-listened-to-client\"/>\n<xs:enumeration value=\"call-request-initiated-by-listened-to-client\"/>\n<xs:enumeration value=\"authentication of the MIKEY-SAKE I_MESSAGE failed\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"request-type\" type=\"mcpttinfo:requestTypeType\"/>\n<xs:simpleType name=\"requestTypeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"private-call-call-back-request\"/>\n<xs:enumeration value=\"private-call-call-back-cancel-request\"/>\n<xs:enumeration value=\"group-selection-change-request\"/>\n<xs:enumeration value=\"remotely-initiated-group-call-request\"/>\n<xs:enumeration value=\"remotely-initiated-private-call-request\"/>\n<xs:enumeration value=\"transfer-private-call-request\"/>\n<xs:enumeration value=\"functional-alias-status-determination\"/>\n<xs:enumeration value=\"forward-private-call-request\"/>\n<xs:enumeration value=\"forward-private-call-settings-request\"/>\n<xs:enumeration value=\"forward-private-call-settings-response\"/>\n<xs:enumeration value=\"fa-group-binding-req\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"response-type\" type=\"mcpttinfo:responseTypeType\"/>\n<xs:simpleType name=\"responseTypeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"private-call-call-back-response\"/>\n<xs:enumeration value=\"private-call-call-back-cancel-response\"/>\n<xs:enumeration value=\"group-selection-change-response\"/>\n<xs:enumeration value=\"remotely-initiated-group-call-response\"/>\n<xs:enumeration value=\"remotely-initiated-private-call-response\"/>\n<xs:enumeration value=\"transfer-private-call-response\"/>\n<xs:enumeration value=\"forward-private-call-response\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"urgency-ind\">\n<xs:simpleType>\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"low\"/>\n<xs:enumeration value=\"normal\"/>\n<xs:enumeration value=\"high\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:element>\n\n<xs:element name=\"time-of-request\" type=\"xs:dateTime\"/>\n\n<xs:element name=\"selected-group-change-outcome\" type=\"mcpttinfo:selectedGroupChangeOutcomeType\"/>\n<xs:simpleType name=\"selectedGroupChangeOutcomeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"success\"/>\n<xs:enumeration value=\"fail\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"affiliation-required\" type=\"xs:boolean\"/>\n\n<xs:element name=\"remotely-initiated-call-outcome\" type=\"mcpttinfo:remotelyInitiatedCallOutcomeType\"/>\n<xs:simpleType name=\"remotelyInitiatedCallOutcomeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"success\"/>\n<xs:enumeration value=\"fail\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"notify-remote-user\" type=\"xs:boolean\"/>\n\n<xs:element name=\"functional-alias-URI\" type=\"mcpttinfo:contentType\"/>\n\n<xs:element name=\"user-requested-priority\" type=\"xs:nonNegativeInteger\"/>\n<xs:element name=\"emergency-alert-area-ind\" type=\"xs:boolean\"/>\n\n<xs:element name=\"group-geo-area-ind\" type=\"xs:boolean\"/>\n\n<xs:element name=\"non-acknowledged-user\" type=\"mcpttinfo:contentType\"/>\n\n<xs:element name=\"call-to-functional-alias-ind\" type=\"xs:boolean\"/>\n\n<xs:element name=\"emergency-ind-rcvd\" type=\"mcpttinfo:contentType\"/>\n\n<xs:element name=\"call-transfer-ind\" type=\"xs:boolean\"/>\n\n<xs:element name=\"multiple-devices-ind\" type=\"mcpttinfo:contentType\"/>\n\n<xs:element name=\"transfer-call-outcome\" type=\"mcpttinfo:transferCallOutcomeType\"/>\n\n<xs:simpleType name=\"transferCallOutcomeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"success\"/>\n<xs:enumeration value=\"fail\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"called-functional-alias-URI\" type=\"mcpttinfo:contentType\"/>\n\n<xs:element name=\"call-forwarding-ind\" type=\"xs:boolean\"/>\n\n<xs:element name=\"forwarding-call-outcome\" type=\"mcpttinfo:forwardingCallOutcomeType\"/>\n<xs:simpleType name=\"forwardingCallOutcomeType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"success\"/>\n<xs:enumeration value=\"fail\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"forwarding-immediate-list\" type=\"mcpttinfo:mcpttIdListType\"/>\n<xs:complexType name=\"mcpttIdListType\">\n<xs:choice minOccurs=\"0\" maxOccurs=\"unbounded\">\n<xs:element name=\"entry\" type=\"mcpttinfo:EntryType\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:choice>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:element name=\"forwarding-other-list\" type=\"mcpttinfo:mcpttIdListType\"/>\n\n<xs:complexType name=\"EntryType\">\n<xs:sequence>\n<xs:element name=\"uri-entry\" type=\"xs:anyURI\"/>\n<xs:element name=\"display-name\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:element name=\"forwarding-reason\" type=\"mcpttinfo:forwardingReasonType\"/>\n<xs:simpleType name=\"forwardingReasonType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"immediate\"/>\n<xs:enumeration value=\"no-answer\"/>\n<xs:enumeration value=\"manual-input\"/>\n<xs:enumeration value=\"migrated\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:element name=\"PrivateCallKMSURI\" type=\"mcpttinfo:PrivateCallKMSURIEntryType\"/>\n<xs:complexType name=\"PrivateCallKMSURIEntryType\">\n<xs:sequence>\n<xs:element name=\"PrivateCallKMSURI\" type=\"mcpttinfo:EntryType\"/>\n<xs:element name=\"anyExt\" type=\"mcpttinfo:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:element name=\"binding-ind\" type=\"xs:boolean\"/>\n<xs:element name=\"binding-fa-uri\" type=\"xs:anyURI\"/>\n<xs:element name=\"unbinding-fa-uri\" type=\"xs:anyURI\"/>\n<xs:element name=\"replaces-header-value\" type=\"xs:string\"/>\n<xs:element name=\"transfer-announced-ind\" type=\"xs:boolean\"/>\n<xs:element name=\"forwarding-sequence-number\" type=\"xs:nonNegativeInteger\"/>\n<xs:element name=\"forwarded-by-mcptt-id\" type=\"xs:anyURI\"/>\n<xs:element name=\"forwarded-by-functional-alias\" type=\"xs:anyURI\"/>\n<xs:element name=\"forwarding-target-id\" type=\"xs:anyURI\"/>\n<xs:element name=\"forwarding-target-is-functional-alias\" type=\"xs:boolean\"/>\n\n<!-- These elements can be added under the anyExt element of the mcpttinfo element -->\n<xs:element name=\"ric-app-level-priority\" type=\"xs:string\"/>\n<xs:element name=\"ric-commencement-mode\" type=\"xs:string\"/>\n<xs:element name=\"remotely-initiated-call-request-ind\" type=\"mcpttinfo:contentType\"/>\n<xs:element name=\"forwarding-target-orig-id\" type=\"xs:anyURI\"/>\n<xs:element name=\"end-to-end-security\" type=\"xs:boolean\"/>\n<xs:element name=\"call-participants-criterias\" type=\"xs:string\"/>\n<xs:element name=\"preconfigured-group-id\" type=\"xs:anyURI\"/>\n<xs:element name=\"adhoc-grp-emg-alert-grp-ind\" type=\"xs:boolean\"/>\n<!-- anyEXT elements – end -->\n\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.1.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <mcpttinfo> element is the root element of the XML document. The <mcpttinfo> element can contain subelements.\nNOTE 1:\tThe subelements of the <mcpttinfo> are validated by the <xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <mcpttinfo> element\nIf the <mcpttinfo> contains the <mcptt-Params> element then:\n1)\tthe <mcptt-access-token>, <mcptt-request-uri>, <mcptt-calling-user-id>, <mcptt-called-party-id>, <mcptt-calling-group-id>, <emergency-ind>, <alert-ind>, <imminentperil-ind>, <originated-by>, <mcptt-client-id>, <functional-alias-URI>, <called-functional-alias-URI>, <non-acknowledged-user>, <multiple-devices-ind>, <associated-group-id>, <group-geo-area-ind>, <migration-auth-result> and <partner-mcptt-id> elements can be included with encrypted content;\n2)\tfor each element in 1) that is included with content that is not encrypted:\na)\tthe element has the \"type\" attribute set to \"Normal\";\nb)\tif the element is one of the following elements: <mcptt-request-uri>, <mcptt-calling-user-id>, <mcptt-called-party-id>, <mcptt-calling-group-id>, <originated-by>, <functional-alias-URI>, <called-functional-alias-URI>, <non-acknowledged-user>, <associated-group-id>, or <partner-mcptt-id>, then the <mcpttURI> element is included;\nc)\tif the element is one of the following elements:<mcptt-access-token> or <mcptt-client-id>, then the <mcpttString> element is included; and\nd)\tif the element is one of the following elements: <emergency-ind>, <alert-ind>, <alert-ind-rcvd>, <imminentperil-ind>, <emergency-ind-rcvd>, <multiple-devices-ind>, or <remotely-initiated-call-request-ind>, or <migration-auth-result>, then the <mcpttBoolean> element is included;\n3)\tfor each element in 1) that is included with content that is encrypted:\na)\tthe element has the \"type\" attribute set to \"Encrypted\";\nb)\tthe <xenc:EncryptedData> element from the \"\" namespace is included and:\ni)\tcan have a \"Type\" attribute can be included with a value of \"\";\nii)\tcan include an <EncryptionMethod> element with the \"Algorithm\" attribute set to value of \"http://www.w3.org/2009/xmlenc11#aes128-gcm\";\niii)\tcan include a <KeyInfo> element with a <KeyName> element containing the base 64 encoded XPK-ID; and\niv)\tincludes a <CipherData> element with a <CipherValue> element containing the encrypted data.\nNOTE 2:\tWhen the optional attributes and elements are not included within the <xenc:EncryptedData> element, the information they contain is known to sender and the receiver by other means.\nIf the <mcpttinfo> contains the <mcptt-Params> element then:\n1)\tthe <mcptt-access-token> can be included with the access token received during authentication procedure as described in 3GPP TS 24.482 [49];\n2)\tthe <session-type> can be included with:\na)\ta value of \"chat\" to indicate that the MCPTT client wants to join a chat group call\nb)\ta value of \"prearranged\" to indicate the MCPTT client wants to make a prearranged group call;\nc)\ta value of \"private\" to indicate the MCPTT client wants to make a private call;\nd)\ta value of \"first-to-answer\" to indicate that the MCPTT client wants to make a first-to-answer call;\ne)\ta value of \"ambient-listening\" to indicate the MCPTT client wants to make an ambient listening call; or\nf)\ta value of \"adhoc\" to indicate the MCPTT client wants to make an adhoc group call;\n3)\tthe <mcptt-request-uri> can be included with:\na)\ta value set to an MCPTT group ID or temporary MCPTT group ID when the <session-type> is set to a value of \"prearranged\" or \"chat\";\nb)\ta value set to the MCPTT ID of the called MCPTT user when the <session-type> is set to a value of \"private\"; and\nc)\ta value set to the MCPTT ID of the called MCPTT user or MCPTT group ID of adhoc group when the <session-type> is set to a value of \"adhoc\";\n4)\tthe <mcptt-calling-user-id> can be included, set to MCPTT ID of the originating user;\n5)\tthe <mcptt-called-party-id> can be included, set to the MCPTT ID of the terminating user;\n6)\tthe <mcptt-calling-group-id> can be included to indicate the MCPTT group identity or MCPTT adhoc group identity to the terminating user;\n7)\tthe <required> can be included in a SIP 183 (Session Progress) from a non-controlling MCPTT function of an MCPTT group to inform the controlling MCPTT function that the group on the non-controlling MCPTT function has group members in the group document which are marked as <on-network-required>, as specified in 3GPP TS 24.481 [31];\n8)\tthe <emergency-ind> can be:\na)\tset to \"true\" to indicate that the call that the MCPTT client is initiating is an emergency MCPTT call; or\nb)\tset to \"false\" to indicate that the MCPTT client is cancelling an emergency MCPTT call (i.e. converting it back to a non-emergency call)\n9)\tthe <alert-ind> can be:\na)\tset to \"true\" in an emergency call initiation to indicate that an alert to be sent; or\nb)\tset to \"false\" when cancelling an emergency call which requires an alert to be cancelled also\n10)\tif the <session-type> is set to \"chat\" or \"prearranged\":\na)\tthe <imminentperil-ind> can be set to \"true\" to indicate that the call that the MCPTT client is initiating is an imminent peril group MCPTT call;\n11)\tthe <broadcast-ind> can be:\na)\tset to \"true\" to indicate that the MCPTT client is initiating a broadcast group call; or\nb)\tset to \"false\" to indicate that the MCPTT client is initiating a non-broadcast group call;\n12)\tthe <mc-org> can be:\na)\tset to the MCPTT user's Mission Critical Organization in an emergency alert sent by the MCPTT server to terminating MCPTT clients;\n13)\tthe <floor-state> can be:\na)\tset to \"floor-idle\" if the floor is idle in a non-controlling MCPTT function; or\nb)\tset to \"floor-taken\" if the floor state in a non-controlling MCPTT function is taken;\n14)\tthe <associated-group-id>:\na)\tif the <mcptt-request-uri> element contains a group identity then this element can include an MCPTT group ID associated with the group identity in the <mcptt-request-uri> element. E.g. if the <mcptt-request-uri> element contains a temporary group identity (TGI), then the <associated-group-id> element can contain the constituent MCPTT group ID;\n15)\tthe <originated-by>:\na)\tcan be included, set to the MCPTT ID of the originating user of an MCPTT emergency alert when being cancelled by another authorised MCPTT user;\n16)\tthe <MKFC-GKTPs>:\na)\tcontains a group key transport payload carrying one or more MKFC(s) and MKFC-ID(s) as described in3GPP TS 24.481 [31] clause 7.4, to be used for protection of multicast floor control signalling when the UE operates on the network;\n17)\tthe <mcptt-client-id>:\na)\tcan be included, set to the MCPTT client ID of the MCPTT client that originated a SIP INVITE request, SIP REFER request, SIP REGISTER request, SIP PUBLISH request or SIP MESSAGE request;\n18)\tthe <alert-ind-rcvd>:\na)\tcan be set to \"true\" and included in a SIP MESSAGE to indicate that the emergency alert or cancellation was received successfully;\n18a)\tthe <partner-mcptt-id> can be included and set to the MCPTT ID of a migrating user in the partner MCPTT system; and\n18b)\tthe <migration-auth-result> can be:\na)\tset to \"true\" to indicate that the MCPTT client is authorized to migrate; or\nb)\tset to \"false\" to indicate that the MCPTT client is not authorized to migrate; and\n19)\tthe <anyExt> can be included with the following elements:\na)\tan <ambient-listening-type> element set to:\ni)\t\"remote-init\" when the listening MCPTT user of an ambient listening call initiates the call; or\nii)\t\"local-init\" when the listened-to MCPTT user of an ambient listening call initiates the call;\nb)\ta <release-reason> element set to:\ni)\t\"private-call-expiry\" when the ambient listening call is release due to the expiry of the private call timer;\nii)\t\"administrator-action\" when the ambient listening call is released by an MCPTT administrator;\niii)\t\"not selected for call\" when the when a dialog is released with an MCPTT client that was not selected as the terminating client of a first-to-answer call;\niv)\t\"call-request-for-listened-to-client\" when there is a call request targeted to the listened-to client;\nv)\t\"call-request-initiated-by-listened-to-client\" when there is a call request initiated by the listened-to client; or\nvi)\t\"authentication of the MIKEY-SAKE I_MESSAGE failed\" by a MCPTT client when the signature cannot be verified;\nc)\ta <request-type> element set to:\ni)\t\"private-call-call-back-request\" when a client initiates a private call call-back request;\nii)\t\"private-call-call-back-cancel-request\" when a client initiates a private call call-back cancel request;\niii)\t\"group-selection-change-request\" when a client initiates a group selection change request;\niv)\t\"remotely-initiated-group-call-request\" when a client initiates a remotely initiated group call request;\nv)\t\"remotely-initiated-private-call-request\" when a client initiates a remotely initiated private call request;\nvi)\t\"transfer-private-call-request\" when a client initiates a transfer private call request;\nvii)\t\"functional-alias-status-determination\" when a client initiates a subscription to FA status determination request;\nviii)\t\"forward-private-call-request\" when a client initiates a forward private call request; or\nix)\t\"fa-group-binding-req\" when a client initiates a request for binding of a functional alias with the MCPTT group(s) for the MCPTT user;\nd)\ta <response-type> element set to:\ni)\t\"private-call-call-back-response\" when a client responds to a private call call-back request;\nii)\t\"private-call-call-back-cancel-response\" when a client responds to a private call call-back cancel request;\niii)\t\"group-selection-change-response\" when a client responds to a group selection change request;\niv)\t\"remotely-initiated-group-call-response\" when a client responds to a remotely initiated call request;\nv)\t\"remotely-initiated-private-call-response\" when a client responds to a remotely initiated private call request;\nvi)\t\"transfer-private-call-response\" when a client responds to a transfer private call request;\nvii)\t\"forward-private-call-response\" when a client responds to a forward private call request; or\ne)\tan <urgency-ind> element:\ni)\tset to a value of \"low\", \"normal\" or \"high\" to indicate the urgency of a private call call-back request;\nf)\ta <time-of-request> element :\ni)\tset to the date and time at which the private call call-back request was initiated, in the form: \"YYYY-MM-DDThh:mm:ss\" where:\n-\tYYYY indicates the year;\n-\tMM indicates the month;\n-\tDD indicates the day;\n-\tT indicates the start of the required time section;\n-\thh indicates the hour;\n-\tmm indicates the minute; and\n-\tss indicates the second;\ng)\ta <selected-group-change-outcome> element set to:\ni)\t\"success\" when a client reports that it has successfully changed its selected group as requested by a received group selection change request; or\nii)\t\"fail\" when a client reports that it has failed to change its selected group as requested by a received group selection change request;\nh)\tan <affiliation-required> element set to:\ni)\t\"true\" when received by a client in a group-selection-change-request to indicate that the client needs to affiliate to the specified group;\ni)\ta <remotely-initiated-call-outcome> element set to:\ni)\t\"success\" when a client reports that it has successfully initiated a call requested by a received remotely initiated call request; or\nii)\t\"fail\" when a client reports that it has failed to initiate a call triggered as requested by a received group selection change request;\nj)\ta <notify-remote-user> element set to:\ni)\t\"true\" when the remote user is to be notified of a remotely initiated call request; or\nii)\t\"false\" when the remote user is to be notified of a received remotely initiated call request;\nk)\ta <functional-alias-URI> element set to the value of the functional alias that is used together with the \"mcptt-calling-user-id\";\nl)\tan <emergency-alert-area-ind> element set to:\ni)\t\"true\" when the MCPTT client has entered an emergency alert area; or\nii)\t\"false\" when the MCPTT client has exited an emergency alert area;\nm)\ta <group-geo-area-ind> element set to:\ni)\t\"true\" when the MCPTT client has entered a group geographic area; or\nii)\t\"false\" when the MCPTT client has exited a group geographic area;\nn)\tone or more <non-acknowledged-user> elements set to the MCPTT IDs of invited members to a group call that have not sent a SIP 200 (OK) response;\no)\ta <call-to-functional-alias-ind> element set to:\ni)\t\"true\" when the MCPTT client is using a functional alias to identify the MCPTT IDs of the potential target MCPTT users; or\nii)\t\"false\" when the MCPTT client is using MCPTT IDs to identify the potential target MCPTT users;\np)\tthe <emergency-ind-rcvd> element set to:\ni)\t\"true\" and included in a SIP MESSAGE to indicate that the in-progress emergency cancellation request was received successfully;\nq)\ta <call-transfer-ind> element set to:\ni)\t\"true\" when the MCPTT client is making a private call as a result of a call transfer; or\nii)\t\"false\" when the MCPTT client is making a normal private call;\nr)\ta <transfer-call-outcome> element set to:\ni)\t\"success\" when a client reports that it has successfully initiated a call requested by a received call transfer request; or\nii)\t\"fail\" when a client reports that it has failed to initiate a call triggered as requested by a received call transfer request;\ns)\ta <called-functional-alias-URI> element set to the value of the functional alias to be called;\nt)\ta <call-forwarding-ind> element set to:\ni)\t\"true\" when the MCPTT client is making a private call as a result of a call forwarding; or\nii)\t\"false\" when the MCPTT client is making a normal private call;\nu)\ta <forwarding-call-outcome> element set to:\ni)\t\"success\" when a client reports that it has successfully initiated a call requested by a received call forwarding request; or\nii)\t\"fail\" when a client reports that it has failed to initiate a call triggered as requested by a received call forwarding request;\nv)\ta <forwarding- immediate-list> element containing the details of the history of the immediate call forwardings that have occurred in the same MCPTT call;\nw)\ta <forwarding-other-list> element containing the details of the history of the forwardings because of call forwarding on \"no-answer\" or \"manual-input\" forthe same MCPTT call;\nx)\ta <forwarding-reason> element set to:\ni)\t\"immediate\" for call forwarding immediate;\nii)\t\"no-answer\" for call forwarding no answer;\niii)\t\"manual-input\" for call forwarding based on manual user input; or\niv)\t\"migrated\" for call forwarding due to user migration;\ny)\ta <multiple-devices-ind> element set to:\ni)\t\"true\" to indicate to the client that multiple clients are registered for the MCPTT user; or\nii)\t\"false\" to indicate to the client that no other clients are registered for the MCPTT user;\nz)\ta <binding-ind> element set to:\ni)\t\"true\" when the user wants to create a binding of a particular functional alias with the specified list of MCPTT groups for the MCPTT client; or\nii)\t\"false\" when the user wants to remove a binding of a particular functional alias from the specified list of MCPTT groups for the MCPTT client;\naa)\ta <binding-fa-uri> element set to:\ni)\ta URI of a functional alias that shall be bound with the specified list of MCPTT groups for the MCPTT client;\nab)\ta <unbinding-fa-uri> element set to:\ni)\ta URI of a functional alias that shall be unbound from the specified list of MCPTT groups for the MCPTT client;\nac)\ta <transfer-announced-ind> set to:\ni)\t\"true\" indicating that the call is part of an announced MCPTT call transfer; or\nii)\t\"false\" indicating that the call is not part of an announced MCPTT call transfer;\nad)\ta<replaces-header-value> element set to the Call-ID SIP header field value, the from-tag, and the to-tag of the MCPTT private call to be transferred. The delimiter between the Call-ID, the from-tag, and the to-tag is the semicolon (;);\nae)\ta <user-requested-priority> element set to the non-negative integer value requested by the user as priorityAbsence of the <emergency-ind>, <alert-ind> and <imminentperil-ind> in a SIP INVITE or a SIP REFER request indicates that the MCPTT client is initiating a non-emergency private call or non-emergency group call;\naf)\ta <forwarding-sequence-number> element set to the total number of forwardings including that forwarding attempt;\nag)\ta <forwarded-by-mcptt-id> element set to the MCPTT ID of the MCPTT client to whom a private call has been placed and who has requested that the private call be forwarded either through settings at its participating MCPTT function or through manual user input.\nah)\ta <forwarded-by-functional-alias> element set to the functional alias received by the MCPTT client to whom a private call has been placed and who has requested that the private call be forwarded either through settings at its participating MCPTT function or through manual user input, if a functional alias was used to call the client;\nai)\ta <forwarding-target-id> element set to the uri of the target of the forwarding;\naj)\ta<forwarding-target-is-functional-alias> element set to:\ni)\t\"true\" to indicate that the target of the forwarding is a functional alias; or\nii)\t\"false\" to indicate that the target of the forwarding is a MCPTT ID; and\nak)\ta <forwarding-target-orig-id> element set to the target uri of the forwarding as read from the user profile or entered by the MCPTT user requesting the MCPTT private call forwarding.\nal)\ta<end-to-end-security> element set to:\ni)\t\"true\" to indicate to determine the preconfigured group from which security related information is used for secure adhoc group call; or\nii)\t\"false\" to indicate that not to determine the preconfigured group from which security related information is used for secure adhoc group call;\nam)\ta <call-participants-criterias> element set to the criteria for determining the list of MCPTT users to be called in adhoc group call. The delimiter between the criteria is the comma (,);\nan)\ta <preconfigured-group-id> element set to the preconfigured group identity of the preconfigured group from which security related materials can be used by the adhoc group call participants to communicate securely in the adhoc group session; and\nao)\ta <adhoc-grp-emg-alert-grp-ind> element set to:\ni)\t\"true\" to indicate that the identity of adhoc group used in the adhoc group call setup request is learned during an adhoc group emergency alert procedures.\nAbsence of the <broadcast-ind> in a SIP INVITE or a SIP REFER request indicates that the MCPTT client is initiating a non-broadcast group call.\nAbsence of the <floor-state> in a SIP 200 (OK) response from the non-controlling MCPTT function indicates that the floor is idle.\nAbsence of the <call-to-functional-alias-ind> in a SIP INVITE or a SIP REFER request for a first-to-answer call indicates the use of the MCPTT IDs of the potential target MCPTT users.\nAbsence of the <call-transfer-ind> in a SIP INVITE or a SIP REFER request for a private call indicates that the call is not caused by a request for call transfer.\nAbsence of the <call-forwarding-ind> in a SIP INVITE or a SIP REFER request for a private call indicates that the call is not caused by a request for call forwarding.\nAbsence of the <transfer-announced-ind> in a SIP INVITE or a SIP REFER request for a private call indicates that the call is not part of an announced call transfer.\nAbsence of the <forwarding-target-is-functional-alias> element in a SIP INVITE, a SIP REFER, or a SIP MESSAGE request indicates that the forwarding target contains an MCPTT ID.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.1.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-info+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.0.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.2\tXML schema for MBMS usage information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "F.2A\tXML schema for MBS usage information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.2A.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type for application/vnd.3gpp.mcptt-mbs-usage-info+xml.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2A.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<xs:schema attributeFormDefault=\"unqualified\" elementFormDefault=\"qualified\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:mcpttMbsUsage:1.0\"\nxmlns:mcpttmbs=\"urn:3gpp:ns:mcpttMbsUsage:1.0\">\n<!-- the root element -->\n<xs:element name=\"mcptt-mbs-usage-info\" type=\"mcpttmbs:mcptt-mbs-usage-info-Type\" id=\"mbs\"/>\n<xs:complexType name=\"mcptt-mbs-usage-info-Type\">\n<xs:sequence>\n<xs:element name=\"mbs-listening-status\" type=\"mcpttmbs:mbs-listening-statusType\" minOccurs=\"0\"/>\n<xs:element name=\"mbs-session-de-announcement-status\" type=\"mcpttmbs:mbs-session-de-announcement-statusType\" minOccurs=\"0\"/>\n<xs:element name=\"ue-session-join-notification\" type=\"mcpttmbs:ue-session-join-notificationType\" minOccurs=\"0\"/>\n<xs:element name=\"announcement\" type=\"mcpttmbs:announcementTypeParams\" minOccurs=\"0\"/>\n<xs:element name=\"version\" type=\"xs:integer\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"mbs-listening-statusType\">\n<xs:sequence>\n<xs:element name=\"mbs-listening-status\" type=\"xs:string\"/>\n<xs:element name=\"unicast-listening-status\" type=\"xs:string\"/>\n<xs:element name=\"session-id\" type=\"xs:anyURI\" minOccurs=\"0\"/>\n<xs:element name=\"general-purpose\" type=\"xs:boolean\" minOccurs=\"0\"/>\n<xs:element name=\"mbs-session-id\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"mbs-session-de-announcement-statusType\">\n<xs:sequence>\n<xs:element name=\"mbs-session-de-announcement-status\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"number-of-reported-sessions\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"deleted-mbs-session-id\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"other-mbs-session-id\" type=\"xs:hexBinary\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"ue-session-join-notificationType\">\n<xs:sequence>\n<xs:element name=\"mbs-multicast-joining-status\" type=\"xs:string\"/>\n<xs:element name=\"mbs-session-id\" type=\"xs:hexBinary\"/>\n<xs:element name=\"session-id\" type=\"xs:anyURI\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"announcementTypeParams\">\n<xs:sequence>\n<xs:element name=\"mbs-session-info\" type=\"mcpttmbs:mbs-session-infoType\" minOccurs=\"0\"/>\n<xs:element name=\"eMBMS-bearer-info\" type=\"mcpttmbs:eMBMS-bearer-infoType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"mbs-session-infoType\">\n<xs:sequence>\n<xs:element name=\"mbs-session-id\" type=\"xs:hexBinary\"/>\n<xs:element name=\"mbs-session-mode\" type=\"mcpttmbs:sessionType\"/>\n<xs:element name=\"mc-service-group-id\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"frequency\" type=\"xs:unsignedLong\" minOccurs=\"0\"/>\n<xs:element name=\"GPMS\" type=\"xs:positiveInteger\" minOccurs=\"0\"/>\n<xs:element name=\"mbs-service-areas\" type=\"mcpttmbs:mbs-service-areasType\" minOccurs=\"0\"/>\n<xs:element name=\"report-ue-session-join-notification\" type=\"xs:boolean\" minOccurs=\"0\"/>\n<xs:element name=\"multicast-mbs-session-related-info\" type=\"mcpttmbs:multicast-mbs-session-related-infoType\"/>\n<xs:element name=\"mbs-fsa-id\" type=\"xs:hexBinary\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"mbs-session-de-announcement-acknowledgement\" type=\"xs:boolean\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"eMBMS-bearer-infoType\">\n<xs:sequence>\n<xs:element name=\"TMGI\" type=\"xs:hexBinary\"/>\n<xs:element name=\"Alternative-TMGI\" type=\"mcpttmbs:Alternative-TMGI-Type\" minOccurs=\"0\"/>\n<xs:element name=\"QCI\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"frequency\" type=\"xs:unsignedLong\" minOccurs=\"0\"/>\n<xs:element name=\"mbms-service-areas\" type=\"mcpttmbs:mbms-service-areasType\" minOccurs=\"0\"/>\n<xs:element name=\"GPMS\" type=\"xs:positiveInteger\" minOccurs=\"0\"/>\n<xs:element name=\"report-suspension\" type=\"xs:boolean\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<!-- anyEXT elements for the eMBMS announcement element – begin -->\n<xs:element name=\"mcptt-mbs-rohc\" type=\"mcpttmbs:emptyType\"/>\n<!-- empty complex type -->\n<xs:complexType name=\"emptyType\"/>\n<xs:element name=\"max-cid\" type=\"mcpttmbs:max-cidType\"/>\n<xs:simpleType name=\"max-cidType\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"1\"/>\n<xs:maxInclusive value=\"16383\"/>\n</xs:restriction>\n</xs:simpleType>\n<!-- anyEXT elements for the eMBMS announcement element – end -->\n<xs:simpleType name=\"sessionType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"multicast\"/>\n<xs:enumeration value=\"broadcast\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"Alternative-TMGI-Type\">\n<xs:sequence>\n<xs:element name=\"Alternative-TMGI-id\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n<xs:complexType name=\"mbs-service-areasType\">\n<xs:sequence>\n<xs:element name=\"mbs-service-area-id\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n<xs:complexType name=\"mbms-service-areasType\">\n<xs:sequence>\n<xs:element name=\"mbms-service-area-id\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n<xs:complexType name=\"multicast-mbs-session-related-infoType\">\n<xs:sequence>\n<xs:element name=\"PlmnId\" type=\"mcpttmbs:tPlmnIdentity\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"DNN\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"IPInformation\" type=\"mcpttmbs:IPInformationType\" minOccurs=\"0\"/>\n<xs:element name=\"MC-ID-ref-SNSSAI\" type=\"xs:string\" minOccurs=\"0\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n<xs:simpleType name=\"tPlmnIdentityFormat\">\n<xs:restriction base=\"xs:string\">\n<xs:pattern value=\"\\d{3}\\d{3}\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tPlmnIdentity\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttmbs:tPlmnIdentityFormat\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"IPInformationType\">\n<xs:sequence>\n<xs:element name=\"IPInformationListEntry\" type=\"mcpttmbs:IPInformationListEntryType\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"IPInformationListEntryType\">\n<xs:choice>\n<xs:element name=\"IPv4Address\" type=\"xs:token\"/>\n<xs:element name=\"IPv6Address\" type=\"xs:token\"/>\n<xs:element name=\"FQDN\" type=\"xs:anyURI\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:choice>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n<!-- anyEXT elements for the mcptt-mbs-usage-info – begin -->\n<xs:element name=\"mbs-defaultMuSiK-download\" type=\"mcpttmbs:mbs-default-ctrlkey-downloadType\"/>\n<xs:complexType name=\"mbs-default-ctrlkey-downloadType\">\n<xs:sequence>\n<xs:element name=\"group\" type=\"xs:anyURI\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:element name=\"mbs-explicitMuSiK-download\" type=\"mcpttmbs:mbs-explicit-ctrlkey-downloadType\"/>\n<xs:complexType name=\"mbs-explicit-ctrlkey-downloadType\">\n<xs:sequence>\n<xs:element name=\"group\" type=\"xs:anyURI\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbs:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<!-- anyEXT elements for the mcptt-mbs-usage-info – end -->\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2A.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <mcptt-mbs-usage-info> element is the root element of the XML document. The <mcptt-mbs-usage-info> element contains the subelements:\n1)\t<mbs-listening-status> contains subelements as specified <mbms-listening-status> in clause F.2.3 with the terminology mapping specified in clause L.3.4;\n2)\t<mbs-session-de-announcement-status>: contains the following subelements:\na)\t<mbs-session-de-announcement-status>: element is a string used to indicate the MBS sessions intended deletion status:\n-\tThe value \"deleting\" indicates that the MC client UE has decided to stop monitoring the broadcast MBS session or leaves the multicast MBS session.\n-\tThe value \"not-deleting\" indicates that the MC client UE has decided to revoke its decision to stop monitoring the broadcast MBS session or leaves the multicast MBS session.\nb)\t<number-of-reported-sessions>: a hex binary number denoting the total number of occurrences of the <deleted-mbs-session-id> and <other-mbs-session-id> elements reported as part of the MBS session de-announcement status;\nc)\t<deleted-mbs-session-id>: contains a MBS session ID that is being reported as about to be deleted or as no longer about to be deleted; and\nd)\t<other-mbs-session-id>: contains a MBS session ID that is not being reported as about to be deleted or as no longer about to be deleted;\n3)\t<ue-session-join-notification> containing the following elements:\na)\t<mbs-multicast-joining-status> element contains a string used to indicate the MCPTT join MBS session status:\n-\tThe value \"ue-session-join\" indicates that a MCPTT client joins an MBS session, i.e. the MCPTT client indicates to MCPTT server that such MCPTT client wants to receive multicast data identified by a specific MBS session ID.\n-\tThe value \"ue-session-leave\" indicates that a MCPTT client leaves a MBS session, i.e. the MCPTT client no longer wants to receive multicast data identified by a specific MBS session ID.\nb)\t<mbs-session-id>: element is coded as described in 3GPP TS 23.247 [91] clause 6.5.1. The MBS session ID is used to identify a Multicast/Broadcast MBS session by the 5G system on external interface towards AF and between AF and UE, and towards the UE;\nc)\t<session-id> element contains the value of the URI received in the Contact header field received from the controlling MCPTT function when an on-demand session was established, or from the participating MCPTT function in the Connect message when the session was established over a pre-established session. This element is mandatory if the <mbs-multicast-joining-status> element is not present in the application/vnd.3gpp.mcptt-mms-usage-info+xml MIME body.\n4)\t<announcement> element containing <mbs-session-infoType> and <eMBMS-bearer-infoType>.\na)\t<mbs-session-infoType> element containing the following elements:\ni)\t<mbs-session-id>: element is coded as described in 3GPP TS 23.247 [91] clause 6.5.1. The MBS session ID is used to identify a Multicast/Broadcast MBS Session by the 5G system on external interface towards AF and between AF and UE, and towards the UE;\nii)\t<mbs-session-mode>: element is a string used to indicate the service type of the MBS session, either a multicast MBS session or a broadcast MBS session:\niii)\t<mc-service-group-id>: element is a string used to indicate the MC service group ID associated to the MBS session;\niv)\t<GPMS>\telement is a positive integer that gives the number of the media line containing the general purpose MBS subchannel in the application/sdp MIME body attached to the SIP MESSAGE request containing the MBS announcement;\nv)\t<mbs-service-areas>: element is a list of MBS service area IDs for the applicable MBS multicast area as specified in 3GPP TS 23.247 [91] for Service Area Identifier (SAI);\nvi)\t<report-ue-session-join-notification>: element is a boolean with the following meaning:\n-\tTrue indicates that the MC service server requires a notification from the MC service client once it has joined the multicast MBS session.\n-\tFalse indicates that the MC service server not requires a notification from the MC service client once it has joined the multicast MBS session; and\nvii)\t<multicast-mbs-session-related-info> that can contain:\n-\tshall contain an optional element specifying a PLMN Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\n-\tshall contain an <IPInformation> element containing (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\n-\tshall contain a <DNN> element (see the MCPTT user profile document in 3GPP TS 24.484 [50]); and\n-\tshall containan a <MC-ID-ref-SNSSAI> element (see the MCPTT user profile document in 3GPP TS 24.484 [50]);\nviii)\t<mbs-fsa-id>: contains the MBS Frequency Selection Area ID. The <mbs-fsa-id> element is coded as described in 3GPP TS 23.247 [91] clause 6.5.4. The MBS Frequency Selection Area (FSA) ID is used for broadcast MBS session to guide the frequency selection of the UE.MBS FSA ID identifies a preconfigured area within, and in proximity to, which the cell(s) announces the MBS FSA ID and the associating frequency. MBS FSA ID and their mapping to frequencies are provided to RAN nodes via OAM;\nix)\t<frequency>: element containing identification of frequency in case of multi carrier support. The <frequency> element is coded as specified in 3GPP TS 29.468 [42]; and\nNOTE 1:\tIn the current release the frequency in the <frequency> element is the same as the frequency used for unicast.\nx)\t<mbs-session-de-announcement-acknowledgement>: element is a boolean with the following meaning:\n-\tTrue indicates that the MCPTT client is instructed to notify the MCPTT server when it becomes aware of an intended change in the de-announcement status of a listened MBS session.\n-\tFalse indicates that the MCPTT client is instructed not to notify the MCPTT server if it becomes aware of an intended change in the de-announcement status of a listened MBS session.\nb)\t<eMBMS-bearer-infoType> element as specified in clause F.2.3 <announcement> elements with the following clarifications/exceptions:\ni)\t<Alternative-TMGI>: contains a list of additional alternative TMGI which may be included and used in roaming scenarios;\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2A.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Editor’s note: The MIME type \"application/vnd.3gpp.mcptt-mbs-usage-info+xml\" as defined in this subclause is to be registered in the IANA registry for Application Media Types based upon the following template. The registration is to be started after completion of release 18.\nYour Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-mbs-usage-info+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 18.x.x, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type for application/vnd.3gpp.mcptt-mbms-usage-info+xml.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema attributeFormDefault=\"unqualified\" elementFormDefault=\"qualified\"\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:mcpttMbmsUsage:1.0\"\nxmlns:mcpttmbms=\"urn:3gpp:ns:mcpttMbmsUsage:1.0\">\n<!-- the root element -->\n<xs:element name=\"mcptt-mbms-usage-info\" type=\"mcpttmbms:mcptt-mbms-usage-info-Type\" id=\"mbms\"/>\n<xs:complexType name=\"mcptt-mbms-usage-info-Type\">\n<xs:sequence>\n<xs:element name=\"mbms-listening-status\" type=\"mcpttmbms:mbms-listening-statusType\" \n\tminOccurs=\"0\"/>\n<xs:element name=\"mbms-suspension-status\" type=\"mcpttmbms:mbms-suspension-statusType\" \n\tminOccurs=\"0\"/>\n<xs:element name=\"announcement\" type=\"mcpttmbms:announcementTypeParams\" minOccurs=\"0\"/>\n<xs:element name=\"version\" type=\"xs:integer\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- anyEXT elements for the mbms-listening-status element – begin -->\n<xs:element name=\"mbms-reception-quality\" type=\"xs:integer\"/>\n<!-- anyEXT elements for the mbms-listening-status element – end -->\n\n<xs:complexType name=\"mbms-listening-statusType\">\n<xs:sequence>\n<xs:element name=\"mbms-listening-status\" type=\"xs:string\"/>\n<xs:element name=\"session-id\" type=\"xs:anyURI\" minOccurs=\"0\"/>\n<xs:element name=\"general-purpose\" type=\"xs:boolean\" minOccurs=\"0\"/>\n<xs:element name=\"TMGI\" type=\"xs:hexBinary\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"mbms-suspension-statusType\">\n<xs:sequence>\n<xs:element name=\"mbms-suspension-status\" type=\"xs:string\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"number-of-reported-bearers\" type=\"xs:integer\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"suspended-TMGI\" type=\"xs:hexBinary\" minOccurs=\"0\"/>\n<xs:element name=\"other-TMGI\" type=\"xs:hexBinary\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"announcementTypeParams\">\n<xs:sequence>\n<xs:element name=\"TMGI\" type=\"xs:hexBinary\" minOccurs=\"1\"/>\n<xs:element name=\"QCI\" type=\"xs:integer\" minOccurs=\"0\"/>\n<xs:element name=\"frequency\" type=\"xs:unsignedLong\" minOccurs=\"0\"/>\n<xs:element name=\"mbms-service-areas\" type=\"mcpttmbms:mbms-service-areasType\" minOccurs=\"0\"/>\n<xs:element name=\"GPMS\" type=\"xs:positiveInteger\" minOccurs=\"0\"/>\n<xs:element name=\"report-suspension\" type=\"xs:boolean\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- anyEXT elements for the announcement element – begin -->\n<xs:element name=\"mcptt-mbms-rohc\" type=\"mcpttmbms:emptyType\"/>\n<!-- empty complex type -->\n<xs:complexType name=\"emptyType\"/>\n\n<xs:element name=\"max-cid\" type=\"mcpttmbms:max-cidType\"/>\n<xs:simpleType name=\"max-cidType\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"1\"/>\n<xs:maxInclusive value=\"16383\"/>\n</xs:restriction>\n</xs:simpleType>\n<!-- anyEXT elements for the announcement element – end -->\n<xs:complexType name=\"mbms-service-areasType\">\n<xs:sequence>\n<xs:element name=\"mbms-service-area-id\" type=\"xs:hexBinary\"\n\tminOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute/>\n</xs:complexType>\n\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n<!-- anyEXT elements for the mcptt-mbms-usage-info – begin -->\n<xs:element name=\"mbms-defaultMuSiK-download\" type=\"mcpttmbms:mbms-default-ctrlkey-downloadType\"/>\n<xs:complexType name=\"mbms-default-ctrlkey-downloadType\">\n<xs:sequence>\n<xs:element name=\"group\" type=\"xs:anyURI\"\n\t\tminOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:element name=\"mbms-explicitMuSiK-download\" type=\"mcpttmbms:mbms-explicit-ctrlkey-downloadType\"/>\n<xs:complexType name=\"mbms-explicit-ctrlkey-downloadType\">\n<xs:sequence>\n<xs:element name=\"group\" type=\"xs:anyURI\"\n\t\tminOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttmbms:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- anyEXT elements for the mcptt-mbms-usage-info – end -->\n\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <mcptt-mbms-usage-info> element is the root element of the XML document. The <mcptt-mbms-usage-info> element contains the subelements:\n1)\t<mbms-listening-status> containing the following elements:\na)\t<mbms-listening-status> element contains a string used to indicate the MCPTT listening status:\n-\tThe value \"listening\" indicates that the MCPTT client now is receiving RTP media packets and floor control messages over the MBMS subchannel in the session identified by the <session-id> element or if the <general-purpose> element is set to \"true\", that the MCPTT client is now listening to the general purpose MBMS subchannel.\n-\tThe value \"not-listening\" indicates that the MCPTT client has stopped listening to the MBMS subchannel in the session identified by the <session-id> element or, if the <general-purpose> element is set to \"false\", that the MCPTT client no longer listens to the general purpose MBMS subchannel.\nTable F.2.3-1 shows the ABNF of the <mbms-listening-status> element.\nTable F.2.3-1: ABNF syntax of values of the <mbms-listening-status> element\nmbms-listening-status = listening-value / not-listening-value\nlistening-value = %x6c.69.73.74.65.6e.69.6e.67 ; \"listening\"\nnot-listening-value = %x6e.6f.74.2d.6c.69.73.74.65.6e.69.6e.67 ; \"not-listening\"\n\nb)\t<session-id> element contains the value of the URI received in the Contact header field received from the controlling MCPTT function when an on-demand session was established, or from the participating MCPTT function in the Connect message when the session was established over a pre-established session. This element is mandatory if the <general-purpose> element is not present in the application/vnd.3gpp.mcptt-mbms-usage-info+xml MIME body.\nc)\t<general-purpose> element is a boolean with the following meaning:\n-\tTrue indicates that the MCPTT client is listening to the general purpose MBMS subchannel associated to the TMGI(s) in the <TMGI> element(s) but have not yet received a Map Group To bearer message for any session that the MCPTT client is involved in.\n-\tFalse indicates that the MCPTT client is not listening to the general purpose MBMS subchannel any longer.\nAbsence of the <general-purpose> element requires that the <session-id> element is present in the application/vnd.3gpp.mcptt-mbms-usage-info+xml;\nd)\t<TMGI>: element contains the TMGI. The <TMGI> element is coded as described in 3GPP TS 24.008 [43] clause 10.5.6.13 excluding the Temporary Mobile Group Identity IEI and Length of Temporary Mobile Group Identity contents (octet 1 and octet 2 in 3GPP TS 24.008 [43] clause 10.5.6.13) ; and\ne)\t<anyExt> element containing an <mbms-reception-quality> element. The <mbms-reception-quality> element is an integer in the value range 0-5, 5 indicating the best quality. The value \"2\" is the lowest value where the UE receives satisfactory voice quality;\n2)\t<mbms-suspension-status>: contains the following subelements:\na)\t<mbms-suspension-status>: element is a string used to indicate the MBMS bearers intended suspension status:\n-\tThe value \"suspending\" indicates that the RAN has decided to suspend the referenced MBMS bearer(s) at the beginning of the next MCCH modification period.\n-\tThe value \"not-suspending\" indicates that the RAN has decided to revoke its decision to suspend the referenced MBMS bearer(s) before the beginning of the next MCCH modification period.\nTable F.2.3-2 shows the ABNF of the <mbms-suspension-status> element.\nTable F.2.3-2: ABNF syntax of values of the <mbms-suspension-status> element\nmbms-suspension-status = suspending-value / not-suspending-value\nsuspending-value = %x73.75.73.70.65.6e.64.69.6e.67 ; \"suspending\"\nnot-suspending-value = %x6e.6f.74.2d.73.75.73.70.65.6e.64.69.6e.67 ; \"not-suspending\"\n\nb)\t<number-of-reported-bearers>: a hex binary number denoting the total number of occurrences of the <suspended-TMGI> and <other-TMGI> elements reported as part of the MBMS bearer suspension status;\nc)\t<suspended-TMGI>: contains a TMGI that is being reported as about to be suspended or as no longer about to be suspended; and\nd)\t<other-TMGI>: contains a TMGI that is not being reported as about to be suspended or as no longer about to be suspended, but which shares the same MCH with MBMS bearers reported in the <suspended-TMGI> elements;\n3)\t<announcement> element containing the following elements:\na)\t<TMGI>: contains the TMGI. The <TMGI> element is coded as described in 3GPP TS 24.008 [43] clause 10.5.6.13 excluding the Temporary Mobile Group Identity IEI and Length of Temporary Mobile Group Identity contents (octet 1 and octet 2 in 3GPP TS 24.008 [43] clause 10.5.6.13);\nb)\t<QCI>: element contains QCI information used by the ProSe UE-Network Relay to determine the ProSe Per-Packet Priority value to be applied for the multicast packets relayed to Remote UE over PC5. QCI values are defined in 3GPP TS 23.203 [41];\nc)\t<frequency>: element containing identification of frequency in case of multi carrier support. The <frequency> element is coded as specified in 3GPP TS 29.468 [42];\nNOTE 1:\tIn the current release the frequency in the <frequency> element is the same as the frequency used for unicast.\nd)\t<mbms-service-areas>:element is a list of MBMS service area IDs for the applicable MBMS broadcast area as specified in 3GPP TS 23.003 [40] for Service Area Identifier (SAI), and with the encoding as specified in 3GPP TS 29.061 [74] for the MBMS-Service-Area AVP;\ne)\t<GPMS>\telement is a positive integer that gives the number of the media line containing the general purpose MBMS subchannel in the application/sdp MIME body attached to the SIP MESSAGE request containing the MBMS announcements;\nf)\t<report-suspension>: element is a boolean with the following meaning:\n-\tTrue indicates that the MCPTT client is instructed to notify the MCPTT server when it becomes aware of an intended change in the suspension status of a listened MBMS bearer.\n-\tFalse indicates that the MCPTT client is instructed not to notify the MCPTT server if it becomes aware of an intended change in the suspension status of a listened MBMS bearer ; and\ng)\t<anyExt> element can contain the following elements not shown in the XML schema:\ni)\t<mcptt-mbms-rohc> element: presence of the <mcptt-mbms-rohc> element indicates that the flows delivered by the announced MBMS bearer are header compressed with ROHC as specified in RFC 5795 [80] and RFC 3095 [81]; and\nii)\t<max-cid> element: of type integer restricted to the range 1 to 16383 indicating the maximum CID value that can be used by the header compressor, see clause 5.1.2 in RFC 5795 [80]). If max-cid > 15 then the header compressor uses the large CID representation. Else, the header compressor uses the small CID representation;\n4)\t<version> is an element of type \"xs:integer\" indicating the version of the application/vnd.3gpp.mbms-usage-info MIME body. In this version the <version element> indicates \"1\"; and\n5)\t<anyExt> element can contain the following elements not shown in the XML schema:\na)\t<mbms-defaultMuSiK-download> that can contain:\ni)\ta <group> element containing the identity, in the form of a URI, of a group for which the MuSiK download is performed; and\nb)\t<mbms-explicitMuSiK-download> that can contain:\ni)\ta <group> element containing the identity, in the form of a URI, of a group for which the MuSiK download is performed.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.2.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-mbms-usage-info+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.0.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.3\tXML schema for MCPTT location information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.3.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines the XML schema and the MIME type for location information.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:mcpttloc=\"urn:3gpp:ns:mcpttLocationInfo:1.0\" targetNamespace=\"urn:3gpp:ns:mcpttLocationInfo:1.0\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\"\nxmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\">\n\n<xs:import namespace=\"http://www.w3.org/2001/04/xmlenc#\"/>\n\n<xs:element name=\"location-info\" id=\"loc\">\n<xs:annotation>\n<xs:documentation>Root element, contains all information related to location configuration, location request and location reporting for the MCPTT service</xs:documentation>\n</xs:annotation>\n<xs:complexType>\n<xs:choice>\n<xs:element name=\"Configuration\" type=\"mcpttloc:tConfigurationType\"/>\n<xs:element name=\"Request\" type=\"mcpttloc:tRequestType\"/>\n<xs:element name=\"Report\" type=\"mcpttloc:tReportType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n</xs:element>\n<xs:complexType name=\"tConfigurationType\">\n<xs:sequence>\n<xs:element name=\"NonEmergencyLocationInformation\" type=\"mcpttloc:tRequestedLocationType\" minOccurs=\"0\"/>\n<xs:element name=\"EmergencyLocationInformation\" type=\"mcpttloc:tRequestedLocationType\" minOccurs=\"0\"/>\n<xs:element name=\"TriggeringCriteria\" type=\"mcpttloc:TriggeringCriteriaType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:attribute name=\"ConfigScope\">\n<xs:simpleType>\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"Full\"/>\n<xs:enumeration value=\"Update\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:attribute>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tRequestType\">\n<xs:complexContent>\n<xs:extension base=\"mcpttloc:tEmptyType\">\n<xs:attribute name=\"RequestId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:complexContent>\n</xs:complexType>\n<xs:complexType name=\"tReportType\">\n<xs:sequence>\n<xs:element name=\"TriggerId\" type=\"xs:string\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"CurrentLocation\" type=\"mcpttloc:tCurrentLocationType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:attribute name=\"ReportID\" type=\"xs:string\" use=\"optional\"/>\n<xs:attribute name=\"ReportType\" use=\"required\">\n<xs:simpleType>\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"Emergency\"/>\n<xs:enumeration value=\"NonEmergency\"/>\n</xs:restriction>\n</xs:simpleType>\n</xs:attribute>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"TriggeringCriteriaType\">\n<xs:sequence>\n<xs:element name=\"CellChange\" type=\"mcpttloc:tCellChange\" minOccurs=\"0\"/>\n<xs:element name=\"TrackingAreaChange\" type=\"mcpttloc:tTrackingAreaChangeType\" minOccurs=\"0\"/>\n<xs:element name=\"PlmnChange\" type=\"mcpttloc:tPlmnChangeType\" minOccurs=\"0\"/>\n<xs:element name=\"MbmsSaChange\" type=\"mcpttloc:tMbmsSaChangeType\" minOccurs=\"0\"/>\n<xs:element name=\"MbsfnAreaChange\" type=\"mcpttloc:tMbsfnAreaChangeType\" minOccurs=\"0\"/>\n<xs:element name=\"PeriodicReport\" type=\"mcpttloc:tIntegerAttributeType\" minOccurs=\"0\"/>\n<xs:element name=\"TravelledDistance\" type=\"mcpttloc:tIntegerAttributeType\" minOccurs=\"0\"/>\n<xs:element name=\"McpttSignallingEvent\" type=\"mcpttloc:tSignallingEventType\" minOccurs=\"0\"/>\n<xs:element name=\"GeographicalAreaChange\" type=\"mcpttloc:tGeographicalAreaChange\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<!-- anyExt elements for \"TriggeringCriteriaType\" -->\n<xs:element name=\"RatTypeChange\" type=\"mcpttloc:tRatTypeChange\"/>\n\n<xs:complexType name=\"tCellChange\">\n<xs:sequence>\n<xs:element name=\"AnyCellChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"EnterSpecificCell\" type=\"mcpttloc:tSpecificCellType\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"ExitSpecificCell\" type=\"mcpttloc:tSpecificCellType\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tEmptyType\"/>\n<xs:simpleType name=\"tEcgi\">\n<xs:restriction base=\"xs:string\">\n<xs:pattern value=\"\\d{3}\\d{3}[0-1]{28}\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tSpecificCellType\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttloc:tEcgi\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tEmptyTypeAttribute\">\n<xs:complexContent>\n<xs:extension base=\"mcpttloc:tEmptyType\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:complexContent>\n</xs:complexType>\n<xs:complexType name=\"tTrackingAreaChangeType\">\n<xs:sequence>\n<xs:element name=\"AnyTrackingAreaChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"EnterSpecificTrackingArea\" type=\"mcpttloc:tTrackingAreaIdentity\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"ExitSpecificTrackingArea\" type=\"mcpttloc:tTrackingAreaIdentity\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:simpleType name=\"tTrackingAreaIdentityFormat\">\n<xs:restriction base=\"xs:string\">\n<xs:pattern value=\"\\d{3}\\d{3}[0-1]{16}\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tTrackingAreaIdentity\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttloc:tTrackingAreaIdentityFormat\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tPlmnChangeType\">\n<xs:sequence>\n<xs:element name=\"AnyPlmnChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"EnterSpecificPlmn\" type=\"mcpttloc:tPlmnIdentity\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"ExitSpecificPlmn\" type=\"mcpttloc:tPlmnIdentity\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:simpleType name=\"tPlmnIdentityFormat\">\n<xs:restriction base=\"xs:string\">\n<xs:pattern value=\"\\d{3}\\d{3}\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tPlmnIdentity\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttloc:tPlmnIdentityFormat\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tMbmsSaChangeType\">\n<xs:sequence>\n<xs:element name=\"AnyMbmsSaChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"EnterSpecificMbmsSa\" type=\"mcpttloc:tMbmsSaIdentity\" minOccurs=\"0\"/>\n<xs:element name=\"ExitSpecificMbmsSa\" type=\"mcpttloc:tMbmsSaIdentity\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:simpleType name=\"tMbmsSaIdentityFormat\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"0\"/>\n<xs:maxInclusive value=\"65535\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tMbmsSaIdentity\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttloc:tMbmsSaIdentityFormat\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tMbsfnAreaChangeType\">\n<xs:sequence>\n<xs:element name=\"EnterSpecificMbsfnArea\" type=\"mcpttloc:tMbsfnAreaIdentity\" minOccurs=\"0\"/>\n<xs:element name=\"ExitSpecificMbsfnArea\" type=\"mcpttloc:tMbsfnAreaIdentity\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:simpleType name=\"tMbsfnAreaIdentityFormat\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"0\"/>\n<xs:maxInclusive value=\"255\"/>\n</xs:restriction>\n</xs:simpleType>\n<xs:complexType name=\"tMbsfnAreaIdentity\">\n<xs:simpleContent>\n<xs:extension base=\"mcpttloc:tMbsfnAreaIdentityFormat\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tIntegerAttributeType\">\n<xs:simpleContent>\n<xs:extension base=\"xs:integer\">\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n</xs:extension>\n</xs:simpleContent>\n</xs:complexType>\n<xs:complexType name=\"tTravelledDistanceType\">\n<xs:sequence>\n<xs:element name=\"TravelledDistance\" type=\"xs:positiveInteger\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tSignallingEventType\">\n<xs:sequence>\n<xs:element name=\"InitialLogOn\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"GroupCallNonEmergency\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"PrivateCallNonEmergency\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"LocationConfigurationReceived\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<!-- anyExt elements for \"tSignallingEventType\" -->\n<xs:element name=\"FunctionalAliasActivation\" type=\"mcpttloc:tEmptyTypeAttribute\"/>\n<xs:element name=\"FunctionalAliasDeactivation\" type=\"mcpttloc:tEmptyTypeAttribute\"/>\n\n<xs:complexType name=\"tEmergencyEventType\">\n<xs:sequence>\n<xs:element name=\"GroupCallEmergency\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"GroupCallImminentPeril\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"PrivateCallEmergency\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"InitiateEmergencyAlert\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tRequestedLocationType\">\n<xs:sequence>\n<xs:element name=\"ServingEcgi\" type=\"mcpttloc:tEmptyType\" minOccurs=\"0\"/>\n<xs:element name=\"NeighbouringEcgi\" type=\"mcpttloc:tEmptyType\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"MbmsSaId\" type=\"mcpttloc:tEmptyType\" minOccurs=\"0\"/>\n<xs:element name=\"MbsfnArea\" type=\"mcpttloc:tEmptyType\" minOccurs=\"0\"/>\n<xs:element name=\"GeographicalCoordinate\" type=\"mcpttloc:tEmptyType\" minOccurs=\"0\"/>\n<xs:element name=\"minimumIntervalLength\" type=\"xs:positiveInteger\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"tCurrentLocationType\">\n<xs:sequence>\n<xs:element name=\"CurrentServingEcgi\" type=\"mcpttloc:tLocationType\" minOccurs=\"0\"/>\n<xs:element name=\"NeighbouringEcgi\" type=\"mcpttloc:tLocationType\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"MbmsSaId\" type=\"mcpttloc:tLocationType\" minOccurs=\"0\"/>\n<xs:element name=\"MbsfnArea\" type=\"mcpttloc:tLocationType\" minOccurs=\"0\"/>\n<xs:element name=\"CurrentCoordinate\" type=\"mcpttloc:tPointCoordinate\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- anyExt elements for \"tCurrentLocationType\" -->\n<xs:element name=\"locTimestamp\" type=\"xs:dateTime\"/>\n<xs:element name=\"FunctionalAlias\" type=\"xs:anyURI\"/>\n<xs:element name=\"InterRatType\" type=\"mcpttloc:tInterRatType\"/>\n\n<xs:simpleType name=\"tInterRatType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"5G-MBS-to-LTE-MBMS\"/>\n<xs:enumeration value=\"5G-MBS-to-LTE-unicast\"/>\n<xs:enumeration value=\"LTE-MBMS-to-5G-MBS\"/>\n<xs:enumeration value=\"LTE-MBMS-to-5G-unicast\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:simpleType name=\"protectionType\">\n<xs:restriction base=\"xs:string\">\n<xs:enumeration value=\"Normal\"/>\n<xs:enumeration value=\"Encrypted\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:complexType name=\"tLocationType\">\n<xs:choice minOccurs=\"1\" maxOccurs=\"1\">\n<xs:element name=\"Ecgi\" type=\"mcpttloc:tEcgi\" minOccurs=\"0\"/>\n<xs:element name=\"SaId\" type=\"mcpttloc:tMbmsSaIdentity\" minOccurs=\"0\"/>\n<xs:element name=\"MbsfnAreaId\" type=\"mcpttloc:tMbsfnAreaIdentity\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:attribute name=\"type\" type=\"mcpttloc:protectionType\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"tGeographicalAreaChange\">\n<xs:sequence>\n<xs:element name=\"AnyAreaChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:element name=\"EnterSpecificAreaType\" type=\"mcpttloc:tSpecificAreaType\" minOccurs=\"0\"/>\n<xs:element name=\"ExitSpecificAreaType\" type=\"mcpttloc:tSpecificAreaType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tSpecificAreaType\">\n<xs:sequence>\n<xs:element name=\"GeographicalArea\" type=\"mcpttloc:tGeographicalAreaDef\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:attribute name=\"TriggerId\" type=\"xs:string\" use=\"required\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"tRatTypeChange\">\n<xs:sequence>\n<xs:element name=\"AnyRatTypeChange\" type=\"mcpttloc:tEmptyTypeAttribute\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n\n<xs:complexType name=\"tPointCoordinate\">\n<xs:sequence>\n<xs:element name=\"longitude\" type=\"mcpttloc:tCoordinateType\"/>\n<xs:element name=\"latitude\" type=\"mcpttloc:tCoordinateType\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- anyExt elements for \"tPointCoordinate\" -->\n<xs:element name=\"altitude\" type=\"mcpttloc:tCoordinateType2Bytes\"/>\n<xs:element name=\"horizontalaccuracy\" type=\"mcpttloc:tCoordinateType1Byte\"/>\n<xs:element name=\"verticalaccuracy\" type=\"mcpttloc:tCoordinateType1Byte\"/>\n\n<xs:complexType name=\"tCoordinateType\">\n<xs:choice minOccurs=\"1\" maxOccurs=\"1\">\n<xs:element name=\"threebytes\" type=\"mcpttloc:tThreeByteType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:attribute name=\"type\" type=\"mcpttloc:protectionType\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"tCoordinateType2Bytes\">\n<xs:choice minOccurs=\"1\" maxOccurs=\"1\">\n<xs:element name=\"twobytes\" type=\"mcpttloc:tTwoByteType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:attribute name=\"type\" type=\"mcpttloc:protectionType\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"tCoordinateType1Byte\">\n<xs:choice minOccurs=\"1\" maxOccurs=\"1\">\n<xs:element name=\"onebyteunsignedhalfrange\" type=\"mcpttloc:tOneByteUnsignedHalfRangeType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:choice>\n<xs:attribute name=\"type\" type=\"mcpttloc:protectionType\"/>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:simpleType name=\"tThreeByteType\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"0\"/>\n<xs:maxInclusive value=\"16777215\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:simpleType name=\"tTwoByteType\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"-32768\"/>\n<xs:maxInclusive value=\"32767\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:simpleType name=\"tOneByteUnsignedHalfRangeType\">\n<xs:restriction base=\"xs:integer\">\n<xs:minInclusive value=\"0\"/>\n<xs:maxInclusive value=\"127\"/>\n</xs:restriction>\n</xs:simpleType>\n\n<xs:complexType name=\"tGeographicalAreaDef\">\n<xs:sequence>\n<xs:element name=\"PolygonArea\" type=\"mcpttloc:tPolygonAreaType\" minOccurs=\"0\"/>\n<xs:element name=\"EllipsoidArcArea\" type=\"mcpttloc:tEllipsoidArcType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tPolygonAreaType\">\n<xs:sequence>\n<xs:element name=\"Corner\" type=\"mcpttloc:tPointCoordinate\" minOccurs=\"3\" maxOccurs=\"15\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"tEllipsoidArcType\">\n<xs:sequence>\n<xs:element name=\"Center\" type=\"mcpttloc:tPointCoordinate\"/>\n<xs:element name=\"Radius\" type=\"xs:nonNegativeInteger\"/>\n<xs:element name=\"OffsetAngle\" type=\"xs:unsignedByte\"/>\n<xs:element name=\"IncludedAngle\" type=\"xs:unsignedByte\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttloc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n<!-- anyEXT elements for the Configuration element – begin -->\n<xs:element name=\"EmergencyTriggeringCriteria\" type=\"mcpttloc:TriggeringCriteriaType\"/>\n<!-- anyEXT elements for the Configuration element – end -->\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <location-info> element is the root element of the XML document. The <location-info> element contains the <Configuration>, <Request> and <Report> subelements, of which only one can be present.\n<Configuration> element has a <ConfigScope> attribute that can assume the values \"Full\" and \"Update\". The value \"Full\" means that the Configuration> element contains the full location configuration which replaces any previous location configuration. The value \"Update\" means that the location configuration is in addition to any previous location configuration. To remove configuration elements a \"Full\" configuration is needed. The <Configuration> element contains the following child elements:\n1)\t<NonEmergencyLocationInformation>, an optional element that specifies the location information requested in non-emergency situations. The <NonEmergencyLocationInformation> has the subelements:\na)\t<ServingEcgi>, an optional element specifying that the serving E-UTRAN Cell Global Identity (ECGI) needs to be reported;\nb)\t<NeighbouringEcgi>, an optional element that can occur multiple times, specifying that neighbouring ECGIs need to be reported;\nc)\t<MbmsSaId>, an optional element specifying that the serving MBMS Service Area Id needs to be reported;\nd)\t<MbsfnArea>, an optional element specifying that the MBSFN area Id needs to be reported;\ne)\t<GeographicalCoordinate>, an optional element specifying that the geographical coordinate specified in clause 6.1 in 3GPP TS 23.032 [54] needs to be reported; and\nf)\t<minimumIntervalLength>, a mandatory element specifying the minimum time the MCPTT client needs to wait between sending location reports. The value is given in seconds;\n2)\t<EmergencyLocationInformation>, an optional element that specifies the location information requested in emergency situations. The <EmergencyLocationInformation> has the subelements:\na)\t<ServingEcgi>, an optional element specifying that the serving ECGI needs to be reported;\nb)\t<NeighbouringEcgi>, an optional element that can occur multiple times, specifying that neighbouring ECGIs need to be reported;\nc)\t<MbmsSaId>, an optional element specifying that the serving MBMS Service Area Id needs to be reported;\nd)\t<MbsfnArea>, an optional element specifying that the MBSFN area Id needs to be reported;\ne)\t<GeographicalCoordinate>, an optional element specifying that the geographical coordinate specified in clause 6.1 in 3GPP TS 23.032 [54] needs to be reported; and\nf)\t<minimumIntervalLength>, a mandatory element specifying the minimum time the MCPTT client needs to wait between sending location reports. The value is given in seconds;\n3)\t<TriggeringCriteria>, a mandatory element specifying the triggers for the MCPTT client to perform reporting in non emergency status. The <TriggeringCriteria> element contains the following sub-elements:\na)\t<CellChange>, an optional element specifying what cell changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyCellChange>, an optional element. The presence of this element specifies that any cell change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificCell>, an optional element specifying an ECGI which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIII)\t<ExitSpecificCell>, an optional element specifying an ECGI which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nb)\t<TrackingAreaChange>, an optional element specifying what tracking area changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyTrackingAreaChange>, an optional element. The presence of this element specifies that any tracking area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificTrackingArea>, an optional element specifying a Tracking Area Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIII)\t<ExitSpecificTrackingArea>, an optional element specifying a Tracking Area Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nc)\t<PlmnChange>, an optional element specifying what PLMN changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyPlmnChange>, an optional element. The presence of this element specifies that any PLMN change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificPlmn>, an optional element specifying a PLMN Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIII)\t<ExitSpecificPlmn>, an optional element specifying a PLMN Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nd)\t<MbmsSaChange>, an optional element specifying what MBMS changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyMbmsSaChange>, an optional element. The presence of this element specifies that any MBMS SA change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificMbmsSa>, an optional element specifying an MBMS Service Area Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIII)\t<ExitSpecificMbmsSa>, an optional element specifying an MBMS Service Area Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\ne)\t<MbsfnAreaChange>, an optional element specifying what MBSFN changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyMbsfnAreaChange>, an optional element. The presence of this element specifies that any MBSFN area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificMbsfnArea>, an optional element specifying an MBSFN area which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIII)\t<ExitSpecificMbsfnArea>, an optional element specifying an MBSFN area which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nf)\t<PeriodicReport>, an optional element specifying that periodic location reports shall be sent. The value in seconds specifies the reporting interval. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\ng)\t<TravelledDistance>, an optional element specifying that the travelled distance shall trigger a report. The value in metres specified the travelled distance. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nh)\t<McpttSignallingEvent>, an optional element specifying what signalling events triggers a location report. The <McpttSignallingEvent> element has the following sub-elements:\nI)\t<InitialLogOn>, an optional element specifying that an initial log on triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<GroupCallNonEmergency>, an optional element specifying that a non-emergency group call triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nIII)\t<PrivateCallNonEmergency>, an optional element specifying that a non-emergency private call triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nIV)\t<LocationConfigurationReceived>, an optional element specifying that a received location configuration triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nV) <anyExt>, an optional element containing:\nA)\tan optional <FunctionalAliasActivation> element specifying that a Functional Alias activation triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nB)\tan optional element <FunctionalAliasDeactivation> specifying that a Functional Alias deactivation triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\ni)\t<GeographicalAreaChange>, an optional element specifying what geographical are changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyAreaChange>, an optional element. The presence of this element specifies that any geographical area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<EnterSpecificArea>, an optional element specifying a geographical area which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string. The <EnterSpecificArea> element has the following sub-elements:\nA)\t<GeographicalArea>, an optional element containing a <TriggerId> attribute and the following two subelements:\nx1)\t<PolygonArea>, an optional element specifying the area as a polygon specified in clause 5.4 in 3GPP TS 23.032 [54]; and\nx2)\t<EllipsoidArcArea>, an optional element specifying the area as an Ellipsoid Arc specified in clause 5.7 in 3GPP TS 23.032 [54]; and\nIII)\t<ExitSpecificAreaType>, an optional element specifying a geographical area which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nj)\t<RatTypeChange>, an optional element specifying what inter-RAT changes trigger location reporting. Consists of the following sub-elements:\nI)\t<AnyRatTypeChange>, an optional element. The presence of this element specifies that the inter-system RAT changes is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\n4)\tthe <anyExt> shall be included with the following element not declared in the XML schema:\na)\t<EmergencyTriggeringCriteria>, a mandatory element specifying the triggers for the MCPTT client to perform reporting in emergency status. The <EmergencyTriggeringCriteria> element contains the following sub-elements:\nI)\t<CellChange>, an optional element specifying what cell changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyCellChange>, an optional element. The presence of this element specifies that any cell change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificCell>, an optional element specifying an ECGI which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nC)\t<ExitSpecificCell>, an optional element specifying an ECGI which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nII)\t<TrackingAreaChange>, an optional element specifying what tracking area changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyTrackingAreaChange>, an optional element. The presence of this element specifies that any tracking area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificTrackingArea>, an optional element specifying a Tracking Area Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nC)\t<ExitSpecificTrackingArea>, an optional element specifying a Tracking Area Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nIII)\t<PlmnChange>, an optional element specifying what PLMN changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyPlmnChange>, an optional element. The presence of this element specifies that any PLMN change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificPlmn>, an optional element specifying a PLMN Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nC)\t<ExitSpecificPlmn>, an optional element specifying a PLMN Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nIV)\t<MbmsSaChange>, an optional element specifying what MBMS changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyMbmsSaChange>, an optional element. The presence of this element specifies that any MBMS SA change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificMbmsSa>, an optional element specifying an MBMS Service Area Id which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nC)\t<ExitSpecificMbmsSa>, an optional element specifying an MBMS Service Area Id which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nV)\t<MbsfnAreaChange>, an optional element specifying what MBSFN changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyMbsfnAreaChange>, an optional element. The presence of this element specifies that any MBSFN area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificMbsfnArea>, an optional element specifying an MBSFN area which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nC)\t<ExitSpecificMbsfnArea>, an optional element specifying an MBSFN area which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nVI)\t<PeriodicReport>, an optional element specifying that periodic location reports shall be sent. The value in seconds specifies the reporting interval. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nVII)\t<TravelledDistance>, an optional element specifying that the travelled distance shall trigger a report. The value in metres specified the travelled distance. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nVIII)\t<McpttSignallingEvent>, an optional element specifying what signalling events triggers a location report. The <McpttSignallingEvent> element has the following sub-elements:\nA)\t<InitialLogOn>, an optional element specifying that an initial log on triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<GroupCallNonEmergency>, an optional element specifying that a non-emergency group call triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nC)\t<PrivateCallNonEmergency>, an optional element specifying that a non-emergency private call triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nD)\t<LocationConfigurationReceived>, an optional element specifying that a received location configuration triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string; and\nIX)\t<GeographicalAreaChange>, an optional element specifying what geographical are changes trigger location reporting. Consists of the following sub-elements:\nA)\t<AnyAreaChange>, an optional element. The presence of this element specifies that any geographical area change is a trigger. Contains a mandatory <TriggerId> attribute that shall be set to a unique string;\nB)\t<EnterSpecificArea>, an optional element specifying a geographical area which when entered triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string. The <EnterSpecificArea> element has the following sub-elements:\nx1)\t<GeographicalArea>, an optional element containing a <TriggerId> attribute and the following two subelements:\ni1)\t<PolygonArea>, an optional element specifying the area as a polygon specified in clause 5.4 in 3GPP TS 23.032 [54]; and\ni2)\t<EllipsoidArcArea>, an optional element specifying the area as an Ellipsoid Arc specified in clause 5.7 in 3GPP TS 23.032 [54]; and\nC)\t<ExitSpecificAreaType>, an optional element specifying a geographical area which when exited triggers a location report. Contains a mandatory <TriggerId> attribute that shall be set to a unique string.\n<Request> is an element with a <RequestId> attribute. The <Request> element is used to request a location report. The value of the <RequestId> attribute is returned in the corresponding <ReportId> attribute in order to correlate the request and the report.\n<Report> is an element used to include the location report. It contains a <ReportId> attribute and a <ReportType> attribute. The <ReportId> attribute is used to return the value in the <RequestId> attribute in the <Request> element. The <ReportType> attribute has two values \"Emergency\" and \"NonEmergency\" used to inform whether the client is sending the report in an emergency situation or not. The <Report> element contains the following sub-elements:\n1)\t<TriggerId>, an optional element which can occur multiple times that contain the value of the <TriggerId> attribute associated with a trigger that has fired; and\n2)\t<CurrentLocation>, a mandatory element that contains the location information. The <CurrentLocation> element contains the following sub-elements:\na)\t<CurrentServingEcgi>, an optional element containing the ECGI of the serving cell;\nb)\t<NeighbouringEcgi>, an optional element that can occur multiple times. It contains the ECGI of any neighbouring cell the MCPTT client can detect;\nc)\t<MbmsSaId>, an optional element containing the MBMS Service Area Id the MCPTT client is using;\nd)\t<MbsfnArea>, an optional element containing the MBSFN area the MCPTT is located in;\ne)\t<CurrentCoordinate>, an optional element containing:\ni)\tthe longitude and latitude coded as in clause 6.1 in 3GPP TS 23.032 [54]; and\nii)\tan optional <anyExt> element containing:\nA)\tan <altitude> element where the <twobytes> subelement is coded as in clause 6.3 in 3GPP TS 23.032 [54];\nB)\tan optional <horizontalaccuracy> element where the <onebyteunsignedhalfrange> subelement is coded as in clause 6.2 in 3GPP TS 23.032 [54], which describes the uncertainty for latitude and longitude; and\nC)\tan optional <verticalaccuracy> element where the <onebyteunsignedhalfrange> subelement is coded as in clause 6.2 in 3GPP TS 23.032 [54], which describes the uncertainty for altitude; and\nf)\t<anyExt>, an optional element containing:\ni)\tan optional <locTimestamp> element containing the date and time the location measurement was made;\nii)\tan optional <FunctionalAlias> element containing the functional alias status change that tiggered the location measurement; and\niii)\tan optional <InterRatType> element containing the inter-RAT change type. The <InterRatType> element set to:\nA)\t\"5G-MBS-to-LTE-MBMS\" when the inter-system switching from 5G MBS session to LTE MBMS bearer;\nB)\t\"5G-MBS-to-LTE-unicast\" when the inter-system switching from 5G MBS session to LTE unicast bearer;\nC)\t\"LTE-MBMS-to-5G-MBS\" when the inter-system switching from LTE MBMS to 5G MBS session; or\nD)\t\"LTE-MBMS-to-5G-unicast\" when the inter-system switching from LTE MBMS to 5G unicast PDU session.\nThe contents of the subelements in the <CurrentLocation> subelement of the <Report> element can be encrypted. The following rules are applied when any of these elements are included:\n1)\tif confidentiality protection is not required, then:\na)\tthe \"type\" attributes associated with the <CurrentServingEcgi>, <NeighbouringEcgi>, <MbmsSaId>, and <MbsfnArea> elements of the <Report> element have the value \"Normal\" and\ni)\tthe <Ecgi> subelement of the <CurrentServingEcgi> element contains the unencrypted value of the ECGI of the serving cell;\nii)\tthe <Ecgi> subelement of the <NeighbouringEcgi> element contains the unencrypted value of the ECGI of any neighbouring cell;\niii)\tthe <SaId> subelement of the <MbmsSaId> element contains the unencrypted value of the MBMS Service Area Id the MCPTT client is using; and\niv)\tthe <MbsfnAreaId> subelement of the <MbsfnArea>, element contains the unencrypted value of the MBSFN area the MCPTT is located in; and\nb)\tthe \"type\" attributes associated with the <longitude>, <latitude>, <altitude>, <horizontalaccuracy>, and <verticalaccuracy> subelements of the <CurrentCoordinate> element have the value \"Normal\" and the <three-bytes> subelements of <longitude> and <latitude> subelements, the <twobytes> subelement of the <altitude> subelement, the <onebyteunsignedhalfrange> subelement of the <horizontalaccuracy>, and the <onebyteunsignedhalfrange> subelement of the <verticalaccuracy> subelement contain the unencrypted value of longitude, latitude, altitude, horizontalaccuracy, and verticalaccuracy; and\n2)\tif confidentiality protection is required, then:\na)\tthe \"type\" attributes associated with the <CurrentServingEcgi>, <NeighbouringEcgi>, <MbmsSaId>, and <MbsfnArea> elements have the value \"Encrypted\";\nb)\tthe \"type\" attributes associated with the <longitude>, <latitude>, <altitude>, <horizontalaccuracy>, and <verticalaccuracy> subelements of the <CurrentCoordinate> element have the value \"Encrypted\"; and\nc)\tfor each of the elements described in 2a) and subelements described in 2b) above, the <xenc:EncryptedData> element from the \"\" namespace is included and:\ni)\tcan have a \"Type\" attribute can be included with a value of \"\";\nii)\tcan include an <EncryptionMethod> element with the \"Algorithm\" attribute set to value of \"http://www.w3.org/2009/xmlenc11#aes128-gcm\";\niii)\tcan include a <KeyInfo> element with a <KeyName> element containing the base 64 encoded XPK-ID; and\niv)\tincludes a <CipherData> element with a <CipherValue> element containing the encrypted data.\nNOTE:\tWhen the optional attributes and elements are not included within the <xenc:EncryptedData> element, the information they contain is known to sender and the receiver by other means.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.3.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp. mcptt-location-info+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.0.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.4\tXML schema for MCPTT (de)-affiliation requests",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.4.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type for MCPTT (de)-affiliation requests.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:affiliationCommand:1.0\"\nxmlns:mcpttaff=\"urn:3gpp:ns:affiliationCommand:1.0\"\nattributeFormDefault=\"unqualified\" elementFormDefault=\"qualified\">\n<xs:complexType name=\"affiliate-command\" id=\"affil\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"group\" minOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttaff:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"de-affiliate-command\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"group\" minOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttaff:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:element name=\"command-list\">\n<xs:complexType>\n<xs:sequence>\n<xs:element name=\"affiliate\" type=\"mcpttaff:affiliate-command\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"de-affiliate\" type=\"mcpttaff:de-affiliate-command\" minOccurs=\"0\" maxOccurs=\"1\"/>\n<xs:element name=\"anyExt\" type=\"mcpttaff:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n</xs:element>\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <command-list> element is the root element of the XML document. The <command-list> element may contain <affiliate-command>, or <de-affiliate-command> subelements or both.\nIf the <command-list> contains the <affiliate-command> element then:\n1)\tthe <affiliate-command> element contains a list of <group> subelements having at least one subelement. The recipient shall perform an affiliation for all the MCPTT groups contained in the list for the clients for which the <command-list> applies.\nIf the <command-list> contains the <de-affiliate-command> element then:\n1)\tthe <de-affiliate-command> element contains a list of <group> subelements having at least one subelement. The recipient shall perform a de-affiliation for all the MCPTT groups contained in the list for the clients for which the <command-list> applies.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.4.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-affiliation-command+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.0.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.5\tXML schema for the floor request",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.5.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines XML schema and MIME type for application/vnd.3gpp.mcptt-floor-request+xml.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.5.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema attributeFormDefault=\"unqualified\" elementFormDefault=\"qualified\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" targetNamespace=\"urn:3gpp:ns:mcpttFloorRequest:1.0\" xmlns:mcpttfloor=\"urn:3gpp:ns:mcpttFloorRequest:1.0\">\n<!-- the root element -->\n<xs:element name=\"mcptt-floor-request\" type=\"mcpttfloor:mcptt-floor-request-Type\" minOccurs=\"1\" maxOccurs=\"2\"/>\n<xs:complexType name=\"mcptt-floor-request-Type\">\n<xs:sequence>\n<xs:element name=\"floor-type\" type=\"xs:string\"/>\n<xs:element name=\"ssrc\" type=\"xs:unsignedLong\"/>\n<xs:element name=\"floor-priority\" type=\"xs:unsignedByte\"/>\n<xs:element name=\"user-id\" type=\"xs:anyURI\"/>\n<xs:element name=\"track-info\" type=\"mcpttfloor:track-info-Type\"/>\n<xs:element name=\"floor-indicator\" type=\"xs:unsignedLong\"/>\n<xs:element name=\"anyExt\" type=\"mcpttfloor:anyExtType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n<xs:complexType name=\"track-info-Type\">\n<xs:sequence>\n<xs:element name=\"queueing-capability\" type=\"xs:byte\"/>\n<xs:element name=\"participant-type\" type=\"xs:string\"/>\n<xs:element name=\"floor-participant-reference\" type=\"xs:unsignedLong\" minOccurs=\"1\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttfloor:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.5.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause describes the elements of the floor request XML Schema.\n<floor-type>\tContains information about which floor the current speaker was using. The value \"general is selected when the current speaker has permission to speak in on the general floor as specified in 3GPP TS 24.380 [5] clause 6.3.4. The value \"dual\" is selected when the current speaker has permission to speak in on the dual floor as specified in 3GPP TS 24.380 [5] clause 6.3.6.\nTable F.5.3-1 shows the ABNF of the <floor-type> element.\nTable F.5.3-1: ABNF syntax of values of the <floor-type> element\nfloor-type-value = general-value / dual-value\ngeneral-value = %x67.65.6e.65.72.62.6c ; \"general\"\ndual-value = %x64.75.61.6c ; \"dual\"\n\n<ssrc>:\tContains the SSRC of the floor participant. The content of the SSRC field shall be coded as specified in IETF RFC 3550 [10].\n<floor-priority>:\tContains the level of priority of the floor request. The <floor-priority> element is coded as specified in 3GPP TS 24.380 [5].\n<user-id>:\tContains the MCPTT ID of the MCPTT user requesting the permission to send media.\n<track-info>:\tContains the <queueing-capability> element, the <participant-type> element and the <floor-participant-reference>.\n<floor-indicator>:\tContains additional information. The <floor-indicator> element is coded as specified in 3GPP TS 24.380 [5].\n<participant-type>:\tContains the participant type assigned to the MCPTT user identified by the <user-id> element. The <participant-type> element is coded as specified in 3GPP TS 24.380 [5].\nNOTE:\tThe reference to the floor participant is a value only understandable by the floor control server interface in the non-Controlling function of an MCPTT group.\n<queueing-capability>:\tContains the queueing capability of the MCPTT client. The <queueing-capability> element is coded as specified in 3GPP TS 24.380 [5].\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.5.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-floor-request+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.0.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.6\tXML schema for integrity protection of MIME bodies",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.6.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines the XML schema and the MIME type vnd.3gpp.mcptt-signed+xml, for integrity protection of MIME bodies used in the present document.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.6.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema\nxmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:mcpttSignedDoc:1.0\"\nxmlns:mcpttsigneddoc=\"urn:3gpp:ns:mcpttSignedDoc:1.0\"\nelementFormDefault=\"qualified\"\nattributeFormDefault=\"unqualified\"\nxmlns:xmldsig=\"http://www.w3.org/2000/09/xmldsig#\">\n\n<xs:import namespace=\"http://www.w3.org/2000/09/xmldsig#\" \n    schemaLocation=\"http://www.w3.org/TR/xmldsig-core/xmldsig-core-schema.xsd\"/>\n\n<xs:complexType name=\"signaturesType\">\n<xs:sequence>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttsigneddoc:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<!-- root XML element when creating a signed XML document -->\n<xs:element name=\"signatures\" type=\"mcpttsigneddoc:signaturesType\"/>\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.6.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "When integrity protection is turned on, the vnd.3gpp.mcptt-signed+xml MIME body is included when sending MIME bodies containing XML content in SIP requests and SIP responses.\nThe <signatures> element is the root element of the XML document.\nNOTE 1:\tThe subelements of the <signatures> element are validated by the <xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> particle of the <signatures> element\nAn instance of the <signatures> element contains one or more instances of the <xmldsig:Signature> element from the  namespace. The <xmldsig:Signature> element validates against the <xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/> element.\nEach <xmldsig:Signature> element contains the following child elements:\n1)\ta <xmldsig:SignatureValue> element is included with a signature value;\n2)\ta <xmldsig:SignedInfo> element can be included and can contain the following child elements:\na)\ta <xmldsig:CanonicalizationMethod> element can be included with an \"Algorithm\" attribute containing an appropriate canonicalisation method to be applied to the signed information;\nb)\ta <xmldsig:SignatureMethod> element can be included with an \"Algorithm\" attribute containing an appropriate algorithm for the signature; and\nNOTE 2:\tFor signatures, it is assumed that HMAC-SHA256 is supported by the sender and the receiver.\nc)\ta <xmldsig:Reference> element can be included and can contain the following child elements:\ni)\ta \"URI\" attribute can be included with a \"cid-URL\" referring to an XML MIME body containing a Content-ID set to the \"cid-URL\"\nii)\ta <xmldsig:DigestMethod> element can be included referring to an appropriate method for hashing the content; and\nNOTE 3:\tFor hashing of the content, it is assumed that SHA-256 is supported by the sender and the receiver.\niii)\ta <xmldsig:DigestValue> element can be included containing the hashed content; and\n3)\ta <xmldsig:KeyInfo> element can be included with a <xmldsig:KeyName> element containing the base 64 encoded XPK-ID.\nNOTE 4:\tWhen the optional attributes and elements are not included within the <xmldsig:Signature> element, the information they contain is known to sender and the receiver by other means.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.6.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Your Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-signed+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 13.1.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "F.7\tXML schema for regroup using preconfigured group",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "F.7.1\tGeneral",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause defines the XML schema and MIME type for regroup using preconfigured group.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.7.2\tXML schema",
                    "description": "",
                    "summary": "",
                    "text_content": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\ntargetNamespace=\"urn:3gpp:ns:preconfiguredRegroup:1.0\"\nxmlns:mcpttrgrp=\"urn:3gpp:ns:preconfiguredRegroup:1.0\"\nattributeFormDefault=\"unqualified\" elementFormDefault=\"qualified\">\n\n<!-- root XML element -->\n<xs:element name=\"mcpttregroup\" type=\"mcpttrgrp:mcpttregroup-Type\" id=\"info\"/>\n\n<xs:complexType name=\"mcpttregroup-Type\">\n<xs:sequence>\n<xs:element name=\"mcpttregroup-Params\" type=\"mcpttrgrp:mcpttregroup-ParamsType\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"mcpttregroup-ParamsType\">\n<xs:sequence>\n<xs:element name=\"preconfig-group-id\" type=\"mcpttrgrp:preconfig-group-Type\"/>\n<xs:element name=\"mcptt-regroup-uri\" type=\"mcpttrgrp:mcptt-regroup-uri-Type\"/>\n<xs:element name=\"groups-for-regroup\" type=\"mcpttrgrp:groups-for-regroup-Type\" minOccurs=\"0\"/>\n<xs:element name=\"users-for-regroup\" type=\"mcpttrgrp:users-for-regroup-Type\" minOccurs=\"0\"/>\n<xs:element name=\"regroup-action\" type=\"xs:string\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"preconfig-group-Type\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"preconfigured-group\" minOccurs=\"0\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"mcptt-regroup-uri-Type\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"mcptt-regroup-uri\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"groups-for-regroup-Type\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"group\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"users-for-regroup-Type\">\n<xs:sequence>\n<xs:element type=\"xs:anyURI\" name=\"user\" maxOccurs=\"unbounded\"/>\n<xs:any namespace=\"##other\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n<xs:element name=\"anyExt\" type=\"mcpttrgrp:anyExtType\" minOccurs=\"0\"/>\n</xs:sequence>\n<xs:anyAttribute namespace=\"##any\" processContents=\"lax\"/>\n</xs:complexType>\n\n<xs:complexType name=\"anyExtType\">\n<xs:sequence>\n<xs:any namespace=\"##any\" processContents=\"lax\" minOccurs=\"0\" maxOccurs=\"unbounded\"/>\n</xs:sequence>\n</xs:complexType>\n\n</xs:schema>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.7.3\tSemantic",
                    "description": "",
                    "summary": "",
                    "text_content": "The <preconfigured-group> element shall contain a URI identifying the preconfigured MCPTT group.\nThe <mcptt-regroup-uri> element shall contain a URI containing the temporary group identity identifying the regroup.\nThe <groups-for-regroup> element shall contain one or more <group> elements that shall each contain a URI of a group that is to be a constituent group of the regroup.\nThe <users-for-regroup> element shall contain one or more <user> elements that shall each contain an MCPTT ID of a user that is to be affiliated to the regroup.\nThe XML document shall have either one <groups-for-regroup> element or one <users-for-regroup> element, but not both.\nIf the <regroup-action> element contains the string \"create\" then:\n1)\tif a <groups-for-regroup> element exists in the received XML, then:\na)\tif the recipient is the controlling MCPTT function for the MCPTT group identified in the <preconfigured-group> element the recipient shall follow the procedures to create a group regroup with identity equal to the value contained in the <mcptt-regroup-uri> element based on the configuration of the preconfigured MCPTT group identified in the <preconfigured-group> element;\nb)\tif the recipient is a non-controlling MCPTT function, the recipient shall follow the procedures to affiliate users belonging to any constituent groups of the group regroup with identity equal to the value contained in the <mcptt-regroup-uri> element based on the configuration of the preconfigured MCPTT group identified in the <preconfigured-group> element; and\nc)\tif the recipient is the terminating participating MCPTT function for one or more MCPTT users affiliated to a constituent group of the group regroup, the recipient shall follow the procedures to notify each MCPTT user in the list of users in the <users-for-regroup> element that it serves of the group regroup and affiliate those users to the group regroup; and\n2)\tif a <users-for-regroup> element exists in the received XML, then:\na)\tif the recipient is the controlling MCPTT function for the MCPTT group identified in the <preconfigured-group> element, the recipient shall follow the procedures to create a user regroup with identity equal to the value contained in the <mcptt-regroup-uri> element based on the configuration of the preconfigured MCPTT group identified in the <preconfigured-group> element; and\nb)\tif the recipient is the terminating participating MCPTT function for one or more MCPTT users identified in the <users-for-regroup> element, the recipient shall follow the procedures to notify each MCPTT user in the list of users in the <users-for-regroup> element that it serves of the user regroup and affiliate those users to the user regroup.\nIf the <regroup-action> element contains the string \"remove\" then:\n1)\tthe recipient shall follow the procedures to remove the regroup identified in the <mcptt-regroup-uri> element.\nThe recipient of the XML ignores any unknown element and any unknown attribute.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "F.7.4\tIANA registration template",
                    "description": "",
                    "summary": "",
                    "text_content": "Editor's Note:\t[enh2MCPTT-CT, CR 0529] MCC is requested to submit the IANA registration for this media type after the completion of 3GPP release 16.\nYour Name:\n<MCC name>\nYour Email Address:\n<MCC email address>\nMedia Type Name:\nApplication\nSubtype name:\nvnd.3gpp.mcptt-regroup+xml\nRequired parameters:\nNone\nOptional parameters:\n\"charset\"\tthe parameter has identical semantics to the charset parameter of the \"application/xml\" media type as specified in section 9.1 of IETF RFC 7303.\nEncoding considerations:\nbinary.\nSecurity considerations:\nSame as general security considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. In addition, this media type provides a format for exchanging information in SIP, so the security considerations from IETF RFC 3261 apply.\nThe information transported in this media type does not include active or executable content.\nMechanisms for privacy and integrity protection of protocol parameters exist. Those mechanisms as well as authentication and further security mechanisms are described in 3GPP TS 24.229.\nThis media type does not include provisions for directives that institute actions on a recipient's files or other resources.\nThis media type does not include provisions for directives that institute actions that, while not directly harmful to the recipient, may result in disclosure of information that either facilitates a subsequent attack or else violates a recipient's privacy in any way.\nThis media type does not employ compression.\nInteroperability considerations:\nSame as general interoperability considerations for application/xml media type as specified in section 9.1 of IETF RFC 7303. Any unknown XML elements and any unknown XML attributes are to be ignored by recipient of the MIME body.\nPublished specification:\n3GPP TS 24.379 \"Mission Critical Push To Talk (MCPTT) call control\" version 16.2.0, available via http://www.3gpp.org/specs/numbering.htm.\nApplications which use this media type:\nApplications supporting the mission critical push to talk as described in the published specification.\nFragment identifier considerations:\nThe handling in section 5 of IETF RFC 7303 applies.\nRestrictions on usage:\nNone\nProvisional registration? (standards tree only):\nN/A\nAdditional information:\n1.\tDeprecated alias names for this type: none\n2.\tMagic number(s): none\n3.\tFile extension(s): none\n4.\tMacintosh File Type Code(s): none\n5.\tObject Identifier(s) or OID(s): none\nIntended usage:\nCommon\nPerson to contact for further information:\n-\tName: <MCC name>\n-\tEmail: <MCC email address>\n-\tAuthor/Change controller:\ni)\tAuthor: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1@LIST.ETSI.ORG\nii)\tChange controller: <MCC name>/<MCC email address>\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        },
        {
            "title": "G.1\tMCPTT emergency state",
            "description": "The MCPTT emergency state is managed by the MCPTT client and MCPTT user. High-level characteristics of this state are captured in table G-1.1.\nTable G.1-1: MCPTT emergency state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.1-1: MCPTT emergency state",
                    "table number": 69,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.2\tIn-progress emergency group state",
            "description": "This state is described in both 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3]. It is managed by the controlling MCPTT function. High-level characteristics of this state are captured in table G.2-1.\nTable G.2-1: in-progress emergency group state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.2-1: in-progress emergency group state",
                    "table number": 70,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.3\tMCPTT emergency group state",
            "description": "The MCPTT emergency group state is the MCPTT client's perspective of the in-progress emergency group state which is managed by the controlling MCPTT function. The MCPTT emergency group (MEG) state is managed by the MCPTT client to enable the requesting of MCPTT emergency-level priority as early as possible in the origination of an MCPTT emergency group call. High-level characteristics of this state are captured in table G.3-1.\nTable G.3-1: MCPTT emergency group state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.3-1: MCPTT emergency group state",
                    "table number": 71,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.4\tMCPTT emergency group call state",
            "description": "Table G.4-1 provides the semantics of the MCPTT emergency group call (MEGC) state values. This internal state of the MCPTT client and is managed by the MCPTT client. These states aid in the managing of the information elements of MCPTT emergency group calls and MCPTT emergency alerts and their cancellations.\nTable G.4-1: MCPTT emergency group call state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.4-1: MCPTT emergency group call state",
                    "table number": 72,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.5\tMCPTT emergency alert state",
            "description": "Table G.5-1provides the semantics of the MCPTT emergency alert (MEA) state values. This is an internal state of the MCPTT client and is managed by the MCPTT client. These states aid in the managing of the information elements of MCPTT emergency group calls and MCPTT emergency alerts and their cancellations.\nTable G.5-1: MCPTT emergency alert state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.5-1: MCPTT emergency alert state",
                    "table number": 73,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.6\tIn-progress imminent peril group state",
            "description": "This state is described in both 3GPP TS 22.179 [2] and 3GPP TS 23.379 [3]. It is managed by the controlling MCPTT function. High-level characteristics of this state are captured in table G.6-1.\nTable G.6-1: in-progress imminent peril group state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.6-1: in-progress imminent peril group state",
                    "table number": 74,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.7\tMCPTT imminent peril group state",
            "description": "The MCPTT imminent peril group state is the MCPTT client's perspective of the in-progress imminent peril group state which is managed by the controlling MCPTT function. The MCPTT imminent peril group (MIG) state is managed by the MCPTT client to enable the requesting of MCPTT imminent peril-level priority as early as possible in the origination of an MCPTT imminent peril group call. High-level characteristics of this state are captured in table G.7-1.\nTable G.7-1: MCPTT imminent peril group state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.7-1: MCPTT imminent peril group state",
                    "table number": 75,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.8\tMCPTT imminent peril group call state",
            "description": "Table G.8-1 provides the semantics of the MCPTT imminent peril group call (MIGC) state values. This internal state of the MCPTT client and is managed by the MCPTT client. These states aid in the managing of the information elements of MCPTT imminent peril group calls and their cancellations.\nTable G.8-1: MCPTT imminent peril group call state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.8-1: MCPTT imminent peril group call state",
                    "table number": 76,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.9\tIn-progress emergency private call state",
            "description": "This state is managed by the controlling MCPTT function. All private calls originated between an initiator and the target MCPTT user when they are in an in-progress emergency private call state are MCPTT emergency private calls until this state is cancelled, whether or not the originator of the private call is in an MCPTT emergency state.\nTable G.9-1: in-progress emergency private call state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.9-1: in-progress emergency private call state",
                    "table number": 77,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.10\tMCPTT emergency private priority state",
            "description": "The MCPTT emergency private priority state is the MCPTT client's perspective of the in-progress emergency private call state which is managed by the controlling MCPTT function. The MCPTT emergency private priority (MEPP) state is managed by the MCPTT client to enable the requesting of MCPTT emergency-level priority as early as possible in the origination of an MCPTT emergency private call. High-level characteristics of this state are captured in table G.10-1.\nTable G.10-1: MCPTT emergency private priority state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.10-1: MCPTT emergency private priority state",
                    "table number": 78,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.11\tMCPTT emergency private call state",
            "description": "Table G.11-1 provides the semantics of the MCPTT emergency private call (MEPC) state values. This is an internal state of the MCPTT client and is managed by the MCPTT client. This state aids in the managing of the information elements of MCPTT emergency private calls and MCPTT emergency alerts and their cancellations.\nTable G.11-1: MCPTT emergency private call state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.11-1: MCPTT emergency private call state",
                    "table number": 79,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.12\tMCPTT private emergency alert state",
            "description": "Table G.5-1provides the semantics of the MCPTT private emergency alert (MPEA) state values. This is an internal state of the MCPTT client and is managed by the MCPTT client. These states aid in the managing of the information elements of MCPTT emergency private calls and MCPTT emergency alerts and their cancellations. MCPTT private emergency alerts are targeted to an MCPTT user.\nTable G.12-1: MCPTT private emergency alert state\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.12-1: MCPTT private emergency alert state",
                    "table number": 80,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "G.13\tPrivate call call-back state information",
            "description": "Table G.13-1 provides the semantics of the private call call-back state values that are managed by an MCPTT client that initiates a private call call-back request or a private call call-back cancel request. Such a client is known as a requesting MCPTT client.\nTable G.13-2 provides the semantics of the private call call-back state values that are managed by an MCPTT client that receives a private call call-back request or a private call call-back cancel request. Such a client is known as a target MCPTT client.\nTable G.13-1: MCPTT private call call-back requesting client states\n\nTable G.13-2: MCPTT private call call-back target client states\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table G.13-1: MCPTT private call call-back requesting client states",
                    "table number": 81,
                    "summary": "",
                    "name": ""
                },
                {
                    "description": "Table G.13-2: MCPTT private call call-back target client states",
                    "table number": 82,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.1\tGeneral",
            "description": "The following clauses summarise the identities placed into SIP headers and SIP bodies during session establishment.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.2\tGroup Call",
            "description": "Table H.2-1 describes the contents of the SIP headers and SIP bodies inserted by MCPTT clients and MCPTT servers involved in a group call.\nTable H.2-1: Routing considerations for group call\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table H.2-1: Routing considerations for group call",
                    "table number": 83,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "H.3\tPrivate Call",
            "description": "Table H.3-1 describes the contents of the SIP headers and SIP bodies inserted by MCPTT clients and MCPTT servers involved in a private call.\nTable H.3-1: Routing considerations for private call\n\n",
            "summary": "",
            "tables": [
                {
                    "description": "Table H.3-1: Routing considerations for private call",
                    "table number": 84,
                    "summary": "",
                    "name": ""
                }
            ],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.1\tGeneral",
            "description": "The following clauses describe the message coding rules for the MCPTT Off-Network Protocol (MONP).\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "I.2\tMONP messages",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "I.2.1\tComponents of a MONP message",
                    "description": "",
                    "summary": "",
                    "text_content": "A standard MONP message consists of an imperative part, itself composed of a header and the rest of imperative part, followed by a non-imperative part. Both the non-header part of the imperative part and the non-imperative part are composed of successive parts referred as standard information elements.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "I.2.2\tFormat of standard information elements",
                    "description": "",
                    "summary": "",
                    "text_content": "A standard IE may have the following parts, in that order:\n-\tan information element identifier (IEI);\n-\ta length indicator (LI);\n-\ta value part.\nA standard IE has one of the formats shown in table I.2.2-1:\nTable I.2.2-1: Formats of information elements\n\nSome IEs may appear in the structure, but not in all instances of messages. An IE is then said to be present or not present in the message instance. If an IE is not present in a message instance, none of the three parts is present. Otherwise, parts must be present according to the IE format.\nIn the message structure, an IE that is allowed not to be present in all message instances is said not to be mandatory. Other IEs are said to be mandatory.\n",
                    "tables": [
                        {
                            "description": "Table I.2.2-1: Formats of information elements",
                            "table number": 85,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "I.2.2.1\tInformation element type and value part",
                            "text_content": "Every standard IE has an information element type which determines the values possible for the value part of the IE, and the basic meaning of the information. The information element type describes only the value part. Standard IEs of the same information element type may appear with different formats. The format used for a given standard IE in a given message is specified within the description of the message.\nThe value part of a standard IE either consists of a half octet or one or more octets; the value part of a standard IE with format LV or TLV consists of an integral number of octets, between 0 and 255 inclusive; it then may be empty, i.e., consist of zero octets; if it consists of a half octet and has format TV, its IEI consists of a half octet, too. For LV-E and TLV-E, the value part of a standard IE consists of an integral number of octets, between 0 and 65535 inclusive. The value part of a standard IE may be further structured into parts, called fields.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.2\tLength indicator",
                            "text_content": "For LV or TLV, the length indicator (LI) of a standard IE consists of one octet. For LV-E and TLV-E, the LI of a standard IE consists of two octets where bit 8 of octet n contains the most significant bit and bit 1 of octet n+1 contains the least significant bit (refer to figure I.2.2.4-9 in clause I.2.2.4 for the relative ordering of the 2 octets). The LI contains the binary encoding of the number of octets of the IE value part. The LI of a standard IE with empty value part indicates 0 octets. Standard IE of an information element type such that the possible values may have different values must be formatted with a length field, i.e., LV, TLV, LV-E or TLV-E.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.3\tInformation element identifier",
                            "text_content": "When present, the IEI of a standard IE consists of a half octet or one octet. A standard IE with IEI consisting of a half octet has format TV, and its value part consists of a half octet. The value of the IEI depends on the standard IE, not on its information element type. The IEI, if any, of a given standard IE in a given message is specified within the description of the message. In some protocol specifications, default IEI values can be indicated. They are to be used if not indicated in the message specification. Non mandatory standard IE in a given message, i.e., IE which may be not be present (formally, for which the null string is acceptable in the message), must be formatted with an IEI, i.e., with format T, TV, TLV or TLV-E.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.4\tCategories of IEs; order of occurrence of IEI, LI, and value part",
                            "text_content": "The following categories of standard information elements are defined:\n-\tinformation elements of format V or TV with value part consisting of 1/2 octet (type 1);\n-\tinformation elements of format T with value part consisting of 0 octets (type 2);\n-\tinformation elements of format V or TV with value part that has fixed length of at least one octet (type 3);\n-\tinformation elements of format LV or TLV with value part consisting of zero, one or more octets (type 4)\n-\tinformation elements of format LV-E or TLV-E with value part consisting of zero, one or more octets and a maximum of 65535 octets (type 6).\nNOTE:\tThe \"types\" and \"formats\" used for MONP match those defined in 3GPP TS 24.007 [56];\nType 1 standard information elements of format V provide the value in bit positions 8, 7, 6, 5 of an octet (see figure I.2.2.4-1) or bits 4, 3, 2, 1 of an octet (see figure I.2.2.4-2).\nThe figure depicts a Type 1 IE of format V, which is a type of optical fiber connector used in telecommunication networks. The connector is designed to support high-speed data transmission and is commonly used in fiber-optic cables. The figure shows the various components of the connector, including the male and female connectors, the locking mechanism, and the protective cover. The Type 1 IE of format V is a crucial component in the telecommunication industry, enabling the efficient transmission of data over long distances.\nFigure I.2.2.4-1: Type 1 IE of format V\nThe figure depicts a Type 1 IE of format V, which is a type of optical fiber connector used in telecommunication networks. It is characterized by its rectangular shape and is commonly used for connecting optical fibers to other optical fibers or to other devices. The figure shows the various components and connections involved in the optical fiber connector, including the connector body, the locking ring, and the locking pin. The figure is important for understanding the structure and function of optical fiber connectors in telecommunication networks.\nFigure I.2.2.4-2: Type 1 IE of format V\nType 1 standard information elements of format TV have an IEI of a half octet length; they provide the IEI in bit positions 8, 7, 6, 5 of an octet and the value part in bit positions 4, 3, 2, 1 of the same octet, see figure I.2.2.4-3.\nThe figure depicts a Type 1 IE of format TV, which is a type of electronic display device. It is characterized by its rectangular shape and the presence of a central screen, surrounded by a bezel. The device is designed to display images and video content, and it is commonly used in various applications such as home entertainment systems, educational tools, and gaming consoles. The figure provides a visual representation of the device's design and features, allowing viewers to understand its structure and functionality.\nFigure I.2.2.4-3: Type 1 IE of format TV\nA type 2 standard IE has format T; its IEI consists of one octet, its value part is empty, see figure I.2.2.3-4.\nThe figure depicts a Type 2 IE (Intermediate Earth Station) with a 100-km-long microwave link, illustrating the transmission of signals from the Earth to the satellite. The figure includes various components such as the satellite, ground station, and the microwave link, highlighting the importance of proper communication infrastructure in ensuring reliable and efficient communication.\nFigure I.2.2.4-4: Type 2 IE\nA type 3 standard information element has format V or TV; if it has format TV, its IEI consists of one octet and proceeds the value part in the IE. The value part consists of at least one octet. See figure I.2.2.4-5 and figure I.2.2.4-6.\nThe figure depicts a type 3 IE of format V, which is a type of IE used in the context of a format V. The figure shows the different types of IE (Type 1, Type 2, and Type 3) and their corresponding formats (V, V, and V). The figure is important for understanding the different types of IE used in the format V and their corresponding formats.\nFigure I.2.2.4-5: Type 3 IE of format V (k = 0, 1, 2, ...)\nThe figure depicts a type 3 IE of format TV, with a k value ranging from 1 to 6, indicating the number of input/output (I/O) ports. The figure illustrates the various types of I/O ports, such as HDMI, VGA, and USB, and their corresponding connections. The presence of a power supply and a cable connector further emphasizes the functionality of the device.\nFigure I.2.2.4-6: Type 3 IE of format TV (k = 1, 2, ...)\nA type 4 standard information element has format LV or TLV. Its LI precedes the value part, which consists of zero, one, or more octets; if present, its IEI has one octet length and precedes the LI. See figure I.2.2.4-7 and figure I.2.2.4-8.\nThe figure depicts a type 4 IE of format LV, with k values ranging from 0 to 2, indicating the number of layers in the optical fiber. The figure illustrates the various types of optical fibers used in the system, including single-mode, multimode, and polarization-maintaining fibers. The figure also includes a legend to help understand the different types of fibers and their respective properties.\nFigure I.2.2.4-7: Type 4 IE of format LV (k = 0, 1, 2, ...)\nThe figure depicts a Type 4 IE of format TLV (k = 1, 2, ...), which is a key component in the format of a Type 4 IE (TLV) in the context of the telecommunication industry. The figure illustrates the structure and components of the TLV format, including the number of fields (k), the type of field (TLV), and the length of the field (k). The TLV format is used to store data in a hierarchical manner, with each field representing a sub-type of data. The figure provides a clear and concise representation of the Type 4 IE format, making it useful for understanding the structure and components of this telecommunication figure.\nFigure I.2.2.4-8: Type 4 IE of format TLV (k = 1, 2, ...)\nA type 6 standard information element has format TLV-E. The IEI has one octet length and precedes the LI of 2 octets and the value part which consists of zero, one or up to 65535 octets. See figure I.2.2.4-9 and figure I.2.2.4-10.\nThe figure depicts a type 6 IE of format LV-E (k = 1, 2, ...), which is a type of optical fiber connector used in telecommunication networks. The figure shows the various types of connectors, including Type 6, Type 10, and Type 16, and their corresponding connectors. The connectors are shown in different colors and sizes, indicating their different functionalities. The figure is used to illustrate the different types of connectors used in telecommunication networks, allowing for better understanding of the optical fiber connector system.\nFigure I.2.2.4-9: Type 6 IE of format LV-E (k = 1, 2, ...)\n\nThe figure depicts a Type 6 IE of format TLV-E (k = 1, 2, ...), which is a key component in the context of network protocols and data structures. The figure illustrates the structure of the TLV-E type, which is used to store data in a hierarchical format. The figure includes various elements such as the type of data, the number of elements, and the format of the data. This information is crucial for understanding the data structure and its use in network protocols.\nFigure I.2.2.4-10: Type 6 IE of format TLV-E (k = 1, 2, ...)\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.5\tMethod for IE structure",
                            "text_content": "Standard IEs can be further structured in parts called fields and represented in a tabular form.\nThe IE is presented in its maximum format, i.e., T, TV, TLV or TLV-E, in a picture representing the bits in a table, each line representing an octet. Bits appear in the occidental order, i.e., from left of the page to right of the page, and from top of the page to bottom of the page.\nBoxes so delimited contains typically the field name, possibly an indication of which bits in the field are in the box, and possibly a value (e.g., for spare bits).\nA specific method can be used in the IE description to describe a branching structure, i.e., a structure variable according to the value of particular fields in the IE. This design is unusual outside type 4 and type 6 IEs, and as, a design rule, should be used only in type 4 and type 6 IEs.\na)\tThe octet number of an octet within the IE is defined typically in the table. It consists of a positive integer, possibly of an additional letter, and possibly of an additional asterisk, see clause f). The positive integer identifies one octet or a group of octets.\nb)\tEach octet group is a self-contained entity. The internal structure of an octet group may be defined in alternative ways.\nc)\tAn octet group is formed by using some extension mechanism. The preferred extension mechanism is to extend an octet (N) through the next octet(s) (Na, Nb, etc.) by using bit 8 in each octet as an extension bit.\n-\tThe bit value \"0\" indicates that the octet group continues through to the next octet. The bit value \"1\" indicates that this octet is the last octet of the group. If one octet (Nb) is present, the preceding octets (N and Na) shall also be present.\n-\tIn the format descriptions of the individual information elements, bit 8 is marked \"0/1 ext\" if another octet follows. Bit 8 is marked \"1 ext\" if this is the last octet in the extension domain.\n-\tAdditional octets may be defined in later versions of the protocols (\"1 ext\" changed to \"0/1 ext\") and equipments shall be prepared to receive such additional octets; the contents of these octets shall be ignored. However the length indicated in the formal description of the messages and of the individual information elements only takes into account this version of the protocols.\nd)\tIn addition to the extension mechanism defined above, an octet (N) may be extended through the next octet(s) (N+1, N+2 etc.) by indications in bits 7-1 (of octet N).\ne)\tThe mechanisms in c) and d) may be combined.\nf)\tOptional octets are marked with asterisks (*). As a design rule, the presence or absence of an optional octet should be determinable from information in the IE and preceding the optional octet. Care should be taken not to introduce ambiguities with optional octets.\ng)\tAt the end of the IE, additional octets may be added in later versions of the protocols also without using the mechanisms defined in c) and d). Equipments shall be prepared to receive such additional octets; the contents of these octets shall be ignored. However the length indicated in the formal description of the messages and of the individual information elements only takes into account this version of the protocols.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.6\tImperative part of a standard MONP message",
                            "text_content": "The imperative part of a standard MONP message is composed of a header possibly followed by mandatory standard IEs having the format V, LV or LV-E.\nThe header consists of a message type information element as specified in clause 15.2.1.\nThe message type octet of a standard MONP message may be followed by mandatory standard IEs having the format V, LV or LV-E as specified in the message description in the relevant protocol specification.\nAs a design rule, octet boundaries must be respected. This implies that half-octet standard IEs (i.e., V formatted type 1 standard IEs) must appear by pair.\nIf message is received as a standard MONP message, and that is too short to contain the complete imperative part as specified in the relevant protocol specification, an imperative message part error is diagnosed. (The same error may be diagnosed at detection of certain contents of the imperative part of a message; this is defined in the relevant protocol specification.) The treatment of an imperative message part error is defined in the relevant protocol specification.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.7\tNon-imperative part of a standard MONP message",
                            "text_content": "The imperative part of a standard MONP message may be followed by the non-imperative part. The MONP protocol specification defines where the imperative part of a standard MONP message ends. The non-imperative part of a standard MONP message is composed of (zero, one, or several) standard IEs having the format T, TV, TLV or TLV-E. The receiver of a standard MONP message shall analyse the non-imperative part as a succession of standard IEs each containing an IEI, and shall be prepared for the non-imperative part of the message to contain standard IEs that are not specified in the relevant protocol specification.\nAn IEI may be known in a message or unknown in a message.\nAn IEI that is known in a message designates the IE type of the IE the first part of which the IEI is, as well as the use of the information. Which IE type it designates is specified in the relevant protocol specification. Within a message, different IEIs may designate the same IE type if that is defined in the relevant protocol specification.\nWhether the second part of an IE with IEI known in a message is the length or not (in other words, whether the IEI is the first part of an IE formatted as TLV, TLV-E or not) is specified in the relevant protocol specification.\nUnless otherwise specified in the protocol specification, the receiver shall assume that IE with unknown IEI are TV formatted type 1, T formatted type 2, TLV formatted type 4 or TLV-E formatted type 6 standard IEs. The IEI of unknown IEs together with, when applicable, the length indicator, enable the receiver to determine the total length of the IE, and then to skip unknown IEs. The receiver shall assume the following rule for IEs with unknown IEI:\nBit 8 of the IEI octet is set to \"1\" indicates a TV formatted type 1 standard IE or a T formatted type 2 IEs. Hence, a 1 valued bit 8 indicates that the whole IE is one octet long.\nFurthermore:\nBit 8 of the IEI octet set to \"0\" and bits 7 to 4 set to \"1\" indicates a TLV-E formatted type 6 IE, i.e. the following two octets are length octets. Bit 8 of the IEI octet set to \"0\" and bit 7 to 4 set to any other bit combination indicates a TLV formatted type 4 IE, i.e. the following octet is a length octet.\nAs a design rule, it is recommended that IEIs of any TV formatted type 1, T formatted type 2, TLV formatted type 4 or TLV-E formatted type 6 IE follow the rule, even if assumed to be known by all potential receivers.\nA message may contain two or more IEs with equal IEI. Two IEs with the same IEI in a same message must have the same format, and, when of type 3, the same length. More generally, care should be taken not to introduce ambiguities by using an IEI for two purposes. Ambiguities appear in particular when two IEs potentially immediately successive have the same IEI but different meanings and when both are non-mandatory. As a recommended design rule, messages should contain a single IE of a given IEI.\nEach protocol specification may put specific rules for the order of IEs in the non-imperative part. An IE known in the message, but at a position non-compliant with these rules is said to be out of sequence. An out of sequence IE is decoded according to the format, and, when of type 3 the length, as defined in the message for its IEI.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.8\tPresence requirements of information elements",
                            "text_content": "The relevant protocol specification may define three different presence requirements (M, C, or O) for a standard IE within a given standard MONP message:\n-\tM (\"Mandatory\") means that the IE shall be included by the sending side, and that the receiver diagnoses a \"missing mandatory IE\" error when detecting that the IE is not present. An IE belonging to the imperative part of a message has presence requirement M. An IE belonging to the non-imperative part of a message may have presence requirement M;\n-\tC (\"Conditional\") means:\n*\tthat inclusion of the IE by the sender depends on conditions specified in the relevant protocol specification;\n*\tthat there are conditions for the receiver to expect that the IE is present and/or conditions for the receiver to expect that the IE is not present in a received message of a given message type; these conditions depend only on the content of the message itself, and not for instance on the state in which the message was received, or on the receiver characteristics; they are known as static conditions;\n*\tthat the receiver detecting that the IE is not present when sufficient static conditions are fulfilled for its presence, shall diagnose a \"missing conditional IE\" error;\n*\tthat the receiver detecting that the IE is present when sufficient static conditions are fulfilled for its non-presence, shall diagnose an \"unexpected conditional IE\" error.\n-\tOnly IEs belonging to the non-imperative part of a message may have presence requirement C;\n-\tO (\"Optional\") means that the receiver shall never diagnose a \"missing mandatory IE\" error, a \"missing conditional IE\" error, or an \"unexpected conditional IE\" error because it detects that the IE is present or that the IE is not present. (There may however be conditions depending on the states, resources, etc. of the receiver to diagnose other errors.) Only IEs belonging to the non-imperative part of a message may have presence requirement O.\nUnless otherwise specified the presence of an IE of unknown IEI or of an out of sequence IE shall not lead by itself to an error.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "I.2.2.9\tDescription of standard MONP messages",
                            "text_content": "This clause describes a generic description method for MONP messages, the tabular description.\nA MONP message is described by a table listing the header elements and the standard IEs in the message. For each element is given:\n-\tif applicable the IEI, in hexadecimal representation (one digit followed by and hyphen for TV formatted type 1, and two digits for the other cases);\n-\tthe name of the IE (this is used in particular for the description of conditional presence rules);\n-\tthe type of the information element, with a reference of where the internal structure of the value part is specified;\n-\tthe format of the standard IE (T, V, TV, LV, TLV, LV-E or TLV-E); and\n-\tthe length, or the range of lengths, of the whole standard IE, including when applicable the T and L parts.\nThe list of elements is given in the table in the order they appear in the resulting bit string, with the exception of half-octet elements in the imperative part: half octets in a pair are inverted.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "J.1\tInfo package for transfer of floor requests",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "J.1.1\tScope",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause contains the information required for the IANA registration of info package g.3gpp.mcptt-floor-request in accordance with IETF RFC 6086 [64].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "J.1.2\tg.3gpp.mcptt-floor-request info package",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "J.1.2.1\tOverall description",
                            "text_content": "When a temporary group call includes constituent MCPTT groups in partner systems where a MCPTT call is ongoing and if the floor is occupied by a participant with a permission to speak, the non-controlling MCPTT function of a MCPTT group needs to transfer information of the current speaker(s) to the controlling MCPTT function hosting the temporary group. The information is transferred in the form of a floor request.The controlling MCPTT function will then determine if the participant will be permitted to continue to speak or if the permission to speak is revoked.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.2\tApplicability",
                            "text_content": "This package is used to transport a floor request from the non-controlling MCPTT function of an MCPTT group to the controlling MCPTT function hosting the temporary group.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.3\tAppropriateness of INFO Package Usage",
                            "text_content": "A number of solutions were discussed for the transportation of the floor request to the controlling MCPTT function hosting the temporary MCPTT group. The solutions were:\n1)\tUse of the session related methods (e.g. SIP 200 (OK) response to the SIP INVITE request).\n2)\tUse of the SIP MESSAGE method.\n3)\tUse of the SIP INFO method as described in IETF RFC 6086, by defining a new info package.\nThe result of the evaluation of the above solutions were:\n1)\tTo include such a large amount of data in a SIP 200 (OK) response to an SIP INVITE request could cause problems with the size of the SIP 200 (OK) response resulting in packet fragmentation.\n2)\tThe use of the SIP MESSAGE request would result in that the recommended value of size of the information transferred by the SIP MESSAGE request would be exceeded.\n3)\tThe use of SIP INFO request was found as the most appropriate solution since the SIP INFO request could be sent in the existing SIP session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.4\tInfo package name",
                            "text_content": "g.3gpp.mcptt-floor-request\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.5\tInfo package parameters",
                            "text_content": "None defined\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.6\tSIP options tags",
                            "text_content": "None defined\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.7\tINFO message body parts",
                            "text_content": "The MIME type of the message body carrying participant identities is application/vnd.3gpp.floor-request+xml. The application/vnd.3gpp.floor-request+xml MIME type is defined in 3GPP TS 24.379.\nWhen associated with the g.3gpp.mcptt-floor-request info package, the Content-Disposition value of the message body carrying the floor request is \"info-package\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.8\tInfo package usage restrictions",
                            "text_content": "None defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.9\tRate of INFO Requests",
                            "text_content": "Single INFO request generated after session set up.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.10\tInfo package security considerations",
                            "text_content": "The security is based on the generic security mechanism provided for the underlying SIP signalling. No additional security mechanism is defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.1.2.11\tImplementation details and examples",
                            "text_content": "UAC generation of INFO requests: See 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control; Protocol specification\".\nUAS processing of INFO requests: See 3GPP TS 24.379: \"\"Mission Critical Push To Talk (MCPTT) call control; Protocol specification\"\nEXAMPLE:\tA controlling MCPTT function hosting a temporary MCPTT group inviting a constituent MCPTT group hosted by a non-controlling MCPTT function of a MCPTT group in a partner system where an MCPTT call is ongoing with one or two of the participants granted to speak. Then the non-controlling MCPTT function of the an MCPTT group sends a SIP INFO request carrying a floor request in an application/vnd.3gpp.mcptt-floor-request+xml MIME body using the g.3gpp.mcptt-floor-request info package.\n",
                            "figures_meta_data": [],
                            "tables": []
                        }
                    ]
                }
            ]
        },
        {
            "title": "J.2\tInfo package for transfer of MCPTT information",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "J.2.1\tScope",
                    "description": "",
                    "summary": "",
                    "text_content": "This clause contains the information required for the IANA registration of info package g.3gpp.mcptt-info in accordance with IETF RFC 6086 [64].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "J.2.2\tg.3gpp.mcptt-info info package",
                    "description": "",
                    "summary": "",
                    "text_content": "",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": [
                        {
                            "title": "J.2.2.1\tOverall description",
                            "text_content": "The MCPTT client request for MCPTT emergency call origination can also optionally request the origination of an MCPTT emergency alert. Similarly, the MCPTT client request for MCPTT emergency call cancellation can also optionally request the cancellation of an MCPTT emergency alert. A mechanism to inform the MCPTT client that one of the requested actions has been rejected by the controlling MCPTT function is needed to both inform the MCPTT user that one of their requested actions has been rejected and to keep the emergency and imminent peril related state machines maintained by the MCPTT client updated appropriately. Note that a SIP 200 OK has to be sent in the case where the MCPTT emergency call origination request or cancellation request is accepted by the controller to allow the MCPTT user to initiate the MCPTT emergency call and receive updated priority even if the accompanying MCPTT alert request is rejected.\nAn MCPTT client request for an MCPTT imminent peril call when the targeted MCPTT group is in an in-progress emergency state also needs special handling, as in this case, the call request will be accepted but the MCPTT client needs to be informed that the MCPTT user will be joined to an in-progress MCPTT emergency group call instead of the requested MCPTT imminent peril group call to keep the emergency and imminent peril related state machines maintained by the MCPTT client updated appropriately.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.2\tApplicability",
                            "text_content": "This package is used to transport emergency call, imminent peril and emergency alert indications from the controlling function to the MCPTT client\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.3\tAppropriateness of INFO Package Usage",
                            "text_content": "A number of solutions were discussed for the transportation of the emergency call, imminent peril and emergency alert indications from the controlling function to the MCPTT client. The solutions were:\n1)\tUse of the session related methods (e.g. SIP 200 (OK) response to the SIP INVITE request).\n2)\tUse of the SIP MESSAGE method.\n3)\tUse of the SIP INFO method as described in IETF RFC 6086, by defining a new info package.\nThe result of the evaluation of the above solutions were:\n1)\tTo include such a large amount of data in a SIP 200 (OK) response to an SIP INVITE request could cause problems with the size of the SIP 200 (OK) response resulting in packet fragmentation.\n2)\tThe use of the SIP MESSAGE request would result in that the recommended value of size of the information transferred by the SIP MESSAGE request would be exceeded.\n3)\tThe use of SIP INFO request was found as the most appropriate solution since the SIP INFO request could be sent in the existing SIP session.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.4\tInfo package name",
                            "text_content": "g.3gpp.mcptt-info\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.5\tInfo package parameters",
                            "text_content": "None defined\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.6\tSIP options tags",
                            "text_content": "None defined\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.7\tINFO message body parts",
                            "text_content": "The MIME type of the message body carrying participant identities is application/vnd.3gpp.mcptt-info+xml. The application/vnd.3gpp.mcptt-info+xml MIME type is defined in 3GPP TS 24.379.\nWhen associated with the g.3gpp.mcptt-info info package, the Content-Disposition value of the message body carrying mcptt information is \"info-package\".\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.8\tInfo package usage restrictions",
                            "text_content": "None defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.9\tRate of INFO Requests",
                            "text_content": "Single INFO request generated after session set up.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.10\tInfo package security considerations",
                            "text_content": "The security is based on the generic security mechanism provided for the underlying SIP signalling. No additional security mechanism is defined.\n",
                            "figures_meta_data": [],
                            "tables": []
                        },
                        {
                            "title": "J.2.2.11\tImplementation details and examples",
                            "text_content": "UAC generation of INFO requests: See 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control; Protocol specification\".\nUAS processing of INFO requests: See 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control; Protocol specification\"\nEXAMPLE:\tA controlling MCPTT function will receive a SIP INVITE request or SIP (re-)INVITE request containing a request for an emergency call (with or without an alert) or an imminent peril call. When an emergency call has been authorised but an optional request for an emergency alert has been determined to be unauthorised, the controller will respond with a SIP 200 (OK) response to indicate acceptance of the call request and return an indication of the rejection of the emergency alert request in a SIP INFO request carrying the application/vnd.3gpp.mcptt-info+xml MIME body using the g.3gpp.mcptt-info info package.\nThis annex contains information to be provided to IANA for MCPTT Off-Network Protocol (MONP) UDP port registration. The following information is to be used to register MONP user port number and service name in the \"IANA Service Name and Transport Protocol Port Number Registry\" and specifically \"Service Name and Transport Protocol Port Number Registry\". This registration form can be found at: .\n\n",
                            "figures_meta_data": [],
                            "tables": [
                                {
                                    "description": "This annex contains information to be provided to IANA for MCPTT Off-Network Protocol (MONP) UDP port registration. The following information is to be used to register MONP user port number and service name in the \"IANA Service Name and Transport Protocol Port Number Registry\" and specifically \"Service Name and Transport Protocol Port Number Registry\". This registration form can be found at: https://www.iana.org/form/ports-services.",
                                    "table number": 86,
                                    "summary": "",
                                    "name": ""
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "title": "L.1\tGeneral",
            "description": "The present document applies to both EPS and 5GS. This annex lists the aspects of MCPTT session control protocols which are different in 5GS from EPS. Certain aspects that are only applicable to EPS are described in clause L.2. A mapping of EPS-specific terms to their 5GS equivalents is provided in clause L.3.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.2\tAspects not applicable to 5GS",
            "description": "The following aspects of EPS mentioned in the present document are not applicable to 5GS:\n-\tProximity-services (ProSe) and the corresponding procedures are replaced by 5G ProSe and the corresponding procedures in 5GS; and\n-\tMultimedia Broadcast and Multicast Service (MBMS) and the corresponding procedures.\n",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": []
        },
        {
            "title": "L.3\tMapping of EPS-specific terms to 5GS",
            "description": "",
            "summary": "",
            "tables": [],
            "figures_meta_data": [],
            "subsections": [
                {
                    "title": "L.3.1\tSession aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "In 5GS, the PDU session is the equivalent of a PDN connection in EPS. The requirements and configurations for a PDN connection throughout this document shall also apply to PDU sessions.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.3.2\tBearer aspects",
                    "description": "",
                    "summary": "",
                    "text_content": "When using the 5GS, a bearer is provided by a 5GS QoS flow. The requirements, procedures, and configurations for a bearer throughout this document, including those stating EPS explicitly (e.g., EPS bearer priority), shall also apply to QoS flows.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.3.3\tResource sharing",
                    "description": "",
                    "summary": "",
                    "text_content": "In 5GS, the exchange of the QoS characteristics of the required resources takes place by means of direct interaction between SIP core and PCF using N5 reference point or Rx reference point or indirectly utilizing N33 reference point between MC service server and NEF. Thus, the requirements for resource sharing of clause 8 apply with the following clarifications:\n1)\tto control resource sharing, interfacing to PCF is using the N5 reference point or the Rx reference point;\n2)\toptionally, QoS characteristics for resources can be exchanged indirectly utilizing N33 reference point between the MC service server and NEF.\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.3.4\tMapping of MBMS terms to MBS",
                    "description": "",
                    "summary": "",
                    "text_content": "In the EPS, using the MBMS procedures, in the 5GS or eMBMS and 5G MBS co- existence, using the MBS procedures;\n-\tin the MBS procedures, references to 4G \"MBMS\" is understood to be references to 5G \"MBS\";\n-\tin the MBS procedures, references to 4G \"TMGI\" is understood to be references to 5G \"MBS session ID\";\n-\tin the MBS procedures, references to 4G \"application/vnd.3gpp.mcptt-mbms-usage-info+xml\" is understood to be references to 5G \"application/vnd.3gpp.mcptt-mbs-usage-info+xml\";\n-\tin the MBS procedures, references to 4G \"MBMS suspension\" corresponds to 5G \"MBS session de-announcement\"; and\n-\tin the MBS procedures, \"Map Group To Session Stream\" corresponds to the \"Map Group To Bearer\" in eMBMS, as specified in 3GPP TS 23.289 [92].\n",
                    "tables": [],
                    "figures_meta_data": [],
                    "subsubsections": []
                },
                {
                    "title": "L.3.5\tMapping of ProSe terms to 5G ProSe",
                    "description": "",
                    "summary": "",
                    "text_content": "The procedures defined in this specification are reused for off-network communication and on-network communication (i.e. UE-to-network relay) for MCPTT service over 5G ProSe with the following differences:\n-\tProSe direct discovery for public safety shall be replaced with 5G ProSe direct discovery, as specified in 3GPP TS 24.554 [94].\n-\tProSe direct communication shall be replaced with 5G ProSe direct communication, as specified in 3GPP TS 24.554 [94].\n-\tProSe UE-to-network relay shall be replaced with 5G ProSe UE-to-network relay, as specified in 3GPP TS 24.554 [94].\n-\tOne-to-one ProSe direct communication for Public Safety shall be replaced with unicast mode 5G ProSe direct communication for Public Safety, as specified in 3GPP TS 24.554 [94].\n-\tOne-to-many ProSe direct communication for Public Safety shall be replaced with groupcast mode 5G ProSe direct communication for Public Safety, as specified in 3GPP TS 24.554 [94].\n-\tPPPP (ProSe Per-Packet Priority) shall be replaced with PQI, as specified in 3GPP TS 24.554 [94].\n\n\n",
                    "tables": [
                        {
                            "description": "",
                            "table number": 87,
                            "summary": "",
                            "name": ""
                        },
                        {
                            "description": "",
                            "table number": 88,
                            "summary": "",
                            "name": ""
                        }
                    ],
                    "figures_meta_data": [],
                    "subsubsections": []
                }
            ]
        }
    ]
}